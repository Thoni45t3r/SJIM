
/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/nvd3/d3.v3.js defined in bundle 'web.assets_backend' */
!function(){var d3={version:"3.5.6"};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list);};var d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement;}
function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView);}
if(d3_document){try{d3_array(d3_document.documentElement.childNodes)[0].nodeType;}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array;};}}
if(!Date.now)Date.now=function(){return+new Date();};if(d3_document){try{d3_document.createElement("DIV").style.setProperty("opacity",0,"");}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"");};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"");};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority);};}}
d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN;}
d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN;};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break;}
while(++i<n)if((b=array[i])!=null&&a>b)a=b;}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b;}
return a;};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break;}
while(++i<n)if((b=array[i])!=null&&b>a)a=b;}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b;}
return a;};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break;}
while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b;}}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=c=b;break;}
while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b;}}
return[a,c];};function d3_number(x){return x===null?NaN:+x;}
function d3_numeric(x){return!isNaN(x);}
d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=+array[i]))s+=a;}else{while(++i<n)if(d3_numeric(a=+f.call(array,array[i],i)))s+=a;}
return s;};d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))s+=a;else--j;}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))s+=a;else--j;}
if(j)return s/j;};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v;};d3.median=function(array,f){var numbers=[],n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))numbers.push(a);}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))numbers.push(a);}
if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5);};d3.variance=function(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(arguments.length===1){while(++i<n){if(d3_numeric(a=d3_number(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m);}}}else{while(++i<n){if(d3_numeric(a=d3_number(f.call(array,array[i],i)))){d=a-m;m+=d/++j;s+=d*(a-m);}}}
if(j>1)return s/(j-1);};d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v;};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid;}
return lo;},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1;}
return lo;}};}
var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(f.length===1?function(d,x){return d3_ascending(f(d),x);}:f);};d3.shuffle=function(array,i0,i1){if((m=arguments.length)<3){i1=array.length;if(m<2)i0=0;}
var m=i1-i0,t,i;while(m){i=Math.random()*m--|0;t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;}
return array;};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes;};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs;};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i];}}
return zips;};function d3_zipLength(d){return d.length;}
d3.transpose=function(matrix){return d3.zip.apply(d3,matrix);};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys;};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values;};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries;};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m];}}
return merged;};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0;}}
if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range;};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k;}
function d3_class(ctor,properties){for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false});}}
d3.map=function(object,f){var map=new d3_Map();if(object instanceof d3_Map){object.forEach(function(key,value){map.set(key,value);});}else if(Array.isArray(object)){var i=-1,n=object.length,o;if(arguments.length===1)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f.call(object,o=object[i],i),o);}else{for(var key in object)map.set(key,object[key]);}
return map;};function d3_Map(){this._=Object.create(null);}
var d3_map_proto="__proto__",d3_map_zero="\x00";d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)];},set:function(key,value){return this._[d3_map_escape(key)]=value;},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];for(var key in this._)values.push(this._[key]);return values;},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries;},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key]);}});function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key;}
function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key;}
function d3_map_has(key){return d3_map_escape(key)in this._;}
function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key];}
function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys;}
function d3_map_size(){var size=0;for(var key in this._)++size;return size;}
function d3_map_empty(){for(var key in this._)return false;return true;}
d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map(),values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object);}else{valuesByKey.set(keyValue,[object]);}}
if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth));};}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth);};}
valuesByKey.forEach(setter);return object;}
function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)});});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key);}):array;}
nest.map=function(array,mapType){return map(mapType,array,0);};nest.entries=function(array){return entries(map(d3.map,array,0),0);};nest.key=function(d){keys.push(d);return nest;};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest;};nest.sortValues=function(order){sortValues=order;return nest;};nest.rollup=function(f){rollup=f;return nest;};return nest;};d3.set=function(array){var set=new d3_Set();if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set;};function d3_Set(){this._=Object.create(null);}
d3_class(d3_Set,{has:d3_map_has,add:function(key){this._[d3_map_escape(key+="")]=true;return key;},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key));}});d3.behavior={};function d3_identity(d){return d;}
d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target;};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value;};}
function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName;}}
var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}
d3.dispatch=function(){var dispatch=new d3_dispatch(),i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch;};function d3_dispatch(){}
d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.slice(i+1);type=type.slice(0,i);}
if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null);}
return this;}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map();function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch;}
event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name);}
if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch;};return event;}
d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault();}
function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e;}
function d3_eventDispatch(target){var dispatch=new d3_dispatch(),i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz);}finally{d3.event=e0;}};};return dispatch;}
d3.requote=function(s){return s.replace(d3_requote_re,"\\$&");};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype;}:function(object,prototype){for(var property in prototype)object[property]=prototype[property];};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups;}
var d3_select=function(s,n){return n.querySelector(s);},d3_selectAll=function(s,n){return n.querySelectorAll(s);},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s);};return d3_selectMatches(n,s);};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null;};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector;}
d3.selection=function(){return d3.select(d3_document.documentElement);};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this);};}
d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node;}}}
return d3_selection(subgroups);};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this);};}
var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.slice(0,i);name=name.slice(i+1);}
return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name;}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name);}
for(value in name)this.each(d3_selection_attr(value,name[value]));return this;}
return this.each(d3_selection_attr(name,value));};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrConstant(){this.setAttribute(name,value);}
function attrConstantNS(){this.setAttributeNS(name.space,name.local,value);}
function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x);}
function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x);}
return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant;}
function d3_collapse(s){return s.trim().replace(/\s+/g," ");}
d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false;}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false;}
return true;}
for(value in name)this.each(d3_selection_classed(value,name[value]));return this;}
return this.each(d3_selection_classed(name,value));};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g");}
function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/);}
function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value);}
function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x);}
return typeof value==="function"?classedFunction:classedConstant;}
function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name));}else{node.setAttribute("class",d3_collapse(c.replace(re," ")));}};}
d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this;}
if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name);}
priority="";}
return this.each(d3_selection_style(name,value,priority));};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name);}
function styleConstant(){this.style.setProperty(name,value,priority);}
function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority);}
return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant;}
d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this;}
return this.each(d3_selection_property(name,value));};function d3_selection_property(name,value){function propertyNull(){delete this[name];}
function propertyConstant(){this[name]=value;}
function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x;}
return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant;}
d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v;}:value==null?function(){this.textContent="";}:function(){this.textContent=value;}):this.node().textContent;};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v;}:value==null?function(){this.innerHTML="";}:function(){this.innerHTML=value;}):this.node().innerHTML;};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments));});};function d3_selection_creator(name){function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace?document.createElementNS(namespace,name):document.createElement(name);}
function createNS(){return this.ownerDocument.createElementNS(name.space,name.local);}
return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?createNS:create;}
d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null);});};d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove);};function d3_selectionRemove(){var parent=this.parentNode;if(parent)parent.removeChild(this);}
d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__;}}
return value;}
function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map(),keyValues=new Array(n),keyValue;for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValue=key.call(node=group[i],node.__data__,i))){exitNodes[i]=node;}else{nodeByKeyValue.set(keyValue,node);}
keyValues[i]=keyValue;}
for(i=-1;++i<m;){if(!(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))){enterNodes[i]=d3_selection_dataNode(nodeData);}else if(node!==true){updateNodes[i]=node;node.__data__=nodeData;}
nodeByKeyValue.set(keyValue,true);}
for(i=-1;++i<n;){if(nodeByKeyValue.get(keyValues[i])!==true){exitNodes[i]=group[i];}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node;}else{enterNodes[i]=d3_selection_dataNode(nodeData);}}
for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i]);}
for(;i<n;++i){exitNodes[i]=group[i];}}
enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes);}
var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i));}}else{while(++i<n){bind(group=this[i],value);}}
update.enter=function(){return enter;};update.exit=function(){return exit;};return update;};function d3_selection_dataNode(data){return{__data__:data};}
d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__");};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_selection(subgroups);};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector);};}
d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node;}}}
return this;};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order();};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b;};}
d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j);});};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j);}}
return groups;}
d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this;};d3_selectionPrototype.empty=function(){return!this.node();};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node;}}
return null;};d3_selectionPrototype.size=function(){var n=0;d3_selection_each(this,function(){++n;});return n;};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection;}
var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before);};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node;};}
d3.select=function(node){var group;if(typeof node==="string"){group=[d3_select(node,d3_document)];group.parentNode=d3_document.documentElement;}else{group=[node];group.parentNode=d3_documentElement(node);}
return d3_selection([group]);};d3.selectAll=function(nodes){var group;if(typeof nodes==="string"){group=d3_array(d3_selectAll(nodes,d3_document));group.parentNode=d3_document.documentElement;}else{group=nodes;group.parentNode=null;}
return d3_selection([group]);};d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this;}
if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false;}
return this.each(d3_selection_on(type,listener,capture));};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.slice(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name];}}
function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener;}
function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name];}}}
return i?listener?onAdd:onRemove:listener?d3_noop:removeAll;}
var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});if(d3_document){d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k);});}
function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz);}finally{d3.event=o;}};}
function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e);}};}
var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect==null){d3_event_dragSelect="onselectstart"in node?false:d3_vendorSymbol(node.style,"userSelect");}
if(d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none";}
return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){var off=function(){w.on(click,null);};w.on(click,function(){d3_eventPreventDefault();off();},true);setTimeout(off,0);}};}
d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource());};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove();}}
if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y];}
var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop];}
d3.touch=function(container,touches,identifier){if(arguments.length<3)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch);}}};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart);}
function dragstart(id,position,subject,move,end){return function(){var that=this,target=d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(dragId==null?"":"-"+dragId),dragOffset,dragSubject=d3.select(subject(target)).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);if(origin){dragOffset=origin.apply(that,arguments);dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]];}else{dragOffset=[0,0];}
dispatch({type:"dragstart"});function moved(){var position1=position(parent,dragId),dx,dy;if(!position1)return;dx=position1[0]-position0[0];dy=position1[1]-position0[1];dragged|=dx|dy;position0=position1;dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy});}
function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null);dragRestore(dragged&&d3.event.target===target);dispatch({type:"dragend"});}};}
drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag;};return d3.rebind(drag,event,"on");};function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier;}
d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point;}):[];};var ε=1e-6,ε2=ε*ε,π=Math.PI,τ=2*π,τε=τ-ε,halfπ=π/2,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return x>0?1:x<0?-1:0;}
function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0]);}
function d3_acos(x){return x>1?0:x<-1?π:Math.acos(x);}
function d3_asin(x){return x>1?halfπ:x<-1?-halfπ:Math.asin(x);}
function d3_sinh(x){return((x=Math.exp(x))-1/x)/2;}
function d3_cosh(x){return((x=Math.exp(x))+1/x)/2;}
function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1);}
function d3_haversin(x){return(x=Math.sin(x/2))*x;}
var ρ=Math.SQRT2,ρ2=2,ρ4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2];var dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+ρ4*d2)/(2*w0*ρ2*d1),b1=(w1*w1-w0*w0-ρ4*d2)/(2*w1*ρ2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/ρ;function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(ρ2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)];}
return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*s)];}
interpolate.duration=S*1e3;return interpolate;};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;if(!d3_behavior_zoomWheel){d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1);},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta;},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail;},"MozMousePixelScroll");}
function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted);}
zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch);}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch);};}).each("interrupt.zoom",function(){zoomended(dispatch);}).each("end.zoom",function(){zoomended(dispatch);});}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch);}});};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom;};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom;};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom;};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom;};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom;};zoom.duration=function(_){if(!arguments.length)return duration;duration=+_;return zoom;};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom;};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom;};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k];}
function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y];}
function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s));}
function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1];}
function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k};scaleTo(Math.pow(2,k));translateTo(center0=p,l);that=d3.select(that);if(duration>0)that=that.transition().duration(duration);that.call(zoom.event);}
function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k;}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k;}).map(y0.invert));}
function zoomstarted(dispatch){if(!zooming++)dispatch({type:"zoomstart"});}
function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]});}
function zoomended(dispatch){if(!--zooming)dispatch({type:"zoomend"}),center0=null;}
function mousedowned(){var that=this,target=d3.event.target,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch);}
function ended(){subject.on(mousemove,null).on(mouseup,null);dragRestore(dragged&&d3.event.target===target);zoomended(dispatch);}}
function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);started();zoomstarted(dispatch);subject.on(mousedown,null).on(touchstart,started);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t);});return touches;}
function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended);targets.push(target);var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null;}
var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1);d3_eventPreventDefault();}
touchtime=now;}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy;}}
function moved(){var touches=d3.touches(that),p0,l0,p1,l1;d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1;}}
if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0);}
touchtime=null;translateTo(p0,l0);zoomed(dispatch);}
function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier];}
for(var identifier in locations0){return void relocate();}}
d3.selectAll(targets).on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch);}}
function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch);},50);d3_eventPreventDefault();scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(center0,translate0);zoomed(dispatch);}
function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1);}
return d3.rebind(zoom,event,"on");};var d3_behavior_zoomInfinity=[0,Infinity],d3_behavior_zoomDelta,d3_behavior_zoomWheel;d3.color=d3_color;function d3_color(){}
d3_color.prototype.toString=function(){return this.rgb()+"";};d3.hsl=d3_hsl;function d3_hsl(h,s,l){return this instanceof d3_hsl?void(this.h=+h,this.s=+s,this.l=+l):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l);}
var d3_hslPrototype=d3_hsl.prototype=new d3_color();d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,this.l/k);};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,k*this.l);};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l);};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return new d3_rgb(vv(h+120),vv(h),vv(h-120));}
d3.hcl=d3_hcl;function d3_hcl(h,c,l){return this instanceof d3_hcl?void(this.h=+h,this.c=+c,this.l=+l):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l);}
var d3_hclPrototype=d3_hcl.prototype=new d3_color();d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb();};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c);}
d3.lab=d3_lab;function d3_lab(l,a,b){return this instanceof d3_lab?void(this.l=+l,this.a=+a,this.b=+b):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b);}
var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_lab.prototype=new d3_color();d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b);};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z));}
function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l);}
function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037;}
function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29;}
function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055));}
d3.rgb=d3_rgb;function d3_rgb(r,g,b){return this instanceof d3_rgb?void(this.r=~~r,this.g=~~g,this.b=~~b):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b);}
function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,value&255);}
function d3_rgbString(value){return d3_rgbNumber(value)+"";}
var d3_rgbPrototype=d3_rgb.prototype=new d3_color();d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return new d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k));};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_rgb(k*this.r,k*this.g,k*this.b);};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b);};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b);};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16);}
function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase());if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);}
case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]));}}}
if(color=d3_rgb_names.get(format)){return rgb(color.r,color.g,color.b);}
if(format!=null&&format.charAt(0)==="#"&&!isNaN(color=parseInt(format.slice(1),16))){if(format.length===4){r=(color&3840)>>4;r=r>>4|r;g=color&240;g=g>>4|g;b=color&15;b=b<<4|b;}else if(format.length===7){r=(color&16711680)>>16;g=(color&65280)>>8;b=color&255;}}
return rgb(r,g,b);}
function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60;}else{h=NaN;s=l>0&&l<1?0:h;}
return new d3_hsl(h,s,l);}
function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z));}
function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);}
function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f;}
var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value));});function d3_functor(v){return typeof v==="function"?v:function(){return v;};}
d3.functor=d3_functor;d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback);};}
function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest(),responseType=null;if(this.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest();"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond();};function respond(){var status=request.status,result;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||status===304){try{result=response.call(xhr,request);}catch(e){dispatch.error.call(xhr,e);return;}
dispatch.load.call(xhr,result);}else{dispatch.error.call(xhr,request);}}
request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request);}finally{d3.event=o;}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr;};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr;};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr;};xhr.response=function(value){response=value;return xhr;};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)));};});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request);});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr;};xhr.abort=function(){request.abort();return xhr;};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback));}
function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null);}:callback;}
function d3_xhrHasResponse(request){var type=request.responseType;return type&&type!=="text"?request.response:request.responseText;}
d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3_xhr(url,mimeType,row==null?response:typedResponse(row),callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row;};return xhr;}
function response(request){return dsv.parse(request.responseText);}
function typedResponse(f){return function(request){return dsv.parse(request.responseText,f);};}
dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]";}).join(",")+"}");o=f?function(row,i){return f(a(row),i);}:a;});};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i;}}
I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I;}else if(c===10){eol=true;}
return text.slice(j+1,i).replace(/""/g,'"');}
while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k;}else if(c!==delimiterCode)continue;return text.slice(j,I-k);}
return text.slice(j);}
while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token();}
if(f&&(a=f(a,n++))==null)continue;rows.push(a);}
return rows;};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set(),fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field));}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field]);}).join(delimiter);})).join("\n");};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n");};function formatRow(row){return row.map(formatValue).join(delimiter);}
function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text;}
return dsv;};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("	","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17);};d3.timer=function(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,f:false,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step);}};function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay);}
d3_timer_interval=0;}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step);}}
d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep();};function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;while(d3_timer_active){if(now>=d3_timer_active.t)d3_timer_active.f=d3_timer_active.c(now-d3_timer_active.t);d3_timer_active=d3_timer_active.n;}
return now;}
function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.f){t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n;}else{if(t1.t<time)time=t1.t;t1=(t0=t1).n;}}
d3_timer_queueTail=t0;return time;}
function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1);}
d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x);};var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i-1)/3)*3));}
return d3_formatPrefixes[8+i/3];};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k;}:function(d){return d*k;},symbol:d};}
function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=locale_grouping[j=(j+1)%locale_grouping.length];}
return t.reverse().join(locale_thousands);}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=false,exponent=true;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";}
switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")prefix="0"+type.toLowerCase();case"c":exponent=false;case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break;}
if(symbol==="$")prefix=locale_currency[0],suffix=locale_currency[1];if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision));}
type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign==="-"?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix;}else{value*=scale;}
value=type(value,precision);var i=value.lastIndexOf("."),before,after;if(i<0){var j=exponent?value.lastIndexOf("e"):-1;if(j<0)before=value,after="";else before=value.substring(0,j),after=value.substring(j);}else{before=value.substring(0,i);after=locale_decimal+value.substring(i+1);}
if(!zfill&&comma)before=formatGroup(before,Infinity);var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=formatGroup(padding+before,padding.length?width-after.length:Infinity);negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix;};};}
var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2);},c:function(x){return String.fromCharCode(x);},o:function(x){return x.toString(8);},x:function(x){return x.toString(16);},X:function(x){return x.toString(16).toUpperCase();},g:function(x,p){return x.toPrecision(p);},e:function(x,p){return x.toExponential(p);},f:function(x,p){return x.toFixed(p);},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))));}});function d3_format_typeDefault(x){return x+"";}
var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}
d3_date_utc.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments);},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments);},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments);},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments);},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments);},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments);},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments);},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments);}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1;}
function ceil(date){step(date=local(new d3_date(date-1)),1);return date;}
function offset(date,k){step(date=new d3_date(+date),k);return date;}
function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1);}}else{while(time<t1)times.push(new Date(+time)),step(time,1);}
return times;}
function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=t0;return range(utc,t1,dt);}finally{d3_date=Date;}}
local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local;}
function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=date;return method(utc,k)._;}finally{d3_date=Date;}};}
d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date;},function(date,offset){date.setFullYear(date.getFullYear()+offset);},function(date){return date.getFullYear();});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day;},function(date,offset){date.setDate(date.getDate()+offset);},function(date){return date.getDate()-1;});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5);};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date;},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7);},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i);});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7);};});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.slice(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1;}}
string.push(template.slice(j,i));return string.join("");}
format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date)();if("j"in d)date.setFullYear(d.y,0,d.j);else if("w"in d&&("W"in d||"U"in d)){date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7);}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L);return localZ?date._:date;};format.toString=function(){return template;};return format;}
function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1;}else if(c!=string.charCodeAt(j++)){return-1;}}
return j;}
d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date();utc._=date;return local(utc);}finally{d3_date=Date;}}
format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._;}finally{d3_date=Date;}};format.toString=local.toString;return format;};d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i);});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()];},A:function(d){return locale_days[d.getDay()];},b:function(d){return locale_shortMonths[d.getMonth()];},B:function(d){return locale_months[d.getMonth()];},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2);},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2);},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3);},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3);},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2);},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2);},p:function(d){return locale_periods[+(d.getHours()>=12)];},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2);},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2);},w:function(d){return d.getDay();},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2);},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2);},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4);},Z:d3_time_zone,"%":function(){return"%";}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i);}
function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i);}
function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i);}
function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i);}
return d3_time_format;}
var d3_time_formatPads={"-":"",_:" ","0":"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string);}
function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i");}
function d3_time_formatLookup(names){var map=new d3_Map(),i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map;}
function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1;}
function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1;}
function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1;}
function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1;}
function d3_time_expandYear(d){return d+(d>68?1900:2e3);}
function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1;}
function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1;}
function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1;}
function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1;}
function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1;}
function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1;}
function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1;}
function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2);}
function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1;}
function d3_time_formatMulti(formats){var n=formats.length,i=-1;while(++i<n)formats[i][0]=this(formats[i][0]);return function(date){var i=0,f=formats[i];while(!f[1](date))f=formats[++i];return f[0](date);};}
d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)};};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat;d3.geo={};function d3_adder(){}
d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t;},reset:function(){this.s=this.t=0;},valueOf:function(){return this.s;}};var d3_adderTemp=new d3_adder();function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv);}
d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener);}else{d3_geo_streamGeometry(object,listener);}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener);}}
var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener);},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener);}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere();},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2]);},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2]);},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0);},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0);},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener);},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener);},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener);}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd();}
function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd();}
d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum;};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder();var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π;},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart;},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop;}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ);};function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(adλ),v=k*sdλ*Math.sin(adλ);d3_geo_areaRingSum.add(Math.atan2(v,u));λ0=λ,cosφ0=cosφ,sinφ0=sinφ;}
d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00);};}
function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)];}
function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}
function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];}
function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k];}
function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l;}
function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])];}
function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε;}
d3.geo.bounds=function(){var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dλSum=0;d3_geo_area.polygonStart();},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)λ0=-(λ1=180),φ0=-(φ1=90);else if(dλSum>ε)φ1=90;else if(dλSum<-ε)φ0=-90;range[0]=λ0,range[1]=λ1;}};function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]);if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=dλ>0?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=abs(dλ)>180;if(antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=inflection[1]*d3_degrees;if(φi>φ1)φ1=φi;}else if(λi=(λi+360)%360-180,antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=-inflection[1]*d3_degrees;if(φi<φ0)φ0=φi;}else{if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
if(antimeridian){if(λ<λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}else{if(λ1>=λ0){if(λ<λ0)λ0=λ;if(λ>λ1)λ1=λ;}else{if(λ>λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}}}else{point(λ,φ);}
p0=p,λ_=λ;}
function lineStart(){bound.point=linePoint;}
function lineEnd(){range[0]=λ0,range[1]=λ1;bound.point=point;p0=null;}
function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=abs(dλ)>180?dλ+(dλ>0?360:-360):dλ;}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ);linePoint(λ,φ);}
function ringStart(){d3_geo_area.lineStart();}
function ringEnd(){ringPoint(λ__,φ__);d3_geo_area.lineEnd();if(abs(dλSum)>ε)λ0=-(λ1=180);range[0]=λ0,range[1]=λ1;p0=null;}
function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1;}
function compareRanges(a,b){return a[0]-b[0];}
function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x;}
return function(feature){φ1=λ1=-(λ0=φ0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0];}else{merged.push(a=b);}}
var best=-Infinity,dλ;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((dλ=angle(a[1],b[0]))>best)best=dλ,λ0=b[0],λ1=a[1];}}
ranges=range=null;return λ0===Infinity||φ0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]];};}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<ε2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<ε)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<ε2)return[NaN,NaN];}
return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees];};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart;},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart;}};function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ));}
function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0;}
function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0);};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint;}
function d3_geo_centroidRingStart(){var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ;d3_geo_centroid.point=nextPoint;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroidPointXYZ(x0,y0,z0);};d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint;};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1]);}
if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1]);};return compose;}
function d3_true(){return true;}
function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return;}
var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b);});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry;}
var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.n.x,1,listener);}
current=current.n;}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.p.x,-1,listener);}
current=current.p;}
current=current.o;points=current.z;isSubject=!isSubject;}while(!current.v);listener.lineEnd();}}
function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b;}
a.n=b=array[0];b.p=a;}
function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null;}
function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[];},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener);}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null;},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd();}};function point(λ,φ){var point=rotate(λ,φ);if(pointVisible(λ=point[0],φ=point[1]))listener.point(λ,φ);}
function pointLine(λ,φ){var point=rotate(λ,φ);line.point(point[0],point[1]);}
function lineStart(){clip.point=pointLine;line.lineStart();}
function lineEnd(){clip.point=point;line.lineEnd();}
var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(λ,φ){ring.push([λ,φ]);var point=rotate(λ,φ);ringListener.point(point[0],point[1]);}
function ringStart(){ringListener.lineStart();ring=[];}
function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(n>0){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd();}
return;}
if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1));}
return clip;};}
function d3_geo_clipSegmentLength1(segment){return segment.length>1;}
function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[]);},point:function(λ,φ){line.push([λ,φ]);},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer;},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()));}};}
function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-halfπ-ε:halfπ-a[1])-((b=b.x)[0]<0?b[1]-halfπ-ε:halfπ-b[1]);}
var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-π,-π/2]);function d3_geo_clipAntimeridianLine(listener){var λ0=NaN,φ0=NaN,sλ0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1;},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=abs(λ1-λ0);if(abs(dλ-π)<ε){listener.point(λ0,φ0=(φ0+φ1)/2>0?halfπ:-halfπ);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0;}else if(sλ0!==sλ1&&dλ>=π){if(abs(λ0-sλ0)<ε)λ0-=sλ0*ε;if(abs(λ1-sλ1)<ε)λ1-=sλ1*ε;φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0;}
listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1;},lineEnd:function(){listener.lineEnd();λ0=φ0=NaN;},clean:function(){return 2-clean;}};}
function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2;}
function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(from==null){φ=direction*halfπ;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ);}else if(abs(from[0]-to[0])>ε){var s=from[0]<to[0]?π:-π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ);}else{listener.point(to[0],to[1]);}}
function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;while(true){if(j===m)j=0;point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,antimeridian=adλ>π,k=sinφ0*sinφ;d3_geo_areaRingSum.add(Math.atan2(k*sdλ*Math.sin(adλ),cosφ0*cosφ+k*Math.cos(adλ)));polarAngle+=antimeridian?dλ+sdλ*τ:dλ;if(antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^dλ>=0?-1:1)*d3_asin(intersection[2]);if(parallel>φarc||parallel===φarc&&(arc[0]||arc[1])){winding+=antimeridian^dλ>=0?1:-1;}}
if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point;}}
return(polarAngle<-ε||polarAngle<ε&&d3_geo_areaRingSum<0)^winding&1;}
function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-π,radius-π]);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr;}
function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1;},point:function(λ,φ){var point1=[λ,φ],point2,v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(λ<0?π:-π),φ):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1]);}}
if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1]);}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd();}
point0=point2;}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd();}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1]);}}}
if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1]);}
point0=point1,v0=v,c0=c;},lineEnd:function(){if(v0)listener.lineEnd();point0=null;},clean:function(){return clean|(v00&&v0)<<1;}};}
function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1],z;if(λ1<λ0)z=λ0,λ0=λ1,λ1=z;var δλ=λ1-λ0,polar=abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0)z=φ0,φ0=φ1,φ1=z;if(meridian?polar?φ0+φ1>0^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)];}}
function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;if(λ<-r)code|=1;else if(λ>r)code|=2;if(φ<-r)code|=4;else if(φ>r)code|=8;return code;}}
function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r;}else if(dx>0){if(r>t1)return;if(r>t0)t0=r;}
r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r;}else if(dx>0){if(r<t0)return;if(r<t1)t1=r;}
r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r;}else if(dy>0){if(r>t1)return;if(r>t0)t0=r;}
r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r;}else if(dy>0){if(r<t0)return;if(r<t1)t1=r;}
if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line;};}
var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream;},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent;}};return clipExtent.extent([[0,0],[960,500]]);};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true;},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener);}
listener.polygonEnd();}
segments=polygon=ring=null;}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&d3_cross2d(a,b,p)>0)++wn;}else{if(b[1]<=y&&d3_cross2d(a,b,p)<0)--wn;}
a=b;}}
return wn!==0;}
function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0);}while((a=(a+direction+4)%4)!==a1);}else{listener.point(to[0],to[1]);}}
function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1;}
function point(x,y){if(pointVisible(x,y))listener.point(x,y);}
var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN;}
function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer());}
clip.point=point;if(v_)listener.lineEnd();}
function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y);}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y);}
listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false;}else if(v){listener.lineStart();listener.point(x,y);clean=false;}}}
x_=x,y_=y,v_=v;}
return clip;};function corner(p,direction){return abs(p[0]-x0)<ε?direction>0?0:3:abs(p[0]-x1)<ε?direction>0?2:1:abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2;}
function compare(a,b){return comparePoints(a.x,b.x);}
function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0];}}
function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){if(!arguments.length)return[φ0/π*180,φ1/π*180];return m(φ0=_[0]*π/180,φ1=_[1]*π/180);};return p;}
function d3_geo_conicEqualArea(φ0,φ1){var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)];}
forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))];};return forward;}
(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea);}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070);};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y];}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point;}
albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates);};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y);},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere();},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart();},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd();},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart();},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd();}};};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa;};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate());};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point;return albersUsa;};return albersUsa.scale(1070);};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart;},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2);}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y;};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y;}
d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00);};}
var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y;}
function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream;},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result;}}};function point(x,y){buffer.push("M",x,",",y,pointCircle);}
function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine;}
function pointLine(x,y){buffer.push("L",x,",",y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){buffer.push("Z");}
return stream;}
function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z";}
var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart;},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd;}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0;}
function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y);}}
function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;}
function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y);}
d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00);};}
function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointRadius=_;return stream;},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y);context.arc(x,y,pointRadius,0,τ);}
function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine;}
function pointLine(x,y){context.lineTo(x,y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){context.closePath();}
return stream;}
function d3_geo_resample(project){var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream);}
function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1]);});}
function resampleRecursive(stream){var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart;},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart;}};function point(x,y){x=project(x,y);stream.point(x[0],x[1]);}
function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart();}
function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0);}
function lineEnd(){resample.point=point;stream.lineEnd();}
function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd;}
function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint;}
function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd();}
return resample;}
function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream);}}}
resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=(δ2=_*_)>0&&16;return resample;};return resample;}
d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream);}
return contextStream.result();}
path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum;};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN];};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]];};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset();};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer():new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset();};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path;};function reset(){cacheStream=null;return path;}
return path.projection(d3.geo.albersUsa()).context(null);};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees]);});return function(stream){return d3_geo_projectionRadians(resample(stream));};}
d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform;}};};function d3_geo_transform(stream){this.stream=stream;}
d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y);},sphere:function(){this.stream.sphere();},lineStart:function(){this.stream.lineStart();},lineEnd:function(){this.stream.lineEnd();},polygonStart:function(){this.stream.polygonStart();},polygonEnd:function(){this.stream.polygonEnd();}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere();},lineStart:function(){stream.lineStart();},lineEnd:function(){stream.lineEnd();},polygonStart:function(){stream.polygonStart();},polygonEnd:function(){stream.polygonEnd();}};}
d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project;})();}
function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k];}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,δx,δy,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k];}
function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees];}
projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream;};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate();};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate();};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset();};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset();};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset();};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=_.length>2?_[2]%360*d3_radians:0;return reset();};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return invalidate();}
function invalidate(){if(stream)stream.valid=false,stream=null;return projection;}
return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset();};}
function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians);});}
function d3_geo_equirectangular(λ,φ){return[λ,φ];}
(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular);}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;}
forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;};return forward;};function d3_geo_identityRotation(λ,φ){return[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];}
d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation;}
function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];};}
function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation;}
function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)];}
rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)];};return rotation;}
d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees;}});return{type:"Polygon",coordinates:[ring]};}
circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle;};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle;};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle;};return circle.angle(90);};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*τ;}else{from=radius+direction*τ;to=radius-.5*step;}
for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1]);}};}
function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI);}
d3.geo.distance=function(a,b){var Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1),t;return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ);};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()};}
function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>ε;}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>ε;}).map(y));}
graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates};});};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]};};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_);};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision);};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision);};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_);};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule;};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule;};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule;};return graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]]);};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y];});};}
function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y];});};}
function d3_source(d){return d.source;}
function d3_target(d){return d.target;}
d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]};}
greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments));};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc;};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc;};greatArc.precision=function(){return arguments.length?greatArc:0;};return greatArc;};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians);};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees];}:function(){return[x0*d3_degrees,y0*d3_degrees];};interpolate.distance=d;return interpolate;}
d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum;};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ);d3_geo_length.point=nextPoint;};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop;};function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ);λ0=λ,sinφ0=sinφ,cosφ0=cosφ;}}
function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)];}
azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)];};return azimuthal;}
var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ));},function(ρ){return 2*Math.asin(ρ/2);});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea);}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c);},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant);}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(φ0,φ1){var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2);},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;if(!n)return d3_geo_mercator;function forward(λ,φ){if(F>0){if(φ<-halfπ+ε)φ=-halfπ+ε;}else{if(φ>halfπ-ε)φ=halfπ-ε;}
var ρ=F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-halfπ];};return forward;}
(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal);}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(φ0,φ1){var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;if(abs(n)<ε)return d3_geo_equirectangular;function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)];};return forward;}
(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant);}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ;},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic);}).raw=d3_geo_gnomonic;function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))];}
d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ];};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]);}}else if(clipAuto){v=null;}
return v;};return m.clipExtent(null);}
(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator);}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1;},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic);}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ);},function(ρ){return 2*Math.atan(ρ);});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic);}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(λ,φ){return[Math.log(Math.tan(π/4+φ/2)),-λ];}
d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-halfπ];};(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]]);};projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90]);};return rotate([0,0,90]);}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0];}
function d3_geom_pointY(d){return d[1];}
d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),i,n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++){points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);}
points.sort(d3_geom_hullOrder);for(i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints);var skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon;}
hull.x=function(_){return arguments.length?(x=_,hull):x;};hull.y=function(_){return arguments.length?(y=_,hull):y;};return hull;};function d3_geom_hullUpper(points){var n=points.length,hull=[0,1],hs=2;for(var i=2;i<n;i++){while(hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0)--hs;hull[hs++]=i;}
return hull.slice(0,hs);}
function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1];}
d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates;};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1];}
return area*.5;};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c;}
return[x*k,y*k];};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
subject.push(d);}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
c=d;}
if(closed)subject.push(subject[0]);a=b;}
return subject;};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0]);}
function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21];}
function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1]);}
var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null;}
function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach();beach.site=site;return beach;}
function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach);}
function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<ε&&abs(y-lArc.circle.cy)<ε){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous;}
disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<ε&&abs(y-rArc.circle.cy)<ε){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next;}
disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);}
lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>ε)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>ε){if(!node.R){lArc=node;break;}
node=node.R;}else{if(dxl>-ε){lArc=node.P;rArc=node;}else if(dxr>-ε){lArc=node;rArc=node.N;}else{lArc=rArc=node;}
break;}}}
var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return;}
if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return;}
d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2;}
function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity;}
function d3_geom_voronoiCell(site){this.site=site;this.edges=[];}
d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1);}
halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length;};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>ε||abs(y3-y2)>ε){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<ε&&y1-y3>ε?{x:x0,y:abs(x2-x0)<ε?y2:y1}:abs(y3-y1)<ε&&x1-x3>ε?{x:abs(y2-y1)<ε?x2:x1,y:y1}:abs(x3-x1)<ε&&y3-y0>ε?{x:x1,y:abs(x2-x1)<ε?y2:y0}:abs(y3-y0)<ε&&x3-x0>ε?{x:abs(y2-y0)<ε?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges;}}}}
function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle;}
function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null;}
function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-ε2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle();circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break;}}else{if(node.R)node=node.R;else{before=node;break;}}}
d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle;}
function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null;}}
function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<ε&&abs(e.a.y-e.b.y)<ε){e.a=e.b=null;edges.splice(i,1);}}}
function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1};}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0};}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1};}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0};}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={x:x1,y:fm*x1+fb};}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb};}}}
edge.a=va;edge.b=vb;return true;}
function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null;}
function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge;}
function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge;}
function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite;}else if(edge.l===rSite){edge.b=vertex;}else{edge.a=vertex;}}
function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y);}
d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b;},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a;}};function d3_geom_voronoiRedBlackTree(){this._=null;}
function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null;}
d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node;}else{after.R=node;}
parent=after;}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after;}else{node.P=node.N=null;this._=node;parent=null;}
node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa);}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa);}}
parent=after.U;}
this._.C=false;},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next;}else{this._=next;}
if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next;}else{next.U=parent;parent=next;node=next.R;}}else{red=node.C;node=next;}
if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return;}
do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R;}
sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break;}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L;}
sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break;}}
sibling.C=true;node=parent;parent=parent.U;}while(!node.C);if(node)node.C=false;}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p;}
function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p;}
function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node;}
function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree();d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree();while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y;}
site=sites.pop();}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc);}else{break;}}
if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram;}
function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x;}
d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y];}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i];});return polygons;}
function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/ε)*ε,y:Math.round(fy(d,i)/ε)*ε,i:i};});}
voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r;}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]};});};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]]);}}});return triangles;};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x;};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y;};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi;};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_]);};return voronoi;};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y);}
d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices);};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0;}
return quadtree(points);}
function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2;}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y);}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_);}}
var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2);}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2);}}else{n.x=x,n.y=y,n.point=d;}}else{insertChild(n,d,x,y,x1,y1,x2,y2);}}
function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=xm;else x2=xm;if(below)y1=ym;else y2=ym;insert(n,d,x,y,x1,y1,x2,y2);}
var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_);};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_);};root.find=function(point){return d3_geom_quadtreeFind(root,point[0],point[1],x1_,y1_,x2_,y2_);};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);}
--i;}else data.forEach(root.add);xs=ys=data=d=null;return root;}
quadtree.x=function(_){return arguments.length?(x=_,quadtree):x;};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y;};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree;};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree;};return quadtree;};function d3_geom_quadtreeCompatX(d){return d.x;}
function d3_geom_quadtreeCompatY(d){return d.y;}
function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null};}
function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2);}}
function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var minDistance2=Infinity,closestPoint;(function find(node,x1,y1,x2,y2){if(x1>x3||y1>y3||x2<x0||y2<y0)return;if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance;x3=x+distance,y3=y+distance;closestPoint=point;}}
var children=node.nodes,xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym;for(var i=below<<1|right,j=i+4;i<j;++i){if(node=children[i&3])switch(i&3){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2);break;}}})(root,x0,y0,x3,y3);return closestPoint;}
d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t));};}
d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k]);}else{c[k]=a[k];}}
for(k in b){if(!(k in a)){c[k]=b[k];}}
return function(t){for(k in i)c[k]=i[k](t);return c;};}
d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){a=+a,b=+b;return function(t){return a*(1-t)+b*t;};}
d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs;}
if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm;}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)});}
bi=d3_interpolate_numberB.lastIndex;}
if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs;}
return s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+"";}):function(){return b;}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("");});}
var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f;}
d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:t==="object"&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b);}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c;};}
var d3_ease_default=function(){return d3_identity;};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad;},cubic:function(){return d3_ease_cubic;},sin:function(){return d3_ease_sin;},exp:function(){return d3_ease_exp;},circle:function(){return d3_ease_circle;},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce;}});var d3_ease_mode=d3.map({"in":d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f));}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))));};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t);};}
function d3_ease_reverse(f){return function(t){return 1-f(1-t);};}
function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function d3_ease_quad(t){return t*t;}
function d3_ease_cubic(t){return t*t*t;}
function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75);}
function d3_ease_poly(e){return function(t){return Math.pow(t,e);};}
function d3_ease_sin(t){return 1-Math.cos(t*halfπ);}
function d3_ease_exp(t){return Math.pow(2,10*(t-1));}
function d3_ease_circle(t){return 1-Math.sqrt(1-t*t);}
function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/τ*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p);};}
function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+"";};}
d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+"";};}
d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+"";};}
d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t);};}
d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate();}
return new d3_transform(t?t.matrix:d3_transformIdentity);})(string);};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1;}
this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0;}
d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1];}
function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k;}
return k;}
function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a;}
var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])});}else if(tb[0]||tb[1]){s.push("translate("+tb+")");}else{s.push("");}
if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)});}else if(rb){s.push(s.pop()+"rotate("+rb+")");}
if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)});}else if(wb){s.push(s.pop()+"skewX("+wb+")");}
if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])});}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")");}
n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("");};}
function d3_uninterpolateNumber(a,b){b=(b-=a=+a)||1/b;return function(x){return(x-a)/b;};}
function d3_uninterpolateClamp(a,b){b=(b-=a=+a)||1/b;return function(x){return Math.max(0,Math.min(1,(x-a)/b));};}
d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths;};};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start);}
var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent;}
return points;}
function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent;}
ancestors.push(node);return ancestors;}
function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop();}
return sharedNode;}
d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j];}
groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x;}
if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b]);});}
if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b]);});});}
k=(τ-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v};}
groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding;}
i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target});}}}
if(sortChords)resort();}
function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2);});}
chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord;};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord;};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord;};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord;};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord;};chord.chords=function(){if(!chords)relayout();return chords;};chord.groups=function(){if(!groups)relayout();return groups;};return chord;};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k;node.py-=dy*k;}
return true;}
if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k;node.py-=dy*k;}}
return!quad.charge;};}
force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true;}
var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k;}}
if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k;}}
if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o));}}}
i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py;}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction;}}
event.tick({type:"tick",alpha:alpha});};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force;};force.links=function(x){if(!arguments.length)return links;links=x;return force;};force.size=function(x){if(!arguments.length)return size;size=x;return force;};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force;};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force;};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force;};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force;};force.chargeDistance=function(x){if(!arguments.length)return Math.sqrt(chargeDistance2);chargeDistance2=x*x;return force;};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force;};force.theta=function(x){if(!arguments.length)return Math.sqrt(theta2);theta2=x*x;return force;};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0)alpha=x;else alpha=0;}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick);}
return force;};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0;}
for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight;}
for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y;}
distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[];}
for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source);}}
var candidates=neighbors[i],j=-1,l=candidates.length,x;while(++j<l)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size;}
return force.resume();};force.resume=function(){return force.alpha(.1);};force.stop=function(){return force.alpha(0);};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume();}
return d3.rebind(force,event,"on");};function d3_layout_forceDragstart(d){d.fixed|=2;}
function d3_layout_forceDragend(d){d.fixed&=~6;}
function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y;}
function d3_layout_forceMouseout(d){d.fixed&=~4;}
function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy;}}
if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5;}
var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y;}
quad.cx=cx/quad.charge;quad.cy=cy/quad.charge;}
var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=Infinity;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var stack=[root],nodes=[],node;root.depth=0;while((node=stack.pop())!=null){nodes.push(node);if((childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){var n,childs,child;while(--n>=0){stack.push(child=childs[n]);child.parent=node;child.depth=node.depth+1;}
if(value)node.value=0;node.children=childs;}else{if(value)node.value=+value.call(hierarchy,node,node.depth)||0;delete node.children;}}
d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;if(sort&&(childs=node.children))childs.sort(sort);if(value&&(parent=node.parent))parent.value+=node.value;});return nodes;}
hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy;};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy;};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy;};hierarchy.revalue=function(root){if(value){d3_layout_hierarchyVisitBefore(root,function(node){if(node.children)node.value=0;});d3_layout_hierarchyVisitAfter(root,function(node){var parent;if(!node.children)node.value=+value.call(hierarchy,node,node.depth)||0;if(parent=node.parent)parent.value+=node.value;});}
return root;};return hierarchy;};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object;}
function d3_layout_hierarchyVisitBefore(node,callback){var nodes=[node];while((node=nodes.pop())!=null){callback(node);if((children=node.children)&&(n=children.length)){var n,children;while(--n>=0)nodes.push(children[n]);}}}
function d3_layout_hierarchyVisitAfter(node,callback){var nodes=[node],nodes2=[];while((node=nodes.pop())!=null){nodes2.push(node);if((children=node.children)&&(n=children.length)){var i=-1,n,children;while(++i<n)nodes.push(children[i]);}}
while((node=nodes2.pop())!=null){callback(node);}}
function d3_layout_hierarchyChildren(d){return d.children;}
function d3_layout_hierarchyValue(d){return d.value;}
function d3_layout_hierarchySort(a,b){return b.value-a.value;}
function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child};});}));}
d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d;}}}
function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]));}
return 1+d;}
function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes;}
partition.size=function(x){if(!arguments.length)return size;size=x;return partition;};return d3_layout_hierarchyRebind(partition,hierarchy);};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=τ,padAngle=0;function pie(data){var n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i);}),a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle),da=(typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+(typeof padAngle==="function"?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),k=(da-n*pa)/d3.sum(values),index=d3.range(n),arcs=[],v;if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i];}:function(i,j){return sort(data[i],data[j]);});index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p};});return arcs;}
pie.value=function(_){if(!arguments.length)return value;value=_;return pie;};pie.sort=function(_){if(!arguments.length)return sort;sort=_;return pie;};pie.startAngle=function(_){if(!arguments.length)return startAngle;startAngle=_;return pie;};pie.endAngle=function(_){if(!arguments.length)return endAngle;endAngle=_;return pie;};pie.padAngle=function(_){if(!arguments.length)return padAngle;padAngle=_;return pie;};return pie;};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i);});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)];});});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var m=series[0].length,n,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);}}
return data;}
stack.values=function(x){if(!arguments.length)return values;values=x;return stack;};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack;};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack;};stack.x=function(z){if(!arguments.length)return x;x=z;return stack;};stack.y=function(z){if(!arguments.length)return y;y=z;return stack;};stack.out=function(z){if(!arguments.length)return out;out=z;return stack;};return stack;};function d3_layout_stackX(d){return d.x;}
function d3_layout_stackY(d){return d.y;}
function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y;}
var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b];}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
return bottoms.reverse().concat(tops);},reverse:function(data){return d3.range(data.length).reverse();},"default":d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o);}
for(j=0;j<m;++j){y0[j]=(max-sums[j])/2;}
return y0;},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx;}
s2+=s3*data[i][j][1];}
y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o;}
for(j=0;j<m;++j)y0[j]-=o0;return y0;},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length);}
function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0;}
function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k;}}
return j;}
function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0);}
function d3_layout_stackSum(p,d){return p+d[1];}
d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0;}
if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i]);}}}
return bins;}
histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram;};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram;};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x);}:d3_functor(x);return histogram;};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram;};return histogram;};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1));}
function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f;}
function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)];}
d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius;};root.x=root.y=0;d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value);});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr;});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr;});}
d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes;}
pack.size=function(_){if(!arguments.length)return size;size=_;return pack;};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack;};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack;};return d3_layout_hierarchyRebind(pack,hierarchy);};function d3_layout_packSort(a,b){return a.value-b.value;}
function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b;}
function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a;}
function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy;}
function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax);}
nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break;}}}
if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--;}else{d3_layout_packInsert(a,c);b=c;bound(c);}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));}
node.r=cr;nodes.forEach(d3_layout_packUnlink);}
function d3_layout_packLink(node){node._pack_next=node._pack_prev=node;}
function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev;}
function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k);}}
function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx;}else{c.x=a.x+db;c.y=a.y;}}
d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z;d3_layout_hierarchyVisitBefore(root1,secondWalk);if(nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node;});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky;});}
return nodes;}
function wrapTree(root0){var root1={A:null,children:[root0]},queue=[root1],node1;while((node1=queue.pop())!=null){for(var children=node1.children,child,i=0,n=children.length;i<n;++i){queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);}}
return root1.children[0];}
function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint;}else{v.z=midpoint;}}else if(w){v.z=w.z+separation(v._,w._);}
v.parent.A=apportion(v,w,v.parent.A||siblings[0]);}
function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m;}
function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift;}
sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m;}
if(vim&&!d3_layout_treeRight(vop)){vop.t=vim;vop.m+=sim-sop;}
if(vip&&!d3_layout_treeLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v;}}
return ancestor;}
function sizeNode(node){node.x*=size[0];node.y=node.depth*size[1];}
tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree;};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null?sizeNode:null;return tree;};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)==null?null:sizeNode;return tree;};return d3_layout_hierarchyRebind(tree,hierarchy);};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2;}
function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t;}
function d3_layout_treeRight(v){var children=v.children,n;return(n=children.length)?children[n-1]:v.t;}
function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift;}
function d3_layout_treeShift(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c);}}
function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor;}
d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children);}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node;}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1];}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1];});return nodes;}
cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster;};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster;};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster;};return d3_layout_hierarchyRebind(cluster,hierarchy);};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y;});}
function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x;},0)/children.length;}
function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node;}
function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node;}
d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area;}}
function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score;}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity;}}
if(row.length){position(row,u,rect,true);row.length=row.area=0;}
children.forEach(squarify);}}
function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0;}}
children.forEach(stickify);}}
function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r;}
s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity;}
function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);}
o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v;}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);}
o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v;}}
function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes;}
treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap;};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p);}
function padConstant(node){return d3_layout_treemapPad(node,x);}
var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap;};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap;};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap;};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap;};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap;};return d3_layout_hierarchyRebind(treemap,hierarchy);};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy};}
function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0;}
if(dy<0){y+=dy/2;dy=0;}
return{x:x,y:y,dx:dx,dy:dy};}
d3.random={normal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y;}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r);};},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random());};},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m;};},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s;};}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range());}
function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x));};}
function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx;}
domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain;}
function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step;},ceil:function(x){return Math.ceil(x/step)*step;}}:d3_scale_niceIdentity;}
var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse();}
while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]));}
return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x));};}
d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false);};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale;}
function scale(x){return output(x);}
scale.invert=function(y){return input(y);};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound);};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale();};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale();};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale();};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp);};return rescale();}
function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));}
function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent;}
function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m));}
function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);match.shift();if(match[8]==="s"){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));if(!match[7])match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]));match[8]="f";format=d3.format(match.join(""));return function(d){return format(prefix.scale(d))+prefix.symbol;};}
if(!match[7])match[7]="."+d3_scale_linearFormatPrecision(match[8],range);format=match.join("");}else{format=",."+d3_scale_linearPrecision(range[2])+"f";}
return d3.format(format);}
var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01);}
function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2;}
d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10]);};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base);}
function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x);}
function scale(x){return linear(log(x));}
scale.invert=function(x){return pow(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale;};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale;};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale;};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k);}
for(i=0;ticks[i]<u;i++){}
for(j=ticks.length;ticks[j-1]>v;j--){}
ticks=ticks.slice(i,j);}
return ticks;};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(.1,n/scale.ticks().length),f=positive?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor),e;return function(d){return d/pow(f(log(d)+e))<=k?format(d):"";};};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain);};return d3_scale_linearRebind(scale,linear);}
var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x);},ceil:function(x){return-Math.floor(-x);}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1]);};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x));}
scale.invert=function(x){return powb(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale;};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m));};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale;};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e);};}
d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5);};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]});};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||(ranger.t==="range"?index.set(x,domain.push(x)):NaN))-1)%range.length];}
function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i;});}
scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map();var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a);};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale;};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);range=steps(start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale;};scale.rangeRoundPoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step);rangeBand=0;ranger={t:"rangeRoundPoints",a:arguments};return scale;};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale;};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale;};scale.rangeBand=function(){return rangeBand;};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0]);};scale.copy=function(){return d3_scale_ordinal(domain,ranger);};return scale.domain(domain);}
d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10);};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20);};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b);};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c);};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[]);};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale;}
function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)];}
scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.quantiles=function(){return thresholds;};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]];};scale.copy=function(){return d3_scale_quantile(domain,range);};return rescale();}
d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1]);};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))];}
function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale;}
scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx];};scale.copy=function(){return d3_scale_quantize(x0,x1,range);};return rescale();}
d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1]);};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)];}
scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale;};scale.range=function(_){if(!arguments.length)return range;range=_;return scale;};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]];};scale.copy=function(){return d3_scale_threshold(domain,range);};return scale;}
d3.scale.identity=function(){return d3_scale_identity([0,1]);};function d3_scale_identity(domain){function identity(x){return+x;}
identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity;};identity.ticks=function(m){return d3_scale_linearTicks(domain,m);};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};identity.copy=function(){return d3_scale_identity(domain);};return identity;}
d3.svg={};function d3_zero(){return 0;}
d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-halfπ,a1=endAngle.apply(this,arguments)-halfπ,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0)rc=r1,r1=r0,r0=rc;if(da>=τε)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,p0=0,p1=0,x0,y0,x1,y1,x2,y2,x3,y3,path=[];if(ap=(+padAngle.apply(this,arguments)||0)/2){rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments);if(!cw)p1*=-1;if(r1)p1=d3_asin(rp/r1*Math.sin(ap));if(r0)p0=d3_asin(rp/r0*Math.sin(ap));}
if(r1){x0=r1*Math.cos(a0+p1);y0=r1*Math.sin(a0+p1);x1=r1*Math.cos(a1-p1);y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=π?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1);y0=r1*Math.sin(h1);x1=y1=null;}}else{x0=y0=0;}
if(r0){x2=r0*Math.cos(a1-p0);y2=r0*Math.sin(a1-p0);x3=r0*Math.cos(a0+p0);y3=r0*Math.sin(a0+p0);var l0=Math.abs(a0-a1+2*p0)<=π?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0);y2=r0*Math.sin(h0);x3=y3=null;}}else{x2=y2=0;}
if((rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var oc=x3==null?[x2,y2]:x1==null?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);if(x1!=null){var rc1=Math.min(rc,(r1-lc)/(kc+1)),t30=d3_svg_arcCornerTangents(x3==null?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);if(rc===rc1){path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0]);}else{path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0]);}}else{path.push("M",x0,",",y0);}
if(x3!=null){var rc0=Math.min(rc,(r0-lc)/(kc-1)),t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],x1==null?[x0,y0]:[x1,y1],r0,-rc0,cw);if(rc===rc0){path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]);}else{path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]);}}else{path.push("L",x2,",",y2);}}else{path.push("M",x0,",",y0);if(x1!=null)path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1);path.push("L",x2,",",y2);if(x3!=null)path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3);}
path.push("Z");return path.join("");}
function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1;}
arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc;};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc;};arc.cornerRadius=function(v){if(!arguments.length)return cornerRadius;cornerRadius=d3_functor(v);return arc;};arc.padRadius=function(v){if(!arguments.length)return padRadius;padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v);return arc;};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc;};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc;};arc.padAngle=function(v){if(!arguments.length)return padAngle;padAngle=d3_functor(v);return arc;};arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-halfπ;return[Math.cos(a)*r,Math.sin(a)*r];};return arc;};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius;}
function d3_svg_arcOuterRadius(d){return d.outerRadius;}
function d3_svg_arcStartAngle(d){return d.startAngle;}
function d3_svg_arcEndAngle(d){return d.endAngle;}
function d3_svg_arcPadAngle(d){return d&&d.padAngle;}
function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1;}
function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(r*r*d2-D*D),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]];}
function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension));}
while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);}else if(points.length){segment();points=[];}}
if(points.length)segment();return segments.length?segments.join(""):null;}
line.x=function(_){if(!arguments.length)return x;x=_;return line;};line.y=function(_){if(!arguments.length)return y;y=_;return line;};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line;};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line;};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line;};return line;}
d3.svg.line=function(){return d3_svg_line(d3_identity);};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key);});function d3_svg_lineLinear(points){return points.join("L");}
function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z";}
function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("");}
function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("");}
function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("");}
function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension));}
function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points);}
var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];}}
if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1];}
return path;}
function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);}
return tangents;}
function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
points.pop();path.push("L",pi);return path.join("");}
function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1]);}
path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1]);}
path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy);}}
return d3_svg_lineBasis(points);}
function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}
var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y));}
function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0]);}
function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;}
m[i]=d;return m;}
function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<ε){m[i]=m[i+1]=0;}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b;}}}
i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0]);}
return tangents;}
function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points));}
d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line;};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]-halfπ;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a);}
return points;}
function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x;}:d3_functor(x1),fy1=y0===y1?function(){return y;}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z");}
while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)]);}else if(points0.length){segment();points0=[];points1=[];}}
if(points0.length)segment();return segments.length?segments.join(""):null;}
area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area;};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area;};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area;};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area;};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area;};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area;};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area;};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area;};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area;};return area;}
d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity);};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area;};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z";}
function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-halfπ,a1=endAngle.call(self,subgroup,i)-halfπ;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]};}
function equals(a,b){return a.a0==b.a0&&a.a1==b.a1;}
function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p;}
function curve(r0,p0,r1,p1){return"Q 0,0 "+p1;}
chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord;};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord;};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord;};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord;};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord;};return chord;};function d3_svg_chordRadius(d){return d.radius;}
d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3];}
diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal;};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal;};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal;};return diagonal;};function d3_svg_diagonalProjection(d){return[d.x,d.y];}
d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection;};return diagonal;};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-halfπ;return[r*Math.cos(a),r*Math.sin(a)];};}
d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i));}
symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol;};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol;};return symbol;};function d3_svg_symbolSize(){return 64;}
function d3_svg_symbolType(){return"circle";}
function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z";}
var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z";},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z";},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z";},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z";},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z";}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){var id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,ns,id,transition);subgroup.push(node);}}
return d3_transition(subgroups,ns,id);};d3_selectionPrototype.interrupt=function(name){return this.each(name==null?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)));};var d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace());function d3_selection_interruptNS(ns){return function(){var lock,active;if((lock=this[ns])&&(active=lock[lock.active])){if(--lock.count)delete lock[lock.active];else delete this[ns];lock.active+=.5;active.event&&active.event.interrupt.call(this,this.__data__,active.index);}};}
function d3_transition(groups,ns,id){d3_subclass(groups,d3_transitionPrototype);groups.namespace=ns;groups.id=id;return groups;}
var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection);};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,ns,id,node[ns][id]);subgroup.push(subnode);}else{subgroup.push(null);}}}
return d3_transition(subgroups,ns,id);};d3_transitionPrototype.selectAll=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node[ns][id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,ns,id,transition);subgroup.push(subnode);}}}}
return d3_transition(subgroups,ns,id);};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_transition(subgroups,this.namespace,this.id);};d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;if(arguments.length<2)return this.node()[ns][id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node[ns][id].tween.remove(name);}:function(node){node[ns][id].tween.set(name,tween);});};function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)));}:(value=tween(value),function(node){node[ns][id].tween.set(name,value);}));}
d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this;}
var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t));});});}
function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t));});});}
return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t));};}
function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t));};}
return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this;}
priority="";}
function styleNull(){this.style.removeProperty(name);}
function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority);});});}
return d3_transition_tween(this,"style."+name,value,styleString);};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority);};}
return this.tween("style."+name,styleTween);};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text);};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b;};}
d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;if(this[ns].count<2&&(p=this.parentNode))p.removeChild(this);});};d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node[ns][id].ease=value;});};d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].delay;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j);}:(value=+value,function(node){node[ns][id].delay=value;}));};d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].duration;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j));}:(value=Math.max(1,value),function(node){node[ns][id].duration=value;}));};d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id];type.call(node,node.__data__,i,j);});}finally{d3_transitionInherit=inherit;d3_transitionInheritId=inheritId;}}else{d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener);});}
return this;};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=node[ns][id0];d3_transitionNode(node,i,ns,id1,{time:transition.time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration});}
subgroup.push(node);}}
return d3_transition(subgroups,ns,id1);};function d3_transitionNamespace(name){return name==null?"__transition__":"__transition_"+name+"__";}
function d3_transitionNode(node,i,ns,id,inherit){var lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map(),time:time,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i};inherit=null;++lock.count;d3.timer(function(elapsed){var delay=transition.delay,duration,ease,timer=d3_timer_active,tweened=[];timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start;function start(elapsed){if(lock.active>id)return stop();var active=lock[lock.active];if(active){--lock.count;delete lock[lock.active];active.event&&active.event.interrupt.call(node,node.__data__,active.index);}
lock.active=id;transition.event&&transition.event.start.call(node,node.__data__,i);transition.tween.forEach(function(key,value){if(value=value.call(node,node.__data__,i)){tweened.push(value);}});ease=transition.ease;duration=transition.duration;d3.timer(function(){timer.c=tick(elapsed||1)?d3_true:tick;return 1;},0,time);}
function tick(elapsed){if(lock.active!==id)return 1;var t=elapsed/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e);}
if(t>=1){transition.event&&transition.event.end.call(node,node.__data__,i);return stop();}}
function stop(){if(--lock.count)delete lock[id];else delete node[ns];return 1;}},0,time);}}
d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),tickExit=d3.transition(tick.exit()).style("opacity",ε).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign=orient==="top"||orient==="left"?-1:1,x1,x2,y1,y2;if(orient==="bottom"||orient==="top"){tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2";text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize);}else{tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2";text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start");pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize);}
lineEnter.attr(y2,sign*innerTickSize);textEnter.attr(y1,sign*tickSpacing);lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize);textUpdate.attr(x1,0).attr(y1,sign*tickSpacing);if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx;};}else if(scale0.rangeBand){scale0=scale1;}else{tickExit.call(tickTransform,scale1,scale0);}
tickEnter.call(tickTransform,scale0,scale1);tickUpdate.call(tickTransform,scale1,scale1);});}
axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis;};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis;};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis;};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis;};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis;};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis;};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis;};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis;};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis;};axis.tickSubdivide=function(){return arguments.length&&axis;};return axis;};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)";});}
function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")";});}
d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d;}).style("cursor",function(d){return d3_svg_brushCursor[d];}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null;}).attr("y",function(d){return/^[ns]/.test(d)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate);}
if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate);}
redraw(gUpdate);});}
brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"});}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"});};}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"});});}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"});}});};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")";});}
function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0]);}
function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0]);}
function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window(target)).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend);}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend);}
g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1];}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey];}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2;}
d3_eventPreventDefault();}}
function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault();}}
function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1];}
if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])];}else center=null;}
if(resizingX&&move1(point,x,0)){redrawX(g);moved=true;}
if(resizingY&&move1(point,y,1)){redrawY(g);moved=true;}
if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"});}}
function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position;}
min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size;}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position;}else{max=position;}}
if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true;}}
function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"});}}
brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush;};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1];}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t;}}
if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1];}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t;}}
return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1];}
if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1];}
if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1];}
return brush;};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null;}
return brush;};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1];};return d3.rebind(brush,event,"on");};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time_format=d3_time.format=d3_locale_enUS.timeFormat;var d3_time_formatUtc=d3_time_format.utc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString();}
d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date;};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3);},function(date){return date.getSeconds();});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4);},function(date){return date.getMinutes();});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5);},function(date){return date.getHours();});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date;},function(date,offset){date.setMonth(date.getMonth()+offset);},function(date){return date.getMonth();});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x);}
scale.invert=function(x){return d3_time_scaleDate(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale;};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6;}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i];}
scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length;}
return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date;},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date;}}:interval));};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip);};scale.tickFormat=function(){return format;};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format);};return d3_scale_linearRebind(scale,linear);}
function d3_time_scaleDate(t){return new Date(t);}
var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds();}],[":%S",function(d){return d.getSeconds();}],["%I:%M",function(d){return d.getMinutes();}],["%I %p",function(d){return d.getHours();}],["%a %d",function(d){return d.getDay()&&d.getDate()!=1;}],["%b %d",function(d){return d.getDate()!=1;}],["%B",function(d){return d.getMonth();}],["%Y",d3_true]]);var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate);},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat);};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]];});var d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds();}],[":%S",function(d){return d.getUTCSeconds();}],["%I:%M",function(d){return d.getUTCMinutes();}],["%I %p",function(d){return d.getUTCHours();}],["%a %d",function(d){return d.getUTCDay()&&d.getUTCDate()!=1;}],["%b %d",function(d){return d.getUTCDate()!=1;}],["%B",function(d){return d.getUTCMonth();}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat);};d3.text=d3_xhrType(function(request){return request.responseText;});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback);};function d3_json(request){return JSON.parse(request.responseText);}
d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback);};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText);}
d3.xml=d3_xhrType(function(request){return request.responseXML;});if(typeof define==="function"&&define.amd)define(d3);else if(typeof module==="object"&&module.exports)module.exports=d3;this.d3=d3;}();;

/* /web/static/lib/nvd3/nv.d3.js defined in bundle 'web.assets_backend' */
(function(){var nv={};nv.dev=false;nv.tooltip=nv.tooltip||{};nv.utils=nv.utils||{};nv.models=nv.models||{};nv.charts={};nv.logs={};nv.dom={};if(typeof(module)!=='undefined'&&typeof(exports)!=='undefined'&&typeof(d3)=='undefined'){d3=require('d3');}
nv.dispatch=d3.dispatch('render_start','render_end');if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}
if(nv.dev){nv.dispatch.on('render_start',function(e){nv.logs.startTime=+new Date();});nv.dispatch.on('render_end',function(e){nv.logs.endTime=+new Date();nv.logs.totalTime=nv.logs.endTime-nv.logs.startTime;nv.log('total',nv.logs.totalTime);});}
nv.log=function(){if(nv.dev&&window.console&&console.log&&console.log.apply)
console.log.apply(console,arguments);else if(nv.dev&&window.console&&typeof console.log=="function"&&Function.prototype.bind){var log=Function.prototype.bind.call(console.log,console);log.apply(console,arguments);}
return arguments[arguments.length-1];};nv.deprecated=function(name,info){if(console&&console.warn){console.warn('nvd3 warning: `'+name+'` has been deprecated. ',info||'');}};nv.render=function render(step){step=step||1;nv.render.active=true;nv.dispatch.render_start();var renderLoop=function(){var chart,graph;for(var i=0;i<step&&(graph=nv.render.queue[i]);i++){chart=graph.generate();if(typeof graph.callback==typeof(Function))graph.callback(chart);}
nv.render.queue.splice(0,i);if(nv.render.queue.length){setTimeout(renderLoop);}
else{nv.dispatch.render_end();nv.render.active=false;}};setTimeout(renderLoop);};nv.render.active=false;nv.render.queue=[];nv.addGraph=function(obj){if(typeof arguments[0]===typeof(Function)){obj={generate:arguments[0],callback:arguments[1]};}
nv.render.queue.push(obj);if(!nv.render.active){nv.render();}};if(typeof(module)!=='undefined'&&typeof(exports)!=='undefined'){module.exports=nv;}
if(typeof(window)!=='undefined'){window.nv=nv;}
nv.dom.write=function(callback){if(window.fastdom!==undefined){return fastdom.write(callback);}
return callback();};nv.dom.read=function(callback){if(window.fastdom!==undefined){return fastdom.read(callback);}
return callback();};nv.interactiveGuideline=function(){"use strict";var margin={left:0,top:0},width=null,height=null,xScale=d3.scale.linear(),dispatch=d3.dispatch('elementMousemove','elementMouseout','elementClick','elementDblclick','elementMouseDown','elementMouseUp'),showGuideLine=true,svgContainer=null,tooltip=nv.models.tooltip(),isMSIE="ActiveXObject"in window;tooltip.duration(0).hideDelay(0).hidden(false);function layer(selection){selection.each(function(data){var container=d3.select(this);var availableWidth=(width||960),availableHeight=(height||400);var wrap=container.selectAll("g.nv-wrap.nv-interactiveLineLayer").data([data]);var wrapEnter=wrap.enter().append("g").attr("class"," nv-wrap nv-interactiveLineLayer");wrapEnter.append("g").attr("class","nv-interactiveGuideLine");if(!svgContainer){return;}
function mouseHandler(){var d3mouse=d3.mouse(this);var mouseX=d3mouse[0];var mouseY=d3mouse[1];var subtractMargin=true;var mouseOutAnyReason=false;if(isMSIE){mouseX=d3.event.offsetX;mouseY=d3.event.offsetY;if(d3.event.target.tagName!=="svg"){subtractMargin=false;}
if(d3.event.target.className.baseVal.match("nv-legend")){mouseOutAnyReason=true;}}
if(subtractMargin){mouseX-=margin.left;mouseY-=margin.top;}
if(d3.event.type==='mouseout'||mouseX<0||mouseY<0||mouseX>availableWidth||mouseY>availableHeight||(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined)||mouseOutAnyReason){if(isMSIE){if(d3.event.relatedTarget&&d3.event.relatedTarget.ownerSVGElement===undefined&&(d3.event.relatedTarget.className===undefined||d3.event.relatedTarget.className.match(tooltip.nvPointerEventsClass))){return;}}
dispatch.elementMouseout({mouseX:mouseX,mouseY:mouseY});layer.renderGuideLine(null);tooltip.hidden(true);return;}else{tooltip.hidden(false);}
var scaleIsOrdinal=typeof xScale.rangeBands==='function';var pointXValue=undefined;if(scaleIsOrdinal){var elementIndex=d3.bisect(xScale.range(),mouseX)-1;if(xScale.range()[elementIndex]+xScale.rangeBand()>=mouseX){pointXValue=xScale.domain()[d3.bisect(xScale.range(),mouseX)-1];}
else{dispatch.elementMouseout({mouseX:mouseX,mouseY:mouseY});layer.renderGuideLine(null);tooltip.hidden(true);return;}}
else{pointXValue=xScale.invert(mouseX);}
dispatch.elementMousemove({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});if(d3.event.type==="dblclick"){dispatch.elementDblclick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='click'){dispatch.elementClick({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='mousedown'){dispatch.elementMouseDown({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}
if(d3.event.type==='mouseup'){dispatch.elementMouseUp({mouseX:mouseX,mouseY:mouseY,pointXValue:pointXValue});}}
svgContainer.on("touchmove",mouseHandler).on("mousemove",mouseHandler,true).on("mouseout",mouseHandler,true).on("mousedown",mouseHandler,true).on("mouseup",mouseHandler,true).on("dblclick",mouseHandler).on("click",mouseHandler);layer.guideLine=null;layer.renderGuideLine=function(x){if(!showGuideLine)return;if(layer.guideLine&&layer.guideLine.attr("x1")===x)return;nv.dom.write(function(){var line=wrap.select(".nv-interactiveGuideLine").selectAll("line").data((x!=null)?[nv.utils.NaNtoZero(x)]:[],String);line.enter().append("line").attr("class","nv-guideline").attr("x1",function(d){return d;}).attr("x2",function(d){return d;}).attr("y1",availableHeight).attr("y2",0);line.exit().remove();});}});}
layer.dispatch=dispatch;layer.tooltip=tooltip;layer.margin=function(_){if(!arguments.length)return margin;margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.left=typeof _.left!='undefined'?_.left:margin.left;return layer;};layer.width=function(_){if(!arguments.length)return width;width=_;return layer;};layer.height=function(_){if(!arguments.length)return height;height=_;return layer;};layer.xScale=function(_){if(!arguments.length)return xScale;xScale=_;return layer;};layer.showGuideLine=function(_){if(!arguments.length)return showGuideLine;showGuideLine=_;return layer;};layer.svgContainer=function(_){if(!arguments.length)return svgContainer;svgContainer=_;return layer;};return layer;};nv.interactiveBisect=function(values,searchVal,xAccessor){"use strict";if(!(values instanceof Array)){return null;}
var _xAccessor;if(typeof xAccessor!=='function'){_xAccessor=function(d){return d.x;}}else{_xAccessor=xAccessor;}
var _cmp=function(d,v){return _xAccessor(d)-v;};var bisect=d3.bisector(_cmp).left;var index=d3.max([0,bisect(values,searchVal)-1]);var currentValue=_xAccessor(values[index]);if(typeof currentValue==='undefined'){currentValue=index;}
if(currentValue===searchVal){return index;}
var nextIndex=d3.min([index+1,values.length-1]);var nextValue=_xAccessor(values[nextIndex]);if(typeof nextValue==='undefined'){nextValue=nextIndex;}
if(Math.abs(nextValue-searchVal)>=Math.abs(currentValue-searchVal)){return index;}else{return nextIndex}};nv.nearestValueIndex=function(values,searchVal,threshold){"use strict";var yDistMax=Infinity,indexToHighlight=null;values.forEach(function(d,i){var delta=Math.abs(searchVal-d);if(d!=null&&delta<=yDistMax&&delta<threshold){yDistMax=delta;indexToHighlight=i;}});return indexToHighlight;};nv.models.tooltip=function(){"use strict";var id="nvtooltip-"+Math.floor(Math.random()*100000),data=null,gravity='w',distance=25,snapDistance=0,classes=null,chartContainer=null,hidden=true,hideDelay=200,tooltip=null,lastPosition={left:null,top:null},enabled=true,duration=100,headerEnabled=true,nvPointerEventsClass="nv-pointer-events-none";var position=function(){return{left:d3.event!==null?d3.event.clientX:0,top:d3.event!==null?d3.event.clientY:0};};var valueFormatter=function(d,i){return d;};var headerFormatter=function(d){return d;};var keyFormatter=function(d,i){return d;};var contentGenerator=function(d){if(d===null){return'';}
var table=d3.select(document.createElement("table"));if(headerEnabled){var theadEnter=table.selectAll("thead").data([d]).enter().append("thead");theadEnter.append("tr").append("td").attr("colspan",3).append("strong").classed("x-value",true).html(headerFormatter(d.value));}
var tbodyEnter=table.selectAll("tbody").data([d]).enter().append("tbody");var trowEnter=tbodyEnter.selectAll("tr").data(function(p){return p.series}).enter().append("tr").classed("highlight",function(p){return p.highlight});trowEnter.append("td").classed("legend-color-guide",true).append("div").style("background-color",function(p){return p.color});trowEnter.append("td").classed("key",true).classed("total",function(p){return!!p.total}).html(function(p,i){return keyFormatter(p.key,i)});trowEnter.append("td").classed("value",true).html(function(p,i){return valueFormatter(p.value,i)});trowEnter.selectAll("td").each(function(p){if(p.highlight){var opacityScale=d3.scale.linear().domain([0,1]).range(["#fff",p.color]);var opacity=0.6;d3.select(this).style("border-bottom-color",opacityScale(opacity)).style("border-top-color",opacityScale(opacity));}});var html=table.node().outerHTML;if(d.footer!==undefined)
html+="<div class='footer'>"+d.footer+"</div>";return html;};var dataSeriesExists=function(d){if(d&&d.series){if(nv.utils.isArray(d.series)){return true;}
if(nv.utils.isObject(d.series)){d.series=[d.series];return true;}}
return false;};var calcGravityOffset=function(pos){var height=tooltip.node().offsetHeight,width=tooltip.node().offsetWidth,clientWidth=document.documentElement.clientWidth,clientHeight=document.documentElement.clientHeight,left,top,tmp;switch(gravity){case'e':left=-width-distance;top=-(height/2);if(pos.left+left<0)left=distance;if((tmp=pos.top+top)<0)top-=tmp;if((tmp=pos.top+top+height)>clientHeight)top-=tmp-clientHeight;break;case'w':left=distance;top=-(height/2);if(pos.left+left+width>clientWidth)left=-width-distance;if((tmp=pos.top+top)<0)top-=tmp;if((tmp=pos.top+top+height)>clientHeight)top-=tmp-clientHeight;break;case'n':left=-(width/2)-5;top=distance;if(pos.top+top+height>clientHeight)top=-height-distance;if((tmp=pos.left+left)<0)left-=tmp;if((tmp=pos.left+left+width)>clientWidth)left-=tmp-clientWidth;break;case's':left=-(width/2);top=-height-distance;if(pos.top+top<0)top=distance;if((tmp=pos.left+left)<0)left-=tmp;if((tmp=pos.left+left+width)>clientWidth)left-=tmp-clientWidth;break;case'center':left=-(width/2);top=-(height/2);break;default:left=0;top=0;break;}
return{'left':left,'top':top};};var positionTooltip=function(){nv.dom.read(function(){var pos=position(),gravityOffset=calcGravityOffset(pos),left=pos.left+gravityOffset.left,top=pos.top+gravityOffset.top;if(hidden){tooltip.interrupt().transition().delay(hideDelay).duration(0).style('opacity',0);}else{var old_translate='translate('+lastPosition.left+'px, '+lastPosition.top+'px)';var new_translate='translate('+left+'px, '+top+'px)';var translateInterpolator=d3.interpolateString(old_translate,new_translate);var is_hidden=tooltip.style('opacity')<0.1;tooltip.interrupt().transition().duration(is_hidden?0:duration).styleTween('transform',function(d){return translateInterpolator;},'important').styleTween('-webkit-transform',function(d){return translateInterpolator;}).style('-ms-transform',new_translate).style('opacity',1);}
lastPosition.left=left;lastPosition.top=top;});};function initTooltip(){if(!tooltip||!tooltip.node()){var container=chartContainer?chartContainer:document.body;var data=[1];tooltip=d3.select(container).selectAll('.nvtooltip').data(data);tooltip.enter().append('div').attr("class","nvtooltip "+(classes?classes:"xy-tooltip")).attr("id",id).style("top",0).style("left",0).style('opacity',0).style('position','fixed').selectAll("div, table, td, tr").classed(nvPointerEventsClass,true).classed(nvPointerEventsClass,true);tooltip.exit().remove()}}
function nvtooltip(){if(!enabled)return;if(!dataSeriesExists(data))return;nv.dom.write(function(){initTooltip();var newContent=contentGenerator(data);if(newContent){tooltip.node().innerHTML=newContent;}
positionTooltip();});return nvtooltip;}
nvtooltip.nvPointerEventsClass=nvPointerEventsClass;nvtooltip.options=nv.utils.optionsFunc.bind(nvtooltip);nvtooltip._options=Object.create({},{duration:{get:function(){return duration;},set:function(_){duration=_;}},gravity:{get:function(){return gravity;},set:function(_){gravity=_;}},distance:{get:function(){return distance;},set:function(_){distance=_;}},snapDistance:{get:function(){return snapDistance;},set:function(_){snapDistance=_;}},classes:{get:function(){return classes;},set:function(_){classes=_;}},chartContainer:{get:function(){return chartContainer;},set:function(_){chartContainer=_;}},enabled:{get:function(){return enabled;},set:function(_){enabled=_;}},hideDelay:{get:function(){return hideDelay;},set:function(_){hideDelay=_;}},contentGenerator:{get:function(){return contentGenerator;},set:function(_){contentGenerator=_;}},valueFormatter:{get:function(){return valueFormatter;},set:function(_){valueFormatter=_;}},headerFormatter:{get:function(){return headerFormatter;},set:function(_){headerFormatter=_;}},keyFormatter:{get:function(){return keyFormatter;},set:function(_){keyFormatter=_;}},headerEnabled:{get:function(){return headerEnabled;},set:function(_){headerEnabled=_;}},position:{get:function(){return position;},set:function(_){position=_;}},fixedTop:{get:function(){return null;},set:function(_){nv.deprecated('fixedTop','feature removed after 1.8.1');}},offset:{get:function(){return{left:0,top:0};},set:function(_){nv.deprecated('offset','use chart.tooltip.distance() instead');}},hidden:{get:function(){return hidden;},set:function(_){if(hidden!=_){hidden=!!_;nvtooltip();}}},data:{get:function(){return data;},set:function(_){if(_.point){_.value=_.point.x;_.series=_.series||{};_.series.value=_.point.y;_.series.color=_.point.color||_.series.color;}
data=_;}},node:{get:function(){return tooltip.node();},set:function(_){}},id:{get:function(){return id;},set:function(_){}}});nv.utils.initOptions(nvtooltip);return nvtooltip;};nv.utils.windowSize=function(){var size={width:640,height:480};if(window.innerWidth&&window.innerHeight){size.width=window.innerWidth;size.height=window.innerHeight;return(size);}
if(document.compatMode=='CSS1Compat'&&document.documentElement&&document.documentElement.offsetWidth){size.width=document.documentElement.offsetWidth;size.height=document.documentElement.offsetHeight;return(size);}
if(document.body&&document.body.offsetWidth){size.width=document.body.offsetWidth;size.height=document.body.offsetHeight;return(size);}
return(size);};nv.utils.isArray=Array.isArray;nv.utils.isObject=function(a){return a!==null&&typeof a==='object';};nv.utils.isFunction=function(a){return typeof a==='function';};nv.utils.isDate=function(a){return toString.call(a)==='[object Date]';};nv.utils.isNumber=function(a){return!isNaN(a)&&typeof a==='number';};nv.utils.windowResize=function(handler){if(window.addEventListener){window.addEventListener('resize',handler);}else{nv.log("ERROR: Failed to bind to window.resize with: ",handler);}
return{callback:handler,clear:function(){window.removeEventListener('resize',handler);}}};nv.utils.getColor=function(color){if(color===undefined){return nv.utils.defaultColor();}else if(nv.utils.isArray(color)){var color_scale=d3.scale.ordinal().range(color);return function(d,i){var key=i===undefined?d:i;return d.color||color_scale(key);};}else{return color;}};nv.utils.defaultColor=function(){return nv.utils.getColor(d3.scale.category20().range());};nv.utils.customTheme=function(dictionary,getKey,defaultColors){getKey=getKey||function(series){return series.key};defaultColors=defaultColors||d3.scale.category20().range();var defIndex=defaultColors.length;return function(series,index){var key=getKey(series);if(nv.utils.isFunction(dictionary[key])){return dictionary[key]();}else if(dictionary[key]!==undefined){return dictionary[key];}else{if(!defIndex){defIndex=defaultColors.length;}
defIndex=defIndex-1;return defaultColors[defIndex];}};};nv.utils.pjax=function(links,content){var load=function(href){d3.html(href,function(fragment){var target=d3.select(content).node();target.parentNode.replaceChild(d3.select(fragment).select(content).node(),target);nv.utils.pjax(links,content);});};d3.selectAll(links).on("click",function(){history.pushState(this.href,this.textContent,this.href);load(this.href);d3.event.preventDefault();});d3.select(window).on("popstate",function(){if(d3.event.state){load(d3.event.state);}});};nv.utils.calcApproxTextWidth=function(svgTextElem){if(nv.utils.isFunction(svgTextElem.style)&&nv.utils.isFunction(svgTextElem.text)){var fontSize=parseInt(svgTextElem.style("font-size").replace("px",""),10);var textLength=svgTextElem.text().length;return nv.utils.NaNtoZero(textLength*fontSize*0.5);}
return 0;};nv.utils.NaNtoZero=function(n){if(!nv.utils.isNumber(n)||isNaN(n)||n===null||n===Infinity||n===-Infinity){return 0;}
return n;};d3.selection.prototype.watchTransition=function(renderWatch){var args=[this].concat([].slice.call(arguments,1));return renderWatch.transition.apply(renderWatch,args);};nv.utils.renderWatch=function(dispatch,duration){if(!(this instanceof nv.utils.renderWatch)){return new nv.utils.renderWatch(dispatch,duration);}
var _duration=duration!==undefined?duration:250;var renderStack=[];var self=this;this.models=function(models){models=[].slice.call(arguments,0);models.forEach(function(model){model.__rendered=false;(function(m){m.dispatch.on('renderEnd',function(arg){m.__rendered=true;self.renderEnd('model');});})(model);if(renderStack.indexOf(model)<0){renderStack.push(model);}});return this;};this.reset=function(duration){if(duration!==undefined){_duration=duration;}
renderStack=[];};this.transition=function(selection,args,duration){args=arguments.length>1?[].slice.call(arguments,1):[];if(args.length>1){duration=args.pop();}else{duration=_duration!==undefined?_duration:250;}
selection.__rendered=false;if(renderStack.indexOf(selection)<0){renderStack.push(selection);}
if(duration===0){selection.__rendered=true;selection.delay=function(){return this;};selection.duration=function(){return this;};return selection;}else{if(selection.length===0){selection.__rendered=true;}else if(selection.every(function(d){return!d.length;})){selection.__rendered=true;}else{selection.__rendered=false;}
var n=0;return selection.transition().duration(duration).each(function(){++n;}).each('end',function(d,i){if(--n===0){selection.__rendered=true;self.renderEnd.apply(this,args);}});}};this.renderEnd=function(){if(renderStack.every(function(d){return d.__rendered;})){renderStack.forEach(function(d){d.__rendered=false;});dispatch.renderEnd.apply(this,arguments);}}};nv.utils.deepExtend=function(dst){var sources=arguments.length>1?[].slice.call(arguments,1):[];sources.forEach(function(source){for(var key in source){var isArray=nv.utils.isArray(dst[key]);var isObject=nv.utils.isObject(dst[key]);var srcObj=nv.utils.isObject(source[key]);if(isObject&&!isArray&&srcObj){nv.utils.deepExtend(dst[key],source[key]);}else{dst[key]=source[key];}}});};nv.utils.state=function(){if(!(this instanceof nv.utils.state)){return new nv.utils.state();}
var state={};var _self=this;var _setState=function(){};var _getState=function(){return{};};var init=null;var changed=null;this.dispatch=d3.dispatch('change','set');this.dispatch.on('set',function(state){_setState(state,true);});this.getter=function(fn){_getState=fn;return this;};this.setter=function(fn,callback){if(!callback){callback=function(){};}
_setState=function(state,update){fn(state);if(update){callback();}};return this;};this.init=function(state){init=init||{};nv.utils.deepExtend(init,state);};var _set=function(){var settings=_getState();if(JSON.stringify(settings)===JSON.stringify(state)){return false;}
for(var key in settings){if(state[key]===undefined){state[key]={};}
state[key]=settings[key];changed=true;}
return true;};this.update=function(){if(init){_setState(init,false);init=null;}
if(_set.call(this)){this.dispatch.change(state);}};};nv.utils.optionsFunc=function(args){if(args){d3.map(args).forEach((function(key,value){if(nv.utils.isFunction(this[key])){this[key](value);}}).bind(this));}
return this;};nv.utils.calcTicksX=function(numTicks,data){var numValues=1;var i=0;for(i;i<data.length;i+=1){var stream_len=data[i]&&data[i].values?data[i].values.length:0;numValues=stream_len>numValues?stream_len:numValues;}
nv.log("Requested number of ticks: ",numTicks);nv.log("Calculated max values to be: ",numValues);numTicks=numTicks>numValues?numTicks=numValues-1:numTicks;numTicks=numTicks<1?1:numTicks;numTicks=Math.floor(numTicks);nv.log("Calculating tick count as: ",numTicks);return numTicks;};nv.utils.calcTicksY=function(numTicks,data){return nv.utils.calcTicksX(numTicks,data);};nv.utils.initOption=function(chart,name){if(chart._calls&&chart._calls[name]){chart[name]=chart._calls[name];}else{chart[name]=function(_){if(!arguments.length)return chart._options[name];chart._overrides[name]=true;chart._options[name]=_;return chart;};chart['_'+name]=function(_){if(!arguments.length)return chart._options[name];if(!chart._overrides[name]){chart._options[name]=_;}
return chart;}}};nv.utils.initOptions=function(chart){chart._overrides=chart._overrides||{};var ops=Object.getOwnPropertyNames(chart._options||{});var calls=Object.getOwnPropertyNames(chart._calls||{});ops=ops.concat(calls);for(var i in ops){nv.utils.initOption(chart,ops[i]);}};nv.utils.inheritOptionsD3=function(target,d3_source,oplist){target._d3options=oplist.concat(target._d3options||[]);oplist.unshift(d3_source);oplist.unshift(target);d3.rebind.apply(this,oplist);};nv.utils.arrayUnique=function(a){return a.sort().filter(function(item,pos){return!pos||item!=a[pos-1];});};nv.utils.symbolMap=d3.map();nv.utils.symbol=function(){var type,size=64;function symbol(d,i){var t=type.call(this,d,i);var s=size.call(this,d,i);if(d3.svg.symbolTypes.indexOf(t)!==-1){return d3.svg.symbol().type(t).size(s)();}else{return nv.utils.symbolMap.get(t)(s);}}
symbol.type=function(_){if(!arguments.length)return type;type=d3.functor(_);return symbol;};symbol.size=function(_){if(!arguments.length)return size;size=d3.functor(_);return symbol;};return symbol;};nv.utils.inheritOptions=function(target,source){var ops=Object.getOwnPropertyNames(source._options||{});var calls=Object.getOwnPropertyNames(source._calls||{});var inherited=source._inherited||[];var d3ops=source._d3options||[];var args=ops.concat(calls).concat(inherited).concat(d3ops);args.unshift(source);args.unshift(target);d3.rebind.apply(this,args);target._inherited=nv.utils.arrayUnique(ops.concat(calls).concat(inherited).concat(ops).concat(target._inherited||[]));target._d3options=nv.utils.arrayUnique(d3ops.concat(target._d3options||[]));};nv.utils.initSVG=function(svg){svg.classed({'nvd3-svg':true});};nv.utils.sanitizeHeight=function(height,container){return(height||parseInt(container.style('height'),10)||400);};nv.utils.sanitizeWidth=function(width,container){return(width||parseInt(container.style('width'),10)||960);};nv.utils.availableHeight=function(height,container,margin){return Math.max(0,nv.utils.sanitizeHeight(height,container)-margin.top-margin.bottom);};nv.utils.availableWidth=function(width,container,margin){return Math.max(0,nv.utils.sanitizeWidth(width,container)-margin.left-margin.right);};nv.utils.noData=function(chart,container){var opt=chart.options(),margin=opt.margin(),noData=opt.noData(),data=(noData==null)?["No Data Available."]:[noData],height=nv.utils.availableHeight(null,container,margin),width=nv.utils.availableWidth(null,container,margin),x=margin.left+width/2,y=margin.top+height/2;container.selectAll('g').remove();var noDataText=container.selectAll('.nv-noData').data(data);noDataText.enter().append('text').attr('class','nvd3 nv-noData').attr('dy','-.7em').style('text-anchor','middle');noDataText.attr('x',x).attr('y',y).text(function(t){return t;});};nv.utils.wrapTicks=function(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");while(word=words.pop()){line.push(word);tspan.text(line.join(" "));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(" "));line=[word];tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word);}}});};nv.utils.arrayEquals=function(array1,array2){if(array1===array2)
return true;if(!array1||!array2)
return false;if(array1.length!=array2.length)
return false;for(var i=0,l=array1.length;i<l;i++){if(array1[i]instanceof Array&&array2[i]instanceof Array){if(!nv.arrayEquals(array1[i],array2[i]))
return false;}else if(array1[i]!=array2[i]){return false;}}
return true;};nv.models.axis=function(){"use strict";var axis=d3.svg.axis();var scale=d3.scale.linear();var margin={top:0,right:0,bottom:0,left:0},width=75,height=60,axisLabelText=null,showMaxMin=true,rotateLabels=0,rotateYLabel=true,staggerLabels=false,isOrdinal=false,ticks=null,axisLabelDistance=0,fontSize=undefined,duration=250,dispatch=d3.dispatch('renderEnd');axis.scale(scale).orient('bottom').tickFormat(function(d){return d});var scale0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-wrap.nv-axis').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-axis');var gEnter=wrapEnter.append('g');var g=wrap.select('g');if(ticks!==null)
axis.ticks(ticks);else if(axis.orient()=='top'||axis.orient()=='bottom')
axis.ticks(Math.abs(scale.range()[1]-scale.range()[0])/100);g.watchTransition(renderWatch,'axis').call(axis);scale0=scale0||axis.scale();var fmt=axis.tickFormat();if(fmt==null){fmt=scale0.tickFormat();}
var axisLabel=g.selectAll('text.nv-axislabel').data([axisLabelText||null]);axisLabel.exit().remove();if(fontSize!==undefined){g.selectAll('g').select("text").style('font-size',fontSize);}
var xLabelMargin;var axisMaxMin;var w;switch(axis.orient()){case'top':axisLabel.enter().append('text').attr('class','nv-axislabel');w=0;if(scale.range().length===1){w=isOrdinal?scale.range()[0]*2+scale.rangeBand():0;}else if(scale.range().length===2){w=isOrdinal?scale.range()[0]+scale.range()[1]+scale.rangeBand():scale.range()[1];}else if(scale.range().length>2){w=scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]);};axisLabel.attr('text-anchor','middle').attr('y',0).attr('x',w/2);if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-x',(i==0?'nv-axisMin-x':'nv-axisMax-x')].join(' ')}).append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero(scale(d))+',0)'}).select('text').attr('dy','-0.5em').attr('y',-axis.tickPadding()).attr('text-anchor','middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max top').attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero(scale.range()[i])+',0)'});}
break;case'bottom':xLabelMargin=axisLabelDistance+36;var maxTextWidth=30;var textHeight=0;var xTicks=g.selectAll('g').select("text");var rotateLabelsRule='';if(rotateLabels%360){xTicks.attr('transform','');xTicks.each(function(d,i){var box=this.getBoundingClientRect();var width=box.width;textHeight=box.height;if(width>maxTextWidth)maxTextWidth=width;});rotateLabelsRule='rotate('+rotateLabels+' 0,'+(textHeight/2+axis.tickPadding())+')';var sin=Math.abs(Math.sin(rotateLabels*Math.PI/180));xLabelMargin=(sin?sin*maxTextWidth:maxTextWidth)+30;xTicks.attr('transform',rotateLabelsRule).style('text-anchor',rotateLabels%360>0?'start':'end');}else{if(staggerLabels){xTicks.attr('transform',function(d,i){return'translate(0,'+(i%2==0?'0':'12')+')'});}else{xTicks.attr('transform',"translate(0,0)");}}
axisLabel.enter().append('text').attr('class','nv-axislabel');w=0;if(scale.range().length===1){w=isOrdinal?scale.range()[0]*2+scale.rangeBand():0;}else if(scale.range().length===2){w=isOrdinal?scale.range()[0]+scale.range()[1]+scale.rangeBand():scale.range()[1];}else if(scale.range().length>2){w=scale.range()[scale.range().length-1]+(scale.range()[1]-scale.range()[0]);};axisLabel.attr('text-anchor','middle').attr('y',xLabelMargin).attr('x',w/2);if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data([scale.domain()[0],scale.domain()[scale.domain().length-1]]);axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-x',(i==0?'nv-axisMin-x':'nv-axisMax-x')].join(' ')}).append('text');axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero((scale(d)+(isOrdinal?scale.rangeBand()/2:0)))+',0)'}).select('text').attr('dy','.71em').attr('y',axis.tickPadding()).attr('transform',rotateLabelsRule).style('text-anchor',rotateLabels?(rotateLabels%360>0?'start':'end'):'middle').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max bottom').attr('transform',function(d,i){return'translate('+nv.utils.NaNtoZero((scale(d)+(isOrdinal?scale.rangeBand()/2:0)))+',0)'});}
break;case'right':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'begin').attr('transform',rotateYLabel?'rotate(90)':'').attr('y',rotateYLabel?(-Math.max(margin.right,width)+12):-10).attr('x',rotateYLabel?(d3.max(scale.range())/2):axis.tickPadding());if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-y',(i==0?'nv-axisMin-y':'nv-axisMax-y')].join(' ')}).append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale(d))+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',axis.tickPadding()).style('text-anchor','start').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max right').attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale.range()[i])+')'}).select('text').style('opacity',1);}
break;case'left':axisLabel.enter().append('text').attr('class','nv-axislabel');axisLabel.style('text-anchor',rotateYLabel?'middle':'end').attr('transform',rotateYLabel?'rotate(-90)':'').attr('y',rotateYLabel?(-Math.max(margin.left,width)+25-(axisLabelDistance||0)):-10).attr('x',rotateYLabel?(-d3.max(scale.range())/2):-axis.tickPadding());if(showMaxMin){axisMaxMin=wrap.selectAll('g.nv-axisMaxMin').data(scale.domain());axisMaxMin.enter().append('g').attr('class',function(d,i){return['nv-axisMaxMin','nv-axisMaxMin-y',(i==0?'nv-axisMin-y':'nv-axisMax-y')].join(' ')}).append('text').style('opacity',0);axisMaxMin.exit().remove();axisMaxMin.attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale0(d))+')'}).select('text').attr('dy','.32em').attr('y',0).attr('x',-axis.tickPadding()).attr('text-anchor','end').text(function(d,i){var v=fmt(d);return(''+v).match('NaN')?'':v;});axisMaxMin.watchTransition(renderWatch,'min-max right').attr('transform',function(d,i){return'translate(0,'+nv.utils.NaNtoZero(scale.range()[i])+')'}).select('text').style('opacity',1);}
break;}
axisLabel.text(function(d){return d});if(showMaxMin&&(axis.orient()==='left'||axis.orient()==='right')){g.selectAll('g').each(function(d,i){d3.select(this).select('text').attr('opacity',1);if(scale(d)<scale.range()[1]+10||scale(d)>scale.range()[0]-10){if(d>1e-10||d<-1e-10)
d3.select(this).attr('opacity',0);d3.select(this).select('text').attr('opacity',0);}});if(scale.domain()[0]==scale.domain()[1]&&scale.domain()[0]==0){wrap.selectAll('g.nv-axisMaxMin').style('opacity',function(d,i){return!i?1:0});}}
if(showMaxMin&&(axis.orient()==='top'||axis.orient()==='bottom')){var maxMinRange=[];wrap.selectAll('g.nv-axisMaxMin').each(function(d,i){try{if(i)
maxMinRange.push(scale(d)-this.getBoundingClientRect().width-4);else
maxMinRange.push(scale(d)+this.getBoundingClientRect().width+4)}catch(err){if(i)
maxMinRange.push(scale(d)-4);else
maxMinRange.push(scale(d)+4);}});g.selectAll('g').each(function(d,i){if(scale(d)<maxMinRange[0]||scale(d)>maxMinRange[1]){if(d>1e-10||d<-1e-10)
d3.select(this).remove();else
d3.select(this).select('text').remove();}});}
g.selectAll('.tick').filter(function(d){return!parseFloat(Math.round(d*100000)/1000000)&&(d!==undefined)}).classed('zero',true);scale0=scale.copy();});renderWatch.renderEnd('axis immediate');return chart;}
chart.axis=axis;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{axisLabelDistance:{get:function(){return axisLabelDistance;},set:function(_){axisLabelDistance=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},rotateYLabel:{get:function(){return rotateYLabel;},set:function(_){rotateYLabel=_;}},showMaxMin:{get:function(){return showMaxMin;},set:function(_){showMaxMin=_;}},axisLabel:{get:function(){return axisLabelText;},set:function(_){axisLabelText=_;}},height:{get:function(){return height;},set:function(_){height=_;}},ticks:{get:function(){return ticks;},set:function(_){ticks=_;}},width:{get:function(){return width;},set:function(_){width=_;}},fontSize:{get:function(){return fontSize;},set:function(_){fontSize=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},scale:{get:function(){return scale;},set:function(_){scale=_;axis.scale(scale);isOrdinal=typeof scale.rangeBands==='function';nv.utils.inheritOptionsD3(chart,scale,['domain','range','rangeBand','rangeBands']);}}});nv.utils.initOptions(chart);nv.utils.inheritOptionsD3(chart,axis,['orient','tickValues','tickSubdivide','tickSize','tickPadding','tickFormat']);nv.utils.inheritOptionsD3(chart,scale,['domain','range','rangeBand','rangeBands']);return chart;};nv.models.scatter=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=null,height=null,color=nv.utils.defaultColor(),id=Math.floor(Math.random()*100000),container=null,x=d3.scale.linear(),y=d3.scale.linear(),z=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},getSize=function(d){return d.size||1},getShape=function(d){return d.shape||'circle'},forceX=[],forceY=[],forceSize=[],interactive=true,pointActive=function(d){return!d.notActive},padData=false,padDataOuter=.1,clipEdge=false,clipVoronoi=true,showVoronoi=false,clipRadius=function(){return 25},xDomain=null,yDomain=null,xRange=null,yRange=null,sizeDomain=null,sizeRange=null,singlePoint=false,dispatch=d3.dispatch('elementClick','elementDblClick','elementMouseover','elementMouseout','renderEnd'),useVoronoi=true,duration=250,interactiveUpdateDelay=300,showLabels=false;var x0,y0,z0,timeoutID,needsUpdate=false,renderWatch=nv.utils.renderWatch(dispatch,duration),_sizeRange_def=[16,256],_caches;function getCache(d){var cache,i;cache=_caches=_caches||{};i=d[0].series;cache=cache[i]=cache[i]||{};i=d[1];cache=cache[i]=cache[i]||{};return cache;}
function getDiffs(d){var i,key,point=d[0],cache=getCache(d),diffs=false;for(i=1;i<arguments.length;i++){key=arguments[i];if(cache[key]!==point[key]||!cache.hasOwnProperty(key)){cache[key]=point[key];diffs=true;}}
return diffs;}
function chart(selection){renderWatch.reset();selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var logScale=chart.yScale().name===d3.scale.log().name?true:false;var seriesData=(xDomain&&yDomain&&sizeDomain)?[]:d3.merge(data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),size:getSize(d,i)}})}));x.domain(xDomain||d3.extent(seriesData.map(function(d){return d.x;}).concat(forceX)))
if(padData&&data[0])
x.range(xRange||[(availableWidth*padDataOuter+availableWidth)/(2*data[0].values.length),availableWidth-availableWidth*(1+padDataOuter)/(2*data[0].values.length)]);else
x.range(xRange||[0,availableWidth]);if(logScale){var min=d3.min(seriesData.map(function(d){if(d.y!==0)return d.y;}));y.clamp(true).domain(yDomain||d3.extent(seriesData.map(function(d){if(d.y!==0)return d.y;else return min*0.1;}).concat(forceY))).range(yRange||[availableHeight,0]);}else{y.domain(yDomain||d3.extent(seriesData.map(function(d){return d.y;}).concat(forceY))).range(yRange||[availableHeight,0]);}
z.domain(sizeDomain||d3.extent(seriesData.map(function(d){return d.size}).concat(forceSize))).range(sizeRange||_sizeRange_def);singlePoint=x.domain()[0]===x.domain()[1]||y.domain()[0]===y.domain()[1];if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]-y.domain()[0]*0.01,y.domain()[1]+y.domain()[1]*0.01]):y.domain([-1,1]);if(isNaN(x.domain()[0])){x.domain([-1,1]);}
if(isNaN(y.domain()[0])){y.domain([-1,1]);}
x0=x0||x;y0=y0||y;z0=z0||z;var scaleDiff=x(1)!==x0(1)||y(1)!==y0(1)||z(1)!==z0(1);var wrap=container.selectAll('g.nv-wrap.nv-scatter').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-scatter nv-chart-'+id);var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');wrap.classed('nv-single-point',singlePoint);gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-point-paths');wrapEnter.append('g').attr('class','nv-point-clips');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',(availableHeight>0)?availableHeight:0);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');function updateInteractiveLayer(){needsUpdate=false;if(!interactive)return false;if(useVoronoi===true){var vertices=d3.merge(data.map(function(group,groupIndex){return group.values.map(function(point,pointIndex){var pX=getX(point,pointIndex);var pY=getY(point,pointIndex);return[nv.utils.NaNtoZero(x(pX))+Math.random()*1e-4,nv.utils.NaNtoZero(y(pY))+Math.random()*1e-4,groupIndex,pointIndex,point];}).filter(function(pointArray,pointIndex){return pointActive(pointArray[4],pointIndex);})}));if(vertices.length==0)return false;if(vertices.length<3){vertices.push([x.range()[0]-20,y.range()[0]-20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]+20,null,null]);vertices.push([x.range()[0]-20,y.range()[0]+20,null,null]);vertices.push([x.range()[1]+20,y.range()[1]-20,null,null]);}
var bounds=d3.geom.polygon([[-10,-10],[-10,height+10],[width+10,height+10],[width+10,-10]]);var voronoi=d3.geom.voronoi(vertices).map(function(d,i){return{'data':bounds.clip(d),'series':vertices[i][2],'point':vertices[i][3]}});wrap.select('.nv-point-paths').selectAll('path').remove();var pointPaths=wrap.select('.nv-point-paths').selectAll('path').data(voronoi);var vPointPaths=pointPaths.enter().append("svg:path").attr("d",function(d){if(!d||!d.data||d.data.length===0)
return'M 0 0';else
return"M"+d.data.join(",")+"Z";}).attr("id",function(d,i){return"nv-path-"+i;}).attr("clip-path",function(d,i){return"url(#nv-clip-"+id+"-"+i+")";});if(showVoronoi){vPointPaths.style("fill",d3.rgb(230,230,230)).style('fill-opacity',0.4).style('stroke-opacity',1).style("stroke",d3.rgb(200,200,200));}
if(clipVoronoi){wrap.select('.nv-point-clips').selectAll('*').remove();var pointClips=wrap.select('.nv-point-clips').selectAll('clipPath').data(vertices);var vPointClips=pointClips.enter().append("svg:clipPath").attr("id",function(d,i){return"nv-clip-"+id+"-"+i;}).append("svg:circle").attr('cx',function(d){return d[0];}).attr('cy',function(d){return d[1];}).attr('r',clipRadius);}
var mouseEventCallback=function(d,mDispatch){if(needsUpdate)return 0;var series=data[d.series];if(series===undefined)return;var point=series.values[d.point];point['color']=color(series,d.series);point['x']=getX(point);point['y']=getY(point);var box=container.node().getBoundingClientRect();var scrollTop=window.pageYOffset||document.documentElement.scrollTop;var scrollLeft=window.pageXOffset||document.documentElement.scrollLeft;var pos={left:x(getX(point,d.point))+box.left+scrollLeft+margin.left+10,top:y(getY(point,d.point))+box.top+scrollTop+margin.top+10};mDispatch({point:point,series:series,pos:pos,relativePos:[x(getX(point,d.point))+margin.left,y(getY(point,d.point))+margin.top],seriesIndex:d.series,pointIndex:d.point});};pointPaths.on('click',function(d){mouseEventCallback(d,dispatch.elementClick);}).on('dblclick',function(d){mouseEventCallback(d,dispatch.elementDblClick);}).on('mouseover',function(d){mouseEventCallback(d,dispatch.elementMouseover);}).on('mouseout',function(d,i){mouseEventCallback(d,dispatch.elementMouseout);});}else{wrap.select('.nv-groups').selectAll('.nv-group').selectAll('.nv-point').on('click',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('dblclick',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementDblClick({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i});}).on('mouseover',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseover({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i,color:color(d,i)});}).on('mouseout',function(d,i){if(needsUpdate||!data[d.series])return 0;var series=data[d.series],point=series.values[i];dispatch.elementMouseout({point:point,series:series,pos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],relativePos:[x(getX(point,i))+margin.left,y(getY(point,i))+margin.top],seriesIndex:d.series,pointIndex:i,color:color(d,i)});});}}
needsUpdate=true;var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return(d.classed||'')+' nv-group nv-series-'+i;}).classed('nv-noninteractive',!interactive).classed('hover',function(d){return d.hover});groups.watchTransition(renderWatch,'scatter: groups').style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)}).style('stroke-opacity',1).style('fill-opacity',.5);var points=groups.selectAll('path.nv-point').data(function(d){return d.values.map(function(point,pointIndex){return[point,pointIndex]}).filter(function(pointArray,pointIndex){return pointActive(pointArray[0],pointIndex)})});points.enter().append('path').attr('class',function(d){return'nv-point nv-point-'+d[1];}).style('fill',function(d){return d.color}).style('stroke',function(d){return d.color}).attr('transform',function(d){return'translate('+nv.utils.NaNtoZero(x0(getX(d[0],d[1])))+','+nv.utils.NaNtoZero(y0(getY(d[0],d[1])))+')'}).attr('d',nv.utils.symbol().type(function(d){return getShape(d[0]);}).size(function(d){return z(getSize(d[0],d[1]))}));points.exit().remove();groups.exit().selectAll('path.nv-point').watchTransition(renderWatch,'scatter exit').attr('transform',function(d){return'translate('+nv.utils.NaNtoZero(x(getX(d[0],d[1])))+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')'}).remove();points.filter(function(d){return scaleDiff||getDiffs(d,'x','y');}).watchTransition(renderWatch,'scatter points').attr('transform',function(d){return'translate('+nv.utils.NaNtoZero(x(getX(d[0],d[1])))+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')'});points.filter(function(d){return scaleDiff||getDiffs(d,'shape','size');}).watchTransition(renderWatch,'scatter points').attr('d',nv.utils.symbol().type(function(d){return getShape(d[0]);}).size(function(d){return z(getSize(d[0],d[1]))}));if(showLabels)
{var titles=groups.selectAll('.nv-label').data(function(d){return d.values.map(function(point,pointIndex){return[point,pointIndex]}).filter(function(pointArray,pointIndex){return pointActive(pointArray[0],pointIndex)})});titles.enter().append('text').style('fill',function(d,i){return d.color}).style('stroke-opacity',0).style('fill-opacity',1).attr('transform',function(d){var dx=nv.utils.NaNtoZero(x0(getX(d[0],d[1])))+Math.sqrt(z(getSize(d[0],d[1]))/Math.PI)+2;return'translate('+dx+','+nv.utils.NaNtoZero(y0(getY(d[0],d[1])))+')';}).text(function(d,i){return d[0].label;});titles.exit().remove();groups.exit().selectAll('path.nv-label').watchTransition(renderWatch,'scatter exit').attr('transform',function(d){var dx=nv.utils.NaNtoZero(x(getX(d[0],d[1])))+Math.sqrt(z(getSize(d[0],d[1]))/Math.PI)+2;return'translate('+dx+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')';}).remove();titles.each(function(d){d3.select(this).classed('nv-label',true).classed('nv-label-'+d[1],false).classed('hover',false);});titles.watchTransition(renderWatch,'scatter labels').attr('transform',function(d){var dx=nv.utils.NaNtoZero(x(getX(d[0],d[1])))+Math.sqrt(z(getSize(d[0],d[1]))/Math.PI)+2;return'translate('+dx+','+nv.utils.NaNtoZero(y(getY(d[0],d[1])))+')'});}
if(interactiveUpdateDelay)
{clearTimeout(timeoutID);timeoutID=setTimeout(updateInteractiveLayer,interactiveUpdateDelay);}
else
{updateInteractiveLayer();}
x0=x.copy();y0=y.copy();z0=z.copy();});renderWatch.renderEnd('scatter immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._calls=new function(){this.clearHighlights=function(){nv.dom.write(function(){container.selectAll(".nv-point.hover").classed("hover",false);});return null;};this.highlightPoint=function(seriesIndex,pointIndex,isHoverOver){nv.dom.write(function(){container.select('.nv-groups').selectAll(".nv-series-"+seriesIndex).selectAll(".nv-point-"+pointIndex).classed("hover",isHoverOver);});};};dispatch.on('elementMouseover.point',function(d){if(interactive)chart._calls.highlightPoint(d.seriesIndex,d.pointIndex,true);});dispatch.on('elementMouseout.point',function(d){if(interactive)chart._calls.highlightPoint(d.seriesIndex,d.pointIndex,false);});chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},pointScale:{get:function(){return z;},set:function(_){z=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},pointDomain:{get:function(){return sizeDomain;},set:function(_){sizeDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},pointRange:{get:function(){return sizeRange;},set:function(_){sizeRange=_;}},forceX:{get:function(){return forceX;},set:function(_){forceX=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},forcePoint:{get:function(){return forceSize;},set:function(_){forceSize=_;}},interactive:{get:function(){return interactive;},set:function(_){interactive=_;}},pointActive:{get:function(){return pointActive;},set:function(_){pointActive=_;}},padDataOuter:{get:function(){return padDataOuter;},set:function(_){padDataOuter=_;}},padData:{get:function(){return padData;},set:function(_){padData=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},clipVoronoi:{get:function(){return clipVoronoi;},set:function(_){clipVoronoi=_;}},clipRadius:{get:function(){return clipRadius;},set:function(_){clipRadius=_;}},showVoronoi:{get:function(){return showVoronoi;},set:function(_){showVoronoi=_;}},id:{get:function(){return id;},set:function(_){id=_;}},interactiveUpdateDelay:{get:function(){return interactiveUpdateDelay;},set:function(_){interactiveUpdateDelay=_;}},showLabels:{get:function(){return showLabels;},set:function(_){showLabels=_;}},x:{get:function(){return getX;},set:function(_){getX=d3.functor(_);}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},pointSize:{get:function(){return getSize;},set:function(_){getSize=d3.functor(_);}},pointShape:{get:function(){return getShape;},set:function(_){getShape=d3.functor(_);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},useVoronoi:{get:function(){return useVoronoi;},set:function(_){useVoronoi=_;if(useVoronoi===false){clipVoronoi=false;}}}});nv.utils.initOptions(chart);return chart;};nv.models.multiBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,x=d3.scale.ordinal(),y=d3.scale.linear(),id=Math.floor(Math.random()*10000),container=null,getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],clipEdge=true,stacked=false,stackOffset='zero',color=nv.utils.defaultColor(),hideable=false,barColor=null,disabled,duration=500,xDomain,yDomain,xRange,yRange,groupSpacing=0.1,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);var last_datalength=0;function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);var nonStackableCount=0;var endFn=function(d,i){if(d.series===data.length-1&&i===data[0].values.length-1)
return true;return false;};if(hideable&&data.length)hideable=[{values:data[0].values.map(function(d){return{x:d.x,y:0,series:d.series,size:0.01};})}];if(stacked){var parsed=d3.layout.stack().offset(stackOffset).values(function(d){return d.values}).y(getY)
(!data.length&&hideable?hideable:data);parsed.forEach(function(series,i){if(series.nonStackable){data[i].nonStackableSeries=nonStackableCount++;parsed[i]=data[i];}else{if(i>0&&parsed[i-1].nonStackable){parsed[i].values.map(function(d,j){d.y0-=parsed[i-1].values[j].y;d.y1=d.y0+d.y;});}}});data=parsed;}
data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;point.key=series.key;});});if(stacked){data[0].values.map(function(d,i){var posBase=0,negBase=0;data.map(function(d,idx){if(!data[idx].nonStackable){var f=d.values[i]
f.size=Math.abs(f.y);if(f.y<0){f.y1=negBase;negBase=negBase-f.size;}else
{f.y1=f.size+posBase;posBase=posBase+f.size;}}});});}
var seriesData=(xDomain&&yDomain)?[]:data.map(function(d,idx){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0,y1:d.y1,idx:idx}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],groupSpacing);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){var domain=d.y;if(stacked&&!data[d.idx].nonStackable){if(d.y>0){domain=d.y1}else{domain=d.y1+d.y}}
return domain;}).concat(forceY))).range(yRange||[availableHeight,0]);if(x.domain()[0]===x.domain()[1])
x.domain()[0]?x.domain([x.domain()[0]-x.domain()[0]*0.01,x.domain()[1]+x.domain()[1]*0.01]):x.domain([-1,1]);if(y.domain()[0]===y.domain()[1])
y.domain()[0]?y.domain([y.domain()[0]+y.domain()[0]*0.01,y.domain()[1]-y.domain()[1]*0.01]):y.domain([-1,1]);x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-multibar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multibar');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');defsEnter.append('clipPath').attr('id','nv-edge-clip-'+id).append('rect');wrap.select('#nv-edge-clip-'+id+' rect').attr('width',availableWidth).attr('height',availableHeight);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+id+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d,i){return i});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);var exitTransition=renderWatch.transition(groups.exit().selectAll('rect.nv-bar'),'multibarExit',Math.min(100,duration)).attr('y',function(d,i,j){var yVal=y0(0)||0;if(stacked){if(data[d.series]&&!data[d.series].nonStackable){yVal=y0(d.y0);}}
return yVal;}).attr('height',0).remove();if(exitTransition.delay)
exitTransition.delay(function(d,i){var delay=i*(duration/(last_datalength+1))-i;return delay;});groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.style('stroke-opacity',1).style('fill-opacity',0.75);var bars=groups.selectAll('rect.nv-bar').data(function(d){return(hideable&&!data.length)?hideable.values:d.values});bars.exit().remove();var barsEnter=bars.enter().append('rect').attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('x',function(d,i,j){return stacked&&!data[j].nonStackable?0:(j*x.rangeBand()/data.length)}).attr('y',function(d,i,j){return y0(stacked&&!data[j].nonStackable?d.y0:0)||0}).attr('height',0).attr('width',function(d,i,j){return x.rangeBand()/(stacked&&!data[j].nonStackable?1:data.length)}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';});bars.style('fill',function(d,i,j){return color(d,j,i);}).style('stroke',function(d,i,j){return color(d,j,i);}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){var element=this;dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill"),event:d3.event,element:element});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).attr('transform',function(d,i){return'translate('+x(getX(d,i))+',0)';})
if(barColor){if(!disabled)disabled=data.map(function(){return true});bars.style('fill',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();}).style('stroke',function(d,i,j){return d3.rgb(barColor(d,i)).darker(disabled.map(function(d,i){return i}).filter(function(d,i){return!disabled[i]})[j]).toString();});}
var barSelection=bars.watchTransition(renderWatch,'multibar',Math.min(250,duration)).delay(function(d,i){return i*duration/data[0].values.length;});if(stacked){barSelection.attr('y',function(d,i,j){var yVal=0;if(!data[j].nonStackable){yVal=y(d.y1);}else{if(getY(d,i)<0){yVal=y(0);}else{if(y(0)-y(getY(d,i))<-1){yVal=y(0)-1;}else{yVal=y(getY(d,i))||0;}}}
return yVal;}).attr('height',function(d,i,j){if(!data[j].nonStackable){return Math.max(Math.abs(y(d.y+d.y0)-y(d.y0)),0);}else{return Math.max(Math.abs(y(getY(d,i))-y(0)),0)||0;}}).attr('x',function(d,i,j){var width=0;if(data[j].nonStackable){width=d.series*x.rangeBand()/data.length;if(data.length!==nonStackableCount){width=data[j].nonStackableSeries*x.rangeBand()/(nonStackableCount*2);}}
return width;}).attr('width',function(d,i,j){if(!data[j].nonStackable){return x.rangeBand();}else{var width=(x.rangeBand()/nonStackableCount);if(data.length!==nonStackableCount){width=x.rangeBand()/(nonStackableCount*2);}
return width;}});}
else{barSelection.attr('x',function(d,i){return d.series*x.rangeBand()/data.length;}).attr('width',x.rangeBand()/data.length).attr('y',function(d,i){return getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i))||0;}).attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)||0;});}
x0=x.copy();y0=y.copy();if(data[0]&&data[0].values){last_datalength=data[0].values.length;}});renderWatch.renderEnd('multibar immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},stacked:{get:function(){return stacked;},set:function(_){stacked=_;}},stackOffset:{get:function(){return stackOffset;},set:function(_){stackOffset=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},disabled:{get:function(){return disabled;},set:function(_){disabled=_;}},id:{get:function(){return id;},set:function(_){id=_;}},hideable:{get:function(){return hideable;},set:function(_){hideable=_;}},groupSpacing:{get:function(){return groupSpacing;},set:function(_){groupSpacing=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},barColor:{get:function(){return barColor;},set:function(_){barColor=_?nv.utils.getColor(_):null;}}});nv.utils.initOptions(chart);return chart;};nv.models.legend=function(){"use strict";var margin={top:5,right:0,bottom:5,left:0},width=400,height=20,getKey=function(d){return d.key},color=nv.utils.getColor(),maxKeyLength=20,align=true,padding=32,rightAlign=true,updateState=true,radioButtonMode=false,expanded=false,dispatch=d3.dispatch('legendClick','legendDblclick','legendMouseover','legendMouseout','stateChange'),vers='classic';function chart(selection){selection.each(function(data){var availableWidth=width-margin.left-margin.right,container=d3.select(this);nv.utils.initSVG(container);var wrap=container.selectAll('g.nv-legend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-legend').append('g');var g=wrap.select('g');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var series=g.selectAll('.nv-series').data(function(d){if(vers!='furious')return d;return d.filter(function(n){return expanded?true:!n.disengaged;});});var seriesEnter=series.enter().append('g').attr('class','nv-series');var seriesShape;var versPadding;switch(vers){case'furious':versPadding=23;break;case'classic':versPadding=20;}
if(vers=='classic'){seriesEnter.append('circle').style('stroke-width',2).attr('class','nv-legend-symbol').attr('r',5);seriesShape=series.select('circle');}else if(vers=='furious'){seriesEnter.append('rect').style('stroke-width',2).attr('class','nv-legend-symbol').attr('rx',3).attr('ry',3);seriesShape=series.select('.nv-legend-symbol');seriesEnter.append('g').attr('class','nv-check-box').property('innerHTML','<path d="M0.5,5 L22.5,5 L22.5,26.5 L0.5,26.5 L0.5,5 Z" class="nv-box"></path><path d="M5.5,12.8618467 L11.9185089,19.2803556 L31,0.198864511" class="nv-check"></path>').attr('transform','translate(-10,-8)scale(0.5)');var seriesCheckbox=series.select('.nv-check-box');seriesCheckbox.each(function(d,i){d3.select(this).selectAll('path').attr('stroke',setTextColor(d,i));});}
seriesEnter.append('text').attr('text-anchor','start').attr('class','nv-legend-text').attr('dy','.32em').attr('dx','8');var seriesText=series.select('text.nv-legend-text');series.on('mouseover',function(d,i){dispatch.legendMouseover(d,i);}).on('mouseout',function(d,i){dispatch.legendMouseout(d,i);}).on('click',function(d,i){dispatch.legendClick(d,i);var data=series.data();if(updateState){if(vers=='classic'){if(radioButtonMode){data.forEach(function(series){series.disabled=true});d.disabled=false;}
else{d.disabled=!d.disabled;if(data.every(function(series){return series.disabled})){data.forEach(function(series){series.disabled=false});}}}else if(vers=='furious'){if(expanded){d.disengaged=!d.disengaged;d.userDisabled=d.userDisabled==undefined?!!d.disabled:d.userDisabled;d.disabled=d.disengaged||d.userDisabled;}else if(!expanded){d.disabled=!d.disabled;d.userDisabled=d.disabled;var engaged=data.filter(function(d){return!d.disengaged;});if(engaged.every(function(series){return series.userDisabled})){data.forEach(function(series){series.disabled=series.userDisabled=false;});}}}
dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled}),disengaged:data.map(function(d){return!!d.disengaged})});}}).on('dblclick',function(d,i){if(vers=='furious'&&expanded)return;dispatch.legendDblclick(d,i);if(updateState){var data=series.data();data.forEach(function(series){series.disabled=true;if(vers=='furious')series.userDisabled=series.disabled;});d.disabled=false;if(vers=='furious')d.userDisabled=d.disabled;dispatch.stateChange({disabled:data.map(function(d){return!!d.disabled})});}});series.classed('nv-disabled',function(d){return d.userDisabled});series.exit().remove();seriesText.attr('fill',setTextColor).text(getKey);var legendWidth=0;if(align){var seriesWidths=[];series.each(function(d,i){var legendText;if(getKey(d).length>maxKeyLength){var trimmedKey=getKey(d).substring(0,maxKeyLength);legendText=d3.select(this).select('text').text(trimmedKey+"...");d3.select(this).append("svg:title").text(getKey(d));}else{legendText=d3.select(this).select('text');}
var nodeTextLength;try{nodeTextLength=legendText.node().getComputedTextLength();if(nodeTextLength<=0)throw Error();}
catch(e){nodeTextLength=nv.utils.calcApproxTextWidth(legendText);}
seriesWidths.push(nodeTextLength+padding);});var seriesPerRow=0;var columnWidths=[];legendWidth=0;while(legendWidth<availableWidth&&seriesPerRow<seriesWidths.length){columnWidths[seriesPerRow]=seriesWidths[seriesPerRow];legendWidth+=seriesWidths[seriesPerRow++];}
if(seriesPerRow===0)seriesPerRow=1;while(legendWidth>availableWidth&&seriesPerRow>1){columnWidths=[];seriesPerRow--;for(var k=0;k<seriesWidths.length;k++){if(seriesWidths[k]>(columnWidths[k%seriesPerRow]||0))
columnWidths[k%seriesPerRow]=seriesWidths[k];}
legendWidth=columnWidths.reduce(function(prev,cur,index,array){return prev+cur;});}
var xPositions=[];for(var i=0,curX=0;i<seriesPerRow;i++){xPositions[i]=curX;curX+=columnWidths[i];}
series.attr('transform',function(d,i){return'translate('+xPositions[i%seriesPerRow]+','+(5+Math.floor(i/seriesPerRow)*versPadding)+')';});if(rightAlign){g.attr('transform','translate('+(width-margin.right-legendWidth)+','+margin.top+')');}
else{g.attr('transform','translate(0'+','+margin.top+')');}
height=margin.top+margin.bottom+(Math.ceil(seriesWidths.length/seriesPerRow)*versPadding);}else{var ypos=5,newxpos=5,maxwidth=0,xpos;series.attr('transform',function(d,i){var length=d3.select(this).select('text').node().getComputedTextLength()+padding;xpos=newxpos;if(width<margin.left+margin.right+xpos+length){newxpos=xpos=5;ypos+=versPadding;}
newxpos+=length;if(newxpos>maxwidth)maxwidth=newxpos;if(legendWidth<xpos+maxwidth){legendWidth=xpos+maxwidth;}
return'translate('+xpos+','+ypos+')';});g.attr('transform','translate('+(width-margin.right-maxwidth)+','+margin.top+')');height=margin.top+margin.bottom+ypos+15;}
if(vers=='furious'){seriesShape.attr('width',function(d,i){return seriesText[0][i].getComputedTextLength()+27;}).attr('height',18).attr('y',-9).attr('x',-15);gEnter.insert('rect',':first-child').attr('class','nv-legend-bg').attr('fill','#eee').attr('opacity',0);var seriesBG=g.select('.nv-legend-bg');seriesBG.transition().duration(300).attr('x',-versPadding).attr('width',legendWidth+versPadding-12).attr('height',height+10).attr('y',-margin.top-10).attr('opacity',expanded?1:0);}
seriesShape.style('fill',setBGColor).style('fill-opacity',setBGOpacity).style('stroke',setBGColor);});function setTextColor(d,i){if(vers!='furious')return'#000';if(expanded){return d.disengaged?'#000':'#fff';}else if(!expanded){if(!d.color)d.color=color(d,i);return!!d.disabled?d.color:'#fff';}}
function setBGColor(d,i){if(expanded&&vers=='furious'){return d.disengaged?'#eee':d.color||color(d,i);}else{return d.color||color(d,i);}}
function setBGOpacity(d,i){if(expanded&&vers=='furious'){return 1;}else{return!!d.disabled?0:1;}}
return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},key:{get:function(){return getKey;},set:function(_){getKey=_;}},align:{get:function(){return align;},set:function(_){align=_;}},maxKeyLength:{get:function(){return maxKeyLength;},set:function(_){maxKeyLength=_;}},rightAlign:{get:function(){return rightAlign;},set:function(_){rightAlign=_;}},padding:{get:function(){return padding;},set:function(_){padding=_;}},updateState:{get:function(){return updateState;},set:function(_){updateState=_;}},radioButtonMode:{get:function(){return radioButtonMode;},set:function(_){radioButtonMode=_;}},expanded:{get:function(){return expanded;},set:function(_){expanded=_;}},vers:{get:function(){return vers;},set:function(_){vers=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}}});nv.utils.initOptions(chart);return chart;};nv.models.lineChart=function(){"use strict";var lines=nv.models.line(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),interactiveLayer=nv.interactiveGuideline(),tooltip=nv.models.tooltip(),lines2=nv.models.line(),x2Axis=nv.models.axis(),y2Axis=nv.models.axis(),brush=d3.svg.brush();var margin={top:30,right:20,bottom:50,left:60},margin2={top:0,right:20,bottom:20,left:60},color=nv.utils.defaultColor(),width=null,height=null,showLegend=true,legendPosition='top',showXAxis=true,showYAxis=true,rightAlignYAxis=false,useInteractiveGuideline=false,x,y,x2,y2,focusEnable=false,focusShowAxisY=false,focusShowAxisX=true,focusHeight=50,brushExtent=null,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('tooltipShow','tooltipHide','brush','stateChange','changeState','renderEnd'),duration=250;xAxis.orient('bottom').tickPadding(7);yAxis.orient(rightAlignYAxis?'right':'left');lines.clipEdge(true).duration(0);lines2.interactive(false);lines2.pointActive(function(d){return false;});x2Axis.orient('bottom').tickPadding(5);y2Axis.orient(rightAlignYAxis?'right':'left');tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});interactiveLayer.tooltip.valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,duration);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled;})};};};var stateSetter=function(data){return function(state){if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});};};function chart(selection){renderWatch.reset();renderWatch.models(lines);renderWatch.models(lines2);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);if(focusShowAxisX)renderWatch.models(x2Axis);if(focusShowAxisY)renderWatch.models(y2Axis);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight1=nv.utils.availableHeight(height,container,margin)-(focusEnable?focusHeight:0),availableHeight2=focusHeight-margin2.top-margin2.bottom;chart.update=function(){if(duration===0){container.call(chart);}else{container.transition().duration(duration).call(chart);}};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled;});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length;}).length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
x=lines.xScale();y=lines.yScale();x2=lines2.xScale();y2=lines2.yScale();var wrap=container.selectAll('g.nv-wrap.nv-lineChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-lineChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-legendWrap');var focusEnter=gEnter.append('g').attr('class','nv-focus');focusEnter.append('g').attr('class','nv-background').append('rect');focusEnter.append('g').attr('class','nv-x nv-axis');focusEnter.append('g').attr('class','nv-y nv-axis');focusEnter.append('g').attr('class','nv-linesWrap');focusEnter.append('g').attr('class','nv-interactive');var contextEnter=gEnter.append('g').attr('class','nv-context');contextEnter.append('g').attr('class','nv-background').append('rect');contextEnter.append('g').attr('class','nv-x nv-axis');contextEnter.append('g').attr('class','nv-y nv-axis');contextEnter.append('g').attr('class','nv-linesWrap');contextEnter.append('g').attr('class','nv-brushBackground');contextEnter.append('g').attr('class','nv-x nv-brush');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(legendPosition==='bottom'){wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(availableHeight1+legend.height())+')');}else if(legendPosition==='top'){if(margin.top!=legend.height()){margin.top=legend.height();availableHeight1=nv.utils.availableHeight(height,container,margin)-(focusEnable?focusHeight:0);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')');}}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight1).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
g.select('.nv-focus .nv-background rect').attr('width',availableWidth).attr('height',availableHeight1);lines.width(availableWidth).height(availableHeight1).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));var linesWrap=g.select('.nv-linesWrap').datum(data.filter(function(d){return!d.disabled;}));if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight1,0);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight1/36,data)).tickSize(-availableWidth,0);}
function updateXAxis(){if(showXAxis){g.select('.nv-focus .nv-x.nv-axis').transition().duration(duration).call(xAxis);}}
function updateYAxis(){if(showYAxis){g.select('.nv-focus .nv-y.nv-axis').transition().duration(duration).call(yAxis);}}
g.select('.nv-focus .nv-x.nv-axis').attr('transform','translate(0,'+availableHeight1+')');if(!focusEnable)
{linesWrap.call(lines);updateXAxis();updateYAxis();}
else
{lines2.defined(lines.defined()).width(availableWidth).height(availableHeight2).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled;}));g.select('.nv-context').attr('transform','translate(0,'+(availableHeight1+margin.bottom+margin2.top)+')').style('display',focusEnable?'initial':'none');var contextLinesWrap=g.select('.nv-context .nv-linesWrap').datum(data.filter(function(d){return!d.disabled;}));d3.transition(contextLinesWrap).call(lines2);brush.x(x2).on('brush',function(){onBrush();});if(brushExtent)brush.extent(brushExtent);var brushBG=g.select('.nv-brushBackground').selectAll('g').data([brushExtent||brush.extent()]);var brushBGenter=brushBG.enter().append('g');brushBGenter.append('rect').attr('class','left').attr('x',0).attr('y',0).attr('height',availableHeight2);brushBGenter.append('rect').attr('class','right').attr('x',0).attr('y',0).attr('height',availableHeight2);var gBrush=g.select('.nv-x.nv-brush').call(brush);gBrush.selectAll('rect').attr('height',availableHeight2);gBrush.selectAll('.resize').append('path').attr('d',resizePath);onBrush();g.select('.nv-context .nv-background rect').attr('width',availableWidth).attr('height',availableHeight2);if(focusShowAxisX){x2Axis.scale(x2)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight2,0);g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');d3.transition(g.select('.nv-context .nv-x.nv-axis')).call(x2Axis);}
if(focusShowAxisY){y2Axis.scale(y2)._ticks(nv.utils.calcTicksY(availableHeight2/36,data)).tickSize(-availableWidth,0);d3.transition(g.select('.nv-context .nv-y.nv-axis')).call(y2Axis);}
g.select('.nv-context .nv-x.nv-axis').attr('transform','translate(0,'+y2.range()[0]+')');}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});interactiveLayer.dispatch.on('elementMousemove',function(e){lines.clearHighlights();var singlePoint,pointIndex,pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled&&!series.disableTooltip;}).forEach(function(series,i){var extent=focusEnable?(brush.empty()?x2.domain():brush.extent()):x.domain();var currentValues=series.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];});pointIndex=nv.interactiveBisect(currentValues,e.pointXValue,lines.x());var point=currentValues[pointIndex];var pointYValue=chart.y()(point,pointIndex);if(pointYValue!==null){lines.highlightPoint(series.seriesIndex,pointIndex,true);}
if(point===undefined)return;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=chart.xScale()(chart.x()(point,pointIndex));allData.push({key:series.key,value:pointYValue,color:color(series,series.seriesIndex),data:point});});if(allData.length>2){var yValue=chart.yScale().invert(e.mouseY);var domainExtent=Math.abs(chart.yScale().domain()[0]-chart.yScale().domain()[1]);var threshold=0.03*domainExtent;var indexToHighlight=nv.nearestValueIndex(allData.map(function(d){return d.value;}),yValue,threshold);if(indexToHighlight!==null)
allData[indexToHighlight].highlight=true;}
var defaultValueFormatter=function(d,i){return d==null?"N/A":yAxis.tickFormat()(d);};interactiveLayer.tooltip.chartContainer(chart.container.parentNode).valueFormatter(interactiveLayer.tooltip.valueFormatter()||defaultValueFormatter).data({value:chart.x()(singlePoint,pointIndex),index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on('elementClick',function(e){var pointXLocation,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series){var pointIndex=nv.interactiveBisect(series.values,e.pointXValue,chart.x());var point=series.values[pointIndex];if(typeof point==='undefined')return;if(typeof pointXLocation==='undefined')pointXLocation=chart.xScale()(chart.x()(point,pointIndex));var yPos=chart.yScale()(chart.y()(point,pointIndex));allData.push({point:point,pointIndex:pointIndex,pos:[pointXLocation,yPos],seriesIndex:series.seriesIndex,series:series});});lines.dispatch.elementClick(allData);});interactiveLayer.dispatch.on("elementMouseout",function(e){lines.clearHighlights();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'&&data.length===e.disabled.length){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});function resizePath(d){var e=+(d=='e'),x=e?1:-1,y=availableHeight2/3;return'M'+(0.5*x)+','+y
+'A6,6 0 0 '+e+' '+(6.5*x)+','+(y+6)
+'V'+(2*y-6)
+'A6,6 0 0 '+e+' '+(0.5*x)+','+(2*y)
+'Z'
+'M'+(2.5*x)+','+(y+8)
+'V'+(2*y-8)
+'M'+(4.5*x)+','+(y+8)
+'V'+(2*y-8);}
function updateBrushBG(){if(!brush.empty())brush.extent(brushExtent);brushBG.data([brush.empty()?x2.domain():brushExtent]).each(function(d,i){var leftWidth=x2(d[0])-x.range()[0],rightWidth=availableWidth-x2(d[1]);d3.select(this).select('.left').attr('width',leftWidth<0?0:leftWidth);d3.select(this).select('.right').attr('x',x2(d[1])).attr('width',rightWidth<0?0:rightWidth);});}
function onBrush(){brushExtent=brush.empty()?null:brush.extent();var extent=brush.empty()?x2.domain():brush.extent();if(Math.abs(extent[0]-extent[1])<=1){return;}
dispatch.brush({extent:extent,brush:brush});updateBrushBG();var focusLinesWrap=g.select('.nv-focus .nv-linesWrap').datum(data.filter(function(d){return!d.disabled;}).map(function(d,i){return{key:d.key,area:d.area,classed:d.classed,values:d.values.filter(function(d,i){return lines.x()(d,i)>=extent[0]&&lines.x()(d,i)<=extent[1];}),disableTooltip:d.disableTooltip};}));focusLinesWrap.transition().duration(duration).call(lines);updateXAxis();updateYAxis();}});renderWatch.renderEnd('lineChart immediate');return chart;}
lines.dispatch.on('elementMouseover.tooltip',function(evt){if(!evt.series.disableTooltip){tooltip.data(evt).hidden(false);}});lines.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});chart.dispatch=dispatch;chart.lines=lines;chart.lines2=lines2;chart.legend=legend;chart.xAxis=xAxis;chart.x2Axis=x2Axis;chart.yAxis=yAxis;chart.y2Axis=y2Axis;chart.interactiveLayer=interactiveLayer;chart.tooltip=tooltip;chart.state=state;chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},legendPosition:{get:function(){return legendPosition;},set:function(_){legendPosition=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},focusEnable:{get:function(){return focusEnable;},set:function(_){focusEnable=_;}},focusHeight:{get:function(){return height2;},set:function(_){focusHeight=_;}},focusShowAxisX:{get:function(){return focusShowAxisX;},set:function(_){focusShowAxisX=_;}},focusShowAxisY:{get:function(){return focusShowAxisY;},set:function(_){focusShowAxisY=_;}},brushExtent:{get:function(){return brushExtent;},set:function(_){brushExtent=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);lines.duration(duration);xAxis.duration(duration);x2Axis.duration(duration);yAxis.duration(duration);y2Axis.duration(duration);}},focusMargin:{get:function(){return margin2;},set:function(_){margin2.top=_.top!==undefined?_.top:margin2.top;margin2.right=_.right!==undefined?_.right:margin2.right;margin2.bottom=_.bottom!==undefined?_.bottom:margin2.bottom;margin2.left=_.left!==undefined?_.left:margin2.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);lines.color(color);}},interpolate:{get:function(){return lines.interpolate();},set:function(_){lines.interpolate(_);lines2.interpolate(_);}},xTickFormat:{get:function(){return xAxis.tickFormat();},set:function(_){xAxis.tickFormat(_);x2Axis.tickFormat(_);}},yTickFormat:{get:function(){return yAxis.tickFormat();},set:function(_){yAxis.tickFormat(_);y2Axis.tickFormat(_);}},x:{get:function(){return lines.x();},set:function(_){lines.x(_);lines2.x(_);}},y:{get:function(){return lines.y();},set:function(_){lines.y(_);lines2.y(_);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;if(useInteractiveGuideline){lines.interactive(false);lines.useVoronoi(false);}}}});nv.utils.inheritOptions(chart,lines);nv.utils.initOptions(chart);return chart;};nv.models.lineWithFocusChart=function(){return nv.models.lineChart().margin({bottom:30}).focusEnable(true);};nv.models.line=function(){"use strict";var scatter=nv.models.scatter();var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,container=null,strokeWidth=1.5,color=nv.utils.defaultColor(),getX=function(d){return d.x},getY=function(d){return d.y},defined=function(d,i){return!isNaN(getY(d,i))&&getY(d,i)!==null},isArea=function(d){return d.area},clipEdge=false,x,y,interpolate="linear",duration=250,dispatch=d3.dispatch('elementClick','elementMouseover','elementMouseout','renderEnd');scatter.pointSize(16).pointDomain([16,256]);var x0,y0,renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(scatter);selection.each(function(data){container=d3.select(this);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);nv.utils.initSVG(container);x=scatter.xScale();y=scatter.yScale();x0=x0||x;y0=y0||y;var wrap=container.selectAll('g.nv-wrap.nv-line').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-line');var defsEnter=wrapEnter.append('defs');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');gEnter.append('g').attr('class','nv-scatterWrap');wrap.attr('transform','translate('+margin.left+','+margin.top+')');scatter.width(availableWidth).height(availableHeight);var scatterWrap=wrap.select('.nv-scatterWrap');scatterWrap.call(scatter);defsEnter.append('clipPath').attr('id','nv-edge-clip-'+scatter.id()).append('rect');wrap.select('#nv-edge-clip-'+scatter.id()+' rect').attr('width',availableWidth).attr('height',(availableHeight>0)?availableHeight:0);g.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');scatterWrap.attr('clip-path',clipEdge?'url(#nv-edge-clip-'+scatter.id()+')':'');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('stroke-width',function(d){return d.strokeWidth||strokeWidth}).style('fill-opacity',1e-6);groups.exit().remove();groups.attr('class',function(d,i){return(d.classed||'')+' nv-group nv-series-'+i;}).classed('hover',function(d){return d.hover}).style('fill',function(d,i){return color(d,i)}).style('stroke',function(d,i){return color(d,i)});groups.watchTransition(renderWatch,'line: groups').style('stroke-opacity',1).style('fill-opacity',function(d){return d.fillOpacity||.5});var areaPaths=groups.selectAll('path.nv-area').data(function(d){return isArea(d)?[d]:[]});areaPaths.enter().append('path').attr('class','nv-area').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}).y1(function(d,i){return y0(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});groups.exit().selectAll('path.nv-area').remove();areaPaths.watchTransition(renderWatch,'line: areaPaths').attr('d',function(d){return d3.svg.area().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y0(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}).y1(function(d,i){return y(y.domain()[0]<=0?y.domain()[1]>=0?0:y.domain()[1]:y.domain()[0])}).apply(this,[d.values])});var linePaths=groups.selectAll('path.nv-line').data(function(d){return[d.values]});linePaths.enter().append('path').attr('class','nv-line').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x0(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y0(getY(d,i)))}));linePaths.watchTransition(renderWatch,'line: linePaths').attr('d',d3.svg.line().interpolate(interpolate).defined(defined).x(function(d,i){return nv.utils.NaNtoZero(x(getX(d,i)))}).y(function(d,i){return nv.utils.NaNtoZero(y(getY(d,i)))}));x0=x.copy();y0=y.copy();});renderWatch.renderEnd('line immediate');return chart;}
chart.dispatch=dispatch;chart.scatter=scatter;scatter.dispatch.on('elementClick',function(){dispatch.elementClick.apply(this,arguments);});scatter.dispatch.on('elementMouseover',function(){dispatch.elementMouseover.apply(this,arguments);});scatter.dispatch.on('elementMouseout',function(){dispatch.elementMouseout.apply(this,arguments);});chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},defined:{get:function(){return defined;},set:function(_){defined=_;}},interpolate:{get:function(){return interpolate;},set:function(_){interpolate=_;}},clipEdge:{get:function(){return clipEdge;},set:function(_){clipEdge=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);scatter.duration(duration);}},isArea:{get:function(){return isArea;},set:function(_){isArea=d3.functor(_);}},x:{get:function(){return getX;},set:function(_){getX=_;scatter.x(_);}},y:{get:function(){return getY;},set:function(_){getY=_;scatter.y(_);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);scatter.color(color);}}});nv.utils.inheritOptions(chart,scatter);nv.utils.initOptions(chart);return chart;};nv.models.discreteBarChart=function(){"use strict";var discretebar=nv.models.discreteBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),legend=nv.models.legend(),tooltip=nv.models.tooltip();var margin={top:15,right:10,bottom:50,left:60},width=null,height=null,color=nv.utils.getColor(),showLegend=false,showXAxis=true,showYAxis=true,rightAlignYAxis=false,staggerLabels=false,wrapLabels=false,rotateLabels=0,x,y,noData=null,dispatch=d3.dispatch('beforeUpdate','renderEnd'),duration=250;xAxis.orient('bottom').showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).keyFormatter(function(d,i){return xAxis.tickFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();renderWatch.models(discretebar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){dispatch.beforeUpdate();container.transition().duration(duration).call(chart);};chart.container=this;if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
x=discretebar.xScale();y=discretebar.yScale().clamp(true);var wrap=container.selectAll('g.nv-wrap.nv-discreteBarWithAxes').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discreteBarWithAxes').append('g');var defsEnter=gEnter.append('defs');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis').append('g').attr('class','nv-zeroLine').append('line');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');g.attr('transform','translate('+margin.left+','+margin.top+')');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{legend.width(availableWidth);g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')')}
if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
discretebar.width(availableWidth).height(availableHeight);var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.transition().call(discretebar);defsEnter.append('clipPath').attr('id','nv-x-label-clip-'+discretebar.id()).append('rect');g.select('#nv-x-label-clip-'+discretebar.id()+' rect').attr('width',x.rangeBand()*(staggerLabels?2:1)).attr('height',16).attr('x',-x.rangeBand()/(staggerLabels?1:2));if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+(y.range()[0]+((discretebar.showValues()&&y.domain()[0]<0)?16:0))+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis').selectAll('g');if(staggerLabels){xTicks.selectAll('text').attr('transform',function(d,i,j){return'translate(0,'+(j%2==0?'5':'17')+')'})}
if(rotateLabels){xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');}
if(wrapLabels){g.selectAll('.tick text').call(nv.utils.wrapTicks,chart.xAxis.rangeBand())}}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
g.select(".nv-zeroLine line").attr("x1",0).attr("x2",(rightAlignYAxis)?-availableWidth:availableWidth).attr("y1",y(0)).attr("y2",y(0));});renderWatch.renderEnd('discreteBar chart immediate');return chart;}
discretebar.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});discretebar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});discretebar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.dispatch=dispatch;chart.discretebar=discretebar;chart.legend=legend;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},wrapLabels:{get:function(){return wrapLabels;},set:function(_){wrapLabels=!!_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);discretebar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);discretebar.color(color);legend.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient((_)?'right':'left');}}});nv.utils.inheritOptions(chart,discretebar);nv.utils.initOptions(chart);return chart;}
nv.models.pieChart=function(){"use strict";var pie=nv.models.pie();var legend=nv.models.legend();var tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:20,left:20},width=null,height=null,showLegend=true,legendPosition="top",color=nv.utils.defaultColor(),state=nv.utils.state(),defaultState=null,noData=null,duration=250,dispatch=d3.dispatch('stateChange','changeState','renderEnd');tooltip.duration(0).headerEnabled(false).valueFormatter(function(d,i){return pie.valueFormat()(d,i);});var renderWatch=nv.utils.renderWatch(dispatch);var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled})};}};var stateSetter=function(data){return function(state){if(state.active!==undefined){data.forEach(function(series,i){series.disabled=!state.active[i];});}}};function chart(selection){renderWatch.reset();renderWatch.models(pie);selection.each(function(data){var container=d3.select(this);nv.utils.initSVG(container);var that=this;var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){container.transition().call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length){nv.utils.noData(chart,container);return chart;}else{container.selectAll('.nv-noData').remove();}
var wrap=container.selectAll('g.nv-wrap.nv-pieChart').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pieChart').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-pieWrap');gEnter.append('g').attr('class','nv-legendWrap');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{if(legendPosition==="top"){legend.width(availableWidth).key(pie.x());wrap.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
wrap.select('.nv-legendWrap').attr('transform','translate(0,'+(-margin.top)+')');}else if(legendPosition==="right"){var legendWidth=nv.models.legend().width();if(availableWidth/2<legendWidth){legendWidth=(availableWidth/2)}
legend.height(availableHeight).key(pie.x());legend.width(legendWidth);availableWidth-=legend.width();wrap.select('.nv-legendWrap').datum(data).call(legend).attr('transform','translate('+(availableWidth)+',0)');}}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');pie.width(availableWidth).height(availableHeight);var pieWrap=g.select('.nv-pieWrap').datum([data]);d3.transition(pieWrap).call(pie);legend.dispatch.on('stateChange',function(newState){for(var key in newState){state[key]=newState[key];}
dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
chart.update();});});renderWatch.renderEnd('pieChart immediate');return chart;}
pie.dispatch.on('elementMouseover.tooltip',function(evt){evt['series']={key:chart.x()(evt.data),value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});pie.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});pie.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});chart.legend=legend;chart.dispatch=dispatch;chart.pie=pie;chart.tooltip=tooltip;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},legendPosition:{get:function(){return legendPosition;},set:function(_){legendPosition=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},color:{get:function(){return color;},set:function(_){color=_;legend.color(color);pie.color(color);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}}});nv.utils.inheritOptions(chart,pie);nv.utils.initOptions(chart);return chart;};nv.models.discreteBar=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=960,height=500,id=Math.floor(Math.random()*10000),container,x=d3.scale.ordinal(),y=d3.scale.linear(),getX=function(d){return d.x},getY=function(d){return d.y},forceY=[0],color=nv.utils.defaultColor(),showValues=false,valueFormat=d3.format(',.2f'),xDomain,yDomain,xRange,yRange,dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd'),rectClass='discreteBar',duration=250;var x0,y0;var renderWatch=nv.utils.renderWatch(dispatch,duration);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom;container=d3.select(this);nv.utils.initSVG(container);data.forEach(function(series,i){series.values.forEach(function(point){point.series=i;});});var seriesData=(xDomain&&yDomain)?[]:data.map(function(d){return d.values.map(function(d,i){return{x:getX(d,i),y:getY(d,i),y0:d.y0}})});x.domain(xDomain||d3.merge(seriesData).map(function(d){return d.x})).rangeBands(xRange||[0,availableWidth],.1);y.domain(yDomain||d3.extent(d3.merge(seriesData).map(function(d){return d.y}).concat(forceY)));if(showValues)y.range(yRange||[availableHeight-(y.domain()[0]<0?12:0),y.domain()[1]>0?12:0]);else y.range(yRange||[availableHeight,0]);x0=x0||x;y0=y0||y.copy().range([y(0),y(0)]);var wrap=container.selectAll('g.nv-wrap.nv-discretebar').data([data]);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-discretebar');var gEnter=wrapEnter.append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-groups');wrap.attr('transform','translate('+margin.left+','+margin.top+')');var groups=wrap.select('.nv-groups').selectAll('.nv-group').data(function(d){return d},function(d){return d.key});groups.enter().append('g').style('stroke-opacity',1e-6).style('fill-opacity',1e-6);groups.exit().watchTransition(renderWatch,'discreteBar: exit groups').style('stroke-opacity',1e-6).style('fill-opacity',1e-6).remove();groups.attr('class',function(d,i){return'nv-group nv-series-'+i}).classed('hover',function(d){return d.hover});groups.watchTransition(renderWatch,'discreteBar: groups').style('stroke-opacity',1).style('fill-opacity',.75);var bars=groups.selectAll('g.nv-bar').data(function(d){return d.values});bars.exit().remove();var barsEnter=bars.enter().append('g').attr('transform',function(d,i,j){return'translate('+(x(getX(d,i))+x.rangeBand()*.05)+', '+y(0)+')'}).on('mouseover',function(d,i){d3.select(this).classed('hover',true);dispatch.elementMouseover({data:d,index:i,color:d3.select(this).style("fill")});}).on('mouseout',function(d,i){d3.select(this).classed('hover',false);dispatch.elementMouseout({data:d,index:i,color:d3.select(this).style("fill")});}).on('mousemove',function(d,i){dispatch.elementMousemove({data:d,index:i,color:d3.select(this).style("fill")});}).on('click',function(d,i){var element=this;dispatch.elementClick({data:d,index:i,color:d3.select(this).style("fill"),event:d3.event,element:element});d3.event.stopPropagation();}).on('dblclick',function(d,i){dispatch.elementDblClick({data:d,index:i,color:d3.select(this).style("fill")});d3.event.stopPropagation();});barsEnter.append('rect').attr('height',0).attr('width',x.rangeBand()*.9/data.length)
if(showValues){barsEnter.append('text').attr('text-anchor','middle');bars.select('text').text(function(d,i){return valueFormat(getY(d,i))}).watchTransition(renderWatch,'discreteBar: bars text').attr('x',x.rangeBand()*.9/2).attr('y',function(d,i){return getY(d,i)<0?y(getY(d,i))-y(0)+12:-4});}else{bars.selectAll('text').remove();}
bars.attr('class',function(d,i){return getY(d,i)<0?'nv-bar negative':'nv-bar positive'}).style('fill',function(d,i){return d.color||color(d,i)}).style('stroke',function(d,i){return d.color||color(d,i)}).select('rect').attr('class',rectClass).watchTransition(renderWatch,'discreteBar: bars rect').attr('width',x.rangeBand()*.9/data.length);bars.watchTransition(renderWatch,'discreteBar: bars').attr('transform',function(d,i){var left=x(getX(d,i))+x.rangeBand()*.05,top=getY(d,i)<0?y(0):y(0)-y(getY(d,i))<1?y(0)-1:y(getY(d,i));return'translate('+left+', '+top+')'}).select('rect').attr('height',function(d,i){return Math.max(Math.abs(y(getY(d,i))-y(0)),1)});x0=x.copy();y0=y.copy();});renderWatch.renderEnd('discreteBar immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},forceY:{get:function(){return forceY;},set:function(_){forceY=_;}},showValues:{get:function(){return showValues;},set:function(_){showValues=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},y:{get:function(){return getY;},set:function(_){getY=_;}},xScale:{get:function(){return x;},set:function(_){x=_;}},yScale:{get:function(){return y;},set:function(_){y=_;}},xDomain:{get:function(){return xDomain;},set:function(_){xDomain=_;}},yDomain:{get:function(){return yDomain;},set:function(_){yDomain=_;}},xRange:{get:function(){return xRange;},set:function(_){xRange=_;}},yRange:{get:function(){return yRange;},set:function(_){yRange=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},id:{get:function(){return id;},set:function(_){id=_;}},rectClass:{get:function(){return rectClass;},set:function(_){rectClass=_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},duration:{get:function(){return duration;},set:function(_){duration=_;renderWatch.reset(duration);}}});nv.utils.initOptions(chart);return chart;};nv.models.multiBarChart=function(){"use strict";var multibar=nv.models.multiBar(),xAxis=nv.models.axis(),yAxis=nv.models.axis(),interactiveLayer=nv.interactiveGuideline(),legend=nv.models.legend(),controls=nv.models.legend(),tooltip=nv.models.tooltip();var margin={top:30,right:20,bottom:50,left:60},width=null,height=null,color=nv.utils.defaultColor(),showControls=true,controlLabels={},showLegend=true,showXAxis=true,showYAxis=true,rightAlignYAxis=false,reduceXTicks=true,staggerLabels=false,wrapLabels=false,rotateLabels=0,x,y,state=nv.utils.state(),defaultState=null,noData=null,dispatch=d3.dispatch('stateChange','changeState','renderEnd'),controlWidth=function(){return showControls?180:0},duration=250,useInteractiveGuideline=false;state.stacked=false
multibar.stacked(false);xAxis.orient('bottom').tickPadding(7).showMaxMin(false).tickFormat(function(d){return d});yAxis.orient((rightAlignYAxis)?'right':'left').tickFormat(d3.format(',.1f'));tooltip.duration(0).valueFormatter(function(d,i){return yAxis.tickFormat()(d,i);}).headerFormatter(function(d,i){return xAxis.tickFormat()(d,i);});controls.updateState(false);var renderWatch=nv.utils.renderWatch(dispatch);var stacked=false;var stateGetter=function(data){return function(){return{active:data.map(function(d){return!d.disabled}),stacked:stacked};}};var stateSetter=function(data){return function(state){if(state.stacked!==undefined)
stacked=state.stacked;if(state.active!==undefined)
data.forEach(function(series,i){series.disabled=!state.active[i];});}};function chart(selection){renderWatch.reset();renderWatch.models(multibar);if(showXAxis)renderWatch.models(xAxis);if(showYAxis)renderWatch.models(yAxis);selection.each(function(data){var container=d3.select(this),that=this;nv.utils.initSVG(container);var availableWidth=nv.utils.availableWidth(width,container,margin),availableHeight=nv.utils.availableHeight(height,container,margin);chart.update=function(){if(duration===0)
container.call(chart);else
container.transition().duration(duration).call(chart);};chart.container=this;state.setter(stateSetter(data),chart.update).getter(stateGetter(data)).update();state.disabled=data.map(function(d){return!!d.disabled});if(!defaultState){var key;defaultState={};for(key in state){if(state[key]instanceof Array)
defaultState[key]=state[key].slice(0);else
defaultState[key]=state[key];}}
if(!data||!data.length||!data.filter(function(d){return d.values.length}).length){nv.utils.noData(chart,container)
return chart;}else{container.selectAll('.nv-noData').remove();}
x=multibar.xScale();y=multibar.yScale();var wrap=container.selectAll('g.nv-wrap.nv-multiBarWithLegend').data([data]);var gEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-multiBarWithLegend').append('g');var g=wrap.select('g');gEnter.append('g').attr('class','nv-x nv-axis');gEnter.append('g').attr('class','nv-y nv-axis');gEnter.append('g').attr('class','nv-barsWrap');gEnter.append('g').attr('class','nv-legendWrap');gEnter.append('g').attr('class','nv-controlsWrap');gEnter.append('g').attr('class','nv-interactive');if(!showLegend){g.select('.nv-legendWrap').selectAll('*').remove();}else{legend.width(availableWidth-controlWidth());g.select('.nv-legendWrap').datum(data).call(legend);if(margin.top!=legend.height()){margin.top=legend.height();availableHeight=nv.utils.availableHeight(height,container,margin);}
g.select('.nv-legendWrap').attr('transform','translate('+controlWidth()+','+(-margin.top)+')');}
if(!showControls){g.select('.nv-controlsWrap').selectAll('*').remove();}else{var controlsData=[{key:controlLabels.grouped||'Grouped',disabled:multibar.stacked()},{key:controlLabels.stacked||'Stacked',disabled:!multibar.stacked()}];controls.width(controlWidth()).color(['#444','#444','#444']);g.select('.nv-controlsWrap').datum(controlsData).attr('transform','translate(0,'+(-margin.top)+')').call(controls);}
wrap.attr('transform','translate('+margin.left+','+margin.top+')');if(rightAlignYAxis){g.select(".nv-y.nv-axis").attr("transform","translate("+availableWidth+",0)");}
multibar.disabled(data.map(function(series){return series.disabled})).width(availableWidth).height(availableHeight).color(data.map(function(d,i){return d.color||color(d,i);}).filter(function(d,i){return!data[i].disabled}));var barsWrap=g.select('.nv-barsWrap').datum(data.filter(function(d){return!d.disabled}));barsWrap.call(multibar);if(showXAxis){xAxis.scale(x)._ticks(nv.utils.calcTicksX(availableWidth/100,data)).tickSize(-availableHeight,0);g.select('.nv-x.nv-axis').attr('transform','translate(0,'+y.range()[0]+')');g.select('.nv-x.nv-axis').call(xAxis);var xTicks=g.select('.nv-x.nv-axis > g').selectAll('g');xTicks.selectAll('line, text').style('opacity',1)
if(staggerLabels){var getTranslate=function(x,y){return"translate("+x+","+y+")";};var staggerUp=5,staggerDown=17;xTicks.selectAll("text").attr('transform',function(d,i,j){return getTranslate(0,(j%2==0?staggerUp:staggerDown));});var totalInBetweenTicks=d3.selectAll(".nv-x.nv-axis .nv-wrap g g text")[0].length;g.selectAll(".nv-x.nv-axis .nv-axisMaxMin text").attr("transform",function(d,i){return getTranslate(0,(i===0||totalInBetweenTicks%2!==0)?staggerDown:staggerUp);});}
if(wrapLabels){g.selectAll('.tick text').call(nv.utils.wrapTicks,chart.xAxis.rangeBand())}
if(reduceXTicks)
xTicks.filter(function(d,i){return i%Math.ceil(data[0].values.length/(availableWidth/100))!==0;}).selectAll('text, line').style('opacity',0);if(rotateLabels)
xTicks.selectAll('.tick text').attr('transform','rotate('+rotateLabels+' 0,0)').style('text-anchor',rotateLabels>0?'start':'end');g.select('.nv-x.nv-axis').selectAll('g.nv-axisMaxMin text').style('opacity',1);}
if(showYAxis){yAxis.scale(y)._ticks(nv.utils.calcTicksY(availableHeight/36,data)).tickSize(-availableWidth,0);g.select('.nv-y.nv-axis').call(yAxis);}
if(useInteractiveGuideline){interactiveLayer.width(availableWidth).height(availableHeight).margin({left:margin.left,top:margin.top}).svgContainer(container).xScale(x);wrap.select(".nv-interactive").call(interactiveLayer);}
legend.dispatch.on('stateChange',function(newState){for(var key in newState)
state[key]=newState[key];dispatch.stateChange(state);chart.update();});controls.dispatch.on('legendClick',function(d,i){if(!d.disabled)return;controlsData=controlsData.map(function(s){s.disabled=true;return s;});d.disabled=false;switch(d.key){case'Grouped':case controlLabels.grouped:multibar.stacked(false);break;case'Stacked':case controlLabels.stacked:multibar.stacked(true);break;}
state.stacked=multibar.stacked();dispatch.stateChange(state);chart.update();});dispatch.on('changeState',function(e){if(typeof e.disabled!=='undefined'){data.forEach(function(series,i){series.disabled=e.disabled[i];});state.disabled=e.disabled;}
if(typeof e.stacked!=='undefined'){multibar.stacked(e.stacked);state.stacked=e.stacked;stacked=e.stacked;}
chart.update();});if(useInteractiveGuideline){interactiveLayer.dispatch.on('elementMousemove',function(e){if(e.pointXValue==undefined)return;var singlePoint,pointIndex,pointXLocation,xValue,allData=[];data.filter(function(series,i){series.seriesIndex=i;return!series.disabled;}).forEach(function(series,i){pointIndex=x.domain().indexOf(e.pointXValue)
var point=series.values[pointIndex];if(point===undefined)return;xValue=point.x;if(singlePoint===undefined)singlePoint=point;if(pointXLocation===undefined)pointXLocation=e.mouseX
allData.push({key:series.key,value:chart.y()(point,pointIndex),color:color(series,series.seriesIndex),data:series.values[pointIndex]});});interactiveLayer.tooltip.chartContainer(that.parentNode).data({value:xValue,index:pointIndex,series:allData})();interactiveLayer.renderGuideLine(pointXLocation);});interactiveLayer.dispatch.on("elementMouseout",function(e){interactiveLayer.tooltip.hidden(true);});}
else{multibar.dispatch.on('elementMouseover.tooltip',function(evt){evt.value=chart.x()(evt.data);evt['series']={key:evt.data.key,value:chart.y()(evt.data),color:evt.color};tooltip.data(evt).hidden(false);});multibar.dispatch.on('elementMouseout.tooltip',function(evt){tooltip.hidden(true);});multibar.dispatch.on('elementMousemove.tooltip',function(evt){tooltip();});}});renderWatch.renderEnd('multibarchart immediate');return chart;}
chart.dispatch=dispatch;chart.multibar=multibar;chart.legend=legend;chart.controls=controls;chart.xAxis=xAxis;chart.yAxis=yAxis;chart.state=state;chart.tooltip=tooltip;chart.interactiveLayer=interactiveLayer;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLegend:{get:function(){return showLegend;},set:function(_){showLegend=_;}},showControls:{get:function(){return showControls;},set:function(_){showControls=_;}},controlLabels:{get:function(){return controlLabels;},set:function(_){controlLabels=_;}},showXAxis:{get:function(){return showXAxis;},set:function(_){showXAxis=_;}},showYAxis:{get:function(){return showYAxis;},set:function(_){showYAxis=_;}},defaultState:{get:function(){return defaultState;},set:function(_){defaultState=_;}},noData:{get:function(){return noData;},set:function(_){noData=_;}},reduceXTicks:{get:function(){return reduceXTicks;},set:function(_){reduceXTicks=_;}},rotateLabels:{get:function(){return rotateLabels;},set:function(_){rotateLabels=_;}},staggerLabels:{get:function(){return staggerLabels;},set:function(_){staggerLabels=_;}},wrapLabels:{get:function(){return wrapLabels;},set:function(_){wrapLabels=!!_;}},margin:{get:function(){return margin;},set:function(_){margin.top=_.top!==undefined?_.top:margin.top;margin.right=_.right!==undefined?_.right:margin.right;margin.bottom=_.bottom!==undefined?_.bottom:margin.bottom;margin.left=_.left!==undefined?_.left:margin.left;}},duration:{get:function(){return duration;},set:function(_){duration=_;multibar.duration(duration);xAxis.duration(duration);yAxis.duration(duration);renderWatch.reset(duration);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);legend.color(color);}},rightAlignYAxis:{get:function(){return rightAlignYAxis;},set:function(_){rightAlignYAxis=_;yAxis.orient(rightAlignYAxis?'right':'left');}},useInteractiveGuideline:{get:function(){return useInteractiveGuideline;},set:function(_){useInteractiveGuideline=_;}},barColor:{get:function(){return multibar.barColor;},set:function(_){multibar.barColor(_);legend.color(function(d,i){return d3.rgb('#ccc').darker(i*1.5).toString();})}}});nv.utils.inheritOptions(chart,multibar);nv.utils.initOptions(chart);return chart;};nv.models.pie=function(){"use strict";var margin={top:0,right:0,bottom:0,left:0},width=500,height=500,getX=function(d){return d.x},getY=function(d){return d.y},id=Math.floor(Math.random()*10000),container=null,color=nv.utils.defaultColor(),valueFormat=d3.format(',.2f'),showLabels=true,labelsOutside=false,labelType="key",labelThreshold=.02,donut=false,title=false,growOnHover=true,titleOffset=0,labelSunbeamLayout=false,startAngle=false,padAngle=false,endAngle=false,cornerRadius=0,donutRatio=0.5,arcsRadius=[],dispatch=d3.dispatch('chartClick','elementClick','elementDblClick','elementMouseover','elementMouseout','elementMousemove','renderEnd');var arcs=[];var arcsOver=[];var renderWatch=nv.utils.renderWatch(dispatch);function chart(selection){renderWatch.reset();selection.each(function(data){var availableWidth=width-margin.left-margin.right,availableHeight=height-margin.top-margin.bottom,radius=Math.min(availableWidth,availableHeight)/2,arcsRadiusOuter=[],arcsRadiusInner=[];container=d3.select(this)
if(arcsRadius.length===0){var outer=radius-radius/5;var inner=donutRatio*radius;for(var i=0;i<data[0].length;i++){arcsRadiusOuter.push(outer);arcsRadiusInner.push(inner);}}else{if(growOnHover){arcsRadiusOuter=arcsRadius.map(function(d){return(d.outer-d.outer/5)*radius;});arcsRadiusInner=arcsRadius.map(function(d){return(d.inner-d.inner/5)*radius;});donutRatio=d3.min(arcsRadius.map(function(d){return(d.inner-d.inner/5);}));}else{arcsRadiusOuter=arcsRadius.map(function(d){return d.outer*radius;});arcsRadiusInner=arcsRadius.map(function(d){return d.inner*radius;});donutRatio=d3.min(arcsRadius.map(function(d){return d.inner;}));}}
nv.utils.initSVG(container);var wrap=container.selectAll('.nv-wrap.nv-pie').data(data);var wrapEnter=wrap.enter().append('g').attr('class','nvd3 nv-wrap nv-pie nv-chart-'+id);var gEnter=wrapEnter.append('g');var g=wrap.select('g');var g_pie=gEnter.append('g').attr('class','nv-pie');gEnter.append('g').attr('class','nv-pieLabels');wrap.attr('transform','translate('+margin.left+','+margin.top+')');g.select('.nv-pie').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');g.select('.nv-pieLabels').attr('transform','translate('+availableWidth/2+','+availableHeight/2+')');container.on('click',function(d,i){dispatch.chartClick({data:d,index:i,pos:d3.event,id:id});});arcs=[];arcsOver=[];for(var i=0;i<data[0].length;i++){var arc=d3.svg.arc().outerRadius(arcsRadiusOuter[i]);var arcOver=d3.svg.arc().outerRadius(arcsRadiusOuter[i]+5);if(startAngle!==false){arc.startAngle(startAngle);arcOver.startAngle(startAngle);}
if(endAngle!==false){arc.endAngle(endAngle);arcOver.endAngle(endAngle);}
if(donut){arc.innerRadius(arcsRadiusInner[i]);arcOver.innerRadius(arcsRadiusInner[i]);}
if(arc.cornerRadius&&cornerRadius){arc.cornerRadius(cornerRadius);arcOver.cornerRadius(cornerRadius);}
arcs.push(arc);arcsOver.push(arcOver);}
var pie=d3.layout.pie().sort(null).value(function(d){return d.disabled?0:getY(d)});if(pie.padAngle&&padAngle){pie.padAngle(padAngle);}
if(donut&&title){g_pie.append("text").attr('class','nv-pie-title');wrap.select('.nv-pie-title').style("text-anchor","middle").text(function(d){return title;}).style("font-size",(Math.min(availableWidth,availableHeight))*donutRatio*2/(title.length+2)+"px").attr("dy","0.35em").attr('transform',function(d,i){return'translate(0, '+titleOffset+')';});}
var slices=wrap.select('.nv-pie').selectAll('.nv-slice').data(pie);var pieLabels=wrap.select('.nv-pieLabels').selectAll('.nv-label').data(pie);slices.exit().remove();pieLabels.exit().remove();var ae=slices.enter().append('g');ae.attr('class','nv-slice');ae.on('mouseover',function(d,i){d3.select(this).classed('hover',true);if(growOnHover){d3.select(this).select("path").transition().duration(70).attr("d",arcsOver[i]);}
dispatch.elementMouseover({data:d.data,index:i,color:d3.select(this).style("fill")});});ae.on('mouseout',function(d,i){d3.select(this).classed('hover',false);if(growOnHover){d3.select(this).select("path").transition().duration(50).attr("d",arcs[i]);}
dispatch.elementMouseout({data:d.data,index:i});});ae.on('mousemove',function(d,i){dispatch.elementMousemove({data:d.data,index:i});});ae.on('click',function(d,i){var element=this;dispatch.elementClick({data:d.data,index:i,color:d3.select(this).style("fill"),event:d3.event,element:element});});ae.on('dblclick',function(d,i){dispatch.elementDblClick({data:d.data,index:i,color:d3.select(this).style("fill")});});slices.attr('fill',function(d,i){return color(d.data,i);});slices.attr('stroke',function(d,i){return color(d.data,i);});var paths=ae.append('path').each(function(d){this._current=d;});slices.select('path').transition().attr('d',function(d,i){return arcs[i](d);}).attrTween('d',arcTween);if(showLabels){var labelsArc=[];for(var i=0;i<data[0].length;i++){labelsArc.push(arcs[i]);if(labelsOutside){if(donut){labelsArc[i]=d3.svg.arc().outerRadius(arcs[i].outerRadius());if(startAngle!==false)labelsArc[i].startAngle(startAngle);if(endAngle!==false)labelsArc[i].endAngle(endAngle);}}else if(!donut){labelsArc[i].innerRadius(0);}}
pieLabels.enter().append("g").classed("nv-label",true).each(function(d,i){var group=d3.select(this);group.attr('transform',function(d,i){if(labelSunbeamLayout){d.outerRadius=arcsRadiusOuter[i]+10;d.innerRadius=arcsRadiusOuter[i]+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc[i].centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;return'translate('+labelsArc[i].centroid(d)+')'}});group.append('rect').style('stroke','#fff').style('fill','#fff').attr("rx",3).attr("ry",3);group.append('text').style('text-anchor',labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle').style('fill','#000')});var labelLocationHash={};var avgHeight=14;var avgWidth=140;var createHashKey=function(coordinates){return Math.floor(coordinates[0]/avgWidth)*avgWidth+','+Math.floor(coordinates[1]/avgHeight)*avgHeight;};var getSlicePercentage=function(d){return(d.endAngle-d.startAngle)/(2*Math.PI);};pieLabels.watchTransition(renderWatch,'pie labels').attr('transform',function(d,i){if(labelSunbeamLayout){d.outerRadius=arcsRadiusOuter[i]+10;d.innerRadius=arcsRadiusOuter[i]+15;var rotateAngle=(d.startAngle+d.endAngle)/2*(180/Math.PI);if((d.startAngle+d.endAngle)/2<Math.PI){rotateAngle-=90;}else{rotateAngle+=90;}
return'translate('+labelsArc[i].centroid(d)+') rotate('+rotateAngle+')';}else{d.outerRadius=radius+10;d.innerRadius=radius+15;var center=labelsArc[i].centroid(d);var percent=getSlicePercentage(d);if(d.value&&percent>=labelThreshold){var hashKey=createHashKey(center);if(labelLocationHash[hashKey]){center[1]-=avgHeight;}
labelLocationHash[createHashKey(center)]=true;}
return'translate('+center+')'}});pieLabels.select(".nv-label text").style('text-anchor',function(d,i){return labelSunbeamLayout?((d.startAngle+d.endAngle)/2<Math.PI?'start':'end'):'middle';}).text(function(d,i){var percent=getSlicePercentage(d);var label='';if(!d.value||percent<labelThreshold)return'';if(typeof labelType==='function'){label=labelType(d,i,{'key':getX(d.data),'value':getY(d.data),'percent':valueFormat(percent)});}else{switch(labelType){case'key':label=getX(d.data);break;case'value':label=valueFormat(getY(d.data));break;case'percent':label=d3.format('%')(percent);break;}}
return label;});}
function angle(d){var a=(d.startAngle+d.endAngle)*90/Math.PI-90;return a>90?a-180:a;}
function arcTween(a,idx){a.endAngle=isNaN(a.endAngle)?0:a.endAngle;a.startAngle=isNaN(a.startAngle)?0:a.startAngle;if(!donut)a.innerRadius=0;var i=d3.interpolate(this._current,a);this._current=i(0);return function(t){return arcs[idx](i(t));};}});renderWatch.renderEnd('pie immediate');return chart;}
chart.dispatch=dispatch;chart.options=nv.utils.optionsFunc.bind(chart);chart._options=Object.create({},{arcsRadius:{get:function(){return arcsRadius;},set:function(_){arcsRadius=_;}},width:{get:function(){return width;},set:function(_){width=_;}},height:{get:function(){return height;},set:function(_){height=_;}},showLabels:{get:function(){return showLabels;},set:function(_){showLabels=_;}},title:{get:function(){return title;},set:function(_){title=_;}},titleOffset:{get:function(){return titleOffset;},set:function(_){titleOffset=_;}},labelThreshold:{get:function(){return labelThreshold;},set:function(_){labelThreshold=_;}},valueFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;}},x:{get:function(){return getX;},set:function(_){getX=_;}},id:{get:function(){return id;},set:function(_){id=_;}},endAngle:{get:function(){return endAngle;},set:function(_){endAngle=_;}},startAngle:{get:function(){return startAngle;},set:function(_){startAngle=_;}},padAngle:{get:function(){return padAngle;},set:function(_){padAngle=_;}},cornerRadius:{get:function(){return cornerRadius;},set:function(_){cornerRadius=_;}},donutRatio:{get:function(){return donutRatio;},set:function(_){donutRatio=_;}},labelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;}},labelSunbeamLayout:{get:function(){return labelSunbeamLayout;},set:function(_){labelSunbeamLayout=_;}},donut:{get:function(){return donut;},set:function(_){donut=_;}},growOnHover:{get:function(){return growOnHover;},set:function(_){growOnHover=_;}},pieLabelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;nv.deprecated('pieLabelsOutside','use labelsOutside instead');}},donutLabelsOutside:{get:function(){return labelsOutside;},set:function(_){labelsOutside=_;nv.deprecated('donutLabelsOutside','use labelsOutside instead');}},labelFormat:{get:function(){return valueFormat;},set:function(_){valueFormat=_;nv.deprecated('labelFormat','use valueFormat instead');}},margin:{get:function(){return margin;},set:function(_){margin.top=typeof _.top!='undefined'?_.top:margin.top;margin.right=typeof _.right!='undefined'?_.right:margin.right;margin.bottom=typeof _.bottom!='undefined'?_.bottom:margin.bottom;margin.left=typeof _.left!='undefined'?_.left:margin.left;}},y:{get:function(){return getY;},set:function(_){getY=d3.functor(_);}},color:{get:function(){return color;},set:function(_){color=nv.utils.getColor(_);}},labelType:{get:function(){return labelType;},set:function(_){labelType=_||'key';}}});nv.utils.initOptions(chart);return chart;};nv.version="1.8.2-dev";})();;

/* /web/static/lib/backbone/backbone.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;

/* /web/static/lib/fuzzy-master/fuzzy.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var fuzzy={};if(typeof exports!=='undefined'){module.exports=fuzzy;}else{root.fuzzy=fuzzy;}
fuzzy.simpleFilter=function(pattern,array){return array.filter(function(string){return fuzzy.test(pattern,string);});};fuzzy.test=function(pattern,string){return fuzzy.match(pattern,string)!==null;};fuzzy.match=function(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||'',post=opts.post||'',compareString=opts.caseSensitive&&string||string.toLowerCase(),ch,compareChar;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();for(var idx=0;idx<len;idx++){ch=string[idx];if(compareString[idx]===pattern[patternIdx]){ch=pre+ch+post;patternIdx+=1;currScore+=1+currScore-idx/1000;}else{currScore=0;}
totalScore+=currScore;result[result.length]=ch;}
if(patternIdx===pattern.length){return{rendered:result.join(''),score:totalScore};}
return null;};fuzzy.filter=function(pattern,arr,opts){if(!arr||arr.length===0){return[]}
if(typeof pattern!=='string'){return arr}
opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);}
var rendered=fuzzy.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element};}
return prev;},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index;});};}());;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo._modules=["web","web_kanban","base","web_responsive","backend_theme_v10","jasper_reports","web_readonly_bypass","web_widget_image_webcam","web_widget_float_formula","web_no_bubble","table_header_freeze","rowno_in_tree","database_cleanup","c10i_base","bus","web_tour","mail","report","product","barcodes","web_planner","stock","mrp","account","account_accountant","account_parent","payment","report_xlsx","c10i_account","account_cost_center","c10i_account_location","c10i_stock","c10i_stock_account","c10i_stock_manual_valuation","c10i_palm_oil_mill","purchase","c10i_purchase","operating_unit","analytic_operating_unit","account_operating_unit","stock_operating_unit","procurement_operating_unit","purchase_operating_unit","c10i_purchase_operating_unit","hr","web_calendar","calendar","hr_holidays","hr_public_holidays","sales_team","sale","sale_stock","muk_web_preview","muk_web_preview_msoffice","base_import","c10i_stock_inventory","c10i_stock_price_loc","c10i_stock_inter_warehouse","payment_transfer","c10i_hr","sjai_account_finance_report","c10i_purchase_request","c10i_sale","c10i_account_invoice_advance","c10i_document_type","sjm_base","sjm_base_lpg","web_editor","web_settings_dashboard","c10i_account_faktur_pajak","account_asset","c10i_account_asset","c10i_bea_cukai","sjm_stock","sjm_purchase","sjm_sale","sjim_weighbridge","c10i_document_type_operating_unit","account_bank_statement_import","c10i_account_invoice_advance_operating_unit","c10i_account_multicurrency_revaluation","web_kanban_gauge","stock_picking_invoice_link","hr_attendance","c10i_hr_attendance","c10i_hr_attendance_palm_oil","web_diagram","sjim_account_payment_instruction","sjm_account","c10i_purchase_asset","portal"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^']*)'",'([uU])?"([^"]*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end=undefined;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');var initial=token[0];if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:(m[3]!==undefined?m[3]:m[5])}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/framework/data_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataModel',function(require){"use strict";var data=require('web.data');var Model=require('web.Model');var pyeval=require('web.pyeval');var session=require('web.session');Model.include({query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return new data.CompoundDomain(this._domain,domain);},context:function(context){return new data.CompoundContext(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyeval.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyeval.ensure_evaluated(args,{});return session.rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});return Model;});;

/* /web/static/src/js/framework/formats.js defined in bundle 'web.assets_backend' */
odoo.define('web.formats',function(require){"use strict";var translation=require('web.translation');var time=require('web.time');var utils=require('web.utils');var _t=translation._t;function format_value(value,descriptor,value_if_empty){var l10n=_t.database.parameters;var date_format=time.strftime_to_moment_format(l10n.date_format);var time_format=time.strftime_to_moment_format(l10n.time_format);if(typeof value==='number'&&isNaN(value)){value=false;}
switch(value){case'':if(descriptor.type==='char'||descriptor.type==='text'){return'';}
console.warn('Field',descriptor,'had an empty string as value, treating as false...');return value_if_empty===undefined?'':value_if_empty;case false:case undefined:case Infinity:case-Infinity:return value_if_empty===undefined?'':value_if_empty;}
switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'id':return value.toString();case'integer':return utils.insert_thousand_seps(_.str.sprintf('%d',value));case'monetary':case'float':var digits=descriptor.digits?descriptor.digits:[69,2];digits=typeof digits==="string"?py.eval(digits):digits;var precision=digits[1];var formatted=_.str.sprintf('%.'+precision+'f',value).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);case'float_time':var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min==60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);case'many2one':return value[1]?value[1].split("\n")[0]:value[1];case'one2many':case'many2many':if(typeof value==='string'){return value;}
return _.str.sprintf(_t("(%d records)"),value.length);case'datetime':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(date_format+' '+time_format);case'date':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(date_format);case'time':if(typeof(value)=="string")
value=moment(time.auto_str_to_date(value));else{value=moment(value);}
return value.format(time_format);case'selection':case'statusbar':if(_.isArray(value)){return value[1];}
var result=_(descriptor.selection).detect(function(choice){return choice[0]===value;});if(result){return result[1];}
return;default:return value;}}
function parse_value(value,descriptor,value_if_empty){var date_pattern=time.strftime_to_moment_format(_t.database.parameters.date_format),time_pattern=time.strftime_to_moment_format(_t.database.parameters.time_format);var date_pattern_wo_zero=date_pattern.replace('MM','M').replace('DD','D'),time_pattern_wo_zero=time_pattern.replace('HH','H').replace('mm','m').replace('ss','s');switch(value){case false:case"":return value_if_empty===undefined?false:value_if_empty;}
var tmp;switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'integer':do{tmp=value;value=value.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==value);tmp=Number(value);if(isNaN(tmp)||tmp%1||tmp<-2147483648||tmp>2147483647)
throw new Error(_.str.sprintf(_t("'%s' is not a correct integer"),value));return tmp;case'monetary':case'float':var tmp2=value;do{tmp=tmp2;tmp2=tmp.replace(_t.database.parameters.thousands_sep,"");}while(tmp!==tmp2);var reformatted_value=tmp.replace(_t.database.parameters.decimal_point,".");var parsed=Number(reformatted_value);if(isNaN(parsed))
throw new Error(_.str.sprintf(_t("'%s' is not a correct float"),value));return parsed;case'float_time':var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!=2)
return factor*parse_value(value,{type:"float"});var hours=parse_value(float_time_pair[0],{type:"integer"});var minutes=parse_value(float_time_pair[1],{type:"integer"});return factor*(hours+(minutes/60));case'progressbar':return parse_value(value,{type:"float"});case'datetime':var datetime=moment(value,[date_pattern+' '+time_pattern,date_pattern_wo_zero+' '+time_pattern_wo_zero,moment.ISO_8601],true);if(datetime.isValid()&&datetime.year()>=1900)
return time.datetime_to_str(datetime.toDate());datetime=moment(value,[date_pattern+' '+time_pattern,date_pattern_wo_zero+' '+time_pattern_wo_zero,moment.ISO_8601]);if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
if(datetime.year()>=1900){return time.datetime_to_str(datetime.toDate());}}
throw new Error(_.str.sprintf(_t("'%s' is not a correct datetime"),value));case'date':var date=moment(value,[date_pattern,date_pattern_wo_zero,moment.ISO_8601],true);if(date.isValid()&&date.year()>=1900)
return time.date_to_str(date.toDate());date=moment(value,[date_pattern,date_pattern_wo_zero,moment.ISO_8601]);if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
if(date.year()>=1900){return time.date_to_str(date.toDate());}}
throw new Error(_.str.sprintf(_t("'%s' is not a correct date"),value));case'time':var _time=moment(value,[time_pattern,time_pattern_wo_zero,moment.ISO_8601],true);if(_time.isValid())
return time.time_to_str(_time.toDate());throw new Error(_.str.sprintf(_t("'%s' is not a correct time"),value));}
return value;}
return{format_value:format_value,parse_value:parse_value,};});;

/* /web/static/src/js/framework/view.js defined in bundle 'web.assets_backend' */
odoo.define('web.View',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var pyeval=require('web.pyeval');var Widget=require('web.Widget');var View=Widget.extend({events:{'click a[type=action]':function(ev){ev.preventDefault();var action_data=$(ev.target).attr('name');this.do_action(action_data);}},defaults:{action:{},},display_name:'',searchable:true,searchview_hidden:false,multi_record:true,mobile_friendly:false,icon:'fa-question',require_fields:false,init:function(parent,dataset,fields_view,options){this._super(parent);this.ViewManager=parent;this.dataset=dataset;this.model=dataset.model;this.fields_view=fields_view;this.options=_.defaults({},options,this.defaults);},start:function(){this.$el.toggleClass('o_cannot_create',!this.is_action_enabled('create'));return this._super().then(this.trigger.bind(this,'view_loaded'));},do_execute_action:function(action_data,dataset,record_id,on_closed){var self=this;var result_handler=function(){if(on_closed){on_closed.apply(null,arguments);}
if(self.getParent()&&self.getParent().on_action_executed){return self.getParent().on_action_executed.apply(null,arguments);}};var context=new data.CompoundContext(dataset.get_context(),action_data.context||{});var handler=function(action){if(action&&action.constructor===Object){var ncontext=new data.CompoundContext(_.object(_.reject(_.pairs(dataset.get_context().eval()),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|.+_view_ref|group_by|group_by_no_leaf|active_id|active_ids)$')!==null;})));ncontext.add(action_data.context||{});ncontext.add({active_model:dataset.model});if(record_id){ncontext.add({active_id:record_id,active_ids:[record_id],});}
ncontext.add(action.context||{});action.context=ncontext;return self.do_action(action,{on_close:result_handler,});}else{self.do_action({"type":"ir.actions.act_window_close"});return result_handler();}};if(action_data.special==='cancel'){return handler({"type":"ir.actions.act_window_close"});}else if(action_data.type==="object"){var args=record_id?[[record_id]]:[dataset.ids];if(action_data.args){try{var additional_args=JSON.parse(action_data.args.replace(/'/g,'"'));args=args.concat(additional_args);}catch(e){console.error("Could not JSON.parse arguments",action_data.args);}}
args.push(context);return dataset.call_button(action_data.name,args).then(handler).then(function(){core.bus.trigger('do_reload_needaction');});}else if(action_data.type==="action"){return data_manager.load_action(action_data.name,_.extend(pyeval.eval('context',context),{active_model:dataset.model,active_ids:dataset.ids,active_id:record_id})).then(handler);}else{return dataset.exec_workflow(record_id,action_data.name).then(handler);}},do_show:function(){this._super();core.bus.trigger('view_shown',this);},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){this.getParent().do_push_state(state);}},do_load_state:function(state,warm){},render_buttons:function($node){},render_sidebar:function($node){},render_pager:function($node){},do_switch_view:function(){this.trigger.apply(this,['switch_mode'].concat(_.toArray(arguments)));},do_search:function(domain,context,group_by){},sidebar_eval_context:function(){return $.when({});},reload:function(){return $.when();},is_action_enabled:function(action){var attrs=this.fields_view.arch.attrs;return(action in attrs)?JSON.parse(attrs[action]):true;},get_context:function(){return{};},destroy:function(){if(this.$buttons){this.$buttons.off();}
return this._super.apply(this,arguments);},set_scrollTop:function(scrollTop){this.scrollTop=scrollTop;},get_scrollTop:function(){return this.scrollTop;}});return View;});;

/* /web/static/src/js/framework/pyeval.js defined in bundle 'web.assets_backend' */
odoo.define('web.pyeval',function(require){"use strict";var core=require('web.core');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var py=window.py;var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;utils.divmod(n,DI400Y,function(_n400,n){n400=_n400;utils.divmod(n,DI100Y,function(_n100,n){n100=_n100;utils.divmod(n,DI4Y,function(_n4,n){n4=_n4;utils.divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){utils.assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);utils.assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){utils.divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){utils.divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){utils.divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){utils.divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){utils.divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=utils.modf(days,function(dayfrac,days){d=days;if(dayfrac){return utils.modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=utils.modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;utils.divmod(microseconds,1000000,function(seconds,microseconds){utils.divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;utils.divmod(this.seconds,60,function(m,s){utils.divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});function context_today(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day '
+'years months weeks days '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':return[arg,zero];case'year':case'month':case'day':case'weekday':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0)},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;var r=utils.divmod(months*s,12);this.ops.months=py.float.fromJSON(r.mod*s);this.ops.years=py.float.fromJSON(asJS(this.ops.years)+r.div*s);}
this._has_time=0;},__add__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days)}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday});}});function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];var need_normalization=(domains&&domains.length>0&&domains[0].length===1&&(domains[0][0]==="|"||domains[0][0]==="!"));_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
var domain_array_to_combine;switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;domain_array_to_combine=py.eval(domain.__debug,wrap_context(evaluation_context));break;case'compound_domain':var eval_context=eval_contexts([domain.__eval_context]);domain_array_to_combine=eval_domains(domain.__domains,_.extend({},evaluation_context,eval_context));break;default:domain_array_to_combine=domain;}
if(need_normalization){domain_array_to_combine=get_normalized_domain(domain_array_to_combine);}
result_domain.push.apply(result_domain,domain_array_to_combine);});return result_domain;}
function get_normalized_domain(domain_array){var expected=1;_.each(domain_array,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});var new_explicit_ands=_.times(-expected,_.constant("&"));return new_explicit_ands.concat(domain_array);}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function pycontext(){return _.extend({datetime:datetime,context_today:context_today,time:time,relativedelta:relativedelta,current_date:py.PY_call(time.strftime,[py.str.fromJSON('%Y-%m-%d')]),},session.user_context);}
function pyeval(type,object,context,options){options=options||{};context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context')
object=[object];return eval_contexts((options.no_user_context?[]:[session.user_context]).concat(object),context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':case'compound_domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return new $.Deferred(function(d){setTimeout(function(){var result;try{result=sync_eval_domains_and_contexts(source);}
catch(e){result={error:{code:400,message:_t("Evaluation Error"),data:{type:'local_exception',debug:_.str.sprintf(_t("Local evaluation failure\n%s\n\n%s"),e.message,JSON.stringify(source))}}};}
d.resolve(result);},0);});}
function sync_eval_domains_and_contexts(source){var contexts=([session.user_context]||[]).concat(source.contexts);return{context:pyeval('contexts',contexts),domain:pyeval('domains',source.domains),group_by:pyeval('groupbys',source.group_by_seq||[])};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,sync_eval_domains_and_contexts:sync_eval_domains_and_contexts,py_eval:py_eval,};});;

/* /web/static/src/js/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var Bus=require('web.Bus');var ControlPanel=require('web.ControlPanel');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var session=require('web.session');var ViewManager=require('web.ViewManager');var Widget=require('web.Widget');var Action=core.Class.extend({init:function(action){this.action_descr=action;this.title=action.display_name||action.name;},restore:function(){if(this.on_reverse_breadcrumb_callback){return this.on_reverse_breadcrumb_callback();}},detach:function(){},destroy:function(){},set_on_reverse_breadcrumb:function(callback){this.on_reverse_breadcrumb_callback=callback;},set_scrollTop:function(){},set_fragment:function($fragment){this.$fragment=$fragment;},get_scrollTop:function(){return 0;},get_action_descr:function(){return this.action_descr;},get_breadcrumbs:function(){return{title:this.title,action:this};},get_nb_views:function(){return 0;},get_fragment:function(){return this.$fragment;},get_active_view:function(){return'';},});var WidgetAction=Action.extend({init:function(action,widget){this._super(action);this.widget=widget;if(!this.widget.get('title')){this.widget.set('title',this.title);}
this.widget.on('change:title',this,function(widget){this.title=widget.get('title');});},restore:function(){var self=this;return $.when(this._super()).then(function(){return self.widget.do_show();});},detach:function(){$('body > .nvtooltip').remove();return framework.detach([{widget:this.widget}]);},destroy:function(){this.widget.destroy();},});var ViewManagerAction=WidgetAction.extend({restore:function(view_index){var _super=this._super.bind(this);return this.widget.select_view(view_index).then(function(){return _super();});},set_on_reverse_breadcrumb:function(callback,scrollTop){this._super(callback);this.set_scrollTop(scrollTop);},set_scrollTop:function(scrollTop){if(this.widget.active_view&&this.widget.active_view.controller){this.widget.active_view.controller.set_scrollTop(scrollTop);}},get_scrollTop:function(){if(this.widget.active_view&&this.widget.active_view.controller){return this.widget.active_view.controller.get_scrollTop();}
return this._super.apply(this,arguments);},get_breadcrumbs:function(){var self=this;return this.widget.view_stack.map(function(view,index){return{title:view.controller.get('title')||self.title,index:index,action:self,};});},get_nb_views:function(){return this.widget.view_stack.length;},get_active_view:function(){return this.widget.active_view.type;}});var ActionManager=Widget.extend({template:'ActionManager',on_attach_callback:function(){this.is_in_DOM=true;if(this.inner_widget&&this.inner_widget.on_attach_callback){this.inner_widget.on_attach_callback();}},on_detach_callback:function(){this.is_in_DOM=false;if(this.inner_widget&&this.inner_widget.on_detach_callback){this.inner_widget.on_detach_callback();}},init:function(parent,options){this._super(parent);this.action_stack=[];this.inner_action=null;this.inner_widget=null;this.webclient=options&&options.webclient;this.dialog=null;this.dialog_widget=null;this.on('history_back',this,this.proxy('history_back'));},start:function(){this._super();this.main_control_panel=new ControlPanel(this);this.main_control_panel.on("on_breadcrumb_click",this,_.debounce(function(action,index){this.select_action(action,index);},200,true));core.bus.on('DOM_updated',this,function(){if(this.inner_action){this.trigger_up('scrollTo',{offset:this.inner_action.get_scrollTop()||0});}});return this.main_control_panel.insertBefore(this.$el);},dialog_stop:function(reason){if(this.dialog){this.dialog.destroy(reason);}
this.dialog=null;},push_action:function(widget,action_descr,options){var self=this;var old_action_stack=this.action_stack;var old_action=this.inner_action;var old_widget=this.inner_widget;var actions_to_destroy;options=options||{};if(options.clear_breadcrumbs){actions_to_destroy=this.action_stack;this.action_stack=[];}else if(options.replace_last_action&&this.action_stack.length>0){actions_to_destroy=[this.action_stack.pop()];}
var new_action;if(widget instanceof ViewManager){new_action=new ViewManagerAction(action_descr,widget);}else if(widget instanceof Widget){new_action=new WidgetAction(action_descr,widget);}else{new_action=new Action(action_descr);}
if(this.webclient&&old_action){old_action.set_on_reverse_breadcrumb(options.on_reverse_breadcrumb,this.webclient.get_scrollTop());}
this.action_stack.push(new_action);this.inner_action=new_action;this.inner_widget=widget;if(widget.need_control_panel){widget.set_cp_bus(this.main_control_panel.get_bus());}
var new_widget_fragment=document.createDocumentFragment();return $.when(this.inner_widget.appendTo(new_widget_fragment)).done(function(){if(old_action){old_action.set_fragment(old_action.detach());}
if(!widget.need_control_panel){self.main_control_panel.do_hide();}
framework.append(self.$el,new_widget_fragment,{in_DOM:self.is_in_DOM,callbacks:[{widget:self.inner_widget}],});if(actions_to_destroy){self.clear_action_stack(actions_to_destroy);}
self.toggle_fullscreen();self.trigger_up('current_action_updated',{action:new_action});}).fail(function(){new_action.destroy();self.action_stack=old_action_stack;self.inner_action=old_action;self.inner_widget=old_widget;});},set_scrollTop:function(scrollTop){if(this.inner_action){this.inner_action.set_scrollTop(scrollTop);}},get_breadcrumbs:function(){return _.flatten(_.map(this.action_stack,function(action){return action.get_breadcrumbs();}),true);},get_title:function(){if(this.action_stack.length===1){var action=this.action_stack[0];if(action.get_breadcrumbs().length===1){return action.title;}}
var last_breadcrumb=_.last(this.get_breadcrumbs());return last_breadcrumb?last_breadcrumb.title:"";},get_action_stack:function(){return this.action_stack;},get_inner_action:function(){return this.inner_action;},get_inner_widget:function(){return this.inner_widget;},history_back:function(){if(this.dialog){this.dialog_stop();return;}
var nb_views=this.inner_action.get_nb_views();if(nb_views>1){return this.select_action(this.inner_action,nb_views-2);}
if(this.action_stack.length>1){var action=this.action_stack[this.action_stack.length-2];nb_views=action.get_nb_views();return this.select_action(action,nb_views-1);}
return $.Deferred().reject();},select_action:function(action,index){var self=this;var def=this.webclient&&this.webclient.clear_uncommitted_changes()||$.when();return def.then(function(){var old_action=self.inner_action;var action_index=self.action_stack.indexOf(action);var to_destroy=self.action_stack.splice(action_index+1);self.inner_action=action;self.inner_widget=action.widget;return $.when(action.restore(index)).done(function(){if(!self.inner_widget.need_control_panel){self.main_control_panel.do_hide();}
if(action!==old_action){self.clear_action_stack(to_destroy);framework.append(self.$el,action.get_fragment(),{in_DOM:self.is_in_DOM,callbacks:[{widget:action.widget}],});}
self.trigger_up('current_action_updated',{action:action});});}).fail(function(){return $.Deferred().reject();});},clear_action_stack:function(action_stack){_.map(action_stack||this.action_stack,function(action){action.destroy();});if(!action_stack){this.action_stack=[];this.inner_action=null;this.inner_widget=null;}
this.toggle_fullscreen();},toggle_fullscreen:function(){var is_fullscreen=_.some(this.action_stack,function(action){return action.action_descr.target==="fullscreen";});this.trigger_up("toggle_fullscreen",{fullscreen:is_fullscreen});},do_push_state:function(state){if(!this.webclient||this.dialog){return;}
state=state||{};if(this.inner_action){var inner_action_descr=this.inner_action.get_action_descr();if(inner_action_descr._push_me===false){return;}
state.title=this.get_title();if(inner_action_descr.type=='ir.actions.act_window'){state.model=inner_action_descr.res_model;}
if(inner_action_descr.menu_id){state.menu_id=inner_action_descr.menu_id;}
if(inner_action_descr.id){state.action=inner_action_descr.id;}else if(inner_action_descr.type=='ir.actions.client'){state.action=inner_action_descr.tag;var params={};_.each(inner_action_descr.params,function(v,k){if(_.isString(v)||_.isNumber(v)){params[k]=v;}});state=_.extend(params||{},state);}
if(inner_action_descr.context){var active_id=inner_action_descr.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=inner_action_descr.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=inner_action_descr.context.active_ids.join(',');}}}
this.webclient.do_push_state(state);},do_load_state:function(state,warm){var self=this;var action_loaded;if(state.action){if(_.isString(state.action)&&core.action_registry.contains(state.action)){var action_client={type:"ir.actions.client",tag:state.action,params:state,_push_me:state._push_me,};if(warm){this.null_action();}
action_loaded=this.do_action(action_client);}else{var run_action=(!this.inner_widget||!this.inner_widget.action)||this.inner_widget.action.id!==state.action;if(run_action){var add_context={};if(state.active_id){add_context.active_id=state.active_id;}
if(state.active_ids){add_context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){add_context.active_ids=[state.active_id];}
add_context.params=state;if(warm){this.null_action();}
action_loaded=this.do_action(state.action,{additional_context:add_context,res_id:state.id,view_type:state.view_type,});}}}else if(state.model&&state.id){if(warm){this.null_action();}
var action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[_.isNumber(state.view_id)?state.view_id:false,'form']]};action_loaded=this.do_action(action);}else if(state.sa){if(warm){this.null_action();}
action_loaded=this.rpc('/web/session/get_session_action',{key:state.sa}).then(function(action){if(action){return self.do_action(action);}});}
return $.when(action_loaded||null).done(function(){if(self.inner_widget&&self.inner_widget.do_load_state){return self.inner_widget.do_load_state(state,warm);}});},do_action:function(action,options){options=_.defaults(options||{},{clear_breadcrumbs:false,replace_last_action:false,on_reverse_breadcrumb:function(){},hide_breadcrumb:false,on_close:function(){},action_menu_id:null,additional_context:{},});if(action===false){action={type:'ir.actions.act_window_close'};}else if(_.isString(action)&&core.action_registry.contains(action)){var action_client={type:"ir.actions.client",tag:action,params:{}};return this.do_action(action_client,options);}else if(_.isNumber(action)||_.isString(action)){var self=this;var additional_context={active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model};return data_manager.load_action(action,additional_context).then(function(result){return self.do_action(result,options);});}
core.bus.trigger('action',action);options.clear_breadcrumbs=(action.target==='main')||options.clear_breadcrumbs;var ncontext=new data.CompoundContext(options.additional_context,action.context||{});action.context=pyeval.eval('context',ncontext);if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
if(action.domain){action.domain=pyeval.eval('domain',action.domain,action.context||{});}
if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
var type=action.type.replace(/\./g,'_');action.menu_id=options.action_menu_id;action.res_id=options.res_id||action.res_id;action.context.params=_.extend({'action':action.id},action.context.params);if(!(type in this)){console.error("Action manager can't handle action of type "+action.type,action);return $.Deferred().reject();}
if(action.res_model==='board.board'&&action.view_mode==='form'){action.target='inline';_.extend(action.flags,{headless:true,views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}else{var popup=action.target==='new';var inline=action.target==='inline'||action.target==='inlineview';var form=_.str.startsWith(action.view_mode,'form');action.flags=_.defaults(action.flags||{},{views_switcher:!popup&&!inline,search_view:!(popup&&form)&&!inline,action_buttons:!popup&&!inline,sidebar:!popup&&!inline,pager:(!popup||!form)&&!inline,display_title:!popup,headless:(popup||inline)&&form,search_disable_custom_filters:action.context&&action.context.search_disable_custom_filters,});}
return $.when(this[type](action,options)).then(function(){return action;});},null_action:function(){this.dialog_stop();this.clear_action_stack();},ir_actions_common:function(executor,options){var self=this;if(executor.action.target==='new'){var pre_dialog=(this.dialog&&!this.dialog.isDestroyed())?this.dialog:null;if(pre_dialog){pre_dialog.off('closed',null,pre_dialog.on_close);}
if(this.dialog_widget&&!this.dialog_widget.isDestroyed()){this.dialog_widget.destroy();}
this.dialog_stop(executor.action);this.dialog=new Dialog(this,{title:executor.action.name,dialogClass:executor.klass,buttons:[],size:executor.action.context.dialog_size,});this.dialog.on_close=function(){options.on_close.apply(null,arguments);if(pre_dialog&&pre_dialog.on_close){pre_dialog.on_close();}
if(!pre_dialog){self.dialog=null;}};this.dialog.on("closed",null,this.dialog.on_close);this.dialog_widget=executor.widget();if(this.dialog_widget instanceof ViewManager){_.extend(this.dialog_widget.flags,{$buttons:this.dialog.$footer,footer_to_buttons:true,});if(this.dialog_widget.action.view_mode==='form'){this.dialog_widget.flags.headless=true;}}
if(this.dialog_widget.need_control_panel){this.dialog_widget.set_cp_bus(new Bus());}
this.dialog_widget.setParent(this.dialog);var fragment=document.createDocumentFragment();return this.dialog_widget.appendTo(fragment).then(function(){self.dialog.open().$el.append(fragment);if(options.state&&self.dialog_widget.do_load_state){return self.dialog_widget.do_load_state(options.state);}}).then(function(){return executor.action;});}
var def=this.inner_action&&this.webclient&&this.webclient.clear_uncommitted_changes()||$.when();return def.then(function(){self.dialog_stop(executor.action);return self.push_action(executor.widget(),executor.action,options);}).fail(function(){return $.Deferred().reject();});},ir_actions_act_window:function(action,options){var self=this;var flags=action.flags||{};if(!('auto_search'in flags)){flags.auto_search=action.auto_search!==false;}
options.action=action;options.action_manager=this;var dataset=new data.DataSetSearch(this,action.res_model,action.context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
var views=action.views;return this.ir_actions_common({widget:function(){return new ViewManager(self,dataset,views,flags,options);},action:action,klass:'o_act_window',},options);},ir_actions_client:function(action,options){var self=this;var ClientWidget=core.action_registry.get(action.tag);if(!ClientWidget){return self.do_warn("Action Error","Could not find client action '"+action.tag+"'.");}
if(!(ClientWidget.prototype instanceof Widget)){var next;if((next=ClientWidget(this,action))){return this.do_action(next,options);}
return $.when();}
return this.ir_actions_common({widget:function(){return new ClientWidget(self,action,options);},action:action,klass:'oe_act_client',},options).then(function(){if(action.tag!=='reload'){self.do_push_state({});}});},ir_actions_act_window_close:function(action,options){if(!this.dialog){options.on_close();}
this.dialog_stop();return $.when();},ir_actions_server:function(action,options){var self=this;return this.rpc('/web/action/run',{action_id:action.id,context:action.context||{}}).then(function(action){return self.do_action(action,options);});},ir_actions_report_xml:function(action,options){var self=this;framework.blockUI();action=_.clone(action);var eval_contexts=([session.user_context]||[]).concat([action.context]);action.context=pyeval.eval('contexts',eval_contexts);if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){var params={action:JSON.stringify(action),token:new Date().getTime()};var url=self.session.url('/web/report',params);framework.unblockUI();$('<a href="'+url+'" target="_blank"></a>')[0].click();return;}
var c=crash_manager;return $.Deferred(function(d){self.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:framework.unblockUI,success:function(){if(!self.dialog){options.on_close();}
self.dialog_stop();d.resolve();},error:function(){c.rpc_error.apply(c,arguments);d.reject();}});});},ir_actions_act_url:function(action,options){var url=action.url;if(session.debug&&url&&url.length&&url[0]==='/'){url=$.param.querystring(url,{debug:session.debug});}
if(action.target==='self'){framework.redirect(url);return $.Deferred();}else{window.open(url,'_blank');options.on_close();}
return $.when();},});return ActionManager;});;

/* /web/static/src/js/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelMixin',function(require){"use strict";var ControlPanelMixin={need_control_panel:true,set_cp_bus:function(cp_bus){this.cp_bus=cp_bus;},update_control_panel:function(cp_status,options){this.cp_bus.trigger("update",cp_status||{},options||{});},};return ControlPanelMixin;});odoo.define('web.ControlPanel',function(require){"use strict";var Bus=require('web.Bus');var data=require('web.data');var Widget=require('web.Widget');var ControlPanel=Widget.extend({template:'ControlPanel',init:function(parent,template){this._super(parent);if(template){this.template=template;}
this.bus=new Bus();this.bus.on("update",this,this.update);},start:function(){this.nodes={$breadcrumbs:this.$('.breadcrumb'),$buttons:this.$('.o_cp_buttons'),$pager:this.$('.o_cp_pager'),$searchview:this.$('.o_cp_searchview'),$searchview_buttons:this.$('.o_search_options'),$sidebar:this.$('.o_cp_sidebar'),$switch_buttons:this.$('.o_cp_switch_buttons'),};this.$el.on('click.bs.dropdown','.o_search_options .dropdown-menu',function(e){e.stopPropagation();});this._toggle_visibility(false);return this._super();},destroy:function(){this._clear_breadcrumbs_handlers();return this._super.apply(this,arguments);},get_bus:function(){return this.bus;},update:function(status,options){this._toggle_visibility(!status.hidden);if(!status.hidden){options=_.defaults({},options,{clear:true,});var new_cp_content=status.cp_content||{};if(status.breadcrumbs){this._clear_breadcrumbs_handlers();this.$breadcrumbs=this._render_breadcrumbs(status.breadcrumbs);new_cp_content.$breadcrumbs=this.$breadcrumbs;}
if(options.clear){this._detach_content(this.nodes);this.nodes.$searchview_buttons.show();}else{this._detach_content(_.pick(this.nodes,_.keys(new_cp_content)));}
this._attach_content(new_cp_content);this._update_search_view(status.searchview,status.search_view_hidden);if(status.active_view_selector){this._update_switch_buttons(status.active_view_selector);}}},_toggle_visibility:function(visible){this.do_toggle(visible);if(!visible&&!this.$content){this.$content=this.$el.contents().detach();}else if(this.$content){this.$content.appendTo(this.$el);this.$content=null;}},_detach_content:function(elements_to_detach){_.each(elements_to_detach,function($nodeset){$nodeset.contents().detach();});},_attach_content:function(content){var self=this;_.each(content,function($nodeset,$element){if($nodeset&&self.nodes[$element]){self.nodes[$element].append($nodeset);}});},_update_switch_buttons:function(active_view_selector){_.each(this.nodes.$switch_buttons.find('button'),function(button){$(button).removeClass('active');});this.$(active_view_selector).addClass('active');},_render_breadcrumbs:function(breadcrumbs){var self=this;return breadcrumbs.map(function(bc,index){return self._render_breadcrumbs_li(bc,index,breadcrumbs.length);});},_render_breadcrumbs_li:function(bc,index,length){var self=this;var is_last=(index===length-1);var li_content=bc.title&&_.escape(bc.title.trim())||data.noDisplayContent;var $bc=$('<li>').append(is_last?li_content:$('<a>').html(li_content)).toggleClass('active',is_last);if(!is_last){$bc.click(function(){self.trigger("on_breadcrumb_click",bc.action,bc.index);});}
return $bc;},_clear_breadcrumbs_handlers:function(){if(this.$breadcrumbs){_.each(this.$breadcrumbs,function($bc){$bc.off();});}},_update_search_view:function(searchview,is_hidden){if(searchview){searchview.$buttons=this.nodes.$searchview_buttons;searchview.toggle_visibility(!is_hidden);}
this.nodes.$searchview.toggle(!is_hidden);this.$el.toggleClass('o_breadcrumb_full',!!is_hidden);},});return ControlPanel;});;

/* /web/static/src/js/view_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ViewManager',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data_manager=require('web.data_manager');var framework=require('web.framework');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ViewManager=Widget.extend(ControlPanelMixin,{className:"o_view_manager_content",on_attach_callback:function(){this.is_in_DOM=true;if(this.active_view&&this.active_view.controller.on_attach_callback){this.active_view.controller.on_attach_callback();}},on_detach_callback:function(){this.is_in_DOM=false;if(this.active_view&&this.active_view.controller.on_detach_callback){this.active_view.controller.on_detach_callback();}},init:function(parent,dataset,views,flags,options){var self=this;this._super(parent);this.action=options&&options.action||{};this.action_manager=options&&options.action_manager;this.flags=flags||{};this.dataset=dataset;this.view_order=[];this.views={};this.view_stack=[];this.active_view=null;this.registry=core.view_registry;this.title=this.action.name;_.each(views,function(view){var view_type=view[1]||view.view_type;var View=self.registry.get(view_type);if(!View){console.error("View type","'"+view_type+"'","is not present in the view registry.");return;}
var view_label=View.prototype.display_name;var view_descr={accesskey:View.prototype.accesskey,button_label:_.str.sprintf(_t('%(view_type)s view'),{'view_type':(view_label||view_type)}),controller:null,fields_view:view[2]||view.fields_view,icon:View.prototype.icon,label:view_label,mobile_friendly:View.prototype.mobile_friendly,multi_record:View.prototype.multi_record,options:view.options||{},require_fields:View.prototype.require_fields,title:self.title,type:view_type,view_id:view[0]||view.view_id,};self.view_order.push(view_descr);self.views[view_type]=view_descr;});this.first_view=this.views[options&&options.view_type];this.default_view=this.get_default_view();},willStart:function(){var views_def;var first_view_to_display=this.first_view||this.default_view;if(!first_view_to_display.fields_view||(this.flags.search_view&&!this.search_fields_view)){views_def=this.load_views(first_view_to_display.require_fields);}
return $.when(this._super(),views_def);},start:function(){var self=this;_.each(this.views,function(view){view.options=_.extend({action:self.action,},self.flags,self.flags[view.type],view.options);});if(this.flags.search_view){this.search_view_loaded=this.setup_search_view();}
if(this.flags.views_switcher){this.render_switch_buttons();}
if(this.first_view&&!this.first_view.multi_record&&this.default_view.multi_record){this.default_view.controller=this.create_view(this.default_view);this.view_stack.push(this.default_view);}
var view_to_load=this.first_view||this.default_view;var options=this.flags[view_to_load]&&this.flags[view_to_load].options;var main_view_loaded=this.switch_mode(view_to_load.type,options);return $.when(this._super(),main_view_loaded,this.search_view_loaded);},load_views:function(load_fields){var self=this;var views=[];_.each(this.views,function(view){if(!view.fields_view){views.push([view.view_id,view.type]);}});var options={action_id:this.action.id,load_fields:load_fields,toolbar:this.flags.sidebar,};if(this.flags.search_view&&!this.search_fields_view){options.load_filters=true;var searchview_id=this.action.search_view_id&&this.action.search_view_id[0];views.push([searchview_id||false,'search']);}
return data_manager.load_views(this.dataset,views,options).then(function(fields_views){_.each(fields_views,function(fields_view,view_type){if(view_type==='search'){self.search_fields_view=fields_view;}else{self.views[view_type].fields_view=fields_view;}});});},get_default_view:function(){return this.views[this.flags.default_view||this.view_order[0].type];},switch_mode:function(view_type,view_options){var self=this;var view=this.views[view_type];var old_view=this.active_view;if(!view||this.currently_switching){return $.Deferred().reject();}else{this.currently_switching=true;}
var views_def;if(!view.fields_view){views_def=this.load_views(view.require_fields);}
return $.when(views_def).then(function(){if(view.multi_record){self.view_stack=[];}else if(self.view_stack.length>0&&!(_.last(self.view_stack).multi_record)){self.view_stack.pop();}
self.view_stack.push(view);self.active_view=view;if(!view.loaded){if(!view.controller){view.controller=self.create_view(view,view_options);}
view.$fragment=$('<div>');view.loaded=view.controller.appendTo(view.$fragment).done(function(){view.$fragment=view.$fragment.contents();self.trigger("controller_inited",view.type,view.controller);});}
self.active_search=$.Deferred();if(self.search_view_loaded&&self.flags.auto_search&&view.controller.searchable!==false){$.when(self.search_view_loaded,view.loaded).done(function(){self.searchview.do_search();});}else{self.active_search.resolve();}
return $.when(view.loaded,self.active_search,self.search_view_loaded).then(function(){return self._display_view(view_options,old_view).then(function(){self.trigger('switch_mode',view_type,view_options);});}).fail(function(e){if(!(e&&e.code===200&&e.data.exception_type)){self.do_warn(_t("Error"),view.controller.display_name+_t(" view couldn't be loaded"));}
self.active_view=old_view;self.view_stack.pop();});}).always(function(){self.currently_switching=false;});},_display_view:function(view_options,old_view){var self=this;var view_controller=this.active_view.controller;var view_fragment=this.active_view.$fragment;var view_control_elements=this.render_view_control_elements();return $.when(view_controller.do_show(view_options)).done(function(){var cp_status={active_view_selector:'.o_cp_switch_'+self.active_view.type,breadcrumbs:self.action_manager&&self.action_manager.get_breadcrumbs(),cp_content:_.extend({},self.searchview_elements,view_control_elements),hidden:self.flags.headless,searchview:self.searchview,search_view_hidden:view_controller.searchable===false||view_controller.searchview_hidden,};self.update_control_panel(cp_status);if(old_view&&old_view!==self.active_view){if(self.action_manager&&self.action_manager.webclient){old_view.controller.set_scrollTop(self.action_manager.webclient.get_scrollTop());}
var $to_detach=self.$el.contents().not('.ui-autocomplete');old_view.$fragment=framework.detach([{widget:old_view.controller}],{$to_detach:$to_detach});}
if(old_view&&old_view.controller.multi_record===true&&view_controller.multi_record===false){view_controller.set_scrollTop(0);}
framework.append(self.$el,view_fragment,{in_DOM:self.is_in_DOM,callbacks:[{widget:view_controller}],});});},create_view:function(view,view_options){var self=this;var js_class=view.fields_view.arch.attrs&&view.fields_view.arch.attrs.js_class;var View=this.registry.get(js_class||view.type);var options=_.clone(view.options);if(view.type==="form"&&((this.action.target==='new'||this.action.target==='inline')||(view_options&&view_options.mode==='edit'))){options.initial_mode=options.initial_mode||'edit';}
var controller=new View(this,this.dataset,view.fields_view,options);controller.on('switch_mode',this,this.switch_mode.bind(this));controller.on('history_back',this,function(){if(self.action_manager)self.action_manager.trigger('history_back');});controller.on("change:title",this,function(){if(self.action_manager&&!self.flags.headless){var breadcrumbs=self.action_manager.get_breadcrumbs();self.update_control_panel({breadcrumbs:breadcrumbs},{clear:false});}});return controller;},select_view:function(index){var view_type=this.view_stack[index].type;return this.switch_mode(view_type);},render_switch_buttons:function(){var self=this;var views=_.partition(this.view_order,function(view){return view.multi_record===true;});var multi_record_views=views[0];var mono_record_views=views[1];var _render_switch_buttons=function(views){if(views.length>1){var $switch_buttons=$(QWeb.render('ViewManager.switch-buttons',{views:views}));_.each(views,function(view){$switch_buttons.filter('.o_cp_switch_'+view.type).tooltip();});$switch_buttons.filter('button').click(_.debounce(function(event){var view_type=$(event.target).data('view-type');self.switch_mode(view_type);},200,true));return $switch_buttons;}};this.switch_buttons={};this.switch_buttons.$multi=_render_switch_buttons(multi_record_views);this.switch_buttons.$mono=_render_switch_buttons(mono_record_views);},render_view_control_elements:function(){if(!this.active_view.control_elements){var view_controller=this.active_view.controller;var $buttons=this.flags.$buttons;var elements={};if(!this.flags.headless){elements={$buttons:$("<div>"),$sidebar:$("<div>"),$pager:$("<div>"),};}
view_controller.render_buttons($buttons?$buttons.empty():elements.$buttons);view_controller.render_sidebar(elements.$sidebar);view_controller.render_pager(elements.$pager);elements=_.mapObject(elements,function($node){return $node&&$node.contents();});if(this.switch_buttons){if(this.active_view.multi_record){elements.$switch_buttons=this.switch_buttons.$multi;}else{elements.$switch_buttons=this.switch_buttons.$mono;}}
this.active_view.control_elements=elements;}
return this.active_view.control_elements;},setup_search_view:function(){var self=this;if(this.searchview){this.searchview.destroy();}
var search_defaults={};var context=this.action.context||[];_.each(context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value;}});var options={hidden:this.flags.search_view===false,disable_custom_filters:this.flags.search_disable_custom_filters,$buttons:$("<div>"),action:this.action,search_defaults:search_defaults,};this.searchview=new SearchView(this,this.dataset,this.search_fields_view,options);this.searchview.on('search_data',this,this.search.bind(this));return $.when(this.searchview.appendTo($("<div>"))).done(function(){self.searchview_elements={};self.searchview_elements.$searchview=self.searchview.$el;self.searchview_elements.$searchview_buttons=self.searchview.$buttons.contents();});},search:function(domains,contexts,groupbys){var self=this;var controller=this.active_view.controller;var action_context=this.action.context||{};var view_context=controller.get_context();pyeval.eval_domains_and_contexts({domains:[this.action.domain||[]].concat(domains||[]),contexts:[action_context,view_context].concat(contexts||[]),group_by_seq:groupbys||[]}).done(function(results){if(results.error){self.active_search.resolve();throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
self.dataset._model=new Model(self.dataset.model,results.context,results.domain);var groupby=results.group_by.length?results.group_by:action_context.group_by;if(_.isString(groupby)){groupby=[groupby];}
if(!controller.grouped&&!_.isEmpty(groupby)){self.dataset.set_sort([]);}
$.when(controller.do_search(results.domain,results.context,groupby||[])).then(function(){self.active_search.resolve();});});},do_push_state:function(state){if(this.action_manager){state.view_type=this.active_view.type;this.action_manager.do_push_state(state);}},do_load_state:function(state,warm){if(state.view_type&&state.view_type!==this.active_view.type){this.switch_mode(state.view_type,true);}
this.active_view.controller.do_load_state(state,warm);},destroy:function(){if(this.control_elements){if(this.control_elements.$switch_buttons){this.control_elements.$switch_buttons.off();}}
return this._super.apply(this,arguments);},});return ViewManager;});;

/* /web/static/src/js/abstract_web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractWebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var Loading=require('web.Loading');var NotificationManager=require('web.notification').NotificationManager;var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var WebClient=Widget.extend({custom_events:{notification:function(e){if(this.notification_manager){this.notification_manager.notify(e.data.title,e.data.message,e.data.sticky);}},warning:function(e){if(this.notification_manager){this.notification_manager.warn(e.data.title,e.data.message,e.data.sticky);}},clear_uncommitted_changes:function(e){this.clear_uncommitted_changes().then(e.data.callback);},toggle_fullscreen:function(event){this.toggle_fullscreen(event.data.fullscreen);},current_action_updated:function(e){this.current_action_updated(e.data.action);},perform_rpc:function(event){if(event.data.on_fail){event.data.on_fail();}},perform_model_rpc:function(event){if(event.data.on_fail){event.data.on_fail();}},},init:function(parent){this.client_options={};this._super(parent);this.origin=undefined;this._current_state=null;this.menu_dm=new utils.DropMisordered();this.action_mutex=new utils.Mutex();this.set('title_part',{"zopenerp":"Odoo"});},start:function(){var self=this;this.on("change:title_part",this,this._title_changed);this._title_changed();return session.is_bound.then(function(){self.bind_events();return $.when(self.set_action_manager(),self.set_notification_manager(),self.set_loading());}).then(function(){if(session.session_is_valid()){return self.show_application();}else{return $.when();}}).then(function(){self.action_manager.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));core.bus.trigger('web_client_ready');});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){self.$('.oe_dropdown_menu.oe_opened, .oe_dropdown_toggle.oe_opened').removeClass('oe_opened');}});core.bus.on('connection_lost',this,this.on_connection_lost);core.bus.on('connection_restored',this,this.on_connection_restored);session.on('error',crash_manager,crash_manager.rpc_error);window.onerror=function(message,file,line,col,error){var traceback=error?error.stack:'';crash_manager.show_error({type:_t("Client Error"),message:message,data:{debug:file+':'+line+"\n"+_t('Traceback:')+"\n"+traceback}});};},set_action_manager:function(){this.action_manager=new ActionManager(this,{webclient:this});return this.action_manager.appendTo(this.$('.o_main_content'));},set_notification_manager:function(){this.notification_manager=new NotificationManager(this);return this.notification_manager.appendTo(this.$el);},set_loading:function(){this.loading=new Loading(this);return this.loading.appendTo(this.$el);},show_application:function(){},clear_uncommitted_changes:function(){var def=$.Deferred().resolve();core.bus.trigger('clear_uncommitted_changes',function chain_callbacks(callback){def=def.then(callback);});return def;},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},do_action:function(){return this.action_manager.do_action.apply(this,arguments);},do_reload:function(){var self=this;return this.session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_push_state:function(state){if('title'in state){this.set_title(state.title);delete state.title;}
var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},on_connection_lost:function(){this.connection_notification=this.notification_manager.notify(_t('Connection lost'),_t('Trying to reconnect...'),true);},on_connection_restored:function(){if(this.connection_notification){this.connection_notification.destroy();this.notification_manager.notify(_t('Connection restored'),_t('You are back online'),false);this.connection_notification=false;}},current_action_updated:function(){},get_scrollTop:function(){},toggle_fullscreen:function(fullscreen){this.$el.toggleClass('o_fullscreen',fullscreen);},});return WebClient;});;

/* /web/static/src/js/web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";var AbstractWebClient=require('web.AbstractWebClient');var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var framework=require('web.framework');var Menu=require('web.Menu');var Model=require('web.DataModel');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');return AbstractWebClient.extend({events:{'click .oe_logo_edit_admin':'logo_edit','click .oe_logo img':function(ev){ev.preventDefault();return this.clear_uncommitted_changes().then(function(){framework.redirect("/web"+(core.debug?"?debug":""));});},},show_application:function(){var self=this;this.action_manager.is_in_DOM=true;this.toggle_bars(true);this.set_title();this.update_logo();this.menu=new Menu(this);this.menu.setElement(this.$el.parents().find('.oe_application_menu_placeholder'));this.menu.on('menu_click',this,this.on_menu_action);this.user_menu=new UserMenu(this);var $user_menu_placeholder=$('body').find('.oe_user_menu_placeholder').show();var user_menu_loaded=this.user_menu.appendTo($user_menu_placeholder);this.systray_menu=new SystrayMenu(this);this.systray_menu.setElement(this.$el.parents().find('.oe_systray'));var systray_menu_loaded=this.systray_menu.start();return $.when(systray_menu_loaded,user_menu_loaded).then(function(){self.menu.start();self.bind_hashchange();});},toggle_bars:function(value){this.$('tr:has(td.navbar),.oe_leftbar').toggle(value);},update_logo:function(reload){var company=session.company_id;var img=session.url('/web/binary/company_logo'+'?db='+session.db+(company?'&company='+company:''));this.$('.o_sub_menu_logo img').attr('src','').attr('src',img+(reload?"#"+Date.now():''));this.$('.oe_logo_edit').toggleClass('oe_logo_edit_admin',session.is_superuser);},logo_edit:function(ev){var self=this;ev.preventDefault();self.alive(new Model("res.users").call("read",[[session.uid],["company_id"]])).then(function(data){self.rpc("/web/action/load",{action_id:"base.action_res_company_form"}).done(function(result){result.res_id=data[0].company_id[0];result.target="new";result.views=[[false,'form']];result.flags={action_buttons:true,headless:true,};self.action_manager.do_action(result).then(function(){var form=self.action_manager.dialog_widget.views.form.controller;form.on("on_button_cancel",self.action_manager,self.action_manager.dialog_stop);form.on('record_saved',self,function(){self.action_manager.dialog_stop();self.update_logo();});});});});return false;},bind_hashchange:function(){var self=this;$(window).bind('hashchange',this.on_hashchange);var state=$.bbq.getState(true);if(_.isEmpty(state)||state.action==="login"){self.menu.is_bound.done(function(){new Model("res.users").call("read",[[session.uid],["action_id"]]).done(function(result){var data=result[0];if(data.action_id){self.action_manager.do_action(data.action_id[0]);self.menu.open_action(data.action_id[0]);}else{var first_menu_id=self.menu.$el.find("a:first").data("menu");if(first_menu_id){self.menu.menu_click(first_menu_id);}}});});}else{$(window).trigger('hashchange');}},on_hashchange:function(event){if(this._ignore_hashchange){this._ignore_hashchange=false;return;}
var self=this;this.clear_uncommitted_changes().then(function(){var stringstate=event.getState(false);if(!_.isEqual(self._current_state,stringstate)){var state=event.getState(true);if(!state.action&&state.menu_id){self.menu.is_bound.done(function(){self.menu.menu_click(state.menu_id);});}else{state._push_me=false;self.action_manager.do_load_state(state,!!self._current_state).then(function(){var action=self.action_manager.get_inner_action();if(action){self.menu.open_action(action.action_descr.id);}});}}
self._current_state=stringstate;},function(){if(event){self._ignore_hashchange=true;window.location=event.originalEvent.oldURL;}});},on_menu_action:function(options){var self=this;return this.menu_dm.add(data_manager.load_action(options.action_id)).then(function(result){return self.action_mutex.exec(function(){if(options.needaction){result.context=new data.CompoundContext(result.context,{search_default_message_needaction:true,search_disable_custom_filters:true,});}
var completed=$.Deferred();$.when(self.action_manager.do_action(result,{clear_breadcrumbs:true,action_menu_id:self.menu.current_menu,})).fail(function(){self.menu.open_menu(options.previous_menu_id);}).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);return completed;});});},toggle_fullscreen:function(fullscreen){this._super(fullscreen);if(!fullscreen){this.menu.reflow();}},});});;

/* /web/static/src/js/framework/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var mixins=require('web.mixins');var Model=require('web.Model');var session=require('web.session');var translation=require('web.translation');var pyeval=require('web.pyeval');var utils=require('web.utils');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=new CompoundDomain(q._filter,to_set.filter);break;case'context':q._context=new CompoundContext(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyeval.eval('domains',[this._model.domain(this._filter)]),context:pyeval.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyeval.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};_(fixed_group).each(function(value,key){if(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key)){return;}
aggregates[key]=value||0;});this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new utils.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids))
return $.Deferred().resolve([]);options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new CompoundContext(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();return this.orderer.add(query).done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;return this._model.call('create',[data],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',data,options);});},write:function(id,data,options){options=options||{};var self=this;return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(function(){self.trigger('dataset_changed',id,data,options);});},unlink:function(ids){var self=this;return this._model.call('unlink',[ids],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',ids);});},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},exec_workflow:function(id,signal){return this._model.exec_workflow(id,signal);},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyeval.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return this.orderer.add(q.all()).done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var BufferedDataSet=DataSetStatic.extend({virtual_id_prefix:"one2many_v_id_",debug_mode:true,init:function(){this._super.apply(this,arguments);this.reset_ids([]);this.last_default_get={};this.running_reads=[];this.mutex=new utils.Mutex();},default_get:function(fields,options){var self=this;return this._super(fields,options).done(function(res){self.last_default_get=_.clone(res);});},get_cache:function(id){if(!this.cache[id]){this.cache[id]={'id':id,'values':{},'from_read':{},'changes':{},'readonly_fields':{},'to_create':false,'to_delete':false};}
return this.cache[id];},_update_cache:function(id,options){var cached=this.get_cache(id);if(options){_.extend(cached.from_read,options.from_read);_.extend(cached.changes,options.changes);_.extend(cached.readonly_fields,options.readonly_fields);if(options.to_create!==undefined)cached.to_create=options.to_create;if(options.to_delete!==undefined)cached.to_delete=options.to_delete;}
cached.values=_.extend({'id':id},cached.from_read,cached.changes,cached.readonly_fields);return cached;},create:function(data,options){var changes=_.extend({},this.last_default_get,data);var cached=this._update_cache(_.uniqueId(this.virtual_id_prefix),_.extend({'changes':changes,'to_create':true},options));this.trigger("dataset_changed",data,options);return $.Deferred().resolve(cached.id);},write:function(id,data,options){var self=this;var cached=this.get_cache(id);cached.to_delete=false;var def=$.Deferred();this.mutex.exec(function(){var dirty=false;for(var k in data){if(!_.isEqual(data[k],cached.values[k])){dirty=true;if(_.isEqual(data[k],cached.from_read[k])){delete cached.changes[k];}else{cached.changes[k]=data[k];}}else{delete data[k];}}
self._update_cache(id,options);if(dirty){self.trigger("dataset_changed",id,data,options);}
return def.resolve(data).promise();});return def;},unlink:function(ids,callback,error_callback){var self=this;_.each(ids,function(id){self.get_cache(id).to_delete=true;});this.set_ids(_.difference(this.ids,_.pluck(_.filter(this.cache,function(c){return c.to_delete;}),'id')));this.trigger("dataset_changed",ids,callback,error_callback);return utils.async_when({result:true}).done(callback);},reset_ids:function(ids,options){var self=this;this.set_ids(ids);if(!options||!options.keep_read_data){this.cache={};}else{_.each(this.cache,function(cache){self._update_cache(cache.id,{'changes':{},'to_delete':false});});}
this.delete_all=false;this.cancel_read();},cancel_read:function(){_.invoke(_.clone(this.running_reads),'reject');},read_ids:function(ids,fields,options){var self=this;var to_get=_.filter(ids,function(id){var cache=self.get_cache(id);return!cache.to_create&&_.any(fields,function(x){return cache.from_read[x]===undefined;});});options=options||{};var return_records=function(){var records=_.map(ids,function(id){return _.clone(self.get_cache(id).values);});if(self.debug_mode){if(_.include(records,undefined)){throw"Record not correctly loaded";}}
var sort_fields=self._sort,compare=function(v1,v2){return(v1<v2)?-1:(v1>v2)?1:0;};if(sort_fields.length){records.sort(function(a,b){return _.reduce(sort_fields,function(acc,field){if(acc){return acc;}
var sign=1;if(field[0]==='-'){sign=-1;field=field.slice(1);}
if(!a[field]&&a[field]!==0){return sign;}
if(!b[field]&&b[field]!==0){return(sign==-1)?1:-1;}
if(_.isArray(a[field])&&a[field].length==2&&_.isString(a[field][1])){return sign*compare(a[field][1],b[field][1]);}
return sign*compare(a[field],b[field]);},0);});}
return $.when(records);};if(to_get.length>0){var def=$.Deferred();self.running_reads.push(def);def.always(function(){self.running_reads=_.without(self.running_reads,def);});var _super=this._super;this.mutex.exec(function(){if(def.state()!=="pending")return;_super.call(self,to_get,fields,options).then(_.bind(def.resolve,def),_.bind(def.reject,def));return def;});return def.then(function(records){_.each(records,function(record,index){var id=to_get[index];self._update_cache(id,_.extend(options,{'from_read':record}));});return return_records();});}else{return return_records();}},evict_record:function(id){this.get_cache(id).from_read={};this._update_cache(id);},call_button:function(method,args){this.evict_record(args[0][0]);return this._super(method,args);},exec_workflow:function(id,signal){this.evict_record(id);return this._super(id,signal);},alter_ids:function(n_ids,options){var dirty=!_.isEqual(this.ids,n_ids);this._super(n_ids,options);if(dirty){this.trigger("dataset_changed",n_ids,options);}},});BufferedDataSet.virtual_id_regex=/^one2many_v_id_.*$/;var ProxyDataSet=DataSetSearch.extend({init:function(){this._super.apply(this,arguments);this.create_function=null;this.write_function=null;this.read_function=null;this.default_get_function=null;this.unlink_function=null;},read_ids:function(ids,fields,options){if(this.read_function){return this.read_function(ids,fields,options,this._super);}else{return this._super.apply(this,arguments);}},default_get:function(fields,options){if(this.default_get_function){return this.default_get_function(fields,options,this._super);}else{return this._super.apply(this,arguments);}},create:function(data,options){if(this.create_function){return this.create_function(data,options,this._super);}else{return this._super.apply(this,arguments);}},write:function(id,data,options){if(this.write_function){return this.write_function(id,data,options,this._super);}else{return this._super.apply(this,arguments);}},unlink:function(ids){if(this.unlink_function){return this.unlink_function(ids,this._super);}else{return this._super.apply(this,arguments);}},});var CompoundContext=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return pyeval.eval('context',this,undefined,{no_user_context:true});},});var CompoundDomain=Class.extend({init:function(){this.__ref="compound_domain";this.__domains=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(domain){this.__domains.push(domain);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;},eval:function(){return pyeval.eval('domain',this);},});function compute_domain(expr,fields){if(!(expr instanceof Array))
return!!expr;var stack=[];for(var i=expr.length-1;i>=0;i--){var ex=expr[i];if(ex.length==1){var top=stack.pop();switch(ex){case'|':stack.push(stack.pop()||top);continue;case'&':stack.push(stack.pop()&&top);continue;case'!':stack.push(!top);continue;default:throw new Error(_.str.sprintf(_t("Unknown operator %s in domain %s"),ex,JSON.stringify(expr)));}}
var field=fields[ex[0]];if(!field){throw new Error(_.str.sprintf(_t("Unknown field %s in domain %s"),ex[0],JSON.stringify(expr)));}
var field_value=field.get_value?field.get_value():field.value;var op=ex[1];var val=ex[2];switch(op.toLowerCase()){case'=':case'==':stack.push(_.isEqual(field_value,val));break;case'!=':case'<>':stack.push(!_.isEqual(field_value,val));break;case'<':stack.push(field_value<val);break;case'>':stack.push(field_value>val);break;case'<=':stack.push(field_value<=val);break;case'>=':stack.push(field_value>=val);break;case'in':if(!_.isArray(val))val=[val];stack.push(_(val).contains(field_value));break;case'not in':if(!_.isArray(val))val=[val];stack.push(!_(val).contains(field_value));break;default:console.warn(_t("Unsupported operator %s in domain %s"),op,JSON.stringify(expr));}}
return _.all(stack,_.identity);}
return{Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,BufferedDataSet:BufferedDataSet,ProxyDataSet:ProxyDataSet,CompoundContext:CompoundContext,CompoundDomain:CompoundDomain,compute_domain:compute_domain,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};});;

/* /web/static/src/js/compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web.compatibility',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var FavoriteMenu=require('web.FavoriteMenu');var form_common=require('web.form_common');var formats=require('web.formats');var FormView=require('web.FormView');var form_relational=require('web.form_relational');var form_widgets=require('web.form_widgets');var framework=require('web.framework');var ListView=require('web.ListView');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var Registry=require('web.Registry');var SearchView=require('web.SearchView');var session=require('web.session');var Sidebar=require('web.Sidebar');var SystrayMenu=require('web.SystrayMenu');var time=require('web.time');var UserMenu=require('web.UserMenu');var utils=require('web.utils');var View=require('web.View');var ViewManager=require('web.ViewManager');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var client_started=$.Deferred();var OldRegistry=Registry.extend({add:function(key,path){},get_object:function(key){return get_object(this.map[key]);},});window.openerp=window.openerp||{};$.Mutex=utils.Mutex;openerp._session_id="instance0";openerp._t=core._t;openerp.get_cookie=utils.get_cookie;openerp.qweb=core.qweb;openerp.session=session;openerp.web=openerp.web||{};openerp.web._t=core._t;openerp.web._lt=core._lt;openerp.web.ActionManager=ActionManager;openerp.web.auto_str_to_date=time.auto_str_to_date;openerp.web.blockUI=framework.blockUI;openerp.web.BufferedDataSet=data.BufferedDataSet;openerp.web.bus=core.bus;openerp.web.Class=core.Class;openerp.web.client_actions=make_old_registry(core.action_registry);openerp.web.CompoundContext=data.CompoundContext;openerp.web.CompoundDomain=data.CompoundDomain;openerp.web.DataSetSearch=data.DataSetSearch;openerp.web.DataSet=data.DataSet;openerp.web.date_to_str=time.date_to_str;openerp.web.Dialog=Dialog;openerp.web.DropMisordered=utils.DropMisordered;openerp.web.form=openerp.web.form||{};openerp.web.form.AbstractField=form_common.AbstractField;openerp.web.form.compute_domain=data.compute_domain;openerp.web.form.DefaultFieldManager=form_common.DefaultFieldManager;openerp.web.form.FieldChar=core.form_widget_registry.get('char');openerp.web.form.FieldFloat=core.form_widget_registry.get('float');openerp.web.form.FieldStatus=core.form_widget_registry.get('statusbar');openerp.web.form.FieldMany2ManyTags=core.form_widget_registry.get('many2many_tags');openerp.web.form.FieldMany2One=core.form_widget_registry.get('many2one');openerp.web.form.FormWidget=form_common.FormWidget;openerp.web.form.tags=make_old_registry(core.form_tag_registry);openerp.web.form.widgets=make_old_registry(core.form_widget_registry);openerp.web.form.custom_widgets=make_old_registry(core.form_custom_registry);openerp.web.format_value=formats.format_value;openerp.web.FormView=FormView;openerp.web.json_node_to_xml=utils.json_node_to_xml;openerp.web.ListView=ListView;openerp.web.Model=Model;openerp.web.normalize_format=time.strftime_to_moment_format;openerp.web.py_eval=pyeval.py_eval;openerp.web.pyeval=pyeval;openerp.web.qweb=core.qweb;openerp.web.Registry=OldRegistry;openerp.web.search={};openerp.web.search.FavoriteMenu=FavoriteMenu;openerp.web.SearchView=SearchView;openerp.web.Sidebar=Sidebar;openerp.web.str_to_date=time.str_to_date;openerp.web.str_to_datetime=time.str_to_datetime;openerp.web.SystrayItems=SystrayMenu.Items;openerp.web.unblockUI=framework.unblockUI;openerp.web.UserMenu=UserMenu;openerp.web.View=View;openerp.web.ViewManager=ViewManager;openerp.web.views=make_old_registry(core.view_registry);openerp.web.WebClient=WebClient;openerp.web.Widget=Widget;openerp.Widget=openerp.web.Widget;openerp.Widget.prototype.session=session;WebClient.include({init:function(){openerp.client=this;openerp.webclient=this;start_modules();client_started.resolve();this._super.apply(this,arguments);},});function make_old_registry(registry){return{add:function(key,path){client_started.done(function(){registry.add(key,get_object(path));});},};}
function get_object(path){var object_match=openerp;path=path.split('.');for(var i=1;i<path.length;++i){object_match=object_match[path[i]];}
return object_match;}
var inited=false;function start_modules(modules){if(modules===undefined){modules=odoo._modules;}
modules=_.without(modules,"web");if(inited){throw new Error("OpenERP was already inited");}
inited=true;for(var i=0;i<modules.length;i++){var fct=openerp[modules[i]];if(typeof(fct)==="function"){openerp[modules[i]]={};for(var k in fct){openerp[modules[i]][k]=fct[k];}
fct(openerp,openerp[modules[i]]);}}
openerp._modules=['web'].concat(modules);return openerp;};ListView.include({willStart:function(){if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
if(this.fields_view.arch.attrs.fonts){this.fonts=_(this.fields_view.arch.attrs.fonts.split(';')).chain().compact().map(function(font_pair){var pair=font_pair.split(':'),font=pair[0],expr=pair[1];return[font,py.parse(py.tokenize(expr)),expr];}).value();}
return this._super();},style_for:function(record){var len,style='';var context=_.extend({},record.attributes,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});var i;var pair;var expression;if(this.fonts){for(i=0,len=this.fonts.length;i<len;++i){pair=this.fonts[i];var font=pair[0];expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){switch(font){case'bold':style+='font-weight: bold;';break;case'italic':style+='font-style: italic;';break;case'underline':style+='text-decoration: underline;';break;}}}}
if(!this.colors){return style;}
for(i=0,len=this.colors.length;i<len;++i){pair=this.colors[i];var color=pair[0];expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){return style+='color: '+color+';';}}
return style;},});if(typeof(console)==="undefined"){window.console={};('log error debug info warn assert clear dir dirxml trace group'
+' groupCollapsed groupEnd time timeEnd profile profileEnd count'
+' exception').split(/\s+/).forEach(function(property){console[property]=_.identity;});}
if(!('placeholder'in document.createElement('input'))){document.addEventListener("DOMNodeInserted",function(event){var nodename=event.target.nodeName.toLowerCase();if(nodename==="input"||nodename==="textarea"){$(event.target).placeholder();}});}});;

/* /web/static/src/js/framework/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var ajax=require('web.ajax');var Widget=require('web.Widget');var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$('body').addClass('o_ui_blocked');return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$('body').removeClass('o_ui_blocked');return $.unblockUI.apply($,arguments);}
function redirect(url,wait){crash_manager.disable();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("/web/webclient/version_info",{}).done(load).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function HistoryBack(parent){parent.history_back().fail(function(){Home(parent);});}
core.action_registry.add("history_back",HistoryBack);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');return $.Deferred();}
core.action_registry.add("logout",logout);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if('nv'in window){nv.dev=false;nv.utils.onWindowResize=function(fun){if(fun===null)return;window.addEventListener('resize',fun);};nv.utils.windowResize=nv.utils.onWindowResize;nv.utils.offWindowResize=function(fun){if(fun===null)return;window.removeEventListener('resize',fun);};nv.tooltip.cleanup=function(){$('.nvtooltip').remove();};var originalCalcTooltipPosition=nv.tooltip.calcTooltipPosition;nv.tooltip.calcTooltipPosition=function(){var container=originalCalcTooltipPosition.apply(this,arguments);container.style.top=container.style.top.split('px')[0]<0?0+'px':container.style.top;return container;};}
$.fn.tooltip.Constructor.DEFAULTS.placement='auto top';$.fn.tooltip.Constructor.DEFAULTS.html=true;$.fn.tooltip.Constructor.DEFAULTS.trigger='hover focus click';$.fn.tooltip.Constructor.DEFAULTS.container='body';$.fn.tooltip.Constructor.DEFAULTS.delay={show:1000,hide:0};var bootstrap_show_function=$.fn.tooltip.Constructor.prototype.show;$.fn.modal.Constructor.prototype.enforceFocus=function(){};$.fn.tooltip.Constructor.prototype.show=function(){$('.tooltip').remove();var e=$.Event('show.bs.'+this.type);var inDom=$.contains(document.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;return bootstrap_show_function.call(this);};jQuery.expr[":"].Contains=jQuery.expr.createPseudo(function(arg){return function(elem){return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase())>=0;};});$.fn.getAttributes=function(){var o={};if(this.length){for(var attr,i=0,attrs=this[0].attributes,l=attrs.length;i<l;i++){attr=attrs.item(i);o[attr.nodeName]=attr.value;}}
return o;};$.fn.openerpClass=function(additionalClass){additionalClass=additionalClass||'';if(!!$.browser.msie){additionalClass+=' openerp_ie';}
return this.each(function(){$(this).addClass('openerp '+additionalClass);});};$.fn.openerpBounce=function(){return this.each(function(){$(this).css('box-sizing','content-box').effect('bounce',{distance:18,times:5},250);});};var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value_){return matcher.test($("<div>").html(value_.label||value_.value||value_).text());});}
$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term));};}else{initSource.call(this);}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul).addClass(item.classname);}});function _notify(content,callbacks){_.each(callbacks,function(c){if(c.widget&&c.widget.on_attach_callback){c.widget.on_attach_callback(c.callback_args);}});core.bus.trigger('DOM_updated',content);}
function append($target,content,options){$target.append(content);if(options&&options.in_DOM){_notify(content,options.callbacks);}}
function prepend($target,content,options){$target.prepend(content);if(options&&options.in_DOM){_notify(content,options.callbacks);}}
function detach(to_detach,options){_.each(to_detach,function(d){if(d.widget.on_detach_callback){d.widget.on_detach_callback(d.callback_args);}});var $to_detach=options&&options.$to_detach;if(!$to_detach){$to_detach=$(_.map(to_detach,function(d){return d.widget.el;}));}
return $to_detach.detach();}
function getPosition(e){var position={left:0,top:0};while(e){position.left+=e.offsetLeft;position.top+=e.offsetTop;e=e.offsetParent;}
return position;}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,append:append,prepend:prepend,detach:detach,getPosition:getPosition,};});odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this.bind_events.bind(this));return this._super();},bind_events:function(){this.$el.contents().click(this.iframe_clicked.bind(this));},iframe_clicked:function(e){}});return IFrameWidget;});;

/* /web/static/src/js/framework/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var map_title={user_error:_lt('Warning'),warning:_lt('Warning'),access_error:_lt('Access Error'),missing_error:_lt('Missing Record'),validation_error:_lt('Validation Error'),except_orm:_lt('Global Business Error'),access_denied:_lt('Access Denied'),};var CrashManager=core.Class.extend({init:function(){this.active=true;},enable:function(){this.active=true;},disable:function(){this.active=false;},rpc_error:function(error){var self=this;if(!this.active){return;}
if(this.connection_lost){return;}
if(error.code==-32098){core.bus.trigger('connection_lost');this.connection_lost=true;var timeinterval=setInterval(function(){ajax.jsonRpc('/web/webclient/version_info').then(function(){clearInterval(timeinterval);core.bus.trigger('connection_restored');self.connection_lost=false;});},2000);return;}
var handler=core.crash_registry.get(error.data.name,true);if(handler){new(handler)(this,error).display();return;}
if(error.data.name==="odoo.http.SessionExpiredException"||error.data.name==="werkzeug.exceptions.Forbidden"){this.show_warning({type:"Session Expired",data:{message:_t("Your Odoo session expired. Please refresh the current web page.")}});return;}
if(_.has(map_title,error.data.exception_type)){if(error.data.exception_type=='except_orm'){if(error.data.arguments[1]){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[1],title:error.data.arguments[0]!=='Warning'?(" - "+error.data.arguments[0]):'',})});}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:'',})});}}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:map_title[error.data.exception_type]!=='Warning'?(" - "+map_title[error.data.exception_type]):'',})});}
this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
new Dialog(this,{size:'medium',title:"Odoo "+(_.str.capitalize(error.type)||_t("Warning")),subtitle:error.data.title,$content:$('<div>').html(QWeb.render('CrashManager.warning',{error:error}))}).open();},show_error:function(error){if(!this.active){return;}
new Dialog(this,{title:"Odoo "+_.str.capitalize(error.type),$content:QWeb.render('CrashManager.error',{error:error})}).open();},show_message:function(exception){this.show_error({type:_t("Client Error"),message:exception,data:{debug:""}});},});var ExceptionHandler={init:function(parent,error){},display:function(){},};var RedirectWarningHandler=Dialog.extend(ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){var self=this;var error=this.error;error.data.message=error.data.arguments[0];new Dialog(this,{size:'medium',title:"Odoo "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:error.data.arguments[2],classes:"btn-primary",click:function(){window.location.href='#action='+error.data.arguments[1];self.destroy();}},{text:_t("Cancel"),click:function(){self.destroy();},close:true}],$content:QWeb.render('CrashManager.warning',{error:error}),}).open();}});core.crash_registry.add('odoo.exceptions.RedirectWarning',RedirectWarningHandler);return CrashManager;});;

/* /web/static/src/js/framework/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var core=require('web.core');var Model=require('web.DataModel');var session=require('web.session');var utils=require('web.utils');function traverse(tree,f){if(f(tree)){_.each(tree.children,function(c){traverse(c,f);});}}
return core.Class.extend({init:function(){this.Filters=new Model('ir.filters');this._init_cache();},_init_cache:function(){this._cache={actions:{},fields_views:{},fields:{},filters:{},views:{},};},invalidate:function(){this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(!this._cache.actions[key]){this._cache.actions[key]=session.rpc("/web/action/load",{action_id:action_id,additional_context:additional_context,}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;},this._invalidate.bind(this,this._cache.actions,key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:function(dataset,views_descr,options){var self=this;var model=dataset.model;var context=dataset.get_context();var key=this._gen_key(model,views_descr,options||{},context);if(!this._cache.views[key]){options.load_fields=options.load_fields&&!this._cache.fields[model];var filters_key;if(options.load_filters){filters_key=this._gen_key(model,options.action_id);options.load_filters=!this._cache.filters[filters_key];}
this._cache.views[key]=dataset.call('load_views',{views:views_descr,options:options,context:context,}).then(function(result){result.fields_views=_.mapObject(result.fields_views,self._postprocess_fvg.bind(self));_.each(views_descr,function(view_descr){var toolbar=options.toolbar&&view_descr[1]!=='search';var fv_key=self._gen_key(model,view_descr[0],view_descr[1],toolbar,context);self._cache.fields_views[fv_key]=$.when(result.fields_views[view_descr[1]]);});if(result.filters){self._cache.filters[filters_key]=$.when(result.filters);}
if(result.fields){self._cache.fields[model]=$.when(result.fields);}
return result.fields_views;},this._invalidate.bind(this,this._cache.views,key));}
return this._cache.views[key];},load_fields_view:function(dataset,view_id,view_type,toolbar){var key=this._gen_key(dataset.model,view_id,view_type,toolbar,dataset.get_context());if(!this._cache.fields_views[key]){this._cache.fields_views[key]=dataset.call('fields_view_get',{view_id:view_id,view_type:view_type,toolbar:toolbar,context:dataset.get_context(),}).then(this._postprocess_fvg.bind(this),this._invalidate.bind(this,this._cache.fields_views,key));}
return this._cache.fields_views[key];},load_fields:function(dataset){if(!this._cache.fields[dataset.model]){this._cache.fields[dataset.model]=dataset.call('fields_get',{context:dataset.get_context(),}).fail(this._invalidate.bind(this,this._cache.fields,dataset.model));}
return this._cache.fields[dataset.model];},load_filters:function(dataset,action_id){var key=this._gen_key(dataset.model,action_id);if(!this._cache.filters[key]){this._cache.filters[key]=this.Filters.call('get_filters',[dataset.model,action_id],{context:dataset.get_context(),}).fail(this._invalidate.bind(this,this._cache.filters,key));}
return this._cache.filters[key];},create_filter:function(filter){var self=this;return this.Filters.call('create_or_replace',[filter]).then(function(filter_id){var key=[filter.model_id,filter.action_id||false,].join(',');self._invalidate(self._cache.filters,key);return filter_id;});},delete_filter:function(filter){var self=this;return this.Filters.call('unlink',[filter.id]).then(function(){self._cache.filters={};});},_postprocess_fvg:function(fields_view){var self=this;var doc=$.parseXML(fields_view.arch).documentElement;var fields=fields_view.fields;fields_view.arch=utils.xml_to_json(doc,(doc.nodeName.toLowerCase()!=='kanban'));traverse(fields_view.arch,function(node){if(typeof node==='string'){return false;}
if(node.tag==='field'){fields[node.attrs.name].__attrs=node.attrs;if(fields[node.attrs.name].type==='many2one'){if(node.attrs.widget==='statusbar'||node.attrs.widget==='radio'){fields[node.attrs.name].__fetch_status=true;}else if(node.attrs.widget==='selection'){fields[node.attrs.name].__fetch_selection=true;}}
if(node.attrs.widget==='many2many_checkboxes'){fields[node.attrs.name].__fetch_many2manys=true;}
return false;}
return node.tag!=='arch';});if('id'in fields_view.fields){var id_field=fields_view.fields.id;id_field.original_type=id_field.type;id_field.type='id';}
_.each(fields_view.fields,function(field){_.each(field.views||{},function(view){self._postprocess_fvg(view);});});return fields_view;},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate:function(cache,key){delete cache[key];},});});;

/* /web/static/src/js/services/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.crash_manager',function(require){"use strict";var CrashManager=require('web.CrashManager');return new CrashManager();});;

/* /web/static/src/js/services/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/js/services/session.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/widgets/auto_complete.js defined in bundle 'web.assets_backend' */
odoo.define('web.AutoComplete',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=parent.$el;this.source=options.source;this.select=options.select;this.get_search_string=options.get_search_string;this.current_result=null;this.searching=true;this.search_string='';this.current_search=null;},start:function(){var self=this;this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER){if(self.search_string.length){self.select_item(ev);}
return;}
var search_string=self.get_search_string();if(self.search_string!==search_string){if(search_string.length){self.search_string=search_string;self.initiate_search(search_string);}else{self.close();}}});this.$input.on('keypress',function(ev){self.search_string=self.search_string+String.fromCharCode(ev.which);if(self.search_string.length){self.searching=true;var search_string=self.search_string;self.initiate_search(search_string);}else{self.close();}});this.$input.on('keydown',function(ev){switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:if(self.search_string.length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:self.searching=false;var current=self.current_result;if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;}
ev.preventDefault();break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$el;$list.empty();results.forEach(function(result){var $item=self.make_list_item(result).appendTo($list);result.$el=$item;});this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').hover(function(){self.focus_element($li);}).mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}}).data('result',result);if(result.expand){var $expand=$('<a class="o-expand" href="#">').appendTo($li);$expand.mousedown(function(ev){ev.stopPropagation();ev.preventDefault();if(result.expanded){self.fold();}else{self.expand();}});$expand.click(function(ev){ev.preventDefault();});result.expanded=false;}
if(result.indent)$li.addClass('o-indent');$li.append($('<a href="#">').html(result.label));return $li;},expand:function(){var self=this;var current_result=this.current_result;current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);current_result.$el.after($li);});self.current_result.expanded=true;self.current_result.$el.find('a.o-expand').removeClass('o-expand').addClass('o-expanded');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('o-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('a.o-expanded').removeClass('o-expanded').addClass('o-expand');},focus_element:function($li){this.$('li').removeClass('o-selection-focus');$li.addClass('o-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){if(this.current_result.facet){this.select(ev,{item:{facet:this.current_result.facet}});this.close();}},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string='';this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.o-selection-focus').next();if(!$next.length)$next=this.$('li').first();}else{$next=this.$('li.o-selection-focus').prev();if(!$next.length)$next=this.$('li').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.o-selection-focus .o-expand').length;},});});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=Widget.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self.rpc("/web/session/change_password",{'fields':$("form[name=change_password_form]").serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}else{self.do_action('logout');}});});},display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/widgets/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DebugManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var common=require('web.form_common');var core=require('web.core');var Dialog=require('web.Dialog');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.Model');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ADD=function(id){return[4,id,false];},REMOVE=function(id){return[3,id,false];};var DebugManager=Widget.extend({template:"WebClient.DebugManager",events:{"click a[data-action]":"perform_callback","mouseover .o_debug_dropdowns > li:not(.open)":function(e){var $opened=this.$('.o_debug_dropdowns > li.open');if($opened.length){$opened.removeClass('open');$(e.currentTarget).addClass('open').find('> a').focus();}},},init:function(){this._super.apply(this,arguments);this._update_stats=_.throttle(this._update_stats.bind(this),1000/15,{leading:false});this._events=null;if(document.querySelector('meta[name=debug]')){this._events=[];}},start:function(){core.bus.on('rpc:result',this,function(req,resp){this._debug_events(resp.debug);});this.on('update-stats',this,this._update_stats);var init;if((init=document.querySelector('meta[name=debug]'))){this._debug_events(JSON.parse(init.getAttribute('value')));}
this.$dropdown=this.$(".o_debug_dropdown");this._features_group=null;this._has_features=false;this._is_admin=session.is_admin;return $.when(new Model('res.users').call('check_access_rights',{operation:'write',raise_exception:false}),session.user_has_group('base.group_no_one'),new Model('ir.model.data').call('xmlid_to_res_id',{xmlid:'base.group_no_one'}),this._super()).then(function(can_write_user,has_group_no_one,group_no_one_id){this._features_group=can_write_user&&group_no_one_id;this._has_features=has_group_no_one;return this.update();}.bind(this));},leave_debug_mode:function(){var qs=$.deparam.querystring();delete qs.debug;window.location.search='?'+$.param(qs);},perform_callback:function(evt){evt.preventDefault();var params=$(evt.target).data();var callback=params.action;if(callback&&this[callback]){this[callback](params,evt);}else{console.warn("No handler for ",callback);}},_debug_events:function(events){if(!this._events){return;}
if(events&&events.length){this._events.push(events);}
this.trigger('update-stats',this._events);},requests_clear:function(){if(!this._events){return;}
this._events=[];this.trigger('update-stats',this._events);},_update_stats:function(rqs){var requests=0,rtime=0,queries=0,qtime=0;for(var r=0;r<rqs.length;++r){for(var i=0;i<rqs[r].length;i++){var event=rqs[r][i];var query_start,request_start;switch(event[0]){case'request-start':request_start=event[3]*1e3;break;case'request-end':++requests;rtime+=(event[3]*1e3-request_start)|0;break;case'sql-start':query_start=event[3]*1e3;break;case'sql-end':++queries;qtime+=(event[3]*1e3-query_start)|0;break;}}}
this.$('#debugmanager_requests_stats').text(_.str.sprintf(_t("%d requests (%d ms) %d queries (%d ms)"),requests,rtime,queries,qtime));},show_timelines:function(){if(this._overlay){this._overlay.destroy();this._overlay=null;return;}
this._overlay=new RequestsOverlay(this);this._overlay.appendTo(document.body);},update:function(){this.$dropdown.empty().append(QWeb.render('WebClient.DebugManager.Global',{manager:this,}));return $.when();},select_view:function(){var self=this;new common.SelectCreateDialog(this,{res_model:'ir.ui.view',title:_t('Select a view'),disable_multiple_selection:true,domain:[['type','!=','qweb'],['type','!=','search']],on_selected:function(element_ids){new Model('ir.ui.view').query(['name','model','type']).filter([['id','=',element_ids[0]]]).first().then(function(view){self.do_action({type:'ir.actions.act_window',name:view.name,res_model:view.model,views:[[view.id,view.type]]});});}}).open();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},toggle_technical_features:function(){if(!this._features_group){return;}
var command=this._has_features?REMOVE(this._features_group):ADD(this._features_group);new Model('res.users').call('write',[session.uid,{groups_id:[command]}]).then(function(){window.location.reload();});},split_assets:function(){window.location=$.param.querystring(window.location.href,'debug=assets');},});DebugManager.include({update:function(tag,descriptor){if(tag==='action'){this._action=descriptor;}
return this._super().then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.Action',{manager:this,action:this._action}));}.bind(this));},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',views:[[false,'form']],view_mode:'form',target:'new',flags:{action_buttons:true,headless:true}});},get_view_fields:function(){var self=this;var model=this._action.res_model;new Model(model).call('fields_get',{attributes:['string','searchable','required','readonly','type','store','sortable','relation','help']}).done(function(fields){new Dialog(self,{title:_.str.sprintf(_t("Fields of %s"),model),$content:$(QWeb.render('WebClient.DebugManager.Action.Fields',{fields:fields}))}).open();});},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this._action.res_model}});},edit_workflow:function(){return this.do_action({res_model:'workflow',name:_t('Edit Workflow'),domain:[['osv','=',this._action.res_model]],views:[[false,'list'],[false,'form'],[false,'diagram']],type:'ir.actions.act_window',view_type:'list',view_mode:'list'});},translate:function(){var model=this._action.res_model;new Model("ir.translation").call('get_technical_translations',[model]).then(this.do_action);}});DebugManager.include({start:function(){this._can_edit_views=false;return $.when(this._super(),new Model('ir.ui.view').call('check_access_rights',{operation:'write',raise_exception:false}).then(function(ar){this._can_edit_views=ar;}.bind(this)));},update:function(tag,descriptor,widget){switch(tag){case'action':if(!(widget instanceof ViewManager)){this._active_view=null;this._view_manager=null;break;}
this._view_manager=widget;widget.on('switch_mode',this,function(){this.update('view',null,widget);});case'view':this._active_view=widget.active_view;}
return this._super(tag,descriptor).then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.View',{manager:this,action:this._action,view:this._active_view,can_edit:this._can_edit_views,searchview:this._view_manager&&this._view_manager.searchview,}));}.bind(this));},get_metadata:function(){var ds=this._view_manager.dataset;if(!this._active_view.controller.get_selected_ids().length){console.warn(_t("No metadata available"));return}
ds.call('get_metadata',[this._active_view.controller.get_selected_ids()]).done(function(result){new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),ds.model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:result[0],format:formats.format_value})}).open();});},set_defaults:function(){this._active_view.controller.open_defaults_dialog();},fvg:function(){var dialog=new Dialog(this,{title:_t("Fields View Get")}).open();$('<pre>').text(utils.json_node_to_xml(this._active_view.controller.fields_view.arch,true)).appendTo(dialog.$el);},print_workflow:function(){var ids=this._active_view.controller.get_selected_ids();framework.blockUI();var action={context:{active_ids:ids},report_name:"workflow.instance.graph",datas:{model:this._view_manager.dataset.model,id:ids[0],nested:true,}};session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:framework.unblockUI});},});function make_context(width,height,fn){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;canvas.style.position='relative';var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctx.oImageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;fn&&fn(ctx);return ctx;}
var RequestsOverlay=Widget.extend({template:'WebClient.DebugManager.RequestsOverlay',TRACKS:8,TRACK_WIDTH:9,events:{mousemove:function(e){this.$tooltip.hide();}},init:function(){this._super.apply(this,arguments);this._render=_.throttle(this._render.bind(this),1000/15,{leading:false});},start:function(){var _super=this._super();this.$tooltip=this.$('div.o_debug_tooltip');this.getParent().on('update-stats',this,this._render);this._render();return _super;},tooltip:function(text,start,end,x,y){var top=y-this.el.offsetTop+this.el.scrollTop+1;var left=x-this.el.offsetLeft+this.el.scrollLeft+1;this.$tooltip.css({top:top,left:left}).show()[0].innerHTML=['<p>',text,' (',(end-start),'ms)','</p>'].join('');},_render:function(){var $summary=this.$('header'),w=$summary[0].clientWidth,$requests=this.$('.o_debug_requests');$summary.find('canvas').attr('width',w);var tracks=document.getElementById('o_debug_requests_summary');_.invoke(this.getChildren(),'destroy');var requests=this.getParent()._events;var bounds=this._get_bounds(requests);var scale=w/(bounds.high-bounds.low);var track_ends=_(this.TRACKS).times(_.constant(-Infinity));var ctx=tracks.getContext('2d');ctx.lineWidth=this.TRACK_WIDTH;for(var i=0;i<requests.length;i++){var request=requests[i];var rstart=Math.floor(request[0][3]*1e3);var rend=Math.ceil(request[request.length-1][3]*1e3);for(var track=0;track<track_ends.length;++track){if(track_ends[track]<rstart){break;}}
if(track>=track_ends.length){console.warn("could not find an empty summary track");continue;}
track_ends[track]=rend;ctx.save();ctx.translate(Math.floor((rstart-bounds.low)*scale),track*(this.TRACK_WIDTH+1));this._draw_request(request,ctx,0,scale);ctx.restore();new RequestDetails(this,request,scale).appendTo($requests);}},_draw_request:function(request,to_context,step,hscale,handle_event){var surfaces={request:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='blue';ctx.fillStyle='#88f';ctx.lineJoin='round';ctx.lineWidth=1;}),sql:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='red';ctx.fillStyle='#f88';ctx.lineJoin='round';ctx.lineWidth=1;}),template:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='green';ctx.fillStyle='#8f8';ctx.lineJoin='round';ctx.lineWidth=1;})};var stacks={},start=Math.floor(request[0][3]*1e3*hscale);var event_idx=0;var rect_width=to_context.lineWidth;for(var i=0;i<request.length;i++){var type,m,event=request[i];var tag=event[0],timestamp=Math.floor(event[3]*1e3*hscale)-start;if(m=/(\w+)-start/.exec(tag)){type=m[1];if(!(type in stacks)){stacks[type]=[];}
handle_event&&handle_event(event_idx,timestamp,event);stacks[type].push({timestamp:timestamp,idx:event_idx++});}else if(m=/(\w+)-end/.exec(tag)){type=m[1];var stack=stacks[type];var estart=stack.pop(),duration=Math.ceil(timestamp-estart.timestamp);handle_event&&handle_event(estart.idx,timestamp,event);var surface=surfaces[type];if(!surface){continue;}
var y=step*estart.idx;surface.rect(estart.timestamp+0.5,y+0.5,duration||1,rect_width);}}
var keys=['request','template','sql'];for(var j=0;j<keys.length;++j){var ctx=surfaces[keys[j]];ctx.fill();ctx.stroke();to_context.drawImage(ctx.canvas,0,0);}},_get_bounds:function(requests){var low=+Infinity;var high=-+Infinity;for(var i=0;i<requests.length;i++){var request=requests[i];for(var j=0;j<request.length;j++){var event=request[j];var timestamp=event[3];low=Math.min(low,timestamp);high=Math.max(high,timestamp);}}
return{low:Math.floor(low*1e3),high:Math.ceil(high*1e3)};}});var RequestDetails=Widget.extend({events:{click:function(){this._open=!this._open;this.render();},'mousemove canvas':function(e){e.stopPropagation();var y=e.y||e.offsetY||e.layerY;if(!y){return;}
var event=this._payloads[Math.floor(y/this._REQ_HEIGHT)];if(!event){return;}
this.getParent().tooltip(event.payload,event.start,event.stop,e.clientX,e.clientY);}},init:function(parent,request,scale){this._super.apply(this,arguments);this._request=request;this._open=false;this._scale=scale;this._REQ_HEIGHT=20;},start:function(){this.el.style.borderBottom='1px solid black';this.render();return this._super();},render:function(){var request_cell_height=this._REQ_HEIGHT,TITLE_WIDTH=200;var request=this._request;var req_start=request[0][3]*1e3;var req_duration=request[request.length-1][3]*1e3-req_start;var height=request_cell_height*(this._open?request.length/2:1);var cell_center=request_cell_height/2;var ctx=make_context(210+Math.ceil(req_duration*this._scale),height,function(ctx){ctx.lineWidth=cell_center;});this.$el.empty().append(ctx.canvas);var payloads=this._payloads=[];var text_ctx=make_context(TITLE_WIDTH,height,function(ctx){ctx.font='12px sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.translate(0,cell_center);});ctx.save();ctx.translate(TITLE_WIDTH+10,((request_cell_height/4)|0));this.getParent()._draw_request(request,ctx,this._open?request_cell_height:0,this._scale,function(idx,timestamp,event){if(/-start$/g.test(event[0])){payloads.push({payload:event[2],start:timestamp,stop:null});var title=event[2];title=title.replace(/\s+$/,'');title=title.length<=50?title:('…'+title.slice(-49));while(text_ctx.measureText(title).width>200){title='…'+title.slice(2);}
text_ctx.fillText(title,TITLE_WIDTH,request_cell_height*idx);}else if(/-end$/g.test(event[0])){payloads[idx].stop=timestamp;}});ctx.restore();ctx.drawImage(text_ctx.canvas,0,0);}});if(core.debug){SystrayMenu.Items.push(DebugManager);WebClient.include({current_action_updated:function(action){this._super.apply(this,arguments);var action_descr=action&&action.action_descr;var action_widget=action&&action.widget;var debug_manager=_.find(this.systray_menu.widgets,function(item){return item instanceof DebugManager;});debug_manager.update('action',action_descr,action_widget);},});Dialog.include({open:function(){var self=this;var parent=self.getParent();if(parent instanceof ActionManager&&parent.dialog_widget){this.opened(function(){self.debug_manager=new DebugManager(self);var $header=self.$modal.find('.modal-header');return self.debug_manager.prependTo($header).then(function(){self.debug_manager.update('action',parent.dialog_widget.action,parent.dialog_widget);});});}
return this._super.apply(this,arguments);},});}
return DebugManager;});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'click .o_expand_parent':function(e){this.on_expand_action(this.records[$(e.target).closest('.o_export_tree_item').data('id')]);},'click .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var row_index=$elem.prevAll('.o_export_tree_item').length;var row_index_level=$elem.parents('.o_export_tree_item').length;if(e.shiftKey&&row_index_level===this.row_index_level){var minIndex=Math.min(row_index,this.row_index);var maxIndex=Math.max(row_index,this.row_index);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(process_children);}
this.row_index=row_index;this.row_index_level=row_index_level;if(e.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(e.shiftKey){$elem.addClass('o_selected').focus();}else{this.$(".o_selected").removeClass("o_selected")
$elem.addClass("o_selected").focus();}
function process_children(){var $this=$(this);if($this.hasClass('open')){$this.children('.o_export_tree_item').addClass('o_selected').each(process_children);}}},'dblclick .o_export_tree_item':function(e){var $elem=$(e.currentTarget);$elem.removeClass('o_selected');this.add_field($elem.data('id'),$elem.find('.o_tree_column').first().text());},'keydown .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var record=this.records[$elem.data('id')];switch(e.keyCode||e.which){case $.ui.keyCode.LEFT:if($elem.hasClass('open')){this.on_expand_action(record);}
break;case $.ui.keyCode.RIGHT:if(!$elem.hasClass('open')){this.on_expand_action(record);}
break;case $.ui.keyCode.UP:var $prev=$elem.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('open')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$elem.parent('.o_export_tree_item');if($prev.length===0){break;}}
$elem.removeClass("o_selected").blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($elem.hasClass('open')){$next=$elem.children('.o_export_tree_item').first();}else{$next=$elem.next('.o_export_tree_item');if($next.length===0){$next=$elem.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$elem.removeClass("o_selected").blur();$next.addClass("o_selected").focus();break;}},'click .o_add_field':function(){var self=this;this.$('.o_field_tree_structure .o_selected').removeClass('o_selected').each(function(){var $this=$(this);self.add_field($this.data('id'),$this.children('.o_tree_column').text());});},'click .o_remove_field':function(){this.$fields_list.find('option:selected').remove();},'click .o_remove_all_field':function(){this.$fields_list.empty();},'click .o_move_up':function(){var $selected_rows=this.$fields_list.find('option:selected');var $prev_row=$selected_rows.first().prev();if($prev_row.length){$prev_row.before($selected_rows.detach());}},'click .o_move_down':function(){var $selected_rows=this.$fields_list.find('option:selected');var $next_row=$selected_rows.last().next();if($next_row.length){$next_row.after($selected_rows.detach());}},'click .o_toggle_save_list':function(e){e.preventDefault();var $saveList=this.$(".o_save_list");if($saveList.is(':empty')){$saveList.append(QWeb.render('Export.SaveList'));}else{if($saveList.is(':hidden')){$saveList.show();$saveList.find(".o_export_list_input").val("");}else{$saveList.hide();}}},'click .o_save_list > button':function(e){var $saveList=this.$(".o_save_list");var value=$saveList.find("input").val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this.get_fields();if(fields.length===0){return;}
$saveList.hide();var self=this;this.exports.create({name:value,resource:this.dataset.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(export_list_id){if(!export_list_id){return;}
var $select=self.$(".o_exported_lists_select");if($select.length===0||$select.is(":hidden")){self.show_exports_list();}
$select.append(new Option(value,export_list_id));});},},init:function(parent,dataset){var options={title:_t("Export Data"),buttons:[{text:_t("Export To File"),click:this.export_data,classes:"btn-primary"},{text:_t("Close"),close:true},],};this._super(parent,options);this.records={};this.dataset=dataset;this.exports=new data.DataSetSearch(this,'ir.exports',this.dataset.get_context());this.row_index=0;this.row_index_level=0;this.$modal.find(".modal-content").css("height","100%");},start:function(){var self=this;var waitFor=[this._super.apply(this,arguments)];this.$fields_list=this.$('.o_fields_list');this.$import_compat_radios=this.$('.o_import_compat input');waitFor.push(this.rpc('/web/export/formats',{}).then(do_setup_export_formats));var got_fields=new $.Deferred();this.$import_compat_radios.change(function(e){self.$('.o_field_tree_structure').remove();self.rpc("/web/export/get_fields",{model:self.dataset.model,import_compat:!!$(e.target).val(),}).done(function(records){var compatible_fields=_.map(records,function(record){return record.id});self.$fields_list.find('option').filter(function(){var option_field=$(this).attr('value');if(compatible_fields.indexOf(option_field)===-1){return true;}}).remove();got_fields.resolve();self.on_show_data(records);});}).eq(0).change();waitFor.push(got_fields);waitFor.push(this.getParent().get_active_domain().then(function(domain){if(domain===undefined){self.ids_to_export=self.getParent().get_selected_ids();self.domain=self.dataset.domain;}else{self.ids_to_export=false;self.domain=domain;}
self.on_show_domain();}));waitFor.push(this.show_exports_list());return $.when.apply($,waitFor);function do_setup_export_formats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format,i){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name'});var $label=$('<label/>',{html:format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s — %s",format.label,format.error));}
$fmts.append($("<div/>").append($radio,$label));});self.$export_format_inputs=$fmts.find('input');self.$export_format_inputs.first().prop('checked',true);}},show_exports_list:function(){if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return $.when();}
var self=this;return this.exports.read_slice(['name'],{domain:[['resource','=',this.dataset.model]]}).then(function(export_list){if(!export_list.length){return;}
self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{'existing_exports':export_list}));self.$('.o_exported_lists_select').on('change',function(){self.$fields_list.empty();var export_id=self.$('.o_exported_lists_select option:selected').val();if(export_id){self.rpc('/web/export/namelist',{model:self.dataset.model,export_id:parseInt(export_id,10),}).then(do_load_export_field);}});self.$('.o_delete_exported_list').click(function(){var select_exp=self.$('.o_exported_lists_select option:selected');if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();self.$fields_list.empty();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}});});function do_load_export_field(field_list){_.each(field_list,function(field){self.$fields_list.append(new Option(field.label,field.name));});}},on_expand_action:function(record){if(!record['children']){return;}
var model=record['params']['model'];var prefix=record['params']['prefix'];var name=record['params']['name'];var exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var self=this;this.rpc("/web/export/get_fields",{model:model,prefix:prefix,parent_name:name,import_compat:!!this.$import_compat_radios.filter(':checked').val(),parent_field_type:record['field_type'],exclude:exclude_fields}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{this.show_content(record.id);}},on_show_domain:function(){this.$('p').first().after(QWeb.render('Export.DomainMessage',{record:this}));},on_show_data:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('open').find('.o_expand_parent').toggleClass('fa-plus fa-minus').next().after(QWeb.render('Export.TreeItems',{'fields':records}));}else{this.$('.o_left_field_panel').empty().append($("<div/>").addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{'fields':records})));}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$(".o_export_tree_item");this.$records.each(function(i,el){var $elem=$(el);$elem.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$elem.data('id')].required);});},show_content:function(id){var $this=this.$('.o_export_tree_item[data-id="'+id+'"]');$this.toggleClass('open');var is_open=$this.hasClass('open');$this.children('.o_expand_parent').toggleClass('fa-minus',!!is_open).toggleClass('fa-plus',!is_open);var $child_field=$this.find('.o_export_tree_item');var child_len=(id.split("/")).length+1;for(var i=0;i<$child_field.length;i++){var $child=$child_field.eq(i);if(!is_open){$child.hide();}else if(child_len===$child_field.eq(i).data('id').split("/").length){if($child.hasClass('open')){$child.removeClass('open');$child.children('.o_expand_parent').removeClass('fa-minus').addClass('fa-plus');}
$child.show();}}},add_field:function(field_id,string){var $field_list=this.$('.o_fields_list');field_id=this.records[field_id].value||field_id;if($field_list.find("option[value='"+field_id+"']").length===0){$field_list.append(new Option(string,field_id));}},get_fields:function(){var $export_fields=this.$(".o_fields_list option").map(function(){return $(this).val();}).get();if($export_fields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return $export_fields;},export_data:function(){var self=this;var exported_fields=this.$('.o_fields_list option').map(function(){return{name:(self.records[this.value]||this).value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
exported_fields.unshift({name:'id',label:'External ID'});var export_format=this.$export_format_inputs.filter(':checked').val();framework.blockUI();this.session.get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.dataset.model,fields:exported_fields,ids:this.ids_to_export,domain:this.domain,context:pyeval.eval('contexts',[this.dataset._model.context()]),import_compat:!!this.$import_compat_radios.filter(':checked').val(),})},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});},});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'dp.change':'change_datetime','dp.show':'set_datetime_default','change .o_datepicker_input':'change_datetime',},init:function(parent,options){this._super.apply(this,arguments);var l10n=_t.database.parameters;this.name=parent.name;this.options=_.defaults(options||{},{pickTime:this.type_of_date==='datetime',useSeconds:this.type_of_date==='datetime',startDate:moment({y:1900}),endDate:moment().add(200,"y"),calendarWeeks:true,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down'},language:moment.locale(),format:time.strftime_to_moment_format((this.type_of_date==='datetime')?(l10n.date_format+' '+l10n.time_format):l10n.date_format),});},start:function(){this.$input=this.$('input.o_datepicker_input');this.$el.datetimepicker(this.options);this.picker=this.$el.data('DateTimePicker');this.set_readonly(false);this.set_value(false);},set_value:function(value){this.set({'value':value});this.$input.val((value)?this.format_client(value):'');this.picker.setValue(this.format_client(value));},get_value:function(){return this.get('value');},set_value_from_ui:function(){var value=this.$input.val()||false;this.set_value(this.parse_client(value));},set_readonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},is_valid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this.parse_client(value);return true;}catch(e){return false;}}},parse_client:function(v){return formats.parse_value(v,{"widget":this.type_of_date});},format_client:function(v){return formats.format_value(v,{"widget":this.type_of_date});},set_datetime_default:function(){var value=moment().second(0);if(this.$input.val().length!==0&&this.is_valid()){value=this.$input.val();}
var saved_picktime=this.picker.options.pickTime;this.picker.options.pickTime=true;this.picker.setValue(value);this.picker.options.pickTime=saved_picktime;},change_datetime:function(e){if(this.is_valid()){this.set_value_from_ui();this.trigger("datetime_changed");}},commit_value:function(){this.change_datetime();},destroy:function(){this.picker.destroy();this._super.apply(this,arguments);},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime"});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/loading.js defined in bundle 'web.assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:"Loading",init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;session.on("request",this,this.request_call);session.on("response",this,this.response_call);session.on("response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/notification.js defined in bundle 'web.assets_backend' */
odoo.define('web.notification',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var Notification=Widget.extend({template:'Notification',events:{'click .o_close':function(e){e.preventDefault();this.destroy(true);}},init:function(parent,title,text,sticky){this._super.apply(this,arguments);this.title=title;this.text=text;this.sticky=!!sticky;},start:function(){this._super.apply(this,arguments);var self=this;this.$el.animate({opacity:1.0},400,"swing",function(){if(!self.sticky){setTimeout(function(){self.destroy(true);},2500);}});},destroy:function(animate){if(!animate){return this._super.apply(this,arguments);}
var self=this,superDestroy=this._super;this.$el.animate({opacity:0.0},400,"swing",function(){self.$el.animate({height:0},400,"swing",function(){superDestroy.call(self);});});},});var Warning=Notification.extend({template:'Warning',});var NotificationManager=Widget.extend({className:'o_notification_manager',display:function(notification){notification.appendTo(this.$el);return notification;},notify:function(title,text,sticky){return this.display(new Notification(this,title,text,sticky));},warn:function(title,text,sticky){return this.display(new Warning(this,title,text,sticky));},});return{Notification:Notification,Warning:Warning,NotificationManager:NotificationManager,};});;

/* /web/static/src/js/widgets/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('web.Sidebar',function(require){"use strict";var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyeval=require('web.pyeval');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Sidebar=Widget.extend({init:function(parent,options){var self=this;this._super(parent);this.options=_.defaults(options||{},{'editable':true});this.sections=options.sections||[{name:'print',label:_t('Print')},{name:'other',label:_t('Action')},];this.items=options.items||{print:[],other:[],};this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.do_attachement_update(self.dataset,self.model_id,args);framework.unblockUI();});},start:function(){var self=this;this._super(this);this.$el.addClass('btn-group');this.redraw();this.$el.on('click','.dropdown-menu li a',function(event){var section=$(this).data('section');var index=$(this).data('index');var item=self.items[section][index];if(item.callback){item.callback.apply(self,[item]);}else if(item.action){self.on_item_action_clicked(item);}else if(item.url){return true;}
event.preventDefault();});},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},redraw:function(){this.$el.html(QWeb.render('Sidebar',{widget:this}));this.$('.o_dropdown').each(function(){if(!$(this).find('li').length){$(this).hide();}});this.$("[title]").tooltip({delay:{show:500,hide:0}});this.$('.o_sidebar_add_attachment .o_form_binary_form').change(this.on_attachment_changed);this.$('.o_sidebar_delete_attachment').click(this.on_attachment_delete);},add_items:function(section_code,items){if(items){this.items[section_code].unshift.apply(this.items[section_code],items);this.redraw();}},add_toolbar:function(toolbar){var self=this;_.each(['print','action','relate'],function(type){var items=toolbar[type];if(items){var actions=_.map(items,function(item){return{label:item.name,action:item,};});self.add_items(type==='print'?'print':'other',actions);}});},on_item_action_clicked:function(item){var self=this;self.getParent().sidebar_eval_context().done(function(sidebar_eval_context){var ids=self.getParent().get_selected_ids();var domain;if(self.getParent().get_active_domain){domain=self.getParent().get_active_domain();}
else{domain=$.Deferred().resolve(undefined);}
if(ids.length===0){new Dialog(this,{title:_t("Warning"),size:'medium',$content:$("<div/>").html(_t("You must choose at least one record."))}).open();return false;}
var dataset=self.getParent().dataset;var active_ids_context={active_id:ids[0],active_ids:ids,active_model:dataset.model,};$.when(domain).done(function(domain){if(domain!==undefined){active_ids_context.active_domain=domain;}
var c=pyeval.eval('context',new data.CompoundContext(sidebar_eval_context,active_ids_context));self.rpc("/web/action/load",{action_id:item.action.id,context:new data.CompoundContext(dataset.get_context(),active_ids_context).eval()}).done(function(result){result.context=new data.CompoundContext(result.context||{},active_ids_context).set_eval_context(c);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.getParent().reload();},});});});});},do_attachement_update:function(dataset,model_id,args){this.dataset=dataset;this.model_id=model_id;if(args&&args[0].error){this.do_warn(_t('Uploading Error'),args[0].error);}
if(!model_id){this.on_attachments_loaded([]);}else{var dom=[['res_model','=',dataset.model],['res_id','=',model_id],['type','in',['binary','url']]];var ds=new data.DataSetSearch(this,'ir.attachment',dataset.get_context(),dom);ds.read_slice(['name','url','type','create_uid','create_date','write_uid','write_date'],{}).done(this.on_attachments_loaded);}},on_attachments_loaded:function(attachments){_.each(attachments,function(a){a.label=a.name;if(a.type==="binary"){a.url='/web/content/'+a.id+'?download=true';}});this.items.files=attachments;this.redraw();},on_attachment_changed:function(e){var $e=$(e.target);if($e.val()!==''){this.$('form.o_form_binary_form').submit();$e.parent().find('input[type=file]').prop('disabled',true);$e.parent().find('button').prop('disabled',true).find('img, span').toggle();this.$('.o_sidebar_add_attachment a').text(_t('Uploading...'));framework.blockUI();}},on_attachment_delete:function(e){e.preventDefault();e.stopPropagation();var self=this;var $e=$(e.currentTarget);var options={confirm_callback:function(){new data.DataSet(this,'ir.attachment').unlink([parseInt($e.attr('data-id'),10)]).done(function(){self.do_attachement_update(self.dataset,self.model_id);});}};Dialog.confirm(this,_t("Do you really want to delete this attachment ?"),options);}});return Sidebar;});;

/* /web/static/src/js/widgets/priority.js defined in bundle 'web.assets_backend' */
odoo.define('web.Priority',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Priority=Widget.extend({template:"Priority",events:{'mouseover > a':function(e){clearTimeout(this.hover_timer);this.$stars.removeClass('fa-star-o').addClass('fa-star');$(e.target).nextAll().removeClass('fa-star').addClass('fa-star-o');},'mouseout > a':function(e){clearTimeout(this.hover_timer);var self=this;this.hover_timer=setTimeout(function(){self._render_value();},200);},'click > a':function(e){e.preventDefault();e.stopPropagation();var old_value=this.value;this.value=String($(e.target).data('value'));if(old_value===this.value){this.value=this.empty_value;}
this._render_value();this.trigger('update',{value:this.value});},},init:function(parent,options){this._super.apply(this,arguments);options=_.defaults(options||{},{readonly:true,value:0,values:[[0,_t("Normal")],[1,_t("Low")],[2,_t("High")],[3,_t("Very High")]],});this.readonly=options.readonly;this.value=options.value;this.values=options.values;this.empty_value=this.values[0][0];},start:function(){this._render_value();return this._super();},set_value:function(value){this.value=value;this._render_value();},_render_value:function(){var current_value=this.value;this.$stars=this.$('.o_priority_star');this.$stars.each(function(i,el){var $star=$(el);var star_value=$star.data('value');$star.toggleClass('fa-star',(star_value<=current_value)).toggleClass('fa-star-o',(star_value>current_value));});},});return Priority;});;

/* /web/static/src/js/widgets/progress_bar.js defined in bundle 'web.assets_backend' */
odoo.define('web.ProgressBar',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ProgressBar=Widget.extend({template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},init:function(parent,options){this._super(parent);options=_.defaults(options||{},{readonly:true,edit_on_click:false,value:0,max_value:100,title:'',edit_max_value:false,});this.readonly=options.readonly;this.edit_on_click=options.edit_on_click;this.value=options.value;this.max_value=options.max_value;this.title=options.title;this.edit_max_value=options.edit_max_value;},start:function(){this._render_value();if(!this.readonly){if(this.edit_on_click){var self=this;this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);self.value=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self._render_value();self.trigger('update',{value:self.value,max_value:self.max_value,changed_value:self.value});});}else{this.$el.on('blur','input',_.bind(this.on_change_input,this));}
this.$('.o_progressbar_value').focus().select()}
return this._super();},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
if(isNaN($input.val())){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{if(e.type==='input'){this._render_value($input.val());if(parseFloat($input.val())===0){$input.select();}}else{if(this.edit_max_value){this.max_value=$(e.target).val();}else{this.value=$(e.target).val()||0;}
this._render_value();this.trigger('update',{value:this.value,max_value:this.max_value,changed_value:(this.edit_max_value)?this.max_value:this.value});}}},set_value:function(v){this.value=v;this._render_value();},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(this.readonly){if(max_value!==100){this.$('.o_progressbar_value').html(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').html(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);}}});return ProgressBar;});;

/* /web/static/src/js/widgets/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";var utils=require('web.utils');var Widget=require('web.Widget');var direction={previous:-1,next:1,};var Pager=Widget.extend({template:"Pager",events:{'click .o_pager_previous':'previous','click .o_pager_next':'next','click .o_pager_value':'_edit',},init:function(parent,size,current_min,limit,options){this.state={size:size,current_min:current_min,limit:limit,};Object.defineProperty(this.state,'current_max',{get:function(){return Math.min(this.current_min+this.limit-1,this.size);}});this.options=_.defaults({},options,{can_edit:true,single_page_hidden:false,validate:function(){return $.Deferred().resolve();},});this._super(parent);},start:function(){this.$value=this.$('.o_pager_value');this.$limit=this.$('.o_pager_limit');this._render();return this._super();},update_state:function(state){_.extend(this.state,state);this._render();},previous:function(){this._change_selection(direction.previous);},next:function(){this._change_selection(direction.next);},disable:function(){this.$('button').prop("disabled",true);},enable:function(){this.$('button').prop("disabled",false);},_edit:function(){if(this.options.can_edit){var self=this;var $input=$('<input>',{type:'text',value:this.$value.html()});this.$value.html($input);$input.focus();$input.click(function(ev){ev.stopPropagation();});$input.blur(function(ev){self._save($(ev.target));});$input.on('keydown',function(ev){ev.stopPropagation();if(ev.which===$.ui.keyCode.ENTER){self._save($(ev.target));}else if(ev.which===$.ui.keyCode.ESCAPE){self._render();}});}},_save:function($input){var self=this;this.options.validate().then(function(){var value=$input.val().split("-");var min=utils.confine(parseInt(value[0],10),1,self.state.size);var max=utils.confine(parseInt(value[1],10),1,self.state.size);if(!isNaN(min)){self.state.current_min=min;if(!isNaN(max)){self.state.limit=utils.confine(max-min+1,1,self.state.size);}else{self.state.limit=1;}
self.trigger('pager_changed',_.clone(self.state));}}).always(function(){self._render();});},_change_selection:function(direction){var self=this;this.options.validate().then(function(){var size=self.state.size;var current_min=self.state.current_min;var limit=self.state.limit;current_min=(current_min+limit*direction);if(current_min>size){current_min=1;}else if((current_min<1)&&(limit===1)){current_min=size;}else if((current_min<1)&&(limit>1)){current_min=size-((size%limit)||limit)+1;}
self.state.current_min=current_min;self.trigger('pager_changed',_.clone(self.state));self._render();});},_render:function(){var size=this.state.size;var current_min=this.state.current_min;var current_max=this.state.current_max;var single_page=1===current_min&&current_max===size;if(size===0||(single_page&&this.options.single_page_hidden)){this.do_hide();}else{this.do_show();if(single_page){this.disable();}else{this.enable();}
var value=""+current_min;if(this.state.limit>1){value+="-"+current_max;}
this.$value.html(value);this.$limit.html(size);}},});return Pager;});;

/* /web/static/src/js/widgets/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.widgets=[];this.load=$.Deferred();},start:function(){var self=this;self._super.apply(this,arguments);self.load_items();$.when.apply($,self.items).always(function(){self.load.resolve();});return self.load;},load_items:function(){var self=this;SystrayMenu.Items=_.sortBy(SystrayMenu.Items,function(item){return!_.isUndefined(item.prototype.sequence)?item.prototype.sequence:50;});_.each(SystrayMenu.Items,function(widgetCls){var cur_systray_item=new widgetCls(self);self.widgets.push(cur_systray_item);self.items.push(cur_systray_item.prependTo(self.$el));});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SwitchCompanyMenu',function(require){"use strict";var Model=require('web.Model');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var SwitchCompanyMenu=Widget.extend({template:'SwitchCompanyMenu',willStart:function(){if(!session.user_companies){return $.Deferred().reject();}
return this._super();},start:function(){var self=this;this.$el.on('click','.dropdown-menu li a[data-menu]',_.debounce(function(ev){ev.preventDefault();var company_id=$(ev.currentTarget).data('company-id');new Model('res.users').call('write',[[session.uid],{'company_id':company_id}]).then(function(){location.reload();});},1500,true));self.$('.oe_topbar_name').text(session.user_companies.current_company[1]);var companies_list='';_.each(session.user_companies.allowed_companies,function(company){var a='';if(company[0]===session.user_companies.current_company[0]){a='<i class="fa fa-check o_current_company"></i>';}else{a='<span class="o_company"/>';}
companies_list+='<li><a href="#" data-menu="company" data-company-id="'+company[0]+'">'+a+company[1]+'</a></li>';});self.$('.dropdown-menu').html(companies_list);return this._super();},});SystrayMenu.Items.push(SwitchCompanyMenu);});;

/* /web/static/src/js/widgets/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var framework=require('web.framework');var Model=require('web.Model');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var UserMenu=Widget.extend({template:"UserMenu",start:function(){var self=this;this.$el.on('click','.dropdown-menu li a[data-menu]',function(ev){ev.preventDefault();var f=self['on_menu_'+$(this).data('menu')];if(f){f($(this));}});return this._super.apply(this,arguments).then(function(){return self.do_update();});},do_update:function(){var $avatar=this.$('.oe_topbar_avatar');if(!session.uid){$avatar.attr('src',$avatar.data('default-src'));return $.when();}
var topbar_name=session.name;if(session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
this.$('.oe_topbar_name').text(topbar_name);var avatar_src=session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid});$avatar.attr('src',avatar_src);},on_menu_documentation:function(){window.open('https://www.odoo.com/documentation/user','_blank');},on_menu_support:function(){window.open('https://www.odoo.com/buy','_blank');},on_menu_settings:function(){var self=this;this.trigger_up('clear_uncommitted_changes',{callback:function(){self.rpc("/web/action/load",{action_id:"base.action_res_users_my"}).done(function(result){result.res_id=session.uid;self.do_action(result);});},});},on_menu_account:function(){this.trigger_up('clear_uncommitted_changes',{callback:function(){var P=new Model('ir.config_parameter');P.call('get_param',['database.uuid']).then(function(dbuuid){var state={'d':session.db,'u':window.location.protocol+'//'+window.location.host,};var params={response_type:'token',client_id:dbuuid||'',state:JSON.stringify(state),scope:'userinfo',};framework.redirect('https://accounts.odoo.com/oauth2/auth?'+$.param(params));}).fail(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});},});},on_menu_logout:function(){this.trigger_up('clear_uncommitted_changes',{callback:this.do_action.bind(this,'logout'),});},});return UserMenu;});;

/* /web/static/src/js/menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.Menu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var Menu=Widget.extend({init:function(){var self=this;this._super.apply(this,arguments);this.is_bound=$.Deferred();this.data={data:{children:[]}};this.on("menu_bound",this,function(){var $all_menus=self.$el.parents('.o_web_client').find('.o_sub_menu').find('[data-menu]');var all_menu_ids=_.map($all_menus,function(menu){return parseInt($(menu).attr('data-menu'),10);});if(!_.isEmpty(all_menu_ids)){this.do_load_needaction(all_menu_ids);}});core.bus.on('do_reload_needaction',this,this.do_reload_needaction);core.bus.on('change_menu_section',this,this.on_change_top_menu);},start:function(){this._super.apply(this,arguments);return this.bind_menu();},do_reload:function(){var self=this;self.bind_menu();},bind_menu:function(){var self=this;this.$secondary_menus=this.$el.parents().find('.o_sub_menu');this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);this.$el.on('click','a[data-menu]',function(event){event.preventDefault();var menu_id=$(event.currentTarget).data('menu');var needaction=$(event.target).is('div#menu_counter');core.bus.trigger('change_menu_section',menu_id,needaction);});this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').addClass('o_hidden');if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_bound');var lazyreflow=_.debounce(this.reflow.bind(this),200);core.bus.on('resize',this,function(){if($(window).width()<768){lazyreflow('all_outside');}else{lazyreflow();}});core.bus.trigger('resize');this.is_bound.resolve();},do_load_needaction:function(menu_ids){var self=this;menu_ids=_.compact(menu_ids);if(_.isEmpty(menu_ids)){return $.when();}
return this.rpc("/web/menu/load_needaction",{'menu_ids':menu_ids}).done(function(r){self.on_needaction_loaded(r);});},on_needaction_loaded:function(data){var self=this;this.needaction_data=data;_.each(this.needaction_data,function(item,menu_id){var $item=self.$secondary_menus.find('a[data-menu="'+menu_id+'"]');$item.find('.badge').remove();if(item.needaction_counter&&item.needaction_counter>0){$item.append(QWeb.render("Menu.needaction_counter",{widget:item}));}});},reflow:function(behavior){var self=this;var $more_container=this.$('#menu_more_container').hide();var $more=this.$('#menu_more');var $systray=this.$el.parents().find('.oe_systray');$more.children('li').insertBefore($more_container);if(behavior==='all_outside'){self.$el.show();this.$el.find('li').show();$more_container.hide();return;}
var $toplevel_items=this.$el.find('li').not($more_container).not($systray.find('li')).hide();self.$el.show();$toplevel_items.each(function(){var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>=remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length);var $toplevel=self.$el.children("li:visible");if($toplevel.length===1){$toplevel.hide();}},open_menu:function(id){this.current_menu=id;session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']');}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
this.$el.find('.active').removeClass('active');$main_menu.parent().addClass('active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();this.$secondary_menus.toggleClass('o_hidden',!$sub_menu.children().length);this.$secondary_menus.find('.active').removeClass('active');if($main_menu!==$clicked_menu){$clicked_menu.parents().removeClass('o_hidden');if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggleClass('o_hidden');}else{$clicked_menu.parent().addClass('active');}}
this.$secondary_menus.find('.oe_secondary_submenu li a span').each(function(){$(this).tooltip(this.scrollWidth>this.clientWidth?{title:$(this).text().trim(),placement:'right'}:'destroy');});},open_action:function(id){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');var menu_id=$menu.data('menu');if(menu_id){this.open_menu(menu_id);}},menu_click:function(id,needaction){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(!action_id){if(this.$el.has($item).length){var $sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+id+']');var $items=$sub_menu.find('a[data-action-id]').filter('[data-action-id!=""]');if($items.length){action_id=$items.data('action-id');id=$items.data('menu');}}}
if(action_id){this.trigger('menu_click',{action_id:action_id,needaction:needaction,id:id,previous_menu_id:this.current_menu},$item);}else{console.log('Menu no action found web test 04 will fail');}
this.open_menu(id);},do_reload_needaction:function(){var self=this;if(self.current_menu){self.do_load_needaction([self.current_menu]).then(function(){self.trigger("need_action_reloaded");});}},on_change_top_menu:function(menu_id,needaction){var self=this;var $secondary_menu=this.$el.parents().find('.oe_secondary_menu[data-menu-parent='+menu_id+']');var $menu_leaves=$secondary_menu.children().find('.oe_menu_leaf');var menu_ids=_.map($menu_leaves,function(leave){return parseInt($(leave).attr('data-menu'),10);});self.do_load_needaction(menu_ids).then(function(){self.trigger("need_action_reloaded");});this.$el.parents().find(".oe_secondary_menus_container").scrollTop(0,0);this.menu_click(menu_id,needaction);},on_menu_click:function(ev){ev.preventDefault();var needaction=$(ev.target).is('div#menu_counter');this.menu_click($(ev.currentTarget).data('menu'),needaction);},});return Menu;});;

/* /web/static/src/js/views/list_common.js defined in bundle 'web.assets_backend' */
odoo.define('web.list_common',function(require){"use strict";var core=require('web.core');var _t=core._t;var Class=core.Class;var Events={bind:function(event,handler){var calls=this['_callbacks']||(this._callbacks={});if(event in calls){calls[event].push(handler);}else{calls[event]=[handler];}
return this;},unbind:function(event,handler){var calls=this._callbacks||{};if(!(event in calls)){return this;}
if(!handler){delete calls[event];}else{var handlers=calls[event];handlers.splice(_(handlers).indexOf(handler),1);}
return this;},trigger:function(event){var calls;if(!(calls=this._callbacks)){return this;}
var callbacks=(calls[event]||[]).concat(calls[null]||[]);for(var i=0,length=callbacks.length;i<length;++i){callbacks[i].apply(this,arguments);}
return this;}};var Record=Class.extend({init:function(data){this.attributes=data||{};},get:function(key){return this.attributes[key];},set:function(key,value,options){options=options||{};var old_value=this.attributes[key];if(old_value===value){return this;}
this.attributes[key]=value;if(!options.silent){this.trigger('change:'+key,this,value,old_value);this.trigger('change',this,key,value,old_value);}
return this;},toForm:function(){var form_data={},attrs=this.attributes;for(var k in attrs){form_data[k]={value:attrs[k]};}
return{data:form_data};},toContext:function(){var output={},attrs=this.attributes;for(var k in attrs){var val=attrs[k];if(typeof val!=='object'){output[k]=val;}else if(val instanceof Array){output[k]=val[0];}else{throw new Error(_.str.sprintf(_t("Can't convert value %s to context"),val));}}
return output;}});Record.include(Events);var Collection=Class.extend({init:function(records,options){options=options||{};_.bindAll(this,'_onRecordEvent');this.length=0;this.records=[];this._byId={};this._proxies={};this._key=options.key;this._parent=options.parent;if(records){this.add(records);}},add:function(record,options){options=options||{};var records=record instanceof Array?record:[record];for(var i=0,length=records.length;i<length;++i){var instance_=(records[i]instanceof Record)?records[i]:new Record(records[i]);instance_.bind(null,this._onRecordEvent);this._byId[instance_.get('id')]=instance_;if(options.at===undefined||options.at===null){this.records.push(instance_);if(!options.silent){this.trigger('add',this,instance_,this.records.length-1);}}else{var insertion_index=options.at+i;this.records.splice(insertion_index,0,instance_);if(!options.silent){this.trigger('add',this,instance_,insertion_index);}}
this.length++;}
return this;},at:function(index,group){if(group){var groups=group.split('.');return this._proxies[groups[0]].at(index,groups.join('.'));}
return this.records[index];},get:function(id){if(!_(this._proxies).isEmpty()){var record=null;_(this._proxies).detect(function(proxy){record=proxy.get(id);return record;});return record;}
return this._byId[id];},proxy:function(section){this._proxies[section]=new Collection(null,{parent:this,key:section}).bind(null,this._onRecordEvent);return this._proxies[section];},reset:function(records,options){options=options||{};_(this._proxies).each(function(proxy){proxy.reset();});this._proxies={};_(this.records).invoke('unbind',null,this._onRecordEvent);this.length=0;this.records=[];this._byId={};if(records){this.add(records);}
if(!options.silent){this.trigger('reset',this);}
return this;},remove:function(record,options){var index=this.indexOf(record);if(index===-1){_(this._proxies).each(function(proxy){proxy.remove(record);});return this;}
record.unbind(null,this._onRecordEvent);this.records.splice(index,1);delete this._byId[record.get('id')];this.length--;if(!options||!options.silent){this.trigger('remove',record,this);}
return this;},_onRecordEvent:function(event){switch(event){case'reset':return;case'change:id':var record=arguments[1];var new_value=arguments[2];var old_value=arguments[3];if(this._byId[old_value]===record){delete this._byId[old_value];this._byId[new_value]=record;}
break;}
this.trigger.apply(this,arguments);},find:function(callback){var record;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((record=this._proxies[section].find(callback))){return record;}}
for(var i=0;i<this.length;++i){record=this.records[i];if(callback(record)){return record;}}},each:function(callback){for(var section in this._proxies){if(this._proxies.hasOwnProperty(section)){this._proxies[section].each(callback);}}
for(var i=0;i<this.length;++i){callback(this.records[i]);}},map:function(callback){var results=[];this.each(function(record){results.push(callback(record));});return results;},pluck:function(fieldname){return this.map(function(record){return record.get(fieldname);});},indexOf:function(record){return _(this.records).indexOf(record);},succ:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].succ(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index+1;if(options.wraparound&&(next_index===this.length)){return this.at(0);}
return this.at(next_index);},pred:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].pred(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index-1;if(options.wraparound&&(next_index===-1)){return this.at(this.length-1);}
return this.at(next_index);}});Collection.include(Events);return{Events:Events,Record:Record,Collection:Collection};});;

/* /web/static/src/js/views/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var DataExport=require('web.DataExport');var formats=require('web.formats');var common=require('web.list_common');var Model=require('web.DataModel');var Pager=require('web.Pager');var pyeval=require('web.pyeval');var session=require('web.session');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var Class=core.Class;var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var list_widget_registry=core.list_widget_registry;var row_decoration=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var ListView=View.extend({_template:'ListView',accesskey:"l",require_fields:true,defaults:_.extend({},View.prototype.defaults,{selectable:true,deletable:false,header:true,addable:_lt("Create"),sortable:true,reorderable:true,action_buttons:true,disable_editable_mode:false,}),display_name:_lt('List'),events:{'click thead th.o_column_sortable[data-id]':'sort_by_column','click .oe_view_nocontent':function(){if(this.$buttons){this.$buttons.width(this.$buttons.width()+1).openerpBounce();}},},icon:'fa-list-ul',init:function(){var self=this;this._super.apply(this,arguments);this.options=_.defaults(this.options,{GroupsType:ListView.Groups,ListType:ListView.List,});this.previous_colspan=null;this.decoration=null;this.columns=[];this.records=new common.Collection();this.set_groups(new(this.options.GroupsType)(this));if(this.dataset instanceof data.DataSetStatic){this.groups.datagroup=new StaticDataGroup(this.dataset);}else{this.groups.datagroup=new DataGroup(this,this.model,this.dataset.get_domain(),this.dataset.get_context());this.groups.datagroup.sort=this.dataset._sort;}
this.records.bind('change',function(event,record,key){if(!_(self.aggregate_columns).chain().pluck('name').contains(key).value()){return;}
self.compute_aggregates();});this.no_leaf=false;this.grouped=false;if(!this.options.$pager||!this.options.$pager.length){this.options.$pager=false;}
this.options.deletable=this.options.deletable&&this.is_action_enabled('delete');this.name=""+this.fields_view.arch.attrs.string;this._limit=(this.options.limit||this.defaults.limit||(this.getParent().action||{}).limit||parseInt(this.fields_view.arch.attrs.limit,10)||80);this.current_min=1;var default_order=this.fields_view.arch.attrs.default_order;var unsorted=!this.dataset._sort.length;if(unsorted&&default_order&&!this.grouped){this.dataset.set_sort(default_order.split(','));}},willStart:function(){var self=this;this.decoration=_.pick(this.fields_view.arch.attrs,function(value,key){return row_decoration.indexOf(key)>=0;});this.decoration=_.mapObject(this.decoration,function(value){return py.parse(py.tokenize(value));});var fields_def=data_manager.load_fields(this.dataset).then(function(fields_get){self.fields_get=fields_get;});return $.when(this._super(),fields_def);},set_groups:function(groups){var self=this;if(this.groups){$(this.groups).unbind("selected deleted action row_link");delete this.groups;}
this.groups=groups;$(this.groups).bind({'selected':function(e,ids,records,deselected){self.do_select(ids,records,deselected);},'deleted':function(e,ids){self.do_delete(ids);},'action':function(e,action_name,id,callback){self.do_button_action(action_name,id,callback);},'row_link':function(e,id,dataset,view){self.do_activate_record(dataset.index,id,dataset,view);}});},compute_decoration_classnames:function(record){var classnames='';var context=_.extend({},record.attributes,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});_.each(this.decoration,function(expr,decoration){if(py.PY_isTrue(py.evaluate(expr,context))){classnames+=' '+decoration.replace('decoration','text');}});return classnames;},load_list:function(){var self=this;this.$el.html(QWeb.render(this._template,this));this.$el.addClass(this.fields_view.arch.attrs['class']);if(this.grouped){this.$('.o_list_view').addClass('o_list_view_grouped');}
this.$('.o_list_view').append(this.groups.elements);this.compute_aggregates();this.$('thead .o_list_record_selector input').click(function(){self.$('tbody .o_list_record_selector input').prop('checked',$(this).prop('checked')||false);var selection=self.groups.get_selection();$(self.groups).trigger('selected',[selection.ids,selection.records]);});if(this.dataset._sort.length){if(this.dataset._sort[0].indexOf('-')===-1){this.$('th[data-id='+this.dataset._sort[0]+']').addClass("o-sort-down");}else{this.$('th[data-id='+this.dataset._sort[0].split('-')[1]+']').addClass("o-sort-up");}}
this.trigger('list_view_loaded',data,this.grouped);return $.when();},render_buttons:function($node){if(!this.$buttons){this.$buttons=$(QWeb.render("ListView.buttons",{'widget':this}));this.$buttons.on('click','.o_list_button_add',this.proxy('do_add_record'));this.$buttons.appendTo($node);}},render_sidebar:function($node){if(!this.sidebar&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
this.sidebar.add_items('other',_.compact([{label:_t("Export"),callback:this.on_sidebar_export},this.fields_view.fields.active&&{label:_t("Archive"),callback:this.do_archive_selected},this.fields_view.fields.active&&{label:_t("Unarchive"),callback:this.do_unarchive_selected},this.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.do_delete_selected}]));$node=$node||this.options.$sidebar;this.sidebar.appendTo($node);this.sidebar.do_hide();}},render_pager:function($node,options){if(!this.pager&&this.options.pager){this.pager=new Pager(this,this.dataset.size(),1,this._limit,options);this.pager.appendTo($node||this.options.$pager);this.pager.on('pager_changed',this,function(new_state){var self=this;var limit_changed=(this._limit!==new_state.limit);this._limit=new_state.limit;this.current_min=new_state.current_min;this.reload_content().then(function(){if(!limit_changed){self.set_scrollTop(0);self.trigger_up('scrollTo',{offset:0});}});});}},update_pager:function(dataset,current_min){this.dataset.ids=dataset.ids;if(dataset._length!==undefined){this.dataset._length=dataset._length;}
if(this.pager&&!this.grouped){var new_state={size:this.dataset.size(),limit:this._limit};if(current_min){new_state.current_min=current_min;}
this.pager.update_state(new_state);}},sort_by_column:function(e){e.stopPropagation();var $column=$(e.currentTarget);var col_name=$column.data('id');var field=this.fields_view.fields[col_name];if(field&&!field.sortable){return false;}
this.dataset.sort(col_name);if($column.hasClass("o-sort-down")||$column.hasClass("o-sort-up")){$column.toggleClass("o-sort-up o-sort-down");}else{$column.addClass("o-sort-down");}
$column.siblings('.o_column_sortable').removeClass("o-sort-up o-sort-down");return this.reload_content();},setup_columns:function(fields,grouped){this.columns.splice(0,this.columns.length);this.columns.push.apply(this.columns,_(this.fields_view.arch.children).map(function(field){var id=field.attrs.name;return for_(id,fields[id],field);}));if(grouped){this.columns.unshift(new ListView.MetaColumn('_group'));}
this.visible_columns=_.filter(this.columns,function(column){return column.invisible!=='1';});this.aggregate_columns=_(this.visible_columns).invoke('to_aggregate');},select_record:function(index,view){view=view||index===null||index===undefined?'form':'form';this.dataset.index=index;_.delay(_.bind(function(){this.do_switch_view(view);},this));},do_show:function(){this._super();if(this.sidebar){this.sidebar.do_hide();}},reload_content:synchronized(function(){var self=this;this.setup_columns(this.fields_view.fields,this.grouped);this.$('tbody .o_list_record_selector input').prop('checked',false);this.records.reset();var reloaded=$.Deferred();this.groups.render(function(){if(self.dataset.index===null){if(self.records.length){self.dataset.index=0;}}else if(self.dataset.index>=self.records.length){self.dataset.index=self.records.length?0:null;}
self.load_list().then(function(){if(!self.grouped&&self.display_nocontent_helper()){self.no_result();}
reloaded.resolve();});});this.do_push_state({min:this.current_min,limit:this._limit});return reloaded.promise();}),reload:function(){return this.reload_content();},reload_record:function(record){var self=this;var fields=this.fields_view.fields;return this.dataset.read_ids([record.get('id')],_.pluck(_(this.columns).filter(function(r){return r.tag==='field';}),'name'),{check_access_rule:true}).then(function(records){var values=records[0];if(!values){self.records.remove(record);return;}
for(var key in values){if(fields[key]&&fields[key].type==='many2many')
record.set(key+'__display',false,{silent:true});record.set(key,values[key],{silent:true});}
record.trigger('change',record);var def=$.Deferred();setTimeout(function(){def.resolve(records);},100);return def;});},do_load_state:function(state,warm){var reload=false;if(state.min&&this.current_min!==state.min){this.current_min=state.min;reload=true;}
if(state.limit){if(_.isString(state.limit)){state.limit=null;}
if(state.limit!==this._limit){this._limit=state.limit;reload=true;}}
if(reload){this.reload_content();}},on_sidebar_export:function(){new DataExport(this,this.dataset).open();},do_search:function(domain,context,group_by){this.current_min=1;this.groups.datagroup=new DataGroup(this,this.model,domain,context,group_by);this.groups.datagroup.sort=this.dataset._sort;if(_.isEmpty(group_by)&&!context['group_by_no_leaf']){group_by=null;}
this.no_leaf=!!context['group_by_no_leaf'];this.grouped=!!group_by;if(this.pager&&this.grouped){this.pager.do_hide();}
return this.reload_content();},do_delete:function(ids){if(!(ids.length&&confirm(_t("Do you really want to remove these records?")))){return;}
var self=this;return $.when(this.dataset.unlink(ids)).done(function(){_(ids).each(function(id){self.records.remove(self.records.get(id));});if(self.display_nocontent_helper()){self.no_result();}else{if(self.records.length&&self.current_min===1){self.reload();}else if(self.records.length&&self.dataset.size()>0){self.pager.previous();}
if(self.current_min+self._limit-1<self.dataset.size()){self.reload();}}
self.update_pager(self.dataset);self.compute_aggregates();});},do_select:function(ids,records,deselected){if(deselected){this.$('thead .o_list_record_selector input').prop('checked',false);}
if(!ids.length){this.dataset.index=0;if(this.sidebar){this.sidebar.do_hide();}
this.compute_aggregates();return;}
this.dataset.index=_(this.dataset.ids).indexOf(ids[0]);if(this.sidebar){this.sidebar.do_show();}
this.compute_aggregates(_(records).map(function(record){return{count:1,values:record};}));},do_button_action:function(name,id,callback){this.handle_button(name,id,callback);},handle_button:function(name,id,callback){var action=_.detect(this.columns,function(field){return field.name===name;});if(!action){return;}
if('confirm'in action&&!window.confirm(action.confirm)){return;}
var c=new data.CompoundContext();c.set_eval_context(_.extend({active_id:id,active_ids:[id],active_model:this.model},this.records.get(id).toContext()));if(action.context){c.add(action.context);}
action.context=c;this.do_execute_action(action,this.dataset,id,_.bind(callback,null,id));},do_activate_record:function(index,id,dataset,view){this.dataset.ids=dataset.ids;this.select_record(index,view);},do_add_record:function(){this.select_record(null);},do_delete_selected:function(){var ids=this.groups.get_selection().ids;if(ids.length){this.do_delete(this.groups.get_selection().ids);}else{this.do_warn(_t("Warning"),_t("You must select at least one record."));}},do_archive_selected:function(){var records=this.groups.get_selection().records;this.do_archive(records,true);},do_unarchive_selected:function(){var records=this.groups.get_selection().records;this.do_archive(records,false);},do_archive:function(records,archive){var active_value=!archive;var record_ids=[];_.each(records,function(record){if(record.active!=active_value){record_ids.push(record.id);}});if(record_ids.length){this.dataset.call('write',[record_ids,{active:active_value}]).done(_.bind(this.reload,this));}},compute_aggregates:function(records){var columns=_(this.aggregate_columns).filter(function(column){return column['function'];});if(_.isEmpty(columns)){return;}
if(_.isEmpty(records)){records=this.groups.get_records();}
records=_(records).compact();var count=0,sums={};_(columns).each(function(column){switch(column['function']){case'max':sums[column.id]=-Infinity;break;case'min':sums[column.id]=Infinity;break;default:sums[column.id]=0;}});_(records).each(function(record){count+=record.count||1;_(columns).each(function(column){var field=column.id,value=record.values[field];switch(column['function']){case'sum':sums[field]+=value;break;case'avg':sums[field]+=record.count*value;break;case'min':if(sums[field]>value){sums[field]=value;}
break;case'max':if(sums[field]<value){sums[field]=value;}
break;}});});var aggregates={};_(columns).each(function(column){var field=column.id;switch(column['function']){case'avg':aggregates[field]={value:sums[field]/count};break;default:aggregates[field]={value:sums[field]};}});this.display_aggregates(aggregates);},display_aggregates:function(aggregation){var $footer_cells=this.$('tfoot td');_(this.aggregate_columns).each(function(column){if(!column['function']){return;}
$footer_cells.filter(_.str.sprintf('[data-field=%s]',column.id)).addClass('o_list_number').html(column.format(aggregation,{process_modifiers:false}));});},get_selected_ids:function(){var ids=this.groups.get_selection().ids;return ids;},get_active_domain:function(){var self=this;if(this.$('thead .o_list_record_selector input').prop('checked')){var search_view=this.getParent().searchview;var search_data=search_view.build_search_data();return pyeval.eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).then(function(results){var domain=self.dataset.domain.concat(results.domain||[]);return domain;});}
else{return $.Deferred().resolve();}},pad_columns:function(count,options){options=options||{};var $first_header=this.$('thead tr:first th');var colspan=$first_header.attr('colspan');if(colspan){if(!this.previous_colspan){this.previous_colspan=colspan;}
$first_header.attr('colspan',parseInt(colspan,10)+count);}
var $rows=this.$el.find('.oe_list_header_columns, tr:not(thead tr)').not(options['except']);var newcols=new Array(count+1).join('<td class="oe_list_padding"></td>');if(options.position==='before'){$rows.prepend(newcols);}else{$rows.append(newcols);}},unpad_columns:function(){this.$('.oe_list_padding').remove();if(this.previous_colspan){this.$el.find('thead tr:first th').attr('colspan',this.previous_colspan);this.previous_colspan=null;}},display_nocontent_helper:function(){return(this.dataset.size()===0);},no_result:function(){this.$('.oe_view_nocontent').remove();if(this.groups.group_by||!this.options.action||!this.options.action.help){return;}
this.$('table:first').hide();this.$el.prepend($('<div class="oe_view_nocontent">').html(this.options.action.help));}});core.view_registry.add('list',ListView);ListView.List=Class.extend({init:function(group,opts){var self=this;this.group=group;this.view=group.view;this.session=this.view.session;this.options=opts.options;this.columns=opts.columns;this.dataset=opts.dataset;this.records=opts.records;this.record_callbacks={'remove':function(event,record){var id=record.get('id');self.dataset.remove_ids([id]);var $row=self.$current.children('[data-id='+id+']');var index=$row.data('index');$row.remove();},'reset':function(){return self.on_records_reset();},'change':function(event,record,attribute,value,old_value){var $row;if(attribute==='id'){if(old_value){throw new Error(_.str.sprintf(_t("Setting 'id' attribute on existing record %s"),JSON.stringify(record.attributes)));}
self.dataset.add_ids([value],self.records.indexOf(record));$row=self.$current.children('[data-id=false]');}else{$row=self.$current.children('[data-id='+record.get('id')+']');}
if($row.length){var $newRow=$(self.render_record(record));$newRow.find('.o_list_record_selector input').prop('checked',!!$row.find('.o_list_record_selector input').prop('checked'));$row.replaceWith($newRow);}},'add':function(ev,records,record,index){var $new_row=$(self.render_record(record));var id=record.get('id');if(id){self.dataset.add_ids([id],index);}
if(index===0){$new_row.prependTo(self.$current);}else{var previous_record=records.at(index-1),$previous_sibling=self.$current.children('[data-id='+previous_record.get('id')+']');$new_row.insertAfter($previous_sibling);}}};_(this.record_callbacks).each(function(callback,event){this.records.bind(event,callback);},this);this.$current=$('<tbody>').delegate('input[readonly=readonly]','click',function(e){e.preventDefault();}).delegate('td.o_list_record_selector','click',function(e){e.stopPropagation();var selection=self.get_selection();var checked=$(e.currentTarget).find('input').prop('checked');$(self).trigger('selected',[selection.ids,selection.records,!checked]);}).delegate('td.o_list_record_delete','click',function(e){e.stopPropagation();var $row=$(e.target).closest('tr');$(self).trigger('deleted',[[self.row_id($row)]]);if(document.hasFocus&&!document.hasFocus()){$('<input />').appendTo('body').focus().remove();}}).delegate('td button','click',function(e){e.stopPropagation();var $target=$(e.currentTarget),field=$target.closest('td').data('field'),$row=$target.closest('tr'),record_id=self.row_id($row);if($target.attr('disabled')){return;}
$target.attr('disabled','disabled');$(self).trigger('action',[field.toString(),record_id,function(id){$target.removeAttr('disabled');return self.reload_record(self.records.get(id));}]);}).delegate('a','click',function(e){e.stopPropagation();}).delegate('tr','click',function(e){var row_id=self.row_id(e.currentTarget);if(row_id){e.stopPropagation();if(!self.dataset.select_id(row_id)){throw new Error(_t("Could not find id in dataset"));}
self.row_clicked(e);}});},row_clicked:function(e,view){$(this).trigger('row_link',[this.dataset.ids[this.dataset.index],this.dataset,view]);},render_cell:function(record,column){var value;if(column.type==='reference'){value=record.get(column.id);var ref_match;if(value&&(ref_match=/^([\w\.]+),(\d+)$/.exec(value))){var model=ref_match[1],id=parseInt(ref_match[2],10);new data.DataSet(this.view,model).name_get([id]).done(function(names){if(!names.length){return;}
record.set(column.id+'__display',names[0][1]);});}}else if(column.type==='many2one'){value=record.get(column.id);if(typeof value==='number'||value instanceof Number){new data.DataSet(this.view,column.relation).name_get([value]).done(function(names){if(!names.length){return;}
record.set(column.id,names[0]);});}}else if(column.type==='many2many'){value=record.get(column.id);if(value instanceof Array&&!_.isEmpty(value)&&!record.get(column.id+'__display')){var ids;if(value[0]instanceof Array){_.each(value,function(command){switch(command[0]){case 4:ids.push(command[1]);break;case 5:ids=[];break;case 6:ids=command[2];break;default:throw new Error(_.str.sprintf(_t("Unknown m2m command %s"),command[0]));}});}else{ids=value;}
new Model(column.relation).call('name_get',[ids,this.dataset.get_context()]).done(function(names){record.set(column.id+'__display',_(names).pluck(1).join(', '));record.set(column.id,ids);});record.set(column.id+'__display',false);}}
return column.format(record.toForm().data,{model:this.dataset.model,id:record.get('id')});},render:function(){var self=this;this.$current.html(QWeb.render('ListView.rows',_.extend({},this,{render_cell:function(){return self.render_cell.apply(self,arguments);}})));this.pad_table_to(4);},pad_table_to:function(count){if(this.records.length>=count||_(this.columns).any(function(column){return column.meta;})){return;}
var cells=[];if(this.options.selectable){cells.push('<td class="o_list_record_selector"></td>');}
_(this.columns).each(function(column){if(column.invisible==='1'){return;}
cells.push('<td title="'+column.string+'">&nbsp;</td>');});if(this.options.deletable){cells.push('<td class="o_list_record_delete"></td>');}
cells.unshift('<tr>');cells.push('</tr>');var row=cells.join('');this.$current.children('tr:not([data-id])').remove().end().append(new Array(count-this.records.length+1).join(row));},get_selection:function(){var result={ids:[],records:[]};if(!this.options.selectable){return result;}
var records=this.records;this.$current.find('td.o_list_record_selector input:checked').closest('tr').each(function(){var record=records.get($(this).data('id'));result.ids.push(record.get('id'));result.records.push(record.attributes);});return result;},row_id:function(row){return $(row).data('id');},on_records_reset:function(){_(this.record_callbacks).each(function(callback,event){this.records.unbind(event,callback);},this);},get_records:function(){return this.records.map(function(record){return{count:1,values:record.attributes};});},reload_record:function(record){return this.view.reload_record(record);},render_record:function(record){var self=this;var index=this.records.indexOf(record);return QWeb.render('ListView.row',{columns:this.columns,options:this.options,record:record,row_parity:(index%2===0)?'even':'odd',view:this.view,render_cell:function(){return self.render_cell.apply(self,arguments);}});}});ListView.Groups=Class.extend({passthrough_events:'action deleted row_link',init:function(view,options){options=options||{};this.view=view;this.records=options.records||view.records;this.options=options.options||view.options;this.columns=options.columns||view.columns;this.datagroup=null;this.$row=null;this.children={};this.pager=null;var self=this;this.records.bind('reset',function(){return self.on_records_reset();});},make_fragment:function(){return document.createDocumentFragment();},point_insertion:function(row){var $row=$(row);var red_letter_tboday=$row.closest('tbody')[0];var $next_siblings=$row.nextAll();if($next_siblings.length){var $root_kanal=$('<tbody>').insertAfter(red_letter_tboday);$root_kanal.append($next_siblings);this.elements.splice(_.indexOf(this.elements,red_letter_tboday),0,$root_kanal[0]);}
return red_letter_tboday;},render_group_pager:function(){var self=this;if(this.datagroup.length>this.view._limit){this.pager=new Pager(this,this.datagroup.length,1,this.view._limit);this.pager.on('pager_changed',this,function(state){self.view._limit=state.limit;self.current_min=state.current_min;self.render().then(function(){self.$row.closest('tbody').next().replaceWith($(self.elements));});});var $last_cell=this.$row.children().last();$last_cell.addClass('o_group_pager');$last_cell.click(function(e){e.stopPropagation();});this.pager.appendTo($last_cell);}},open:function(point_insertion){this.render();$(this.elements).insertAfter(point_insertion);var no_subgroups=_(this.datagroup.group_by).isEmpty(),records_terminated=!this.datagroup.context['group_by_no_leaf'];if(no_subgroups&&records_terminated){this.render_group_pager();}},close:function(){if(this.pager){this.pager.destroy();}
this.records.reset();this.$to_be_removed.remove();},indent:function($node,level){return $('<span>').css({'float':'left','white-space':'pre'}).text(new Array(level).join('   ')).prependTo($node);},render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();_(datagroups).each(function(group){if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="o_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.fa').removeClass('fa-caret-right').addClass('fa-caret-down');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.fa').removeClass('fa-caret-down').addClass('fa-caret-right');child.close();var selection=self.get_selection();$(self).trigger('selected',[selection.ids,this.records]);}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="o_group_name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_label=_t("Undefined");var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(group_column){try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}}else{group_label=group.value;var grouped_on_field=self.view.fields_get[group.grouped_on];if(grouped_on_field&&grouped_on_field.type==='selection'){group_label=_.find(grouped_on_field.selection,function(selection){return selection[0]===group.value;});}
if(group_label instanceof Array){group_label=group_label[1];}
if(group_label===false){group_label=_t('Undefined');}
group_label=_.str.escapeHTML(group_label);}
$group_column.html(_.str.sprintf("%s (%d)",group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="fa fa-caret-right" style="padding-right: 5px;">');}else{$group_column.prepend('<span class="fa">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe_list_group_pagination">');}});return placeholder;},bind_child_events:function(child){var $this=$(this),self=this;$(child).bind('selected',function(e,_0,_1,deselected){var selection=self.get_selection();$this.trigger(e,[selection.ids,selection.records,deselected]);}).bind(this.passthrough_events,function(e){var args=Array.prototype.slice.call(arguments,1);$this.trigger.call($this,e,args);});},render_dataset:function(dataset){var self=this,list=new(this.view.options.ListType)(this,{options:this.options,columns:this.columns,dataset:dataset,records:this.records});this.bind_child_events(list);var view=this.view;var current_min=this.datagroup.openable?this.current_min:view.current_min;var fields=_.pluck(_.select(this.columns,function(x){return x.tag=="field";}),'name');var options={offset:current_min-1,limit:view._limit,context:{bin_size:true}};return utils.async_when().then(function(){return dataset.read_slice(fields,options).then(function(records){if(self.records.length){self.records.reset(null,{silent:true});}
if(!self.datagroup.openable){view.update_pager(dataset,current_min);}
self.records.add(records,{silent:true});list.render();return list;});});},setup_resequence_rows:function(list,dataset){var sequence_field=_(this.columns).findWhere({'widget':'handle'});var seqname=sequence_field?sequence_field.name:'sequence';if((dataset.sort&&[seqname,seqname+' ASC',''].indexOf(dataset.sort())===-1)||!_(this.columns).findWhere({'name':seqname})){return;}
list.$current.sortable({axis:'y',items:'> tr[data-id]',helper:'clone'});if(sequence_field){list.$current.sortable('option','handle','.o_row_handle');}
list.$current.sortable('option',{start:function(e,ui){ui.placeholder.height(ui.item.height());},stop:function(event,ui){var to_move=list.records.get(ui.item.data('id')),target_id=ui.item.prev().data('id'),from_index=list.records.indexOf(to_move),target=list.records.get(target_id);if(list.records.at(from_index-1)==target){return;}
list.records.remove(to_move,{silent:true});var to=target_id?list.records.indexOf(target)+1:0;list.records.add(to_move,{at:to,silent:true});var record,index=to,seq=to?list.records.at(to-1).get(seqname):0;var defs=[];var fct=function(dataset,id,seq){defs.push(utils.async_when().then(function(){var attrs={};attrs[seqname]=seq;return dataset.write(id,attrs,{internal_dataset_changed:true});}));};while(++seq,(record=list.records.at(index++))){fct(dataset,record.get('id'),seq);record.set(seqname,seq);}
$.when.apply($,defs).then(function(){dataset.trigger("dataset_changed");});}});},render:function(post_render){var self=this;var $el=$('<tbody>');this.elements=[$el[0]];return this.datagroup.list(_(this.view.visible_columns).chain().filter(function(column){return column.tag==='field';}).pluck('name').value(),function(groups){$el[0].appendChild(self.render_groups(groups));if(post_render){post_render();}},function(dataset){return self.render_dataset(dataset).then(function(list){self.children[null]=list;self.elements=[list.$current.replaceAll($el)[0]];self.setup_resequence_rows(list,dataset);}).always(function(){if(post_render){post_render();}
self.view.trigger('view_list_rendered');});});},get_selection:function(){var ids=[],records=[];_(this.children).each(function(child){var selection=child.get_selection();ids.push.apply(ids,selection.ids);records.push.apply(records,selection.records);});return{ids:ids,records:records};},on_records_reset:function(){this.$to_be_removed=$(this.elements);_.each(this.children,function(child){this.$to_be_removed=this.$to_be_removed.add(child.$to_be_removed);}.bind(this));this.children={};},get_records:function(){if(_(this.children).isEmpty()){if(!this.datagroup.length){return;}
return{count:this.datagroup.length,values:this.datagroup.aggregates};}
return _(this.children).chain().map(function(child){return child.get_records();}).flatten().value();}});function synchronized(fn){var fn_mutex=new utils.Mutex();return function(){var obj=this;var args=_.toArray(arguments);return fn_mutex.exec(function(){if(obj.isDestroyed()){return $.when();}
return fn.apply(obj,args);});};}
var DataGroup=Class.extend({init:function(parent,model,domain,context,group_by,level){this.model=new Model(model,context,domain);this.group_by=group_by;this.context=context;this.domain=domain;this.level=level||0;},list:function(fields,ifGroups,ifRecords){var self=this;if(!_.isEmpty(this.group_by)){fields=_.unique((fields||[]).concat(this.group_by));}
var query=this.model.query(fields).order_by(this.sort).group_by(this.group_by);return $.when(query).then(function(querygroups){if(!querygroups){var ds=new data.DataSetSearch(self,self.model.name,self.model.context(),self.model.domain());ds._sort=self.sort;return ifRecords(ds);}
var child_datagroups=_(querygroups).map(function(group){var child_context=_.extend({},self.model.context(),group.model.context());var child_dg=new DataGroup(self,self.model.name,group.model.domain(),child_context,group.model._context.group_by,self.level+1);child_dg.sort=self.sort;child_dg.__context=child_context;child_dg.__domain=group.model.domain();child_dg.folded=group.get('folded');child_dg.grouped_on=group.get('grouped_on');child_dg.length=group.get('length');child_dg.value=group.get('value');child_dg.openable=group.get('has_children');child_dg.aggregates=group.get('aggregates');return child_dg;});ifGroups(child_datagroups);});}});var StaticDataGroup=DataGroup.extend({init:function(dataset){this.dataset=dataset;},list:function(fields,ifGroups,ifRecords){return ifRecords(this.dataset);}});var Column=Class.extend({init:function(id,tag,attrs){_.extend(attrs,{id:id,tag:tag});this.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};delete attrs.modifiers;_.extend(this,attrs);if(this.modifiers['tree_invisible']){this.invisible='1';}else{delete this.invisible;}},modifiers_for:function(fields){var out={};var domain_computer=data.compute_domain;for(var attr in this.modifiers){if(!this.modifiers.hasOwnProperty(attr)){continue;}
var modifier=this.modifiers[attr];out[attr]=_.isBoolean(modifier)?modifier:domain_computer(modifier,fields);}
return out;},to_aggregate:function(){if(this.type!=='integer'&&this.type!=='float'&&this.type!=='monetary'){return{};}
var aggregation_func=(this.sum&&'sum')||(this.avg&&'avg')||(this.max&&'max')||(this.min&&'min');if(!aggregation_func){return{};}
var C=function(fn,label){this['function']=fn;this.label=label;};C.prototype=this;return new C(aggregation_func,this[aggregation_func]);},heading:function(){return _.escape(this.string);},width:function(){},format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
if(!row_data[this.id]){return options.value_if_empty===undefined?'':options.value_if_empty;}
var f=this._format(row_data,options);return(f!=='')?f:'&nbsp;';},_format:function(row_data,options){return _.escape(formats.format_value(row_data[this.id].value,this,options.value_if_empty));}});ListView.Column=Column;var MetaColumn=Column.extend({meta:true,init:function(id,string){this._super(id,'',{string:string});}});ListView.MetaColumn=MetaColumn;var ColumnButton=Column.extend({format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
var template=this.icon&&'ListView.row.button'||'ListView.row.text_button';return QWeb.render(template,{widget:this,prefix:session.prefix,disabled:attrs.readonly||isNaN(row_data.id.value)||data.BufferedDataSet.virtual_id_regex.test(row_data.id.value)});}});var ColumnBoolean=Column.extend({_format:function(row_data,options){return _.str.sprintf('<div class="o_checkbox"><input type="checkbox" %s disabled="disabled"/><span/></div>',row_data[this.id].value?'checked="checked"':'');}});var ColumnBinary=Column.extend({_format:function(row_data,options){var text=_t("Download"),filename=_t('Binary file');var value=row_data[this.id].value;if(!value){return options.value_if_empty||'';}
var download_url;if(value.substr(0,10).indexOf(' ')==-1){download_url="data:application/octet-stream;base64,"+value;}else{download_url=session.url('/web/content',{model:options.model,field:this.id,id:options.id,download:true});if(this.filename){download_url+='&filename_field='+this.filename;}}
if(this.filename&&row_data[this.filename]){text=_.str.sprintf(_t("Download \"%s\""),formats.format_value(row_data[this.filename].value,{type:'char'}));filename=row_data[this.filename].value;}
return _.template('<a download="<%-download%>" href="<%-href%>"><%-text%></a> (<%-size%>)')({text:text,href:download_url,size:utils.binary_to_binsize(value),download:filename,});}});var ColumnChar=Column.extend({replacement:'*',_format:function(row_data,options){var value=row_data[this.id].value;if(value&&this.password==='True'){return value.replace(/[\s\S]/g,_.escape(this.replacement));}
return this._super(row_data,options);}});var ColumnProgressBar=Column.extend({_format:function(row_data,options){return _.template('<progress value="<%-value%>" max="100"><%-value%>%</progress>')({value:_.str.sprintf("%.0f",row_data[this.id].value||0)});}});var ColumnHandle=Column.extend({init:function(){this._super.apply(this,arguments);this.modifiers.readonly=true;this.string="";},heading:function(){return'<span class="o_row_handle fa fa-arrows invisible"></span>';},width:function(){return 1;},_format:function(row_data,options){return'<span class="o_row_handle fa fa-arrows"/>';}});var ColumnMany2OneButton=Column.extend({_format:function(row_data,options){this.has_value=!!row_data[this.id].value;this.icon=this.has_value?'fa-circle o_toggle_button_success':'fa-circle text-danger';this.string=this.has_value?_t('View'):_t('Create');return QWeb.render('Many2OneButton.cell',{'widget':this,'prefix':session.prefix,});},});var ColumnMany2Many=Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){row_data[this.id]=row_data[this.id+'__display'];}
return this._super(row_data,options);}});var ColumnReference=Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){if(!!row_data[this.id+'__display']){row_data[this.id]=row_data[this.id+'__display'];}else{row_data[this.id]={'value':''};}}
return this._super(row_data,options);}});var ColumnUrl=Column.extend({PROTOCOL_REGEX:/^(?!\w+:?\/\/)/,_format:function(row_data,options){var value=row_data[this.id].value;if(value){return _.template("<a href='<%-href%>' target='_blank'><%-text%></a>")({href:value.trim().replace(this.PROTOCOL_REGEX,'//'),text:value});}
return this._super(row_data,options);}});var ColumnMonetary=Column.extend({_format:function(row_data,options){var options=pyeval.py_eval(this.options||'{}');var currency_field=(_.isEmpty(options)===false&&options.currency_field)||this.currency_field||'currency_id';var currency_id=row_data[currency_field]&&row_data[currency_field].value[0];var currency=session.get_currency(currency_id);var digits_precision=this.digits||(currency&&currency.digits);var value=formats.format_value(row_data[this.id].value||0,{type:this.type,digits:digits_precision},options.value_if_empty);if(currency){if(currency.position==="after"){value+='&nbsp;'+currency.symbol;}else{value=currency.symbol+'&nbsp;'+value;}}
return value;},});var ColumnToggleButton=Column.extend({format:function(row_data,options){this._super(row_data,options);var button_tips=JSON.parse(this.options);var fieldname=this.field_name;var has_value=row_data[fieldname]&&!!row_data[fieldname].value;this.icon=has_value?'fa-circle o_toggle_button_success':'fa-circle text-muted';this.string=has_value?(button_tips?button_tips['active']:''):(button_tips?button_tips['inactive']:'');return QWeb.render('toggle_button',{widget:this,prefix:session.prefix,});},});list_widget_registry.add('field',Column).add('field.boolean',ColumnBoolean).add('field.binary',ColumnBinary).add('field.char',ColumnChar).add('field.progressbar',ColumnProgressBar).add('field.handle',ColumnHandle).add('button',ColumnButton).add('field.many2onebutton',ColumnMany2OneButton).add('field.reference',ColumnReference).add('field.many2many',ColumnMany2Many).add('field.url',ColumnUrl).add('button.toggle_button',ColumnToggleButton).add('field.monetary',ColumnMonetary);function for_(id,field,node){var description=_.extend({tag:node.tag},field,node.attrs);var tag=description.tag;var Type=list_widget_registry.get_any([tag+'.'+description.widget,tag+'.'+description.type,tag]);return new Type(id,node.tag,description);}
return ListView;});;

/* /web/static/src/js/views/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var FormRenderingEngine=require('web.FormRenderingEngine');var Model=require('web.DataModel');var Pager=require('web.Pager');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var FormView=View.extend(common.FieldManagerMixin,{className:"o_form_view",defaults:_.extend({},View.prototype.defaults,{not_interactible_on_create:false,initial_mode:"view",disable_autofocus:false,footer_to_buttons:false,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,searchable:false,on_attach_callback:function(){this.trigger('attached');this.autofocus();},on_detach_callback:function(){this.trigger('detached');},init:function(){var self=this;this._super.apply(this,arguments);this.fields={};this.fields_order=[];this.datarecord={};this.onchanges_mutex=new utils.Mutex();this.default_focus_field=null;this.default_focus_button=null;this.fields_registry=core.form_widget_registry;this.tags_registry=core.form_tag_registry;this.widgets_registry=core.form_custom_registry;this.has_been_loaded=$.Deferred();this.translatable_fields=[];this.is_initialized=$.Deferred();this.record_loaded=$.Deferred();this.mutating_mutex=new utils.Mutex();this.save_list=[];this.render_value_defs=[];this.reload_mutex=new utils.Mutex();this.__clicked_inside=false;this.__blur_timeout=null;this.rendering_engine=new FormRenderingEngine(this);this.set({actual_mode:this.options.initial_mode});this.has_been_loaded.done(function(){self.on("change:actual_mode",self,self.toggle_buttons);self.on("change:actual_mode",self,self.toggle_sidebar);});self.on("load_record",self,self.load_record);core.bus.on('clear_uncommitted_changes',this,function(chain_callbacks){var self=this;chain_callbacks(function(){return self.can_be_discarded();});});},start:function(){if(this.$pager){this.$pager.off();}
var self=this;this.rendering_engine.set_fields_registry(this.fields_registry);this.rendering_engine.set_tags_registry(this.tags_registry);this.rendering_engine.set_widgets_registry(this.widgets_registry);this.rendering_engine.set_fields_view(this.fields_view);this.rendering_engine.render_to(this.$el);this.$el.on('mousedown.formBlur',function(){self.__clicked_inside=true;});this.has_been_loaded.resolve();this.$(".oe_title,.o_group").on('click',function(e){if(self.get("actual_mode")==="view"&&self.$buttons&&!$(e.target).is('[data-toggle]')){self.$buttons.find(".o_form_button_edit").openerpBounce();core.bus.trigger('click',e);}});return this._super();},destroy:function(){_.each(this.get_widgets(),function(w){w.off('focused blurred');w.destroy();});if(this.$el){this.$el.off('.formBlur');}
this._super();},render_buttons:function($node){this.$buttons=$('<div/>');var $footer=this.$('footer');if(this.options.action_buttons!==false||this.options.footer_to_buttons&&$footer.children().length===0){this.$buttons.append(QWeb.render("FormView.buttons",{'widget':this}));}
if(this.options.footer_to_buttons){$footer.appendTo(this.$buttons);}
this.toggle_buttons();this.$buttons.on('click','.o_form_button_create',this.on_button_create);this.$buttons.on('click','.o_form_button_edit',this.on_button_edit);this.$buttons.on('click','.o_form_button_save',this.on_button_save);this.$buttons.on('click','.o_form_button_cancel',this.on_button_cancel);this.$buttons.appendTo($node);},render_sidebar:function($node){if(!this.sidebar&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
var canDuplicate=this.is_action_enabled('create')&&this.is_action_enabled('duplicate');this.sidebar.add_items('other',_.compact([this.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.on_button_delete},canDuplicate&&{label:_t('Duplicate'),callback:this.on_button_duplicate}]));this.sidebar.appendTo($node);this.toggle_sidebar();}},render_pager:function($node){if(this.options.pager){var self=this;var options={validate:_.bind(this.can_be_discarded,this),};this.pager=new Pager(this,this.dataset.ids.length,this.dataset.index+1,1,options);this.pager.on('pager_changed',this,function(new_state){this.pager.disable();this.dataset.index=new_state.current_min-1;this.trigger('pager_action_executed');$.when(this.reload()).then(function(){self.pager.enable();});});this.pager.appendTo($node=$node||this.options.$pager);if(this.get("actual_mode")==="create"){this.pager.do_hide();}}},toggle_buttons:function(){var view_mode=this.get("actual_mode")==="view";if(this.$buttons){this.$buttons.find('.o_form_buttons_view').toggle(view_mode);this.$buttons.find('.o_form_buttons_edit').toggle(!view_mode);}},toggle_sidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.get("actual_mode")==="view");}},update_pager:function(){if(this.pager){if(this.get("actual_mode")==="create"){this.pager.do_hide();}else{this.pager.update_state({size:this.dataset.ids.length,current_min:this.dataset.index+1});}}},widgetFocused:function(){this.__clicked_inside=false;if(this.__blur_timeout){clearTimeout(this.__blur_timeout);this.__blur_timeout=null;}},widgetBlurred:function(){if(this.__clicked_inside){this.__clicked_inside=false;return;}
var self=this;this.widgetFocused();this.__blur_timeout=setTimeout(function(){self.trigger('blurred');},0);},do_load_state:function(state,warm){if(state.id&&this.datarecord.id!=state.id){if(this.dataset.get_id_index(state.id)===null){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);this.do_show();}},do_show:function(options){var self=this;options=options||{};this.$el.removeClass('oe_form_dirty');var shown=this.has_been_loaded;if(options.reload!==false){shown=shown.then(function(){if(self.dataset.index===null){return self.on_button_new();}
var fields=_.keys(self.fields_view.fields);fields.push('display_name');fields.push('__last_update');return self.dataset.read_index(fields,{context:{'bin_size':true}}).then(function(r){self.trigger('load_record',r);});});}
return $.when(shown,this._super()).then(function(){self._actualize_mode(options.mode||self.options.initial_mode);core.bus.trigger('form_view_shown',self);});},load_record:function(record){var self=this,set_values=[];if(!record){this.set({'title':undefined});this.do_warn(_t("Form"),_t("The record could not be found in the database."),true);return $.Deferred().reject();}
this.datarecord=record;this.record_loaded=$.Deferred();_(this.fields).each(function(field,f){field._dirty_flag=false;field._inhibit_on_change_flag=true;var result=field.set_value_from_record(self.datarecord);field._inhibit_on_change_flag=false;set_values.push(result);});this._actualize_mode();this.set({'title':record.id?record.display_name:_t("New")});this.update_pager();return $.when.apply(null,set_values).then(function(){if(!record.id){var fields_loaded=_.pluck(self.fields,'is_loaded');$.when.apply(null,fields_loaded).done(function(){self.do_onchange(null);});}
self.on_form_changed();self.rendering_engine.init_fields().then(function(){self.is_initialized.resolve();self.record_loaded.resolve();if(self.sidebar){self.sidebar.do_attachement_update(self.dataset,self.datarecord.id);}
if(record.id){self.do_push_state({id:record.id});}else{self.do_push_state({});}
self.$el.removeClass('oe_form_dirty');});});},load_defaults:function(){var self=this;var keys=_.keys(this.fields_view.fields);if(keys.length){return this.dataset.default_get(keys).then(function(r){self.trigger('load_record',_.clone(r));});}
return $.when().then(this.trigger.bind(this,'load_record',{}));},on_form_changed:function(){this.trigger("view_content_has_changed");},do_notify_change:function(){this.$el.addClass('oe_form_dirty');},_build_onchange_specs:function(){var self=this;var find=function(field_name,root){var fields=[root];while(fields.length){var node=fields.pop();if(!node){continue;}
if(node.tag==='field'&&node.attrs.name===field_name){return node.attrs.on_change||"";}
fields=_.union(fields,node.children);}
return"";};self._onchange_fields=[];self._onchange_specs={};_.each(this.fields,function(field,name){self._onchange_fields.push(name);self._onchange_specs[name]=find(name,field.node);var views=_.clone(field.field.views);if(field.viewmanager){_.each(field.viewmanager.views,function(view,view_type){if(views[view_type]===undefined&&view.controller){views[view_type]=view.controller.fields_view;}});}
_.each(views,function(view){_.each(view.fields,function(_,subname){self._onchange_specs[name+'.'+subname]=find(subname,view.arch);});});});},_get_onchange_values:function(){var field_values=this.get_fields_values();if(field_values.id.toString().match(data.BufferedDataSet.virtual_id_regex)){delete field_values.id;}
if(this.dataset.parent_view){var parent_view=this.dataset.parent_view;var child_name=this.dataset.child_name;var parent_name=parent_view.get_field_desc(child_name).relation_field;if(parent_name){var parent_values=parent_view.get_fields_values();delete parent_values[child_name];field_values[parent_name]=parent_values;}}
return field_values;},do_onchange:function(widget){var self=this;if(self._onchange_specs===undefined){self._build_onchange_specs();}
var onchange_specs=self._onchange_specs;try{var def=$.when({});var change_spec=widget?onchange_specs[widget.name]:null;if(!widget||(!_.isEmpty(change_spec)&&change_spec!=="0")){var ids=[],trigger_field_name=widget?widget.name:self._onchange_fields,values=self._get_onchange_values(),context=new data.CompoundContext(self.dataset.get_context());if(widget&&widget.build_context()){context.add(widget.build_context());}
if(self.dataset.parent_view){var parent_name=self.dataset.parent_view.get_field_desc(self.dataset.child_name).relation_field;context.add({field_parent:parent_name});}
if(self.datarecord.id&&!data.BufferedDataSet.virtual_id_regex.test(self.datarecord.id)){ids.push(self.datarecord.id);}
def=self.alive(self.dataset.call("onchange",[ids,values,trigger_field_name,onchange_specs,context]));}
this.onchanges_mutex.exec(function(){return def.then(function(response){var fields={};if(widget){fields[widget.name]=widget.field;}
else{fields=self.fields_view.fields;}
var defs=[];_.each(fields,function(field,fieldname){if(field&&field.change_default){var value_;if(response.value&&(fieldname in response.value)){value_=response.value[fieldname];}else{value_=self.fields[fieldname].get_value();}
var condition=fieldname+'='+value_;if(value_){defs.push(self.alive(new Model('ir.values').call('get_defaults',[self.model,condition])).then(function(results){if(!results.length){return response;}
if(!response.value){response.value={};}
for(var i=0;i<results.length;++i){var triplet=results[i];response.value[triplet[1]]=triplet[2];}
return response;}));}}});return _.isEmpty(defs)?response:$.when.apply(null,defs);}).then(function(response){return self.on_processed_onchange(response);});});return this.onchanges_mutex.def;}catch(e){console.error(e);crash_manager.show_message(e);return $.Deferred().reject();}},on_processed_onchange:function(result){try{var fields=this.fields;_(result.domain).each(function(domain,fieldname){var field=fields[fieldname];if(!field){return;}
field.node.attrs.domain=domain;});var def=$.when(!_.isEmpty(result.value)&&this._internal_set_values(result.value));if(!_.isEmpty(result.warning)){this.warning_displayed=true;var dialog=new Dialog(this,{size:'medium',title:result.warning.title,$content:QWeb.render("CrashManager.warning",result.warning)});dialog.open();dialog.on('closed',this,function(){this.warning_displayed=false;});}
return def;}catch(e){console.error(e);crash_manager.show_message(e);return $.Deferred().reject();}},_process_operations:function(){var self=this;return this.mutating_mutex.exec(function(){function onchanges_mutex(){return self.onchanges_mutex.def;}
function iterate(){var mutex=new utils.Mutex();mutex.exec(onchanges_mutex);_.each(self.fields,function(field){mutex.exec(function(){return field.commit_value();});mutex.exec(onchanges_mutex);});return mutex.def.then(function(){var save_obj=self.save_list.pop();if(save_obj){return self._process_save(save_obj).then(function(){save_obj.ret=_.toArray(arguments);return iterate();},function(){save_obj.error=true;});}
return $.when();}).fail(function(){self.save_list.pop();return $.when();});}
return iterate();});},_internal_set_values:function(values){for(var f in values){if(!values.hasOwnProperty(f)){continue;}
var field=this.fields[f];if(field){var value_=values[f];if(field.get_value()!==value_){field._inhibit_on_change_flag=true;field.set_value(value_);field._inhibit_on_change_flag=false;field._dirty_flag=true;}}}
this.on_form_changed();},set_values:function(values){var self=this;return this.mutating_mutex.exec(function(){self._internal_set_values(values);});},to_view_mode:function(){this._actualize_mode("view");this.trigger('to_view_mode');},to_edit_mode:function(){this.onchanges_mutex=new utils.Mutex();this._actualize_mode("edit");this.trigger('to_edit_mode');},_actualize_mode:function(switch_to){var mode=switch_to||this.get("actual_mode");if(!this.datarecord.id){mode="create";}else if(mode==="create"){mode="edit";}
var viewMode=(mode==="view");this.$el.toggleClass('o_form_readonly',viewMode).toggleClass('o_form_editable',!viewMode);this.render_value_defs=[];this.set({actual_mode:mode});if(!viewMode){this.autofocus();}},autofocus:function(){if(this.get("actual_mode")!=="view"&&!this.options.disable_autofocus){var fields_order=this.fields_order.slice(0);if(this.default_focus_field){fields_order.unshift(this.default_focus_field.name);}
for(var i=0;i<fields_order.length;i+=1){var field=this.fields[fields_order[i]];if(!field.get('effective_invisible')&&!field.get('effective_readonly')&&field.$label){if(field.focus()!==false){break;}}}}},disable_button:function(){this.$('.oe_form_buttons,.o_statusbar_buttons').add(this.$buttons).find('button').addClass('o_disabled').prop('disabled',true);this.is_disabled=true;},enable_button:function(){this.$('.oe_form_buttons,.o_statusbar_buttons').add(this.$buttons).find('button.o_disabled').removeClass('o_disabled').prop('disabled',false);this.is_disabled=false;},on_button_save:function(){var self=this;if(this.is_disabled){return;}
this.disable_button();return this.save().then(function(result){self.trigger("save",result);return self.reload().then(function(){self.to_view_mode();core.bus.trigger('do_reload_needaction');core.bus.trigger('form_view_saved',self);}).always(function(){self.enable_button();});}).fail(function(){self.enable_button();});},on_button_cancel:function(){var self=this;this.can_be_discarded().then(function(){if(self.get('actual_mode')==='create'){self.trigger('history_back');}else{self.to_view_mode();$.when.apply(null,self.render_value_defs).then(function(){self.trigger('load_record',self.datarecord);});}});this.trigger('on_button_cancel');return false;},on_button_new:function(){return $.when(this.has_been_loaded).then(this.can_be_discarded.bind(this)).then(this.load_defaults.bind(this));},on_button_edit:function(){return this.to_edit_mode();},on_button_create:function(){this.dataset.index=null;this.do_show();},on_button_duplicate:function(){var self=this;return this.has_been_loaded.then(function(){return self.dataset.call('copy',[self.datarecord.id,{},self.dataset.context]).then(function(new_id){self.record_created(new_id);self.to_edit_mode();});});},on_button_delete:function(){var self=this;var def=$.Deferred();this.has_been_loaded.done(function(){if(self.datarecord.id&&confirm(_t("Do you really want to delete this record?"))){self.dataset.unlink([self.datarecord.id]).done(function(){if(self.dataset.size()){self.reload();self.update_pager();}else{self.do_action('history_back');}
def.resolve();});}else{utils.async_when().done(function(){def.reject();});}});return def.promise();},can_be_discarded:function(message){if(!this.$el.is('.oe_form_dirty')){return $.Deferred().resolve();}
message=message||_t("The record has been modified, your changes will be discarded. Are you sure you want to leave this page ?");var self=this;var def=$.Deferred();var options={title:_t("Warning"),confirm_callback:function(){self.$el.removeClass('oe_form_dirty');this.on('closed',null,function(){def.resolve();});},cancel_callback:function(){def.reject();},};var dialog=Dialog.confirm(this,message,options);dialog.$modal.on('hidden.bs.modal',function(){def.reject();});return def;},save:function(prepend_on_create){var self=this;var save_obj={prepend_on_create:prepend_on_create,ret:null};this.save_list.push(save_obj);return self._process_operations().then(function(){if(save_obj.error)
return $.Deferred().reject();return $.when.apply($,save_obj.ret);}).done(function(result){self.$el.removeClass('oe_form_dirty');});},_process_save:function(save_obj){var self=this;var prepend_on_create=save_obj.prepend_on_create;var def_process_save=$.Deferred();try{var form_invalid=false,values={},first_invalid_field=null,readonly_values={},deferred=[];$.when.apply($,deferred).always(function(){_.each(self.fields,function(f){if(!f.is_valid()){form_invalid=true;if(!first_invalid_field){first_invalid_field=f;}}else if(f.name!=='id'&&(!self.datarecord.id||f._dirty_flag)){if(!f.get("readonly")){values[f.name]=f.get_value(true);}else{readonly_values[f.name]=f.get_value(true);}}});if(!self.datarecord.id&&self.fields.sequence&&!_.has(values,'sequence')&&!_.isEmpty(self.dataset.cache)){var current=_[prepend_on_create?"min":"max"](_.map(self.dataset.cache,function(o){return o.values.sequence}));values['sequence']=prepend_on_create?current-1:current+1;}
if(form_invalid){self.set({'display_invalid_fields':true});first_invalid_field.focus();self.on_invalid();def_process_save.reject();}else{self.set({'display_invalid_fields':false});var save_deferral;if(!self.datarecord.id){save_deferral=self.dataset.create(values,{readonly_fields:readonly_values}).then(function(r){self.display_translation_alert(values);return self.record_created(r,prepend_on_create);},null);}else if(_.isEmpty(values)){save_deferral=$.Deferred().resolve({}).promise();}else{save_deferral=self.dataset.write(self.datarecord.id,values,{readonly_fields:readonly_values}).then(function(r){self.display_translation_alert(values);return self.record_saved(r);},null);}
save_deferral.then(function(result){def_process_save.resolve(result);}).fail(function(){def_process_save.reject();});}});}catch(e){console.error(e);return def_process_save.reject();}
return def_process_save;},on_invalid:function(){var warnings=_(this.fields).chain().filter(function(f){return!f.is_valid();}).map(function(f){return _.str.sprintf('<li>%s</li>',_.escape(f.string));}).value();warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},record_saved:function(r){this.trigger('record_saved',r);if(!r){return $.Deferred().reject();}
return r;},record_created:function(r,prepend_on_create){var self=this;if(!r){this.trigger('record_created',r);return $.Deferred().reject();}else{this.datarecord.id=r;if(!prepend_on_create){this.dataset.alter_ids(this.dataset.ids.concat([this.datarecord.id]));this.dataset.index=this.dataset.ids.length-1;}else{this.dataset.alter_ids([this.datarecord.id].concat(this.dataset.ids));this.dataset.index=0;}
this.update_pager();if(this.sidebar){this.sidebar.do_attachement_update(this.dataset,this.datarecord.id);}
return $.when(this.reload()).then(function(){self.trigger('record_created',r);return _.extend(r,{created:true});});}},on_action:function(action){console.debug('Executing action',action);},reload:function(){var self=this;return this.reload_mutex.exec(function(){if(self.dataset.index===null||self.dataset.index===undefined){self.do_action('reload');return $.Deferred().reject().promise();}
if(self.dataset.index<0){return $.when(self.on_button_new());}else{var fields=_.keys(self.fields_view.fields);fields.push('display_name');fields.push('__last_update');return self.dataset.read_index(fields,{context:{'bin_size':true},check_access_rule:true}).then(function(r){self.trigger('load_record',r);}).fail(function(){self.do_action('history_back');});}});},get_widgets:function(){return _.filter(this.getChildren(),function(obj){return obj instanceof common.FormWidget;});},get_fields_values:function(){var values={};var ids=this.get_selected_ids();values["id"]=ids.length>0?ids[0]:false;_.each(this.fields,function(value_,key){values[key]=value_.get_value();});return values;},get_selected_ids:function(){var id=this.dataset.ids[this.dataset.index];return id?[id]:[];},recursive_save:function(){var self=this;return $.when(this.save()).then(function(res){if(self.dataset.parent_view)
return self.dataset.parent_view.recursive_save();});},recursive_reload:function(){var self=this;var pre=$.when();if(self.dataset.parent_view)
pre=self.dataset.parent_view.recursive_reload();return pre.then(function(){return self.reload();});},is_dirty:function(){return _.any(this.fields,function(value_){return value_._dirty_flag;});},is_interactible_record:function(){var id=this.datarecord.id;if(!id){if(this.options.not_interactible_on_create)
return false;}else if(typeof(id)==="string"){if(data.BufferedDataSet.virtual_id_regex.test(id))
return false;}
return true;},sidebar_eval_context:function(){return $.when(this.build_eval_context());},display_translation_alert:function(values){if(_t.database.multi_lang){var alert_fields=_.filter(this.translatable_fields,function(field){return _.has(values,field.name)});if(alert_fields.length){var $content=$(QWeb.render('translation-alert',{fields:alert_fields,lang:_t.database.parameters.name}));$content.find('.oe_field_translate').click(function(ev){ev.preventDefault();_.find(alert_fields,{'name':ev.target.name}).on_translate();});this.once('to_view_mode',this,function(){this.notify_in_form($content);});}}},notify_in_form:function($content,options){options=options||{};var type=options.type||'info';var $box=$(QWeb.render('notification-box',{type:type}));$box.append($content);var events=options.events||'to_edit_mode view_content_has_changed';this.once(events,null,function(){$box.remove();});var $target=this.$('.o_form_sheet_bg').length?this.$('.o_form_sheet_bg'):this.$el;$target.prepend($box);},open_defaults_dialog:function(){var self=this;var display=function(field,value){var FieldSelection=core.form_widget_registry.get('selection');var FieldMany2One=core.form_widget_registry.get('many2one');if(!value){return value;}
if(field instanceof FieldSelection){return _(field.get('values')).find(function(option){return option[0]===value;})[1];}else if(field instanceof FieldMany2One){return field.get_displayed();}
return value;};var fields=_.chain(this.fields).map(function(field){var value=field.get_value();if(!value||field.get('invisible')||field.get("readonly")||field.field.type==='one2many'||field.field.type==='many2many'||field.field.type==='binary'||field.password||!_.isEmpty(field.field.depends)){return false;}
return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(self.fields).filter(function(field){return field.field.change_default;}).map(function(field){var value=field.get_value();return{name:field.name,string:field.string,value:value,displayed:display(field,value),};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var field_to_set=$defaults.val();if(!field_to_set){$defaults.parent().addClass('o_form_invalid');return;}
var condition=d.$el.find('#formview_default_conditions').val(),all_users=d.$el.find('#formview_default_all').is(':checked');new data.DataSet(self,'ir.values').call('set_default',[self.model,field_to_set,self.fields[field_to_set].get_value(),all_users,true,condition||false]).done(function(){d.close();});}}]});d.args={fields:fields,conditions:conditions};d.template='FormView.set_default';d.open();},register_field:function(field,name){this.fields[name]=field;this.fields_order.push(name);if(JSON.parse(field.node.attrs.default_focus||"0")){this.default_focus_field=field;}
field.on('focused',null,this.proxy('widgetFocused')).on('blurred',null,this.proxy('widgetBlurred'));if(this.get_field_desc(name).translate){this.translatable_fields.push(field);}
field.on('changed_value',this,function(){if(field.is_syntax_valid()){this.trigger('field_changed:'+name);}
if(field._inhibit_on_change_flag){return;}
field._dirty_flag=true;if(field.is_syntax_valid()){this.do_onchange(field);this.on_form_changed(true);this.do_notify_change();}});},get_field_desc:function(field_name){return this.fields_view.fields[field_name];},get_field_value:function(field_name){return this.fields[field_name].get_value();},compute_domain:function(expression){return data.compute_domain(expression,this.fields);},_build_view_fields_values:function(){var a_dataset=this.dataset;var fields_values=this.get_fields_values();var active_id=a_dataset.ids[a_dataset.index];_.extend(fields_values,{active_id:active_id||false,active_ids:active_id?[active_id]:[],active_model:a_dataset.model,parent:{}});if(a_dataset.parent_view){fields_values.parent=a_dataset.parent_view.get_fields_values();}
return fields_values;},build_eval_context:function(){var a_dataset=this.dataset;return new data.CompoundContext(a_dataset.get_context(),this._build_view_fields_values());},});core.view_registry.add('form',FormView);return FormView;});odoo.define('web.FormRenderingEngine',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var utils=require('web.utils');var _t=core._t;var QWeb=core.qweb;return core.Class.extend({init:function(view){this.view=view;},set_fields_view:function(fvg){this.fvg=fvg;this.version=parseFloat(this.fvg.arch.attrs.version);if(isNaN(this.version)){this.version=7.0;}},set_tags_registry:function(tags_registry){this.tags_registry=tags_registry;},set_fields_registry:function(fields_registry){this.fields_registry=fields_registry;},set_widgets_registry:function(widgets_registry){this.widgets_registry=widgets_registry;},process_version:function(){if(this.version<7.0){this.$form.find('form:first').wrapInner('<group col="4"/>');this.$form.find('page').each(function(){if(!$(this).parents('field').length){$(this).wrapInner('<group col="4"/>');}});}},get_arch_fragment:function(){var doc=$.parseXML(utils.json_node_to_xml(this.fvg.arch)).documentElement;$('button',doc).each(function(){$(this).attr('data-button-type',$(this).attr('type')).attr('type','button');});$('board',doc).each(function(){$(this).attr('layout',$(this).attr('style'));});return $(utils.xml_to_str(doc));},render_to:function($target){var self=this;this.$target=$target;this.$form=this.get_arch_fragment();this.process_version();this.fields_to_init=[];this.tags_to_init=[];this.widgets_to_init=[];this.labels={};this.process(this.$form);this.$form.contents().appendTo(this.$target);this.handle_common_properties(this.$target,this.$form);this.to_replace=[];_.each(this.fields_to_init,function($elem){var name=$elem.attr("name");if(!self.fvg.fields[name]){throw new Error(_.str.sprintf(_t("Field '%s' specified in view could not be found."),name));}
var obj=self.fields_registry.get_any([$elem.attr('widget'),self.fvg.fields[name].type]);if(!obj){throw new Error(_.str.sprintf(_t("Widget type '%s' is not implemented"),$elem.attr('widget')||self.fvg.fields[name].type));}
var w=new(obj)(self.view,utils.xml_to_json($elem[0]));var $label=self.labels[$elem.attr("name")];if($label){w.set_input_id($label.attr("for"));}
self.alter_field(w);self.view.register_field(w,$elem.attr("name"));self.to_replace.push([w,$elem]);});_.each(this.tags_to_init,function($elem){var tag_name=$elem[0].tagName.toLowerCase();var obj=self.tags_registry.get(tag_name);var w=new(obj)(self.view,utils.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});_.each(this.widgets_to_init,function($elem){var widget_type=$elem.attr("type");var obj=self.widgets_registry.get(widget_type);var w=new(obj)(self.view,utils.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});},init_fields:function(){var defs=[];_.each(this.to_replace,function(el){defs.push(el[0].replace(el[1]));if(el[1].children().length){el[0].$el.append(el[1].children());}});this.to_replace=[];return $.when.apply($,defs);},render_element:function(template){var dicts=[].slice.call(arguments).slice(1);var dict=_.extend.apply(_,dicts);dict['classnames']=dict['class']||'';return $(QWeb.render(template,dict));},alter_field:function(field){},toggle_layout_debugging:function(){if(!this.$target.has('.oe_layout_debug_cell:first').length){this.$target.find('[title]').removeAttr('title');this.$target.find('.oe_form_group_cell').each(function(){var text='W:'+($(this).attr('width')||'')+' - C:'+$(this).attr('colspan');$(this).attr('title',text);});}
this.$target.toggleClass('oe_layout_debugging');},process:function($tag){var self=this;var tagname=$tag[0].nodeName.toLowerCase();if(this.tags_registry.contains(tagname)){this.tags_to_init.push($tag);return(tagname==='button')?this.process_button($tag):$tag;}
var fn=self['process_'+tagname];if(fn){var args=[].slice.call(arguments);args[0]=$tag;return fn.apply(self,args);}else{$tag.children().each(function(){self.process($(this));});self.handle_common_properties($tag,$tag);$tag.removeAttr("modifiers");return $tag;}},process_button:function($button){var self=this;$button.children().each(function(){self.process($(this));});return $button;},process_widget:function($widget){this.widgets_to_init.push($widget);return $widget;},process_sheet:function($sheet){var $new_sheet=this.render_element('FormRenderingSheet',$sheet.getAttributes());this.handle_common_properties($new_sheet,$sheet);var $dst=$new_sheet.find('.o_form_sheet');$sheet.contents().appendTo($dst);$sheet.before($new_sheet).remove();this.process($new_sheet);},process_form:function($form){if($form.find('> sheet').length===0){$form.addClass('o_form_nosheet');}
var $new_form=this.render_element('FormRenderingForm',$form.getAttributes());this.handle_common_properties($new_form,$form);$form.contents().appendTo($new_form);if($form[0]===this.$form[0]){this.$form=$new_form;}else{$form.before($new_form).remove();}
this.process($new_form);},preprocess_field:function($field){var self=this;var name=$field.attr('name'),field_colspan=parseInt($field.attr('colspan'),10),field_modifiers=JSON.parse($field.attr('modifiers')||'{}');if($field.attr('nolabel')==='1')
return;$field.attr('nolabel','1');var found=false;this.$form.find('label[for="'+name+'"]').each(function(i,el){$(el).parents().each(function(unused,tag){var name=tag.tagName.toLowerCase();if(name==="field"||name in self.tags_registry.map)
found=true;});});if(found)
return;var $label=$('<label/>').attr({'for':name,"modifiers":JSON.stringify({invisible:field_modifiers.invisible}),"string":$field.attr('string'),"help":$field.attr('help'),"class":$field.attr('class'),});$label.insertBefore($field);if(field_colspan>1){$field.attr('colspan',field_colspan-1);}
return $label;},process_field:function($field){if($field.parent().is('group')){var $label=this.preprocess_field($field);if($label){this.process($label);}}
this.fields_to_init.push($field);return $field;},process_group:function($group){var self=this;var _process_outer_group=function(col){var $new_group=self.render_element('FormRenderingOuterGroup',$group.getAttributes());$group.children().each(function(){var $child=$(this);var tagName=$child[0].tagName.toLowerCase();var colspan=parseInt($child.attr('colspan')||1,10);if(tagName==='newline'){$new_group.append($('<br>'));return;}
$child.addClass('o_group_col_'+Math.min(Math.floor(colspan/col*12),12));$new_group.append($child);children.push($child[0]);});return $new_group;};var _process_inner_group=function(col){var $new_group=self.render_element('FormRenderingInnerGroup',$group.getAttributes());$new_group.find('td').attr('colspan',col);var row_col=col;var $row=null;$group.children().each(function(){var $child=$(this);var tagName=$child[0].tagName.toLowerCase();var colspan=parseInt($child.attr('colspan')||1,10);if(tagName==='newline'){$row=null;return;}
row_col-=colspan;if(!$row||row_col<0){$row=$('<tr>').appendTo($new_group);row_col=col-colspan;}
$('<td>').attr('colspan',colspan).append($child).appendTo($row);children.push($child[0]);});$new_group.find('tr').each(function(){var $tr=$(this);var nonlabel_width=100/(col-$tr.find('td > label:first-child').length);$tr.find('td').each(function(){var $td=$(this);var $child=$td.children(':first');if($child.is("label")){$td.addClass("o_td_label");}else{$td.css("width",(nonlabel_width*parseInt($td.attr('colspan')))+"%");}});});return $new_group;};$group.children('field').each(function(){self.preprocess_field($(this));});var nested_groups=$group.children('group').length;var children=[];var col=parseInt($group.attr('col')||2,10);var $new_group;if(nested_groups){$new_group=_process_outer_group(col);}else{$new_group=_process_inner_group(col);}
this.handle_common_properties($new_group,$group);$group.before($new_group).remove();_.each(children,function(el){self.process($(el));});return $new_group;},process_notebook:function($notebook){var self=this;var pages=[];$notebook.find('> page').each(function(){var $page=$(this);var page_attrs=$page.getAttributes();page_attrs.id=_.uniqueId('notebook_page_');page_attrs.contents=$page.html();page_attrs.ref=$page;pages.push(page_attrs);});var $new_notebook=self.render_element('FormRenderingNotebook',{'pages':pages});$notebook.before($new_notebook).remove();var pageid_to_display;_.each(pages,function(page){var $tab=$new_notebook.find('a[href=#'+page.id+']').parent();var $content=$new_notebook.find('#'+page.id);self.attach_node_attr($tab,page.ref,'autofocus');self.attach_node_attr($content,page.ref,'autofocus');if(!pageid_to_display&&page.autofocus){pageid_to_display=page.id;}
self.handle_common_properties($tab,page.ref,common.NotebookInvisibilityChanger);self.handle_common_properties($content,page.ref,common.NotebookInvisibilityChanger);});if(!pageid_to_display){pageid_to_display=$new_notebook.find('div[role="tabpanel"]:not(.o_form_invisible):first').attr('id');}
$new_notebook.find('a[href=#'+pageid_to_display+']').parent().addClass('active');$new_notebook.find('#'+pageid_to_display).addClass('active');self.process($new_notebook.children());self.handle_common_properties($new_notebook,$notebook);return $new_notebook;},process_separator:function($separator){var $new_separator=this.render_element('FormRenderingSeparator',$separator.getAttributes());$separator.before($new_separator).remove();this.handle_common_properties($new_separator,$separator);return $new_separator;},process_label:function($label){var name=$label.attr("for"),field_orm=this.fvg.fields[name];var dict={string:$label.attr('string')||(field_orm||{}).string||'',help:$label.attr('help')||(field_orm||{}).help||'',_for:name?_.uniqueId('o_field_input_'):undefined,};var $new_label=this.render_element('FormRenderingLabel',dict);$label.before($new_label).remove();this.handle_common_properties($new_label,$label);if(name){this.labels[name]=$new_label;}
return $new_label;},handle_common_properties:function($new_element,$node,InvisibilityChanger){var str_modifiers=$node.attr("modifiers")||"{}";var modifiers=JSON.parse(str_modifiers);var ic=null;if(modifiers.invisible!==undefined){var InvisibilityChangerCls=InvisibilityChanger||common.InvisibilityChanger;ic=new InvisibilityChangerCls(this.view,this.view,modifiers.invisible,$new_element);}
$new_element.addClass($node.attr("class")||"");$new_element.attr('style',$node.attr('style'));return{invisibility_changer:ic,};},attach_node_attr:function($new_element,$node,attr){$new_element.data(attr,$node.attr(attr));}});});;

/* /web/static/src/js/views/form_common.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_common',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var ListView=require('web.ListView');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var FieldManagerMixin={get_field_desc:function(field_name){},get_field_value:function(field_name){},set_values:function(values){},compute_domain:function(expression){},build_eval_context:function(){},};var DefaultFieldManager=Widget.extend({init:function(parent,eval_context){this._super(parent);this.field_descs={};this.eval_context=eval_context||{};this.set({display_invalid_fields:false,actual_mode:'create',});},get_field_desc:function(field_name){if(this.field_descs[field_name]===undefined){this.field_descs[field_name]={string:field_name,};}
return this.field_descs[field_name];},extend_field_desc:function(fields){var self=this;_.each(fields,function(v,k){_.extend(self.get_field_desc(k),v);});},get_field_value:function(field_name){return false;},set_values:function(values){},compute_domain:function(expression){return data.compute_domain(expression,{});},build_eval_context:function(){return new data.CompoundContext(this.eval_context);},});var ReinitializeWidgetMixin={start:function(){this.initialize_field();this._super();},initialize_field:function(){this.on("change:effective_readonly",this,this.reinitialize);this.initialize_content();},reinitialize:function(){this.destroy_content();this.renderElement();this.initialize_content();},destroy_content:function(){},initialize_content:function(){},};var ReinitializeFieldMixin=_.extend({},ReinitializeWidgetMixin,{reinitialize:function(){ReinitializeWidgetMixin.reinitialize.call(this);if(!this.no_rerender){var res=this.render_value();if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(res);}}},});var CompletionFieldMixin={init:function(){this.limit=7;this.orderer=new utils.DropMisordered();this.can_create=this.node.attrs.can_create=="false"?false:true;this.can_write=this.node.attrs.can_write=="false"?false:true;},get_search_result:function(search_val){var self=this;var dataset=new data.DataSet(this,this.field.relation,self.build_context());this.last_query=search_val;var exclusion_domain=[],ids_blacklist=this.get_search_blacklist();if(!_(ids_blacklist).isEmpty()){exclusion_domain.push(['id','not in',ids_blacklist]);}
return this.orderer.add(dataset.name_search(search_val,new data.CompoundDomain(self.build_domain(),exclusion_domain),'ilike',this.limit+1,self.build_context())).then(function(_data){self.last_search=_data;var values=_.map(_data,function(x){x[1]=x[1].split("\n")[0];return{label:_.str.escapeHTML(x[1].trim())||data.noDisplayContent,value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){dataset.name_search(search_val,self.build_domain(),'ilike',160).done(function(_data){self._search_create_popup("search",_data);});},classname:'o_m2o_dropdown_option'});}
var raw_result=_(_data.result).map(function(x){return x[1];});if(search_val.length>0&&!_.include(raw_result,search_val)&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){self.can_create&&values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:function(){self._quick_create(search_val);},classname:'o_m2o_dropdown_option'});}
if(!(self.options&&(self.options.no_create||self.options.no_create_edit))&&self.can_create){values.push({label:_t("Create and Edit..."),action:function(){self._search_create_popup("form",undefined,self._create_context(search_val));},classname:'o_m2o_dropdown_option'});}
else if(values.length===0){values.push({label:_t("No results to show..."),action:function(){},classname:'o_m2o_dropdown_option'});}
return values;});},get_search_blacklist:function(){return[];},_quick_create:function(name){var self=this;var slow_create=function(){self._search_create_popup("form",undefined,self._create_context(name));};if(self.options.quick_create===undefined||self.options.quick_create){new data.DataSet(this,this.field.relation,self.build_context()).name_create(name).done(function(data){if(!self.get('effective_readonly'))
self.add_id(data[0]);}).fail(function(error,event){event.preventDefault();slow_create();});}else
slow_create();},_search_create_popup:function(view,ids,context){var self=this;new SelectCreateDialog(this,_.extend({},(this.options||{}),{res_model:self.field.relation,domain:self.build_domain(),context:new data.CompoundContext(self.build_context(),context||{}),title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0];}):undefined,initial_view:view,disable_multiple_selection:true,on_selected:function(element_ids){self.add_id(element_ids[0]);self.focus();}})).open();},add_id:function(id){},_create_context:function(name){var tmp={};var field=(this.options||{}).create_name_field;if(field===undefined)
field="name";if(field!==false&&name&&(this.options||{}).quick_create!==false)
tmp["default_"+field]=name;return tmp;},};var InvisibilityChangerMixin={init:function(field_manager,invisible_domain){var self=this;this._ic_field_manager=field_manager;this._ic_invisible_modifier=invisible_domain;this._ic_field_manager.on("view_content_has_changed",this,function(){var result=self._ic_invisible_modifier===undefined?false:self._ic_field_manager.compute_domain(self._ic_invisible_modifier);self.set({"invisible":result});});this.set({invisible:this._ic_invisible_modifier===true,force_invisible:false});var check=function(){if(self.get("invisible")||self.get('force_invisible')){self.set({"effective_invisible":true});}else{self.set({"effective_invisible":false});}};this.on('change:invisible',this,check);this.on('change:force_invisible',this,check);check.call(this);},start:function(){this.on("change:effective_invisible",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggleClass('o_form_invisible',this.get("effective_invisible"));},};var InvisibilityChanger=core.Class.extend(core.mixins.PropertiesMixin,InvisibilityChangerMixin,{init:function(parent,field_manager,invisible_domain,$el){this.setParent(parent);core.mixins.PropertiesMixin.init.call(this);InvisibilityChangerMixin.init.call(this,field_manager,invisible_domain);this.$el=$el;this.start();},});var NotebookInvisibilityChanger=InvisibilityChanger.extend({start:function(){this.on("change:effective_invisible",this,this._check_visibility);},_check_visibility:function(){this._super();if(this.get("effective_invisible")===true){if(this.$el.hasClass('active')){this.$el.removeClass('active');var visible_siblings=this.$el.siblings(':not(.o_form_invisible)');if(visible_siblings.length){$(visible_siblings[0]).addClass('active');}}}else{var visible_active_sibling=this.$el.siblings(':not(.o_form_invisible).active');if(!(visible_active_sibling.length)){this.$el.addClass('active');}else if(!$(visible_active_sibling[0]).data('autofocus')&&this._ic_field_manager.get('actual_mode')==="edit"){this.$el.addClass('active');$(visible_active_sibling[0]).removeClass('active');}}},});var FormWidget=Widget.extend(InvisibilityChangerMixin,{init:function(field_manager,node){this._super(field_manager);this.field_manager=field_manager;this.view=this.field_manager;this.node=node;this.session=session;this.modifiers=JSON.parse(this.node.attrs.modifiers||'{}');InvisibilityChangerMixin.init.call(this,this.field_manager,this.modifiers.invisible);this.field_manager.on("view_content_has_changed",this,this.process_modifiers);this.set({required:false,readonly:false,});var self=this;var test_effective_readonly=function(){self.set({"effective_readonly":self.get("readonly")||self.field_manager.get("actual_mode")==="view"});};this.on("change:readonly",this,test_effective_readonly);this.field_manager.on("change:actual_mode",this,test_effective_readonly);test_effective_readonly.call(this);},renderElement:function(){this.process_modifiers();this._super();this.$el.addClass(this.node.attrs["class"]||"");this.$el.attr('style',this.node.attrs.style);},destroy:function(){$.fn.tooltip('destroy');this._super.apply(this,arguments);},setupFocus:function($e){var self=this;$e.on({focus:function(){self.trigger('focused');},blur:function(){self.trigger('blurred');}});},process_modifiers:function(){var to_set={};for(var a in this.modifiers){if(!this.modifiers.hasOwnProperty(a)){continue;}
if(!_.include(["invisible"],a)){var val=this.field_manager.compute_domain(this.modifiers[a]);to_set[a]=val;}}
this.set(to_set);},do_attach_tooltip:function(widget,trigger,options){widget=widget||this;trigger=trigger||this.$el;options=_.extend({delay:{show:1000,hide:0},title:function(){var template=widget.template+'.tooltip';if(!QWeb.has_template(template)){template='WidgetLabel.tooltip';}
return QWeb.render(template,{debug:session.debug,widget:widget});}},options||{});if(session.debug||widget.node.attrs.help||(widget.field&&widget.field.help)){$(trigger).tooltip(options);}},build_context:function(){var v_context=this.node.attrs.context;if(!v_context){v_context=(this.field||{}).context||{};}
if(v_context.__ref||true){var fields_values=this.field_manager.build_eval_context();v_context=new data.CompoundContext(v_context).set_eval_context(fields_values);}
return v_context;},build_domain:function(){var f_domain=this.field.domain||[];var n_domain=this.node.attrs.domain||null;var final_domain=n_domain!==null?n_domain:f_domain;if(!(final_domain instanceof Array)||true){var fields_values=this.field_manager.build_eval_context();final_domain=new data.CompoundDomain(final_domain).set_eval_context(fields_values);}
return final_domain;}});var commands={CREATE:0,'create':function(values){return[commands.CREATE,false,values];},UPDATE:1,'update':function(id,values){return[commands.UPDATE,id,values];},DELETE:2,'delete':function(id){return[commands.DELETE,id,false];},FORGET:3,'forget':function(id){return[commands.FORGET,id,false];},LINK_TO:4,'link_to':function(id){return[commands.LINK_TO,id,false];},DELETE_ALL:5,'delete_all':function(){return[5,false,false];},REPLACE_WITH:6,'replace_with':function(ids){return[6,false,ids];}};var FieldInterface={init:function(field_manager,node){},set_value:function(value_){},get_value:function(){},set_input_id:function(id){},is_valid:function(){},is_syntax_valid:function(){},focus:function(){},on_translate:function(){},commit_value:function(){},};var AbstractField=FormWidget.extend(FieldInterface,{init:function(field_manager,node){this._super(field_manager,node);this.name=this.node.attrs.name;this.field=this.field_manager.get_field_desc(this.name);this.widget=this.node.attrs.widget;this.string=this.node.attrs.string||this.field.string||this.name;this.options=pyeval.py_eval(this.node.attrs.options||'{}');this.set({'value':false});this.on("change:value",this,function(){this.trigger('changed_value');this._check_css_flags();});this.$translate=(_t.database.multi_lang&&this.field.translate)?$('<button/>',{type:'button',}).addClass('o_field_translate fa fa-globe btn btn-link'):$();},renderElement:function(){var self=this;this._super();this.$el.addClass('o_form_field');this.$label=this.view?this.view.$('label[for='+this.id_for_label+']'):$();this.do_attach_tooltip(this,this.$label[0]||this.$el);if(session.debug){this.$label.off('dblclick').on('dblclick',function(){console.log("Field '%s' of type '%s' in View: %o",self.name,(self.node.attrs.widget||self.field.type),self.view);window.w=self;console.log("window.w =",window.w);});}
if(!this.disable_utility_classes){this.off("change:required",this,this._set_required);this.on("change:required",this,this._set_required);this._set_required();}
this._check_visibility();this.field_manager.off("change:display_invalid_fields",this,this._check_css_flags);this.field_manager.on("change:display_invalid_fields",this,this._check_css_flags);this._check_css_flags();},start:function(){this._super();this.on("change:value",this,function(){if(!this.no_rerender){this.render_value();}
this._toggle_label();});this.on("change:effective_readonly",this,function(){this._toggle_label();});this.render_value();this._toggle_label();if(this.view){this.$translate.insertAfter(this.$el).on('click',_.bind(this.on_translate,this));}},_toggle_label:function(){var empty=this.get('effective_readonly')&&!this.is_set();this.$label.toggleClass('o_form_label_empty',empty).toggleClass('o_form_label_false',this.get('effective_readonly')&&this.get('value')===false);this.$el.toggleClass('o_form_field_empty',empty);},_set_required:function(){this.$el.toggleClass('o_form_required',this.get("required"));},set_value:function(value_){this.set({'value':value_});},set_value_from_record:function(record){this.set_value.call(this,record[this.name]||false);},get_value:function(){return this.get('value');},internal_set_value:function(value_){var tmp=this.no_rerender;this.no_rerender=true;this.set({'value':value_});this.no_rerender=tmp;},render_value:function(){},is_valid:function(){return this.is_syntax_valid()&&!(this.get('required')&&this.is_false());},is_syntax_valid:function(){return true;},is_false:function(){return this.get('value')===false;},is_set:function(){return!this.is_false();},_check_css_flags:function(){var show_translate=(!this.get('effective_readonly')&&this.field_manager.get('actual_mode')!=="create");this.$translate.toggleClass('o_translate_active',!!show_translate);this.$el.add(this.$label).toggleClass('o_form_invalid',!this.disable_utility_classes&&!!this.field_manager.get('display_invalid_fields')&&!this.is_valid());},focus:function(){return false;},set_input_id:function(id){this.id_for_label=id;},on_translate:function(){var self=this;var trans=new data.DataSet(this,'ir.translation');return trans.call_button('translate_fields',[this.view.model,this.view.datarecord.id,this.name,this.view.dataset.get_context()]).done(function(r){self.do_action(r);});},set_dimensions:function(height,width){this.$el.css({width:width,height:height,});},commit_value:function(){return $.when();},});var ViewDialog=Dialog.extend({init:function(parent,options){options=options||{};options.dialogClass=options.dialogClass||'';options.dialogClass+=' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.res_id=options.res_id||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});this.on_selected=options.on_selected||(function(){});},init_dataset:function(){var self=this;this.created_elements=[];this.dataset=new data.ProxyDataSet(this,this.res_model,this.context);this.dataset.read_function=this.options.read_function;this.dataset.create_function=function(data,options,sup){var fct=self.options.create_function||sup;return fct.call(this,data,options).done(function(r){self.trigger('create_completed saved',r);self.created_elements.push(r);});};this.dataset.write_function=function(id,data,options,sup){var fct=self.options.write_function||sup;return fct.call(this,id,data,options).done(function(r){self.trigger('write_completed saved',r);});};this.dataset.parent_view=this.options.parent_view;this.dataset.child_name=this.options.child_name;this.on('closed',this,this.select);},select:function(){if(this.created_elements.length>0){this.on_selected(this.created_elements);this.created_elements=[];}}});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options||!options.buttons){options=options||{};options.buttons=[{text:(readonly?_t("Close"):_t("Discard")),classes:"btn-default o_form_button_cancel",close:true,click:function(){self.view_form.trigger('on_button_cancel');}}];if(!readonly){options.buttons.splice(0,0,{text:_t("Save")+((multi_select)?" "+_t(" & Close"):""),classes:"btn-primary",click:function(){self.view_form.onchanges_mutex.def.then(function(){if(!self.view_form.warning_displayed){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.trigger('record_saved');self.close();});});}});}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.view_form.on_button_new();});});}});}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);this.init_dataset();if(this.res_id){this.dataset.ids=[this.res_id];this.dataset.index=0;}else{this.dataset.index=null;}
var options=_.clone(this.options.form_view_options)||{};if(this.res_id!==null){options.initial_mode=this.options.readonly?"view":"edit";}
_.extend(options,{$buttons:this.$buttons,});var FormView=core.view_registry.get('form');var fields_view_def;if(this.options.alternative_form_view){fields_view_def=$.when(this.options.alternative_form_view);}else{fields_view_def=data_manager.load_fields_view(this.dataset,this.options.view_id,'form',false);}
fields_view_def.then(function(fields_view){self.view_form=new FormView(self,self.dataset,fields_view,options);var fragment=document.createDocumentFragment();self.view_form.appendTo(fragment).then(function(){self.view_form.do_show().then(function(){_super().$el.append(fragment);self.view_form.autofocus();});});});return this;},});var SelectCreateListView=ListView.extend({do_add_record:function(){this.popup.create_edit_record();},select_record:function(index){this.popup.on_selected([this.dataset.ids[index]]);this.popup.close();},do_select:function(ids,records){this._super.apply(this,arguments);this.popup.on_click_element(ids);}});var SelectCreateDialog=ViewDialog.extend({init:function(parent,options){this._super(parent,options);_.defaults(this.options,{initial_view:"search"});this.initial_ids=this.options.initial_ids;},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var _super=this._super.bind(this);this.init_dataset();var context=pyeval.sync_eval_domains_and_contexts({domains:[],contexts:[this.context]}).context;var search_defaults={};_.each(context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});data_manager.load_views(this.dataset,[[false,'list'],[false,'search']],{}).then(this.setup.bind(this,search_defaults)).then(function(fragment){_super().$el.append(fragment);});return this;},setup:function(search_defaults,fields_views){var self=this;if(this.searchview){this.searchview.destroy();}
var fragment=document.createDocumentFragment();var $header=$('<div/>').addClass('o_modal_header').appendTo(fragment);var $pager=$('<div/>').addClass('o_pager').appendTo($header);var options={$buttons:$('<div/>').addClass('o_search_options').appendTo($header),search_defaults:search_defaults,};this.searchview=new SearchView(this,this.dataset,fields_views.search,options);this.searchview.on('search_data',this,function(domains,contexts,groupbys){if(this.initial_ids){this.do_search(domains.concat([[["id","in",this.initial_ids]],this.domain]),contexts.concat(this.context),groupbys);this.initial_ids=undefined;}else{this.do_search(domains.concat([this.domain]),contexts.concat(this.context),groupbys);}});return this.searchview.prependTo($header).then(function(){self.searchview.toggle_visibility(true);self.view_list=new SelectCreateListView(self,self.dataset,fields_views.list,_.extend({'deletable':false,'selectable':!self.options.disable_multiple_selection,'import_enabled':false,'$buttons':self.$buttons,'disable_editable_mode':true,'pager':true,},self.options.list_view_options||{}));self.view_list.on('edit:before',self,function(e){e.cancel=true;});self.view_list.popup=self;self.view_list.on('list_view_loaded',self,function(){this.on_view_list_loaded();});var buttons=[{text:_t("Cancel"),classes:"btn-default o_form_button_cancel",close:true}];if(!self.options.no_create){buttons.splice(0,0,{text:_t("Create"),classes:"btn-primary",click:function(){self.create_edit_record();}});}
if(!self.options.disable_multiple_selection){buttons.splice(0,0,{text:_t("Select"),classes:"btn-primary o_selectcreatepopup_search_select",disabled:true,close:true,click:function(){self.on_selected(self.selected_ids);}});}
self.set_buttons(buttons);return self.view_list.appendTo(fragment).then(function(){self.view_list.do_show();self.view_list.render_pager($pager);if(self.options.initial_facet){self.searchview.query.reset([self.options.initial_facet],{preventSearch:true,});}
self.searchview.do_search();return fragment;});});},do_search:function(domains,contexts,groupbys){var results=pyeval.sync_eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]});this.view_list.do_search(results.domain,results.context,results.group_by);},on_click_element:function(ids){this.selected_ids=ids||[];this.$footer.find(".o_selectcreatepopup_search_select").prop('disabled',this.selected_ids.length<=0);},create_edit_record:function(){this.close();return new FormViewDialog(this.__parentedParent,this.options).open();},on_view_list_loaded:function(){},});var DomainEditorDialog=SelectCreateDialog.extend({init:function(parent,options){options=_.defaults(options,{initial_facet:{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return options.context;},get_groupby:function(){return[];},get_domain:function(){return options.default_domain;},},values:[{label:_t("Selected domain"),value:null}],}});this._super(parent,options);},get_domain:function(selected_ids){var group_domain=[];var domain;if(this.$('.o_list_record_selector input').prop('checked')){if(this.view_list.grouped){group_domain=_.chain(_.values(this.view_list.groups.children)).filter(function(child){return child.records.length;}).map(function(c){return c.datagroup.domain;}).value();group_domain=_.flatten(group_domain,true);group_domain=_.times(group_domain.length-1,_.constant('|')).concat(group_domain);}
var search_data=this.searchview.build_search_data();domain=pyeval.sync_eval_domains_and_contexts({domains:search_data.domains,contexts:search_data.contexts,group_by_seq:search_data.groupbys||[]}).domain;}
else{domain=[["id","in",selected_ids]];}
return this.dataset.domain.concat(group_domain).concat(domain||[]);},on_view_list_loaded:function(){this.$('.o_list_record_selector input').prop('checked',true);this.$footer.find(".o_selectcreatepopup_search_select").prop('disabled',false);},});return{FieldManagerMixin:FieldManagerMixin,ReinitializeWidgetMixin:ReinitializeWidgetMixin,ReinitializeFieldMixin:ReinitializeFieldMixin,CompletionFieldMixin:CompletionFieldMixin,FormWidget:FormWidget,DefaultFieldManager:DefaultFieldManager,InvisibilityChanger:InvisibilityChanger,NotebookInvisibilityChanger:NotebookInvisibilityChanger,commands:commands,AbstractField:AbstractField,ViewDialog:ViewDialog,FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,DomainEditorDialog:DomainEditorDialog,};});;

/* /web/static/src/js/views/form_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_widgets',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var datepicker=require('web.datepicker');var dom_utils=require('web.dom_utils');var Priority=require('web.Priority');var ProgressBar=require('web.ProgressBar');var Dialog=require('web.Dialog');var common=require('web.form_common');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var QWeb=core.qweb;var WidgetButton=common.FormWidget.extend({template:'WidgetButton',init:function(field_manager,node){node.attrs.type=node.attrs['data-button-type'];this._super(field_manager,node);this.force_disabled=false;this.string=(this.node.attrs.string||'').replace(/_/g,'');if(JSON.parse(this.node.attrs.default_focus||"0")){this.view.default_focus_button=this;}
if(this.node.attrs.icon){this.fa_icon=this.node.attrs.icon.indexOf('fa-')===0;}},start:function(){this._super.apply(this,arguments);this.view.on('view_content_has_changed',this,this.check_disable);this.check_disable();this.$el.click(this.on_click);if(this.node.attrs.help||session.debug){this.do_attach_tooltip();}
this.setupFocus(this.$el);},on_click:function(){var self=this;if(this.view.is_disabled){return;}
this.force_disabled=true;this.check_disable();this.view.disable_button();this.execute_action().always(function(){self.view.enable_button();self.force_disabled=false;self.check_disable();if(self.$el.hasClass('o_wow')){self.show_wow();}});},execute_action:function(){var self=this;var exec_action=function(){if(self.node.attrs.confirm){var def=$.Deferred();Dialog.confirm(self,self.node.attrs.confirm,{confirm_callback:self.on_confirmed}).on("closed",null,function(){def.resolve();});return def.promise();}else{return self.on_confirmed();}};if(!this.node.attrs.special){return this.view.recursive_save().then(exec_action);}else{return exec_action();}},on_confirmed:function(){var self=this;var context=this.build_context();return this.view.do_execute_action(_.extend({},this.node.attrs,{context:context}),this.view.dataset,this.view.datarecord.id,function(reason){if(!_.isObject(reason)){self.view.recursive_reload();}}).fail(function(){self.view.recursive_reload();});},check_disable:function(){var disabled=(this.force_disabled||!this.view.is_interactible_record());this.$el.prop('disabled',disabled);this.$el.css('color',disabled?'grey':'');},show_wow:function(){var class_to_add='o_wow_thumbs';if(Math.random()>0.9){var other_classes=['o_wow_peace','o_wow_heart'];class_to_add=other_classes[Math.floor(Math.random()*other_classes.length)];}
var $body=$('body');$body.addClass(class_to_add);setTimeout(function(){$body.removeClass(class_to_add);},1000);}});var FieldChar=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldChar',events:{'change':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.password=this.node.attrs.password==='True'||this.node.attrs.password==='1';},initialize_content:function(){if(!this.get('effective_readonly')&&!this.$input){this.$input=this.$el;}
this.setupFocus(this.$el);},destroy_content:function(){this.$input=undefined;},store_dom_value:function(){if(this.$input&&this.is_syntax_valid()){this.internal_set_value(this.parse_value(this.$input.val()));}},commit_value:function(){this.store_dom_value();return this._super();},render_value:function(){var show_value=this.format_value(this.get('value'),'');if(this.$input){this.$input.val(show_value);}else{if(this.password){show_value=new Array(show_value.length+1).join('*');}
this.$el.text(show_value);}},is_syntax_valid:function(){if(this.$input){try{this.parse_value(this.$input.val(),'');}catch(e){return false;}}
return true;},parse_value:function(val,def){return formats.parse_value(val,this,def);},format_value:function(val,def){return formats.format_value(val,this,def);},is_false:function(){return this.get('value')===''||this._super();},focus:function(){if(this.$input){return this.$input.focus();}
return false;},});var KanbanSelection=common.AbstractField.extend({template:"FormSelection",events:{'click a':function(e){e.preventDefault();},'mouseup a':function(e){e.stopPropagation();},'click li':'set_kanban_selection'},start:function(){this.view.on('view_content_has_changed',this,function(){this.render_value();});return this._super();},prepare_dropdown_selection:function(){var self=this;var _data=[];var current_stage_id=self.view.datarecord.stage_id&&self.view.datarecord.stage_id[0];var stage_data={id:current_stage_id,legend_normal:self.view.datarecord.legend_normal||undefined,legend_blocked:self.view.datarecord.legend_blocked||undefined,legend_done:self.view.datarecord.legend_done||undefined,};_.map(self.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='oe_kanban_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='oe_kanban_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},render_value:function(){this._super();this.states=this.prepare_dropdown_selection();var self=this;var current_state=_.find(this.states,function(state){return state.name===self.get('value');});this.$('.oe_kanban_status').removeClass('oe_kanban_status_red oe_kanban_status_green').addClass(current_state.state_class);var $items=$(QWeb.render('FormSelection.items',{states:_.without(this.states,current_state)}));var $dropdown=this.$el.find('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);},set_kanban_selection:function(ev){var self=this;ev.preventDefault();var li=$(ev.target).closest('li');if(li.length){var value=String(li.data('value'));if(this.view.get('actual_mode')==='view'){var write_values={};write_values[self.name]=value;return this.view.dataset._model.call('write',[[this.view.datarecord.id],write_values,self.view.dataset.get_context()]).done(self.reload_record.bind(self));}
else{return this.set_value(value);}}},reload_record:function(){this.view.reload();},});var FieldPriority=common.AbstractField.extend({events:{'mouseup':function(e){e.stopPropagation();},},start:function(){this.priority=new Priority(this,{readonly:this.get('readonly'),value:this.get('value'),values:this.field.selection||[],});this.priority.on('update',this,function(update){var view=this.view;if(view.get('actual_mode')==='view'){var write_values={};write_values[this.name]=update.value;view.dataset._model.call('write',[[view.datarecord.id],write_values,view.dataset.get_context()]).done(function(){view.reload();});}else{this.set_value(update.value);}});this.on('change:readonly',this,function(){this.priority.readonly=this.get('readonly');var $div=$('<div/>').insertAfter(this.$el);this.priority.replace($div);this.setElement(this.priority.$el);});var self=this;return $.when(this._super(),this.priority.appendTo('<div>').then(function(){self.priority.$el.addClass(self.$el.attr('class'));self.replaceElement(self.priority.$el);}));},render_value:function(){this.priority.set_value(this.get('value'));},});var FieldID=FieldChar.extend({process_modifiers:function(){this._super();this.set({readonly:true});},});var FieldEmail=FieldChar.extend({template:'FieldEmail',prefix:'mailto',init:function(){this._super.apply(this,arguments);this.clickable=true;},render_value:function(){this._super();if(this.get("effective_readonly")&&this.clickable){this.$el.attr('href',this.prefix+':'+this.get('value'));}}});var FieldUrl=FieldEmail.extend({render_value:function(){this._super();if(this.get("effective_readonly")){var tmp=this.get('value');var s=/(\w+):(.+)|^\.{0,2}\//.exec(tmp);if(!s){tmp="http://"+this.get('value');}
var text=this.get('value')?this.node.attrs.text||tmp:'';this.$el.attr('href',tmp).text(text);}}});var FieldFloat=FieldChar.extend({init:function(field_manager,node){this._super(field_manager,node);this.internal_set_value(0);if(this.node.attrs.digits){this.digits=this.node.attrs.digits;}else{this.digits=this.field.digits;}},initialize_content:function(){this._super();this.$el.addClass('o_form_field_number');},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
if(this.digits!==undefined&&this.digits.length===2){value_=utils.round_decimals(value_,this.digits[1]);}
this._super(value_);}});var FieldCharDomain=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:"FieldCharDomain",events:{'click button':'on_click','change .o_debug_input':function(e){this.set('value',$(e.target).val());}},init:function(){this._super.apply(this,arguments);this.debug=session.debug;},start:function(){var self=this;var tmp=this._super();if(this.options.model_field){this.field_manager.fields[this.options.model_field].on("change:value",this,function(){if(self.view&&self.view.record_loaded.state=="resolved"&&self.view.onchanges_mutex){self.view.onchanges_mutex.def.then(function(){self.render_value();});}});}
return tmp;},render_value:function(){var self=this;if(this.get('value')){var model=this.options.model||this.field_manager.get_field_value(this.options.model_field);try{var domain=pyeval.eval('domain',this.get('value'));}
catch(e){this.do_warn(_t('Error: Bad domain'),_t('The domain is wrong.'));return;}
var ds=new data.DataSetStatic(self,model,self.build_context());ds.call('search_count',[domain,ds.get_context()]).then(function(results){self.$('.o_count').text(results+' '+_t(' selected records'));if(self.get('effective_readonly')){self.$('button').text(_t('See selection '));}
else{self.$('button').text(_t('Change selection '));}
self.$('button').append($("<span/>").addClass('fa fa-arrow-right'));});if(this.debug){this.$('.o_debug_input').val(this.get('value'));}}else{this.$('.o_form_input').val('');this.$('.o_count').text(_t('No selected record'));var $arrow=this.$('button span').detach();this.$('button').text(_t('Select records ')).append($("<span/>").addClass('fa fa-arrow-right'));}},on_click:function(event){event.preventDefault();var self=this;var dialog=new common.DomainEditorDialog(this,{res_model:this.options.model||this.field_manager.get_field_value(this.options.model_field),default_domain:this.get('value'),title:this.get('effective_readonly')?_t('Selected records'):_t('Select records...'),readonly:this.get('effective_readonly'),disable_multiple_selection:this.get('effective_readonly'),no_create:this.get('effective_readonly'),on_selected:function(selected_ids){if(!self.get('effective_readonly')){self.set_value(dialog.get_domain(selected_ids));}}}).open();this.trigger("dialog_opened",dialog);return dialog;},});var FieldDate=common.AbstractField.extend(common.ReinitializeFieldMixin,{tagName:"span",className:"o_form_field_date",build_widget:function(){return new datepicker.DateWidget(this);},initialize_content:function(){if(this.datewidget){this.datewidget.destroy();this.datewidget=undefined;}
if(!this.get("effective_readonly")){this.datewidget=this.build_widget();this.datewidget.on('datetime_changed',this,function(){this.internal_set_value(this.datewidget.get_value());});var self=this;this.datewidget.appendTo('<div>').done(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self.replaceElement(self.datewidget.$el);self.datewidget.$input.addClass('o_form_input');self.setupFocus(self.datewidget.$input);});}},render_value:function(){if(this.get("effective_readonly")){this.$el.text(formats.format_value(this.get('value'),this,''));}else{this.datewidget.set_value(this.get('value'));}},is_syntax_valid:function(){return this.get("effective_readonly")||!this.datewidget||this.datewidget.is_valid();},is_false:function(){return this.get('value')===''||this._super();},focus:function(){if(!this.get("effective_readonly")){return this.datewidget.$input.focus();}
return false;},});var FieldDatetime=FieldDate.extend({build_widget:function(){return new datepicker.DateTimeWidget(this);},});var FieldText=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldText',events:{'keyup':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'keypress':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'change':'store_dom_value',},initialize_content:function(){if(!this.get("effective_readonly")){this.auto_sized=false;this.setupFocus(this.$el);}},commit_value:function(){if(!this.get("effective_readonly")){this.store_dom_value();}
return this._super();},store_dom_value:function(){this.internal_set_value(formats.parse_value(this.$el.val(),this));},render_value:function(){if(this.get("effective_readonly")){var txt=this.get("value")||'';this.$el.text(txt);}else{var show_value=formats.format_value(this.get('value'),this,'');this.$el.val(show_value);dom_utils.autoresize(this.$el,{parent:this});}},is_syntax_valid:function(){if(!this.get("effective_readonly")){try{formats.parse_value(this.$el.val(),this,'');}catch(e){return false;}}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function($el){if(!this.get("effective_readonly")){return this.$el.focus();}
return false;},set_dimensions:function(height,width){this.$el.css({width:width,minHeight:height,});},});var FieldBoolean=common.AbstractField.extend({template:'FieldBoolean',events:{'click':function(){this.internal_set_value(this.$checkbox.prop('checked'));}},start:function(){this.$checkbox=this.$('input');this.$checkbox.prop('disabled',this.get("effective_readonly"));this.on("change:effective_readonly",this,function(){this.$checkbox.prop('disabled',this.get("effective_readonly"));});this.setupFocus(this.$checkbox);return this._super();},render_value:function(){this.$checkbox.prop('checked',this.get('value'));},focus:function(){return this.$checkbox.focus();},set_dimensions:function(height,width){},is_false:function(){return false;},});var FieldBooleanButton=common.AbstractField.extend({className:'o_stat_info',init:function(){this._super.apply(this,arguments);switch(this.options["terminology"]){case"active":this.string_true=_t("Active");this.hover_true=_t("Deactivate");this.string_false=_t("Inactive");this.hover_false=_t("Activate");break;case"archive":this.string_true=_t("Active");this.hover_true=_t("Archive");this.string_false=_t("Archived");this.hover_false=_t("Unarchive");break;default:var terms=typeof this.options["terminology"]==='string'?{}:this.options["terminology"];this.string_true=_t(terms.string_true||"On");this.hover_true=_t(terms.hover_true||terms.string_false||"Switch Off");this.string_false=_t(terms.string_false||"Off");this.hover_false=_t(terms.hover_false||terms.string_true||"Switch On");}},render_value:function(){this._super();this.$el.html(QWeb.render("BooleanButton",{widget:this}));},is_false:function(){return false;},});var FieldProgressBar=common.AbstractField.extend(common.ReinitializeFieldMixin,{initialize_content:function(){if(this.progressbar){this.progressbar.destroy();}
this.progressbar=new ProgressBar(this,{readonly:this.get('effective_readonly'),edit_on_click:true,value:this.get('value')||0,});var self=this;this.progressbar.appendTo('<div>').done(function(){self.progressbar.$el.addClass(self.$el.attr('class'));self.replaceElement(self.progressbar.$el);self.progressbar.on('update',self,function(update){self.set('value',update.changed_value);});});},render_value:function(){this.progressbar.set_value(this.get('value'));},is_false:function(){return false;},});var FieldPercentPie=common.AbstractField.extend({template:'FieldPercentPie',start:function(){this.$left_mask=this.$('.o_mask').first();this.$right_mask=this.$('.o_mask').last();this.$pie_value=this.$('.o_pie_value');return this._super();},render_value:function(){var value=this.get('value')||0,degValue=360*value/100;this.$right_mask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$left_mask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$right_mask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pie_value.html(Math.round(value)+'%');},is_false:function(){return false;}});var FieldSelection=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldSelection',events:{'change':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.set("value",false);this.set("values",[]);this.records_orderer=new utils.DropMisordered();this.field_manager.on("view_content_has_changed",this,function(){var domain=new data.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});},initialize_field:function(){common.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_values);this.set("domain",new data.CompoundDomain(this.build_domain()).eval());this.on("change:values",this,this.render_value);},query_values:function(){var self=this;var def;if(this.field.type==="many2one"){var model=new Model(this.field.relation);def=model.call("name_search",['',this.get("domain")],{"context":this.build_context()});}else{var values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});def=$.when(values);}
this.records_orderer.add(def).then(function(values){if(!_.isEqual(values,self.get("values"))){self.set("values",values);}});},initialize_content:function(){if(!this.get('effective_readonly')){var ischanging=false;this.$el.change(function(){ischanging=true;}).click(function(){ischanging=false;}).keyup(function(e){if(e.which!==13||!ischanging){return;}
e.stopPropagation();ischanging=false;});this.setupFocus(this.$el);}},commit_value:function(){this.store_dom_value();return this._super();},store_dom_value:function(){if(!this.get('effective_readonly')){this.internal_set_value(JSON.parse(this.$el.val()));}},set_value:function(value_){value_=value_===null?false:value_;value_=value_ instanceof Array?value_[0]:value_;this._super(value_);},render_value:function(){var values=this.get("values");values=[[false,this.node.attrs.placeholder||'']].concat(values);var found=_.find(values,function(el){return el[0]===this.get("value");},this);if(!found){found=[this.get("value"),_t('Unknown')];values=[found].concat(values);}
if(!this.get("effective_readonly")){this.$el.empty();for(var i=0;i<values.length;i++){this.$el.append($('<option/>',{value:JSON.stringify(values[i][0]),html:values[i][1]}))}
this.$el.val(JSON.stringify(found[0]));}else{this.$el.text(found[1]);}},focus:function(){if(!this.get("effective_readonly")){return this.$el.focus();}
return false;},});var TimezoneMismatch=FieldSelection.extend({initialize_content:function(){this._super.apply(this,arguments);this.tz_offset_field=(this.options&&this.options.tz_offset_field)||this.tz_offset_field||'tz_offset';this.set({"tz_offset":this.field_manager.get_field_value(this.tz_offset_field)});this.on("change:tz_offset",this,this.render_value);},start:function(){this._super.apply(this,arguments);this.field_manager.on("field_changed:"+this.tz_offset_field,this,function(){this.set({"tz_offset":this.field_manager.get_field_value(this.tz_offset_field)});});},check_timezone:function(){var user_offset=this.get('tz_offset');if(user_offset){var offset=-(new Date().getTimezoneOffset());var browser_offset=(offset<0)?"-":"+";browser_offset+=_.str.sprintf("%02d",Math.abs(offset/60));browser_offset+=_.str.sprintf("%02d",Math.abs(offset%60));return(browser_offset!==user_offset);}
return false;},render_value:function(){this._super.apply(this,arguments);this.$label.next('.o_tz_warning').remove();if(this.check_timezone()){var options=_.extend({delay:{show:501,hide:0},title:_t("Timezone Mismatch : The timezone of your browser doesn't match the selected one. The time in Odoo is displayed according to your field timezone."),});$('<span/>').addClass('fa fa-exclamation-triangle o_tz_warning').insertAfter(this.$label).tooltip(options);}}});var LabelSelection=FieldSelection.extend({init:function(field_manager,node){this._super(field_manager,node);this.classes=this.options&&this.options.classes||{};},render_value:function(){this._super.apply(this,arguments);if(this.get("effective_readonly")){var bt_class=this.classes[this.get('value')]||'default';this.$el.html($('<span/>',{html:this.$el.html()}).addClass('label label-'+bt_class));}},});var FieldRadio=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:'FieldRadio',events:{'click input':'click_change_value'},init:function(field_manager,node){this._super(field_manager,node);this.selection=_.clone(this.field.selection)||[];this.domain=false;this.uniqueId=_.uniqueId("radio");},initialize_content:function(){this.field_manager.on("view_content_has_changed",this,this.get_selection);this.get_selection();},click_change_value:function(event){var val=$(event.target).val();val=this.field.type=="selection"?val:+val;if(val!==this.get_value()){this.set_value(val);}},get_selection:function(){var self=this;var selection=[];var def=$.Deferred();if(self.field.type=="many2one"){var domain=pyeval.eval('domain',this.build_domain())||[];if(!_.isEqual(self.domain,domain)){self.domain=domain;var ds=new data.DataSetStatic(self,self.field.relation,self.build_context());ds.call('search',[self.domain]).then(function(records){ds.name_get(records).then(function(records){selection=records;def.resolve();});});}else{selection=self.selection;def.resolve();}}
else if(self.field.type=="selection"){selection=self.field.selection||[];def.resolve();}
return def.then(function(){if(!_.isEqual(selection,self.selection)){self.selection=_.clone(selection);self.renderElement();self.render_value();}});},set_value:function(value_){if(this.field.type=="selection"){value_=_.find(this.field.selection,function(sel){return sel[0]==value_;});}
else if(!this.selection.length){this.selection=[value_];}
this._super(value_);},get_value:function(){var value=this.get('value');value=((value instanceof Array)?value[0]:value);return _.isUndefined(value)?false:value;},render_value:function(){var self=this;if(this.get('effective_readonly')){this.$el.html(this.get('value')?this.get('value')[1]:"");}else{this.$("input").prop("checked",false).filter(function(){return this.value==self.get_value();}).prop("checked",true);}}});var FieldReference=common.AbstractField.extend(common.ReinitializeFieldMixin,{className:'o_row',init:function(field_manager,node){this._super(field_manager,node);this.reference_ready=true;},destroy_content:function(){if(this.fm){this.fm.destroy();this.fm=undefined;}},initialize_content:function(){var self=this;this.fm=new common.DefaultFieldManager(this);this.fm.extend_field_desc({"selection":{selection:this.field_manager.get_field_desc(this.name).selection,type:"selection",},"m2o":{relation:null,type:"many2one",},});this.selection=new FieldSelection(this.fm,{attrs:{name:'selection',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.selection.on("change:value",this,this.on_selection_changed);this.selection.appendTo(this.$el);this.selection.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});var FieldMany2One=core.form_widget_registry.get('many2one');this.m2o=new FieldMany2One(this.fm,{attrs:{name:'Referenced Document',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),context:this.build_context().eval(),}});this.m2o.on("change:value",this,this.data_changed);this.m2o.appendTo(this.$el);this.m2o.on('focused',null,function(){self.trigger('focused');}).on('blurred',null,function(){self.trigger('blurred');});},on_selection_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),false]);this.render_value();}},data_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),this.m2o.get_value()]);}},set_value:function(val){if(val){val=val.split(',');val[0]=val[0]||false;val[1]=val[0]?(val[1]?parseInt(val[1],10):val[1]):false;}
this._super(val||[false,false]);},get_value:function(){return this.get('value')[0]&&this.get('value')[1]?(this.get('value')[0]+','+this.get('value')[1]):false;},render_value:function(){this.reference_ready=false;if(!this.get("effective_readonly")){this.selection.set_value(this.get('value')[0]);}
this.m2o.field.relation=this.get('value')[0];this.m2o.set_value(this.get('value')[1]);this.m2o.do_toggle(!!this.get('value')[0]);this.reference_ready=true;},is_false:function(){return!this.get_value();},});var FieldBinary=common.AbstractField.extend(common.ReinitializeFieldMixin,{init:function(field_manager,node){var self=this;this._super(field_manager,node);this.binary_value=false;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},stop:function(){if(!this.useFileAPI){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},initialize_content:function(){this.$inputFile=this.$('.o_form_input_file');this.$inputFile.change(this.on_file_change);var self=this;this.$('.o_select_file_button').click(function(){self.$inputFile.click();});this.$('.o_clear_file_button').click(this.on_clear);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$('form.o_form_binary_form input[name=session_id]').val(this.session.session_id);this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.binary_value=true;this.set_filename(name);this.set_value(file_base64);},on_save_as:function(ev){var value=this.get('value');if(!value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else{framework.blockUI();var c=crash_manager;var filename_fieldname=this.node.attrs.filename;var filename_field=this.view.fields&&this.view.fields[filename_fieldname];this.session.get_file({'url':'/web/content','data':{'model':this.view.dataset.model,'id':this.view.datarecord.id,'field':this.name,'filename_field':filename_fieldname,'filename':filename_field?filename_field.get('value'):null,'download':true,'data':utils.is_bin_size(value)?null:value,},'complete':framework.unblockUI,'error':c.rpc_error.bind(c)});ev.stopPropagation();}},set_filename:function(value){var filename=this.node.attrs.filename;if(filename){var field=this.field_manager.fields[filename];if(field){field.set_value(value);field._dirty_flag=true;}}},on_clear:function(){this.binary_value=false;this.set_filename('');this.set_value(false);}});var FieldBinaryFile=FieldBinary.extend({template:'FieldBinaryFile',initialize_content:function(){var self=this;this._super();if(this.get("effective_readonly")){this.$el.click(function(ev){if(self.get('value')&&self.view.datarecord.id){self.on_save_as(ev);}
return false;});}else{this.$input=this.$('.o_form_input').eq(0);this.$input.on('click',function(){self.$inputFile.click();});}},render_value:function(){var filename=this.view.datarecord[this.node.attrs.filename];if(this.get("effective_readonly")){this.do_toggle(!!this.get('value'));if(this.get('value')){this.$el.empty().append($("<span/>").addClass('fa fa-download'));if(this.view.datarecord.id){this.$el.css('cursor','pointer');}else{this.$el.css('cursor','not-allowed');}
if(filename){this.$el.append(" "+filename);}}}else{if(this.get('value')){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$input.val(filename||this.get('value'));}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}}}});var FieldBinaryImage=FieldBinary.extend({template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",render_value:function(){var url=this.placeholder;if(this.get('value')){if(!utils.is_bin_size(this.get('value'))){url='data:image/png;base64,'+this.get('value');}else{url=session.url('/web/image',{model:this.view.dataset.model,id:JSON.stringify(this.view.datarecord.id||null),field:(this.options.preview_image)?this.options.preview_image:this.name,unique:(this.view.datarecord.__last_update||'').replace(/[^0-9]/g,''),});}}
var $img=$(QWeb.render("FieldBinaryImage-img",{widget:this,url:url}));var self=this;$img.click(function(e){if(self.view.get("actual_mode")=="view"){var $button=$(".o_form_button_edit");$button.openerpBounce();e.stopPropagation();}});this.$('> img').remove();if(self.options.size){$img.css("width",""+self.options.size[0]+"px");$img.css("height",""+self.options.size[1]+"px");}
this.$el.prepend($img);$img.on('error',function(){self.on_clear();$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});},set_value:function(value_){var changed=value_!==this.get_value();this._super.apply(this,arguments);if(!changed){this.trigger("change:value",this,{oldValue:value_,newValue:value_});}},is_false:function(){return false;},set_dimensions:function(height,width){this.$el.css({maxWidth:width,minHeight:height,});},});var FieldStatus=common.AbstractField.extend({template:"FieldStatus",init:function(field_manager,node){this._super(field_manager,node);this.options.clickable=this.options.clickable||(this.node.attrs||{}).clickable||false;this.options.visible=this.options.visible||(this.node.attrs||{}).statusbar_visible||false;this.set({value:false});this.selection={'unfolded':[],'folded':[]};this.set("selection",{'unfolded':[],'folded':[]});this.selection_dm=new utils.DropMisordered();this.dataset=new data.DataSetStatic(this,this.field.relation,this.build_context());},start:function(){this.field_manager.on("view_content_has_changed",this,this.calc_domain);this.calc_domain();this.on("change:value",this,this.get_selection);this.on("change:evaluated_selection_domain",this,this.get_selection);this.on("change:selection",this,function(){this.selection=this.get("selection");this.render_value();});this.get_selection();if(this.options.clickable){this.bind_stage_click();}
this._super();},bind_stage_click:function(){this.$el.on('click','li[data-id]',this.on_click_stage);},set_value:function(value_){if(value_ instanceof Array){value_=value_[0];}
this._super(value_);},render_value:function(){var self=this;var content=QWeb.render("FieldStatus.content",{'widget':self,'value_folded':_.find(self.selection.folded,function(i){return i[0]===self.get('value');})});self.$el.html(content);},calc_domain:function(){var d=pyeval.eval('domain',this.build_domain());var domain=[];if(d.length){domain=['|',['id','=',this.get('value')]].concat(d);}
if(!_.isEqual(domain,this.get("evaluated_selection_domain"))){this.set("evaluated_selection_domain",domain);}},get_selection:function(){var self=this;var selection_unfolded=[];var selection_folded=[];var fold_field=this.options.fold_field;var calculation=_.bind(function(){if(this.field.type==="many2one"){return self.get_distant_fields().then(function(){return new data.DataSetSearch(self,self.field.relation,self.build_context(),self.get("evaluated_selection_domain")).read_slice(_.union(_.keys(self.distant_fields),['id']),{}).then(function(records){var ids=_.pluck(records,'id');return self.dataset.name_get(ids).then(function(records_name){_.each(records,function(record){var name=_.find(records_name,function(val){return val[0]===record.id;})[1];if(fold_field&&record[fold_field]&&record.id!==self.get('value')){selection_folded.push([record.id,name]);}else{selection_unfolded.push([record.id,name]);}});});});});}else{var select=this.field.selection;for(var i=0;i<select.length;i++){var key=select[i][0];if(key===this.get('value')||!this.options.visible||this.options.visible.indexOf(key)!==-1){selection_unfolded.push(select[i]);}}
return $.when();}},this);this.selection_dm.add(calculation()).then(function(){var selection={'unfolded':selection_unfolded,'folded':selection_folded};if(!_.isEqual(selection,self.get("selection"))){self.set("selection",selection);}});},get_distant_fields:function(){var self=this;if(!this.options.fold_field){this.distant_fields={};}
if(this.distant_fields){return $.when(this.distant_fields);}
return new Model(self.field.relation).call("fields_get",[[this.options.fold_field]]).then(function(fields){self.distant_fields=fields;return fields;});},on_click_stage:_.debounce(function(ev){var self=this;var $li=$(ev.currentTarget);var ul=$li.closest('.oe_form_field_status');if(this.view.is_disabled){return;}
var val;if(ul.attr('disabled')){return;}
if(this.field.type==="many2one"){val=parseInt($li.data("id"),10);}else{val=$li.data("id");}
if(val!==self.get('value')){if(!this.view.datarecord.id||this.view.datarecord.id.toString().match(data.BufferedDataSet.virtual_id_regex)){self.set_value(val);}
else{this.view.recursive_save().done(function(){var change={};change[self.name]=val;ul.attr('disabled',true);self.view.dataset.write(self.view.datarecord.id,change).done(function(){self.view.reload();}).always(function(){ul.removeAttr('disabled');});});}}},300,true),});var FieldMonetary=FieldFloat.extend({template:'FieldMonetary',init:function(){this._super.apply(this,arguments);this.set({"currency":false});var currency_field=(this.options&&this.options.currency_field)||this.field.currency_field||'currency_id';if(currency_field){this.field_manager.on("field_changed:"+currency_field,this,function(){this.set({"currency":this.field_manager.get_field_value(currency_field)});});}
this.on("change:currency",this,this.get_currency_info);this.get_currency_info();},start:function(){var tmp=this._super();this.on("change:currency_info",this,this.update);return tmp;},initialize_content:function(){if(!this.get('effective_readonly')){this.$input=this.$('input');this.add_symbol();}else{this.$input=undefined;}
this._super();},add_symbol:function(){var currency=this.get('currency_info');if(currency){var before=(currency.position==='before');this.$el[(before)?'prepend':'append']($('<span/>',{html:currency.symbol}));}},get_currency_info:function(){var self=this;if(this.get("currency")===false){this.set({"currency_info":null});return;}
return self.set({"currency_info":session.get_currency(self.get("currency"))});},update:function(){if(this.view.options.is_list_editable){return;}else{return this.reinitialize();}},render_value:function(){this._super();if(this.get('effective_readonly')){this.add_symbol();}},get_digits_precision:function(){return this.node.attrs.digits||this.field.digits||(this.get('currency_info')&&this.get('currency_info').digits);},parse_value:function(val,def){return formats.parse_value(val,{type:"float",digits:this.get_digits_precision()},def);},format_value:function(val,def){return formats.format_value(val,{type:"float",digits:this.get_digits_precision()},def);},});var StatInfo=common.AbstractField.extend({is_field_number:true,init:function(){this._super.apply(this,arguments);this.internal_set_value(0);},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
this._super.apply(this,[value_]);},render_value:function(){var options={value:this.get("value")||0,};if(!this.node.attrs.nolabel){if(this.options.label_field&&this.view.datarecord[this.options.label_field]){options.text=this.view.datarecord[this.options.label_field];}
else{options.text=this.string;}}
this.$el.html(QWeb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldToggleBoolean=common.AbstractField.extend({template:"toggle_button",events:{'click':'set_toggle_button'},render_value:function(){var class_name=this.get_value()?'o_toggle_button_success':'text-muted';this.$('i').attr('class',('fa fa-circle '+class_name));},set_toggle_button:function(){var self=this;var toggle_value=!this.get_value();if(this.view.get('actual_mode')=='view'){var rec_values={};rec_values[self.node.attrs.name]=toggle_value;return this.view.dataset._model.call('write',[[this.view.datarecord.id],rec_values,self.view.dataset.get_context()]).done(function(){self.reload_record();});}
else{this.set_value(toggle_value);}},reload_record:function(){this.view.reload();},is_false:function(){return false;},});var AceEditor=common.AbstractField.extend(common.ReinitializeFieldMixin,{template:"AceEditor",willStart:function(){if(!window.ace&&!this.loadJS_def){this.loadJS_def=ajax.loadJS('/web/static/lib/ace/ace.odoo-custom.js').then(function(){return $.when(ajax.loadJS('/web/static/lib/ace/mode-python.js'),ajax.loadJS('/web/static/lib/ace/mode-xml.js'));});}
return $.when(this._super(),this.loadJS_def);},initialize_content:function(){if(!this.get("effective_readonly")){var self=this;this.aceEditor=ace.edit(this.$('.ace-view-editor')[0]);this.aceEditor.setOptions({"maxLines":Infinity});this.aceEditor.$blockScrolling=true;var scrollIntoViewIfNeeded=_.throttle(function(){var node=self.aceEditor.renderer.textarea;if(node.scrollIntoViewIfNeeded){node.scrollIntoViewIfNeeded(false);}else{var offsetParent=node.offsetParent;while(offsetParent){var elY=0;var elH=node.offsetHeight+20;var parent=node;while(offsetParent&&parent){elY+=node.offsetTop;parent=node.parentNode;while(parent!=offsetParent&&(parent.tagName==="BODY"||["auto","scroll"].indexOf(window.getComputedStyle(parent).overflowY)===-1)){parent=parent.parentNode;}
node=parent;if(parent!==offsetParent){elY-=parent.offsetTop;parent=null;}
offsetParent=node.offsetParent;}
if((node.tagName==="BODY"||["auto","scroll"].indexOf(window.getComputedStyle(node).overflowY)!==-1)&&(node.scrollTop+node.clientHeight)<(elY+elH)){node.scrollTop=(elY+elH)-node.clientHeight;}}}});var $moveTextAreaToCursor=this.aceEditor.renderer.$moveTextAreaToCursor;self.aceEditor.renderer.$moveTextAreaToCursor=function(){$moveTextAreaToCursor.call(this);if(parseInt($(self.aceEditor.renderer.textarea).css('top'),10)>=0){scrollIntoViewIfNeeded();}};this.aceSession=this.aceEditor.getSession();this.aceSession.setUseWorker(false);this.aceSession.setMode("ace/mode/"+(this.options.mode||'xml'));this.aceEditor.on("blur",function(){if(self.aceSession.getUndoManager().hasUndo()){self.set_value(self.aceSession.getValue());}});}},destroy_content:function(){if(this.aceEditor){this.aceEditor.destroy();}},render_value:function(){if(!this.get("effective_readonly")){var value=formats.format_value(this.get('value'),this);this.aceSession.setValue(value);}else{var txt=this.get("value")||'';this.$(".oe_form_text_content").text(txt);}},focus:function(){return this.aceEditor.focus();},});core.form_widget_registry.add('char',FieldChar).add('id',FieldID).add('email',FieldEmail).add('url',FieldUrl).add('text',FieldText).add('char_domain',FieldCharDomain).add('date',FieldDate).add('datetime',FieldDatetime).add('selection',FieldSelection).add('radio',FieldRadio).add('reference',FieldReference).add('boolean',FieldBoolean).add('boolean_button',FieldBooleanButton).add('toggle_button',FieldToggleBoolean).add('float',FieldFloat).add('percentpie',FieldPercentPie).add('integer',FieldFloat).add('float_time',FieldFloat).add('progressbar',FieldProgressBar).add('image',FieldBinaryImage).add('binary',FieldBinaryFile).add('statusbar',FieldStatus).add('monetary',FieldMonetary).add('priority',FieldPriority).add('kanban_state_selection',KanbanSelection).add('statinfo',StatInfo).add('timezone_mismatch',TimezoneMismatch).add('label_selection',LabelSelection).add('ace',AceEditor);core.form_tag_registry.add('button',WidgetButton);return{FieldBoolean:FieldBoolean,FieldChar:FieldChar,FieldEmail:FieldEmail,FieldFloat:FieldFloat,FieldRadio:FieldRadio,FieldStatus:FieldStatus,FieldMonetary:FieldMonetary,WidgetButton:WidgetButton};});;

/* /web/static/src/js/views/form_upgrade_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_upgrade_widgets',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var form_widgets=require('web.form_widgets');var framework=require('web.framework');var Model=require('web.DataModel');var _t=core._t;var QWeb=core.qweb;var AbstractFieldUpgrade={events:{'click input':'on_click_input',},start:function(){this._super.apply(this,arguments);this.get_enterprise_label().after($("<span>",{text:"Enterprise",'class':"label label-primary oe_inline"}));},open_dialog:function(){var message=$(QWeb.render('EnterpriseUpgrade'));var buttons=[{text:_t("Upgrade now"),classes:'btn-primary',close:true,click:this.confirm_upgrade,},{text:_t("Cancel"),close:true,},];return new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{html:message,}),title:_t("Odoo Enterprise"),}).open();},confirm_upgrade:function(){new Model("res.users").call("search_count",[[["share","=",false]]]).then(function(data){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+data);});},get_enterprise_label:function(){},on_click_input:function(){},};var UpgradeBoolean=form_widgets.FieldBoolean.extend(AbstractFieldUpgrade,{template:"FieldUpgradeBoolean",get_enterprise_label:function(){return this.$label;},on_click_input:function(){if(this.$checkbox.prop("checked")){this.open_dialog().on('closed',this,function(){this.$checkbox.prop("checked",false);});}},});var UpgradeRadio=form_widgets.FieldRadio.extend(AbstractFieldUpgrade,{get_enterprise_label:function(){this.$('label').addClass('mr4');return this.$('label').last();},on_click_input:function(event){if($(event.target).val()==="1"){this.open_dialog().on('closed',this,function(){this.$('input').first().prop("checked",true);});}},});core.form_widget_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web/static/src/js/views/form_relational_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web.form_relational',function(require){"use strict";var ControlPanel=require('web.ControlPanel');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var common=require('web.form_common');var ListView=require('web.ListView');require('web.ListEditor');var Model=require('web.DataModel');var session=require('web.session');var utils=require('web.utils');var ViewManager=require('web.ViewManager');var _t=core._t;var QWeb=core.qweb;var COMMANDS=common.commands;var list_widget_registry=core.list_widget_registry;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent){this.name=parent.string;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),parent.string),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',click:function(e){if(this.$("input").val()!==''){this.getParent()._quick_create(this.$("input").val());this.close();}else{e.preventDefault();this.$("input").focus();}}},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.getParent()._search_create_popup("form",undefined,this.getParent()._create_context(this.$("input").val()));}},{text:_t('Cancel'),close:true}]});},start:function(){var text=_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),this.name);this.$("p").text(text);this.$("input").val(this.getParent().$input.val());},});var FieldMany2One=common.AbstractField.extend(common.CompletionFieldMixin,common.ReinitializeFieldMixin,{template:"FieldMany2One",events:{'keydown input':function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.stopPropagation();}},},init:function(field_manager,node){this._super(field_manager,node);common.CompletionFieldMixin.init.call(this);this.display_value={};this.display_value_backup={};this.last_search=[];this.floating=false;this.current_display=null;this.is_started=false;this.ignore_focusout=false;},reinit_value:function(val){this.internal_set_value(val);this.floating=false;if(this.is_started&&!this.no_rerender){this.render_value();}},initialize_field:function(){this.is_started=true;core.bus.on('click',this,function(){if(!this.get("effective_readonly")&&this.$input&&this.$input.autocomplete('widget').is(':visible')){this.$input.autocomplete("close");}});common.ReinitializeFieldMixin.initialize_field.call(this);},initialize_content:function(){if(!this.get("effective_readonly")){this.render_editable();}},destroy_content:function(){if(this.$dropdown){this.$dropdown.off('click');delete this.$dropdown;}
if(this.$input){if(this.$input.data('ui-autocomplete')){this.$input.autocomplete("destroy");}
this.$input.closest(".modal .modal-content").off('scroll');this.$input.off('keyup blur autocompleteclose autocompleteopen '+'focus focusout change keydown');delete this.$input;}
if(this.$follow_button){this.$follow_button.off('blur focus click');delete this.$follow_button;}},destroy:function(){this.destroy_content();return this._super();},init_error_displayer:function(){},hide_error_displayer:function(){},show_error_displayer:function(){new M2ODialog(this).open();},render_editable:function(){var self=this;this.$input=this.$("input");this.init_error_displayer();self.$input.on('focus',function(){self.hide_error_displayer();});this.$dropdown=this.$(".o_dropdown_button");this.$follow_button=this.$(".o_external_button");this.$follow_button.click(function(ev){ev.preventDefault();if(!self.get('value')){self.focus();return;}
var context=self.build_context().eval();var model_obj=new Model(self.field.relation);model_obj.call('get_formview_id',[[self.get("value")],context]).then(function(view_id){var pop=new common.FormViewDialog(self,{res_model:self.field.relation,res_id:self.get("value"),context:self.build_context(),title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write}).open();pop.on('write_completed',self,function(){self.display_value={};self.display_value_backup={};self.render_value();self.focus();self.trigger('changed_value');});});});var input_changed=function(){if(self.current_display!==self.$input.val()){self.current_display=self.$input.val();if(self.$input.val()===""){self.internal_set_value(false);self.floating=false;}else{self.floating=true;}}};this.$input.keydown(input_changed);this.$input.change(input_changed);this.$input.on('click',function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}else{if(self.get("value")&&!self.floating){self.$input.autocomplete("search","");}else{self.$input.autocomplete("search");}}});var close_autocomplete=_.debounce(function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}},50);this.$input.closest(".modal .modal-content").on('scroll',this,close_autocomplete);self.ed_def=$.Deferred();self.uned_def=$.Deferred();var ed_delay=200;var ed_duration=15000;var anyoneLoosesFocus=function(e){if(self.ignore_focusout){return;}
var used=false;if(self.floating){if(self.last_search.length>0){if(self.last_search[0][0]!=self.get("value")){self.display_value={};self.display_value_backup={};self.display_value[""+self.last_search[0][0]]=self.last_search[0][1];self.reinit_value(self.last_search[0][0]);self.last_search=[];}else{used=true;self.render_value();}}else{used=true;}
self.floating=false;}
var has_changed=(self.get("value")===false||self.display_value[""+self.get("value")]!==self.$input.val());if(used&&has_changed&&!self.no_ed&&!(self.options&&(self.options.no_create||self.options.no_quick_create))){self.ed_def.reject();self.uned_def.reject();self.ed_def=$.Deferred();self.ed_def.done(function(){self.can_create&&self.$input&&self.show_error_displayer();ignore_blur=false;self.trigger('focused');});ignore_blur=true;setTimeout(function(){self.ed_def.resolve();self.uned_def.reject();self.uned_def=$.Deferred();self.uned_def.done(function(){self.hide_error_displayer();});setTimeout(function(){self.uned_def.resolve();},ed_duration);},ed_delay);}else{self.no_ed=false;self.ed_def.reject();}};var ignore_blur=false;this.$input.on({focusout:anyoneLoosesFocus,focus:function(){self.trigger('focused');},autocompleteopen:function(){ignore_blur=true;},autocompleteclose:function(){setTimeout(function(){ignore_blur=false;},0);},blur:function(){if(ignore_blur){$(this).focus();return;}
if(_(self.getChildren()).any(function(child){return child instanceof common.ViewDialog;})){return;}
self.trigger('blurred');}});var isSelecting=false;this.$input.autocomplete({source:function(req,resp){self.get_search_result(req.term).done(function(result){resp(result);});},select:function(event,ui){isSelecting=true;var item=ui.item;if(item.id){self.display_value={};self.display_value_backup={};self.display_value[""+item.id]=item.name;self.reinit_value(item.id);}else if(item.action){item.action();self.trigger('focused');}
return false;},focus:function(e,ui){e.preventDefault();},autoFocus:true,html:true,minLength:0,delay:200,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.$input.keyup(function(e){if(e.which===13){if(isSelecting)
e.stopPropagation();}
isSelecting=false;});this.setupFocus(this.$follow_button);},render_value:function(no_recurse){var self=this;if(!this.get("value")){this.display_string(null);return;}
var display=this.display_value[""+this.get("value")];if(display){this.display_string(display);return;}
if(!no_recurse){var dataset=new data.DataSetStatic(this,this.field.relation,self.build_context());var def=this.alive(dataset.name_get([self.get("value")])).done(function(data){if(!data[0]){self.do_warn(_t("Render"),_.str.sprintf(_t("No value found for the field %s for value %s"),self.field.string,self.get("value")));return;}
self.display_value[""+self.get("value")]=data[0][1];self.render_value(true);}).fail(function(data,event){event.preventDefault();self.display_value[""+self.get("value")]=self.display_value_backup[""+self.get("value")];self.render_value(true);});if(this.view&&this.view.render_value_defs){this.view.render_value_defs.push(def);}}},display_string:function(str){var noValue=(str===null);if(!this.get("effective_readonly")){this.$input.val(noValue?"":(str.split("\n")[0].trim()||$(data.noDisplayContent).text()));this.current_display=this.$input.val();this.$follow_button.toggle(this.is_set());this.$el.toggleClass('o_with_button',!!this.$follow_button&&this.$follow_button.length>0&&this.is_set());}else{this.$el.html(noValue?"":(_.escape(str.trim()).split("\n").join("<br/>")||data.noDisplayContent));if(!this.options.no_open){this.$el.off('click');var execute_formview_action_once=_.once(this.execute_formview_action.bind(this));this.$el.click(function(ev){ev.preventDefault();execute_formview_action_once();});}}},execute_formview_action:function(){var self=this;var context=self.build_context().eval();(new Model(self.field.relation)).call('get_formview_action',[[self.get("value")],context]).then(function(action){self.do_action(action);});},set_value:function(value_){if(value_ instanceof Array){this.display_value={};this.display_value_backup={};if(!this.options.always_reload){this.display_value[""+value_[0]]=value_[1];}
else{this.display_value_backup[""+value_[0]]=value_[1];}
value_=value_[0];}
value_=value_||false;this.reinit_value(value_);},get_displayed:function(){return this.display_value[""+this.get("value")];},add_id:function(id){this.display_value={};this.display_value_backup={};this.reinit_value(id);},is_false:function(){return!this.get("value");},focus:function(){var input=!this.get('effective_readonly')&&this.$input&&this.$input[0];return input?input.focus():false;},_quick_create:function(){this.no_ed=true;this.ed_def.reject();return common.CompletionFieldMixin._quick_create.apply(this,arguments);},_search_create_popup:function(){this.no_ed=true;this.ed_def.reject();this.ignore_focusout=true;this.reinit_value(false);var res=common.CompletionFieldMixin._search_create_popup.apply(this,arguments);this.ignore_focusout=false;this.no_ed=false;return res;},});var AbstractManyField=common.AbstractField.extend({init:function(field_manager,node){var self=this;this._super(field_manager,node);this.dataset=new X2ManyDataSet(this,this.field.relation,this.build_context());this.dataset.x2m=this;this.dataset.parent_view=this.view;this.dataset.child_name=this.name;this.set('value',[]);this.starting_ids=[];this.mutex=new utils.Mutex();this.view.on("load_record",this,this._on_load_record);this.dataset.on('dataset_changed',this,function(){var options=_.clone(_.last(arguments));if(!_.isObject(options)||_.isArray(options)){options={};}
if(!self.internal_dataset_changed&&!options.internal_dataset_changed){self.trigger("change:commands",options);}});this.on("change:commands",this,function(options){self._inhibit_on_change_flag=!!options._inhibit_on_change_flag;self.set({'value':self.dataset.ids.slice()});self._inhibit_on_change_flag=false;});},set_value_from_record:function(record){this._super.apply(this,arguments);this.starting_ids=[];if(record.id&&record[this.name]&&(!isNaN(record.id)||record.id.indexOf(this.dataset.virtual_id_prefix)===-1)){this.starting_ids=this.get('value').slice();}},_on_load_record:function(record){this.trigger("load_record",record);},set_value:function(ids){ids=(ids||[]).slice();if(_.find(ids,function(id){return typeof(id)==="string";})){throw new Error("set_value of '"+this.name+"' must receive an list of ids without virtual ids.",ids);}
if(_.find(ids,function(id){return typeof(id)!=="number";})){return this.send_commands(ids,{'_inhibit_on_change_flag':this._inhibit_on_change_flag});}
this.dataset.reset_ids(ids);return $.when(this._super(ids));},internal_set_value:function(ids){if(_.isEqual(ids,this.get("value"))){return;}
var tmp=this.no_rerender;this.no_rerender=true;var def=this.data_replace(ids.slice());this.no_rerender=tmp;return def;},commit_value:function(){return this.mutex.def;},data_create:function(data,options){return this.send_commands([COMMANDS.create(data)],options);},data_update:function(id,data,options){return this.send_commands([COMMANDS.update(id,data)],options);},data_link:function(id,options){return this.send_commands([COMMANDS.link_to(id)],options);},data_link_multi:function(ids,options){return this.send_commands(_.map(ids,function(id){return COMMANDS.link_to(id);}),options);},data_delete:function(id){return this.send_commands([COMMANDS.delete(id)]);},data_forget:function(id){return this.send_commands([COMMANDS.forget(id)]);},data_replace:function(ids,options){return this.send_commands([COMMANDS.replace_with(ids)],options);},data_read:function(ids,fields,options){return this.dataset.read_ids(ids,fields,options);},send_commands:function(command_list,options){var self=this;var def=$.Deferred();var dataset=this.dataset;var res=true;options=options||{};var internal_options=_.extend({},options,{'internal_dataset_changed':true});_.each(command_list,function(command){self.mutex.exec(function(){var id=command[1];switch(command[0]){case COMMANDS.CREATE:var data=_.clone(command[2]);delete data.id;return dataset.create(data,internal_options).then(function(id){dataset.ids.push(id);res=id;});case COMMANDS.UPDATE:return dataset.write(id,command[2],internal_options).then(function(){if(dataset.ids.indexOf(id)===-1){dataset.ids.push(id);res=id;}});case COMMANDS.FORGET:return dataset.unlink([id]);case COMMANDS.DELETE:return dataset.unlink([id]);case COMMANDS.LINK_TO:if(dataset.ids.indexOf(id)===-1){return dataset.add_ids([id],internal_options);}
return;case COMMANDS.DELETE_ALL:return dataset.reset_ids([],{keep_read_data:true});case COMMANDS.REPLACE_WITH:dataset.ids=[];return dataset.alter_ids(command[2],internal_options);default:throw new Error("send_commands to '"+self.name+"' receive a non command value."+"\n"+JSON.stringify(command_list));}});});this.mutex.def.then(function(){self.trigger("change:commands",options);def.resolve(res);});return def;},get_value:function(){var self=this,is_one2many=this.field.type==="one2many",not_delete=this.options.not_delete,starting_ids=this.starting_ids.slice(),replace_with_ids=[],add_ids=[],command_list=[],id,index,record;_.each(this.get('value'),function(id){index=starting_ids.indexOf(id);if(index!==-1){starting_ids.splice(index,1);}
var record=self.dataset.get_cache(id);if(!_.isEmpty(record.changes)){var values=_.clone(record.changes);for(var k in values){if((values[k]instanceof Array)&&values[k].length===2&&typeof values[k][0]==="number"&&typeof values[k][1]==="string"){values[k]=values[k][0];}}
if(record.to_create){command_list.push(COMMANDS.create(values));}else{command_list.push(COMMANDS.update(record.id,values));}
return;}
if(!is_one2many||not_delete||self.dataset.delete_all){replace_with_ids.push(id);}else{command_list.push(COMMANDS.link_to(id));}});if((!is_one2many||not_delete||self.dataset.delete_all)&&(replace_with_ids.length||starting_ids.length)){_.each(command_list,function(command){if(command[0]===COMMANDS.UPDATE){replace_with_ids.push(command[1]);}});command_list.unshift(COMMANDS.replace_with(replace_with_ids));}
_.each(starting_ids,function(id){if(is_one2many&&!not_delete){command_list.push(COMMANDS.delete(id));}else if(is_one2many&&!self.dataset.delete_all){command_list.push(COMMANDS.forget(id));}});return command_list;},is_valid:function(){return this.mutex.def.state()==="resolved"&&this._super();},is_false:function(){return _(this.get('value')).isEmpty();},destroy:function(){this.view.off("load_record",this,this._on_load_record);this._super();}});var FieldX2Many=AbstractManyField.extend({multi_selection:false,disable_utility_classes:true,x2many_views:{},view_options:{},default_view:'tree',init:function(field_manager,node){this._super(field_manager,node);this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;this.is_started=false;this.set_value([]);},start:function(){this._super.apply(this,arguments);var self=this;this.load_views();var destroy=function(){self.is_loaded=self.is_loaded.then(function(){self.renderElement();self.viewmanager.destroy();return $.when(self.load_views()).done(function(){self.reload_current_view();});});};this.is_loaded.done(function(){self.on("change:effective_readonly",self,destroy);});this.view.on("on_button_cancel",this,destroy);this.is_started=true;this.reload_current_view();},load_views:function(){var self=this;var view_types=this.node.attrs.mode;view_types=!!view_types?view_types.split(","):[this.default_view];var views=[];_.each(view_types,function(view_type){if(!_.include(["list","tree","graph","kanban"],view_type)){throw new Error(_.str.sprintf(_t("View type '%s' is not supported in X2Many."),view_type));}
var view={view_id:false,view_type:view_type==="tree"?"list":view_type,fields_view:self.field.views&&self.field.views[view_type],options:{},};if(view.view_type==="list"){_.extend(view.options,{action_buttons:false,addable:null,selectable:self.multi_selection,sortable:true,import_enabled:false,deletable:true});if(self.get("effective_readonly")){_.extend(view.options,{deletable:null,reorderable:false,});}}else if(view.view_type==="kanban"){_.extend(view.options,{action_buttons:true,confirm_on_delete:false,});if(self.get("effective_readonly")){_.extend(view.options,{action_buttons:false,quick_creatable:false,creatable:false,read_only_mode:true,});}}
views.push(view);});this.views=views;this.viewmanager=new X2ManyViewManager(this,this.dataset,views,this.view_options,this.x2many_views);this.viewmanager.x2m=self;var def=$.Deferred().done(function(){self.initial_is_loaded.resolve();});this.viewmanager.on("controller_inited",self,function(view_type,controller){controller.x2m=self;if(view_type=="list"){if(self.get("effective_readonly")){controller.on('edit:before',self,function(e){e.cancel=true;});_(controller.columns).find(function(column){if(!(column instanceof list_widget_registry.get('field.handle'))){return false;}
column.modifiers.invisible=true;return true;});}}else if(view_type=="graph"){self.reload_current_view();}
def.resolve();});this.viewmanager.on("switch_mode",self,function(n_mode){$.when(self.commit_value()).done(function(){if(n_mode==="list"){utils.async_when().done(function(){self.reload_current_view();});}});});utils.async_when().done(function(){self.$el.addClass('o_view_manager_content');self.alive(self.viewmanager.attachTo(self.$el));});return def;},reload_current_view:function(){var self=this;self.is_loaded=self.is_loaded.then(function(){var view=self.get_active_view();if(view.type==="list"){view.controller.current_min=1;return view.controller.reload_content();}else if(view.controller.do_search){return view.controller.do_search(self.build_domain(),self.dataset.get_context(),[]);}},undefined);return self.is_loaded;},get_active_view:function(){return(this.viewmanager&&this.viewmanager.active_view);},set_value:function(value_){var self=this;this._super(value_).then(function(){if(self.is_started&&!self.no_rerender){return self.reload_current_view();}});},commit_value:function(){var view=this.get_active_view();if(view&&view.type==="list"&&view.controller.__focus){return $.when(this.mutex.def,view.controller._on_blur_one2many());}
return this.mutex.def;},is_syntax_valid:function(){var view=this.get_active_view();if(!view){return true;}
switch(this.viewmanager.active_view.type){case'form':return _(view.controller.fields).chain().invoke('is_valid').all(_.identity).value();case'list':return view.controller.is_valid();}
return true;},is_false:function(){return _(this.dataset.ids).isEmpty();},is_set:function(){return true;},});var X2ManyDataSet=data.BufferedDataSet.extend({get_context:function(){this.context=this.x2m.build_context();var self=this;_.each(arguments,function(context){self.context.add(context);});return this.context;},});var X2ManyViewManager=ViewManager.extend({custom_events:{'scrollTo':function(){},},init:function(parent,dataset,views,flags,x2many_views){flags=_.extend({},flags,{headless:false,search_view:false,action_buttons:true,pager:true,sidebar:false,});this.control_panel=new ControlPanel(parent,"X2ManyControlPanel");this.set_cp_bus(this.control_panel.get_bus());this._super(parent,dataset,views,flags);this.registry=core.view_registry.extend(x2many_views);},start:function(){this.control_panel.prependTo(this.$el);return this._super();},switch_mode:function(mode,unused){if(mode!=='form'){return this._super(mode,unused);}
var self=this;var id=self.x2m.dataset.index!==null?self.x2m.dataset.ids[self.x2m.dataset.index]:null;var pop=new common.FormViewDialog(this,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,create_function:function(data,options){return self.x2m.data_create(data,options);},write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:self.x2m.get("effective_readonly")}).open();pop.on("elements_selected",self,function(){self.x2m.reload_current_view();});},});var X2ManyListView=ListView.extend({is_valid:function(){if(!this.fields_view||!this.editable()){return true;}
if(_.isEmpty(this.records.records)){return true;}
var fields=this.editor.form.fields;var current_values={};_.each(fields,function(field){field._inhibit_on_change_flag=true;field.__no_rerender=field.no_rerender;field.no_rerender=true;current_values[field.name]=field.get('value');});var ids=_.map(this.records.records,function(item){return item.attributes.id;});var cached_records=_.filter(this.dataset.cache,function(item){return _.contains(ids,item.id)&&!_.isEmpty(item.values)&&!item.to_delete;});var valid=_.every(cached_records,function(record){_.each(fields,function(field){var value=record.values[field.name];field._inhibit_on_change_flag=true;field.no_rerender=true;field.set_value(_.isArray(value)&&_.isArray(value[0])?[COMMANDS.delete_all()].concat(value):value);});return _.every(fields,function(field){field.process_modifiers();field._check_css_flags();return field.is_valid();});});_.each(fields,function(field){field.set('value',current_values[field.name],{silent:true});field._inhibit_on_change_flag=false;field.no_rerender=field.__no_rerender;});return valid;},render_pager:function($node,options){options=_.extend(options||{},{single_page_hidden:true,});this._super($node,options);},display_nocontent_helper:function(){return false;},});var X2ManyList=ListView.List.extend({pad_table_to:function(count){if(!this.view.is_action_enabled('create')||this.view.x2m.get('effective_readonly')){this._super(count);return;}
this._super(count>0?count-1:0);var self=this;var columns=_(this.columns).filter(function(column){return column.invisible!=='1';}).length;if(this.options.selectable){columns++;}
if(this.options.deletable){columns++;}
var $cell=$('<td>',{colspan:columns,'class':'o_form_field_x2many_list_row_add'}).append($('<a>',{href:'#'}).text(_t("Add an item")).click(function(e){e.preventDefault();e.stopPropagation();var def;if(self.view.editable()){if(self.view.editor.form.__blur_timeout){clearTimeout(self.view.editor.form.__blur_timeout);self.view.editor.form.__blur_timeout=false;}
def=self.view.save_edition();}
$.when(def).done(self.view.do_add_record.bind(self));}));var $padding=this.$current.find('tr:not([data-id]):first');var $newrow=$('<tr>').append($cell);if($padding.length){$padding.before($newrow);}else{this.$current.append($newrow);}},});var One2ManyListView=X2ManyListView.extend({init:function(){this._super.apply(this,arguments);this.options=_.extend(this.options,{GroupsType:One2ManyGroups,ListType:X2ManyList});this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));core.bus.on('click',this,this._on_click_outside);this.dataset.on('dataset_changed',this,function(){this._dataset_changed=true;this.dataset.x2m._dirty_flag=true;});this.dataset.x2m.on('load_record',this,function(){this._dataset_changed=false;});this.on('warning',this,function(e){if(this.editable()){e.stop_propagation();}});},do_add_record:function(){if(this.editable()){this._super.apply(this,arguments);}else{var self=this;new common.SelectCreateDialog(this,{res_model:self.x2m.field.relation,domain:self.x2m.build_domain(),context:self.x2m.build_context(),title:_t("Create: ")+self.x2m.string,initial_view:"form",alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,create_function:function(data,options){return self.x2m.data_create(data,options);},read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},parent_view:self.x2m.view,child_name:self.x2m.name,form_view_options:{'not_interactible_on_create':true},on_selected:function(){self.x2m.reload_current_view();}}).open();}},do_activate_record:function(index,id){var self=this;new common.FormViewDialog(self,{res_model:self.x2m.field.relation,res_id:id,context:self.x2m.build_context(),title:_t("Open: ")+self.x2m.string,write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,parent_view:self.x2m.view,child_name:self.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||self.x2m.get("effective_readonly")}).open();},do_button_action:function(name,id,callback){if(!_.isNumber(id)){this.do_warn(_t("Action Button"),_t("The o2m record must be saved before an action can be used"));return;}
var parent_form=this.x2m.view;var self=this;this.save_edition().then(function(){if(parent_form){return parent_form.save();}else{return $.when();}}).done(function(){var ds=self.x2m.dataset;var changed_records=_.find(ds.cache,function(record){return record.to_create||record.to_delete||!_.isEmpty(record.changes);});if(!self.x2m.options.reload_on_button&&!changed_records){self.handle_button(name,id,callback);}else{self.handle_button(name,id,function(){self.x2m.view.reload();});}});},start_edition:function(record,options){if(!this.__focus){this._on_focus_one2many();}
return this._super(record,options);},reload_content:function(){var self=this;if(self.__focus){self._on_blur_one2many();return this._super().then(function(){var record_being_edited=self.records.get(self.editor.form.datarecord.id);if(record_being_edited){self.start_edition(record_being_edited);}});}
return this._super();},_on_focus_one2many:function(){if(!this.editor.is_editing()){return;}
this.dataset.x2m.internal_dataset_changed=true;this._dataset_changed=false;this.__focus=true;},_on_click_outside:function(e){if(this.__ignore_blur||!this.editor.is_editing()){return;}
var $target=$(e.target);var click_outside=($target.closest('.ui-autocomplete,.btn,.modal-backdrop').length===0);var $o2m=$target.closest(".o_list_editable");if($o2m.length&&$o2m[0]===this.el){click_outside=false;}
var $modal=$target.closest(".modal");if($modal.length){var $currentModal=this.$el.closest(".modal");if($currentModal.length===0||$currentModal[0]!==$modal[0]){click_outside=false;}}
if(click_outside){this._on_blur_one2many();}},_on_blur_one2many:function(){if(this.__ignore_blur){return $.when();}
this.__ignore_blur=true;this.__focus=false;this.dataset.x2m.internal_dataset_changed=false;var self=this;return this.save_edition(true).done(function(){if(self._dataset_changed){self.dataset.trigger('dataset_changed');}}).always(function(){self.__ignore_blur=false;});},_after_edit:function(){this.editor.form.on('blurred',this,this._on_blur_one2many);this.editor.form.widgetFocused();},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_blur_one2many);},do_delete:function(ids){var confirm=window.confirm;window.confirm=function(){return true;};try{return this._super(ids);}finally{window.confirm=confirm;}},reload_record:function(record,options){if(!options||!options.do_not_evict){this.dataset.evict_record(record.get('id'));}
return this._super(record);},});var One2ManyGroups=ListView.Groups.extend({setup_resequence_rows:function(){if(!this.view.x2m.get('effective_readonly')){this._super.apply(this,arguments);}}});var FieldOne2Many=FieldX2Many.extend({init:function(){this._super.apply(this,arguments);this.x2many_views={kanban:core.view_registry.get('one2many_kanban'),list:One2ManyListView,};},start:function(){this.$el.addClass('o_form_field_one2many');return this._super.apply(this,arguments);},commit_value:function(){var self=this;return this.is_loaded.then(function(){var view=self.viewmanager.active_view;if(view.type==="list"&&view.controller.editable()){return self.mutex.def.then(function(){return view.controller.save_edition();});}
return self.mutex.def;});},is_false:function(){return false;},});var Many2ManyListView=X2ManyListView.extend({init:function(){this._super.apply(this,arguments);this.options=_.extend(this.options,{ListType:X2ManyList,});this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));},do_add_record:function(){var self=this;new common.SelectCreateDialog(this,{res_model:this.model,domain:new data.CompoundDomain(this.x2m.build_domain(),["!",["id","in",this.x2m.dataset.ids]]),context:this.x2m.build_context(),title:_t("Add: ")+this.x2m.string,alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,no_create:this.x2m.options.no_create||!this.is_action_enabled('create'),on_selected:function(element_ids){return self.x2m.data_link_multi(element_ids).then(function(){self.x2m.reload_current_view();});}}).open();},do_activate_record:function(index,id){var self=this;var pop=new common.FormViewDialog(this,{res_model:this.model,res_id:id,context:this.x2m.build_context(),title:_t("Open: ")+this.x2m.string,alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,readonly:!this.is_action_enabled('edit')||self.x2m.get("effective_readonly"),}).open();pop.on('write_completed',self,function(){self.dataset.evict_record(id);self.reload_content();});},do_button_action:function(name,id,callback){var self=this;var _sup=_.bind(this._super,this);if(!this.x2m.options.reload_on_button){return _sup(name,id,callback);}else{return this.x2m.view.save().then(function(){return _sup(name,id,function(){self.x2m.view.reload();});});}},_after_edit:function(){this.editor.form.on('blurred',this,this._on_blur_many2many);},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_blur_many2many);},_on_blur_many2many:function(){return this.save_edition().done(function(){if(self._dataset_changed){self.dataset.trigger('dataset_changed');}});},});var FieldMany2Many=FieldX2Many.extend({init:function(){this._super.apply(this,arguments);this.x2many_views={list:Many2ManyListView,kanban:core.view_registry.get('many2many_kanban'),};},start:function(){this.$el.addClass('o_form_field_many2many');return this._super.apply(this,arguments);}});var FieldMany2ManyKanban=FieldMany2Many.extend({default_view:'kanban',init:function(){this._super.apply(this,arguments);this.view_options=_.extend({},this.view_options,{'create_text':_t("Add"),});}});var FieldMany2ManyTags=AbstractManyField.extend(common.CompletionFieldMixin,common.ReinitializeFieldMixin,{className:"o_form_field_many2manytags",tag_template:"FieldMany2ManyTag",events:{'click .o_delete':function(e){this.remove_id($(e.target).parent().data('id'));},'click .badge':'open_color_picker','mousedown .o_colorpicker span':'update_color','focusout .o_colorpicker':'close_color_picker',},init:function(field_manager,node){this._super(field_manager,node);common.CompletionFieldMixin.init.call(this);this.set({"value":[]});},willStart:function(){var self=this;return this.dataset.call('fields_get',[]).then(function(fields){self.fields=fields;});},commit_value:function(){this.dataset.cancel_read();return this._super();},initialize_content:function(){if(!this.get("effective_readonly")){this.many2one=new FieldMany2One(this.field_manager,this.node);this.many2one.options.no_open=true;this.many2one.on('changed_value',this,function(){var newValue=this.many2one.get('value');if(newValue){this.add_id(newValue);this.many2one.set({'value':false});}});this.many2one.prependTo(this.$el);var self=this;this.many2one.$('input').on('keydown',function(e){if(!$(e.target).val()&&e.which===8){var $badges=self.$('.badge');if($badges.length){self.remove_id($badges.last().data('id'));}}});this.many2one.get_search_blacklist=function(){return self.get('value');};}},destroy_content:function(){if(this.many2one){this.many2one.destroy();this.many2one=undefined;}},get_render_data:function(ids){this.dataset.cancel_read();var fields=this.fields.color?['display_name','name','color']:['display_name','name'];return this.dataset.read_ids(ids,fields);},render_tag:function(data){this.$('.badge').remove();this.$el.prepend(QWeb.render(this.tag_template,{elements:data,readonly:this.get('effective_readonly')}));},render_value:function(){var self=this;var values=this.get("value");var handle_names=function(_data){_.each(_data,function(el){el.display_name=el.display_name.trim()?_.str.escapeHTML(el.display_name):data.noDisplayContent;});self.render_tag(_data);};if(!values||values.length>0){return this.alive(this.get_render_data(values)).done(handle_names);}else{handle_names([]);}},add_id:function(id){this.set({'value':_.uniq(this.get('value').concat([id]))});},remove_id:function(id){this.set({'value':_.without(this.get("value"),id)});},focus:function(){if(!this.get("effective_readonly")){return this.many2one.focus();}
return false;},set_dimensions:function(height,width){if(this.many2one){this.many2one.$el.css('height','auto');}
this.$el.css({width:width,minHeight:height,});if(this.many2one){this.many2one.$el.css('height',this.$el.height());}},open_color_picker:function(ev){if(this.fields.color){this.$color_picker=$(QWeb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':$(ev.currentTarget).data('id'),}));$(ev.currentTarget).append(this.$color_picker);this.$color_picker.dropdown('toggle');this.$color_picker.attr("tabindex",1).focus();}},close_color_picker:function(){this.$color_picker.remove();},update_color:function(ev){ev.preventDefault();var color=$(ev.currentTarget).data('color');var id=$(ev.currentTarget).data('id');var self=this;this.dataset.call('write',[id,{'color':color}]).done(function(){self.dataset.cache[id].from_read={};self.dataset.evict_record(id);var tag=self.$el.find("span.badge[data-id='"+id+"']");var old_color=tag.data('color');tag.removeClass('o_tag_color_'+old_color);tag.data('color',color);tag.addClass('o_tag_color_'+color);});},});var FieldMany2ManyBinaryMultiFiles=AbstractManyField.extend(common.ReinitializeFieldMixin,{template:"FieldBinaryFileUploader",events:{'click .o_attach':function(e){this.$('.o_form_input_file').click();},'change .o_form_input_file':function(e){e.stopPropagation();var $target=$(e.target);var value=$target.val();if(value!==''){if(this.data[0]&&this.data[0].upload){return false;}
var filename=value.replace(/.*[\\\/]/,'');for(var id in this.get('value')){if(this.data[id]&&(this.data[id].filename||this.data[id].name)==filename&&!this.data[id].no_unlink){this.ds_file.unlink([id]);}}
if(this.node.attrs.blockui>0){framework.blockUI();}
this.$('form.o_form_binary_form').submit();this.$(".oe_fileupload").hide();this.data[0]={id:0,name:filename,filename:filename,url:'',upload:true,};}},'click .oe_delete':function(e){e.preventDefault();e.stopPropagation();var file_id=$(e.currentTarget).data("id");if(file_id){var files=_.without(this.get('value'),file_id);if(!this.data[file_id].no_unlink){this.ds_file.unlink([file_id]);}
this.set({'value':files});}},},init:function(field_manager,node){this._super.apply(this,arguments);this.session=session;if(this.field.type!="many2many"||this.field.relation!='ir.attachment'){throw _.str.sprintf(_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model."),this.field.string);}
this.data={};this.set_value([]);this.ds_file=new data.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,_.bind(this.on_file_loaded,this));},get_file_url:function(attachment){return'/web/content/'+attachment.id+'?download=true';},read_name_values:function(){var self=this;var ids=this.get('value');var _value=_.filter(ids,function(id){return self.data[id]===undefined;});if(_value.length){return this.ds_file.call('read',[_value,['id','name','datas_fname','mimetype']]).then(process_data);}else{return $.when(ids);}
function process_data(datas){_.each(datas,function(data){data.no_unlink=true;data.url=self.get_file_url(data);self.data[data.id]=data;});return ids;}},render_value:function(){var self=this;this.read_name_values().then(function(ids){self.$('.oe_placeholder_files, .oe_attachments').replaceWith($(QWeb.render('FieldBinaryFileUploader.files',{'widget':self,'values':ids})));var $input=self.$('.o_form_input_file');$input.after($input.clone(true)).remove();self.$(".oe_fileupload").show();self.$(".o_image[data-mimetype^='image']").each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});});},on_file_loaded:function(e,result){if(this.node.attrs.blockui>0){framework.unblockUI();}
if(result.error||!result.id){this.do_warn(_t('Uploading Error'),result.error);delete this.data[0];}else{if(this.data[0]&&this.data[0].filename===result.filename&&this.data[0].upload){delete this.data[0];}
result.url=this.get_file_url(result);this.data[result.id]=result;var values=_.clone(this.get('value'));values.push(result.id);this.set({value:values});}
this.render_value();},});var FieldMany2ManyCheckBoxes=AbstractManyField.extend(common.ReinitializeFieldMixin,{className:"oe_form_many2many_checkboxes",init:function(){this._super.apply(this,arguments);this.set("records",[]);this.field_manager.on("view_content_has_changed",this,function(){var domain=new data.CompoundDomain(this.build_domain()).eval();if(!_.isEqual(domain,this.get("domain"))){this.set("domain",domain);}});this.records_orderer=new utils.DropMisordered();},initialize_field:function(){common.ReinitializeFieldMixin.initialize_field.call(this);this.on("change:domain",this,this.query_records);this.set("domain",new data.CompoundDomain(this.build_domain()).eval());this.on("change:records",this,this.render_value);},query_records:function(){var self=this;var model=new Model(this.field.relation);this.records_orderer.add(model.call("search",[this.get("domain")],{"context":this.build_context()}).then(function(record_ids){return model.call("name_get",[record_ids],{"context":self.build_context()});})).then(function(res){self.set("records",res);});},render_value:function(){this.$el.html(QWeb.render("FieldMany2ManyCheckBoxes",{widget:this}));var $inputs=this.$("input");$inputs.change(_.bind(this.from_dom,this));if(this.get("effective_readonly")){$inputs.attr("disabled","true");}},from_dom:function(){var new_value=this.$("input:checked").map(function(){return+$(this).data("record-id");}).get();if(!_.isEqual(new_value,this.get("value"))){this.internal_set_value(new_value);}},is_false:function(){return false;},is_set:function(){return true;},});core.form_widget_registry.add('many2one',FieldMany2One).add('many2many',FieldMany2Many).add('many2many_tags',FieldMany2ManyTags).add('many2many_kanban',FieldMany2ManyKanban).add('one2many',FieldOne2Many).add('one2many_list',FieldOne2Many).add('many2many_binary',FieldMany2ManyBinaryMultiFiles).add('many2many_checkboxes',FieldMany2ManyCheckBoxes);core.one2many_view_registry.add('list',One2ManyListView);return{FieldMany2ManyTags:FieldMany2ManyTags,AbstractManyField:AbstractManyField,FieldMany2One:FieldMany2One,};});;

/* /web/static/src/js/views/list_view_editable.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListEditor',function(require){"use strict";var core=require('web.core');var data=require('web.data');var FormView=require('web.FormView');var common=require('web.list_common');var ListView=require('web.ListView');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var Editor=Widget.extend({init:function(parent,options){this._super(parent);this.options=options||{};_.defaults(this.options,{formView:FormView,delegate:this.getParent(),});this.delegate=this.options.delegate;this.record=null;},start:function(){var self=this;var form_fields_view=this._validate_view(this.delegate.edition_view(this));this.form=new(this.options.formView)(this,this.delegate.dataset,form_fields_view,{initial_mode:'edit',is_list_editable:true,disable_autofocus:true,$buttons:$(),$pager:$(),});return $.when(this._super(),this.form.appendTo($('<div/>')).then(function(){self.form.$el.addClass(self.$el.attr('class'));self.replaceElement(self.form.$el);}).done(this.proxy('do_hide')));},_validate_view:function(edition_view){if(!edition_view){throw new Error("editor delegate's #edition_view must return a view descriptor");}
var arch=edition_view.arch;if(!(arch&&arch.children instanceof Array)){throw new Error("Editor delegate's #edition_view must have a non-empty arch");}
if(arch.tag!=="form"){throw new Error("Editor delegate's #edition_view must have a 'form' root node");}
if(!(arch.attrs&&arch.attrs.version==="7.0")){throw new Error("Editor delegate's #edition_view must be a version 7 view");}
if(!/\bo_list_editable_form\b/.test(arch.attrs['class'])){throw new Error("Editor delegate's #edition_view must have the class "+"'o_list_editable_form' on its root element");}
return edition_view;},is_editing:function(){return!!this.record;},is_creating:function(){return(this.is_editing()&&!this.record.id);},edit:function(record,configureField){var self=this;var loaded;if(record){this.form.trigger('load_record',_.extend({},record));loaded=this.form.record_loaded;}else{loaded=this.form.load_defaults().then(function(){return self.form.record_loaded;});}
return loaded.then(function(){return self.do_show({reload:false});}).then(function(){self.record=self.form.datarecord;_(self.form.fields).each(function(field,name){configureField(name,field);});return self.form;});},save:function(){var self=this;return this.form.save(this.delegate.prepends_on_create()).then(function(result){if(result.created&&!self.record.id){self.record.id=result.result;}
return self.record;});},cancel:function(force){var self=this;if(force){return do_cancel();}
var message=_t("The line has been modified, your changes will be discarded. Are you sure you want to discard the changes ?");return this.form.can_be_discarded(message).then(do_cancel);function do_cancel(){var record=self.record;self.record=null;self.do_hide();return $.when(record);}},do_hide:function(){this.form.do_hide.apply(this.form,arguments);this.form.set({display_invalid_fields:false});},do_show:function(){this.form.do_show.apply(this.form,arguments);},});ListView.prototype.defaults.editable=null;ListView.include({init:function(){var self=this;this._super.apply(this,arguments);this.saving_mutex=new utils.Mutex();this._force_editability=null;this._context_editable=false;this.editor=new Editor(this);this.fields_for_resize=[];core.bus.on('resize',this,this.resize_fields);$(this.groups).bind({'edit':function(e,id,dataset){self.do_edit(dataset.index,id,dataset);},'saved':function(){if(self.groups.get_selection().length){return;}
self.configure_pager(self.dataset);self.compute_aggregates();}});this.records.bind('remove',function(){if(self.editor.is_editing()){self.cancel_edition();}});this.on('edit:before',this,function(event){if(!self.editable()||self.editor.is_editing()){event.cancel=true;}});this.on('edit:after',this,function(){self.$el.add(self.$buttons).addClass('o-editing');self.$('.ui-sortable').sortable('disable');});this.on('save:after cancel:after',this,function(){self.$('.ui-sortable').sortable('enable');self.$el.add(self.$buttons).removeClass('o-editing');});},destroy:function(){core.bus.off('resize',this,this.resize_fields);this._super();},do_hide:function(){if(this.editor.is_editing()){this.cancel_edition(true);}
this._super();},sort_by_column:function(e){e.stopPropagation();if(!this.editor.is_editing()){this._super.apply(this,arguments);}},do_edit:function(index,id,dataset){_.extend(this.dataset,dataset);},do_delete:function(ids){var nonfalse=_.compact(ids);var _super=this._super.bind(this);var next=(this.editor.is_editing())?this.cancel_edition(true):$.when();return next.then(function(){return _super(nonfalse);});},editable:function(){return!this.grouped&&!this.options.disable_editable_mode&&(this.fields_view.arch.attrs.editable||this._context_editable||this.options.editable);},do_search:function(domain,context,group_by){var self=this;var _super=this._super;var args=arguments;var ready=(this.editor.is_editing())?this.cancel_edition(true):$.when();return ready.then(function(){self._context_editable=!!context.set_editable;return _super.apply(self,args);});},do_add_record:function(){if(this.editable()){this.$('table:first').show();this.$('.oe_view_nocontent').remove();this.start_edition();}else{this._super.apply(this,arguments);}},load_list:function(data,grouped){var result=this._super.apply(this,arguments);this.editor.destroy();this.editor=new Editor(this);if(this.editable()){this.$el.addClass('o_list_editable');return $.when(result,this.editor.prependTo(this.$el).done(this.proxy('setup_events')));}else{this.$el.removeClass('o_list_editable');}
return result;},render_buttons:function(){var add_button=!this.$buttons;var result=this._super.apply(this,arguments);if(add_button&&(this.editable()||this.grouped)){var self=this;this.$buttons.off('click','.o_list_button_save').on('click','.o_list_button_save',this.proxy('save_edition')).off('click','.o_list_button_discard').on('click','.o_list_button_discard',function(e){e.preventDefault();self.cancel_edition();});}
return result;},do_button_action:function(name,id,callback){var self=this;this.save_edition().done(function(data){if(!id&&data.created){id=data.record.get('id');}
self.handle_button(name,id,callback);});},make_empty_record:function(id){var attrs={id:id};_(this.columns).chain().filter(function(x){return x.tag==='field';}).pluck('name').each(function(field){attrs[field]=false;});return new common.Record(attrs);},start_edition:function(record,options){var self=this;var item=false;if(record){item=record.attributes;this.dataset.select_id(record.get('id'));}else{record=this.make_empty_record(false);this.records.add(record,{at:(this.prepends_on_create())?0:null});}
return this.save_edition().then(function(){return $.when.apply($,self.editor.form.render_value_defs);}).then(function(){var $recordRow=self.groups.get_row_for(record);var cells=self.get_cells_for($recordRow);var fields={};self.fields_for_resize.splice(0,self.fields_for_resize.length);return self.with_event('edit',{record:record.attributes,cancel:false,},function(){return self.editor.edit(item,function(field_name,field){var cell=cells[field_name];if(!cell){return;}
field.$el.attr('data-fieldname',field_name);fields[field_name]=field;self.fields_for_resize.push({field:field,cell:cell});},options).then(function(){$recordRow.addClass('o_row_edition');self.resize_fields();var is_focusable=function(field){return field&&field.$el.is(':visible:not(.o_readonly)');};var focus_field=options&&options.focus_field?options.focus_field:undefined;if(!is_focusable(fields[focus_field])){focus_field=_.find(self.editor.form.fields_order,function(field){return is_focusable(fields[field]);});}
if(fields[focus_field]){fields[focus_field].$el.find('input, textarea').andSelf().filter('input, textarea').select();}
return record.attributes;});}).fail(function(){if(!record.get('id')){self.records.remove(record);}});},function(){return $.Deferred().resolve();});},get_cells_for:function($row){var cells={};$row.children('td').each(function(index,el){cells[el.getAttribute('data-field')]=el;});return cells;},resize_fields:function(){if(!this.editor.is_editing()){return;}
for(var i=0,len=this.fields_for_resize.length;i<len;i++){var item=this.fields_for_resize[i];this.resize_field(item.field,item.cell);}},resize_field:function(field,cell){var $cell=$(cell);field.set_dimensions($cell.outerHeight(),$cell.outerWidth());position_element(field.$el,'left top');position_element(field.$translate,'right top');if(field.get('effective_readonly')){field.$el.addClass('o_readonly');}
if(field.widget=="handle"){field.$el.addClass('o_row_handle');}
if(window.getComputedStyle(field.el.parentElement).webkitOverflowScrolling){field.el.style.zIndex=1;}
function position_element($el,pos){$el.addClass('o_temp_visible').css({top:0,left:0}).position({my:pos,at:pos,of:$cell,}).removeClass('o_temp_visible');}},save_edition:function(cancel_onfail){var self=this;return self.saving_mutex.exec(function(){if(!self.editor.is_editing()){return $.when();}
return self.with_event('save',{editor:self.editor,form:self.editor.form,cancel:false,},function(){return self.editor.save().then(function(attrs){var created=false;var record=self.records.get(attrs.id);if(!record){created=true;record=self.records.find(function(r){return!r.get('id');}).set('id',attrs.id);}
return self.cancel_edition(true).then(function(){return self.handle_onwrite(record);}).then(function(){return self.reload_record(record);}).then(function(){return{created:created,record:record};});},function(){if(cancel_onfail){return self.cancel_edition();}});});});},cancel_edition:function(force){var self=this;return this.with_event('cancel',{editor:this.editor,form:this.editor.form,cancel:false},function(){return this.editor.cancel(force).then(function(attrs){if(attrs.id){var record=self.records.get(attrs.id);if(!record){return;}
return self.reload_record(record,{do_not_evict:true});}
var to_delete=self.records.find(function(r){return!r.get('id');});if(to_delete){self.records.remove(to_delete);}});});},with_event:function(event_name,event,action){var self=this;event=event||{};this.trigger(event_name+':before',event);if(event.cancel){return $.Deferred().reject({message:_.str.sprintf("Event %s:before cancelled",event_name)});}
return $.when(action.call(this)).done(function(){self.trigger.apply(self,[event_name+':after'].concat(_.toArray(arguments)));});},edition_view:function(editor){var view=$.extend(true,{},this.fields_view);view.arch.tag='form';_.extend(view.arch.attrs,{'class':'o_list_editable_form',version:'7.0'});_(view.arch.children).chain().zip(_(this.columns).filter(function(c){return!(c instanceof ListView.MetaColumn);})).each(function(ar){var widget=ar[0],column=ar[1];var modifiers=_.extend({},column.modifiers);widget.attrs.nolabel=true;if(modifiers['tree_invisible']||widget.tag==='button'){modifiers.invisible=true;}
widget.attrs.modifiers=JSON.stringify(modifiers);});return view;},handle_onwrite:function(source_record){var self=this;var on_write_callback=self.fields_view.arch.attrs.on_write;if(!on_write_callback){return $.when();}
var context=new data.CompoundContext(self.dataset.get_context(),{'on_write_domain':self.dataset.domain}).eval();return this.dataset.call(on_write_callback,[source_record.get('id'),context]).then(function(ids){return $.when.apply(null,_(ids).map(_.bind(self.handle_onwrite_record,self,source_record)));});},handle_onwrite_record:function(source_record,id){var record=this.records.get(id);if(!record){var index=this.records.indexOf(source_record)+1;record=this.make_empty_record(id);this.records.add(record,{at:index});}
return this.reload_record(record);},prepends_on_create:function(){return(this.editable()==='top');},setup_events:function(){var self=this;_.each(this.editor.form.fields,function(field,field_name){field.on("change:effective_readonly",self,function(){var item=_(self.fields_for_resize).find(function(item){return item.field===field;});if(item){setTimeout(function(){self.resize_field(item.field,item.cell);},0);}});});this.editor.$el.on('keyup keypress keydown',function(e){if(!self.editor.is_editing()){return true;}
var key=_($.ui.keyCode).chain().map(function(v,k){return{name:k,code:v};}).find(function(o){return o.code===e.which;}).value();if(!key){return true;}
var method=e.type+'_'+key.name;if(!(method in self)){return true;}
return self[method](e);});},_next:function(next_record,options){options=options||{};next_record=next_record||'succ';var self=this;return this.save_edition().then(function(saveInfo){if(!saveInfo){return null;}
if(saveInfo.created){return self.start_edition();}
if(!options){options={};}
options.wraparound=!self.is_action_enabled('create');var record=self.records[next_record](saveInfo.record,options);if(record===undefined){return self.start_edition();}
return self.start_edition(record,options);});},keyup_ENTER:function(){return this._next();},keydown_ESCAPE:function(e){return false;},keyup_ESCAPE:function(e){return this.cancel_edition();},_text_selection_range:function(el){var selectionStart;try{selectionStart=el.selectionStart;}catch(e){return null;}
if(selectionStart!==undefined){return{start:selectionStart,end:el.selectionEnd};}else if(document.body.createTextRange){throw new Error("Implement text range handling for MSIE");}
return null;},_text_cursor:function(el){var selection=this._text_selection_range(el);if(!selection){return null;}
if(selection.start!==selection.end){return{position:null,collapsed:false};}
return{position:selection.start,collapsed:true};},_at_start:function(cursor,el){return cursor.collapsed&&(cursor.position===0);},_at_end:function(cursor,el){return cursor.collapsed&&(cursor.position===el.value.length);},_key_move_record:function(event,record_direction,is_valid_move){if(!this.editor.is_editing()||this.editor.is_creating()){return $.when();}
var cursor=this._text_cursor(event.target);if(cursor&&!is_valid_move(event.target,cursor)){return $.when();}
event.preventDefault();var source_field=$(event.target).closest('[data-fieldname]').attr('data-fieldname');return this._next(record_direction,{focus_field:source_field});},keyup_UP:function(e){var self=this;return this._key_move_record(e,'pred',function(el,cursor){return self._at_start(cursor,el)&&!$(el).is('select,.ui-autocomplete-input');});},keyup_DOWN:function(e){var self=this;return this._key_move_record(e,'succ',function(el,cursor){return self._at_end(cursor,el)&&!$(el).is('select,.ui-autocomplete-input');});},keydown_LEFT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_start(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(--field_index<0){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_RIGHT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_end(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(++field_index>=fields_order.length){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_TAB:function(e){var form=this.editor.form;var last_field=_(form.fields_order).chain().map(function(name){return form.fields[name];}).filter(function(field){return field.$el.is(':visible')&&!field.get('effective_readonly');}).last().value();if(last_field&&$(e.target).closest(last_field.el).length){e.preventDefault();return this._next();}
this.editor.form.__clicked_inside=true;return $.when();},});ListView.Groups.include({passthrough_events:ListView.Groups.prototype.passthrough_events+" edit saved",get_row_for:function(record){return _(this.children).chain().invoke('get_row_for',record).compact().first().value();}});ListView.List.include({row_clicked:function(event){if(!this.view.editable()||!this.view.is_action_enabled('edit')){return this._super.apply(this,arguments);}
if(this.__is_starting_edition){return;}
this.__is_starting_edition=true;var self=this;var args=arguments;var _super=self._super;var record_id=$(event.currentTarget).data('id');return this.view.start_edition(((record_id)?this.records.get(record_id):null),{focus_field:$(event.target).not(".o_readonly").data('field'),}).fail(function(){return _super.apply(self,args);}).always(function(){self.__is_starting_edition=false;});},get_row_for:function(record){var $row=this.$current.children('[data-id='+record.get('id')+']');return(($row.length)?$row:null);},});return Editor;});;

/* /web/static/src/js/views/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data_manager=require('web.data_manager');var formats=require('web.formats');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var Sidebar=require('web.Sidebar');var utils=require('web.utils');var View=require('web.View');var _lt=core._lt;var _t=core._t;var QWeb=core.qweb;var PivotView=View.extend({events:{'click .o_pivot_header_cell_opened':'on_open_header_click','click .o_pivot_header_cell_closed':'on_closed_header_click','click .o_pivot_field_menu a':'on_field_menu_selection','click td':'on_cell_click','click .o_pivot_measure_row':'on_measure_row_click',},display_name:_lt('Pivot'),icon:'fa-table',require_fields:true,template:'PivotView',init:function(){this._super.apply(this,arguments);this._model=new Model(this.model,{group_by_no_leaf:true});this.measures={};this.groupable_fields={};this.ready=false;this.data_loaded=$.Deferred();this.title=this.options.title||this.fields_view.arch.attrs.string;this.main_row={root:undefined,groupbys:[],};this.main_col={root:undefined,groupbys:[],};this.initial_col_groupby=[];this.initial_row_groupby=[];this.active_measures=[];this.headers={};this.cells={};this.has_data=false;this.$buttons=$();this.last_header_selected=null;this.sorted_column={};this.numbering={};this.widgets=[];this.enable_linking=!this.fields_view.arch.attrs.disable_linking;},willStart:function(){var self=this;var fields_def=data_manager.load_fields(this.dataset);var xlwt_def=session.rpc('/web/pivot/check_xlwt').then(function(result){self.xlwt_installed=result;});this.fields_view.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
switch(field.attrs.type){case'measure':self.widgets.push(field.attrs.widget||"");self.active_measures.push(name);break;case'col':self.initial_col_groupby.push(name);break;default:if('operator'in field.attrs){self.active_measures.push(name);break;}
case'row':self.initial_row_groupby.push(name);}});if((!this.active_measures.length)||this.fields_view.arch.attrs.display_quantity){this.active_measures.push('__count__');}
return $.when(fields_def,xlwt_def,this._super()).then(function(fields){self.prepare_fields(fields);_.each(self.active_measures,function(m){if(!(m in self.measures)){self.measures[m]=self.fields[m];}});});},start:function(){this.$el.toggleClass('o_enable_linking',this.enable_linking);var context={fields:_.chain(this.groupable_fields).pairs().sortBy(function(f){return f[1].string;}).value(),};this.$field_selection=this.$('.o_field_selection');this.$field_selection.html(QWeb.render('PivotView.FieldSelection',context));core.bus.on('click',this,function(){this.$field_selection.find('ul').first().hide();});return this._super();},render_buttons:function($node){if($node){var self=this;var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this.on_button_click.bind(this));this.active_measures.forEach(function(measure){self.$buttons.find('li[data-field="'+measure+'"]').addClass('selected');});this.$buttons.find('button').tooltip();this.$buttons.appendTo($node);}},render_sidebar:function($node){if(this.xlwt_installed&&$node&&this.options.sidebar){this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit')});this.sidebar.appendTo($node);}},prepare_fields:function(fields){var self=this,groupable_types=['many2one','char','boolean','selection','date','datetime'];this.fields=fields;_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){self.measures[name]=field;}
if(_.contains(groupable_types,field.type)){self.groupable_fields[name]=field;}}});this.measures.__count__={string:_t("Count"),type:"integer"};},do_search:function(domain,context,group_by){if(!this.ready){this.initial_row_groupby=context.pivot_row_groupby||this.initial_row_groupby;this.initial_col_groupby=context.pivot_col_groupby||this.initial_col_groupby;}
this.main_row.groupbys=group_by.length?group_by:(context.pivot_row_groupby||this.initial_row_groupby.slice(0));this.main_col.groupbys=context.col_group_by||context.pivot_column_groupby||this.initial_col_groupby.slice(0);this.active_measures=context.measures||context.pivot_measures||this.active_measures;this.domain=domain;this.context=context;if(!this.ready){this.data_loaded=this.load_data(true);this.ready=true;return;}
this.data_loaded=this.load_data(false);return this.do_show();},do_show:function(){var self=this;var _super=this._super.bind(this);this.do_push_state({});return this.data_loaded.done(function(){self.display_table();self.$buttons.find('.o_pivot_measures_list li').removeClass('selected');self.active_measures.forEach(function(measure){self.$buttons.find('li[data-field="'+measure+'"]').addClass('selected');});_super();});},get_context:function(){return!this.ready?{}:{pivot_measures:this.active_measures,pivot_column_groupby:this.main_col.groupbys,pivot_row_groupby:this.main_row.groupbys,};},on_button_click:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_flip_button')){return this.flip();}
if($target.hasClass('o_pivot_expand_button')){return this.expand_all();}
if($target.parents('.o_pivot_measures_list').length){var parent=$target.parent();var field=parent.data('field');parent.toggleClass('selected');event.preventDefault();event.stopPropagation();return this.toggle_measure(field);}
if($target.hasClass('o_pivot_download')){return this.download_table();}},on_open_header_click:function(event){var id=$(event.target).data('id'),header=this.headers[id];header.expanded=false;header.children=[];var new_groupby_length=this.get_header_depth(header.root)-1;header.root.groupbys.splice(new_groupby_length);this.display_table();},on_closed_header_click:function(event){var id=$(event.target).data('id'),header=this.headers[id],groupbys=header.root.groupbys;if(header.path.length-1<groupbys.length){this.expand_header(header,groupbys[header.path.length-1]).then(this.proxy('display_table'));}else{this.last_header_selected=id;var $test=$(event.target);var $menu=this.$field_selection.find('ul').first();var position=$test.position();$menu.css({top:position.top+$test.height(),left:position.left+event.offsetX,});$menu.show();event.stopPropagation();}},on_cell_click:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_header_cell_closed')||$target.hasClass('o_pivot_header_cell_opened')||$target.hasClass('o_empty')||!this.enable_linking){return;}
var row_id=$target.data('id'),col_id=$target.data('col_id'),row_domain=this.headers[row_id].domain,col_domain=this.headers[col_id].domain,context=_.omit(_.clone(this.context),'group_by');var views=[_find_view_info.call(this,"list"),_find_view_info.call(this,"form"),];return this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.model,views:views,view_type:"list",view_mode:"list",target:'current',context:context,domain:this.domain.concat(row_domain,col_domain),});function _find_view_info(view_type){return _.find(this.options.action.views,function(view){return view[1]===view_type;})||[false,view_type];}},on_measure_row_click:function(event){var $target=$(event.target),col_id=$target.data('id'),measure=$target.data('measure');this.sort_rows(col_id,measure,$target.hasClass('o_pivot_measure_row_sorted_asc'));this.display_table();},sort_rows:function(col_id,measure,descending){var self=this;traverse_tree(this.main_row.root,function(header){header.children.sort(compare);});this.sorted_column={id:col_id,measure:measure,order:descending?'desc':'asc',};function compare(row1,row2){var values1=self.get_value(row1.id,col_id),values2=self.get_value(row2.id,col_id),value1=values1?values1[measure]:0,value2=values2?values2[measure]:0;return descending?value1-value2:value2-value1;}},on_field_menu_selection:function(event){event.preventDefault();var field=$(event.target).parent().data('field'),interval=$(event.target).data('interval'),header=this.headers[this.last_header_selected];if(interval)field=field+':'+interval;this.expand_header(header,field).then(function(){header.root.groupbys.push(field);}).then(this.proxy('display_table'));},expand_header:function(header,field){var self=this;var other_root=header.root.other_root,other_groupbys=header.root.other_root.groupbys,fields=[].concat(field,other_groupbys,this.active_measures),groupbys=[];for(var i=0;i<=other_groupbys.length;i++){groupbys.push([field].concat(other_groupbys.slice(0,i)));}
return $.when.apply(null,groupbys.map(function(groupby){return self._model.query(fields).filter(header.domain.length?header.domain:self.domain).context(self.context).lazy(false).group_by(groupby);})).then(function(){var data=Array.prototype.slice.call(arguments),datapt,attrs,j,k,l,row,col,cell_value,field_name;for(i=0;i<data.length;i++){for(j=0;j<data[i].length;j++){datapt=data[i][j];attrs=datapt.attributes;if(i===0)attrs.value=[attrs.value];for(k=0;k<attrs.value.length;k++){if(k<1)field_name=field;else field_name=other_groupbys[k-1];attrs.value[k]=self.sanitize_value(attrs.value[k],field_name);}
if(i===0){row=self.make_header(datapt,header.root,0,1,header);}else{row=self.get_header(datapt,header.root,0,1,header);}
col=self.get_header(datapt,other_root,1,i+1);if(!col)continue;for(cell_value={},l=0;l<self.active_measures.length;l++){cell_value[self.active_measures[l]]=attrs.aggregates[self.active_measures[l]];}
cell_value.__count__=attrs.length;if(!self.cells[row.id])self.cells[row.id]=[];self.cells[row.id][col.id]=cell_value;}}});},expand_all:function(){this.load_data(false).then(this.proxy('display_table'));},load_data:function(update){var should_update=(update&&this.main_row.root&&this.main_col.root);var self=this,i,j,groupbys=[],row_gbs=this.main_row.groupbys,col_gbs=this.main_col.groupbys,fields=[].concat(row_gbs,col_gbs,this.active_measures);for(i=0;i<row_gbs.length+1;i++){for(j=0;j<col_gbs.length+1;j++){groupbys.push(row_gbs.slice(0,i).concat(col_gbs.slice(0,j)));}}
return $.when.apply(null,groupbys.map(function(groupby){return self._model.query(fields).filter(self.domain).context(self.context).lazy(false).group_by(groupby);})).then(function(){var data=Array.prototype.slice.call(arguments);self.prepare_data(data,should_update);});},prepare_data:function(data,should_update){var i,j,k,l,m,index=0,row_gbs=this.main_row.groupbys,col_gbs=this.main_col.groupbys,main_row_header,main_col_header,row,col,attrs,datapt,cell_value,field;for(i=0;i<row_gbs.length+1;i++){for(j=0;j<col_gbs.length+1;j++){for(k=0;k<data[index].length;k++){datapt=data[index][k];attrs=datapt.attributes;if(i+j===1){attrs.value=[attrs.value];}
for(l=0;l<attrs.value.length;l++){if(l<i)field=row_gbs[l];else field=col_gbs[l-i];attrs.value[l]=this.sanitize_value(attrs.value[l],field);}
if(j===0){row=this.make_header(datapt,main_row_header,0,i);}else{row=this.get_header(datapt,main_row_header,0,i);}
if(i===0){col=this.make_header(datapt,main_col_header,i,i+j);}else{col=this.get_header(datapt,main_col_header,i,i+j);}
if(i+j===0){this.has_data=attrs.length>0;main_row_header=row;main_col_header=col;}
if(!this.cells[row.id])this.cells[row.id]=[];for(cell_value={},m=0;m<this.active_measures.length;m++){cell_value[this.active_measures[m]]=attrs.aggregates[this.active_measures[m]];}
cell_value.__count__=attrs.length;this.cells[row.id][col.id]=cell_value;}
index++;}}
if(should_update){this.update_tree(this.main_row.root,main_row_header);var new_groupby_length=this.get_header_depth(main_row_header)-1;main_row_header.groupbys=this.main_row.root.groupbys.slice(0,new_groupby_length);this.update_tree(this.main_col.root,main_col_header);new_groupby_length=this.get_header_depth(main_col_header)-1;main_col_header.groupbys=this.main_col.root.groupbys.slice(0,new_groupby_length);}else{main_row_header.groupbys=this.main_row.groupbys;main_col_header.groupbys=this.main_col.groupbys;}
main_row_header.other_root=main_col_header;main_col_header.other_root=main_row_header;this.main_row.root=main_row_header;this.main_col.root=main_col_header;},update_tree:function(old_tree,new_tree){if(!old_tree.expanded){new_tree.expanded=false;new_tree.children=[];return;}
var tree,j,old_title,new_title;for(var i=0;i<new_tree.children.length;i++){tree=undefined;new_title=new_tree.children[i].path[new_tree.children[i].path.length-1];for(j=0;j<old_tree.children.length;j++){old_title=old_tree.children[j].path[old_tree.children[j].path.length-1];if(old_title===new_title){tree=old_tree.children[j];break;}}
if(tree)this.update_tree(tree,new_tree.children[i]);else{new_tree.children[i].expanded=false;new_tree.children[i].children=[];}}},sanitize_value:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return this.get_numbered_value(value,field);if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},get_numbered_value:function(value,field){var id=value[0];var name=value[1]
this.numbering[field]=this.numbering[field]||{};this.numbering[field][name]=this.numbering[field][name]||{};var numbers=this.numbering[field][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},make_header:function(data_pt,root,i,j,parent_header){var total=_t("Total");var attrs=data_pt.attributes,value=attrs.value,title=value.length?value[value.length-1]:total;var path,parent;if(parent_header){path=parent_header.path.concat(title);parent=parent_header;}else{path=[total].concat(value.slice(i,j-1));parent=value.length?find_path_in_tree(root,path):null;}
var header={id:utils.generate_id(),expanded:false,domain:data_pt.model._domain,children:[],path:value.length?parent.path.concat(title):[title]};this.headers[header.id]=header;header.root=root||header;if(parent){parent.children.push(header);parent.expanded=true;}
return header;},get_header:function(data_pt,root,i,j,parent){var path;var total=_t("Total");if(parent){path=parent.path.concat(data_pt.attributes.value.slice(i,j));}else{path=[total].concat(data_pt.attributes.value.slice(i,j));}
return find_path_in_tree(root,path);},_clean_table:function(){return this.$el.find('table').remove().end().find('.oe_view_nocontent').remove().end();},display_table:function(){if(!this.active_measures.length||!this.has_data){return this._clean_table().append(QWeb.render('PivotView.nodata'));}
var $fragment=$(document.createDocumentFragment()),$table=$('<table>').addClass('table table-hover table-condensed table-bordered').appendTo($fragment),$thead=$('<thead>').appendTo($table),$tbody=$('<tbody>').appendTo($table),headers=this.compute_headers(),rows=this.compute_rows(),nbr_measures=this.active_measures.length,nbr_cols=(this.main_col.width===1)?nbr_measures:(this.main_col.width+1)*nbr_measures;for(var i=0;i<nbr_cols+1;i++){$table.prepend($('<col>'));}
this.draw_headers($thead,headers);this.draw_rows($tbody,rows);$table.on('hover','td',function(){$table.find('col:eq('+$(this).index()+')').toggleClass('hover');});this._clean_table().append($fragment);this.$('.o_pivot_header_cell_opened,.o_pivot_header_cell_closed').tooltip();},draw_headers:function($thead,headers){var self=this,i,j,cell,$row,$cell;var groupby_labels=_.map(this.main_col.groupbys,function(gb){return self.fields[gb.split(':')[0]].string;});for(i=0;i<headers.length;i++){$row=$('<tr>');for(j=0;j<headers[i].length;j++){cell=headers[i][j];$cell=$('<th>').text(cell.title).attr('rowspan',cell.height).attr('colspan',cell.width);if(i>0){$cell.attr('title',groupby_labels[i-1]);}
if(cell.expanded!==undefined){$cell.addClass(cell.expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');$cell.data('id',cell.id);}
if(cell.measure){$cell.addClass('o_pivot_measure_row text-muted').text(this.measures[cell.measure].string);$cell.data('id',cell.id).data('measure',cell.measure);if(cell.id===this.sorted_column.id&&cell.measure===this.sorted_column.measure){$cell.addClass('o_pivot_measure_row_sorted_'+this.sorted_column.order);}}
$row.append($cell);$cell.toggleClass('hidden-xs',(cell.expanded!==undefined)||(cell.measure!==undefined&&j<headers[i].length-this.active_measures.length));if(cell.height>1){$cell.css('padding',0);}}
$thead.append($row);}},draw_rows:function($tbody,rows){var self=this,i,j,value,$row,$cell,$header,nbr_measures=this.active_measures.length,length=rows[0].values.length,display_total=this.main_col.width>1;var groupby_labels=_.map(this.main_row.groupbys,function(gb){return self.fields[gb.split(':')[0]].string;});var measure_types=this.active_measures.map(function(name){return self.measures[name].type;});var widgets=this.widgets;for(i=0;i<rows.length;i++){$row=$('<tr>');$header=$('<td>').text(rows[i].title).data('id',rows[i].id).css('padding-left',(5+rows[i].indent*30)+'px').addClass(rows[i].expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');if(rows[i].indent>0)$header.attr('title',groupby_labels[rows[i].indent-1]);$header.appendTo($row);for(j=0;j<length;j++){value=formats.format_value(rows[i].values[j],{type:measure_types[j%nbr_measures],widget:widgets[j%nbr_measures]});$cell=$('<td>').data('id',rows[i].id).data('col_id',rows[i].col_ids[Math.floor(j/nbr_measures)]).toggleClass('o_empty',!value).text(value).addClass('o_pivot_cell_value text-right');if(((j>=length-this.active_measures.length)&&display_total)||i===0){$cell.css('font-weight','bold');}
$row.append($cell);$cell.toggleClass('hidden-xs',j<length-this.active_measures.length);}
$tbody.append($row);}},compute_headers:function(){var self=this,main_col_dims=this.get_header_width_depth(this.main_col.root),depth=main_col_dims.depth,width=main_col_dims.width,nbr_measures=this.active_measures.length,result=[[{width:1,height:depth+1}]],col_ids=[];this.main_col.width=width;traverse_tree(this.main_col.root,function(header){var index=header.path.length-1,cell={width:self.get_header_width(header)*nbr_measures,height:header.expanded?1:depth-index,title:header.path[header.path.length-1],id:header.id,expanded:header.expanded,};if(!header.expanded)col_ids.push(header.id);if(result[index])result[index].push(cell);else result[index]=[cell];});col_ids.push(this.main_col.root.id);this.main_col.width=width;if(width>1){var total_cell={width:nbr_measures,height:depth,title:""};if(nbr_measures===1){total_cell.total=true;}
result[0].push(total_cell);}
var nbr_cols=width===1?nbr_measures:(width+1)*nbr_measures;for(var i=0,measure_row=[],measure;i<nbr_cols;i++){measure=this.active_measures[i%nbr_measures];measure_row.push({measure:measure,is_bold:(width>1)&&(i>=nbr_measures*width),id:col_ids[Math.floor(i/nbr_measures)],});}
result.push(measure_row);return result;},get_header_width:function(header){var self=this;if(!header.children.length)return 1;if(!header.expanded)return 1;return header.children.reduce(function(s,c){return s+self.get_header_width(c);},0);},get_header_width_depth:function(header){var depth=1,width=0;traverse_tree(header,function(hdr){depth=Math.max(depth,hdr.path.length);if(!hdr.expanded)width++;});return{width:width,depth:depth};},get_header_depth:function(header){var depth=1;traverse_tree(header,function(hdr){depth=Math.max(depth,hdr.path.length);});return depth;},compute_rows:function(){var self=this,aggregates,i,result=[];traverse_tree(this.main_row.root,function(header){var values=[],col_ids=[];result.push({id:header.id,col_ids:col_ids,indent:header.path.length-1,title:header.path[header.path.length-1],expanded:header.expanded,values:values,});traverse_tree(self.main_col.root,add_cells,header.id,values,col_ids);if(self.main_col.width>1){aggregates=self.get_value(header.id,self.main_col.root.id);for(i=0;i<self.active_measures.length;i++){values.push(aggregates&&aggregates[self.active_measures[i]]);}
col_ids.push(self.main_col.root.id);}});return result;function add_cells(col_hdr,row_id,values,col_ids){if(col_hdr.expanded)return;col_ids.push(col_hdr.id);aggregates=self.get_value(row_id,col_hdr.id);for(i=0;i<self.active_measures.length;i++){values.push(aggregates&&aggregates[self.active_measures[i]]);}}},get_value:function(id1,id2){if((id1 in this.cells)&&(id2 in this.cells[id1])){return this.cells[id1][id2];}
if(id2 in this.cells)return this.cells[id2][id1];},flip:function(){var temp=this.main_col;this.main_col=this.main_row;this.main_row=temp;this.display_table();},toggle_measure:function(field){if(_.contains(this.active_measures,field)){this.active_measures=_.without(this.active_measures,field);this.display_table();}else{this.active_measures.push(field);this.load_data().then(this.display_table.bind(this));}},download_table:function(){framework.blockUI();var nbr_measures=this.active_measures.length,headers=this.compute_headers(),measure_row=nbr_measures>1?_.last(headers):[],rows=this.compute_rows(),i,j,value;headers[0].splice(0,1);for(i=0;i<measure_row.length;i++){measure_row[i].measure=this.measures[measure_row[i].measure].string;}
for(i=0,j,value;i<rows.length;i++){for(j=0;j<rows[i].values.length;j++){value=rows[i].values[j];rows[i].values[j]={is_bold:(i===0)||((this.main_col.width>1)&&(j>=rows[i].values.length-nbr_measures)),value:(value===undefined)?"":value,};}}
var table={headers:_.initial(headers),measure_row:measure_row,rows:rows,nbr_measures:nbr_measures,title:this.title,};if(table.measure_row.length+1>256){c.show_message(_t("For Excel compatibility, data cannot be exported if there are more than 256 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));return;}
session.get_file({url:'/web/pivot/export_xls',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager)});},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},});function traverse_tree(root,f,arg1,arg2,arg3){f(root,arg1,arg2,arg3);if(!root.expanded)return;for(var i=0;i<root.children.length;i++){traverse_tree(root.children[i],f,arg1,arg2,arg3);}}
function find_path_in_tree(root,path){var i,l=root.path.length;if(l===path.length){return(root.path[l-1]===path[l-1])?root:null;}
for(i=0;i<root.children.length;i++){if(root.children[i].path[l]===path[l]){return find_path_in_tree(root.children[i],path);}}
return null;}
core.view_registry.add('pivot',PivotView);return PivotView;});;

/* /web/static/src/js/views/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var GraphWidget=require('web.GraphWidget');var View=require('web.View');var _lt=core._lt;var _t=core._t;var QWeb=core.qweb;var GraphView=View.extend({className:'o_graph',display_name:_lt('Graph'),icon:'fa-bar-chart',require_fields:true,init:function(){this._super.apply(this,arguments);this.measures=[];this.active_measure='__count__';this.initial_groupbys=[];this.widget=undefined;},willStart:function(){var self=this;var fields_def=data_manager.load_fields(this.dataset).then(this.prepare_fields.bind(this));this.fields_view.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.type==='measure'){self.active_measure=name;}else{self.initial_groupbys.push(name);}});return $.when(this._super(),fields_def);},render_buttons:function($node){if($node){var context={measures:_.pairs(_.omit(this.measures,'__count__'))};this.$buttons=$(QWeb.render('GraphView.buttons',context));this.$measure_list=this.$buttons.find('.o_graph_measures_list');this.update_measure();this.$buttons.find('button').tooltip();this.$buttons.click(this.on_button_click.bind(this));this.$buttons.find('.o_graph_button[data-mode="'+this.widget.mode+'"]').addClass('active');this.$buttons.appendTo($node);}},update_measure:function(){var self=this;this.$measure_list.find('li').each(function(index,li){$(li).toggleClass('selected',$(li).data('field')===self.active_measure);});},do_show:function(){this.do_push_state({});return this._super();},prepare_fields:function(fields){var self=this;this.fields=fields;_.each(fields,function(field,name){if((name!=='id')&&(field.store===true)){if(field.type==='integer'||field.type==='float'||field.type==='monetary'){self.measures[name]=field;}}});this.measures.__count__={string:_t("Count"),type:"integer"};},do_search:function(domain,context,group_by){if(!this.widget){this.initial_groupbys=context.graph_groupbys||(group_by.length?group_by:this.initial_groupbys);this.widget=new GraphWidget(this,this.model,{measure:context.graph_measure||this.active_measure,mode:context.graph_mode||this.active_mode,domain:domain,groupbys:this.initial_groupbys,context:context,fields:this.fields,stacked:this.fields_view.arch.attrs.stacked!=="False"});this.widget.appendTo(this.$el);}else{var groupbys=group_by.length?group_by:this.initial_groupbys.slice(0);this.widget.update_data(domain,groupbys);}},get_context:function(){return!this.widget?{}:{graph_mode:this.widget.mode,graph_measure:this.widget.measure,graph_groupbys:this.widget.groupbys};},on_button_click:function(event){var $target=$(event.target);if($target.hasClass('o_graph_button')){this.widget.set_mode($target.data('mode'));this.$buttons.find('.o_graph_button.active').removeClass('active');$target.addClass('active');}
else if($target.parents('.o_graph_measures_list').length){var parent=$target.parent();var field=parent.data('field');this.active_measure=field;event.preventDefault();event.stopPropagation();this.update_measure();this.widget.set_measure(this.active_measure);}},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},});core.view_registry.add('graph',GraphView);return GraphView;});;

/* /web/static/src/js/views/graph_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphWidget',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Model=require('web.DataModel');var formats=require('web.formats');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var MAX_LEGEND_LENGTH=25*(1+config.device.size_class);return Widget.extend({className:"o_graph_svg_container",init:function(parent,model,options){this._super(parent);this.context=options.context;this.fields=options.fields;this.fields.__count__={string:_t("Count"),type:"integer"};this.model=new Model(model,{group_by_no_leaf:true});this.domain=options.domain||[];this.groupbys=options.groupbys||[];this.mode=options.mode||"bar";this.measure=options.measure||"__count__";this.stacked=options.stacked;},start:function(){return this.load_data().then(this.proxy('display_graph'));},update_data:function(domain,groupbys){this.domain=domain;this.groupbys=groupbys;return this.load_data().then(this.proxy('display_graph'));},set_mode:function(mode){this.mode=mode;this.display_graph();},set_measure:function(measure){this.measure=measure;return this.load_data().then(this.proxy('display_graph'));},load_data:function(){var fields=this.groupbys.slice(0);if(this.measure!=='__count__'.slice(0))
fields=fields.concat(this.measure);return this.model.query(fields).filter(this.domain).context(this.context).lazy(false).group_by(this.groupbys.slice(0,2)).then(this.proxy('prepare_data'));},prepare_data:function(){var raw_data=arguments[0],is_count=this.measure==='__count__';var data_pt,j,values,value;this.data=[];for(var i=0;i<raw_data.length;i++){data_pt=raw_data[i].attributes;values=[];if(this.groupbys.length===1)data_pt.value=[data_pt.value];for(j=0;j<data_pt.value.length;j++){var field=_.isArray(data_pt.grouped_on)?data_pt.grouped_on[j]:data_pt.grouped_on;values[j]=this.sanitize_value(data_pt.value[j],field);}
value=is_count?data_pt.length:data_pt.aggregates[this.measure];this.data.push({labels:values,value:value});}},sanitize_value:function(value,field){if(value===false)return _t("Undefined");if(value instanceof Array)return value[1];if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},display_graph:function(){if(this.to_remove){nv.utils.offWindowResize(this.to_remove);}
this.$el.empty();if(!this.data.length){this.$el.append(QWeb.render('GraphView.error',{title:_t("No data to display"),description:_t("No data available for this chart. "+"Try to add some records, or make sure that "+"there is no active filter in the search bar."),}));}else{var chart=this['display_'+this.mode]();if(chart&&chart.tooltip.chartContainer){chart.tooltip.chartContainer(this.$el[0]);}}},display_bar:function(){var data,values,measure=this.fields[this.measure].string,self=this;if(this.groupbys.length===0){data=[{values:[{x:measure,y:this.data[0].value}],key:measure}];}
if(this.groupbys.length===1){values=this.data.map(function(datapt){return{x:datapt.labels,y:datapt.value};});data=[{values:values,key:measure,}];}
if(this.groupbys.length>1){var xlabels=[],series=[],label,serie,value;values={};for(var i=0;i<this.data.length;i++){label=this.data[i].labels[0];serie=this.data[i].labels[1];value=this.data[i].value;if((!xlabels.length)||(xlabels[xlabels.length-1]!==label)){xlabels.push(label);}
series.push(this.data[i].labels[1]);if(!(serie in values)){values[serie]={};}
values[serie][label]=this.data[i].value;}
series=_.uniq(series);data=[];var current_serie,j;for(i=0;i<series.length;i++){current_serie={values:[],key:series[i]};for(j=0;j<xlabels.length;j++){current_serie.values.push({x:xlabels[j],y:values[series[i]][xlabels[j]]||0,});}
data.push(current_serie);}}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.multiBarChart();chart.options({margin:{left:120,bottom:60},delay:250,transition:10,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,rightAlignYAxis:false,stacked:this.stacked,reduceXTicks:false,rotateLabels:-20,showControls:(this.groupbys.length>1)});chart.yAxis.tickFormat(function(d){return formats.format_value(d,{type:'float',digits:self.fields[self.measure]&&self.fields[self.measure].digits||[69,2],});});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);return chart;},display_pie:function(){var data=[],all_negative=true,some_negative=false,all_zero=true;this.data.forEach(function(datapt){all_negative=all_negative&&(datapt.value<0);some_negative=some_negative||(datapt.value<0);all_zero=all_zero&&(datapt.value===0);});if(some_negative&&!all_negative){this.$el.append(QWeb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot mix positive and negative numbers. "+"Try to change your domain to only display positive results"),}));return;}
if(all_zero){this.$el.append(QWeb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot display all zero numbers.. "+"Try to change your domain to display positive results"),}));return;}
if(this.groupbys.length){data=this.data.map(function(datapt){return{x:datapt.labels.join("/"),y:datapt.value};});}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(100);var legend_right=config.device.size_class>config.device.SIZES.XS;var chart=nv.models.pieChart();chart.options({delay:250,showLegend:legend_right||_.size(data)<=MAX_LEGEND_LENGTH,legendPosition:legend_right?'right':'top',transition:100,color:d3.scale.category10().range(),});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);return chart;},display_line:function(){if(this.data.length<2){this.$el.append(QWeb.render('GraphView.error',{title:_t("Not enough data points"),description:"You need at least two data points to display a line chart."}));return;}
var self=this,data=[],tickValues,tickFormat,measure=this.fields[this.measure].string;if(this.groupbys.length===1){var values=this.data.map(function(datapt,index){return{x:index,y:datapt.value};});data=[{values:values,key:measure,}];tickValues=this.data.map(function(d,i){return i;});tickFormat=function(d){return self.data[d].labels;};}
if(this.groupbys.length>1){data=[];var data_dict={},tick=0,tickLabels=[],serie,tickLabel,identity=function(p){return p;};tickValues=[];for(var i=0;i<this.data.length;i++){if(this.data[i].labels[0]!==tickLabel){tickLabel=this.data[i].labels[0];tickValues.push(tick);tickLabels.push(tickLabel);tick++;}
serie=this.data[i].labels[1];if(!data_dict[serie]){data_dict[serie]={values:[],key:serie,};}
data_dict[serie].values.push({x:tick,y:this.data[i].value,});data=_.map(data_dict,identity);}
tickFormat=function(d){return tickLabels[d];};}
var svg=d3.select(this.$el[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.lineChart();chart.options({margin:{left:120,bottom:60},useInteractiveGuideline:true,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,});chart.xAxis.tickValues(tickValues).tickFormat(tickFormat);chart.yAxis.tickFormat(function(d){return formats.format_value(d,{type:'float',digits:self.fields[self.measure]&&self.fields[self.measure].digits||[69,2],});});chart(svg);this.to_remove=chart.update;nv.utils.onWindowResize(chart.update);return chart;},destroy:function(){nv.utils.offWindowResize(this.to_remove);return this._super();}});});;

/* /web/static/src/js/views/search_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchView',function(require){"use strict";var AutoComplete=require('web.AutoComplete');var config=require('web.config');var core=require('web.core');var data_manager=require('web.data_manager');var FavoriteMenu=require('web.FavoriteMenu');var FilterMenu=require('web.FilterMenu');var GroupByMenu=require('web.GroupByMenu');var pyeval=require('web.pyeval');var search_inputs=require('web.search_inputs');var View=require('web.View');var Widget=require('web.Widget');var local_storage=require('web.local_storage');var _t=core._t;var Backbone=window.Backbone;var FacetValue=Backbone.Model.extend({});var FacetValues=Backbone.Collection.extend({model:FacetValue});var Facet=Backbone.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;Backbone.Model.prototype.initialize.apply(this,arguments);this.values=new FacetValues(values||[]);this.values.on('add remove change reset',function(_,options){this.trigger('change',this,options);},this);},get:function(key){if(key!=='values'){return Backbone.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return Backbone.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});var SearchQuery=Backbone.Collection.extend({model:Facet,initialize:function(){Backbone.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options=options||{};if(!values){values=[];}else if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'),_.omit(options,'at','merge'));return;}
Backbone.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options=options||{};var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});var InputView=Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.val('');this.trigger('blurred',this);},keydown:'onKeydown',},onKeydown:function(e){switch(e.which){case $.ui.keyCode.BACKSPACE:if(this.$el.val()===''){var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:if(this.el.selectionStart>0){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:if(this.el.selectionStart<this.$el.val().length){e.stopPropagation();}
break;}}});var FacetView=Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).hasClass('o_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('.o_facet_values').last();return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value,index){if(index>0){$('<span/>',{html:self.model.get('separator')||_t(" or ")}).addClass('o_facet_values_sep').appendTo($e);}
return new FacetValueView(self,value).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var FacetValueView=Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var SearchView=View.extend({events:{'click .o_searchview_more':function(e){$(e.target).toggleClass('fa-search-plus fa-search-minus');var visible_search_menu=(local_storage.getItem('visible_search_menu')!=='true');local_storage.setItem('visible_search_menu',visible_search_menu);this.toggle_buttons();},'keydown .o_searchview_input, .o_searchview_facet':function(e){switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(e.target);e.preventDefault();break;case $.ui.keyCode.RIGHT:if(!this.autocomplete.is_expandable()){this.focusFollowing(e.target);}
e.preventDefault();break;}},},defaults:_.extend({},View.prototype.defaults,{hidden:false,disable_filters:false,disable_groupby:false,disable_favorites:false,disable_custom_filters:false,}),template:"SearchView",init:function(){this._super.apply(this,arguments);this.query=undefined;this.title=this.options.action&&this.options.action.name;this.action_id=this.options.action&&this.options.action.id;this.search_fields=[];this.filters=[];this.groupbys=[];this.visible_filters=(local_storage.getItem('visible_search_menu')==='true');this.input_subviews=[];this.search_defaults=this.options.search_defaults||{};this.headless=this.options.hidden&&_.isEmpty(this.search_defaults);this.$buttons=this.options.$buttons;this.filter_menu=undefined;this.groupby_menu=undefined;this.favorite_menu=undefined;},willStart:function(){var self=this;var def;if(!this.options.disable_favorites){def=data_manager.load_filters(this.dataset,this.action_id).then(function(filters){self.favorite_filters=filters;});}
return $.when(this._super(),def);},start:function(){if(this.headless){this.do_hide();}
this.toggle_visibility(false);this.setup_global_completion();this.query=new SearchQuery().on('add change reset remove',this.proxy('do_search')).on('change',this.proxy('renderChangedFacets')).on('add reset remove',this.proxy('renderFacets'));this.$('.o_searchview_more').toggleClass('fa-search-minus',this.visible_filters).toggleClass('fa-search-plus',!this.visible_filters);var menu_defs=[];this.prepare_search_inputs();if(this.$buttons){if(!this.options.disable_filters){this.filter_menu=new FilterMenu(this,this.filters);menu_defs.push(this.filter_menu.appendTo(this.$buttons));}
if(!this.options.disable_groupby){this.groupby_menu=new GroupByMenu(this,this.groupbys);menu_defs.push(this.groupby_menu.appendTo(this.$buttons));}
if(!this.options.disable_favorites){this.favorite_menu=new FavoriteMenu(this,this.query,this.dataset.model,this.action_id,this.favorite_filters);menu_defs.push(this.favorite_menu.appendTo(this.$buttons));}}
return $.when.apply($,menu_defs).then(this.set_default_filters.bind(this));},get_title:function(){return this.title;},set_default_filters:function(){var self=this,default_custom_filter=this.$buttons&&this.favorite_menu&&this.favorite_menu.get_default_filter();if(!self.options.disable_custom_filters&&default_custom_filter){return this.favorite_menu.toggle_filter(default_custom_filter,true);}
if(!_.isEmpty(this.search_defaults)){var inputs=this.search_fields.concat(this.filters,this.groupbys),search_defaults=_.invoke(inputs,'facet_for_defaults',this.search_defaults);return $.when.apply(null,search_defaults).then(function(){self.query.reset(_(arguments).compact(),{preventSearch:true});});}
this.query.reset([],{preventSearch:true});return $.when();},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();this.trigger('search_data',search.domains,search.contexts,search.groupbys);},build_search_data:function(){var domains=[],contexts=[],groupbys=[];this.query.each(function(facet){var field=facet.get('field');var domain=field.get_domain(facet);if(domain){domains.push(domain);}
var context=field.get_context(facet);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}});return{domains:domains,contexts:contexts,groupbys:groupbys,};},toggle_visibility:function(is_visible){this.do_toggle(!this.headless&&is_visible);if(this.$buttons){this.$buttons.toggle(!this.headless&&is_visible&&this.visible_filters);}
if(!config.device.touch&&config.device.size_class>=config.device.SIZES.SM){this.$('input').focus();}},toggle_buttons:function(is_visible){this.visible_filters=is_visible||!this.visible_filters;if(this.$buttons){this.$buttons.toggle(this.visible_filters);}},setup_global_completion:function(){var self=this;this.autocomplete=new AutoComplete(this,{source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),get_search_string:function(){return self.$('.o_searchview_input').val().trim();},});this.autocomplete.appendTo(this.$el);},complete_global_search:function(req,resp){var inputs=this.search_fields.concat(this.filters,this.groupbys);$.when.apply(null,_(inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(arguments).chain().compact().flatten(true).value());});},select_completion:function(e,ui){e.preventDefault();if(ui.item.facet&&ui.item.facet.values&&ui.item.facet.values.length&&String(ui.item.facet.values[0].value).trim()!==""){this.query.add(ui.item.facet);}else{this.query.trigger('add');}},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},renderFacets:function(collection,model,options){var self=this;var started=[];_.invoke(this.input_subviews,'destroy');this.input_subviews=[];this.query.each(function(facet){var f=new FacetView(this,facet);started.push(f.appendTo(self.$el));self.input_subviews.push(f);},this);var i=new InputView(this);started.push(i.appendTo(self.$el));self.input_subviews.push(i);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){_.last(self.input_subviews).$el.focus();});},childFocused:function(){this.$el.addClass('active');},childBlurred:function(){this.$el.val('').removeClass('active').trigger('blur');this.autocomplete.close();},renderChangedFacets:function(model,options){this.renderFacets(undefined,model,options);},prepare_search_inputs:function(){var self=this,arch=this.fields_view.arch;var filters=[].concat.apply([],_.map(arch.children,function(item){return item.tag!=='group'?eval_item(item):item.children.map(eval_item);}));function eval_item(item){var category='filters';if(item.attrs.context){try{var context=pyeval.eval('context',item.attrs.context);if(context.group_by){category='group_by';}}catch(e){}}
return{item:item,category:category,};}
var current_group=[],current_category='filters',categories={filters:this.filters,group_by:this.groupbys};_.each(filters.concat({category:'filters',item:'separator'}),function(filter){if(filter.item.tag==='filter'&&filter.category===current_category){return current_group.push(new search_inputs.Filter(filter.item,self));}
if(current_group.length){var group=new search_inputs.FilterGroup(current_group,self);categories[current_category].push(group);current_group=[];}
if(filter.item.tag==='field'){var attrs=filter.item.attrs;var field=self.fields_view.fields[attrs.name];if(field.type==="many2one"&&attrs.widget==="selection"){attrs.widget=undefined;}
var Obj=core.search_widgets_registry.get_any([attrs.widget,field.type]);if(Obj){self.search_fields.push(new(Obj)(filter.item,field,self));}}
if(filter.item.tag==='filter'){current_group.push(new search_inputs.Filter(filter.item,self));}
current_category=filter.category;});},});_.extend(SearchView,{SearchQuery:SearchQuery,Facet:Facet,});return SearchView;});;

/* /web/static/src/js/views/search_filters.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var formats=require('web.formats');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var ExtendedSearchProposition=Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .o_searchview_extended_prop_field':'changed','change .o_searchview_extended_prop_op':'operator_changed','click .o_searchview_extended_delete_prop':function(e){e.stopPropagation();this.getParent().remove_proposition(this);},},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".o_searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){this.value.show_inputs($(e.target));},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.o_searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=core.search_filters_registry.get_any([type,"char"]);this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.o_searchview_extended_prop_op'));});var $value_loc=this.$('.o_searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_filter:function(){if(this.attrs.selected===null||this.attrs.selected===undefined)
return null;var field=this.attrs.selected,op_select=this.$('.o_searchview_extended_prop_op')[0],operator=op_select.options[op_select.selectedIndex];return{attrs:{domain:this.value.get_domain(field,operator),string:this.value.get_label(field,operator),},children:[],tag:'filter',};},});ExtendedSearchProposition.Field=Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){var $value=this.$el.parent();switch($operator.val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},toString:function(){return this.get_value();}});ExtendedSearchProposition.Char=ExtendedSearchProposition.Field.extend({tagName:'input',attributes:{type:'text'},operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});ExtendedSearchProposition.DateTime=ExtendedSearchProposition.Field.extend({tagName:'span',attributes:{type:'datetime'},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"between",text:_lt("is between")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],widget:function(){return datepicker.DateTimeWidget;},get_value:function(){return this.datewidget_1.get_value();},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];case'between':return[[field.name,'>=',this.datewidget_1.get_value()],[field.name,'<=',this.datewidget_2.get_value()]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){this._super($operator);if($operator.val()==='between'){if(!this.datewidget_2){this.datewidget_2=new(this.widget())(this);this.datewidget_2.appendTo(this.$el);}
else{this.datewidget_2.$el.show();}}
else{if(this.datewidget_2){this.datewidget_2.$el.hide();}}},toString:function(){var str=formats.format_value(this.get_value(),{type:this.attributes['type']});if(this.datewidget_2&&this.datewidget_2.get_value()){str+=' and '+formats.format_value(this.datewidget_2.get_value(),{type:this.attributes['type']});}
return str;},start:function(){var ready=this._super();this.datewidget_1=new(this.widget())(this);this.datewidget_1.appendTo(this.$el);return ready;}});ExtendedSearchProposition.Date=ExtendedSearchProposition.DateTime.extend({attributes:{type:'date'},widget:function(){return datepicker.DateWidget;},});ExtendedSearchProposition.Integer=ExtendedSearchProposition.Field.extend({tagName:'input',attributes:{type:'number',value:'0',},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return formats.parse_value(val===""?0:val,{'widget':'integer'});}catch(e){return"";}}});ExtendedSearchProposition.Id=ExtendedSearchProposition.Integer.extend({operators:[{value:"=",text:_lt("is")}]});ExtendedSearchProposition.Float=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],init:function(parent){this._super(parent);this.decimal_point=_t.database.parameters.decimal_point;},toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return formats.parse_value(val===""?0.0:val,{'widget':'float'});}catch(e){return"";}}});ExtendedSearchProposition.Selection=ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});ExtendedSearchProposition.Boolean=ExtendedSearchProposition.Field.extend({tagName:'span',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});core.search_filters_registry.add('char',ExtendedSearchProposition.Char).add('text',ExtendedSearchProposition.Char).add('one2many',ExtendedSearchProposition.Char).add('many2one',ExtendedSearchProposition.Char).add('many2many',ExtendedSearchProposition.Char).add('datetime',ExtendedSearchProposition.DateTime).add('date',ExtendedSearchProposition.Date).add('integer',ExtendedSearchProposition.Integer).add('float',ExtendedSearchProposition.Float).add('monetary',ExtendedSearchProposition.Float).add('boolean',ExtendedSearchProposition.Boolean).add('selection',ExtendedSearchProposition.Selection).add('id',ExtendedSearchProposition.Id);return{ExtendedSearchProposition:ExtendedSearchProposition};});;

/* /web/static/src/js/views/search_inputs.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_inputs',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var Model=require('web.DataModel');var pyeval=require('web.pyeval');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var Input=Widget.extend({init:function(parent){this._super(parent);this.searchview=parent;this.load_attrs({});},complete:function(value){return $.when(null);},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){if(!_.isObject(attrs.modifiers)){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};}
this.attrs=attrs;},visible:function(){return!this.attrs.modifiers.invisible;},});var Field=Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new data.CompoundContext(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new data.CompoundContext(),{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs.filter_domain;if(domain){value_to_domain=function(facetValue){return new data.CompoundDomain(domain).set_eval_context({self:self.value_from(facetValue),raw_value:facetValue.attributes.value});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new data.CompoundDomain(),{__domains:domains});}});var CharField=Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});var NumberField=Field.extend({complete:function(value){var val=this.parse(value);if(isNaN(val)){return $.when();}
var label=_.str.sprintf(_t("Search %(field)s for: %(value)s"),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:val}]}}]);},});var IntegerField=NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return formats.parse_value(value,{'widget':'integer'});}catch(e){return NaN;}}});var FloatField=NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return formats.parse_value(value,{'widget':'float'});}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field.attrs.string,values:[{label:pair[1],value:pair[0]}]};}
var SelectionField=Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(value===undefined||!label){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:_.escape(this.attrs.string)}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});var BooleanField=SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});var DateField=Field.extend({value_from:function(facetValue){return time.date_to_str(facetValue.get('value'));},complete:function(needle){var t,v;try{t=(this.attrs&&this.attrs.type==='datetime')?'datetime':'date';v=formats.parse_value(needle,{'widget':t});}catch(e){return $.when(null);}
if(t==='datetime'){var m=moment.utc(v,'YYYY-MM-DD HH:mm:ss');}else{var m=moment(v,'YYYY-MM-DD');}
if(!m.isValid()){return $.when(null);}
var d=m.toDate();var date_string=formats.format_value(d,this.attrs);var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:d}]}}]);}});var DateTimeField=DateField.extend({value_from:function(facetValue){return time.datetime_to_str(facetValue.get('value'));}});var ManyToOneField=CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.model=new Model(this.attrs.relation);this.searchview=parent;},complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value,operator:'ilike'}]},expand:this.expand.bind(this),}]);},expand:function(needle){var self=this;var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);var args=this.attrs.domain;if(typeof args==='string'){try{args=pyeval.eval('domain',args);}catch(e){args=[];}}
return this.model.call('name_search',[],{name:needle,args:args,limit:8,context:context}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:facet_from(self,result)};});});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
utils.assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
var context=pyeval.eval('contexts',[this.searchview.dataset.get_context()]);return this.model.call('name_get',[value],{context:context}).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);});},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){operator=facetValue.get('operator')||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.get('value')]];case'ilike':return[[name,'ilike',facetValue.get('value')]];case'child_of':return[[name,'child_of',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};var v=values.at(0);if(v.get('operator')!=='ilike'){c['default_'+this.attrs.name]=v.get('value');}
return c;}
return this._super(facet);}});var FilterGroup=Input.extend({template:'SearchView.filters',icon:"fa-filter",completion_label:_lt("Filter on: %s"),init:function(filters,parent){if(!(this instanceof GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=pyeval.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new GroupbyGroup(filters,parent);}
this._super(parent);this.filters=filters;this.searchview=parent;this.searchview.query.on('add remove change reset',this.proxy('search_change'));},start:function(){this.$el.on('click','a',this.proxy('toggle_filter'));return $.when(null);},search_change:function(){var self=this;var $filters=this.$el.removeClass('selected');var facet=this.searchview.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.filter(function(){return Number($(this).data('index'))===i;}).addClass('selected');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{category:_t("Filter"),icon:this.icon,separator:_t(" or "),values:values,field:this};},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new data.CompoundContext(),{__contexts:contexts});},get_groupby:function(facet){return facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet){var domains=facet.values.chain().map(function(f){return f.get('value').attrs.domain;}).without('[]').reject(_.isEmpty).value();if(!domains.length){return;}
if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new data.CompoundDomain(),{__domains:domains});},toggle_filter:function(e){e.preventDefault();e.stopPropagation();this.toggle(this.filters[Number($(e.target).parent().data('index'))]);},toggle:function(filter,options){this.searchview.query.toggle(this.make_facet([this.make_value(filter)]),options);},is_visible:function(){return _.some(this.filters,function(filter){return!filter.attrs.invisible;});},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),_.escape(facet_value.label)),facet:self.make_facet([facet_value])};}));}});var GroupbyGroup=FilterGroup.extend({icon:'fa-bars',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super(filters,parent);this.searchview=parent;if(!this.searchview._s_groupby){this.searchview._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')};}},match_facet:function(facet){return facet.get('field')===this.searchview._s_groupby;},make_facet:function(values){return{category:_t("Group By"),icon:this.icon,separator:" > ",values:values,field:this.searchview._s_groupby};}});var Filter=Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});core.search_widgets_registry.add('char',CharField).add('text',CharField).add('html',CharField).add('boolean',BooleanField).add('integer',IntegerField).add('id',IntegerField).add('float',FloatField).add('monetary',FloatField).add('selection',SelectionField).add('datetime',DateTimeField).add('date',DateField).add('many2one',ManyToOneField).add('many2many',CharField).add('one2many',CharField);return{FilterGroup:FilterGroup,Filter:Filter,Field:Field,GroupbyGroup:GroupbyGroup,};});;

/* /web/static/src/js/views/search_menus.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var pyeval=require('web.pyeval');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;return Widget.extend({template:'SearchView.FavoriteMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'click li a':function(event){event.preventDefault();},'click .o_save_search a':function(event){event.preventDefault();this.toggle_save_menu();},'click .o_save_name button':'save_favorite','hidden.bs.dropdown':'close_menus','keyup .o_save_name input':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.save_favorite();}},},init:function(parent,query,target_model,action_id,filters){this._super.apply(this,arguments);this.searchview=parent;this.query=query;this.target_model=target_model;this.action_id=action_id;this.filters={};_.each(filters,this.add_filter.bind(this));},start:function(){var self=this;this.$filters={};this.$save_search=this.$('.o_save_search');this.$save_name=this.$('.o_save_name');this.$inputs=this.$save_name.find('input');this.$divider=this.$('.divider');this.$inputs.eq(0).val(this.searchview.get_title());var $shared_filter=this.$inputs.eq(1),$default_filter=this.$inputs.eq(2);$shared_filter.click(function(){$default_filter.prop('checked',false);});$default_filter.click(function(){$shared_filter.prop('checked',false);});this.query.on('remove',function(facet){if(facet.get('is_custom_filter')){self.clear_selection();}}).on('reset',this.proxy('clear_selection'));_.each(this.filters,this.append_filter.bind(this));return this._super();},toggle_save_menu:function(is_open){this.$save_search.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$save_name.toggle(is_open);if(this.$save_search.hasClass('o_open_menu')){this.$save_name.find('input').first().focus();}},close_menus:function(){this.toggle_save_menu(false);},save_favorite:function(){var self=this,filter_name=this.$inputs[0].value,default_filter=this.$inputs[1].checked,shared_filter=this.$inputs[2].checked;if(!filter_name.length){this.do_warn(_t("Error"),_t("Filter name is required."));this.$inputs.first().focus();return;}
if(_.chain(this.filters).pluck('name').contains(filter_name).value()){this.do_warn(_t("Error"),_t("Filter with same name already exists."));this.$inputs.first().focus();return;}
var search=this.searchview.build_search_data(),view_manager=this.findAncestor(function(a){return'active_view'in a;}),view_context=view_manager?view_manager.active_view.controller.get_context():{},results=pyeval.sync_eval_domains_and_contexts({domains:search.domains,contexts:search.contexts.concat(view_context||[]),group_by_seq:search.groupbys||[],});if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(session.user_context)).each(function(key){delete ctx[key];});var filter={name:filter_name,user_id:shared_filter?false:session.uid,model_id:this.target_model,context:results.context,domain:results.domain,sort:JSON.stringify(this.searchview.dataset._sort),is_default:default_filter,action_id:this.action_id,};return data_manager.create_filter(filter).done(function(id){filter.id=id;self.toggle_save_menu(false);self.$save_name.find('input').val('').prop('checked',false);self.add_filter(filter);self.append_filter(filter);self.toggle_filter(filter,true);});},get_default_filter:function(){var personal_filter=_.find(this.filters,function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){return personal_filter;}
return _.find(this.filters,function(filter){return!filter.user_id&&filter.is_default;});},key_for:function(filter){var user_id=filter.user_id,action_id=filter.action_id,uid=(user_id instanceof Array)?user_id[0]:user_id,act_id=(action_id instanceof Array)?action_id[0]:action_id;return _.str.sprintf('(%s)(%s)%s',uid,act_id,filter.name);},facet_for:function(filter){return{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){return filter.context;},get_groupby:function(){return[filter.context];},get_domain:function(){return filter.domain;}},_id:filter.id,is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('li.selected').removeClass('selected');},add_filter:function(filter){this.filters[this.key_for(filter)]=filter;},append_filter:function(filter){var self=this;var key=this.key_for(filter);this.$divider.show();if(!(key in this.$filters)){var $filter=$('<li>').addClass(filter.user_id?'o-searchview-custom-private':'o-searchview-custom-public').append($('<a>',{'href':'#'}).text(filter.name)).append($('<span>',{class:'fa fa-trash-o o-remove-filter',on:{click:function(event){event.stopImmediatePropagation();self.remove_filter(filter,$filter,key);},},})).insertBefore(this.$divider);this.$filters[key]=$filter;}
this.$filters[key].unbind('click').click(function(){self.toggle_filter(filter);});},toggle_filter:function(filter,preventSearch){var current=this.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.query.remove(current);this.$filters[this.key_for(filter)].removeClass('selected');return;}
this.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});if(!_.isUndefined(filter.sort)){var sort_items=JSON.parse(filter.sort);this.searchview.dataset.set_sort(sort_items);}
this.$filters[this.key_for(filter)].addClass('selected');},remove_filter:function(filter,$filter,key){var self=this;var global_warning=_t("This filter is global and will be removed for everybody if you continue."),warning=_t("Are you sure that you want to remove this filter?");if(!confirm(filter.user_id?warning:global_warning)){return;}
return data_manager.delete_filter(filter).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];if(_.isEmpty(self.filters)){self.$divider.hide();}});},});});odoo.define('web.FilterMenu',function(require){"use strict";var data_manager=require('web.data_manager');var search_filters=require('web.search_filters');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');return Widget.extend({template:'SearchView.FilterMenu',events:{'click .o_add_filter':function(event){event.preventDefault();this.toggle_custom_filter_menu();},'click li':function(event){event.preventDefault();event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_custom_filter_menu(false);},'click .o_add_condition':'append_proposition','click .o_apply_filter':'commit_search','keyup .o_searchview_extended_prop_value':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.commit_search();}},},init:function(parent,filters){this._super(parent);this.filters=filters||[];this.searchview=parent;this.propositions=[];this.custom_filters_open=false;},start:function(){var self=this;this.$menu=this.$('.o_filters_menu');this.$add_filter=this.$('.o_add_filter');this.$apply_filter=this.$('.o_apply_filter');this.$add_filter_menu=this.$('.o_add_filter_menu');_.each(this.filters,function(group){if(group.is_visible()){group.insertBefore(self.$add_filter);$('<li class="divider">').insertBefore(self.$add_filter);}});},get_fields:function(){if(!this._fields_def){this._fields_def=data_manager.load_fields(this.searchview.dataset).then(function(data){var fields={id:{string:'ID',type:'id',searchable:true}};_.each(data,function(field_def,field_name){if(field_def.selectable!==false&&field_name!=='id'){fields[field_name]=field_def;}});return fields;});}
return this._fields_def;},toggle_custom_filter_menu:function(is_open){var self=this;this.custom_filters_open=!_.isUndefined(is_open)?is_open:!this.custom_filters_open;var def;if(this.custom_filters_open&&!this.propositions.length){def=this.append_proposition();}
$.when(def).then(function(){self.$add_filter.toggleClass('o_closed_menu',!self.custom_filters_open).toggleClass('o_open_menu',self.custom_filters_open);self.$add_filter_menu.toggle(self.custom_filters_open);self.$('.o_filter_condition').toggle(self.custom_filters_open);});},append_proposition:function(){var self=this;return this.get_fields().then(function(fields){var prop=new search_filters.ExtendedSearchProposition(self,fields);self.propositions.push(prop);prop.insertBefore(self.$add_filter_menu);self.$apply_filter.prop('disabled',false);return prop;});},remove_proposition:function(prop){this.propositions=_.without(this.propositions,prop);if(!this.propositions.length){this.$apply_filter.prop('disabled',true);}
prop.destroy();},commit_search:function(){var filters=_.invoke(this.propositions,'get_filter'),filters_widgets=_.map(filters,function(filter){return new search_inputs.Filter(filter,this);}),filter_group=new search_inputs.FilterGroup(filters_widgets,this.searchview),facets=filters_widgets.map(function(filter){return filter_group.make_facet([filter_group.make_value(filter)]);});filter_group.insertBefore(this.$add_filter);$('<li class="divider">').insertBefore(this.$add_filter);this.searchview.query.add(facets,{silent:true});this.searchview.query.trigger('reset');_.invoke(this.propositions,'destroy');this.propositions=[];this.append_proposition();this.toggle_custom_filter_menu(false);},});});odoo.define('web.GroupByMenu',function(require){"use strict";var core=require('web.core');var data_manager=require('web.data_manager');var search_inputs=require('web.search_inputs');var Widget=require('web.Widget');var QWeb=core.qweb;return Widget.extend({template:'SearchView.GroupByMenu',events:{'click li':function(event){event.stopImmediatePropagation();},'hidden.bs.dropdown':function(){this.toggle_add_menu(false);},'click .o_add_custom_group a':function(event){event.preventDefault();this.toggle_add_menu();},},init:function(parent,groups){this._super(parent);this.groups=groups||[];this.groupable_fields=[];this.searchview=parent;},start:function(){this.$menu=this.$('.o_group_by_menu');var divider=this.$menu.find('.divider');_.invoke(this.groups,'insertBefore',divider);if(this.groups.length){divider.show();}
this.$add_group=this.$menu.find('.o_add_custom_group');},get_fields:function(){var self=this;if(!this._fields_def){this._fields_def=data_manager.load_fields(this.searchview.dataset).then(function(fields){var groupable_types=['many2one','char','boolean','selection','date','datetime'];var filter_group_field=_.filter(fields,function(field,name){if(field.sortable&&_.contains(groupable_types,field.type)){field.name=name;return field;}});self.groupable_fields=_.sortBy(filter_group_field,'string');self.$menu.append(QWeb.render('GroupByMenuSelector',self));self.$add_group_menu=self.$('.o_add_group');self.$group_selector=self.$('.o_group_selector');self.$('.o_select_group').click(function(){self.toggle_add_menu(false);var field=self.$group_selector.find(':selected').data('name');self.add_groupby_to_menu(field);});});}
return this._fields_def;},toggle_add_menu:function(is_open){var self=this;this.get_fields().then(function(){self.$add_group.toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);self.$add_group_menu.toggle(is_open);if(self.$add_group.hasClass('o_open_menu')){self.$group_selector.focus();}});},add_groupby_to_menu:function(field_name){var filter=new search_inputs.Filter({attrs:{context:"{'group_by':'"+field_name+"''}",name:_.find(this.groupable_fields,{name:field_name}).string,}},this.searchview);var group=new search_inputs.FilterGroup([filter],this.searchview),divider=this.$('.divider').show();group.insertBefore(divider);group.toggle(filter);},});});;

/* /web/static/src/js/views/tree_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.TreeView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var pyeval=require('web.pyeval');var session=require('web.session');var View=require('web.View');var _lt=core._lt;var QWeb=core.qweb;var TreeView=View.extend({display_name:_lt('Tree'),icon:'fa-align-left',searchable:false,init:function(){this._super.apply(this,arguments);this.records={};_.bindAll(this,'color_for');this.fields=this.fields_view.fields;this.children_field=this.fields_view.field_parent;},fields_list:function(){var fields=_.keys(this.fields);if(!_(fields).contains(this.children_field)){fields.push(this.children_field);}
return fields;},willStart:function(){_(this.fields_view.arch.children).each(function(field){if(field.attrs.modifiers&&typeof field.attrs.modifiers==="string"){field.attrs.modifiers=JSON.parse(field.attrs.modifiers);}});if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
return this._super();},start:function(){var self=this;var has_toolbar=!!this.fields_view.arch.attrs.toolbar;this.hook_row_click();this.$el.html(QWeb.render('TreeView',{'title':this.fields_view.arch.attrs.string,'fields_view':this.fields_view.arch.children,'fields':this.fields,'toolbar':has_toolbar}));this.$el.addClass(this.fields_view.arch.attrs['class']);this.dataset.read_slice(this.fields_list()).done(function(records){if(!has_toolbar){self.getdata(null,_(records).pluck('id'));return;}
var $select=self.$('select').change(function(){var $option=$(this).find(':selected');self.getdata($option.val(),$option.data('children'));});_(records).each(function(record){self.records[record.id]=record;$('<option>').val(record.id).text(record.name).data('children',record[self.children_field]).appendTo($select);});if(!_.isEmpty(records)){$select.change();}});this.do_push_state({});return this._super();},color_for:function(record){if(!this.colors){return'';}
var context=_.extend({},record,{uid:session.uid,current_date:moment().format('YYYY-MM-DD')});for(var i=0,len=this.colors.length;i<len;++i){var pair=this.colors[i],color=pair[0],expression=pair[1];if(py.PY_isTrue(py.evaluate(expression,context))){return'color: '+color+';';}}
return'';},hook_row_click:function(){var self=this;this.$el.delegate('.treeview-td span, .treeview-tr span','click',function(e){e.stopImmediatePropagation();self.activate($(this).closest('tr').data('id'));});this.$el.delegate('.treeview-tr','click',function(){var is_loaded=0,$this=$(this),record_id=$this.data('id'),row_parent_id=$this.data('row-parent-id'),record=self.records[record_id],children_ids=record[self.children_field];_(children_ids).each(function(childid){if(self.$('[id=treerow_'+childid+'][data-row-parent-id='+record_id+']').length){if(self.$('[id=treerow_'+childid+'][data-row-parent-id='+record_id+']').is(':hidden')){is_loaded=-1;}else{is_loaded++;}}});if(is_loaded===0){if(!$this.parent().hasClass('o_open')){self.getdata(record_id,children_ids);}}else{self.showcontent($this,record_id,is_loaded<0);}});},getdata:function(id,children_ids){var self=this;self.dataset.read_ids(children_ids,this.fields_list()).done(function(records){_(records).each(function(record){self.records[record.id]=record;});var $curr_node=self.$('#treerow_'+id);var children_rows=QWeb.render('TreeView.rows',{'records':records,'children_field':self.children_field,'fields_view':self.fields_view.arch.children,'fields':self.fields,'level':$curr_node.data('level')||0,'render':formats.format_value,'color_for':self.color_for,'row_parent_id':id});if($curr_node.length){$curr_node.addClass('o_open');$curr_node.after(children_rows);}else{self.$('tbody').html(children_rows);}});},activate:function(id){var self=this;var local_context={active_model:self.model,active_id:id,active_ids:[id]};var ctx=pyeval.eval('context',new data.CompoundContext(this.dataset.get_context(),local_context));return this.rpc('/web/treeview/action',{id:id,model:this.model,context:ctx}).then(function(actions){if(!actions.length){return;}
var action=actions[0][2];var c=new data.CompoundContext(local_context).set_eval_context(ctx);if(action.context){c.add(action.context);}
action.context=c;return self.do_action(action);});},showcontent:function(curnode,record_id,show){curnode.parent('tr').toggleClass('o_open',show);_(this.records[record_id][this.children_field]).each(function(child_id){var $child_row=this.$('[id=treerow_'+child_id+'][data-row-parent-id='+curnode.data('id')+']');if($child_row.hasClass('o_open')){$child_row.toggleClass('o_open',show);this.showcontent($child_row,child_id,false);}
$child_row.toggle(show);},this);},});core.view_registry.add('tree',TreeView);return TreeView;});;

/* /web/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var Model=require('web.DataModel');var session=require('web.session');var web_client=require('web.web_client');var Widget=require('web.Widget');var _t=core._t;var apps_client=null;var qweb=core.qweb;var Apps=Widget.extend({template:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){d.resolve(client);};var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return d.promise();};if(apps_client){return check_client_available(apps_client);}else{var Mod=new Model('ir.module.module');return Mod.call('get_apps_server').then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message."+this.uniq);if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){self.session.rpc.apply(self.session,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){var M=new Model(m.model);M[m.method].apply(M,m.args).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},_on_update_count:function(m){var self=this;var count=m.count;var get_upd_menu_id=function(){if(_.isUndefined(self._upd_menu_id)){var IMD=new Model('ir.model.data');return IMD.call('get_object_reference',['base','menu_module_updates']).then(function(r){var mid=r[1];if(r[0]!=='ir.ui.menu'){mid=null;}
self._upd_menu_id=mid;return mid;});}else{return $.Deferred().resolve(self._upd_menu_id).promise();}};$.when(get_upd_menu_id()).done(function(menu_id){if(_.isNull(menu_id)){return;}
var $menu=web_client.menu.$secondary_menus.find(_.str.sprintf('a[data-menu=%s]',menu_id));if($menu.length===0){return;}
if(_.isUndefined(count)){count=0;}
var needupdate=$menu.find('#menu_counter');if(needupdate&&needupdate.length!==0){if(count>0){needupdate.text(count);}else{needupdate.remove();}}else if(count>0){$menu.append(qweb.render("Menu.needaction_counter",{widget:{needaction_counter:count}}));}});},start:function(){var self=this;var def=$.Deferred();self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(session.debug){qs.debug=session.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'750px'};self.$ifr=$('<iframe>').attr('src',u);self.uniq=_.uniqueId('apps');$(window).on("message."+self.uniq,self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:this.session.db,origin:this.session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:update_count',self,self._on_update_count);self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$el).css(css).addClass('apps-client');def.resolve();},function(){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);return session.rpc('/web/action/load',{action_id:self.failback_action_id}).then(function(action){return self.do_action(action);}).always(function(){def.reject();});});return def;},});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /account/static/src/js/account_reconciliation_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('account.reconciliation',function(require){"use strict";var ActionManager=require('web.ActionManager');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var utils=require('web.utils');var CrashManager=require('web.CrashManager');var data=require('web.data');var Dialog=require('web.Dialog');var formats=require('web.formats');var FormView=require('web.FormView');var ListView=require('web.ListView');var Model=require('web.Model');var pyeval=require('web.pyeval');var web_client=require('web.web_client');var parse_value=require('web.web_client');var Widget=require('web.Widget');var session=require('web.session');var FieldMany2One=core.form_widget_registry.get('many2one');var FieldChar=core.form_widget_registry.get('char');var FieldFloat=core.form_widget_registry.get('float');var _t=core._t;var QWeb=core.qweb;var bus=core.bus;function defaultIfUndef(variable,defaultValue){return variable===undefined?defaultValue:variable;}
var abstractReconciliation=Widget.extend(ControlPanelMixin,{className:'o_reconciliation',events:{"click *[rel='do_action']":"doActionClickHandler","click .presets_config_create":"presetConfigCreateClickHandler","click .presets_config_edit":"presetConfigEditClickHandler",},init:function(parent,context){this._super(parent);this.lines_reconciled_with_ctrl_enter=0;this.time_widget_loaded=Date.now();this.action_manager=this.findAncestor(function(ancestor){return ancestor instanceof ActionManager});this.crash_manager=new CrashManager();this.formatCurrencies;this.model_res_users=new Model("res.users");this.model_tax=new Model("account.tax");this.model_presets=new Model("account.reconcile.model");this.max_move_lines_displayed=5;this.num_reconciliations_fetched_in_batch=10;this.animation_speed=100;this.aestetic_animation_speed=300;this.map_account_id_code={};this.presets={};var domain_account_id=[['deprecated','=',false]];if(context&&context.context&&context.context.company_ids){domain_account_id.push(['company_id','in',context.context.company_ids]);}
this.create_form_fields={account_id:{id:"account_id",index:0,corresponding_property:"account_id",label:_t("Account"),required:true,constructor:FieldMany2One,field_properties:{relation:"account.account",string:_t("Account"),type:"many2one",domain:domain_account_id,},},label:{id:"label",index:5,corresponding_property:"label",label:_t("Label"),required:true,constructor:FieldChar,field_properties:{string:_t("Label"),type:"char",},},tax_id:{id:"tax_id",index:10,corresponding_property:"tax_id",label:_t("Tax"),required:false,constructor:FieldMany2One,field_properties:{relation:"account.tax",string:_t("Tax"),type:"many2one",domain:[['type_tax_use','!=','none']],},},amount:{id:"amount",index:15,corresponding_property:"amount",label:_t("Amount"),required:true,constructor:FieldFloat,field_properties:{string:_t("Amount"),type:"float",},},analytic_account_id:{id:"analytic_account_id",index:20,corresponding_property:"analytic_account_id",label:_t("Analytic Acc."),required:false,group:"analytic.group_analytic_accounting",constructor:FieldMany2One,field_properties:{relation:"account.analytic.account",string:_t("Analytic Acc."),type:"many2one",},},};},start:function(){var self=this;return $.when(this._super()).then(function(){var deferred_promises=[];deferred_promises.push(new Model("account.account").query(['id','code']).all().then(function(data){_.each(data,function(o){self.map_account_id_code[o.id]=o.code});}));deferred_promises.push(self.fetchPresets());deferred_promises.push(new Model("res.currency").call("get_format_currencies_js_function").then(function(data){self.formatCurrencies=new Function("amount, currency_id",data);}));bus.on("keypress","body",function(e){self.keyboardShortcutsHandler(e);});self.update_cp();return $.when.apply($,deferred_promises);});},fetchPresets:function(){var self=this;var deferred_last_update=self.model_presets.query(['write_date']).order_by('-write_date').first().then(function(data){self.presets_last_write_date=(data?data.write_date:undefined);});var deferred_presets=self.model_presets.query().order_by('-sequence','-id').all().then(function(data){self.presets={};_(data).each(function(datum){var preset={id:datum.id,name:datum.name,sequence:datum.sequence,lines:[{account_id:datum.account_id,journal_id:datum.journal_id,label:datum.label,amount_type:datum.amount_type,amount:datum.amount,tax_id:datum.tax_id,analytic_account_id:datum.analytic_account_id}]};if(datum.has_second_line){preset.lines.push({account_id:datum.second_account_id,journal_id:datum.second_journal_id,label:datum.second_label,amount_type:datum.second_amount_type,amount:datum.second_amount,tax_id:datum.second_tax_id,analytic_account_id:datum.second_analytic_account_id});}
self.presets[datum.id]=preset;});});return $.when(deferred_last_update,deferred_presets);},do_show:function(){var self=this;var super_call=_.bind(this._super,this);self.model_presets.query(['write_date']).order_by('-write_date').first().then(function(data){if(!data||data.write_date!=self.presets_last_write_date){self.fetchPresets().then(function(){_.each(self.getChildren(),function(child){child.set("presets",self.presets);});});}
super_call();});self.update_cp();},update_cp:function(){var self=this;self.update_control_panel({breadcrumbs:self.action_manager.get_breadcrumbs(),});},doActionClickHandler:function(e){e.preventDefault();var name=e.currentTarget.dataset.action_nam;var model=e.currentTarget.dataset.model;var ids=e.currentTarget.dataset.ids.split(",").map(Number);this.action_manager.do_action({name:name,res_model:model,domain:[['id','in',ids]],views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_type:"list",view_mode:"list"});},presetConfigCreateClickHandler:function(e){e.preventDefault();var self=this;return self.rpc("/web/action/load",{action_id:"account.action_account_reconcile_model"}).then(function(result){result.views=[[false,"form"],[false,"list"]];return self.do_action(result);});},presetConfigEditClickHandler:function(e){e.preventDefault();var self=this;return self.rpc("/web/action/load",{action_id:"account.action_account_reconcile_model"}).then(function(result){result.views=[[false,"list"],[false,"form"]];return self.do_action(result);});},displayNotifications:function(notifications,speed){speed=defaultIfUndef(speed,this.aestetic_animation_speed)
for(var i=0;i<notifications.length;i++){var $notification=$(QWeb.render("reconciliation_notification",{type:notifications[i].type,message:notifications[i].message,details:notifications[i].details,})).hide();$notification.appendTo(this.$(".notification_area")).slideDown(speed);}},renderPresetsButtons:function(presets){var presets_array=[];for(var id in presets)
if(presets.hasOwnProperty(id))
presets_array.push(presets[id]);presets_array=_.sortBy(presets_array,function(o){return o.sequence});var temp=$("<div class='quick_add'><div class='btn-group btn-group-sm sandbox_lillibullero'></div></div>").appendTo(this.$el);var sandbox_dom=this.$(".sandbox_lillibullero");var dropdown_width=$(QWeb.render("presets_dropdown",{presets:[]})).appendTo(sandbox_dom).outerWidth();var max_width=540;var total_width=0;var html="";while(presets_array.length>0){var preset=presets_array[0];var preset_html=QWeb.render("preset_button",{id:preset.id,name:preset.name});var actual_max_width=(presets_array.length===1?max_width:max_width-dropdown_width);total_width+=$(preset_html).appendTo(sandbox_dom).outerWidth();if(total_width<actual_max_width){html+=preset_html;presets_array.shift();}else{break;}}
if(presets_array.length>0){html+=QWeb.render("presets_dropdown",{presets:presets_array});}
temp.remove();return html;},keyboardShortcutsHandler:function(e){var self=this;if((e.which===13||e.which===10)&&(e.ctrlKey||e.metaKey)){self.processReconciliations(_.filter(self.getChildren(),function(o){return self.monetaryIsZero(o.get("balance"));}));}},processReconciliations:function(reconciliations){},displayReconciliation:function(){},childValidated:function(child){},displayDoneMessage:function(){},updateProgressbar:function(){},decorateMoveLine:function(line){line.partial_reconcile=false;line.propose_partial_reconcile=false;line.q_due_date=(line.date_maturity===false?line.date:line.date_maturity);line.q_amount=(line.debit!==0?line.q_debit:"")+(line.credit!==0?line.q_credit:"");line.q_label=line.name;var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_move_line_details")?this.template_prefix:"")+"reconciliation_move_line_details";line.q_popover=QWeb.render(template_name,{line:line});if(line.ref&&line.ref!==line.name)
line.q_label=line.q_label+" : "+line.ref;},monetaryIsZero:function(amount,digits){return utils.float_is_zero(amount,digits===undefined?4:digits);},});var abstractReconciliationLine=Widget.extend({className:'o_reconciliation_line',events:{"click .mv_line":"moveLineClickHandler","click .created_line":"createdLineClickHandler","click .pager_control_left:not(.disabled)":"pagerControlLeftHandler","click .pager_control_right:not(.disabled)":"pagerControlRightHandler","keyup .filter":"filterHandler","click .add_line":"addLineBeingEdited","click .preset":"presetClickHandler","click .line_info_button":function(e){e.stopPropagation()},"mousedown *[tabindex='0']":function(e){e.preventDefault()},},init:function(parent,context){this._super(parent);var self=this;this.decorateMoveLine=this.getParent().decorateMoveLine;this.formatCurrencies=this.getParent().formatCurrencies;this.monetaryIsZero=this.getParent().monetaryIsZero;this.renderPresetsButtons=this.getParent().renderPresetsButtons;if(context.initial_data_provided===true&&(context.reconciliation_proposition===undefined||context.line===undefined))
console.error("[Warning] bankStatementReconciliationLine instanciated with incorrect context.");if(context.initial_data_provided){this.partner_id=context.line.partner_id;_.each(context.reconciliation_proposition,function(line){self.decorateMoveLine(line);},this);this.set("mv_lines_selected",context.reconciliation_proposition);}else{this.set("mv_lines_selected",[]);}
this.context=context;this.max_move_lines_displayed=this.getParent().max_move_lines_displayed;this.animation_speed=this.getParent().animation_speed;this.aestetic_animation_speed=this.getParent().aestetic_animation_speed;this.model_res_users=this.getParent().model_res_users;this.model_tax=this.getParent().model_tax;this.map_account_id_code=this.getParent().map_account_id_code;this.is_valid=true;this.is_consistent=true;this.can_fetch_more_move_lines;this.filter="";this.finishedLoadingMoveLines;this.set("presets",this.getParent().presets);this.on("change:presets",this,this.presetsChanged);this.set("mode",undefined);this.on("change:mode",this,this.modeChanged);this.set("balance",undefined);this.on("change:balance",this,this.balanceChanged);this.set("pager_index",0);this.on("change:pager_index",this,this.pagerChanged);this.set("mv_lines",[]);this.on("change:mv_lines",this,this.mvLinesChanged);this.mv_lines_deselected=[];this.on("change:mv_lines_selected",this,this.mvLinesSelectedChanged);this.set("lines_created",[]);this.set("line_created_being_edited",[{'id':0}]);this.on("change:lines_created",this,this.createdLinesChanged);this.on("change:line_created_being_edited",this,this.createdLinesChanged);},start:function(){var self=this;var parent=this.getParent();return self._super().then(function(){self.animation_speed=0;self.aestetic_animation_speed=0;self.is_consistent=false;if(self.context.animate_entrance){self.$el.fadeOut(0);self.$el.slideUp(0);}
return $.when(self.loadData()).then(function(){return $.when(self.render()).then(function(){self.is_consistent=true;self.animation_speed=parent.animation_speed;self.aestetic_animation_speed=parent.aestetic_animation_speed;if(self.context.animate_entrance){return self.$el.stop(true,true).fadeIn({duration:self.aestetic_animation_speed,queue:false}).css('display','none').slideDown(self.aestetic_animation_speed);}});});});},loadData:function(){},render:function(){},createFormWidgets:function(){var self=this;var create_form_fields=self.getParent().create_form_fields;var create_form_fields_arr=[];for(var key in create_form_fields)
if(create_form_fields.hasOwnProperty(key))
create_form_fields_arr.push(create_form_fields[key]);create_form_fields_arr.sort(function(a,b){return a.index-b.index});var dataset=new data.DataSet(this,"account.account",self.context);dataset.ids=[];var fields_view={};fields_view.arch={attrs:{string:"Stéphanie de Monaco",version:"7.0",class:"oe_form_container o_form_container"},children:[],tag:"form"};self.field_manager=new FormView(this,dataset,fields_view,{initial_mode:'edit',disable_autofocus:false,$buttons:$(),$pager:$()});self.field_manager.appendTo(document.createDocumentFragment());var Default_field=function(){this.context={};this.domain=[];this.help="";this.readonly=false;this.required=true;this.selectable=true;this.states={};this.views={};};var Default_node=function(field_name){this.tag="field";this.children=[];this.required=true;this.attrs={invisible:"False",modifiers:'{"required":true}',name:field_name,nolabel:"True",};};self.field_manager.fields_view.fields={};for(var i=0;i<create_form_fields_arr.length;i++){self.field_manager.fields_view.fields[create_form_fields_arr[i].id]=_.extend(new Default_field(),create_form_fields_arr[i].field_properties);}
var hideGroupResponseClosureFactory=function(field_widget,$container,obj_key){return function(has_group){if(has_group)$container[0].style.removeProperty('display');else{field_widget.destroy();$container.remove();delete self[obj_key];}};};self.create_form=[];for(var i=0;i<create_form_fields_arr.length;i++){var field_data=create_form_fields_arr[i];var node=new Default_node(field_data.id);if(!field_data.required)node.attrs.modifiers="";var field=new field_data.constructor(self.field_manager,node);self[field_data.id+"_field"]=field;self.create_form.push(field);field.corresponding_property=field_data.corresponding_property;field.on("change:value",self,self.formCreateInputChanged);var $field_container=$(QWeb.render("form_create_field",{id:field_data.id,label:field_data.label}));field.appendTo($field_container.find(".o_td_field"));self.$(".create_group_"+(i%2===0?"left":"right")).append($field_container);if(field_data.field_properties.type!=="many2one"){field.$el.find('input').andSelf().filter('input').keyup(function(){this.store_dom_value();}.bind(field));}
if(field_data.group!==undefined){var target=$field_container;target.hide();self.model_res_users.call("has_group",[field_data.group]).then(hideGroupResponseClosureFactory(field,target,(field_data.id+"_field")));}}
self.field_manager.do_show();},bindPopoverTo:function(el){var self=this;$(el).addClass("bootstrap_popover");el.popover({'placement':'left','container':self.el,'html':true,'trigger':'hover','animation':false,'toggle':'popover'});},islineCreatedBeingEditedValid:function(){var line=this.get("line_created_being_edited")[0];return line.amount&&line.account_id&&line.label;},getCreatedLines:function(){var self=this;var created_lines=self.get("lines_created").slice();if(self.islineCreatedBeingEditedValid())
return created_lines.concat(self.get("line_created_being_edited"));else
return created_lines;},moveLineClickHandler:function(e){var self=this;if(e.currentTarget.dataset.selected==="true")self.deselectMoveLine(e.currentTarget);else self.selectMoveLine(e.currentTarget);},selectMoveLine:function(mv_line){var self=this;var line_id=mv_line.dataset.lineid;var line=_.find(self.get("mv_lines"),function(o){return o.id==line_id});if(!line){line=_.find(self.mv_lines_deselected,function(o){return o.id==line_id});self.mv_lines_deselected=_.filter(self.mv_lines_deselected,function(o){return o.id!=line_id});}
if(!line)return;return line;},deselectMoveLine:function(mv_line){var self=this;var line_id=mv_line.dataset.lineid;var line=_.find(self.get("mv_lines_selected"),function(o){return o.id==line_id});if(!line)return;$(mv_line).attr('data-selected','false');self.mv_lines_deselected.unshift(line);self.set("mv_lines_selected",_.filter(self.get("mv_lines_selected"),function(o){return o.id!=line_id}));self.$el.removeClass("no_match");self.set("mode","match");return line;},pagerControlLeftHandler:function(){var self=this;if(self.$(".pager_control_left").hasClass("disabled")){return;}
if(self.get("pager_index")===0){return;}
self.set("pager_index",self.get("pager_index")-1);},pagerControlRightHandler:function(){var self=this;var new_index=self.get("pager_index")+1;if(self.$(".pager_control_right").hasClass("disabled")){return;}
if(!self.can_fetch_more_move_lines){return;}
self.set("pager_index",new_index);},filterHandler:function(){var self=this;self.set("pager_index",0);self.filter=self.$(".filter").val();window.clearTimeout(self.apply_filter_timeout);self.apply_filter_timeout=window.setTimeout(self.proxy('updateMatches'),200);},initializeCreateForm:function(){var self=this;_.each(self.create_form,function(field){field.set("value",false);});self.amount_field.set("value",-1*self.get("balance"));self.account_id_field.focus();},addLineBeingEdited:function(){var self=this;if(!self.islineCreatedBeingEditedValid())return;self.set("lines_created",self.get("lines_created").concat(self.get("line_created_being_edited")));var new_id=self.get("line_created_being_edited")[0].id+1;self.set("line_created_being_edited",[{'id':new_id}]);self.initializeCreateForm();},createdLineClickHandler:function(e){this.removeLine($(e.currentTarget));},removeLine:function($line){var self=this;var line_id=$line.data("lineid");if(line_id===self.get("line_created_being_edited")[0].id){self.addLineBeingEdited();}
self.set("lines_created",_.filter(self.get("lines_created"),function(o){return o.id!=line_id}));self.amount_field.set("value",-1*self.get("balance"));},presetClickHandler:function(e){var self=this;var preset=this.get("presets")[e.currentTarget.dataset.presetid];for(var i=0;i<preset.lines.length;i++){self.addLineBeingEdited();self.applyPresetLine(preset.lines[i]);}},applyPresetLine:function(preset_line){var self=this;self.initializeCreateForm();if(preset_line.tax&&self.tax_field)self.tax_field.set_value(false);if(preset_line.amount&&self.amount_field)self.amount_field.set_value(false);for(var key in preset_line){if(!preset_line.hasOwnProperty(key)||key==="amount")continue;if(preset_line[key]&&self.hasOwnProperty(key+"_field"))
self[key+"_field"].set_value(preset_line[key]);}
if(preset_line.amount&&self.amount_field){if(preset_line.amount_type==="fixed")
self.amount_field.set_value(preset_line.amount);else if(preset_line.amount_type==="percentage"){self.amount_field.set_value(0);self.updateBalance();var currency_dict=session.get_currency(self.get("currency_id"));var preset_amount=utils.round_currency(currency_dict,-1*self.get("balance")*preset_line.amount/100);self.amount_field.set_value(preset_amount);}}},updateAccountingViewMatchedLines:function(){var self=this;$.each(self.$(".tbody_matched_lines .bootstrap_popover"),function(){$(this).popover('destroy')});self.$(".tbody_matched_lines").empty();var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_move_line")?this.template_prefix:"")+"reconciliation_move_line";_(self.get("mv_lines_selected")).each(function(line){line.amount_str=self.formatCurrencies(Math.abs(line.debit+line.credit),self.get("currency_id"));var $line=$(QWeb.render(template_name,{line:line,selected:true}));self.bindPopoverTo($line.find(".line_info_button"));if(line.propose_partial_reconcile)self.bindPopoverTo($line.find(".do_partial_reconcile_button"));if(line.partial_reconcile)self.bindPopoverTo($line.find(".undo_partial_reconcile_button"));self.$(".tbody_matched_lines").append($line);});},updateAccountingViewCreatedLines:function(){var self=this;$.each(self.$(".tbody_created_lines .bootstrap_popover"),function(){$(this).popover('destroy')});self.$(".tbody_created_lines").empty();var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_created_line")?this.template_prefix:"")+"reconciliation_created_line";var previous_line=undefined;_(self.getCreatedLines()).each(function(line){line.amount_str=self.formatCurrencies(Math.abs(line.amount),self.get("currency_id"));if(previous_line!==undefined&&self.monetaryIsZero(line.amount)&&previous_line.id===line.id)
line.amount=0.000001*(previous_line.amount<0?-1:1);var $line=$(QWeb.render(template_name,{line:line}));self.$(".tbody_created_lines").append($line);if(line.no_remove_action){var $first_line=self.$(".tbody_created_lines .created_line[data-lineid='"+line.id+"']").first();$line.hover(function(){this.addClass("active")}.bind($first_line),function(){this.removeClass("active")}.bind($first_line));}
previous_line=line;});},updateMatchView:function(){var self=this;var table=self.$(".match table");var nothing_displayed=true;var template_name=(QWeb.has_template(this.template_prefix+"reconciliation_move_line")?this.template_prefix:"")+"reconciliation_move_line";$.each(self.$(".match table .bootstrap_popover"),function(){$(this).popover('destroy')});table.empty();var slice_start=self.get("pager_index")*self.max_move_lines_displayed;var slice_end=(self.get("pager_index")+1)*self.max_move_lines_displayed;_(_.filter(self.mv_lines_deselected,function(o){var floatFromFilter=false;try{floatFromFilter=parse_value(self.filter,{type:'float'});}catch(e){}
return o.name.indexOf(self.filter)!==-1||(o.ref&&o.ref.indexOf(self.filter)!==-1)||(isFinite(floatFromFilter)&&(o.debit===floatFromFilter||o.credit===floatFromFilter||o.debit_currency===floatFromFilter||o.credit_currency===floatFromFilter))}).slice(slice_start,slice_end)).each(function(line){var $line=$(QWeb.render(template_name,{line:line,selected:false}));self.bindPopoverTo($line.find(".line_info_button"));table.append($line);nothing_displayed=false;});_(self.get("mv_lines")).each(function(line){var $line=$(QWeb.render(template_name,{line:line,selected:false}));self.bindPopoverTo($line.find(".line_info_button"));table.append($line);nothing_displayed=false;});if(nothing_displayed&&this.filter!=="")
table.append(QWeb.render("filter_no_match",{filter_str:self.filter}));},updatePagerControls:function(){var self=this;if(self.get("pager_index")===0)
self.$(".pager_control_left").addClass("disabled");else
self.$(".pager_control_left").removeClass("disabled");if(!self.can_fetch_more_move_lines)
self.$(".pager_control_right").addClass("disabled");else
self.$(".pager_control_right").removeClass("disabled");},lineOpenBalanceClickHandler:function(){var self=this;if(self.get("mode")==="create"){self.set("mode","match");}else{self.set("mode","create");}},balanceChanged:function(){},presetsChanged:function(){if($.isEmptyObject(this.get("presets"))){this.$(".quick_add").hide();}else{this.$(".presets_container").html(this.renderPresetsButtons(this.get("presets")));this.$(".quick_add").show();}},modeChanged:function(o,val){var self=this;self.$(".action_pane.active").removeClass("active");if(val.oldValue==="create")
self.addLineBeingEdited();if(self.get("mode")==="inactive"){self.$(".match").slideUp(self.animation_speed);self.$(".create").slideUp(self.animation_speed);self.el.dataset.mode="inactive";if(self.finishedLoadingMoveLines)self.finishedLoadingMoveLines.resolve();}else if(self.get("mode")==="match"){self.updateMatches().then(function(){if(self.$el.hasClass("no_match")){self.$(".create").stop(true,false);self.set("mode","create");return;}
self.$(".match").slideDown(self.animation_speed);self.$(".create").slideUp(self.animation_speed);self.el.dataset.mode="match";if(self.finishedLoadingMoveLines)self.finishedLoadingMoveLines.resolve();});}else if(self.get("mode")==="create"){self.initializeCreateForm();self.$(".match").slideUp(self.animation_speed);self.$(".create").slideDown(self.animation_speed);self.el.dataset.mode="create";if(self.finishedLoadingMoveLines)self.finishedLoadingMoveLines.resolve();}},pagerChanged:function(){this.updateMatches();},mvLinesChanged:function(){var self=this;if(self.get("pager_index")!==0&&self.get("mv_lines").length===0&&!self.can_fetch_more_move_lines){self.set("pager_index",0);}
if(self.get("mv_lines").length+self.mv_lines_deselected.length===0&&!self.can_fetch_more_move_lines&&self.filter===""){self.$el.addClass("no_match");if(self.get("mode")==="match"){self.set("mode","inactive");}}else{self.$el.removeClass("no_match");}
self.updateMatchView();self.updatePagerControls();},mvLinesSelectedChanged:function(elt,val){var self=this;$.when(self.updateMatches()).then(function(){self.updateAccountingViewMatchedLines();self.updateBalance();});},updateMatches:function(){var self=this;var deselected_lines_num=self.mv_lines_deselected.length;var offset=self.get("pager_index")*self.max_move_lines_displayed-deselected_lines_num;if(offset<0)offset=0;var limit=(self.get("pager_index")+1)*self.max_move_lines_displayed-deselected_lines_num;if(limit>self.max_move_lines_displayed)limit=self.max_move_lines_displayed;var excluded_ids=_.collect(self.get("mv_lines_selected").concat(self.mv_lines_deselected),function(o){return o.id;});limit+=1;if(limit>0)
return self.updateMatchesGetMvLines(excluded_ids,offset,limit,function(move_lines){self.can_fetch_more_move_lines=(move_lines.length===limit);self.set("mv_lines",move_lines.slice(0,limit-1));});else
self.set("mv_lines",[]);},updateMatchesGetMvLines:function(excluded_ids,offset,limit,callback){},formCreateInputChanged:function(elt,val){var self=this;var line_created_being_edited=self.get("line_created_being_edited");line_created_being_edited[0][elt.corresponding_property]=val.newValue;if(elt===self.account_id_field)
line_created_being_edited[0].account_num=self.map_account_id_code[elt.get("value")];var deferred_tax=new $.Deferred();if(elt===self.tax_id_field||elt===self.amount_field){var amount=self.amount_field.get("value");var tax_id=self.tax_id_field.get("value");if(amount&&tax_id){deferred_tax=self.model_tax.call("json_friendly_compute_all",[[tax_id],amount,self.get("currency_id")]).then(function(data){line_created_being_edited.length=1;line_created_being_edited[0].amount_before_tax=amount;line_created_being_edited[0].amount=data.total_excluded;$.each(data.taxes,function(index,tax){var tax_account_id=(amount>0?tax.account_id:tax.refund_account_id);tax_account_id=tax_account_id!==false?tax_account_id:line_created_being_edited[0].account_id;line_created_being_edited.push({id:line_created_being_edited[0].id,account_id:tax_account_id,account_num:self.map_account_id_code[tax_account_id],label:tax.name,amount:tax.amount,no_remove_action:true,is_tax_line:true});});});}else{line_created_being_edited.length=1;deferred_tax.resolve();}}else{deferred_tax.resolve();}
return deferred_tax.then(function(){self.set("line_created_being_edited",line_created_being_edited);self.createdLinesChanged();});},createdLinesChanged:function(){var self=this;self.updateAccountingViewCreatedLines();self.updateBalance();if(self.islineCreatedBeingEditedValid())self.$(".add_line").show();else self.$(".add_line").hide();},updateBalance:function(){var self=this;var balance=0;var mv_lines_selected=self.get("mv_lines_selected");_.each(mv_lines_selected,function(o){balance=balance-o.debit+o.credit;});_.each(self.getCreatedLines(),function(o){balance+=o.amount;});balance=Math.round(balance*1000)/1000;self.set("balance",balance);},prepareCreatedMoveLinesForPersisting:function(lines){lines=_.filter(lines,function(line){return!line.is_tax_line});return _.collect(lines,function(line){var dict={account_id:line.account_id,name:line.label};var amount=line.tax_id?line.amount_before_tax:line.amount;dict['credit']=(amount>0?amount:0);dict['debit']=(amount<0?-1*amount:0);if(line.tax_id)dict['tax_ids']=[[4,line.tax_id,null]];if(line.analytic_account_id)dict['analytic_account_id']=line.analytic_account_id;return dict;});},bowOut:function(speed,doPostMortemProcess){speed=defaultIfUndef(speed,this.animation_speed);if(doPostMortemProcess)
var postMortemProcess=this.getPostMortemProcess();var self=this;var height=self.$el.outerHeight();var container=$("<div />");container.css("height",height).css("marginTop",self.$el.css("marginTop")).css("marginBottom",self.$el.css("marginBottom"));self.$el.wrap(container);return $.when(self.$el.parent().animate({height:0,marginBottom:0},speed*height/150)).then(function(){$.each(self.$(".bootstrap_popover"),function(){$(this).popover('destroy')});_.each(self.getChildren(),function(o){o.destroy()});self.$el.parent().remove();return $.when(self.destroy()).then(function(){if(doPostMortemProcess)
postMortemProcess.call(self);});});},getPostMortemProcess:function(){},});var bankStatementReconciliation=abstractReconciliation.extend({className:abstractReconciliation.prototype.className+' o_bank_statement_reconciliation',events:_.defaults({"click .statement_name span":"statementNameClickHandler","keyup .change_statement_name_field":"changeStatementNameFieldHandler","click .change_statement_name_button":"changeStatementButtonClickHandler","click .show_more":"showMoreButtonClickHandler",},abstractReconciliation.prototype.events),init:function(parent,context){this.children_widget=bankStatementReconciliationLine;this.template_prefix="bank_statement_";this._super(parent,context);if(context.context.statement_id)this.statement_ids=[context.context.statement_id];if(context.context.statement_ids)this.statement_ids=context.context.statement_ids;this.single_statement=this.statement_ids!==undefined&&this.statement_ids.length===1;this.multiple_statements=this.statement_ids!==undefined&&this.statement_ids.length>1;this.title=context.context.title||_t("Bank Reconciliation");context.display_name=this.title;this.notifications=context.context.notifications||[];this.lines=[];this.last_displayed_reconciliation_index=undefined;this.reconciled_lines=0;this.num_already_reconciled_lines=0;this.model_bank_statement=new Model("account.bank.statement");this.model_bank_statement_line=new Model("account.bank.statement.line");this.reconciliation_menu_id=false;this.excluded_move_lines_ids={};this.widget_childrens=[];},serverPreprocessResultHandler:function(data){this.num_already_reconciled_lines=data.num_already_reconciled_lines;this.notifications=this.notifications.concat(data.notifications);this.lines=data.st_lines_ids;if(this.single_statement&&data.statement_name)
this.title=data.statement_name;},start:function(){var self=this;return $.when(this._super()).then(function(){var deferred_promises=[];deferred_promises.push(self.model_bank_statement.call("reconciliation_widget_preprocess",[self.statement_ids||undefined]).then(function(data){self.serverPreprocessResultHandler(data)}));deferred_promises.push(new Model("ir.model.data").call("xmlid_to_res_id",["account.menu_bank_reconcile_bank_statements"]).then(function(data){self.reconciliation_menu_id=data;self.doReloadMenuReconciliation();}));return $.when.apply($,deferred_promises).then(function(){if(self.lines.length===0&&!self.statement_ids){self.$el.prepend(QWeb.render("bank_statement_nothing_to_reconcile"));if(self.notifications)
self.displayNotifications(self.notifications);return;}
self.$el.prepend(QWeb.render("bank_statement_reconciliation",{title:self.title,single_statement:self.single_statement,total_lines:self.num_already_reconciled_lines+self.lines.length}));self.$el.find('.js_automatic_reconciliation').click(function(){self.model_bank_statement_line.call("reconciliation_widget_auto_reconcile",[self.lines||undefined,self.num_already_reconciled_lines]).then(function(data){self.serverPreprocessResultHandler(data);}).then(function(){self.$('.js_automatic_reconciliation').hide();return self.display_reconciliation_propositions();});});return self.display_reconciliation_propositions();});});},display_reconciliation_propositions:function(){var self=this;self.updateProgressbar();var reconciliations_to_show=self.lines.slice(0,self.num_reconciliations_fetched_in_batch);self.last_displayed_reconciliation_index=reconciliations_to_show.length;self.$(".reconciliation_lines_container").css("opacity",0);$.each(self.widget_childrens,function(index,child){child.destroy();});if(self.lines.length===0){self.$(".reconciliation_lines_container").hide();if(self.notifications)
self.displayNotifications(self.notifications,0);self.displayDoneMessage(true);return;}
return self.model_bank_statement_line.call("get_data_for_reconciliation_widget",[reconciliations_to_show]).then(function(data){var child_promises=[];var datum=data.shift();if(datum!==undefined)
child_promises.push(self.displayReconciliation(datum.st_line.id,'match',false,true,datum.st_line,datum.reconciliation_proposition));while((datum=data.shift())!==undefined)
child_promises.push(self.displayReconciliation(datum.st_line.id,'inactive',false,true,datum.st_line,datum.reconciliation_proposition));$.when.apply($,child_promises).then(function(){self.$(".reconciliation_lines_container").animate({opacity:1},self.aestetic_animation_speed,function(){if(self.notifications){self.displayNotifications(self.notifications);self.updateShowMoreButton();}});});});},statementNameClickHandler:function(){if(!this.single_statement)return;this.$(".statement_name span").hide();this.$(".change_statement_name_field").attr("value",this.title);this.$(".change_statement_name_container").show();this.$(".change_statement_name_field").focus();},changeStatementNameFieldHandler:function(e){var name=this.$(".change_statement_name_field").val();if(name==="")this.$(".change_statement_name_button").attr("disabled","disabled");else this.$(".change_statement_name_button").removeAttr("disabled");if(name!==""&&e.which===13)
this.$(".change_statement_name_button").trigger("click");if(e.which===27){this.$(".statement_name span").show();this.$(".change_statement_name_container").hide();}},changeStatementButtonClickHandler:function(){var self=this;if(!self.single_statement)return;var name=self.$(".change_statement_name_field").val();if(name==="")return;self.$(".change_statement_name_button").attr("disabled","disabled");return self.model_bank_statement.call("write",[[self.statement_ids[0]],{'name':name}]).done(function(){self.title=name;self.$(".statement_name span").text(name).show();self.$(".change_statement_name_container").hide();}).always(function(){self.$(".change_statement_name_button").removeAttr("disabled");});},updateProgressbar:function(){var self=this;var done=self.num_already_reconciled_lines+self.reconciled_lines;var total=self.num_already_reconciled_lines+self.lines.length;var prog_bar=self.$(".progress .progress-bar");prog_bar.attr("aria-valuenow",done);prog_bar.css("width",(done/total*100)+"%");self.$(".progress .progress-text .valuenow").text(done);},processReconciliations:function(reconciliations){if(reconciliations.length===0)return;var self=this;var ids=_.collect(reconciliations,function(o){return o.line_id});var data=_.collect(reconciliations,function(o){return o.prepareDataForPersisting()});var deferred_animation=self.$(".reconciliation_lines_container, .show_more_container").fadeOut(self.aestetic_animation_speed);var deferred_rpc=self.model_bank_statement_line.call("process_reconciliations",[ids,data]);return $.when(deferred_animation,deferred_rpc).done(function(){for(var i=0;i<reconciliations.length;i++)
reconciliations[i].bowOut(0,false);self.lines_reconciled_with_ctrl_enter+=reconciliations.length;self.reconciled_lines+=reconciliations.length;self.updateProgressbar();self.doReloadMenuReconciliation();if(self.last_displayed_reconciliation_index<self.lines.length){return self.displayReconciliations(self.num_reconciliations_fetched_in_batch).then(function(){if(self.reconciled_lines!==self.lines.length){var first_child=self.getChildren()[0];if(first_child.get("mode")==="inactive"){first_child.set("mode","match");}}
self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);});}else if(self.reconciled_lines===self.lines.length){self.displayDoneMessage(false);}else{self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);}}).fail(function(){self.$(".reconciliation_lines_container, .show_more_container").fadeIn(self.aestetic_animation_speed);});},displayReconciliation:function(line_id,mode,animate_entrance,initial_data_provided,line,reconciliation_proposition){var self=this;animate_entrance=defaultIfUndef(animate_entrance,true);initial_data_provided=defaultIfUndef(initial_data_provided,false);var context={line_id:line_id,mode:mode,animate_entrance:animate_entrance,initial_data_provided:initial_data_provided,line:initial_data_provided?line:undefined,reconciliation_proposition:initial_data_provided?reconciliation_proposition:undefined,};var widget=new self.children_widget(self,context);this.widget_childrens.push(widget);return widget.appendTo(self.$(".reconciliation_lines_container"));},excludeMoveLines:function(source_child,partner_id,lines){var self=this;var line_ids=_.collect(lines,function(o){return o.id});var excluded_ids=this.excluded_move_lines_ids[partner_id];var excluded_move_lines_changed=false;_.each(line_ids,function(line_id){if(excluded_ids.indexOf(line_id)===-1){excluded_ids.push(line_id);excluded_move_lines_changed=true;}});if(!excluded_move_lines_changed)
return;var contains_lines=function(lines_array,line_ids){for(var i=0;i<lines_array.length;i++)
for(var j=0;j<line_ids.length;j++)
if(lines_array[i].id===line_ids[j])
return true;return false;};_.each(self.getChildren(),function(child){if(child===source_child||child.st_line===undefined)return;if(child.partner_id===partner_id||child.st_line.has_no_partner){if(contains_lines(child.get("mv_lines_selected"),line_ids)){child.set("mv_lines_selected",_.filter(child.get("mv_lines_selected"),function(o){return line_ids.indexOf(o.id)===-1}));}else if(contains_lines(child.mv_lines_deselected,line_ids)){child.mv_lines_deselected=_.filter(child.mv_lines_deselected,function(o){return line_ids.indexOf(o.id)===-1});child.updateMatches();}else if(contains_lines(child.get("mv_lines"),line_ids)||child.get("mode")==="match"){child.updateMatches();}}});},unexcludeMoveLines:function(source_child,partner_id,lines){var self=this;var line_ids=_.collect(lines,function(o){return o.id});var initial_excluded_lines_num=this.excluded_move_lines_ids[partner_id].length;this.excluded_move_lines_ids[partner_id]=_.difference(this.excluded_move_lines_ids[partner_id],line_ids);if(this.excluded_move_lines_ids[partner_id].length===initial_excluded_lines_num)
return;_.each(self.getChildren(),function(child){if(child.st_line===undefined)return;if(child.partner_id===partner_id&&child!==source_child&&(child.get("mode")==="match"||child.$el.hasClass("no_match")))
child.updateMatches();if(child.st_line.has_no_partner&&child.get("mode")==="match"||child.$el.hasClass("no_match"))
child.updateMatches();});},displayReconciliations:function(number){var self=this;var begin=self.last_displayed_reconciliation_index;var end=Math.min((begin+number),self.lines.length);var reconciliations_to_show=self.lines.slice(begin,end);var excluded_move_lines_ids=[];_.each(self.excluded_move_lines_ids,function(o){excluded_move_lines_ids=excluded_move_lines_ids.concat(o);});return self.model_bank_statement_line.call("get_data_for_reconciliation_widget",[reconciliations_to_show,excluded_move_lines_ids]).then(function(data){var child_promises=[];var datum;while((datum=data.shift())!==undefined){var context={line_id:datum.st_line.id,mode:'inactive',animate_entrance:false,initial_data_provided:true,line:datum.st_line,reconciliation_proposition:datum.reconciliation_proposition,};var widget=new bankStatementReconciliationLine(self,context);child_promises.push(widget.appendTo(self.$(".reconciliation_lines_container")));}
self.last_displayed_reconciliation_index+=reconciliations_to_show.length;return $.when.apply($,child_promises).then(function(){self.updateShowMoreButton();});});},childValidated:function(child){var self=this;self.reconciled_lines++;self.updateProgressbar();self.doReloadMenuReconciliation();if(self.last_displayed_reconciliation_index<self.lines.length&&self.getChildren().length<self.num_reconciliations_fetched_in_batch){self.displayReconciliation(self.lines[self.last_displayed_reconciliation_index++],'inactive');}
if(self.reconciled_lines===self.lines.length){self.displayDoneMessage(false);}
if(self.reconciled_lines!==self.lines.length){var first_child=self.getChildren()[0];if(first_child.get("mode")==="inactive"){first_child.set("mode","match");}}
self.updateShowMoreButton();},decorateMoveLine:function(line){line['credit']=[line['debit'],line['debit']=line['credit']][0];this._super(line);if(!this.partner_id&&line.partner_name)
line.q_label=line.partner_name+" : "+line.q_label;},doReloadMenuReconciliation:function(){var menu=web_client.menu;if(!menu||!this.reconciliation_menu_id){return $.when();}
return menu.rpc("/web/menu/load_needaction",{'menu_ids':[this.reconciliation_menu_id]}).done(function(r){menu.on_needaction_loaded(r);}).then(function(){menu.trigger("need_action_reloaded");});},goBackToStatementsTreeView:function(){var self=this;new Model("ir.model.data").call("get_object_reference",['account','action_bank_statement_tree']).then(function(result){var action_id=result[1];var action_stack=self.action_manager.get_action_stack();var action=_.find(action_stack,function(action){return action.get_action_descr()&&action.get_action_descr().id===action_id;});if(action){self.action_manager.select_action(action,0);}else{self.action_manager.do_action(action_id,{clear_breadcrumbs:true});}});},displayDoneMessage:function(all_was_auto_reconciled){var self=this;if(all_was_auto_reconciled){var title=_t("There you go, it's all done !");}else{var sec_taken=Math.round((Date.now()-self.time_widget_loaded)/1000);var sec_per_item=Math.round(sec_taken/self.reconciled_lines);var achievements=[];var time_taken;if(sec_taken/60>=1)time_taken=Math.floor(sec_taken/60)+"' "+sec_taken%60+"''";else time_taken=sec_taken%60+_t(" seconds");var title;if(sec_per_item<5)title=_t("Whew, that was fast !")+" <i class='fa fa-trophy congrats_icon'></i>";else title=_t("Congrats, you're all done !")+" <i class='fa fa-thumbs-o-up congrats_icon'></i>";if(self.lines_reconciled_with_ctrl_enter===self.reconciled_lines)
achievements.push({title:_t("Efficiency at its finest"),desc:_t("Only use the ctrl-enter shortcut to validate reconciliations."),icon:"fa-keyboard-o"});if(sec_per_item<5)
achievements.push({title:_t("Fast reconciler"),desc:_t("Take on average less than 5 seconds to reconcile a transaction."),icon:"fa-bolt"});}
self.$(".o_protip").hide();self.updateShowMoreButton();self.$(".oe_form_sheet, o_form_sheet").append(QWeb.render("bank_statement_reconciliation_done_message",{title:title,all_was_auto_reconciled:all_was_auto_reconciled,time_taken:time_taken,sec_per_item:sec_per_item,transactions_done:self.reconciled_lines,done_with_ctrl_enter:self.lines_reconciled_with_ctrl_enter,achievements:achievements,single_statement:self.single_statement,multiple_statements:self.multiple_statements,}));var container=$("<div style='overflow: hidden;' />");self.$(".done_message").wrap(container).css("opacity",0).css("position","relative").css("left","-50%");self.$(".done_message").animate({opacity:1,left:0},self.aestetic_animation_speed*2,"easeOutCubic");self.$(".done_message").animate({opacity:1},self.aestetic_animation_speed*3,"easeOutCubic");if(self.$(".achievement").length!==0)
self.$(".achievement").popover({'placement':'top','container':self.el,'trigger':'hover'});if(self.$(".button_back_to_statement").length!==0)
self.$(".button_back_to_statement").click(function(){self.goBackToStatementsTreeView();});if(self.$(".button_close_statement").length!==0){self.$(".button_close_statement").hide();self.model_bank_statement.query(["balance_end_real","balance_end"]).filter([['id','in',self.statement_ids]]).all().then(function(data){if(_.all(data,function(o){return self.monetaryIsZero(o.balance_end_real-o.balance_end)})){self.$(".button_close_statement").show();self.$(".button_close_statement").click(function(){self.$(".button_close_statement").attr("disabled","disabled");self.model_bank_statement.call("button_confirm_bank",[self.statement_ids]).then(function(){self.goBackToStatementsTreeView();},function(){self.$(".button_close_statement").removeAttr("disabled");});});}});}},showMoreButtonClickHandler:function(){this.displayReconciliations(this.num_reconciliations_fetched_in_batch);},updateShowMoreButton:function(){var items_remaining=this.lines.length-this.last_displayed_reconciliation_index;if(items_remaining>0)
this.$(".show_more").show().find(".num_items_remaining").text(items_remaining);else
this.$(".show_more").hide();},});var bankStatementReconciliationLine=abstractReconciliationLine.extend({className:abstractReconciliationLine.prototype.className+' o_bank_statement_reconciliation_line',events:_.defaults({"click .change_partner":"changePartnerClickHandler","click .button_ok":"persistAndBowOut","click .initial_line":"initialLineClickHandler","click .line_open_balance":"lineOpenBalanceClickHandler","click .do_partial_reconcile_button":"doPartialReconcileButtonClickHandler","click .undo_partial_reconcile_button":"undoPartialReconcileButtonClickHandler",},abstractReconciliationLine.prototype.events),init:function(parent,context){this.template_prefix="bank_statement_";this._super(parent,context);if(context.line_id===undefined||context.initial_data_provided===true&&(context.reconciliation_proposition===undefined||context.line===undefined))
console.error("[Warning] bankStatementReconciliationLine instanciated with incorrect context.");this.line_id=context.line_id;this.model_bank_statement_line=this.getParent().model_bank_statement_line;this.formatCurrencies=this.getParent().formatCurrencies;this.monetaryIsZero=this.getParent().monetaryIsZero;if(context.initial_data_provided){this.st_line=context.line;this.decorateStatementLine(this.st_line);this.set("currency_id",this.st_line.currency_id);if(this.getParent().excluded_move_lines_ids[this.partner_id]===undefined)
this.getParent().excluded_move_lines_ids[this.partner_id]=[];this.getParent().excludeMoveLines(this,this.partner_id,context.reconciliation_proposition);}else{this.st_line=undefined;this.partner_id=undefined;}},loadData:function(){var self=this;if(self.context.initial_data_provided)
return;var excluded_move_lines_ids=[];_.each(self.getParent().excluded_move_lines_ids,function(o){excluded_move_lines_ids=excluded_move_lines_ids.concat(o);});return self.model_bank_statement_line.call("get_data_for_reconciliation_widget",[[self.line_id],excluded_move_lines_ids]).then(function(data){self.st_line=data[0].st_line;self.decorateStatementLine(self.st_line);self.set("currency_id",self.st_line.currency_id);self.partner_id=data[0].st_line.partner_id;if(self.getParent().excluded_move_lines_ids[self.partner_id]===undefined)
self.getParent().excluded_move_lines_ids[self.partner_id]=[];var mv_lines=[];_.each(data[0].reconciliation_proposition,function(line){self.decorateMoveLine(line);mv_lines.push(line);},self);self.set("mv_lines_selected",self.get("mv_lines_selected").concat(mv_lines));});},render:function(){var self=this;self.$el.prepend(QWeb.render("bank_statement_reconciliation_line",{line:self.st_line,presets:self.renderPresetsButtons(self.get("presets")),}));self.$(".match").slideUp(0);self.$(".create").slideUp(0);if(self.st_line.no_match)self.$el.addClass("no_match");self.bindPopoverTo(self.$(".line_info_button"));self.createFormWidgets();if(self.st_line.has_no_partner){self.updateBalance();self.$(".change_partner_container").show(0);self.$el.addClass("no_partner");}
self.finishedLoadingMoveLines=$.Deferred();self.set("mode",self.context.mode);return $.when(self.finishedLoadingMoveLines).then(function(){self.balanceChanged();self.createdLinesChanged();self.updateAccountingViewMatchedLines();});},restart:function(mode){var self=this;mode=defaultIfUndef(mode,'inactive');self.context.animate_entrance=false;self.$el.css("height",self.$el.outerHeight());_.each(self.getChildren(),function(o){o.destroy()});self.is_consistent=false;return $.when(self.$el.animate({opacity:0},self.animation_speed)).then(function(){self.getParent().unexcludeMoveLines(self,self.partner_id,self.get("mv_lines_selected"));$.each(self.$(".bootstrap_popover"),function(){$(this).popover('destroy')});self.$el.empty();self.$el.removeClass("no_partner");self.context.mode=mode;self.context.initial_data_provided=false;self.is_valid=true;self.is_consistent=true;self.filter="";self.set("balance",undefined,{silent:true});self.set("mode",undefined,{silent:true});self.set("pager_index",0,{silent:true});self.set("mv_lines",[],{silent:true});self.set("mv_lines_selected",[],{silent:true});self.mv_lines_deselected=[];self.set("lines_created",[],{silent:true});self.set("line_created_being_edited",[{'id':0}],{silent:true});return $.when(self.start()).then(function(){self.$el.css("height","auto");self.is_consistent=true;self.$el.animate({opacity:1},self.animation_speed);});});},createFormWidgets:function(){var self=this;this._super();var change_partner_field={relation:"res.partner",string:_t("Partner"),type:"many2one",domain:[['parent_id','=',false],'|',['customer','=',true],['supplier','=',true]],help:"",readonly:false,required:true,selectable:true,states:{},views:{},context:{},};var change_partner_node={tag:"field",children:[],required:true,attrs:{invisible:"False",modifiers:'',name:"change_partner",nolabel:"True",}};self.field_manager.fields_view.fields["change_partner"]=change_partner_field;self.change_partner_field=new FieldMany2One(self.field_manager,change_partner_node);self.change_partner_field.appendTo(self.$(".change_partner_container"));self.change_partner_field.on("change:value",self.change_partner_field,function(){self.changePartner(this.get_value());});self.change_partner_field.$el.find("input").attr("placeholder",self.st_line.communication_partner_name||_t("Select Partner"));},decorateStatementLine:function(line){line.q_popover=QWeb.render("bank_statement_reconciliation_statement_line_details",{line:line});},initializeCreateForm:function(){this._super();this.label_field.set("value",this.st_line.name);},selectMoveLine:function(mv_line){var self=this;var line=self._super(mv_line);if(!line)return;var last_selected_line=_.last(self.get("mv_lines_selected"));var selected_lines_account_types=_.collect(self.get("mv_lines_selected").concat(line),function(l){return l.account_type});if(selected_lines_account_types.indexOf("payable")!=-1&&selected_lines_account_types.indexOf("receivable")!=-1){new CrashManager().show_warning({data:{exception_type:_t("Incorrect Operation"),message:_t("You cannot mix items from receivable and payable accounts.")}});return;}
$(mv_line).attr('data-selected','true');self.set("mv_lines_selected",self.get("mv_lines_selected").concat(line));},deselectMoveLine:function(mv_line){var self=this;var line=self._super(mv_line);if(!line)return;var need_redraw=false;if(line.partial_reconcile===true){self.unpartialReconcileLine(line);need_redraw=true;}
if(line.propose_partial_reconcile===true){line.propose_partial_reconcile=false;need_redraw=true;}
if(need_redraw)self.deselectMoveLine(mv_line);},initialLineClickHandler:function(){var self=this;if(self.get("mode")!=="inactive"){self.set("mode","inactive");}else{self.set("mode","match");}},changePartnerClickHandler:function(){var self=this;var partner_name=self.st_line.partner_name;$.when(self.changePartner(false)).then(function(){self.$(".change_partner_container").show();self.$(".partner_name").hide();self.$(".change_partner_container").find("input").attr("placeholder",partner_name);self.change_partner_field.$dropdown.trigger("click");});},balanceChanged:function(){var self=this;self.is_valid=false;self.$(".tip_reconciliation_not_balanced").show();self.$(".tbody_open_balance").empty();self.$(".button_ok").text(_t("Reconcile")).removeClass("btn-primary").hide();var balance_type=undefined;var digits=4;if(this.get("currency_id")&&session.get_currency(this.get("currency_id"))){digits=session.get_currency(this.get("currency_id")).digits[1];}
if(self.monetaryIsZero(self.get("balance"),digits))balance_type="equal";else if(self.get("balance")*self.st_line.amount>0)balance_type="greater";else if(self.get("balance")*self.st_line.amount<0)balance_type="lower";if(balance_type==="equal"){displayValidState(true);}else if(balance_type==="greater"){createOpenBalance(_t("Create Write-off"));}else if(balance_type==="lower"){if(self.st_line.has_no_partner){createOpenBalance(_t("Choose counterpart"));}else{displayValidState(false,_t("Validate"));createOpenBalance(_t("Open balance"));}}
if(self.get("mv_lines_selected").length>0){var last_line=_.last(self.get("mv_lines_selected"));var propose_partial=self.getCreatedLines().length===0&&balance_type==="greater"&&Math.abs(self.get("balance"))<Math.abs(last_line.debit-last_line.credit)&&self.get("balance")*(last_line.debit-last_line.credit)<0&&!last_line.partial_reconcile&&!last_line.already_paid;last_line.propose_partial_reconcile=propose_partial;self.updateAccountingViewMatchedLines();}
function displayValidState(higlight_ok_button,ok_button_text){self.is_valid=true;self.$(".tip_reconciliation_not_balanced").hide();self.$(".button_ok").show();if(higlight_ok_button)self.$(".button_ok").addClass("btn-primary");if(ok_button_text!==undefined)self.$(".button_ok").text(ok_button_text)}
function createOpenBalance(name){var balance=self.get("balance");var amount=self.formatCurrencies(Math.abs(balance),self.get("currency_id"));var $line=$(QWeb.render("reconciliation_line_open_balance",{debit:balance>0?amount:"",credit:balance<0?amount:"",account_code:self.map_account_id_code[self.st_line.open_balance_account_id],label:name||_t("Open balance")}));self.$(".tbody_open_balance").empty().append($line);}},mvLinesSelectedChanged:function(elt,val){var self=this;_.each(self.get("mv_lines_selected"),function(line){if(line.partial_reconcile===true)self.unpartialReconcileLine(line);if(line.propose_partial_reconcile===true)line.propose_partial_reconcile=false;});var added_lines=_.difference(val.newValue,val.oldValue);var removed_lines=_.difference(val.oldValue,val.newValue);self.getParent().excludeMoveLines(self,self.partner_id,added_lines);self.getParent().unexcludeMoveLines(self,self.partner_id,removed_lines);self._super(elt,val);},doPartialReconcileButtonClickHandler:function(e){var line_id=$(e.currentTarget).closest("tr").data("lineid");var line=_.find(this.get("mv_lines_selected"),function(o){return o.id==line_id});this.partialReconcileLine(line);$(e.currentTarget).popover('destroy');this.updateAccountingViewMatchedLines();this.updateBalance();e.stopPropagation();},partialReconcileLine:function(line){var balance=this.get("balance");line.initial_amount=line.debit!==0?line.debit:-1*line.credit;if(balance<0)
line.debit+=balance;else
line.credit-=balance;line.propose_partial_reconcile=false;line.partial_reconcile=true;},undoPartialReconcileButtonClickHandler:function(e){var line_id=$(e.currentTarget).closest("tr").data("lineid");var line=_.find(this.get("mv_lines_selected"),function(o){return o.id==line_id});this.unpartialReconcileLine(line);$(e.currentTarget).popover('destroy');this.updateAccountingViewMatchedLines();this.updateBalance();e.stopPropagation();},unpartialReconcileLine:function(line){if(line.initial_amount>0)
line.debit=line.initial_amount;else
line.credit=-1*line.initial_amount;line.propose_partial_reconcile=true;line.partial_reconcile=false;line.amount_str=this.formatCurrencies(Math.abs(line.debit+line.credit),this.get("currency_id"));},updateBalance:function(){var self=this;var mv_lines_selected=self.get("mv_lines_selected");var balance=0;balance-=self.st_line.amount;_.each(mv_lines_selected,function(o){balance=balance-o.debit+o.credit;});_.each(self.getCreatedLines(),function(o){balance+=o.amount;});balance=Math.round(balance*10000)/10000;self.set("balance",balance);},updateMatchesGetMvLines:function(excluded_ids,offset,limit,callback){var self=this;var globally_excluded_ids=[];if(self.st_line.has_no_partner)
_.each(self.getParent().excluded_move_lines_ids,function(o){globally_excluded_ids=globally_excluded_ids.concat(o)});else
globally_excluded_ids=self.getParent().excluded_move_lines_ids[self.partner_id];for(var i=0;i<globally_excluded_ids.length;i++)
if(excluded_ids.indexOf(globally_excluded_ids[i])===-1)
excluded_ids.push(globally_excluded_ids[i]);return self.model_bank_statement_line.call("get_move_lines_for_reconciliation_widget",[self.st_line.id,excluded_ids,self.filter,offset,limit]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);return callback.call(self,lines);});},changePartner:function(partner_id){var self=this;self.is_consistent=false;return self.model_bank_statement_line.call("write",[[self.line_id],{'partner_id':partner_id}]).then(function(){return $.when(self.restart("match")).then(function(){self.is_consistent=true;});});},prepareCounterpartAMLDict:function(line){return{name:line.name,debit:line.debit,credit:line.credit,counterpart_aml_id:line.id,};},prepareOpenBalanceForPersisting:function(){var balance=this.get("balance");var dict={};dict['account_id']=this.st_line.open_balance_account_id;dict['name']=this.st_line.name+' : '+_t("Open balance");dict['debit']=balance>0?balance:0;dict['credit']=balance<0?-1*balance:0;return dict;},prepareDataForPersisting:function(){var self=this;var counterpart_aml=_.filter(this.get("mv_lines_selected"),function(line){return!line.already_paid});var counterpart_aml_dicts=_.collect(counterpart_aml,function(line){return self.prepareCounterpartAMLDict(line)});var payment_aml=_.filter(this.get("mv_lines_selected"),function(line){return line.already_paid});var payment_aml_ids=_.collect(payment_aml,function(line){return line.id});var new_aml_dicts=this.prepareCreatedMoveLinesForPersisting(this.getCreatedLines());var digits=4;if(this.get("currency_id")&&session.get_currency(this.get("currency_id"))){digits=session.get_currency(this.get("currency_id")).digits[1];}
if(!self.monetaryIsZero(this.get("balance"),digits))new_aml_dicts.push(this.prepareOpenBalanceForPersisting());return{'counterpart_aml_dicts':counterpart_aml_dicts,'payment_aml_ids':payment_aml_ids,'new_aml_dicts':new_aml_dicts,};},persistAndBowOut:function(){var self=this;if(!this.is_consistent)return;self.$(".button_ok").attr("disabled","disabled");this.model_bank_statement_line.call("process_reconciliations",[[this.line_id],[this.prepareDataForPersisting()]]).done(function(){self.bowOut(self.animation_speed,true);}).always(function(){self.$(".button_ok").removeAttr("disabled");});},getPostMortemProcess:function(){var clone=_.clone(this);var parent=this.getParent();var partner_id=this.partner_id;var mv_lines_selected=this.get("mv_lines_selected");return function(){parent.unexcludeMoveLines(undefined,partner_id,mv_lines_selected);parent.childValidated(clone);};},});var manualReconciliation=abstractReconciliation.extend({className:abstractReconciliation.prototype.className+' o_manual_reconciliation',events:_.defaults({"change input[name='modeselektor']":"modeSelektorHandler",},abstractReconciliation.prototype.events),init:function(parent,context){this.children_widget=manualReconciliationLine;this.template_prefix="manual_";this._super(parent,context);this.model_aml=new Model("account.move.line");this.model_partner=new Model("res.partner");this.model_account=new Model("account.account");this.title=_t("Journal Items to Reconcile");context.display_name=_t("Invoices & Payments Matching");this.max_move_lines_displayed=20;this.mode=defaultIfUndef(context.context.mode,'all');this.partner_ids=context.context.partner_ids;this.account_ids=context.context.account_ids;this.show_mode_selector=defaultIfUndef(context.context.show_mode_selector,true);if(this.partner_ids&&!this.account_ids)this.account_ids=[];if(this.account_ids&&!this.partner_ids)this.partner_ids=[];this.working_on_a_given_item=utils.xor((this.partner_ids&&this.partner_ids.length===1),(this.account_ids&&this.account_ids.length===1));this.customers_data={show:true,items:[],num_total:0,num_done:0,};this.suppliers_data={show:true,items:[],num_total:0,num_done:0,};this.accounts_data={show:true,items:[],num_total:0,num_done:0,};this.create_form_fields=_.defaults({journal_id:{id:"journal_id",index:2,corresponding_property:"journal_id",label:_t("Journal"),required:true,constructor:FieldMany2One,field_properties:{relation:"account.journal",string:_t("Journal"),type:"many2one",},}},this.create_form_fields);},start:function(){var self=this;return $.when(this._super()).then(function(){return self.model_aml.call("get_data_for_manual_reconciliation_widget",[self.partner_ids,self.account_ids]).then(function(data){var data_customers_len=data.customers?data.customers.length:0;var data_suppliers_len=data.suppliers?data.suppliers.length:0;var data_accounts_len=data.accounts?data.accounts.length:0;if(data_customers_len+data_suppliers_len+data_accounts_len===0){self.$el.prepend(QWeb.render("manual_reconciliation_nothing_to_reconcile"));return;}
if(self.working_on_a_given_item){self.title=_t("Reconciling ");if(data_customers_len===1){self.title+=data.customers[0].partner_name}
else if(data_suppliers_len===1){self.title+=data.suppliers[0].partner_name}
else if(data_accounts_len===1){self.title+=data.accounts[0].account_code}}
var display_mode_customers=data_customers_len!==0;var display_mode_suppliers=data_suppliers_len!==0;var display_mode_others=data_accounts_len!==0;var mode_selector_relevant=(display_mode_customers+display_mode_suppliers+display_mode_others)>1;self.$el.prepend(QWeb.render("manual_reconciliation",{title:self.title,total_lines:0,hide_progress:self.working_on_a_given_item,mode:self.mode,show_mode_selector:self.show_mode_selector&&!self.working_on_a_given_item&&mode_selector_relevant,display_mode_customers:display_mode_customers,display_mode_suppliers:display_mode_suppliers,display_mode_others:display_mode_others,}));if(data_customers_len!==0){self.customers_data.num_total=data_customers_len;self.customers_data.items=_.each(data.customers,function(item){self.prepareReconciliationData(item,'customer')});}
if(data_suppliers_len!==0){self.suppliers_data.num_total=data_suppliers_len;self.suppliers_data.items=_.each(data.suppliers,function(item){self.prepareReconciliationData(item,'supplier')});}
if(data_accounts_len!==0){self.accounts_data.num_total=data_accounts_len;self.accounts_data.items=_.each(data.accounts,function(item){self.prepareReconciliationData(item,'account')});}
self.$(".reconciliation_lines_container").css("opacity",0);return $.when(self.updateProgress(false)).then(function(){return self.$(".reconciliation_lines_container").animate({opacity:1},self.aestetic_animation_speed);});}).always(function(){self.$(".button_ok").removeAttr("disabled");});});},processReconciliations:function(reconciliations){if(reconciliations.length===0)return;var self=this;var reconciliations_type_count=_.countBy(reconciliations,function(rec){return rec.data.reconciliation_type;});var data=_.collect(reconciliations,function(rec){return{id:rec.data.reconciliation_type==='account'?rec.data.account_id:rec.data.partner_id,type:rec.data.reconciliation_type==='account'?'account':'partner',mv_line_ids:_.collect(rec.get("mv_lines_selected"),function(o){return o.id}),new_mv_line_dicts:rec.prepareCreatedMoveLinesForPersisting(rec.getCreatedLines()),};});var deferred_animation=self.$(".reconciliation_lines_container, .show_more_container").fadeOut(self.aestetic_animation_speed);var deferred_rpc=self.model_aml.call("process_reconciliations",[data]);return $.when(deferred_animation,deferred_rpc).done(function(){for(var i=0;i<reconciliations.length;i++)
reconciliations[i].bowOut(0,false);self.lines_reconciled_with_ctrl_enter+=reconciliations.length;self.customers_data.num_done+=reconciliations_type_count.customer||0;self.suppliers_data.num_done+=reconciliations_type_count.supplier||0;self.accounts_data.num_done+=reconciliations_type_count.account||0;self.updateProgress();}).always(function(){self.$(".reconciliation_lines_container").fadeIn(self.aestetic_animation_speed);});},displayReconciliation:function(data,animate_entrance){var widget=new this.children_widget(this,{data:data,animate_entrance:animate_entrance});data.displayed=true;return widget.appendTo(this.$(".reconciliation_lines_container"));},modeSelektorHandler:function(e){this.mode=$(e.target).attr("val");this.updateProgress();},getDisplayedCollections:function(){var collections=[];if(this.mode==='customers'||this.mode==='all'){collections.push(this.customers_data)}
if(this.mode==='suppliers'||this.mode==='all'){collections.push(this.suppliers_data)}
if(this.mode==='others'||this.mode==='all'){collections.push(this.accounts_data)}
return collections;},updateProgress:function(animate_entrance){animate_entrance=defaultIfUndef(animate_entrance,true);var self=this;var displayed_collections=self.getDisplayedCollections();var plural={'customer':'customers','supplier':'suppliers','account':'others'};self.updateProgressbar();var num_child_displayed=self.getChildren().length;if(self.mode!=='all'){_.each(self.getChildren(),function(child){var type=plural[child.data.reconciliation_type];if(type!==self.mode){num_child_displayed--;child.$el.slideUp(self.aestetic_animation_speed,function(){child.destroy()});child.data.displayed=false;}});}
var children_promises=[];var items_to_display=_.foldl(displayed_collections,function(prev,current){return prev.concat(current.items)},[]);items_to_display=_.filter(items_to_display,function(item){return item.displayed===false;}).slice(0,self.num_reconciliations_fetched_in_batch-num_child_displayed);_.each(items_to_display,function(item){children_promises.push(self.displayReconciliation(item,animate_entrance));});var reconciliations_left=_.foldl(displayed_collections,function(prev,current){return prev+current.num_total-current.num_done},0);if(reconciliations_left===0&&self.$(".done_message").length===0)
self.showDoneMessage();if(reconciliations_left!==0&&self.$(".done_message").length!==0)
self.hideDoneMessage();return $.when.apply($,children_promises);},updateProgressbar:function(){var displayed_collections=this.getDisplayedCollections();var done=_.foldl(displayed_collections,function(prev,current){return prev+current.num_done},0);var total=_.foldl(displayed_collections,function(prev,current){return prev+current.num_total},0);var prog_bar=this.$(".progress .progress-bar");prog_bar.attr("aria-valuenow",done);prog_bar.css("width",(done/total*100)+"%");this.$(".progress .progress-text .valuenow").text(done);this.$(".progress .progress-text .valuemax").text(total);},showDoneMessage:function(){this.$(".oe_form_sheet, .o_form_sheet").append(QWeb.render("manual_reconciliation_done_message"));var container=$("<div style='overflow: hidden;' />");this.$(".done_message").wrap(container).css("opacity",0).css("position","relative").css("left","-50%");this.$(".done_message").animate({opacity:1,left:0},this.aestetic_animation_speed*2,"easeOutCubic");this.$(".done_message").animate({opacity:1},this.aestetic_animation_speed*3,"easeOutCubic");},hideDoneMessage:function(){this.$(".done_message").remove();},prepareReconciliationData:function(item,type){item.displayed=false;item.reconciliation_type=type;},childValidated:function(reconciliation_type){if(reconciliation_type==="customer")
this.customers_data.num_done++;else if(reconciliation_type==="supplier")
this.suppliers_data.num_done++;else if(reconciliation_type==="account")
this.accounts_data.num_done++;this.updateProgress();},});var manualReconciliationLine=abstractReconciliationLine.extend({className:abstractReconciliationLine.prototype.className+' o_manual_reconciliation_line',events:_.defaults({"click .accounting_view thead":"headerClickHandler","click .line_open_balance":"lineOpenBalanceClickHandler","click .button_reconcile":"buttonReconcileClickHandler",},abstractReconciliationLine.prototype.events),init:function(parent,context){this.template_prefix="manual_";this._super(parent,context);this.working_on_a_given_item=this.getParent().working_on_a_given_item;this.model_aml=this.getParent().model_aml;this.data=context.data;this.initial_currency=context.data.currency_id;this.set("currency_id",context.data.currency_id);this.on("change:currency_id",this,this.currencyChanged);_.each(context.data.reconciliation_proposition,function(line){this.decorateMoveLine(line);},this);this.set("mv_lines_selected",context.data.reconciliation_proposition);},render:function(){var self=this;self.$el.prepend(QWeb.render("manual_reconciliation_line",{data:self.data,presets:self.renderPresetsButtons(self.get("presets")),}));self.$(".match").slideUp(0);self.$(".create").slideUp(0);self.createFormWidgets();self.$el.append($('ul.ui-autocomplete'));self.updateBalance();self.updateAccountingViewMatchedLines();self.finishedLoadingMoveLines=$.Deferred();self.set("mode","match");return self.finishedLoadingMoveLines;},islineCreatedBeingEditedValid:function(){return this._super()&&this.get("line_created_being_edited")[0].journal_id;},selectMoveLine:function(mv_line){var self=this;var line=self._super(mv_line);if(!line)return;$(mv_line).attr('data-selected','true');self.set("mv_lines_selected",self.get("mv_lines_selected").concat(line));},mvLinesChanged:function(){var self=this;self._super();if(!self.working_on_a_given_item&&self.get("pager_index")===0&&!self.can_fetch_more_move_lines&&self.get("mv_lines_selected").length===0&&self.filter===''){var mkay,mmkay=false;var lines=self.get("mv_lines").concat(self.mv_lines_deselected);for(var i=0;i<lines.length;i++){if(lines[i].credit!==0)mkay=true;if(lines[i].debit!==0)mmkay=true;if(mkay&&mmkay)break;}
if(!(mkay&&mmkay)){self.markAsReconciled();}}},headerClickHandler:function(){if(this.get("mode")!=="match")
this.set("mode","match");},buttonReconcileClickHandler:function(){if(this.persist_action==="reconcile")
this.processReconciliation();else if(this.persist_action==="mark_as_reconciled")
this.markAsReconciled();},preventAccountingViewCollapse:function(){if(this.$(".tbody_matched_lines > *").length+this.$(".tbody_created_lines > *").length===0)
this.$(".tbody_matched_lines").append('<tr class="filler_line"><td class="cell_action"></td><td class="cell_due_date"></td>\
                <td class="cell_label"></td><td class="cell_debit"></td><td class="cell_credit"></td><td class="cell_info_popover"></td></tr>');},updateAccountingViewMatchedLines:function(){this._super();this.preventAccountingViewCollapse();},updateAccountingViewCreatedLines:function(){this._super();this.preventAccountingViewCollapse();},balanceChanged:function(){var self=this;var balance=self.get("balance");self.$(".button_reconcile").removeClass("btn-primary");self.$(".button_reconcile").text(_t("Reconcile"));self.persist_action="reconcile";if(self.get("mv_lines_selected").length<2){self.$(".button_reconcile").text(_t("Skip"));self.persist_action="mark_as_reconciled";}else if(self.monetaryIsZero(balance)){self.$(".button_reconcile").addClass("btn-primary");}
self.$(".tbody_open_balance").empty();if((!self.monetaryIsZero(balance))&&self.get("mv_lines_selected").length>1){var debit=(balance>0?self.formatCurrencies(balance,self.get("currency_id")):"");var credit=(balance<0?self.formatCurrencies(-1*balance,self.get("currency_id")):"");var $line=$(QWeb.render("manual_reconciliation_line_open_balance",{debit:debit,credit:credit,label:_t("Create writeoff")}));self.$(".tbody_open_balance").append($line);}},mvLinesSelectedChanged:function(elt,val){var lines=this.get("mv_lines_selected");var new_currency=this.initial_currency;if(lines.length>0){var first_line_currency=lines[0].currency_id;var same_currency=_.every(lines,function(line){return line.currency_id===first_line_currency});if(same_currency)
new_currency=first_line_currency;}
if(new_currency!=this.get("currency_id"))
this.set("currency_id",new_currency);else
this._super(elt,val);},currencyChanged:function(){var self=this;this.mv_lines_deselected=[];this.updateMatches();var line_ids=_.collect(self.get("mv_lines_selected"),function(o){return o.id});self.model_aml.call("prepare_move_lines_for_reconciliation_widget",[line_ids,self.get("currency_id")]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);self.set("mv_lines_selected",lines);});},loadReconciliationProposition:function(){var self=this;return self.model_aml.call("get_reconciliation_proposition",[self.data.account_id,self.data.partner_id||undefined]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);self.set("mv_lines_selected",lines);});},updateMatchesGetMvLines:function(excluded_ids,offset,limit,callback){var self=this;return self.model_aml.call("get_move_lines_for_manual_reconciliation",[self.data.account_id,self.data.partner_id||undefined,excluded_ids,self.filter,offset,limit,self.get("currency_id")]).then(function(lines){_.each(lines,function(line){self.decorateMoveLine(line)},self);callback.call(self,lines);});},prepareCreatedMoveLinesForPersisting:function(lines){var dicts=this._super(lines);for(var i=0;i<dicts.length;i++)
dicts[i]['journal_id']=lines[i].journal_id;return dicts;},processReconciliation:function(){var self=this;if(!self.is_consistent)return $.Deferred().rejectWith({reason:"Reconciliation widget is not in a consistent state."});var mv_line_ids=_.collect(self.get("mv_lines_selected"),function(o){return o.id});var new_mv_line_dicts=self.prepareCreatedMoveLinesForPersisting(self.getCreatedLines());self.$(".button_reconcile").attr("disabled","disabled");return self.model_aml.call("process_reconciliation",[mv_line_ids,new_mv_line_dicts]).done(function(){self.initializeCreateForm();self.loadReconciliationProposition();self.set("lines_created",[]);if(self.get("mode")!="match"&&self.get("mv_lines").length>=1)
self.set("mode","match");self.balanceChanged();}).always(function(){self.$(".button_reconcile").removeAttr("disabled");});},markAsReconciled:_.throttle(function(){var self=this;var type=this.data.reconciliation_type;var id=(type==="partner"?this.data.partner_id:this.data.account_id);var model=(type==="partner"?this.getParent().model_partner:this.getParent().model_account);model.call("mark_as_reconciled",[[id]]).then(function(){self.bowOut(self.animation_speed,true);});},100,{trailing:false}),getPostMortemProcess:function(){var reconciliation_type=this.data.reconciliation_type;var parent=this.getParent();return function(){if(parent)
parent.childValidated(reconciliation_type);};},});core.action_registry.add('bank_statement_reconciliation_view',bankStatementReconciliation);core.action_registry.add('manual_reconciliation_view',manualReconciliation);return{abstractReconciliation:abstractReconciliation,abstractReconciliationLine:abstractReconciliationLine,bankStatementReconciliation:bankStatementReconciliation,manualReconciliation:manualReconciliation,bankStatementReconciliationLine:bankStatementReconciliationLine,};});;

/* /account/static/src/js/move_line_quickadd.js defined in bundle 'web.assets_backend' */
odoo.define('account.move_line_quickadd',function(require){"use strict";var core=require('web.core');var data=require('web.data');var ListView=require('web.ListView');var Model=require('web.DataModel');var QWeb=core.qweb;var QuickAddListView=ListView.extend({init:function(){this._super.apply(this,arguments);this.journals=[];this.periods=[];this.current_journal=null;this.current_period=null;this.default_period=null;this.default_journal=null;this.current_journal_type=null;this.current_journal_currency=null;this.current_journal_analytic=null;},start:function(){var tmp=this._super.apply(this,arguments);var self=this;var defs=[];this.$el.parent().prepend(QWeb.render("AccountMoveLineQuickAdd",{widget:this}));this.$el.parent().find('.oe_account_select_journal').change(function(){self.current_journal=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.$el.parent().find('.oe_account_select_period').change(function(){self.current_period=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.on('edit:after',this,function(){self.$el.parent().find('.oe_account_select_journal').attr('disabled','disabled');self.$el.parent().find('.oe_account_select_period').attr('disabled','disabled');});this.on('save:after cancel:after',this,function(){self.$el.parent().find('.oe_account_select_journal').removeAttr('disabled');self.$el.parent().find('.oe_account_select_period').removeAttr('disabled');});var mod=new Model("account.move.line",self.dataset.context,self.dataset.domain);defs.push(mod.call("default_get",[['journal_id','period_id'],self.dataset.context]).then(function(result){self.current_period=result['period_id'];self.current_journal=result['journal_id'];}));defs.push(mod.call("list_journals",[]).then(function(result){self.journals=result;}));defs.push(mod.call("list_periods",[]).then(function(result){self.periods=result;}));return $.when(tmp,defs);},do_search:function(domain,context,group_by){var self=this;this.last_domain=domain;this.last_context=context;this.last_group_by=group_by;this.old_search=_.bind(this._super,this);var o;self.$el.parent().find('.oe_account_select_journal').children().remove().end();self.$el.parent().find('.oe_account_select_journal').append(new Option('',''));for(var i=0;i<self.journals.length;i++){o=new Option(self.journals[i][1],self.journals[i][0]);if(self.journals[i][0]===self.current_journal){self.current_journal_type=self.journals[i][2];self.current_journal_currency=self.journals[i][3];self.current_journal_analytic=self.journals[i][4];$(o).attr('selected',true);}
self.$el.parent().find('.oe_account_select_journal').append(o);}
self.$el.parent().find('.oe_account_select_period').children().remove().end();self.$el.parent().find('.oe_account_select_period').append(new Option('',''));for(var i=0;i<self.periods.length;i++){o=new Option(self.periods[i][1],self.periods[i][0]);self.$el.parent().find('.oe_account_select_period').append(o);}
self.$el.parent().find('.oe_account_select_period').val(self.current_period).attr('selected',true);return self.search_by_journal_period();},search_by_journal_period:function(){var self=this;var domain=[];if(self.current_journal!==null)domain.push(["journal_id","=",self.current_journal]);if(self.current_period!==null)domain.push(["period_id","=",self.current_period]);self.last_context["journal_id"]=self.current_journal===null?false:self.current_journal;if(self.current_period===null)delete self.last_context["period_id"];else self.last_context["period_id"]=self.current_period;self.last_context["journal_type"]=self.current_journal_type;self.last_context["currency"]=self.current_journal_currency;var compound_domain=new data.CompoundDomain(self.last_domain,domain);self.dataset.domain=compound_domain.eval();return self.old_search(compound_domain,self.last_context,self.last_group_by);},});core.view_registry.add('tree_account_move_line_quickadd',QuickAddListView);});;

/* /account/static/src/js/account_payment_widget.js defined in bundle 'web.assets_backend' */
odoo.define('account.payment',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var formats=require('web.formats');var Model=require('web.Model');var QWeb=core.qweb;var _t=core._t;var ShowPaymentLineWidget=form_common.AbstractField.extend({render_value:function(){var self=this;var info=JSON.parse(this.get('value'));var invoice_id=info.invoice_id;if(info!==false){_.each(info.content,function(k,v){k.index=v;k.amount=formats.format_value(k.amount,{type:"float",digits:k.digits});if(k.date){k.date=formats.format_value(k.date,{type:"date"});}});this.$el.html(QWeb.render('ShowPaymentInfo',{'lines':info.content,'outstanding':info.outstanding,'title':info.title}));this.$('.outstanding_credit_assign').click(function(){var id=$(this).data('id')||false;new Model("account.invoice").call("assign_outstanding_credit",[invoice_id,id]).then(function(result){self.view.reload();});});_.each(this.$('.js_payment_info'),function(k,v){var options={'content':QWeb.render('PaymentPopOver',{'name':info.content[v].name,'journal_name':info.content[v].journal_name,'date':info.content[v].date,'amount':info.content[v].amount,'currency':info.content[v].currency,'position':info.content[v].position,'payment_id':info.content[v].payment_id,'move_id':info.content[v].move_id,'ref':info.content[v].ref,}),'html':true,'placement':'left','title':_t('Payment Information'),'trigger':'focus','delay':{"show":0,"hide":100},};$(k).popover(options);$(k).on('shown.bs.popover',function(event){$(this).parent().find('.js_unreconcile_payment').click(function(){var payment_id=parseInt($(this).attr('payment-id'))
if(payment_id!==undefined&&payment_id!==NaN){new Model("account.move.line").call("remove_move_reconcile",[payment_id,{'invoice_id':self.view.datarecord.id}]).then(function(result){self.view.reload();});}});$(this).parent().find('.js_open_payment').click(function(){var move_id=parseInt($(this).attr('move-id'))
if(move_id!==undefined&&move_id!==NaN){self.do_action({type:'ir.actions.act_window',res_model:'account.move',res_id:move_id,views:[[false,'form']],target:'current'});}});});});}
else{this.$el.html('');}},});core.form_widget_registry.add('payment',ShowPaymentLineWidget);});;

/* /account/static/src/js/account_journal_dashboard_widget.js defined in bundle 'web.assets_backend' */
odoo.define('journal_dashboard',function(require){'use strict';var kanban_widgets=require('web_kanban.widgets');var JournalDashboardGraph=kanban_widgets.AbstractField.extend({start:function(){this.graph_type=this.$node.attr('graph_type');this.data=JSON.parse(this.field.raw_value);this.display_graph();return this._super();},display_graph:function(){var self=this;nv.addGraph(function(){self.$svg=self.$el.append('<svg>');switch(self.graph_type){case"line":self.$svg.addClass('o_graph_linechart');self.chart=nv.models.lineChart();self.chart.forceY([0]);self.chart.options({x:function(d,u){return u},margin:{'left':0,'right':0,'top':0,'bottom':0},showYAxis:false,showLegend:false,});self.chart.xAxis.tickFormat(function(d){var label='';_.each(self.data,function(v,k){if(v.values[d]&&v.values[d].x){label=v.values[d].x;}});return label;});self.chart.yAxis.tickFormat(d3.format(',.2f'));break;case"bar":self.$svg.addClass('o_graph_barchart');self.chart=nv.models.discreteBarChart().x(function(d){return d.label}).y(function(d){return d.value}).showValues(false).showYAxis(false).margin({'left':0,'right':0,'top':0,'bottom':40});self.chart.xAxis.axisLabel(self.data[0].title);self.chart.yAxis.tickFormat(d3.format(',.2f'));break;}
d3.select(self.$el.find('svg')[0]).datum(self.data).transition().duration(1200).call(self.chart);self.customize_chart();nv.utils.windowResize(self.on_resize);});},on_resize:function(){this.chart.update();this.customize_chart();},customize_chart:function(){if(this.graph_type==='bar'){var bar_classes=_.map(this.data[0].values,function(v,k){return v.type});_.each(this.$('.nv-bar'),function(v,k){$(v).attr('class',$(v).attr('class')+' '+bar_classes[k]);});}},destroy:function(){nv.utils.offWindowResize(this.on_resize);this._super();},});kanban_widgets.registry.add('dashboard_graph',JournalDashboardGraph);});;

/* /account_accountant/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('account_accountant.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_accountant_tour',{'skip_enabled':true,},[{trigger:'.o_app[data-menu-xmlid="account.menu_finance"], .oe_menu_toggler[data-menu-xmlid="account.menu_finance"]',content:_t('Ready to discover your new favorite <b>accounting app</b>? Get started by clicking here.'),position:'bottom',},{trigger:".o_invoice_new",extra_trigger:'.o_account_kanban',content:_t("Let\'s start with a new customer invoice."),position:"bottom"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:"[data-id='open'].btn-primary, [data-id='open'].oe_active",content:_t("Use the path to quickly click back to <b>previous screens</b>, without reloading the page."),position:"bottom"},{trigger:'li a[data-menu-xmlid="account.menu_finance_reports"], div[data-menu-xmlid="account.menu_finance_reports"]',content:_t("Your reports are available in real time. <i>No need to close a fiscal year to get a Profit &amp; Loss statement or view the Balance Sheet.</i>"),position:"bottom"}]);});;

/* /account_asset/static/src/js/account_asset.js defined in bundle 'web.assets_backend' */
odoo.define('account_asset.widget',function(require){"use strict";var core=require('web.core');var QWeb=core.qweb;var session=require('web.session');var _t=core._t;var WidgetOnButton=core.list_widget_registry.get('field').extend({format:function(row_data,options){this._super.apply(this,arguments);this.is_posted=!!row_data.move_posted_check.value;this.parent_state=row_data.parent_state.value;var class_color='';if(this.is_posted){class_color='o_is_posted';}
else{if(row_data.move_check.value){class_color='o_unposted';}}
return $('<div/>').append((this.parent_state==='open')?$('<button/>',{type:'button',title:(this.is_posted)?_t('Posted'):_t('Unposted'),disabled:row_data.move_check.value,'class':'btn btn-sm btn-link fa fa-circle o_widgetonbutton '+class_color,}):'').html();},});core.list_widget_registry.add("button.widgetonbutton",WidgetOnButton);});;

/* /web_widget_image_webcam/static/src/js/webcam.js defined in bundle 'web.assets_backend' */
(function(window){var Webcam={version:'1.0.6',protocol:location.protocol.match(/https/i)?'https':'http',swfURL:'',loaded:false,live:false,userMedia:true,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:'jpeg',jpeg_quality:90,force_flash:false,flip_horiz:false,fps:30,upload_name:'webcam',constraints:null},hooks:{},init:function(){var self=this;this.mediaDevices=(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)?navigator.mediaDevices:((navigator.mozGetUserMedia||navigator.webkitGetUserMedia)?{getUserMedia:function(c){return new Promise(function(y,n){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,c,y,n);});}}:null);window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;this.userMedia=this.userMedia&&!!this.mediaDevices&&!!window.URL;if(navigator.userAgent.match(/Firefox\D+(\d+)/)){if(parseInt(RegExp.$1,10)<21)this.userMedia=null;}
if(this.userMedia){window.addEventListener('beforeunload',function(event){self.reset();});}},attach:function(elem){if(typeof(elem)=='string'){elem=document.getElementById(elem)||document.querySelector(elem);}
if(!elem){return this.dispatch('error',"Could not locate DOM element to attach to.");}
this.container=elem;elem.innerHTML='';var peg=document.createElement('div');elem.appendChild(peg);this.peg=peg;if(!this.params.width)this.params.width=elem.offsetWidth;if(!this.params.height)this.params.height=elem.offsetHeight;if(!this.params.dest_width)this.params.dest_width=this.params.width;if(!this.params.dest_height)this.params.dest_height=this.params.height;if(this.params.force_flash)this.userMedia=null;if(typeof this.params.fps!=="number")this.params.fps=30;var scaleX=this.params.width/this.params.dest_width;var scaleY=this.params.height/this.params.dest_height;if(this.userMedia){var video=document.createElement('video');video.setAttribute('autoplay','autoplay');video.style.width=''+this.params.dest_width+'px';video.style.height=''+this.params.dest_height+'px';if((scaleX!=1.0)||(scaleY!=1.0)){elem.style.overflow='hidden';video.style.webkitTransformOrigin='0px 0px';video.style.mozTransformOrigin='0px 0px';video.style.msTransformOrigin='0px 0px';video.style.oTransformOrigin='0px 0px';video.style.transformOrigin='0px 0px';video.style.webkitTransform='scaleX('+scaleX+') scaleY('+scaleY+')';video.style.mozTransform='scaleX('+scaleX+') scaleY('+scaleY+')';video.style.msTransform='scaleX('+scaleX+') scaleY('+scaleY+')';video.style.oTransform='scaleX('+scaleX+') scaleY('+scaleY+')';video.style.transform='scaleX('+scaleX+') scaleY('+scaleY+')';}
elem.appendChild(video);this.video=video;var self=this;this.mediaDevices.getUserMedia({"audio":false,"video":this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(stream){video.src=window.URL.createObjectURL(stream)||stream;self.stream=stream;self.loaded=true;self.live=true;self.dispatch('load');self.dispatch('live');self.flip();}).catch(function(err){return self.dispatch('error',"Could not access webcam: "+err.name+": "+err.message,err);});}
else{window.Webcam=Webcam;var div=document.createElement('div');div.innerHTML=this.getSWFHTML();elem.appendChild(div);}
if(this.params.crop_width&&this.params.crop_height){var scaled_crop_width=Math.floor(this.params.crop_width*scaleX);var scaled_crop_height=Math.floor(this.params.crop_height*scaleY);elem.style.width=''+scaled_crop_width+'px';elem.style.height=''+scaled_crop_height+'px';elem.style.overflow='hidden';elem.scrollLeft=Math.floor((this.params.width/2)-(scaled_crop_width/2));elem.scrollTop=Math.floor((this.params.height/2)-(scaled_crop_height/2));}
else{elem.style.width=''+this.params.width+'px';elem.style.height=''+this.params.height+'px';}},reset:function(){if(this.preview_active)this.unfreeze();this.unflip();if(this.userMedia){if(this.stream){if(this.stream.getVideoTracks){var tracks=this.stream.getVideoTracks();if(tracks&&tracks[0]&&tracks[0].stop)tracks[0].stop();}
else if(this.stream.stop){this.stream.stop();}}
delete this.stream;delete this.video;}
if(this.container){this.container.innerHTML='';delete this.container;}
this.loaded=false;this.live=false;},set:function(){if(arguments.length==1){for(var key in arguments[0]){this.params[key]=arguments[0][key];}}
else{this.params[arguments[0]]=arguments[1];}},on:function(name,callback){name=name.replace(/^on/i,'').toLowerCase();if(!this.hooks[name])this.hooks[name]=[];this.hooks[name].push(callback);},off:function(name,callback){name=name.replace(/^on/i,'').toLowerCase();if(this.hooks[name]){if(callback){var idx=this.hooks[name].indexOf(callback);if(idx>-1)this.hooks[name].splice(idx,1);}
else{this.hooks[name]=[];}}},dispatch:function(){var name=arguments[0].replace(/^on/i,'').toLowerCase();var args=Array.prototype.slice.call(arguments,1);if(this.hooks[name]&&this.hooks[name].length){for(var idx=0,len=this.hooks[name].length;idx<len;idx++){var hook=this.hooks[name][idx];if(typeof(hook)=='function'){hook.apply(this,args);}
else if((typeof(hook)=='object')&&(hook.length==2)){hook[0][hook[1]].apply(hook[0],args);}
else if(window[hook]){window[hook].apply(window,args);}}
return true;}
else if(name=='error'){alert("Webcam.js Error: "+args[0]);}
return false;},setSWFLocation:function(url){this.swfURL=url;},detectFlash:function(){var SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",win=window,nav=navigator,hasFlash=false;if(typeof nav.plugins!=="undefined"&&typeof nav.plugins[SHOCKWAVE_FLASH]==="object"){var desc=nav.plugins[SHOCKWAVE_FLASH].description;if(desc&&(typeof nav.mimeTypes!=="undefined"&&nav.mimeTypes[FLASH_MIME_TYPE]&&nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){hasFlash=true;}}
else if(typeof win.ActiveXObject!=="undefined"){try{var ax=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(ax){var ver=ax.GetVariable("$version");if(ver)hasFlash=true;}}
catch(e){;}}
return hasFlash;},getSWFHTML:function(){var html='';if(location.protocol.match(/file/)){this.dispatch('error',"Flash does not work from local disk.  Please run from a web server.");return'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';}
if(!this.detectFlash()){this.dispatch('error',"Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.");return'<h3 style="color:red">ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).</h3>';}
if(!this.swfURL){var base_url='';var scpts=document.getElementsByTagName('script');for(var idx=0,len=scpts.length;idx<len;idx++){var src=scpts[idx].getAttribute('src');if(src&&src.match(/\/webcam(\.min)?\.js/)){base_url=src.replace(/\/webcam(\.min)?\.js.*$/,'');idx=len;}}
if(base_url)this.swfURL=base_url+'/webcam.swf';else this.swfURL='webcam.swf';}
if(window.localStorage&&!localStorage.getItem('visited')){this.params.new_user=1;localStorage.setItem('visited',1);}
var flashvars='';for(var key in this.params){if(flashvars)flashvars+='&';flashvars+=key+'='+escape(this.params[key]);}
html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.swfURL+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+flashvars+'"/><embed id="webcam_movie_embed" src="'+this.swfURL+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+flashvars+'"></embed></object>';return html;},getMovie:function(){if(!this.loaded)return this.dispatch('error',"Flash Movie is not loaded yet");var movie=document.getElementById('webcam_movie_obj');if(!movie||!movie._snap)movie=document.getElementById('webcam_movie_embed');if(!movie)this.dispatch('error',"Cannot locate Flash movie in DOM");return movie;},freeze:function(){var self=this;var params=this.params;if(this.preview_active)this.unfreeze();var scaleX=this.params.width/this.params.dest_width;var scaleY=this.params.height/this.params.dest_height;this.unflip();var final_width=params.crop_width||params.dest_width;var final_height=params.crop_height||params.dest_height;var preview_canvas=document.createElement('canvas');preview_canvas.width=final_width;preview_canvas.height=final_height;var preview_context=preview_canvas.getContext('2d');this.preview_canvas=preview_canvas;this.preview_context=preview_context;if((scaleX!=1.0)||(scaleY!=1.0)){preview_canvas.style.webkitTransformOrigin='0px 0px';preview_canvas.style.mozTransformOrigin='0px 0px';preview_canvas.style.msTransformOrigin='0px 0px';preview_canvas.style.oTransformOrigin='0px 0px';preview_canvas.style.transformOrigin='0px 0px';preview_canvas.style.webkitTransform='scaleX('+scaleX+') scaleY('+scaleY+')';preview_canvas.style.mozTransform='scaleX('+scaleX+') scaleY('+scaleY+')';preview_canvas.style.msTransform='scaleX('+scaleX+') scaleY('+scaleY+')';preview_canvas.style.oTransform='scaleX('+scaleX+') scaleY('+scaleY+')';preview_canvas.style.transform='scaleX('+scaleX+') scaleY('+scaleY+')';}
this.snap(function(){preview_canvas.style.position='relative';preview_canvas.style.left=''+self.container.scrollLeft+'px';preview_canvas.style.top=''+self.container.scrollTop+'px';self.container.insertBefore(preview_canvas,self.peg);self.container.style.overflow='hidden';self.preview_active=true;},preview_canvas);},unfreeze:function(){if(this.preview_active){this.container.removeChild(this.preview_canvas);delete this.preview_context;delete this.preview_canvas;this.preview_active=false;this.flip();}},flip:function(){if(this.params.flip_horiz){var sty=this.container.style;sty.webkitTransform='scaleX(-1)';sty.mozTransform='scaleX(-1)';sty.msTransform='scaleX(-1)';sty.oTransform='scaleX(-1)';sty.transform='scaleX(-1)';sty.filter='FlipH';sty.msFilter='FlipH';}},unflip:function(){if(this.params.flip_horiz){var sty=this.container.style;sty.webkitTransform='scaleX(1)';sty.mozTransform='scaleX(1)';sty.msTransform='scaleX(1)';sty.oTransform='scaleX(1)';sty.transform='scaleX(1)';sty.filter='';sty.msFilter='';}},savePreview:function(user_callback,user_canvas){var params=this.params;var canvas=this.preview_canvas;var context=this.preview_context;if(user_canvas){var user_context=user_canvas.getContext('2d');user_context.drawImage(canvas,0,0);}
user_callback(user_canvas?null:canvas.toDataURL('image/'+params.image_format,params.jpeg_quality/100),canvas,context);this.unfreeze();},snap:function(user_callback,user_canvas){var self=this;var params=this.params;if(!this.loaded)return this.dispatch('error',"Webcam is not loaded yet");if(!user_callback)return this.dispatch('error',"Please provide a callback function or canvas to snap()");if(this.preview_active){this.savePreview(user_callback,user_canvas);return null;}
var canvas=document.createElement('canvas');canvas.width=this.params.dest_width;canvas.height=this.params.dest_height;var context=canvas.getContext('2d');if(this.params.flip_horiz){context.translate(params.dest_width,0);context.scale(-1,1);}
var func=function(){if(this.src&&this.width&&this.height){context.drawImage(this,0,0,params.dest_width,params.dest_height);}
if(params.crop_width&&params.crop_height){var crop_canvas=document.createElement('canvas');crop_canvas.width=params.crop_width;crop_canvas.height=params.crop_height;var crop_context=crop_canvas.getContext('2d');crop_context.drawImage(canvas,Math.floor((params.dest_width/2)-(params.crop_width/2)),Math.floor((params.dest_height/2)-(params.crop_height/2)),params.crop_width,params.crop_height,0,0,params.crop_width,params.crop_height);context=crop_context;canvas=crop_canvas;}
if(user_canvas){var user_context=user_canvas.getContext('2d');user_context.drawImage(canvas,0,0);}
user_callback(user_canvas?null:canvas.toDataURL('image/'+params.image_format,params.jpeg_quality/100),canvas,context);};if(this.userMedia){context.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height);func();}
else{var raw_data=this.getMovie()._snap();var img=new Image();img.onload=func;img.src='data:image/'+this.params.image_format+';base64,'+raw_data;}
return null;},configure:function(panel){if(!panel)panel="camera";this.getMovie()._configure(panel);},flashNotify:function(type,msg){switch(type){case'flashLoadComplete':this.loaded=true;this.dispatch('load');break;case'cameraLive':this.live=true;this.dispatch('live');this.flip();break;case'error':this.dispatch('error',msg);break;default:break;}},b64ToUint6:function(nChr){return nChr>64&&nChr<91?nChr-65:nChr>96&&nChr<123?nChr-71:nChr>47&&nChr<58?nChr+4:nChr===43?62:nChr===47?63:0;},base64DecToArr:function(sBase64,nBlocksSize){var sB64Enc=sBase64.replace(/[^A-Za-z0-9\+\/]/g,""),nInLen=sB64Enc.length,nOutLen=nBlocksSize?Math.ceil((nInLen*3+1>>2)/nBlocksSize)*nBlocksSize:nInLen*3+1>>2,taBytes=new Uint8Array(nOutLen);for(var nMod3,nMod4,nUint24=0,nOutIdx=0,nInIdx=0;nInIdx<nInLen;nInIdx++){nMod4=nInIdx&3;nUint24|=this.b64ToUint6(sB64Enc.charCodeAt(nInIdx))<<18-6*nMod4;if(nMod4===3||nInLen-nInIdx===1){for(nMod3=0;nMod3<3&&nOutIdx<nOutLen;nMod3++,nOutIdx++){taBytes[nOutIdx]=nUint24>>>(16>>>nMod3&24)&255;}
nUint24=0;}}
return taBytes;},upload:function(image_data_uri,target_url,callback){var form_elem_name=this.params.upload_name||'webcam';var image_fmt='';if(image_data_uri.match(/^data\:image\/(\w+)/))
image_fmt=RegExp.$1;else
throw"Cannot locate image format in Data URI";var raw_image_data=image_data_uri.replace(/^data\:image\/\w+\;base64\,/,'');var http=new XMLHttpRequest();http.open("POST",target_url,true);if(http.upload&&http.upload.addEventListener){http.upload.addEventListener('progress',function(e){if(e.lengthComputable){var progress=e.loaded/e.total;Webcam.dispatch('uploadProgress',progress,e);}},false);}
var self=this;http.onload=function(){if(callback)callback.apply(self,[http.status,http.responseText,http.statusText]);Webcam.dispatch('uploadComplete',http.status,http.responseText,http.statusText);};var blob=new Blob([this.base64DecToArr(raw_image_data)],{type:'image/'+image_fmt});var form=new FormData();form.append(form_elem_name,blob,form_elem_name+"."+image_fmt.replace(/e/,''));http.send(form);}};Webcam.init();if(typeof define==='function'&&define.amd){define(function(){return Webcam;});}
else if(typeof module==='object'&&module.exports){module.exports=Webcam;}
else{window.Webcam=Webcam;}}(window));;

/* /web_widget_image_webcam/static/src/js/webcam_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web_widget_image_webcam.webcam_widget',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;core.form_widget_registry.get("image").include({render_value:function(){this._super();var self=this,WebCamDialog=$(QWeb.render("WebCamDialog")),img_data;Webcam.set({width:320,height:240,dest_width:320,dest_height:240,image_format:'jpeg',jpeg_quality:90,force_flash:false,fps:45,swfURL:'/web_widget_image_webcam/static/src/js/webcam.swf',});self.$el.find('.o_form_binary_file_web_cam').removeClass('col-md-offset-5');new Model('ir.config_parameter').call('get_param',['web_widget_image_webcam.flash_fallback_mode',false]).then(function(default_flash_fallback_mode){if(default_flash_fallback_mode==1){Webcam.set({force_flash:true,});}});self.$el.find('.o_form_binary_file_web_cam').off().on('click',function(){new Dialog(self,{size:'large',dialogClass:'o_act_window',title:_t("WebCam Booth"),$content:WebCamDialog,buttons:[{text:_t("Take Snapshot"),classes:'btn-primary take_snap_btn',click:function(){Webcam.snap(function(data){img_data=data;WebCamDialog.find("#webcam_result").html('<img src="'+img_data+'"/>');});$('.save_close_btn').removeAttr('disabled');}},{text:_t("Save & Close"),classes:'btn-primary save_close_btn',close:true,click:function(){var img_data_base64=img_data.split(',')[1];var approx_img_size=3*(img_data_base64.length/4)
self.on_file_uploaded(approx_img_size,"web-cam-preview.jpeg","image/jpeg",img_data_base64);}},{text:_t("Close"),close:true}]}).open();Webcam.attach('#live_webcam');$('.save_close_btn').attr('disabled','disabled');WebCamDialog.find("#webcam_result").html('<img src="/web_widget_image_webcam/static/src/img/webcam_placeholder.png"/>');});},});Dialog.include({destroy:function(){Webcam.reset();this._super.apply(this,arguments);},});});;

/* /sale_stock/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define("sale_stock.tour",function(require){"use strict";var tour=require('web_tour.tour');require('sale.tour');var quotation_product_selected_step_index=_.findIndex(tour.tours.sale_tour.steps,function(step){return(step.id==="quotation_product_selected");});tour.tours.sale_tour.steps[quotation_product_selected_step_index].run=function(actions){actions.auto();};tour.tours.sale_tour.steps.splice(quotation_product_selected_step_index+1,0,{trigger:".o_dialog_warning + .modal-footer .btn-primary",auto:true,},{trigger:"body:not(:has(.o_dialog_warning))",auto:true,in_modal:false,run:function(actions){if($('.modal-footer .btn-primary').length){actions.auto(".modal-footer .btn-primary");}},});});;

/* /muk_web_preview/static/lib/printThis/printThis.js defined in bundle 'web.assets_backend' */
;(function($){function appendContent($el,content){if(!content)return;$el.append(content.jquery?content.clone():content);}
function appendBody($body,$element,opt){var $content=$element.clone();if(opt.removeScripts){$content.find('script').remove();}
if(opt.printContainer){$body.append($("<div/>").html($content).html());}else{$content.each(function(){$body.append($(this).html());});}}
var opt;$.fn.printThis=function(options){opt=$.extend({},$.fn.printThis.defaults,options);var $element=this instanceof jQuery?this:$(this);var strFrameName="printThis-"+(new Date()).getTime();if(window.location.hostname!==document.domain&&navigator.userAgent.match(/msie/i)){var iframeSrc="javascript:document.write(\"<head><script>document.domain=\\\""+document.domain+"\\\";</s"+"cript></head><body></body>\")";var printI=document.createElement('iframe');printI.name="printIframe";printI.id=strFrameName;printI.className="MSIE";document.body.appendChild(printI);printI.src=iframeSrc;}else{var $frame=$("<iframe id='"+strFrameName+"' name='printIframe' />");$frame.appendTo("body");}
var $iframe=$("#"+strFrameName);if(!opt.debug)$iframe.css({position:"absolute",width:"0px",height:"0px",left:"-600px",top:"-600px"});setTimeout(function(){function setDocType($iframe,doctype){var win,doc;win=$iframe.get(0);win=win.contentWindow||win.contentDocument||win;doc=win.document||win.contentDocument||win;doc.open();doc.write(doctype);doc.close();}
if(opt.doctypeString){setDocType($iframe,opt.doctypeString);}
var $doc=$iframe.contents(),$head=$doc.find("head"),$body=$doc.find("body"),$base=$('base'),baseURL;if(opt.base===true&&$base.length>0){baseURL=$base.attr('href');}else if(typeof opt.base==='string'){baseURL=opt.base;}else{baseURL=document.location.protocol+'//'+document.location.host;}
$head.append('<base href="'+baseURL+'">');if(opt.importCSS)$("link[rel=stylesheet]").each(function(){var href=$(this).attr("href");if(href){var media=$(this).attr("media")||"all";$head.append("<link type='text/css' rel='stylesheet' href='"+href+"' media='"+media+"'>");}});if(opt.importStyle)$("style").each(function(){$(this).clone().appendTo($head);});if(opt.pageTitle)$head.append("<title>"+opt.pageTitle+"</title>");if(opt.loadCSS){if($.isArray(opt.loadCSS)){jQuery.each(opt.loadCSS,function(index,value){$head.append("<link type='text/css' rel='stylesheet' href='"+this+"'>");});}else{$head.append("<link type='text/css' rel='stylesheet' href='"+opt.loadCSS+"'>");}}
appendContent($body,opt.header);if(opt.canvas){var canvasId=0;$element.find('canvas').each(function(){$(this).attr('data-printthis',canvasId++);});}
appendBody($body,$element,opt);if(opt.canvas){$body.find('canvas').each(function(){var cid=$(this).data('printthis'),$src=$('[data-printthis="'+cid+'"]');this.getContext('2d').drawImage($src[0],0,0);$src.removeData('printthis');});}
if(opt.formValues){var $input=$element.find('input');if($input.length){$input.each(function(){var $this=$(this),$name=$(this).attr('name'),$checker=$this.is(':checkbox')||$this.is(':radio'),$iframeInput=$doc.find('input[name="'+$name+'"]'),$value=$this.val();if(!$checker){$iframeInput.val($value);}else if($this.is(':checked')){if($this.is(':checkbox')){$iframeInput.attr('checked','checked');}else if($this.is(':radio')){$doc.find('input[name="'+$name+'"][value="'+$value+'"]').attr('checked','checked');}}});}
var $select=$element.find('select');if($select.length){$select.each(function(){var $this=$(this),$name=$(this).attr('name'),$value=$this.val();$doc.find('select[name="'+$name+'"]').val($value);});}
var $textarea=$element.find('textarea');if($textarea.length){$textarea.each(function(){var $this=$(this),$name=$(this).attr('name'),$value=$this.val();$doc.find('textarea[name="'+$name+'"]').val($value);});}}
if(opt.removeInline){if($.isFunction($.removeAttr)){$doc.find("body *").removeAttr("style");}else{$doc.find("body *").attr("style","");}}
appendContent($body,opt.footer);setTimeout(function(){if($iframe.hasClass("MSIE")){window.frames["printIframe"].focus();$head.append("<script>  window.print(); </s"+"cript>");}else{if(document.queryCommandSupported("print")){$iframe[0].contentWindow.document.execCommand("print",false,null);}else{$iframe[0].contentWindow.focus();$iframe[0].contentWindow.print();}}
if(!opt.debug){setTimeout(function(){$iframe.remove();},1000);}},opt.printDelay);},333);};$.fn.printThis.defaults={debug:false,importCSS:true,importStyle:false,printContainer:true,loadCSS:"",pageTitle:"",removeInline:false,printDelay:333,header:null,footer:null,formValues:true,canvas:false,base:false,doctypeString:'<!DOCTYPE html>',removeScripts:false};})(jQuery);;

/* /muk_web_preview/static/src/js/preview_handler.js defined in bundle 'web.assets_backend' */
odoo.define('muk_preview.PreviewHandler',function(require){"use strict";var core=require('web.core');var QWeb=core.qweb;var _t=core._t;var BaseHandler=core.Class.extend({init:function(widget){this.widget=widget;},checkExtension:function(extension){return false;},checkType:function(mimetype){return false;},createHtml:function(url,mimetype,extension,title){$.when();},});var PDFHandler=BaseHandler.extend({checkExtension:function(extension){return['.pdf','pdf'].includes(extension);},checkType:function(mimetype){return['application/pdf'].includes(mimetype);},createHtml:function(url,mimetype,extension,title){var result=$.Deferred();var viewerUrlTempalte=_.template('/muk_web_preview/static/lib/PDFjs/web/viewer.html?file=<%= url %>');result.resolve($(QWeb.render('ViewerJSFrame',{url:viewerUrlTempalte({url})})));return $.when(result);},});var OpenOfficeHandler=BaseHandler.extend({checkExtension:function(extension){return['.odt','.odp','.ods','.fodt','.ott','.fodp','.otp','.fods','.ots','odt','odp','ods','fodt','ott','fodp','otp','fods','ots'].includes(extension);},checkType:function(mimetype){return['application/vnd.oasis.opendocument.text','application/vnd.oasis.opendocument.presentation','application/vnd.oasis.opendocument.spreadsheet'].includes(mimetype);},createHtml:function(url,mimetype,extension,title){var result=$.Deferred();var viewerUrlTempalte=_.template('/muk_web_preview/static/lib/ViewerJS/index.html#<%= url %>');result.resolve($(QWeb.render('ViewerJSFrame',{url:viewerUrlTempalte({url})})));return $.when(result);},});return{BaseHandler:BaseHandler,PDFHandler:PDFHandler,OpenOfficeHandler:OpenOfficeHandler,}});;

/* /muk_web_preview/static/src/js/preview_generator.js defined in bundle 'web.assets_backend' */
odoo.define('muk_preview.PreviewGenerator',function(require){"use strict";var core=require('web.core');var PreviewHandler=require('muk_preview.PreviewHandler');var QWeb=core.qweb;var _t=core._t;var PreviewGenerator=core.Class.extend({handler:{},init:function(widget,additional_handler){this.widget=widget;this.handler=_.extend(this.handler,{"PDFHandler":new PreviewHandler.PDFHandler(widget),"OpenOfficeHandler":new PreviewHandler.OpenOfficeHandler(widget)});this.handler=_.extend(this.handler,additional_handler);},createPreview:function(url,mimetype,extension,title){var matchedHandler=false;_.each(this.handler,function(handler,key,handler_list){if(handler.checkExtension(extension)||handler.checkType(mimetype)){matchedHandler=handler;}});if(matchedHandler){return matchedHandler.createHtml(url,mimetype,extension,title);}else{return $.when($.Deferred().resolve($(QWeb.render('UnsupportedContent',{url:url,mimetype:mimetype||_t('Unknown'),extension:extension||_t('Unknown'),title:title||_t('Unknown')}))));}}});PreviewGenerator.createPreview=function(widget,url,mimetype,extension,title){return new PreviewGenerator(widget,{}).createPreview(url,mimetype,extension,title);};return PreviewGenerator;});;

/* /muk_web_preview/static/src/js/preview_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('muk_preview.PreviewWidgets',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var ListView=require('web.ListView');var PreviewHandler=require('muk_preview.PreviewHandler');var PreviewGenerator=require('muk_preview.PreviewGenerator');var PreviewDialog=require('muk_preview.PreviewDialog');var QWeb=core.qweb;var _t=core._t;core.form_widget_registry.get("binary").include({initialize_content:function(){var self=this;this._super();if(this.get("effective_readonly")){var $preview=this.$el.parent().find('.o_binary_preview');if($preview.length){$preview.show();}else{var $button=$('<button type="button" class="o_binary_preview" aria-hidden="true" />');$button.append($('<i class="fa fa-file-text-o"></i>'));$button.insertBefore(this.$el);$button.click(function(e){e.preventDefault();e.stopPropagation();var value=self.get('value');var filename_fieldname=self.node.attrs.filename;var filename_field=self.view.fields&&filename_fieldname&&self.view.fields[filename_fieldname];var filename=filename_field?filename_field.get('value'):null;PreviewDialog.createPreviewDialog(self,'/web/content?'+$.param({'model':self.view.dataset.model,'id':self.view.datarecord.id,'field':self.name,'filename_field':filename_fieldname,'filename':filename,'download':true,'data':utils.is_bin_size(value)?null:value,}),false,filename?filename.split('.').pop():false,filename);});}}else{this.$el.parent().find('.o_binary_preview').hide();}},});core.list_widget_registry.get("field.binary").include({_format:function(row_data,options){var link=this._super(row_data,options);var value=row_data[this.id].value;var filename=this.filename&&row_data[this.filename].value;if(value&&filename&&value.substr(0,10).indexOf(' ')!==-1){var download_url='/web/content?'+$.param({'model':options.model,'field':this.id,'id':options.id,'download':true,'filename_field':this.filename});var preview=_.template('<button type="button" \
	        		  class="o_binary_preview" \
	        		  aria-hidden="true" \
					  data-link="<%-link%>" \
					  data-filename="<%-filename%>"> \
	        	  	<i class="fa fa-file-text-o"></i> \
	          	</button>')({link:download_url,filename:filename,});return preview+link;}
return link;}});ListView.include({reload_content:function(){var self=this;var reloaded=this._super();reloaded.then(function(){var $elements=self.$el.find('.o_binary_preview');$elements.click(function(e){e.stopPropagation();var $target=$(e.currentTarget);PreviewDialog.createPreviewDialog(self,$target.data('link'),false,$target.data('filename').split('.').pop(),$target.data('filename'));});});return reloaded;}});});;

/* /muk_web_preview/static/src/js/preview_dialog.js defined in bundle 'web.assets_backend' */
odoo.define('muk_preview.PreviewDialog',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var Widget=require('web.Widget');var PreviewHandler=require('muk_preview.PreviewHandler');var PreviewGenerator=require('muk_preview.PreviewGenerator');var QWeb=core.qweb;var _t=core._t;var PreviewDialog=Widget.extend({init:function(parent,generator,url,mimetype,extension,title){this._super(parent);this._opened=$.Deferred();this.title=title||_t('Preview');this.url=url;this.mimetype=mimetype;this.extension=extension;this.$modal=$(QWeb.render('PreviewDialog',{title:this.title,url:this.url}));this.$modal.on('hidden.bs.modal',_.bind(this.destroy,this));this.$modal.find('.preview-maximize').on('click',_.bind(this.maximize,this));this.$modal.find('.preview-minimize').on('click',_.bind(this.minimize,this));this.$modal.find('.preview-print').on('click',_.bind(this.print,this));this.generator=generator;this.generator.widget=this;},renderElement:function(){this._super();var self=this;this.generator.createPreview(this.url,this.mimetype,this.extension,this.title).then(function($content){self.setElement($("<div/>").addClass("modal-body preview-body").append($content));self.$modal.find('.preview-print').toggle($content.hasClass('printable'));});},open:function(){var self=this;$('.tooltip').remove();this.$modal.draggable({handle:'.modal-header',helper:false});this.replace(this.$modal.find(".modal-body")).then(function(){self.$modal.modal('show');self._opened.resolve();});return self;},maximize:function(e){this.$modal.find('.preview-maximize').toggle();this.$modal.find('.preview-minimize').toggle();this.$modal.addClass("modal-fullscreen");},minimize:function(e){this.$modal.find('.preview-maximize').toggle();this.$modal.find('.preview-minimize').toggle();this.$modal.removeClass("modal-fullscreen");},print:function(e){var $printable=this.$modal.find('.printable');framework.blockUI();setTimeout(function(){framework.unblockUI();},($printable.data('print-delay')||333)*0.95);if(this.$modal.find('.print-content').length){this.$modal.find('.print-content').printThis({importCSS:true,importStyle:true,printDelay:$printable.data('print-delay')||333,loadCSS:$printable.data('print-css')||"",});}else{this.$modal.find('.printable').printThis({importCSS:true,importStyle:true,printDelay:$printable.data('print-delay')||333,loadCSS:$printable.data('print-css')||"",});}},close:function(){var draggable=this.$modal.draggable("instance");if(draggable){this.$modal.draggable("destroy");}
this.$modal.modal('hide');},destroy:function(reason){$('.tooltip').remove();if(this.isDestroyed()){return;}
this.trigger("closed",reason);this._super();this.$modal.modal('hide');this.$modal.remove();setTimeout(function(){var modals=$('body > .modal').filter(':visible');if(modals.length){modals.last().focus();$('body').addClass('modal-open');}},0);}});PreviewDialog.createPreviewDialog=function(parent,url,mimetype,extension,title){return new PreviewDialog(parent,new PreviewGenerator(parent,{}),url,mimetype,extension,title).open();};return PreviewDialog;});;

/* /muk_web_preview_msoffice/static/lib/jQueryBinaryTransport/jquery-binarytransport.js defined in bundle 'web.assets_backend' */
$.ajaxTransport("+binary",function(options,originalOptions,jqXHR){if(window.FormData&&((options.dataType&&(options.dataType=='binary'))||(options.data&&((window.ArrayBuffer&&options.data instanceof ArrayBuffer)||(window.Blob&&options.data instanceof Blob)))))
{return{send:function(headers,callback){var xhr=new XMLHttpRequest(),url=options.url,type=options.type,async=options.async||true,dataType=options.responseType||"blob",data=options.data||null,username=options.username||null,password=options.password||null;xhr.addEventListener('load',function(){var data={};data[options.dataType]=xhr.response;callback(xhr.status,xhr.statusText,data,xhr.getAllResponseHeaders());});xhr.open(type,url,async,username,password);for(var i in headers){xhr.setRequestHeader(i,headers[i]);}
xhr.responseType=dataType;xhr.send(data);},abort:function(){jqXHR.abort();}};}});;

/* /muk_web_preview_msoffice/static/lib/SheetJS/xlsx.js defined in bundle 'web.assets_backend' */
(function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd){JSZip=e();define([],e)}else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof $&&$.global?f=$.global:"undefined"!=typeof self&&(f=self),f.JSZip=e()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";exports.encode=function(input,utf8){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4)}return output};exports.decode=function(input,utf8){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));enc4=_keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}return output}},{}],2:[function(_dereq_,module,exports){"use strict";function CompressedObject(){this.compressedSize=0;this.uncompressedSize=0;this.crc32=0;this.compressionMethod=null;this.compressedContent=null}CompressedObject.prototype={getContent:function(){return null},getCompressedContent:function(){return null}};module.exports=CompressedObject},{}],3:[function(_dereq_,module,exports){"use strict";exports.STORE={magic:"\0\0",compress:function(content){return content},uncompress:function(content){return content},compressInputType:null,uncompressInputType:null};exports.DEFLATE=_dereq_("./flate")},{"./flate":8}],4:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");var table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];module.exports=function crc32(input,crc){if(typeof input==="undefined"||!input.length){return 0}var isArray=utils.getTypeOf(input)!=="string";if(typeof crc=="undefined"){crc=0}var x=0;var y=0;var b=0;crc=crc^-1;for(var i=0,iTop=input.length;i<iTop;i++){b=isArray?input[i]:input.charCodeAt(i);y=(crc^b)&255;x=table[y];crc=crc>>>8^x}return crc^-1}},{"./utils":21}],5:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");function DataReader(data){this.data=null;this.length=0;this.index=0}DataReader.prototype={checkOffset:function(offset){this.checkIndex(this.index+offset)},checkIndex:function(newIndex){if(this.length<newIndex||newIndex<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+newIndex+"). Corrupted zip ?")}},setIndex:function(newIndex){this.checkIndex(newIndex);this.index=newIndex},skip:function(n){this.setIndex(this.index+n)},byteAt:function(i){},readInt:function(size){var result=0,i;this.checkOffset(size);for(i=this.index+size-1;i>=this.index;i--){result=(result<<8)+this.byteAt(i)}this.index+=size;return result},readString:function(size){return utils.transformTo("string",this.readData(size))},readData:function(size){},lastIndexOfSignature:function(sig){},readDate:function(){var dostime=this.readInt(4);return new Date((dostime>>25&127)+1980,(dostime>>21&15)-1,dostime>>16&31,dostime>>11&31,dostime>>5&63,(dostime&31)<<1)}};module.exports=DataReader},{"./utils":21}],6:[function(_dereq_,module,exports){"use strict";exports.base64=false;exports.binary=false;exports.dir=false;exports.createFolders=false;exports.date=null;exports.compression=null;exports.comment=null},{}],7:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");exports.string2binary=function(str){return utils.string2binary(str)};exports.string2Uint8Array=function(str){return utils.transformTo("uint8array",str)};exports.uint8Array2String=function(array){return utils.transformTo("string",array)};exports.string2Blob=function(str){var buffer=utils.transformTo("arraybuffer",str);return utils.arrayBuffer2Blob(buffer)};exports.arrayBuffer2Blob=function(buffer){return utils.arrayBuffer2Blob(buffer)};exports.transformTo=function(outputType,input){return utils.transformTo(outputType,input)};exports.getTypeOf=function(input){return utils.getTypeOf(input)};exports.checkSupport=function(type){return utils.checkSupport(type)};exports.MAX_VALUE_16BITS=utils.MAX_VALUE_16BITS;exports.MAX_VALUE_32BITS=utils.MAX_VALUE_32BITS;exports.pretty=function(str){return utils.pretty(str)};exports.findCompression=function(compressionMethod){return utils.findCompression(compressionMethod)};exports.isRegExp=function(object){return utils.isRegExp(object)}},{"./utils":21}],8:[function(_dereq_,module,exports){"use strict";var USE_TYPEDARRAY=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined";var pako=_dereq_("pako");exports.uncompressInputType=USE_TYPEDARRAY?"uint8array":"array";exports.compressInputType=USE_TYPEDARRAY?"uint8array":"array";exports.magic="\b\0";exports.compress=function(input){return pako.deflateRaw(input)};exports.uncompress=function(input){return pako.inflateRaw(input)}},{pako:24}],9:[function(_dereq_,module,exports){"use strict";var base64=_dereq_("./base64");function JSZip(data,options){if(!(this instanceof JSZip))return new JSZip(data,options);this.files={};this.comment=null;this.root="";if(data){this.load(data,options)}this.clone=function(){var newObj=new JSZip;for(var i in this){if(typeof this[i]!=="function"){newObj[i]=this[i]}}return newObj}}JSZip.prototype=_dereq_("./object");JSZip.prototype.load=_dereq_("./load");JSZip.support=_dereq_("./support");JSZip.defaults=_dereq_("./defaults");JSZip.utils=_dereq_("./deprecatedPublicUtils");JSZip.base64={encode:function(input){return base64.encode(input)},decode:function(input){return base64.decode(input)}};JSZip.compressions=_dereq_("./compressions");module.exports=JSZip},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(_dereq_,module,exports){"use strict";var base64=_dereq_("./base64");var ZipEntries=_dereq_("./zipEntries");module.exports=function(data,options){var files,zipEntries,i,input;options=options||{};if(options.base64){data=base64.decode(data)}zipEntries=new ZipEntries(data,options);files=zipEntries.files;for(i=0;i<files.length;i++){input=files[i];this.file(input.fileName,input.decompressed,{binary:true,optimizedBinaryString:true,date:input.date,dir:input.dir,comment:input.fileComment.length?input.fileComment:null,createFolders:options.createFolders})}if(zipEntries.zipComment.length){this.comment=zipEntries.zipComment}return this}},{"./base64":1,"./zipEntries":22}],11:[function(_dereq_,module,exports){(function(Buffer){"use strict";module.exports=function(data,encoding){return new Buffer(data,encoding)};module.exports.test=function(b){return Buffer.isBuffer(b)}}).call(this,typeof Buffer!=="undefined"?Buffer:undefined)},{}],12:[function(_dereq_,module,exports){"use strict";var Uint8ArrayReader=_dereq_("./uint8ArrayReader");function NodeBufferReader(data){this.data=data;this.length=this.data.length;this.index=0}NodeBufferReader.prototype=new Uint8ArrayReader;NodeBufferReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.index,this.index+size);this.index+=size;return result};module.exports=NodeBufferReader},{"./uint8ArrayReader":18}],13:[function(_dereq_,module,exports){"use strict";var support=_dereq_("./support");var utils=_dereq_("./utils");var crc32=_dereq_("./crc32");var signature=_dereq_("./signature");var defaults=_dereq_("./defaults");var base64=_dereq_("./base64");var compressions=_dereq_("./compressions");var CompressedObject=_dereq_("./compressedObject");var nodeBuffer=_dereq_("./nodeBuffer");var utf8=_dereq_("./utf8");var StringWriter=_dereq_("./stringWriter");var Uint8ArrayWriter=_dereq_("./uint8ArrayWriter");var getRawData=function(file){if(file._data instanceof CompressedObject){file._data=file._data.getContent();file.options.binary=true;file.options.base64=false;if(utils.getTypeOf(file._data)==="uint8array"){var copy=file._data;file._data=new Uint8Array(copy.length);if(copy.length!==0){file._data.set(copy,0)}}}return file._data};var getBinaryData=function(file){var result=getRawData(file),type=utils.getTypeOf(result);if(type==="string"){if(!file.options.binary){if(support.nodebuffer){return nodeBuffer(result,"utf-8")}}return file.asBinary()}return result};var dataToString=function(asUTF8){var result=getRawData(this);if(result===null||typeof result==="undefined"){return""}if(this.options.base64){result=base64.decode(result)}if(asUTF8&&this.options.binary){result=out.utf8decode(result)}else{result=utils.transformTo("string",result)}if(!asUTF8&&!this.options.binary){result=utils.transformTo("string",out.utf8encode(result))}return result};var ZipObject=function(name,data,options){this.name=name;this.dir=options.dir;this.date=options.date;this.comment=options.comment;this._data=data;this.options=options;this._initialMetadata={dir:options.dir,date:options.date}};ZipObject.prototype={asText:function(){return dataToString.call(this,true)},asBinary:function(){return dataToString.call(this,false)},asNodeBuffer:function(){var result=getBinaryData(this);return utils.transformTo("nodebuffer",result)},asUint8Array:function(){var result=getBinaryData(this);return utils.transformTo("uint8array",result)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var decToHex=function(dec,bytes){var hex="",i;for(i=0;i<bytes;i++){hex+=String.fromCharCode(dec&255);dec=dec>>>8}return hex};var extend=function(){var result={},i,attr;for(i=0;i<arguments.length;i++){for(attr in arguments[i]){if(arguments[i].hasOwnProperty(attr)&&typeof result[attr]==="undefined"){result[attr]=arguments[i][attr]}}}return result};var prepareFileAttrs=function(o){o=o||{};if(o.base64===true&&(o.binary===null||o.binary===undefined)){o.binary=true}o=extend(o,defaults);o.date=o.date||new Date;if(o.compression!==null)o.compression=o.compression.toUpperCase();return o};var fileAdd=function(name,data,o){var dataType=utils.getTypeOf(data),parent;o=prepareFileAttrs(o);if(o.createFolders&&(parent=parentFolder(name))){folderAdd.call(this,parent,true)}if(o.dir||data===null||typeof data==="undefined"){o.base64=false;o.binary=false;data=null}else if(dataType==="string"){if(o.binary&&!o.base64){if(o.optimizedBinaryString!==true){data=utils.string2binary(data)}}}else{o.base64=false;o.binary=true;if(!dataType&&!(data instanceof CompressedObject)){throw new Error("The data of '"+name+"' is in an unsupported format !")}if(dataType==="arraybuffer"){data=utils.transformTo("uint8array",data)}}var object=new ZipObject(name,data,o);this.files[name]=object;return object};var parentFolder=function(path){if(path.slice(-1)=="/"){path=path.substring(0,path.length-1)}var lastSlash=path.lastIndexOf("/");return lastSlash>0?path.substring(0,lastSlash):""};var folderAdd=function(name,createFolders){if(name.slice(-1)!="/"){name+="/"}createFolders=typeof createFolders!=="undefined"?createFolders:false;if(!this.files[name]){fileAdd.call(this,name,null,{dir:true,createFolders:createFolders})}return this.files[name]};var generateCompressedObjectFrom=function(file,compression){var result=new CompressedObject,content;if(file._data instanceof CompressedObject){result.uncompressedSize=file._data.uncompressedSize;result.crc32=file._data.crc32;if(result.uncompressedSize===0||file.dir){compression=compressions["STORE"];result.compressedContent="";result.crc32=0}else if(file._data.compressionMethod===compression.magic){result.compressedContent=file._data.getCompressedContent()}else{content=file._data.getContent();result.compressedContent=compression.compress(utils.transformTo(compression.compressInputType,content))}}else{content=getBinaryData(file);if(!content||content.length===0||file.dir){compression=compressions["STORE"];content=""}result.uncompressedSize=content.length;result.crc32=crc32(content);result.compressedContent=compression.compress(utils.transformTo(compression.compressInputType,content))}result.compressedSize=result.compressedContent.length;result.compressionMethod=compression.magic;return result};var generateZipParts=function(name,file,compressedObject,offset){var data=compressedObject.compressedContent,utfEncodedFileName=utils.transformTo("string",utf8.utf8encode(file.name)),comment=file.comment||"",utfEncodedComment=utils.transformTo("string",utf8.utf8encode(comment)),useUTF8ForFileName=utfEncodedFileName.length!==file.name.length,useUTF8ForComment=utfEncodedComment.length!==comment.length,o=file.options,dosTime,dosDate,extraFields="",unicodePathExtraField="",unicodeCommentExtraField="",dir,date;if(file._initialMetadata.dir!==file.dir){dir=file.dir}else{dir=o.dir}if(file._initialMetadata.date!==file.date){date=file.date}else{date=o.date}dosTime=date.getHours();dosTime=dosTime<<6;dosTime=dosTime|date.getMinutes();dosTime=dosTime<<5;dosTime=dosTime|date.getSeconds()/2;dosDate=date.getFullYear()-1980;dosDate=dosDate<<4;dosDate=dosDate|date.getMonth()+1;dosDate=dosDate<<5;dosDate=dosDate|date.getDate();if(useUTF8ForFileName){unicodePathExtraField=decToHex(1,1)+decToHex(crc32(utfEncodedFileName),4)+utfEncodedFileName;extraFields+="up"+decToHex(unicodePathExtraField.length,2)+unicodePathExtraField}if(useUTF8ForComment){unicodeCommentExtraField=decToHex(1,1)+decToHex(this.crc32(utfEncodedComment),4)+utfEncodedComment;extraFields+="uc"+decToHex(unicodeCommentExtraField.length,2)+unicodeCommentExtraField}var header="";header+="\n\0";header+=useUTF8ForFileName||useUTF8ForComment?"\0\b":"\0\0";header+=compressedObject.compressionMethod;header+=decToHex(dosTime,2);header+=decToHex(dosDate,2);header+=decToHex(compressedObject.crc32,4);header+=decToHex(compressedObject.compressedSize,4);header+=decToHex(compressedObject.uncompressedSize,4);header+=decToHex(utfEncodedFileName.length,2);header+=decToHex(extraFields.length,2);var fileRecord=signature.LOCAL_FILE_HEADER+header+utfEncodedFileName+extraFields;var dirRecord=signature.CENTRAL_FILE_HEADER+"\0"+header+decToHex(utfEncodedComment.length,2)+"\0\0"+"\0\0"+(dir===true?"\0\0\0":"\0\0\0\0")+decToHex(offset,4)+utfEncodedFileName+extraFields+utfEncodedComment;return{fileRecord:fileRecord,dirRecord:dirRecord,compressedObject:compressedObject}};var out={load:function(stream,options){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(search){var result=[],filename,relativePath,file,fileClone;for(filename in this.files){if(!this.files.hasOwnProperty(filename)){continue}file=this.files[filename];fileClone=new ZipObject(file.name,file._data,extend(file.options));relativePath=filename.slice(this.root.length,filename.length);if(filename.slice(0,this.root.length)===this.root&&search(relativePath,fileClone)){result.push(fileClone)}}return result},file:function(name,data,o){if(arguments.length===1){if(utils.isRegExp(name)){var regexp=name;return this.filter(function(relativePath,file){return!file.dir&&regexp.test(relativePath)})}else{return this.filter(function(relativePath,file){return!file.dir&&relativePath===name})[0]||null}}else{name=this.root+name;fileAdd.call(this,name,data,o)}return this},folder:function(arg){if(!arg){return this}if(utils.isRegExp(arg)){return this.filter(function(relativePath,file){return file.dir&&arg.test(relativePath)})}var name=this.root+arg;var newFolder=folderAdd.call(this,name);var ret=this.clone();ret.root=newFolder.name;return ret},remove:function(name){name=this.root+name;var file=this.files[name];if(!file){if(name.slice(-1)!="/"){name+="/"}file=this.files[name]}if(file&&!file.dir){delete this.files[name]}else{var kids=this.filter(function(relativePath,file){return file.name.slice(0,name.length)===name});for(var i=0;i<kids.length;i++){delete this.files[kids[i].name]}}return this},generate:function(options){options=extend(options||{},{base64:true,compression:"STORE",type:"base64",comment:null});utils.checkSupport(options.type);var zipData=[],localDirLength=0,centralDirLength=0,writer,i,utfEncodedComment=utils.transformTo("string",this.utf8encode(options.comment||this.comment||""));for(var name in this.files){if(!this.files.hasOwnProperty(name)){continue}var file=this.files[name];var compressionName=file.options.compression||options.compression.toUpperCase();var compression=compressions[compressionName];if(!compression){throw new Error(compressionName+" is not a valid compression method !")}var compressedObject=generateCompressedObjectFrom.call(this,file,compression);var zipPart=generateZipParts.call(this,name,file,compressedObject,localDirLength);localDirLength+=zipPart.fileRecord.length+compressedObject.compressedSize;centralDirLength+=zipPart.dirRecord.length;zipData.push(zipPart)}var dirEnd="";dirEnd=signature.CENTRAL_DIRECTORY_END+"\0\0"+"\0\0"+decToHex(zipData.length,2)+decToHex(zipData.length,2)+decToHex(centralDirLength,4)+decToHex(localDirLength,4)+decToHex(utfEncodedComment.length,2)+utfEncodedComment;var typeName=options.type.toLowerCase();if(typeName==="uint8array"||typeName==="arraybuffer"||typeName==="blob"||typeName==="nodebuffer"){writer=new Uint8ArrayWriter(localDirLength+centralDirLength+dirEnd.length)}else{writer=new StringWriter(localDirLength+centralDirLength+dirEnd.length)}for(i=0;i<zipData.length;i++){writer.append(zipData[i].fileRecord);writer.append(zipData[i].compressedObject.compressedContent)}for(i=0;i<zipData.length;i++){writer.append(zipData[i].dirRecord)}writer.append(dirEnd);var zip=writer.finalize();switch(options.type.toLowerCase()){case"uint8array":;case"arraybuffer":;case"nodebuffer":return utils.transformTo(options.type.toLowerCase(),zip);case"blob":return utils.arrayBuffer2Blob(utils.transformTo("arraybuffer",zip));case"base64":return options.base64?base64.encode(zip):zip;default:return zip;}},crc32:function(input,crc){return crc32(input,crc)},utf8encode:function(string){return utils.transformTo("string",utf8.utf8encode(string))},utf8decode:function(input){return utf8.utf8decode(input)}};module.exports=out},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(_dereq_,module,exports){"use strict";exports.LOCAL_FILE_HEADER="PK";exports.CENTRAL_FILE_HEADER="PK";exports.CENTRAL_DIRECTORY_END="PK";exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK";exports.ZIP64_CENTRAL_DIRECTORY_END="PK";exports.DATA_DESCRIPTOR="PK\b"},{}],15:[function(_dereq_,module,exports){"use strict";var DataReader=_dereq_("./dataReader");var utils=_dereq_("./utils");function StringReader(data,optimizedBinaryString){this.data=data;if(!optimizedBinaryString){this.data=utils.string2binary(this.data)}this.length=this.data.length;this.index=0}StringReader.prototype=new DataReader;StringReader.prototype.byteAt=function(i){return this.data.charCodeAt(i)};StringReader.prototype.lastIndexOfSignature=function(sig){return this.data.lastIndexOf(sig)};StringReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.index,this.index+size);this.index+=size;return result};module.exports=StringReader},{"./dataReader":5,"./utils":21}],16:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");var StringWriter=function(){this.data=[]};StringWriter.prototype={append:function(input){input=utils.transformTo("string",input);this.data.push(input)},finalize:function(){return this.data.join("")}};module.exports=StringWriter},{"./utils":21}],17:[function(_dereq_,module,exports){(function(Buffer){"use strict";exports.base64=true;exports.array=true;exports.string=true;exports.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";exports.nodebuffer=typeof Buffer!=="undefined";exports.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined"){exports.blob=false}else{var buffer=new ArrayBuffer(0);try{exports.blob=new Blob([buffer],{type:"application/zip"}).size===0}catch(e){try{var Builder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var builder=new Builder;builder.append(buffer);exports.blob=builder.getBlob("application/zip").size===0}catch(e){exports.blob=false}}}}).call(this,typeof Buffer!=="undefined"?Buffer:undefined)},{}],18:[function(_dereq_,module,exports){"use strict";var DataReader=_dereq_("./dataReader");function Uint8ArrayReader(data){if(data){this.data=data;this.length=this.data.length;this.index=0}}Uint8ArrayReader.prototype=new DataReader;Uint8ArrayReader.prototype.byteAt=function(i){return this.data[i]};Uint8ArrayReader.prototype.lastIndexOfSignature=function(sig){var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3);for(var i=this.length-4;i>=0;--i){if(this.data[i]===sig0&&this.data[i+1]===sig1&&this.data[i+2]===sig2&&this.data[i+3]===sig3){return i}}return-1};Uint8ArrayReader.prototype.readData=function(size){this.checkOffset(size);if(size===0){return new Uint8Array(0)}var result=this.data.subarray(this.index,this.index+size);this.index+=size;return result};module.exports=Uint8ArrayReader},{"./dataReader":5}],19:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");var Uint8ArrayWriter=function(length){this.data=new Uint8Array(length);this.index=0};Uint8ArrayWriter.prototype={append:function(input){if(input.length!==0){input=utils.transformTo("uint8array",input);this.data.set(input,this.index);this.index+=input.length}},finalize:function(){return this.data}};module.exports=Uint8ArrayWriter},{"./utils":21}],20:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");var support=_dereq_("./support");var nodeBuffer=_dereq_("./nodeBuffer");var _utf8len=new Array(256);for(var i=0;i<256;i++){_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1}_utf8len[254]=_utf8len[254]=1;var string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}if(support.uint8array){buf=new Uint8Array(buf_len)}else{buf=new Array(buf_len)}for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128){buf[i++]=c}else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};var utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length}pos=max-1;while(pos>=0&&(buf[pos]&192)===128){pos--}if(pos<0){return max}if(pos===0){return max}return pos+_utf8len[buf[pos]]>max?pos:max};var buf2string=function(buf){var str,i,out,c,c_len;var len=buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536){utf16buf[out++]=c}else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}if(utf16buf.length!==out){if(utf16buf.subarray){utf16buf=utf16buf.subarray(0,out)}else{utf16buf.length=out}}return utils.applyFromCharCode(utf16buf)};exports.utf8encode=function utf8encode(str){if(support.nodebuffer){return nodeBuffer(str,"utf-8")}return string2buf(str)};exports.utf8decode=function utf8decode(buf){if(support.nodebuffer){return utils.transformTo("nodebuffer",buf).toString("utf-8")}buf=utils.transformTo(support.uint8array?"uint8array":"array",buf);var result=[],k=0,len=buf.length,chunk=65536;while(k<len){var nextBoundary=utf8border(buf,Math.min(k+chunk,len));if(support.uint8array){result.push(buf2string(buf.subarray(k,nextBoundary)))}else{result.push(buf2string(buf.slice(k,nextBoundary)))}k=nextBoundary}return result.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(_dereq_,module,exports){"use strict";var support=_dereq_("./support");var compressions=_dereq_("./compressions");var nodeBuffer=_dereq_("./nodeBuffer");exports.string2binary=function(str){var result="";for(var i=0;i<str.length;i++){result+=String.fromCharCode(str.charCodeAt(i)&255)}return result};exports.arrayBuffer2Blob=function(buffer){exports.checkSupport("blob");try{return new Blob([buffer],{type:"application/zip"})}catch(e){try{var Builder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var builder=new Builder;builder.append(buffer);return builder.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}};function identity(input){return input}function stringToArrayLike(str,array){for(var i=0;i<str.length;++i){array[i]=str.charCodeAt(i)&255}return array}function arrayLikeToString(array){var chunk=65536;var result=[],len=array.length,type=exports.getTypeOf(array),k=0,canUseApply=true;try{switch(type){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,nodeBuffer(0));break;}}catch(e){canUseApply=false}if(!canUseApply){var resultStr="";for(var i=0;i<array.length;i++){resultStr+=String.fromCharCode(array[i])}return resultStr}while(k<len&&chunk>1){try{if(type==="array"||type==="nodebuffer"){result.push(String.fromCharCode.apply(null,array.slice(k,Math.min(k+chunk,len))))}else{result.push(String.fromCharCode.apply(null,array.subarray(k,Math.min(k+chunk,len))))}k+=chunk}catch(e){chunk=Math.floor(chunk/2)}}return result.join("")}exports.applyFromCharCode=arrayLikeToString;function arrayLikeToArrayLike(arrayFrom,arrayTo){for(var i=0;i<arrayFrom.length;i++){arrayTo[i]=arrayFrom[i]}return arrayTo}var transform={};transform["string"]={string:identity,array:function(input){return stringToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return transform["string"]["uint8array"](input).buffer},uint8array:function(input){return stringToArrayLike(input,new Uint8Array(input.length))},nodebuffer:function(input){return stringToArrayLike(input,nodeBuffer(input.length))}};transform["array"]={string:arrayLikeToString,array:identity,arraybuffer:function(input){return new Uint8Array(input).buffer},uint8array:function(input){return new Uint8Array(input)},nodebuffer:function(input){return nodeBuffer(input)}};transform["arraybuffer"]={string:function(input){return arrayLikeToString(new Uint8Array(input))},array:function(input){return arrayLikeToArrayLike(new Uint8Array(input),new Array(input.byteLength))},arraybuffer:identity,uint8array:function(input){return new Uint8Array(input)},nodebuffer:function(input){return nodeBuffer(new Uint8Array(input))}};transform["uint8array"]={string:arrayLikeToString,array:function(input){return arrayLikeToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return input.buffer},uint8array:identity,nodebuffer:function(input){return nodeBuffer(input)}};transform["nodebuffer"]={string:arrayLikeToString,array:function(input){return arrayLikeToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return transform["nodebuffer"]["uint8array"](input).buffer},uint8array:function(input){return arrayLikeToArrayLike(input,new Uint8Array(input.length))},nodebuffer:identity};exports.transformTo=function(outputType,input){if(!input){input=""}if(!outputType){return input}exports.checkSupport(outputType);var inputType=exports.getTypeOf(input);var result=transform[inputType][outputType](input);return result};exports.getTypeOf=function(input){if(typeof input==="string"){return"string"}if(Object.prototype.toString.call(input)==="[object Array]"){return"array"}if(support.nodebuffer&&nodeBuffer.test(input)){return"nodebuffer"}if(support.uint8array&&input instanceof Uint8Array){return"uint8array"}if(support.arraybuffer&&input instanceof ArrayBuffer){return"arraybuffer"}};exports.checkSupport=function(type){var supported=support[type.toLowerCase()];if(!supported){throw new Error(type+" is not supported by this browser")}};exports.MAX_VALUE_16BITS=65535;exports.MAX_VALUE_32BITS=-1;exports.pretty=function(str){var res="",code,i;for(i=0;i<(str||"").length;i++){code=str.charCodeAt(i);res+="\\x"+(code<16?"0":"")+code.toString(16).toUpperCase();}return res};exports.findCompression=function(compressionMethod){for(var method in compressions){if(!compressions.hasOwnProperty(method)){continue}if(compressions[method].magic===compressionMethod){return compressions[method]}}return null};exports.isRegExp=function(object){return Object.prototype.toString.call(object)==="[object RegExp]"}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(_dereq_,module,exports){"use strict";var StringReader=_dereq_("./stringReader");var NodeBufferReader=_dereq_("./nodeBufferReader");var Uint8ArrayReader=_dereq_("./uint8ArrayReader");var utils=_dereq_("./utils");var sig=_dereq_("./signature");var ZipEntry=_dereq_("./zipEntry");var support=_dereq_("./support");var jszipProto=_dereq_("./object");function ZipEntries(data,loadOptions){this.files=[];this.loadOptions=loadOptions;if(data){this.load(data)}}ZipEntries.prototype={checkSignature:function(expectedSignature){var signature=this.reader.readString(4);if(signature!==expectedSignature){throw new Error("Corrupted zip or bug : unexpected signature "+"("+utils.pretty(signature)+", expected "+utils.pretty(expectedSignature)+")")}},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);this.zipComment=this.reader.readString(this.zipCommentLength);this.zipComment=jszipProto.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.versionMadeBy=this.reader.readString(2);this.versionNeeded=this.reader.readInt(2);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var extraDataSize=this.zip64EndOfCentralSize-44,index=0,extraFieldId,extraFieldLength,extraFieldValue;while(index<extraDataSize){extraFieldId=this.reader.readInt(2);extraFieldLength=this.reader.readInt(4);extraFieldValue=this.reader.readString(extraFieldLength);this.zip64ExtensibleData[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1){throw new Error("Multi-volumes zip are not supported")}},readLocalFiles:function(){var i,file;for(i=0;i<this.files.length;i++){file=this.files[i];this.reader.setIndex(file.localHeaderOffset);this.checkSignature(sig.LOCAL_FILE_HEADER);file.readLocalPart(this.reader);file.handleUTF8()}},readCentralDir:function(){var file;this.reader.setIndex(this.centralDirOffset);while(this.reader.readString(4)===sig.CENTRAL_FILE_HEADER){file=new ZipEntry({zip64:this.zip64},this.loadOptions);file.readCentralPart(this.reader);this.files.push(file)}},readEndOfCentral:function(){var offset=this.reader.lastIndexOfSignature(sig.CENTRAL_DIRECTORY_END);if(offset===-1){throw new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(offset);this.checkSignature(sig.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===utils.MAX_VALUE_16BITS||this.diskWithCentralDirStart===utils.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===utils.MAX_VALUE_16BITS||this.centralDirRecords===utils.MAX_VALUE_16BITS||this.centralDirSize===utils.MAX_VALUE_32BITS||this.centralDirOffset===utils.MAX_VALUE_32BITS){this.zip64=true;offset=this.reader.lastIndexOfSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(offset===-1){throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator")}this.reader.setIndex(offset);this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}},prepareReader:function(data){var type=utils.getTypeOf(data);if(type==="string"&&!support.uint8array){this.reader=new StringReader(data,this.loadOptions.optimizedBinaryString)}else if(type==="nodebuffer"){this.reader=new NodeBufferReader(data)}else{this.reader=new Uint8ArrayReader(utils.transformTo("uint8array",data))}},load:function(data){this.prepareReader(data);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};module.exports=ZipEntries},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(_dereq_,module,exports){"use strict";var StringReader=_dereq_("./stringReader");var utils=_dereq_("./utils");var CompressedObject=_dereq_("./compressedObject");var jszipProto=_dereq_("./object");function ZipEntry(options,loadOptions){this.options=options;this.loadOptions=loadOptions}ZipEntry.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},prepareCompressedContent:function(reader,from,length){return function(){var previousIndex=reader.index;reader.setIndex(from);var compressedFileData=reader.readData(length);reader.setIndex(previousIndex);return compressedFileData}},prepareContent:function(reader,from,length,compression,uncompressedSize){return function(){var compressedFileData=utils.transformTo(compression.uncompressInputType,this.getCompressedContent());var uncompressedFileData=compression.uncompress(compressedFileData);if(uncompressedFileData.length!==uncompressedSize){throw new Error("Bug : uncompressed data size mismatch")}return uncompressedFileData}},readLocalPart:function(reader){var compression,localExtraFieldsLength;reader.skip(22);this.fileNameLength=reader.readInt(2);localExtraFieldsLength=reader.readInt(2);this.fileName=reader.readString(this.fileNameLength);reader.skip(localExtraFieldsLength);if(this.compressedSize==-1||this.uncompressedSize==-1){throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory "+"(compressedSize == -1 || uncompressedSize == -1)")}compression=utils.findCompression(this.compressionMethod);if(compression===null){throw new Error("Corrupted zip : compression "+utils.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")")}this.decompressed=new CompressedObject;this.decompressed.compressedSize=this.compressedSize;this.decompressed.uncompressedSize=this.uncompressedSize;this.decompressed.crc32=this.crc32;this.decompressed.compressionMethod=this.compressionMethod;this.decompressed.getCompressedContent=this.prepareCompressedContent(reader,reader.index,this.compressedSize,compression);this.decompressed.getContent=this.prepareContent(reader,reader.index,this.compressedSize,compression,this.uncompressedSize);if(this.loadOptions.checkCRC32){this.decompressed=utils.transformTo("string",this.decompressed.getContent());if(jszipProto.crc32(this.decompressed)!==this.crc32){throw new Error("Corrupted zip : CRC32 mismatch")}}},readCentralPart:function(reader){this.versionMadeBy=reader.readString(2);this.versionNeeded=reader.readInt(2);this.bitFlag=reader.readInt(2);this.compressionMethod=reader.readString(2);this.date=reader.readDate();this.crc32=reader.readInt(4);this.compressedSize=reader.readInt(4);this.uncompressedSize=reader.readInt(4);this.fileNameLength=reader.readInt(2);this.extraFieldsLength=reader.readInt(2);this.fileCommentLength=reader.readInt(2);this.diskNumberStart=reader.readInt(2);this.internalFileAttributes=reader.readInt(2);this.externalFileAttributes=reader.readInt(4);this.localHeaderOffset=reader.readInt(4);if(this.isEncrypted()){throw new Error("Encrypted zip are not supported")}this.fileName=reader.readString(this.fileNameLength);this.readExtraFields(reader);this.parseZIP64ExtraField(reader);this.fileComment=reader.readString(this.fileCommentLength);this.dir=this.externalFileAttributes&16?true:false},parseZIP64ExtraField:function(reader){if(!this.extraFields[1]){return}var extraReader=new StringReader(this.extraFields[1].value);if(this.uncompressedSize===utils.MAX_VALUE_32BITS){this.uncompressedSize=extraReader.readInt(8)}if(this.compressedSize===utils.MAX_VALUE_32BITS){this.compressedSize=extraReader.readInt(8)}if(this.localHeaderOffset===utils.MAX_VALUE_32BITS){this.localHeaderOffset=extraReader.readInt(8)}if(this.diskNumberStart===utils.MAX_VALUE_32BITS){this.diskNumberStart=extraReader.readInt(4)}},readExtraFields:function(reader){var start=reader.index,extraFieldId,extraFieldLength,extraFieldValue;this.extraFields=this.extraFields||{};while(reader.index<start+this.extraFieldsLength){extraFieldId=reader.readInt(2);extraFieldLength=reader.readInt(2);extraFieldValue=reader.readString(extraFieldLength);this.extraFields[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}}},handleUTF8:function(){if(this.useUTF8()){this.fileName=jszipProto.utf8decode(this.fileName);this.fileComment=jszipProto.utf8decode(this.fileComment)}else{var upath=this.findExtraFieldUnicodePath();if(upath!==null){this.fileName=upath}var ucomment=this.findExtraFieldUnicodeComment();if(ucomment!==null){this.fileComment=ucomment}}},findExtraFieldUnicodePath:function(){var upathField=this.extraFields[28789];if(upathField){var extraReader=new StringReader(upathField.value);if(extraReader.readInt(1)!==1){return null}if(jszipProto.crc32(this.fileName)!==extraReader.readInt(4)){return null}return jszipProto.utf8decode(extraReader.readString(upathField.length-5))}return null},findExtraFieldUnicodeComment:function(){var ucommentField=this.extraFields[25461];if(ucommentField){var extraReader=new StringReader(ucommentField.value);if(extraReader.readInt(1)!==1){return null}if(jszipProto.crc32(this.fileComment)!==extraReader.readInt(4)){return null}return jszipProto.utf8decode(extraReader.readString(ucommentField.length-5))}return null}};module.exports=ZipEntry},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(_dereq_,module,exports){"use strict";var assign=_dereq_("./lib/utils/common").assign;var deflate=_dereq_("./lib/deflate");var inflate=_dereq_("./lib/inflate");var constants=_dereq_("./lib/zlib/constants");var pako={};assign(pako,deflate,inflate,constants);module.exports=pako},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(_dereq_,module,exports){"use strict";var zlib_deflate=_dereq_("./zlib/deflate.js");var utils=_dereq_("./utils/common");var strings=_dereq_("./utils/strings");var msg=_dereq_("./zlib/messages");var zstream=_dereq_("./zlib/zstream");var Z_NO_FLUSH=0;var Z_FINISH=4;var Z_OK=0;var Z_STREAM_END=1;var Z_DEFAULT_COMPRESSION=-1;var Z_DEFAULT_STRATEGY=0;var Z_DEFLATED=8;var Deflate=function(options){this.options=utils.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>0){opt.windowBits=-opt.windowBits}else if(opt.gzip&&opt.windowBits>0&&opt.windowBits<16){opt.windowBits+=16}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var status=zlib_deflate.deflateInit2(this.strm,opt.level,opt.method,opt.windowBits,opt.memLevel,opt.strategy);if(status!==Z_OK){throw new Error(msg[status])}if(opt.header){zlib_deflate.deflateSetHeader(this.strm,opt.header)}};Deflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?Z_FINISH:Z_NO_FLUSH;if(typeof data==="string"){strm.input=strings.string2buf(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_deflate.deflate(strm,_mode);if(status!==Z_STREAM_END&&status!==Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.avail_out===0||strm.avail_in===0&&_mode===Z_FINISH){if(this.options.to==="string"){this.onData(strings.buf2binstring(utils.shrinkBuf(strm.output,strm.next_out)))}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}while((strm.avail_in>0||strm.avail_out===0)&&status!==Z_STREAM_END);if(_mode===Z_FINISH){status=zlib_deflate.deflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===Z_OK}return true};Deflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Deflate.prototype.onEnd=function(status){if(status===Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function deflate(input,options){var deflator=new Deflate(options);deflator.push(input,true);if(deflator.err){throw deflator.msg}return deflator.result}function deflateRaw(input,options){options=options||{};options.raw=true;return deflate(input,options)}function gzip(input,options){options=options||{};options.gzip=true;return deflate(input,options)}exports.Deflate=Deflate;exports.deflate=deflate;exports.deflateRaw=deflateRaw;exports.gzip=gzip},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(_dereq_,module,exports){"use strict";var zlib_inflate=_dereq_("./zlib/inflate.js");var utils=_dereq_("./utils/common");var strings=_dereq_("./utils/strings");var c=_dereq_("./zlib/constants");var msg=_dereq_("./zlib/messages");var zstream=_dereq_("./zlib/zstream");var gzheader=_dereq_("./zlib/gzheader");var Inflate=function(options){this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15}}if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)){opt.windowBits+=32}if(opt.windowBits>15&&opt.windowBits<48){if((opt.windowBits&15)===0){opt.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK){throw new Error(msg[status])}this.header=new gzheader;zlib_inflate.inflateGetHeader(this.strm,this.header)};Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;var next_out_utf8,tail,utf8str;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;if(typeof data==="string"){strm.input=strings.binstring2buf(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH);if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.next_out){if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&_mode===c.Z_FINISH){if(this.options.to==="string"){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail){utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0)}this.onData(utf8str)}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}}while(strm.avail_in>0&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END){_mode=c.Z_FINISH}if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK}return true};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){if(status===c.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);if(inflator.err){throw inflator.msg}return inflator.result}function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options)}exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(_dereq_,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(source.hasOwnProperty(p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],28:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./common");var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var i=0;i<256;i++){_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1}_utf8len[254]=_utf8len[254]=1;exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}buf=new utils.Buf8(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128){buf[i++]=c}else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};function buf2binstring(buf,len){if(len<65537){if(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK){return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len))}}var result="";for(var i=0;i<len;i++){result+=String.fromCharCode(buf[i])}return result}exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports.binstring2buf=function(str){var buf=new utils.Buf8(str.length);for(var i=0,len=buf.length;i<len;i++){buf[i]=str.charCodeAt(i)}return buf};exports.buf2string=function(buf,max){var i,out,c,c_len;var len=max||buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536){utf16buf[out++]=c}else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}return buf2binstring(utf16buf,out)};exports.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length}pos=max-1;while(pos>=0&&(buf[pos]&192)===128){pos--}if(pos<0){return max}if(pos===0){return max}return pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":27}],29:[function(_dereq_,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],30:[function(_dereq_,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(_dereq_,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc=crc^-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],32:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common");var trees=_dereq_("./trees");var adler32=_dereq_("./adler32");var crc32=_dereq_("./crc32");var msg=_dereq_("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out}if(len===0){return}utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0}}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255;s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size}if(len===0){return 0}strm.avail_in-=len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start)}else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start)}strm.next_in+=len;strm.total_in+=len;return len}function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2}if(nice_match>s.lookahead){nice_match=s.lookahead}do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue}scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break}scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len}return s.lookahead}function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(s.strm.avail_in===0){break}n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5}for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_NEED_MORE}function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}if(hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head)}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)){s.match_length=MIN_MATCH-1}}if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,false)}s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE}}else{s.match_available=1;s.strstart++;s.lookahead--}}if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead}}}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE}break}}s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}var Config=function(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func};var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR)}strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap}s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0:1;s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state)}return ret}function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR}if(strm.state.wrap!==2){return Z_STREAM_ERROR}strm.state.gzhead=head;return Z_OK}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR}var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6}if(windowBits<0){wrap=0;windowBits=-windowBits}else if(windowBits>15){wrap=2;windowBits-=16}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR)}if(windowBits===8){windowBits=9}var s=new DeflateState;strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<memLevel+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=s.lit_bufsize>>1;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR}s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH){return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR)}s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&255);put_byte(s,s.gzhead.time>>8&255);put_byte(s,s.gzhead.time>>16&255);put_byte(s,s.gzhead.time>>24&255);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&255);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&255);put_byte(s,s.gzhead.extra.length>>8&255)}if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)}s.gzindex=0;s.status=EXTRA_STATE}}else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0}else if(s.level<6){level_flags=1}else if(s.level===6){level_flags=2}else{level_flags=3}header|=level_flags<<6;if(s.strstart!==0){header|=PRESET_DICT}header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}strm.adler=1}}if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&65535)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break}}put_byte(s,s.gzhead.extra[s.gzindex]&255);s.gzindex++}if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}else{s.status=NAME_STATE}}if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}else{s.status=COMMENT_STATE}}if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.status=HCRC_STATE}}else{s.status=HCRC_STATE}}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm)}if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);strm.adler=0;s.status=BUSY_STATE}}else{s.status=BUSY_STATE}}if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR)}if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR)}if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE}if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1}return Z_OK}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s)}else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}if(flush!==Z_FINISH){return Z_OK}if(s.wrap<=0){return Z_STREAM_END}if(s.wrap===2){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);put_byte(s,strm.adler>>16&255);put_byte(s,strm.adler>>24&255);put_byte(s,strm.total_in&255);put_byte(s,strm.total_in>>8&255);put_byte(s,strm.total_in>>16&255);put_byte(s,strm.total_in>>24&255)}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap}return s.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(strm){var status;if(!strm||!strm.state){return Z_STREAM_ERROR}status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR)}strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(_dereq_,module,exports){"use strict";function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}module.exports=GZheader},{}],34:[function(_dereq_,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],35:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common");var adler32=_dereq_("./adler32");var crc32=_dereq_("./crc32");var inflate_fast=_dereq_("./inffast");var inflate_table=_dereq_("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function ZSWAP32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=ZSWAP32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave};case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD;}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave};case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave};case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:ZSWAP32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:;default:return Z_STREAM_ERROR;}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}var i=0;for(;;){i++;here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":27}],37:[function(_dereq_,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common");var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);var StaticTreeDesc=function(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length};var static_l_desc;var static_d_desc;var static_bl_desc;var TreeDesc=function(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc};function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255;s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&65535;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size}else{s.bi_buf|=value<<s.bi_valid&65535;s.bi_valid+=length}}function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&255;s.bi_buf>>=8;s.bi_valid-=8}}function gen_bitlen(s,desc){var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0}tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}tree[n*2+1]=bits;if(n>max_code){continue}s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base]}f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits)}}if(overflow===0){return}do{bits=max_length-1;while(s.bl_count[bits]===0){bits--}s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue}if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}n--}}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=code+bl_count[bits-1]<<1}for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue}tree[n*2]=bi_reverse(next_code[len]++,len)}}function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++){_length_code[length++]=code}}_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++){_dist_code[dist++]=code}}dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++){_dist_code[256+dist++]=code}}for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0}n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5)}static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]=0}for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]=0}for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]=0}s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}function bi_windup(s){if(s.bi_valid>8){put_short(s,s.bi_buf)}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf}s.bi_buf=0;s.bi_valid=0}function copy_block(s,buf,len,header){bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++}if(smaller(tree,v,s.heap[j],s.depth)){break}s.heap[k]=s.heap[j];k=j;j<<=1}s.heap[k]=v}function compress_block(s,ltree,dtree){var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree)}else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit)}send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else{tree[n*2+1]=0}}while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]}}desc.max_code=max_code;for(n=s.heap_len>>1;n>=1;n--){pqdownheap(s,tree,n)}node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}tree[(max_code+1)*2+1]=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){s.bl_tree[curlen*2]+=count}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++}s.bl_tree[REP_3_6*2]++}else if(count<=10){s.bl_tree[REPZ_3_10*2]++}else{s.bl_tree[REPZ_11_138*2]++}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function send_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){do{send_code(s,curlen,s.bl_tree)}while(--count!==0)}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break}}s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3)}send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447;var n;for(n=0;n<=31;n++,black_mask>>>=1){if(black_mask&1&&s.dyn_ltree[n*2]!==0){return Z_BINARY}}if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT}for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT}}return Z_BINARY}var static_init_done=false;function _tr_init(s){if(!static_init_done){tr_static_init();static_init_done=true}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s)}build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb}}else{opt_lenb=static_lenb=stored_len+5}if(stored_len+4<=opt_lenb&&buf!==-1){_tr_stored_block(s,buf,stored_len,last)}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}init_block(s);if(last){bi_windup(s)}}function _tr_tally(s,dist,lc){s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255;s.pending_buf[s.l_buf+s.last_lit]=lc&255;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;s.dyn_dtree[d_code(dist)*2]++}return s.last_lit===s.lit_bufsize-1}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":27}],39:[function(_dereq_,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}]},{},[9])(9)});var XLSX={};(function make_xlsx(XLSX){XLSX.version="0.10.8";var current_codepage=1200;if(typeof module!=="undefined"&&typeof require!=="undefined"){if(typeof cptable==="undefined")global.cptable=require("./dist/cpexcel.js")}function reset_cp(){set_cp(1200)}var set_cp=function(cp){current_codepage=cp};function char_codes(data){var o=[];for(var i=0,len=data.length;i<len;++i)o[i]=data.charCodeAt(i);return o}function utf16leread(data){var o=[];for(var i=0;i<data.length>>1;++i)o[i]=String.fromCharCode(data.charCodeAt(2*i)+(data.charCodeAt(2*i+1)<<8));return o.join("")}function utf16beread(data){var o=[];for(var i=0;i<data.length>>1;++i)o[i]=String.fromCharCode(data.charCodeAt(2*i+1)+(data.charCodeAt(2*i)<<8));return o.join("")}var debom=function(data){var c1=data.charCodeAt(0),c2=data.charCodeAt(1);if(c1==255&&c2==254)return utf16leread(data.substr(2));if(c1==254&&c2==255)return utf16beread(data.substr(2));if(c1==65279)return data.substr(1);return data};var _getchar=function _gc1(x){return String.fromCharCode(x)};if(typeof cptable!=="undefined"){set_cp=function(cp){current_codepage=cp};debom=function(data){if(data.charCodeAt(0)===255&&data.charCodeAt(1)===254){return cptable.utils.decode(1200,char_codes(data.substr(2)))}return data};_getchar=function _gc2(x){if(current_codepage===1200)return String.fromCharCode(x);return cptable.utils.decode(current_codepage,[x&255,x>>8])[0]}}var DENSE=null;var DIF_XL=true;var Base64=function make_b64(){var map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(input){var o="";var c1,c2,c3,e1,e2,e3,e4;for(var i=0;i<input.length;){c1=input.charCodeAt(i++);c2=input.charCodeAt(i++);c3=input.charCodeAt(i++);e1=c1>>2;e2=(c1&3)<<4|c2>>4;e3=(c2&15)<<2|c3>>6;e4=c3&63;if(isNaN(c2)){e3=e4=64}else if(isNaN(c3)){e4=64}o+=map.charAt(e1)+map.charAt(e2)+map.charAt(e3)+map.charAt(e4)}return o},decode:function b64_decode(input){var o="";var c1,c2,c3;var e1,e2,e3,e4;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var i=0;i<input.length;){e1=map.indexOf(input.charAt(i++));e2=map.indexOf(input.charAt(i++));e3=map.indexOf(input.charAt(i++));e4=map.indexOf(input.charAt(i++));c1=e1<<2|e2>>4;c2=(e2&15)<<4|e3>>2;c3=(e3&3)<<6|e4;o+=String.fromCharCode(c1);if(e3!=64){o+=String.fromCharCode(c2)}if(e4!=64){o+=String.fromCharCode(c3)}}return o}}}();var has_buf=typeof Buffer!=="undefined"&&typeof process!=="undefined"&&typeof process.versions!=="undefined"&&process.versions.node;function new_raw_buf(len){return new(has_buf?Buffer:Array)(len)}function s2a(s){if(has_buf)return new Buffer(s,"binary");return s.split("").map(function(x){return x.charCodeAt(0)&255})}var bconcat=function(bufs){return[].concat.apply([],bufs)};var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/;var SSF={};var make_ssf=function make_ssf(SSF){SSF.version="0.9.4";function _strrev(x){var o="",i=x.length-1;while(i>=0)o+=x.charAt(i--);return o}function fill(c,l){var o="";while(o.length<l)o+=c;return o}function pad0(v,d){var t=""+v;return t.length>=d?t:fill("0",d-t.length)+t}function pad_(v,d){var t=""+v;return t.length>=d?t:fill(" ",d-t.length)+t}function rpad_(v,d){var t=""+v;return t.length>=d?t:t+fill(" ",d-t.length)}function pad0r1(v,d){var t=""+Math.round(v);return t.length>=d?t:fill("0",d-t.length)+t}function pad0r2(v,d){var t=""+v;return t.length>=d?t:fill("0",d-t.length)+t}var p2_32=Math.pow(2,32);function pad0r(v,d){if(v>p2_32||v<-p2_32)return pad0r1(v,d);var i=Math.round(v);return pad0r2(i,d)}function isgeneral(s,i){i=i||0;return s.length>=7+i&&(s.charCodeAt(i)|32)===103&&(s.charCodeAt(i+1)|32)===101&&(s.charCodeAt(i+2)|32)===110&&(s.charCodeAt(i+3)|32)===101&&(s.charCodeAt(i+4)|32)===114&&(s.charCodeAt(i+5)|32)===97&&(s.charCodeAt(i+6)|32)===108}var opts_fmt=[["date1904",0],["output",""],["WTF",false]];function fixopts(o){for(var y=0;y!=opts_fmt.length;++y)if(o[opts_fmt[y][0]]===undefined)o[opts_fmt[y][0]]=opts_fmt[y][1]}SSF.opts=opts_fmt;var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]];var months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function init_table(t){t[0]="General";t[1]="0";t[2]="0.00";t[3]="#,##0";t[4]="#,##0.00";t[9]="0%";t[10]="0.00%";t[11]="0.00E+00";t[12]="# ?/?";t[13]="# ??/??";t[14]="m/d/yy";t[15]="d-mmm-yy";t[16]="d-mmm";t[17]="mmm-yy";t[18]="h:mm AM/PM";t[19]="h:mm:ss AM/PM";t[20]="h:mm";t[21]="h:mm:ss";t[22]="m/d/yy h:mm";t[37]="#,##0 ;(#,##0)";t[38]="#,##0 ;[Red](#,##0)";t[39]="#,##0.00;(#,##0.00)";t[40]="#,##0.00;[Red](#,##0.00)";t[45]="mm:ss";t[46]="[h]:mm:ss";t[47]="mmss.0";t[48]="##0.0E+0";t[49]="@";t[56]='"上午/下午 "hh"時"mm"分"ss"秒 "';t[65535]="General"}var table_fmt={};init_table(table_fmt);function frac(x,D,mixed){var sgn=x<0?-1:1;var B=x*sgn;var P_2=0,P_1=1,P=0;var Q_2=1,Q_1=0,Q=0;var A=Math.floor(B);while(Q_1<D){A=Math.floor(B);P=A*P_1+P_2;Q=A*Q_1+Q_2;if(B-A<5e-8)break;B=1/(B-A);P_2=P_1;P_1=P;Q_2=Q_1;Q_1=Q}if(Q>D){if(Q_1>D){Q=Q_2;P=P_2}else{Q=Q_1;P=P_1}}if(!mixed)return[0,sgn*P,Q];var q=Math.floor(sgn*P/Q);return[q,sgn*P-q*Q,Q]}function general_fmt_int(v){return""+v}SSF._general_int=general_fmt_int;var general_fmt_num=function make_general_fmt_num(){var gnr1=/\.(\d*[1-9])0+$/,gnr2=/\.0*$/,gnr4=/\.(\d*[1-9])0+/,gnr5=/\.0*[Ee]/,gnr6=/(E[+-])(\d)$/;function gfn2(v){var w=v<0?12:11;var o=gfn5(v.toFixed(12));if(o.length<=w)return o;o=v.toPrecision(10);if(o.length<=w)return o;return v.toExponential(5)}function gfn3(v){var o=v.toFixed(11).replace(gnr1,".$1");if(o.length>(v<0?12:11))o=v.toPrecision(6);return o}function gfn4(o){for(var i=0;i!=o.length;++i)if((o.charCodeAt(i)|32)===101)return o.replace(gnr4,".$1").replace(gnr5,"E").replace("e","E").replace(gnr6,"$10$2");return o}function gfn5(o){return o.indexOf(".")>-1?o.replace(gnr2,"").replace(gnr1,".$1"):o}return function general_fmt_num(v){var V=Math.floor(Math.log(Math.abs(v))*Math.LOG10E),o;if(V>=-4&&V<=-1)o=v.toPrecision(10+V);else if(Math.abs(V)<=9)o=gfn2(v);else if(V===10)o=v.toFixed(10).substr(0,12);else o=gfn3(v);return gfn5(gfn4(o))}}();SSF._general_num=general_fmt_num;function general_fmt(v){switch(typeof v){case"string":return v;case"boolean":return v?"TRUE":"FALSE";case"number":return(v|0)===v?general_fmt_int(v):general_fmt_num(v);case"undefined":return"";case"object":if(v==null)return"";}throw new Error("unsupported value in General format: "+v)}SSF._general=general_fmt;function fix_hijri(){return 0}function parse_date_code(v,opts,b2){if(v>2958465||v<0)return null;var date=v|0,time=Math.floor(86400*(v-date)),dow=0;var dout=[];var out={D:date,T:time,u:86400*(v-date)-time,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(out.u)<1e-6)out.u=0;fixopts(opts!=null?opts:opts=[]);if(opts.date1904)date+=1462;if(out.u>.9999){out.u=0;if(++time==86400){out.T=time=0;++date;++out.D}}if(date===60){dout=b2?[1317,10,29]:[1900,2,29];dow=3}else if(date===0){dout=b2?[1317,8,29]:[1900,1,0];dow=6}else{if(date>60)--date;var d=new Date(1900,0,1);d.setDate(d.getDate()+date-1);dout=[d.getFullYear(),d.getMonth()+1,d.getDate()];dow=d.getDay();if(date<60)dow=(dow+6)%7;if(b2)dow=fix_hijri(d,dout)}out.y=dout[0];out.m=dout[1];out.d=dout[2];out.S=time%60;time=Math.floor(time/60);out.M=time%60;time=Math.floor(time/60);out.H=time;out.q=dow;return out}SSF.parse_date_code=parse_date_code;function write_date(type,fmt,val,ss0){var o="",ss=0,tt=0,y=val.y,out,outl=0;switch(type){case 98:y=val.y+543;case 121:switch(fmt.length){case 1:;case 2:out=y%100;outl=2;break;default:out=y%1e4;outl=4;break;}break;case 109:switch(fmt.length){case 1:;case 2:out=val.m;outl=fmt.length;break;case 3:return months[val.m-1][1];case 5:return months[val.m-1][0];default:return months[val.m-1][2];}break;case 100:switch(fmt.length){case 1:;case 2:out=val.d;outl=fmt.length;break;case 3:return days[val.q][0];default:return days[val.q][1];}break;case 104:switch(fmt.length){case 1:;case 2:out=1+(val.H+11)%12;outl=fmt.length;break;default:throw"bad hour format: "+fmt;}break;case 72:switch(fmt.length){case 1:;case 2:out=val.H;outl=fmt.length;break;default:throw"bad hour format: "+fmt;}break;case 77:switch(fmt.length){case 1:;case 2:out=val.M;outl=fmt.length;break;default:throw"bad minute format: "+fmt;}break;case 115:if(val.u===0)switch(fmt){case"s":;case"ss":return pad0(val.S,fmt.length);case".0":;case".00":;case".000":;}switch(fmt){case"s":;case"ss":;case".0":;case".00":;case".000":if(ss0>=2)tt=ss0===3?1e3:100;else tt=ss0===1?10:1;ss=Math.round(tt*(val.S+val.u));if(ss>=60*tt)ss=0;if(fmt==="s")return ss===0?"0":""+ss/tt;o=pad0(ss,2+ss0);if(fmt==="ss")return o.substr(0,2);return"."+o.substr(2,fmt.length-1);default:throw"bad second format: "+fmt;};case 90:switch(fmt){case"[h]":;case"[hh]":out=val.D*24+val.H;break;case"[m]":;case"[mm]":out=(val.D*24+val.H)*60+val.M;break;case"[s]":;case"[ss]":out=((val.D*24+val.H)*60+val.M)*60+Math.round(val.S+val.u);break;default:throw"bad abstime format: "+fmt;}outl=fmt.length===3?1:2;break;case 101:out=y;outl=1;}if(outl>0)return pad0(out,outl);else return""}function commaify(s){if(s.length<=3)return s;var j=s.length%3,o=s.substr(0,j);for(;j!=s.length;j+=3)o+=(o.length>0?",":"")+s.substr(j,3);return o}var write_num=function make_write_num(){var pct1=/%/g;function write_num_pct(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul)}function write_num_cm(type,fmt,val){var idx=fmt.length-1;while(fmt.charCodeAt(idx-1)===44)--idx;return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)))}function write_num_exp(fmt,val){var o;var idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){if(val==0)return"0.0E+0";else if(val<0)return"-"+write_num_exp(fmt,-val);var period=fmt.indexOf(".");if(period===-1)period=fmt.indexOf("E");var ee=Math.floor(Math.log(val)*Math.LOG10E)%period;if(ee<0)ee+=period;o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period);if(o.indexOf("e")===-1){var fakee=Math.floor(Math.log(val)*Math.LOG10E);if(o.indexOf(".")===-1)o=o.charAt(0)+"."+o.substr(1)+"E+"+(fakee-o.length+ee);else o+="E+"+(fakee-ee);while(o.substr(0,2)==="0."){o=o.charAt(0)+o.substr(2,period)+"."+o.substr(2+period);o=o.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.")}o=o.replace(/\+-/,"-")}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E"})}else o=val.toExponential(idx);if(fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/))o=o.substr(0,o.length-1)+"0"+o.charAt(o.length-1);if(fmt.match(/E\-/)&&o.match(/e\+/))o=o.replace(/e\+/,"e");return o.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(r,aval,sign){var den=parseInt(r[4],10),rr=Math.round(aval*den),base=Math.floor(rr/den);var myn=rr-base*den,myd=den;return sign+(base===0?"":""+base)+" "+(myn===0?fill(" ",r[1].length+1+r[4].length):pad_(myn,r[1].length)+r[2]+"/"+r[3]+pad0(myd,r[4].length))}function write_num_f2(r,aval,sign){return sign+(aval===0?"":""+aval)+fill(" ",r[1].length+2+r[4].length)}var dec1=/^#*0*\.([0#]+)/;var closeparen=/\).*[0#]/;var phone=/\(###\) ###\\?-####/;function hashq(str){var o="",cc;for(var i=0;i!=str.length;++i)switch(cc=str.charCodeAt(i)){case 35:break;case 63:o+=" ";break;case 48:o+="0";break;default:o+=String.fromCharCode(cc);}return o}function rnd(val,d){var dd=Math.pow(10,d);return""+Math.round(val*dd)/dd}function dec(val,d){if(d<(""+Math.round((val-Math.floor(val))*Math.pow(10,d))).length){return 0}return Math.round((val-Math.floor(val))*Math.pow(10,d))}function carry(val,d){if(d<(""+Math.round((val-Math.floor(val))*Math.pow(10,d))).length){return 1}return 0}function flr(val){if(val<2147483647&&val>-2147483648)return""+(val>=0?val|0:val-1|0);return""+Math.floor(val)}function write_num_flt(type,fmt,val){if(type.charCodeAt(0)===40&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");if(val>=0)return write_num_flt("n",ffmt,val);return"("+write_num_flt("n",ffmt,-val)+")"}if(fmt.charCodeAt(fmt.length-1)===44)return write_num_cm(type,fmt,val);if(fmt.indexOf("%")!==-1)return write_num_pct(type,fmt,val);if(fmt.indexOf("E")!==-1)return write_num_exp(fmt,val);if(fmt.charCodeAt(0)===36)return"$"+write_num_flt(type,fmt.substr(fmt.charAt(1)==" "?2:1),val);var o;var r,ri,ff,aval=Math.abs(val),sign=val<0?"-":"";if(fmt.match(/^00+$/))return sign+pad0r(aval,fmt.length);if(fmt.match(/^[#?]+$/)){o=pad0r(val,0);if(o==="0")o="";return o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o}if(r=fmt.match(frac1))return write_num_f1(r,aval,sign);if(fmt.match(/^#+0+$/))return sign+pad0r(aval,fmt.length-fmt.indexOf("0"));if(r=fmt.match(dec1)){o=rnd(val,r[1].length).replace(/^([^\.]+)$/,"$1."+hashq(r[1])).replace(/\.$/,"."+hashq(r[1])).replace(/\.(\d*)$/,function($$,$1){return"."+$1+fill("0",hashq(r[1]).length-$1.length)});return fmt.indexOf("0.")!==-1?o:o.replace(/^0\./,".")}fmt=fmt.replace(/^#+([0.])/,"$1");if(r=fmt.match(/^(0*)\.(#*)$/)){return sign+rnd(aval,r[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".")}if(r=fmt.match(/^#{1,3},##0(\.?)$/))return sign+commaify(pad0r(aval,0));if(r=fmt.match(/^#,##0\.([#0]*0)$/)){return val<0?"-"+write_num_flt(type,fmt,-val):commaify(""+(Math.floor(val)+carry(val,r[1].length)))+"."+pad0(dec(val,r[1].length),r[1].length)}if(r=fmt.match(/^#,#*,#0/))return write_num_flt(type,fmt.replace(/^#,#*,/,""),val);if(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/)){o=_strrev(write_num_flt(type,fmt.replace(/[\\-]/g,""),val));ri=0;return _strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x){return ri<o.length?o.charAt(ri++):x==="0"?"0":""}))}if(fmt.match(phone)){o=write_num_flt(type,"##########",val);return"("+o.substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6)}var oa="";if(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(r[4].length,7);ff=frac(aval,Math.pow(10,ri)-1,false);o=""+sign;oa=write_num("n",r[1],ff[1]);if(oa.charAt(oa.length-1)==" ")oa=oa.substr(0,oa.length-1)+"0";o+=oa+r[2]+"/"+r[3];oa=rpad_(ff[2],ri);if(oa.length<r[4].length)oa=hashq(r[4].substr(r[4].length-oa.length))+oa;o+=oa;return o}if(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(Math.max(r[1].length,r[4].length),7);ff=frac(aval,Math.pow(10,ri)-1,true);return sign+(ff[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length))}if(r=fmt.match(/^[#0?]+$/)){o=pad0r(val,0);if(fmt.length<=o.length)return o;return hashq(fmt.substr(0,fmt.length-o.length))+o}if(r=fmt.match(/^([#0?]+)\.([#0]+)$/)){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1");ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres))}if(r=fmt.match(/^00,000\.([#0]*0)$/)){ri=dec(val,r[1].length);return val<0?"-"+write_num_flt(type,fmt,-val):commaify(flr(val)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$){return"00,"+($$.length<3?pad0(0,3-$$.length):"")+$$})+"."+pad0(ri,r[1].length)}switch(fmt){case"###,##0.00":return write_num_flt(type,"#,##0.00",val);case"###,###":;case"##,###":;case"#,###":var x=commaify(pad0r(aval,0));return x!=="0"?sign+x:"";case"###,###.00":return write_num_flt(type,"###,##0.00",val).replace(/^0\./,".");case"#,###.00":return write_num_flt(type,"#,##0.00",val).replace(/^0\./,".");default:;}throw new Error("unsupported format |"+fmt+"|")}function write_num_cm2(type,fmt,val){var idx=fmt.length-1;while(fmt.charCodeAt(idx-1)===44)--idx;return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)))}function write_num_pct2(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul)}function write_num_exp2(fmt,val){var o;var idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){if(val==0)return"0.0E+0";else if(val<0)return"-"+write_num_exp2(fmt,-val);var period=fmt.indexOf(".");if(period===-1)period=fmt.indexOf("E");var ee=Math.floor(Math.log(val)*Math.LOG10E)%period;if(ee<0)ee+=period;o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period);if(!o.match(/[Ee]/)){var fakee=Math.floor(Math.log(val)*Math.LOG10E);if(o.indexOf(".")===-1)o=o.charAt(0)+"."+o.substr(1)+"E+"+(fakee-o.length+ee);else o+="E+"+(fakee-ee);o=o.replace(/\+-/,"-")}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E"})}else o=val.toExponential(idx);if(fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/))o=o.substr(0,o.length-1)+"0"+o.charAt(o.length-1);if(fmt.match(/E\-/)&&o.match(/e\+/))o=o.replace(/e\+/,"e");return o.replace("e","E")}function write_num_int(type,fmt,val){if(type.charCodeAt(0)===40&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");if(val>=0)return write_num_int("n",ffmt,val);return"("+write_num_int("n",ffmt,-val)+")"}if(fmt.charCodeAt(fmt.length-1)===44)return write_num_cm2(type,fmt,val);if(fmt.indexOf("%")!==-1)return write_num_pct2(type,fmt,val);if(fmt.indexOf("E")!==-1)return write_num_exp2(fmt,val);if(fmt.charCodeAt(0)===36)return"$"+write_num_int(type,fmt.substr(fmt.charAt(1)==" "?2:1),val);var o;var r,ri,ff,aval=Math.abs(val),sign=val<0?"-":"";if(fmt.match(/^00+$/))return sign+pad0(aval,fmt.length);if(fmt.match(/^[#?]+$/)){o=""+val;if(val===0)o="";return o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o}if(r=fmt.match(frac1))return write_num_f2(r,aval,sign);if(fmt.match(/^#+0+$/))return sign+pad0(aval,fmt.length-fmt.indexOf("0"));if(r=fmt.match(dec1)){o=(""+val).replace(/^([^\.]+)$/,"$1."+hashq(r[1])).replace(/\.$/,"."+hashq(r[1]));o=o.replace(/\.(\d*)$/,function($$,$1){return"."+$1+fill("0",hashq(r[1]).length-$1.length)});return fmt.indexOf("0.")!==-1?o:o.replace(/^0\./,".")}fmt=fmt.replace(/^#+([0.])/,"$1");if(r=fmt.match(/^(0*)\.(#*)$/)){return sign+(""+aval).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".")}if(r=fmt.match(/^#{1,3},##0(\.?)$/))return sign+commaify(""+aval);if(r=fmt.match(/^#,##0\.([#0]*0)$/)){return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val)+"."+fill("0",r[1].length)}if(r=fmt.match(/^#,#*,#0/))return write_num_int(type,fmt.replace(/^#,#*,/,""),val);if(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/)){o=_strrev(write_num_int(type,fmt.replace(/[\\-]/g,""),val));ri=0;return _strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x){return ri<o.length?o.charAt(ri++):x==="0"?"0":""}))}if(fmt.match(phone)){o=write_num_int(type,"##########",val);return"("+o.substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6)}var oa="";if(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(r[4].length,7);ff=frac(aval,Math.pow(10,ri)-1,false);o=""+sign;oa=write_num("n",r[1],ff[1]);if(oa.charAt(oa.length-1)==" ")oa=oa.substr(0,oa.length-1)+"0";o+=oa+r[2]+"/"+r[3];oa=rpad_(ff[2],ri);if(oa.length<r[4].length)oa=hashq(r[4].substr(r[4].length-oa.length))+oa;o+=oa;return o}if(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(Math.max(r[1].length,r[4].length),7);ff=frac(aval,Math.pow(10,ri)-1,true);return sign+(ff[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length))}if(r=fmt.match(/^[#0?]+$/)){o=""+val;if(fmt.length<=o.length)return o;return hashq(fmt.substr(0,fmt.length-o.length))+o}if(r=fmt.match(/^([#0]+)\.([#0]+)$/)){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1");ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres))}if(r=fmt.match(/^00,000\.([#0]*0)$/)){return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$){return"00,"+($$.length<3?pad0(0,3-$$.length):"")+$$})+"."+pad0(0,r[1].length)}switch(fmt){case"###,###":;case"##,###":;case"#,###":var x=commaify(""+aval);return x!=="0"?sign+x:"";default:if(fmt.match(/\.[0#?]*$/))return write_num_int(type,fmt.slice(0,fmt.lastIndexOf(".")),val)+hashq(fmt.slice(fmt.lastIndexOf(".")));}throw new Error("unsupported format |"+fmt+"|")}return function write_num(type,fmt,val){return(val|0)===val?write_num_int(type,fmt,val):write_num_flt(type,fmt,val)}}();function split_fmt(fmt){var out=[];var in_str=false;for(var i=0,j=0;i<fmt.length;++i)switch(fmt.charCodeAt(i)){case 34:in_str=!in_str;break;case 95:;case 42:;case 92:++i;break;case 59:out[out.length]=fmt.substr(j,i-j);j=i+1;}out[out.length]=fmt.substr(j);if(in_str===true)throw new Error("Format |"+fmt+"| unterminated string ");return out}SSF._split=split_fmt;var abstime=/\[[HhMmSs]*\]/;function fmt_is_date(fmt){var i=0,c="",o="";while(i<fmt.length){switch(c=fmt.charAt(i)){case"G":if(isgeneral(fmt,i))i+=6;i++;break;case'"':for(;fmt.charCodeAt(++i)!==34&&i<fmt.length;)++i;++i;break;case"\\":i+=2;break;case"_":i+=2;break;case"@":++i;break;case"B":;case"b":if(fmt.charAt(i+1)==="1"||fmt.charAt(i+1)==="2")return true;case"M":;case"D":;case"Y":;case"H":;case"S":;case"E":;case"m":;case"d":;case"y":;case"h":;case"s":;case"e":;case"g":return true;case"A":;case"a":if(fmt.substr(i,3).toUpperCase()==="A/P")return true;if(fmt.substr(i,5).toUpperCase()==="AM/PM")return true;++i;break;case"[":o=c;while(fmt.charAt(i++)!=="]"&&i<fmt.length)o+=fmt.charAt(i);if(o.match(abstime))return true;break;case".":;case"0":;case"#":while(i<fmt.length&&("0#?.,E+-%".indexOf(c=fmt.charAt(++i))>-1||c=="\\"&&fmt.charAt(i+1)=="-"&&"0#".indexOf(fmt.charAt(i+2))>-1)){}break;case"?":while(fmt.charAt(++i)===c){}break;case"*":++i;if(fmt.charAt(i)==" "||fmt.charAt(i)=="*")++i;break;case"(":;case")":++i;break;case"1":;case"2":;case"3":;case"4":;case"5":;case"6":;case"7":;case"8":;case"9":while(i<fmt.length&&"0123456789".indexOf(fmt.charAt(++i))>-1){}break;case" ":++i;break;default:++i;break;}}return false}SSF.is_date=fmt_is_date;function eval_fmt(fmt,v,opts,flen){var out=[],o="",i=0,c="",lst="t",q,dt,j,cc;var hr="H";while(i<fmt.length){switch(c=fmt.charAt(i)){case"G":if(!isgeneral(fmt,i))throw new Error("unrecognized character "+c+" in "+fmt);out[out.length]={t:"G",v:"General"};i+=7;break;case'"':for(o="";(cc=fmt.charCodeAt(++i))!==34&&i<fmt.length;)o+=String.fromCharCode(cc);out[out.length]={t:"t",v:o};++i;break;case"\\":var w=fmt.charAt(++i),t=w==="("||w===")"?w:"t";out[out.length]={t:t,v:w};++i;break;case"_":out[out.length]={t:"t",v:" "};i+=2;break;case"@":out[out.length]={t:"T",v:v};++i;break;case"B":;case"b":if(fmt.charAt(i+1)==="1"||fmt.charAt(i+1)==="2"){if(dt==null){dt=parse_date_code(v,opts,fmt.charAt(i+1)==="2");if(dt==null)return""}out[out.length]={t:"X",v:fmt.substr(i,2)};lst=c;i+=2;break};case"M":;case"D":;case"Y":;case"H":;case"S":;case"E":c=c.toLowerCase();case"m":;case"d":;case"y":;case"h":;case"s":;case"e":;case"g":if(v<0)return"";if(dt==null){dt=parse_date_code(v,opts);if(dt==null)return""}o=c;while(++i<fmt.length&&fmt.charAt(i).toLowerCase()===c)o+=c;if(c==="m"&&lst.toLowerCase()==="h")c="M";if(c==="h")c=hr;out[out.length]={t:c,v:o};lst=c;break;case"A":;case"a":q={t:c,v:c};if(dt==null)dt=parse_date_code(v,opts);if(fmt.substr(i,3).toUpperCase()==="A/P"){if(dt!=null)q.v=dt.H>=12?"P":"A";q.t="T";hr="h";i+=3}else if(fmt.substr(i,5).toUpperCase()==="AM/PM"){if(dt!=null)q.v=dt.H>=12?"PM":"AM";q.t="T";i+=5;hr="h"}else{q.t="t";++i}if(dt==null&&q.t==="T")return"";out[out.length]=q;lst=c;break;case"[":o=c;while(fmt.charAt(i++)!=="]"&&i<fmt.length)o+=fmt.charAt(i);if(o.slice(-1)!=="]")throw'unterminated "[" block: |'+o+"|";if(o.match(abstime)){if(dt==null){dt=parse_date_code(v,opts);if(dt==null)return""}out[out.length]={t:"Z",v:o.toLowerCase()};lst=o.charAt(1)}else if(o.indexOf("$")>-1){o=(o.match(/\$([^-\[\]]*)/)||[])[1]||"$";if(!fmt_is_date(fmt))out[out.length]={t:"t",v:o}}break;case".":if(dt!=null){o=c;while((c=fmt.charAt(++i))==="0")o+=c;out[out.length]={t:"s",v:o};break};case"0":;case"#":o=c;while(++i<fmt.length&&"0#?.,E+-%".indexOf(c=fmt.charAt(i))>-1||c=="\\"&&fmt.charAt(i+1)=="-"&&i<fmt.length-2&&"0#".indexOf(fmt.charAt(i+2))>-1)o+=c;out[out.length]={t:"n",v:o};break;case"?":o=c;while(fmt.charAt(++i)===c)o+=c;q={t:c,v:o};out[out.length]=q;lst=c;break;case"*":++i;if(fmt.charAt(i)==" "||fmt.charAt(i)=="*")++i;break;case"(":;case")":out[out.length]={t:flen===1?"t":c,v:c};++i;break;case"1":;case"2":;case"3":;case"4":;case"5":;case"6":;case"7":;case"8":;case"9":o=c;while(i<fmt.length&&"0123456789".indexOf(fmt.charAt(++i))>-1)o+=fmt.charAt(i);out[out.length]={t:"D",v:o};break;case" ":out[out.length]={t:c,v:c};++i;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(c)===-1)throw new Error("unrecognized character "+c+" in "+fmt);out[out.length]={t:"t",v:c};++i;break;}}var bt=0,ss0=0,ssm;for(i=out.length-1,lst="t";i>=0;--i){switch(out[i].t){case"h":;case"H":out[i].t=hr;lst="h";if(bt<1)bt=1;break;case"s":if(ssm=out[i].v.match(/\.0+$/))ss0=Math.max(ss0,ssm[0].length-1);if(bt<3)bt=3;case"d":;case"y":;case"M":;case"e":lst=out[i].t;break;case"m":if(lst==="s"){out[i].t="M";if(bt<2)bt=2}break;case"X":break;case"Z":if(bt<1&&out[i].v.match(/[Hh]/))bt=1;if(bt<2&&out[i].v.match(/[Mm]/))bt=2;if(bt<3&&out[i].v.match(/[Ss]/))bt=3;}}switch(bt){case 0:break;case 1:if(dt.u>=.5){dt.u=0;++dt.S}if(dt.S>=60){dt.S=0;++dt.M}if(dt.M>=60){dt.M=0;++dt.H}break;case 2:if(dt.u>=.5){dt.u=0;++dt.S}if(dt.S>=60){dt.S=0;++dt.M}break;}var nstr="",jj;for(i=0;i<out.length;++i){switch(out[i].t){case"t":;case"T":;case" ":;case"D":break;case"X":out[i].v="";out[i].t=";";break;case"d":;case"m":;case"y":;case"h":;case"H":;case"M":;case"s":;case"e":;case"b":;case"Z":out[i].v=write_date(out[i].t.charCodeAt(0),out[i].v,dt,ss0);out[i].t="t";break;case"n":;case"(":;case"?":jj=i+1;while(out[jj]!=null&&((c=out[jj].t)==="?"||c==="D"||(c===" "||c==="t")&&out[jj+1]!=null&&(out[jj+1].t==="?"||out[jj+1].t==="t"&&out[jj+1].v==="/")||out[i].t==="("&&(c===" "||c==="n"||c===")")||c==="t"&&(out[jj].v==="/"||out[jj].v===" "&&out[jj+1]!=null&&out[jj+1].t=="?"))){out[i].v+=out[jj].v;out[jj]={v:"",t:";"};++jj}nstr+=out[i].v;i=jj-1;break;case"G":out[i].t="t";out[i].v=general_fmt(v,opts);break;}}var vv="",myv,ostr;if(nstr.length>0){if(nstr.charCodeAt(0)==40){myv=v<0&&nstr.charCodeAt(0)===45?-v:v;ostr=write_num("(",nstr,myv)}else{myv=v<0&&flen>1?-v:v;ostr=write_num("n",nstr,myv);if(myv<0&&out[0]&&out[0].t=="t"){ostr=ostr.substr(1);out[0].v="-"+out[0].v}}jj=ostr.length-1;var decpt=out.length;for(i=0;i<out.length;++i)if(out[i]!=null&&out[i].t!="t"&&out[i].v.indexOf(".")>-1){decpt=i;break}var lasti=out.length;if(decpt===out.length&&ostr.indexOf("E")===-1){for(i=out.length-1;i>=0;--i){if(out[i]==null||"n?(".indexOf(out[i].t)===-1)continue;if(jj>=out[i].v.length-1){jj-=out[i].v.length;out[i].v=ostr.substr(jj+1,out[i].v.length)}else if(jj<0)out[i].v="";else{out[i].v=ostr.substr(0,jj+1);jj=-1}out[i].t="t";lasti=i}if(jj>=0&&lasti<out.length)out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v}else if(decpt!==out.length&&ostr.indexOf("E")===-1){jj=ostr.indexOf(".")-1;for(i=decpt;i>=0;--i){if(out[i]==null||"n?(".indexOf(out[i].t)===-1)continue;j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")-1:out[i].v.length-1;vv=out[i].v.substr(j+1);for(;j>=0;--j){if(jj>=0&&(out[i].v.charAt(j)==="0"||out[i].v.charAt(j)==="#"))vv=ostr.charAt(jj--)+vv}out[i].v=vv;out[i].t="t";lasti=i}if(jj>=0&&lasti<out.length)out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v;jj=ostr.indexOf(".")+1;for(i=decpt;i<out.length;++i){if(out[i]==null||"n?(".indexOf(out[i].t)===-1&&i!==decpt)continue;j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")+1:0;vv=out[i].v.substr(0,j);for(;j<out[i].v.length;++j){if(jj<ostr.length)vv+=ostr.charAt(jj++)}out[i].v=vv;out[i].t="t";lasti=i}}}for(i=0;i<out.length;++i)if(out[i]!=null&&"n(?".indexOf(out[i].t)>-1){myv=flen>1&&v<0&&i>0&&out[i-1].v==="-"?-v:v;out[i].v=write_num(out[i].t,out[i].v,myv);out[i].t="t"}var retval="";for(i=0;i!==out.length;++i)if(out[i]!=null)retval+=out[i].v;return retval}SSF._eval=eval_fmt;var cfregex=/\[[=<>]/;var cfregex2=/\[([=<>]*)(-?\d+\.?\d*)\]/;function chkcond(v,rr){if(rr==null)return false;var thresh=parseFloat(rr[2]);switch(rr[1]){case"=":if(v==thresh)return true;break;case">":if(v>thresh)return true;break;case"<":if(v<thresh)return true;break;case"<>":if(v!=thresh)return true;break;case">=":if(v>=thresh)return true;break;case"<=":if(v<=thresh)return true;break;}return false}function choose_fmt(f,v){var fmt=split_fmt(f);var l=fmt.length,lat=fmt[l-1].indexOf("@");if(l<4&&lat>-1)--l;if(fmt.length>4)throw new Error("cannot find right format for |"+fmt.join("|")+"|");if(typeof v!=="number")return[4,fmt.length===4||lat>-1?fmt[fmt.length-1]:"@"];switch(fmt.length){case 1:fmt=lat>-1?["General","General","General",fmt[0]]:[fmt[0],fmt[0],fmt[0],"@"];break;case 2:fmt=lat>-1?[fmt[0],fmt[0],fmt[0],fmt[1]]:[fmt[0],fmt[1],fmt[0],"@"];break;case 3:fmt=lat>-1?[fmt[0],fmt[1],fmt[0],fmt[2]]:[fmt[0],fmt[1],fmt[2],"@"];break;case 4:break;}var ff=v>0?fmt[0]:v<0?fmt[1]:fmt[2];if(fmt[0].indexOf("[")===-1&&fmt[1].indexOf("[")===-1)return[l,ff];if(fmt[0].match(cfregex)!=null||fmt[1].match(cfregex)!=null){var m1=fmt[0].match(cfregex2);var m2=fmt[1].match(cfregex2);return chkcond(v,m1)?[l,fmt[0]]:chkcond(v,m2)?[l,fmt[1]]:[l,fmt[m1!=null&&m2!=null?2:1]]}return[l,ff]}function format(fmt,v,o){if(o==null)o={};var sfmt="";switch(typeof fmt){case"string":if(fmt=="m/d/yy"&&o.dateNF)sfmt=o.dateNF;else sfmt=fmt;break;case"number":if(fmt==14&&o.dateNF)sfmt=o.dateNF;else sfmt=(o.table!=null?o.table:table_fmt)[fmt];break;}if(isgeneral(sfmt,0))return general_fmt(v,o);var f=choose_fmt(sfmt,v);if(isgeneral(f[1]))return general_fmt(v,o);if(v===true)v="TRUE";else if(v===false)v="FALSE";else if(v===""||v==null)return"";return eval_fmt(f[1],v,o,f[0])}SSF._table=table_fmt;SSF.load=function load_entry(fmt,idx){table_fmt[idx]=fmt};SSF.format=format;SSF.get_table=function get_table(){return table_fmt};SSF.load_table=function load_table(tbl){for(var i=0;i!=392;++i)if(tbl[i]!==undefined)SSF.load(tbl[i],i)};SSF.init_table=init_table};make_ssf(SSF);var XLMLFormatMap={"General Number":"General","General Date":SSF._table[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":SSF._table[15],"Short Date":SSF._table[14],"Long Time":SSF._table[19],"Medium Time":SSF._table[18],"Short Time":SSF._table[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:SSF._table[2],Standard:SSF._table[4],Percent:SSF._table[10],Scientific:SSF._table[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(dateNF){var fmt=typeof dateNF=="number"?SSF._table[dateNF]:dateNF;fmt=fmt.replace(dateNFregex,"(\\d+)");return new RegExp("^"+fmt+"$")}function dateNF_fix(str,dateNF,match){var Y=-1,m=-1,d=-1,H=-1,M=-1,S=-1;(dateNF.match(dateNFregex)||[]).forEach(function(n,i){var v=parseInt(match[i+1],10);switch(n.toLowerCase().charAt(0)){case"y":Y=v;break;case"d":d=v;break;case"h":H=v;break;case"s":S=v;break;case"m":if(H>=0)M=v;else m=v;break;}});if(S>=0&&M==-1&&m>=0){M=m;m=-1}var datestr=(""+(Y>=0?Y:(new Date).getFullYear())).slice(-4)+"-"+("00"+(m>=1?m:1)).slice(-2)+"-"+("00"+(d>=1?d:1)).slice(-2);if(datestr.length==7)datestr="0"+datestr;if(datestr.length==8)datestr="20"+datestr;var timestr=("00"+(H>=0?H:0)).slice(-2)+":"+("00"+(M>=0?M:0)).slice(-2)+":"+("00"+(S>=0?S:0)).slice(-2);if(H==-1&&M==-1&&S==-1)return datestr;if(Y==-1&&m==-1&&d==-1)return timestr;return datestr+"T"+timestr}var DO_NOT_EXPORT_CFB=true;var CFB=function _CFB(){var exports={};exports.version="0.11.1";function parse(file){var mver=3;var ssz=512;var nmfs=0;var ndfs=0;var dir_start=0;var minifat_start=0;var difat_start=0;var fat_addrs=[];var blob=file.slice(0,512);prep_blob(blob,0);var mv=check_get_mver(blob);mver=mv[0];switch(mver){case 3:ssz=512;break;case 4:ssz=4096;break;default:throw new Error("Major Version: Expected 3 or 4 saw "+mver);}if(ssz!==512){blob=file.slice(0,ssz);prep_blob(blob,28)}var header=file.slice(0,ssz);check_shifts(blob,mver);var nds=blob.read_shift(4,"i");if(mver===3&&nds!==0)throw new Error("# Directory Sectors: Expected 0 saw "+nds);blob.l+=4;dir_start=blob.read_shift(4,"i");blob.l+=4;blob.chk("00100000","Mini Stream Cutoff Size: ");minifat_start=blob.read_shift(4,"i");nmfs=blob.read_shift(4,"i");difat_start=blob.read_shift(4,"i");ndfs=blob.read_shift(4,"i");for(var q,j=0;j<109;++j){q=blob.read_shift(4,"i");if(q<0)break;fat_addrs[j]=q}var sectors=sectorify(file,ssz);sleuth_fat(difat_start,ndfs,sectors,ssz,fat_addrs);var sector_list=make_sector_list(sectors,dir_start,fat_addrs,ssz);sector_list[dir_start].name="!Directory";if(nmfs>0&&minifat_start!==ENDOFCHAIN)sector_list[minifat_start].name="!MiniFAT";sector_list[fat_addrs[0]].name="!FAT";sector_list.fat_addrs=fat_addrs;sector_list.ssz=ssz;var files={},Paths=[],FileIndex=[],FullPaths=[],FullPathDir={};read_directory(dir_start,sector_list,sectors,Paths,nmfs,files,FileIndex);build_full_paths(FileIndex,FullPathDir,FullPaths,Paths);var root_name=Paths.shift();Paths.root=root_name;var find_path=make_find_path(FullPaths,Paths,FileIndex,files,root_name);return{raw:{header:header,sectors:sectors},FileIndex:FileIndex,FullPaths:FullPaths,FullPathDir:FullPathDir,find:find_path}}function check_get_mver(blob){blob.chk(HEADER_SIGNATURE,"Header Signature: ");blob.chk(HEADER_CLSID,"CLSID: ");var mver=blob.read_shift(2,"u");return[blob.read_shift(2,"u"),mver]}function check_shifts(blob,mver){var shift=9;blob.l+=2;switch(shift=blob.read_shift(2)){case 9:if(mver!=3)throw new Error("Sector Shift: Expected 9 saw "+shift);break;case 12:if(mver!=4)throw new Error("Sector Shift: Expected 12 saw "+shift);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+shift);}blob.chk("0600","Mini Sector Shift: ");blob.chk("000000000000","Reserved: ")}function sectorify(file,ssz){var nsectors=Math.ceil(file.length/ssz)-1;var sectors=new Array(nsectors);for(var i=1;i<nsectors;++i)sectors[i-1]=file.slice(i*ssz,(i+1)*ssz);sectors[nsectors-1]=file.slice(nsectors*ssz);return sectors}function build_full_paths(FI,FPD,FP,Paths){var i=0,L=0,R=0,C=0,j=0,pl=Paths.length;var dad=new Array(pl),q=new Array(pl);for(;i<pl;++i){dad[i]=q[i]=i;FP[i]=Paths[i]}for(;j<q.length;++j){i=q[j];L=FI[i].L;R=FI[i].R;C=FI[i].C;if(dad[i]===i){if(L!==-1&&dad[L]!==L)dad[i]=dad[L];if(R!==-1&&dad[R]!==R)dad[i]=dad[R]}if(C!==-1)dad[C]=i;if(L!==-1){dad[L]=dad[i];q.push(L)}if(R!==-1){dad[R]=dad[i];q.push(R)}}for(i=1;i!==pl;++i)if(dad[i]===i){if(R!==-1&&dad[R]!==R)dad[i]=dad[R];else if(L!==-1&&dad[L]!==L)dad[i]=dad[L]}for(i=1;i<pl;++i){if(FI[i].type===0)continue;j=dad[i];if(j===0)FP[i]=FP[0]+"/"+FP[i];else while(j!==0){FP[i]=FP[j]+"/"+FP[i];j=dad[j]}dad[i]=0}FP[0]+="/";for(i=1;i<pl;++i){if(FI[i].type!==2)FP[i]+="/";FPD[FP[i]]=FI[i]}}function make_find_path(FullPaths,Paths,FileIndex,files,root_name){var UCFullPaths=new Array(FullPaths.length);var UCPaths=new Array(Paths.length),i;for(i=0;i<FullPaths.length;++i)UCFullPaths[i]=FullPaths[i].toUpperCase().replace(chr0,"").replace(chr1,"!");for(i=0;i<Paths.length;++i)UCPaths[i]=Paths[i].toUpperCase().replace(chr0,"").replace(chr1,"!");return function find_path(path){var k;if(path.charCodeAt(0)===47){k=true;path=root_name+path}else k=path.indexOf("/")!==-1;var UCPath=path.toUpperCase().replace(chr0,"").replace(chr1,"!");var w=k===true?UCFullPaths.indexOf(UCPath):UCPaths.indexOf(UCPath);if(w===-1)return null;return k===true?FileIndex[w]:files[Paths[w]]}}function sleuth_fat(idx,cnt,sectors,ssz,fat_addrs){var q;if(idx===ENDOFCHAIN){if(cnt!==0)throw new Error("DIFAT chain shorter than expected")}else if(idx!==-1){var sector=sectors[idx],m=(ssz>>>2)-1;if(!sector)return;for(var i=0;i<m;++i){if((q=__readInt32LE(sector,i*4))===ENDOFCHAIN)break;fat_addrs.push(q)}sleuth_fat(__readInt32LE(sector,ssz-4),cnt-1,sectors,ssz,fat_addrs)}}function get_sector_list(sectors,start,fat_addrs,ssz,chkd){var sl=sectors.length;var buf,buf_chain;if(!chkd)chkd=new Array(sl);var modulus=ssz-1,j,jj;buf=[];buf_chain=[];for(j=start;j>=0;){chkd[j]=true;buf[buf.length]=j;buf_chain.push(sectors[j]);var addr=fat_addrs[Math.floor(j*4/ssz)];jj=j*4&modulus;if(ssz<4+jj)throw new Error("FAT boundary crossed: "+j+" 4 "+ssz);if(!sectors[addr])break;j=__readInt32LE(sectors[addr],jj)}return{nodes:buf,data:__toBuffer([buf_chain])}}function make_sector_list(sectors,dir_start,fat_addrs,ssz){var sl=sectors.length,sector_list=new Array(sl);var chkd=new Array(sl),buf,buf_chain;var modulus=ssz-1,i,j,k,jj;for(i=0;i<sl;++i){buf=[];k=i+dir_start;if(k>=sl)k-=sl;if(chkd[k]===true)continue;buf_chain=[];for(j=k;j>=0;){chkd[j]=true;buf[buf.length]=j;buf_chain.push(sectors[j]);var addr=fat_addrs[Math.floor(j*4/ssz)];jj=j*4&modulus;if(ssz<4+jj)throw new Error("FAT boundary crossed: "+j+" 4 "+ssz);if(!sectors[addr])break;j=__readInt32LE(sectors[addr],jj)}sector_list[k]={nodes:buf,data:__toBuffer([buf_chain])}}return sector_list}function read_directory(dir_start,sector_list,sectors,Paths,nmfs,files,FileIndex){var blob;var minifat_store=0,pl=Paths.length?2:0;var sector=sector_list[dir_start].data;var i=0,namelen=0,name,o,ctime,mtime;for(;i<sector.length;i+=128){blob=sector.slice(i,i+128);prep_blob(blob,64);namelen=blob.read_shift(2);if(namelen===0)continue;name=__utf16le(blob,0,namelen-pl);Paths.push(name);o={name:name,type:blob.read_shift(1),color:blob.read_shift(1),L:blob.read_shift(4,"i"),R:blob.read_shift(4,"i"),C:blob.read_shift(4,"i"),clsid:blob.read_shift(16),state:blob.read_shift(4,"i")};ctime=blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2);if(ctime!==0){o.ctime=ctime;o.ct=read_date(blob,blob.l-8)}mtime=blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2);if(mtime!==0){o.mtime=mtime;o.mt=read_date(blob,blob.l-8)}o.start=blob.read_shift(4,"i");o.size=blob.read_shift(4,"i");if(o.type===5){minifat_store=o.start;if(nmfs>0&&minifat_store!==ENDOFCHAIN)sector_list[minifat_store].name="!StreamData"}else if(o.size>=4096){o.storage="fat";if(sector_list[o.start]===undefined)sector_list[o.start]=get_sector_list(sectors,o.start,sector_list.fat_addrs,sector_list.ssz);sector_list[o.start].name=o.name;o.content=sector_list[o.start].data.slice(0,o.size);prep_blob(o.content,0)}else{o.storage="minifat";if(minifat_store!==ENDOFCHAIN&&o.start!==ENDOFCHAIN){o.content=sector_list[minifat_store].data.slice(o.start*MSSZ,o.start*MSSZ+o.size);prep_blob(o.content,0)}}files[name]=o;FileIndex.push(o)}}function read_date(blob,offset){return new Date((__readUInt32LE(blob,offset+4)/1e7*Math.pow(2,32)+__readUInt32LE(blob,offset)/1e7-11644473600)*1e3)}var fs;function readFileSync(filename,options){if(fs===undefined)fs=require("fs");return parse(fs.readFileSync(filename),options)}function readSync(blob,options){switch(options!==undefined&&options.type!==undefined?options.type:"base64"){case"file":return readFileSync(blob,options);case"base64":return parse(s2a(Base64.decode(blob)),options);case"binary":return parse(s2a(blob),options);}return parse(blob)}var MSSZ=64;var ENDOFCHAIN=-2;var HEADER_SIGNATURE="d0cf11e0a1b11ae1";var HEADER_CLSID="00000000000000000000000000000000";var consts={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:ENDOFCHAIN,FREESECT:-1,HEADER_SIGNATURE:HEADER_SIGNATURE,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:HEADER_CLSID,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};exports.read=readSync;exports.parse=parse;exports.utils={ReadShift:ReadShift,CheckField:CheckField,prep_blob:prep_blob,bconcat:bconcat,consts:consts};return exports}();if(typeof require!=="undefined"&&typeof module!=="undefined"&&typeof DO_NOT_EXPORT_CFB==="undefined"){module.exports=CFB}function isval(x){return x!==undefined&&x!==null}function keys(o){return Object.keys(o)}function evert_key(obj,key){var o=[],K=keys(obj);for(var i=0;i!==K.length;++i)o[obj[K[i]][key]]=K[i];return o}function evert(obj){var o=[],K=keys(obj);for(var i=0;i!==K.length;++i)o[obj[K[i]]]=K[i];return o}function evert_num(obj){var o=[],K=keys(obj);for(var i=0;i!==K.length;++i)o[obj[K[i]]]=parseInt(K[i],10);return o}function evert_arr(obj){var o=[],K=keys(obj);for(var i=0;i!==K.length;++i){if(o[obj[K[i]]]==null)o[obj[K[i]]]=[];o[obj[K[i]]].push(K[i])}return o}var basedate=new Date(1899,11,30,0,0,0);var dnthresh=basedate.getTime()+((new Date).getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;function datenum(v,date1904){var epoch=v.getTime();if(date1904)epoch+=1462*24*60*60*1e3;return(epoch-dnthresh)/(24*60*60*1e3)}function numdate(v){var out=new Date;out.setTime(v*24*60*60*1e3+dnthresh);return out}function parse_isodur(s){var sec=0,mt=0,time=false;var m=s.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!m)throw new Error("|"+s+"| is not an ISO8601 Duration");for(var i=1;i!=m.length;++i){if(!m[i])continue;mt=1;if(i>3)time=true;switch(m[i].substr(m[i].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+m[i].substr(m[i].length-1));case"D":mt*=24;case"H":mt*=60;case"M":if(!time)throw new Error("Unsupported ISO Duration Field: M");else mt*=60;case"S":break;}sec+=mt*parseInt(m[i],10)}return sec}var good_pd_date=new Date("2017-02-19T19:06:09.000Z");if(isNaN(good_pd_date.getFullYear()))good_pd_date=new Date("2/19/17");var good_pd=good_pd_date.getFullYear()==2017;function parseDate(str,fixdate){var d=new Date(str);if(good_pd){if(fixdate>0)d.setTime(d.getTime()+d.getTimezoneOffset()*60*1e3);else if(fixdate<0)d.setTime(d.getTime()-d.getTimezoneOffset()*60*1e3);return d}if(str instanceof Date)return str;if(good_pd_date.getFullYear()==1917&&!isNaN(d.getFullYear())){var s=d.getFullYear();if(str.indexOf(""+s)>-1)return d;d.setFullYear(d.getFullYear()+100);return d}var n=str.match(/\d+/g)||["2017","2","19","0","0","0"];return new Date(+n[0],+n[1]-1,+n[2],+n[3]||0,+n[4]||0,+n[5]||0)}function cc2str(arr){var o="";for(var i=0;i!=arr.length;++i)o+=String.fromCharCode(arr[i]);return o}function str2cc(str){var o=[];for(var i=0;i!=str.length;++i)o.push(str.charCodeAt(i));return o}function dup(o){if(typeof JSON!="undefined"&&!Array.isArray(o))return JSON.parse(JSON.stringify(o));if(typeof o!="object"||o==null)return o;var out={};for(var k in o)if(o.hasOwnProperty(k))out[k]=dup(o[k]);return out}function fill(c,l){var o="";while(o.length<l)o+=c;return o}function fuzzydate(s){var o=new Date(s),n=new Date(NaN);var y=o.getYear(),m=o.getMonth(),d=o.getDate();if(isNaN(d))return n;if(y<0||y>8099)return n;if((m>0||d>1)&&y!=101)return o;if(s.toLowerCase().match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/))return o;if(!s.match(/[a-zA-Z]/))return o;return n}function getdatastr(data){if(!data)return null;if(data.data)return debom(data.data);if(data.asNodeBuffer&&has_buf)return debom(data.asNodeBuffer().toString("binary"));if(data.asBinary)return debom(data.asBinary());if(data._data&&data._data.getContent)return debom(cc2str(Array.prototype.slice.call(data._data.getContent(),0)));return null}function getdatabin(data){if(!data)return null;if(data.data)return char_codes(data.data);if(data.asNodeBuffer&&has_buf)return data.asNodeBuffer();if(data._data&&data._data.getContent){var o=data._data.getContent();if(typeof o=="string")return str2cc(o);return Array.prototype.slice.call(o)}return null}function getdata(data){return data&&data.name.slice(-4)===".bin"?getdatabin(data):getdatastr(data)}function safegetzipfile(zip,file){var k=keys(zip.files);var f=file.toLowerCase(),g=f.replace(/\//g,"\\");for(var i=0;i<k.length;++i){var n=k[i].toLowerCase();if(f==n||g==n)return zip.files[k[i]]}return null}function getzipfile(zip,file){var o=safegetzipfile(zip,file);if(o==null)throw new Error("Cannot find file "+file+" in zip");return o}function getzipdata(zip,file,safe){if(!safe)return getdata(getzipfile(zip,file));if(!file)return null;try{return getzipdata(zip,file)}catch(e){return null}}function getzipstr(zip,file,safe){if(!safe)return getdatastr(getzipfile(zip,file));if(!file)return null;try{return getzipstr(zip,file)}catch(e){return null}}var _fs,jszip;if(typeof JSZip!=="undefined")jszip=JSZip;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){if(typeof jszip==="undefined")jszip=require("./jszip.js");_fs=require("fs")}}function resolve_path(path,base){var result=base.split("/");if(base.slice(-1)!="/")result.pop();var target=path.split("/");while(target.length!==0){var step=target.shift();if(step==="..")result.pop();else if(step!==".")result.push(step)}return result.join("/")}var attregexg=/([^"\s?>\/]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g;var tagregex=/<[^>]*>/g;var nsregex=/<\w*:/,nsregex2=/<(\/?)\w+:/;function parsexmltag(tag,skip_root){var z={};var eq=0,c=0;for(;eq!==tag.length;++eq)if((c=tag.charCodeAt(eq))===32||c===10||c===13)break;if(!skip_root)z[0]=tag.substr(0,eq);if(eq===tag.length)return z;var m=tag.match(attregexg),j=0,v="",i=0,q="",cc="",quot=1;if(m)for(i=0;i!=m.length;++i){cc=m[i];for(c=0;c!=cc.length;++c)if(cc.charCodeAt(c)===61)break;q=cc.substr(0,c);quot=(eq=cc.charCodeAt(c+1))==34||eq==39?1:0;v=cc.substring(c+1+quot,cc.length-quot);for(j=0;j!=q.length;++j)if(q.charCodeAt(j)===58)break;if(j===q.length){if(q.indexOf("_")>0)q=q.substr(0,q.indexOf("_"));z[q]=v}else{var k=(j===5&&q.substr(0,5)==="xmlns"?"xmlns":"")+q.substr(j+1);if(z[k]&&q.substr(j-3,3)=="ext")continue;z[k]=v}}return z}function strip_ns(x){return x.replace(nsregex2,"<$1")}var encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"};var rencoding=evert(encodings);var unescapexml=function(){var encregex=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/g,coderegex=/_x([\da-fA-F]{4})_/g;return function unescapexml(text){var s=text+"";return s.replace(encregex,function($$,$1){return encodings[$$]||String.fromCharCode(parseInt($1,$$.indexOf("x")>-1?16:10))||$$}).replace(coderegex,function(m,c){return String.fromCharCode(parseInt(c,16))})}}();var decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f]/g;function escapexml(text,xml){var s=text+"";return s.replace(decregex,function(y){return rencoding[y]}).replace(charegex,function(s){return"_x"+("000"+s.charCodeAt(0).toString(16)).slice(-4)+"_"})}function escapexmltag(text){return escapexml(text).replace(/ /g,"_x0020_")}var htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(text){var s=text+"";return s.replace(decregex,function(y){return rencoding[y]}).replace(htmlcharegex,function(s){return"&#x"+("000"+s.charCodeAt(0).toString(16)).slice(-4)+";"})}var xlml_fixstr=function(){var entregex=/&#(\d+);/g;function entrepl($$,$1){return String.fromCharCode(parseInt($1,10))}return function xlml_fixstr(str){return str.replace(entregex,entrepl)}}();var xlml_unfixstr=function(){return function xlml_unfixstr(str){return str.replace(/(\r\n|[\r\n])/g,"&#10;")}}();function parsexmlbool(value,tag){switch(value){case 1:;case true:;case"1":;case"true":;case"TRUE":return true;default:return false;}}var utf8read=function utf8reada(orig){var out="",i=0,c=0,d=0,e=0,f=0,w=0;while(i<orig.length){c=orig.charCodeAt(i++);if(c<128){out+=String.fromCharCode(c);continue}d=orig.charCodeAt(i++);if(c>191&&c<224){f=(c&31)<<6;f|=d&63;out+=String.fromCharCode(f);continue}e=orig.charCodeAt(i++);if(c<240){out+=String.fromCharCode((c&15)<<12|(d&63)<<6|e&63);continue}f=orig.charCodeAt(i++);w=((c&7)<<18|(d&63)<<12|(e&63)<<6|f&63)-65536;out+=String.fromCharCode(55296+(w>>>10&1023));out+=String.fromCharCode(56320+(w&1023))}return out};if(has_buf){var utf8readb=function utf8readb(data){var out=new Buffer(2*data.length),w,i,j=1,k=0,ww=0,c;for(i=0;i<data.length;i+=j){j=1;if((c=data.charCodeAt(i))<128)w=c;else if(c<224){w=(c&31)*64+(data.charCodeAt(i+1)&63);j=2}else if(c<240){w=(c&15)*4096+(data.charCodeAt(i+1)&63)*64+(data.charCodeAt(i+2)&63);j=3}else{j=4;w=(c&7)*262144+(data.charCodeAt(i+1)&63)*4096+(data.charCodeAt(i+2)&63)*64+(data.charCodeAt(i+3)&63);w-=65536;ww=55296+(w>>>10&1023);w=56320+(w&1023)}if(ww!==0){out[k++]=ww&255;out[k++]=ww>>>8;ww=0}out[k++]=w%256;out[k++]=w>>>8}return out.slice(0,k).toString("ucs2")};var corpus="foo bar bazâð£";if(utf8read(corpus)==utf8readb(corpus))utf8read=utf8readb;var utf8readc=function utf8readc(data){return Buffer(data,"binary").toString("utf8")};if(utf8read(corpus)==utf8readc(corpus))utf8read=utf8readc}var matchtag=function(){var mtcache={};return function matchtag(f,g){var t=f+"|"+(g||"");if(mtcache[t])return mtcache[t];return mtcache[t]=new RegExp("<(?:\\w+:)?"+f+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+f+">",g||"")}}();var vtregex=function(){var vt_cache={};return function vt_regex(bt){if(vt_cache[bt]!==undefined)return vt_cache[bt];return vt_cache[bt]=new RegExp("<(?:vt:)?"+bt+">([\\s\\S]*?)</(?:vt:)?"+bt+">","g");}}();var vtvregex=/<\/?(?:vt:)?variant>/g,vtmregex=/<(?:vt:)([^>]*)>([\s\S]*)</;function parseVector(data){var h=parsexmltag(data);var matches=data.match(vtregex(h.baseType))||[];if(matches.length!=h.size)throw new Error("unexpected vector length "+matches.length+" != "+h.size);var res=[];matches.forEach(function(x){var v=x.replace(vtvregex,"").match(vtmregex);res.push({v:utf8read(v[2]),t:v[1]})});return res}var wtregex=/(^\s|\s$|\n)/;function writetag(f,g){return"<"+f+(g.match(wtregex)?' xml:space="preserve"':"")+">"+g+"</"+f+">"}function wxt_helper(h){return keys(h).map(function(k){return" "+k+'="'+h[k]+'"'}).join("")}function writextag(f,g,h){return"<"+f+(isval(h)?wxt_helper(h):"")+(isval(g)?(g.match(wtregex)?' xml:space="preserve"':"")+">"+g+"</"+f:"/")+">"}function write_w3cdtf(d,t){try{return d.toISOString().replace(/\.\d*/,"")}catch(e){if(t)throw e}return""}function write_vt(s){switch(typeof s){case"string":return writextag("vt:lpwstr",s);case"number":return writextag((s|0)==s?"vt:i4":"vt:r8",String(s));case"boolean":return writextag("vt:bool",s?"true":"false");}if(s instanceof Date)return writextag("vt:filetime",write_w3cdtf(s));throw new Error("Unable to serialize "+s)}var XML_HEADER='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n';var XMLNS={dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"};XMLNS.main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];var XLMLNS={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function read_double_le(b,idx){var s=1-2*(b[idx+7]>>>7);var e=((b[idx+7]&127)<<4)+(b[idx+6]>>>4&15);var m=b[idx+6]&15;for(var i=5;i>=0;--i)m=m*256+b[idx+i];if(e==2047)return m==0?s*Infinity:NaN;if(e==0)e=-1022;else{e-=1023;m+=Math.pow(2,52)}return s*Math.pow(2,e-52)*m}function write_double_le(b,v,idx){var bs=(v<0||1/v==-Infinity?1:0)<<7,e=0,m=0;var av=bs?-v:v;if(!isFinite(av)){e=2047;m=isNaN(v)?26985:0}else{e=Math.floor(Math.log(av)*Math.LOG2E);m=v*Math.pow(2,52-e);if(e<=-1023&&(!isFinite(m)||m<Math.pow(2,52))){e=-1022}else{m-=Math.pow(2,52);e+=1023}}for(var i=0;i<=5;++i,m/=256)b[idx+i]=m&255;b[idx+6]=(e&15)<<4|m&15;b[idx+7]=e>>4|bs}var __toBuffer,___toBuffer;__toBuffer=___toBuffer=function toBuffer_(bufs){var x=[];for(var i=0;i<bufs[0].length;++i){x.push.apply(x,bufs[0][i])}return x};var __utf16le,___utf16le;__utf16le=___utf16le=function utf16le_(b,s,e){var ss=[];for(var i=s;i<e;i+=2)ss.push(String.fromCharCode(__readUInt16LE(b,i)));return ss.join("")};var __hexlify,___hexlify;__hexlify=___hexlify=function hexlify_(b,s,l){return b.slice(s,s+l).map(function(x){return(x<16?"0":"")+x.toString(16)}).join("")};var __utf8,___utf8;__utf8=___utf8=function(b,s,e){var ss=[];for(var i=s;i<e;i++)ss.push(String.fromCharCode(__readUInt8(b,i)));return ss.join("")};var __lpstr,___lpstr;__lpstr=___lpstr=function lpstr_(b,i){var len=__readUInt32LE(b,i);return len>0?__utf8(b,i+4,i+4+len-1):""};var __lpwstr,___lpwstr;__lpwstr=___lpwstr=function lpwstr_(b,i){var len=2*__readUInt32LE(b,i);return len>0?__utf8(b,i+4,i+4+len-1):""};var __lpp4,___lpp4;__lpp4=___lpp4=function lpp4_(b,i){var len=__readUInt32LE(b,i);return len>0?__utf16le(b,i+4,i+4+len):""};var __8lpp4,___8lpp4;__8lpp4=___8lpp4=function lpp4_8(b,i){var len=__readUInt32LE(b,i);return len>0?__utf8(b,i+4,i+4+len):""};var __double,___double;__double=___double=function(b,idx){return read_double_le(b,idx)};var is_buf=function is_buf_a(a){return Array.isArray(a)};if(has_buf){__utf16le=function utf16le_b(b,s,e){if(!Buffer.isBuffer(b))return ___utf16le(b,s,e);return b.toString("utf16le",s,e)};__hexlify=function(b,s,l){return Buffer.isBuffer(b)?b.toString("hex",s,s+l):___hexlify(b,s,l)};__lpstr=function lpstr_b(b,i){if(!Buffer.isBuffer(b))return ___lpstr(b,i);var len=b.readUInt32LE(i);return len>0?b.toString("utf8",i+4,i+4+len-1):""};__lpwstr=function lpwstr_b(b,i){if(!Buffer.isBuffer(b))return ___lpwstr(b,i);var len=2*b.readUInt32LE(i);return b.toString("utf16le",i+4,i+4+len-1)};__lpp4=function lpp4_b(b,i){if(!Buffer.isBuffer(b))return ___lpp4(b,i);var len=b.readUInt32LE(i);return b.toString("utf16le",i+4,i+4+len)};__8lpp4=function lpp4_8b(b,i){if(!Buffer.isBuffer(b))return ___8lpp4(b,i);var len=b.readUInt32LE(i);return b.toString("utf8",i+4,i+4+len)};__utf8=function utf8_b(b,s,e){return b.toString("utf8",s,e)};__toBuffer=function(bufs){return bufs[0].length>0&&Buffer.isBuffer(bufs[0][0])?Buffer.concat(bufs[0]):___toBuffer(bufs)};bconcat=function(bufs){return Buffer.isBuffer(bufs[0])?Buffer.concat(bufs):[].concat.apply([],bufs)};__double=function double_(b,i){if(Buffer.isBuffer(b))return b.readDoubleLE(i);return ___double(b,i)};is_buf=function is_buf_b(a){return Buffer.isBuffer(a)||Array.isArray(a)}}if(typeof cptable!=="undefined"){__utf16le=function(b,s,e){return cptable.utils.decode(1200,b.slice(s,e))};__utf8=function(b,s,e){return cptable.utils.decode(65001,b.slice(s,e))};__lpstr=function(b,i){var len=__readUInt32LE(b,i);return len>0?cptable.utils.decode(current_codepage,b.slice(i+4,i+4+len-1)):""};__lpwstr=function(b,i){var len=2*__readUInt32LE(b,i);return len>0?cptable.utils.decode(1200,b.slice(i+4,i+4+len-1)):""};__lpp4=function(b,i){var len=__readUInt32LE(b,i);return len>0?cptable.utils.decode(1200,b.slice(i+4,i+4+len)):""};__8lpp4=function(b,i){var len=__readUInt32LE(b,i);return len>0?cptable.utils.decode(65001,b.slice(i+4,i+4+len)):""}}var __readUInt8=function(b,idx){return b[idx]};var __readUInt16LE=function(b,idx){return b[idx+1]*(1<<8)+b[idx]};var __readInt16LE=function(b,idx){var u=b[idx+1]*(1<<8)+b[idx];return u<32768?u:(65535-u+1)*-1};var __readUInt32LE=function(b,idx){return b[idx+3]*(1<<24)+(b[idx+2]<<16)+(b[idx+1]<<8)+b[idx]};var __readInt32LE=function(b,idx){return b[idx+3]<<24|b[idx+2]<<16|b[idx+1]<<8|b[idx]};var ___unhexlify=function(s){return s.match(/../g).map(function(x){return parseInt(x,16)})};var __unhexlify=typeof Buffer!=="undefined"?function(s){return Buffer.isBuffer(s)?new Buffer(s,"hex"):___unhexlify(s)}:___unhexlify;function ReadShift(size,t){var o="",oI,oR,oo=[],w,vv,i,loc;switch(t){case"dbcs":loc=this.l;if(has_buf&&Buffer.isBuffer(this))o=this.slice(this.l,this.l+2*size).toString("utf16le");else for(i=0;i!=size;++i){o+=String.fromCharCode(__readUInt16LE(this,loc));loc+=2}size*=2;break;case"utf8":o=__utf8(this,this.l,this.l+size);break;case"utf16le":size*=2;o=__utf16le(this,this.l,this.l+size);break;case"wstr":if(typeof cptable!=="undefined")o=cptable.utils.decode(current_codepage,this.slice(this.l,this.l+2*size));else return ReadShift.call(this,size,"dbcs");size=2*size;break;case"lpstr":o=__lpstr(this,this.l);size=5+o.length;break;case"lpwstr":o=__lpwstr(this,this.l);size=5+o.length;if(o[o.length-1]=="\0")size+=2;break;case"lpp4":size=4+__readUInt32LE(this,this.l);o=__lpp4(this,this.l);if(size&2)size+=2;break;case"8lpp4":size=4+__readUInt32LE(this,this.l);o=__8lpp4(this,this.l);if(size&3)size+=4-(size&3);break;case"cstr":size=0;o="";while((w=__readUInt8(this,this.l+size++))!==0)oo.push(_getchar(w));o=oo.join("");break;case"_wstr":size=0;o="";while((w=__readUInt16LE(this,this.l+size))!==0){oo.push(_getchar(w));size+=2}size+=2;o=oo.join("");break;case"dbcs-cont":o="";loc=this.l;for(i=0;i!=size;++i){if(this.lens&&this.lens.indexOf(loc)!==-1){w=__readUInt8(this,loc);this.l=loc+1;vv=ReadShift.call(this,size-i,w?"dbcs-cont":"sbcs-cont");return oo.join("")+vv}oo.push(_getchar(__readUInt16LE(this,loc)));loc+=2}o=oo.join("");size*=2;break;case"sbcs-cont":o="";loc=this.l;for(i=0;i!=size;++i){if(this.lens&&this.lens.indexOf(loc)!==-1){w=__readUInt8(this,loc);this.l=loc+1;vv=ReadShift.call(this,size-i,w?"dbcs-cont":"sbcs-cont");return oo.join("")+vv}oo.push(_getchar(__readUInt8(this,loc)));loc+=1}o=oo.join("");break;default:switch(size){case 1:oI=__readUInt8(this,this.l);this.l++;return oI;case 2:oI=(t==="i"?__readInt16LE:__readUInt16LE)(this,this.l);this.l+=2;return oI;case 4:if(t==="i"||(this[this.l+3]&128)===0){oI=__readInt32LE(this,this.l);this.l+=4;return oI}else{oR=__readUInt32LE(this,this.l);this.l+=4}return oR;case 8:if(t==="f"){oR=__double(this,this.l);this.l+=8;return oR};case 16:o=__hexlify(this,this.l,size);break;};}this.l+=size;return o}var __writeUInt16LE=function(b,val,idx){b[idx]=val&255;b[idx+1]=val>>>8&255};var __writeUInt32LE=function(b,val,idx){b[idx]=val&255;b[idx+1]=val>>>8&255;b[idx+2]=val>>>16&255;b[idx+3]=val>>>24&255};var __writeInt32LE=function(b,val,idx){b[idx]=val&255;b[idx+1]=val>>8&255;b[idx+2]=val>>16&255;b[idx+3]=val>>24&255};function WriteShift(t,val,f){var size=0,i=0;if(f==="dbcs"){for(i=0;i!=val.length;++i)__writeUInt16LE(this,val.charCodeAt(i),this.l+2*i);size=2*val.length}else if(f==="sbcs"){for(i=0;i!=val.length;++i)this[this.l+i]=val.charCodeAt(i)&255;size=val.length}else switch(t){case 1:size=1;this[this.l]=val&255;break;case 2:size=2;this[this.l]=val&255;val>>>=8;this[this.l+1]=val&255;break;case 3:size=3;this[this.l]=val&255;val>>>=8;this[this.l+1]=val&255;val>>>=8;this[this.l+2]=val&255;break;case 4:size=4;__writeUInt32LE(this,val,this.l);break;case 8:size=8;if(f==="f"){write_double_le(this,val,this.l);break};case 16:break;case-4:size=4;__writeInt32LE(this,val,this.l);break;}this.l+=size;return this}function CheckField(hexstr,fld){var m=__hexlify(this,this.l,hexstr.length>>1);if(m!==hexstr)throw fld+"Expected "+hexstr+" saw "+m;this.l+=hexstr.length>>1}function prep_blob(blob,pos){blob.l=pos;blob.read_shift=ReadShift;blob.chk=CheckField;blob.write_shift=WriteShift}function parsenoop(blob,length){blob.l+=length}function parsenooplog(blob,length){if(typeof console!="undefined")console.log(blob.slice(blob.l,blob.l+length));blob.l+=length}function writenoop(blob,length){blob.l+=length}function new_buf(sz){var o=new_raw_buf(sz);prep_blob(o,0);return o}function recordhopper(data,cb,opts){if(!data)return;var tmpbyte,cntbyte,length;prep_blob(data,data.l||0);var L=data.length,RT=0,tgt=0;while(data.l<L){RT=data.read_shift(1);if(RT&128)RT=(RT&127)+((data.read_shift(1)&127)<<7);var R=XLSBRecordEnum[RT]||XLSBRecordEnum[65535];tmpbyte=data.read_shift(1);length=tmpbyte&127;for(cntbyte=1;cntbyte<4&&tmpbyte&128;++cntbyte)length+=((tmpbyte=data.read_shift(1))&127)<<7*cntbyte;tgt=data.l+length;var d=R.f(data,length,opts);data.l=tgt;if(cb(d,R.n,RT))return}}function buf_array(){var bufs=[],blksz=2048;var newblk=function ba_newblk(sz){var o=new_buf(sz);prep_blob(o,0);return o};var curbuf=newblk(blksz);var endbuf=function ba_endbuf(){if(!curbuf)return;if(curbuf.length>curbuf.l)curbuf=curbuf.slice(0,curbuf.l);if(curbuf.length>0)bufs.push(curbuf);curbuf=null};var next=function ba_next(sz){if(curbuf&&sz<curbuf.length-curbuf.l)return curbuf;endbuf();return curbuf=newblk(Math.max(sz+1,blksz))};var end=function ba_end(){endbuf();return __toBuffer([bufs])};var push=function ba_push(buf){endbuf();curbuf=buf;next(blksz)};return{next:next,push:push,end:end,_bufs:bufs}}function write_record(ba,type,payload,length){var t=Number(evert_RE[type]),l;if(isNaN(t))return;if(!length)length=XLSBRecordEnum[t].p||(payload||[]).length||0;l=1+(t>=128?1:0)+1+length;if(length>=128)++l;if(length>=16384)++l;if(length>=2097152)++l;var o=ba.next(l);if(t<=127)o.write_shift(1,t);else{o.write_shift(1,(t&127)+128);o.write_shift(1,t>>7)}for(var i=0;i!=4;++i){if(length>=128){o.write_shift(1,(length&127)+128);length>>=7}else{o.write_shift(1,length);break}}if(length>0&&is_buf(payload))ba.push(payload)}function shift_cell_xls(cell,tgt,opts){var out=dup(cell);if(tgt.s){if(out.cRel)out.c+=tgt.s.c;if(out.rRel)out.r+=tgt.s.r}else{out.c+=tgt.c;out.r+=tgt.r}if(!opts||opts.biff<12){while(out.c>=256)out.c-=256;while(out.r>=65536)out.r-=65536}return out}function shift_range_xls(cell,range,opts){var out=dup(cell);out.s=shift_cell_xls(out.s,range.s,opts);out.e=shift_cell_xls(out.e,range.s,opts);return out}function encode_cell_xls(c){var s=encode_cell(c);if(c.cRel===0)s=fix_col(s);if(c.rRel===0)s=fix_row(s);return s}function encode_range_xls(r,opts){if(r.s.r==0&&!r.s.rRel){if(r.e.r==opts.biff>=12?1048575:65535&&!r.e.rRel){return(r.s.cRel?"":"$")+encode_col(r.s.c)+":"+(r.e.cRel?"":"$")+encode_col(r.e.c)}}if(r.s.c==0&&!r.s.cRel){if(r.e.c==opts.biff>=12?65535:255&&!r.e.cRel){return(r.s.rRel?"":"$")+encode_row(r.s.r)+":"+(r.e.rRel?"":"$")+encode_row(r.e.r)}}return encode_cell_xls(r.s)+":"+encode_cell_xls(r.e)}var OFFCRYPTO={};var make_offcrypto=function(O,_crypto){var crypto;if(typeof _crypto!=="undefined")crypto=_crypto;else if(typeof require!=="undefined"){try{crypto=require("crypto")}catch(e){crypto=null}}O.rc4=function(key,data){var S=new Array(256);var c=0,i=0,j=0,t=0;for(i=0;i!=256;++i)S[i]=i;for(i=0;i!=256;++i){j=j+S[i]+key[i%key.length].charCodeAt(0)&255;t=S[i];S[i]=S[j];S[j]=t}i=j=0;var out=Buffer(data.length);for(c=0;c!=data.length;++c){i=i+1&255;j=(j+S[i])%256;t=S[i];S[i]=S[j];S[j]=t;out[c]=data[c]^S[S[i]+S[j]&255]}return out};O.md5=function(hex){if(!crypto)throw new Error("Unsupported crypto");return crypto.createHash("md5").update(hex).digest("hex")}};make_offcrypto(OFFCRYPTO,typeof crypto!=="undefined"?crypto:undefined);function decode_row(rowstr){return parseInt(unfix_row(rowstr),10)-1}function encode_row(row){return""+(row+1)}function fix_row(cstr){return cstr.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(cstr){return cstr.replace(/\$(\d+)$/,"$1")}function decode_col(colstr){var c=unfix_col(colstr),d=0,i=0;for(;i!==c.length;++i)d=26*d+c.charCodeAt(i)-64;return d-1}function encode_col(col){var s="";for(++col;col;col=Math.floor((col-1)/26))s=String.fromCharCode((col-1)%26+65)+s;return s}function fix_col(cstr){return cstr.replace(/^([A-Z])/,"$$$1")}function unfix_col(cstr){return cstr.replace(/^\$([A-Z])/,"$1")}function split_cell(cstr){return cstr.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(cstr){var splt=split_cell(cstr);return{c:decode_col(splt[0]),r:decode_row(splt[1])}}function encode_cell(cell){return encode_col(cell.c)+encode_row(cell.r)}function fix_cell(cstr){return fix_col(fix_row(cstr))}function unfix_cell(cstr){return unfix_col(unfix_row(cstr))}function decode_range(range){var x=range.split(":").map(decode_cell);return{s:x[0],e:x[x.length-1]}}function encode_range(cs,ce){if(typeof ce==="undefined"||typeof ce==="number"){return encode_range(cs.s,cs.e)}if(typeof cs!=="string")cs=encode_cell(cs);if(typeof ce!=="string")ce=encode_cell(ce);return cs==ce?cs:cs+":"+ce}function safe_decode_range(range){var o={s:{c:0,r:0},e:{c:0,r:0}};var idx=0,i=0,cc=0;var len=range.length;for(idx=0;i<len;++i){if((cc=range.charCodeAt(i)-64)<1||cc>26)break;idx=26*idx+cc}o.s.c=--idx;for(idx=0;i<len;++i){if((cc=range.charCodeAt(i)-48)<0||cc>9)break;idx=10*idx+cc}o.s.r=--idx;if(i===len||range.charCodeAt(++i)===58){o.e.c=o.s.c;o.e.r=o.s.r;return o}for(idx=0;i!=len;++i){if((cc=range.charCodeAt(i)-64)<1||cc>26)break;idx=26*idx+cc}o.e.c=--idx;for(idx=0;i!=len;++i){if((cc=range.charCodeAt(i)-48)<0||cc>9)break;idx=10*idx+cc}o.e.r=--idx;return o}function safe_format_cell(cell,v){var q=cell.t=="d"&&v instanceof Date;if(cell.z!=null)try{return cell.w=SSF.format(cell.z,q?datenum(v):v)}catch(e){}try{return cell.w=SSF.format((cell.XF||{}).ifmt||(q?14:0),q?datenum(v):v)}catch(e){return""+v}}function format_cell(cell,v,o){if(cell==null||cell.t==null||cell.t=="z")return"";if(cell.w!==undefined)return cell.w;if(cell.t=="d"&&!cell.z&&o&&o.dateNF)cell.z=o.dateNF;if(v==undefined)return safe_format_cell(cell,cell.v,o);return safe_format_cell(cell,v,o)}function sheet_to_workbook(sheet,opts){var n=opts&&opts.sheet?opts.sheet:"Sheet1";var sheets={};sheets[n]=sheet;return{SheetNames:[n],Sheets:sheets}}function aoa_to_sheet(data,opts){var o=opts||{};if(DENSE!=null&&o.dense==null)o.dense=DENSE;var ws=o.dense?[]:{};var range={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(var R=0;R!=data.length;++R){for(var C=0;C!=data[R].length;++C){if(typeof data[R][C]==="undefined")continue;var cell={v:data[R][C]};if(Array.isArray(cell.v)){cell.f=data[R][C][1];cell.v=cell.v[0]}if(range.s.r>R)range.s.r=R;if(range.s.c>C)range.s.c=C;if(range.e.r<R)range.e.r=R;if(range.e.c<C)range.e.c=C;if(cell.v===null){if(cell.f)cell.t="n";else if(!o.cellStubs)continue;else cell.t="z"}else if(typeof cell.v==="number")cell.t="n";else if(typeof cell.v==="boolean")cell.t="b";else if(cell.v instanceof Date){cell.z=o.dateNF||SSF._table[14];if(o.cellDates){cell.t="d";cell.w=SSF.format(cell.z,datenum(cell.v))}else{cell.t="n";cell.v=datenum(cell.v);cell.w=SSF.format(cell.z,cell.v)}}else cell.t="s";if(o.dense){if(!ws[R])ws[R]=[];ws[R][C]=cell}else{var cell_ref=encode_cell({c:C,r:R});ws[cell_ref]=cell}}}if(range.s.c<1e7)ws["!ref"]=encode_range(range);return ws}function write_UInt32LE(x,o){if(!o)o=new_buf(4);o.write_shift(4,x);return o}function parse_XLWideString(data){var cchCharacters=data.read_shift(4);return cchCharacters===0?"":data.read_shift(cchCharacters,"dbcs")}function write_XLWideString(data,o){var _null=false;if(o==null){_null=true;o=new_buf(4+2*data.length)}o.write_shift(4,data.length);if(data.length>0)o.write_shift(0,data,"dbcs");return _null?o.slice(0,o.l):o}function parse_StrRun(data,length){return{ich:data.read_shift(2),ifnt:data.read_shift(2)}}function write_StrRun(run,o){if(!o)o=new_buf(4);o.write_shift(2,run.ich||0);o.write_shift(2,run.ifnt||0);return o}function parse_RichStr(data,length){var start=data.l;var flags=data.read_shift(1);var str=parse_XLWideString(data);var rgsStrRun=[];var z={t:str,h:str};if((flags&1)!==0){var dwSizeStrRun=data.read_shift(4);for(var i=0;i!=dwSizeStrRun;++i)rgsStrRun.push(parse_StrRun(data));z.r=rgsStrRun}else z.r=[{ich:0,ifnt:0}];data.l=start+length;return z}function write_RichStr(str,o){var _null=false;if(o==null){_null=true;o=new_buf(15+4*str.t.length)}o.write_shift(1,0);write_XLWideString(str.t,o);return _null?o.slice(0,o.l):o}var parse_BrtCommentText=parse_RichStr;function write_BrtCommentText(str,o){var _null=false;if(o==null){_null=true;o=new_buf(23+4*str.t.length)}o.write_shift(1,1);write_XLWideString(str.t,o);o.write_shift(4,1);write_StrRun({ich:0,ifnt:0},o);return _null?o.slice(0,o.l):o}function parse_XLSBCell(data){var col=data.read_shift(4);var iStyleRef=data.read_shift(2);iStyleRef+=data.read_shift(1)<<16;var fPhShow=data.read_shift(1);return{c:col,iStyleRef:iStyleRef}}function write_XLSBCell(cell,o){if(o==null)o=new_buf(8);o.write_shift(-4,cell.c);o.write_shift(3,cell.iStyleRef||cell.s);o.write_shift(1,0);return o}var parse_XLSBCodeName=parse_XLWideString;var write_XLSBCodeName=write_XLWideString;function parse_XLNullableWideString(data){var cchCharacters=data.read_shift(4);return cchCharacters===0||cchCharacters===4294967295?"":data.read_shift(cchCharacters,"dbcs")}function write_XLNullableWideString(data,o){var _null=false;if(o==null){_null=true;o=new_buf(127)}o.write_shift(4,data.length>0?data.length:4294967295);if(data.length>0)o.write_shift(0,data,"dbcs");return _null?o.slice(0,o.l):o}var parse_XLNameWideString=parse_XLWideString;var write_XLNameWideString=write_XLWideString;var parse_RelID=parse_XLNullableWideString;var write_RelID=write_XLNullableWideString;function parse_RkNumber(data){var b=data.slice(data.l,data.l+4);var fX100=b[0]&1,fInt=b[0]&2;data.l+=4;b[0]&=252;var RK=fInt===0?__double([0,0,0,0,b[0],b[1],b[2],b[3]],0):__readInt32LE(b,0)>>2;return fX100?RK/100:RK}function write_RkNumber(data,o){if(o==null)o=new_buf(4);var fX100=0,fInt=0,d100=data*100;if(data==(data|0)&&data>=-(1<<29)&&data<1<<29){fInt=1}else if(d100==(d100|0)&&d100>=-(1<<29)&&d100<1<<29){fInt=1;fX100=1}if(fInt)o.write_shift(-4,((fX100?d100:data)<<2)+(fX100+2));else throw new Error("unsupported RkNumber "+data)}function parse_RfX(data){var cell={s:{},e:{}};cell.s.r=data.read_shift(4);cell.e.r=data.read_shift(4);cell.s.c=data.read_shift(4);cell.e.c=data.read_shift(4);return cell}function write_RfX(r,o){if(!o)o=new_buf(16);o.write_shift(4,r.s.r);o.write_shift(4,r.e.r);o.write_shift(4,r.s.c);o.write_shift(4,r.e.c);return o}var parse_UncheckedRfX=parse_RfX;var write_UncheckedRfX=write_RfX;function parse_Xnum(data,length){return data.read_shift(8,"f")}function write_Xnum(data,o){return(o||new_buf(8)).write_shift(8,data,"f")}var BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"};var RBErr=evert_num(BErr);function parse_BrtColor(data,length){var out={};var d=data.read_shift(1);var fValidRGB=d&1;var xColorType=d>>>1;var index=data.read_shift(1);var nTS=data.read_shift(2,"i");var bR=data.read_shift(1);var bG=data.read_shift(1);var bB=data.read_shift(1);var bAlpha=data.read_shift(1);switch(xColorType){case 0:out.auto=1;break;case 1:out.index=index;var icv=XLSIcv[index];if(icv)out.rgb=icv[0].toString(16)+icv[1].toString(16)+icv[2].toString(16);break;case 2:out.rgb=bR.toString(16)+bG.toString(16)+bB.toString(16);break;case 3:out.theme=index;break;}if(nTS!=0)out.tint=nTS>0?nTS/32767:nTS/32768;return out}function write_BrtColor(color,o){if(!o)o=new_buf(8);if(!color||color.auto){o.write_shift(4,0);o.write_shift(4,0);return o}if(color.index){o.write_shift(1,2);o.write_shift(1,color.index)}else if(color.theme){o.write_shift(1,6);o.write_shift(1,color.theme)}else{o.write_shift(1,5);o.write_shift(1,0)}var nTS=color.tint||0;if(nTS>0)nTS*=32767;else if(nTS<0)nTS*=32768;o.write_shift(2,nTS);if(!color.rgb){o.write_shift(2,0);o.write_shift(1,0);o.write_shift(1,0)}else{var rgb=color.rgb||"FFFFFF";o.write_shift(1,parseInt(rgb.substr(0,2),16));o.write_shift(1,parseInt(rgb.substr(2,2),16));o.write_shift(1,parseInt(rgb.substr(4,2),16));o.write_shift(1,255)}return o}function parse_FontFlags(data,length,opts){var d=data.read_shift(1);data.l++;var out={fItalic:d&2,fStrikeout:d&8,fOutline:d&16,fShadow:d&32,fCondense:d&64,fExtend:d&128};return out}function write_FontFlags(font,o){if(!o)o=new_buf(2);var grbit=(font.italic?2:0)|(font.strike?8:0)|(font.outline?16:0)|(font.shadow?32:0)|(font.condense?64:0)|(font.extend?128:0);o.write_shift(1,grbit);o.write_shift(1,0);return o}{var VT_I2=2;var VT_I4=3;var VT_BOOL=11;var VT_VARIANT=12;var VT_UI4=19;var VT_UI8=21;var VT_LPSTR=30;var VT_FILETIME=64;var VT_CF=71;var VT_VECTOR=4096;var VT_STRING=80;var VT_USTR=81;var VT_CUSTOM=[VT_STRING,VT_USTR]}var DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"Scale",t:VT_BOOL},12:{n:"HeadingPair",t:VT_VECTOR|VT_VARIANT},13:{n:"DocParts",t:VT_VECTOR|VT_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksDirty",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HLinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{}};var SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"ApplicationName",t:VT_LPSTR},19:{n:"DocumentSecurity",t:VT_I4},255:{}};var SpecialProperties={2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}};(function(){for(var y in SpecialProperties)if(SpecialProperties.hasOwnProperty(y))DocSummaryPIDDSI[y]=SummaryPIDSI[y]=SpecialProperties[y]})();var CountryEnum={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"};var XLSFillPattern=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function rgbify(arr){return arr.map(function(x){return[x>>16&255,x>>8&255,x&255]})}var XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);var ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"TODO","application/vnd.ms-excel.sheetMetadata":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"TODO","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"vba","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};var CT_LIST=function(){var o={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};keys(o).forEach(function(k){if(!o[k].xlsm)o[k].xlsm=o[k].xlsx});keys(o).forEach(function(k){keys(o[k]).forEach(function(v){ct2type[o[k][v]]=k})});return o}();var type2ct=evert_arr(ct2type);XMLNS.CT="http://schemas.openxmlformats.org/package/2006/content-types";function parse_ct(data,opts){var ct={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],TODO:[],xmlns:""};if(!data||!data.match)return ct;var ctext={};(data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0].replace(nsregex,"<")){case"<?xml":break;case"<Types":ct.xmlns=y["xmlns"+(y[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":ctext[y.Extension]=y.ContentType;break;case"<Override":if(ct[ct2type[y.ContentType]]!==undefined)ct[ct2type[y.ContentType]].push(y.PartName);break;}});if(ct.xmlns!==XMLNS.CT)throw new Error("Unknown Namespace: "+ct.xmlns);ct.calcchain=ct.calcchains.length>0?ct.calcchains[0]:"";ct.sst=ct.strs.length>0?ct.strs[0]:"";ct.style=ct.styles.length>0?ct.styles[0]:"";ct.defaults=ctext;delete ct.calcchains;return ct}var CTYPE_XML_ROOT=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi});var CTYPE_DEFAULTS=[["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels",type2ct.rels[0]]].map(function(x){return writextag("Default",null,{Extension:x[0],ContentType:x[1]})});function write_ct(ct,opts){var o=[],v;o[o.length]=XML_HEADER;o[o.length]=CTYPE_XML_ROOT;o=o.concat(CTYPE_DEFAULTS);var f1=function(w){if(ct[w]&&ct[w].length>0){v=ct[w][0];o[o.length]=writextag("Override",null,{PartName:(v[0]=="/"?"":"/")+v,ContentType:CT_LIST[w][opts.bookType||"xlsx"]})}};var f2=function(w){(ct[w]||[]).forEach(function(v){o[o.length]=writextag("Override",null,{PartName:(v[0]=="/"?"":"/")+v,ContentType:CT_LIST[w][opts.bookType||"xlsx"]})})};var f3=function(t){(ct[t]||[]).forEach(function(v){o[o.length]=writextag("Override",null,{PartName:(v[0]=="/"?"":"/")+v,ContentType:type2ct[t][0]})})};f1("workbooks");f2("sheets");f2("charts");f3("themes");["strs","styles"].forEach(f1);["coreprops","extprops","custprops"].forEach(f3);f3("vba");f3("comments");f3("drawings");if(o.length>2){o[o.length]="</Types>";o[1]=o[1].replace("/>",">")}return o.join("")}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(file){var n=file.lastIndexOf("/");return file.substr(0,n+1)+"_rels/"+file.substr(n+1)+".rels"}function parse_rels(data,currentFilePath){if(!data)return data;if(currentFilePath.charAt(0)!=="/"){currentFilePath="/"+currentFilePath}var rels={};var hash={};(data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);if(y[0]==="<Relationship"){var rel={};rel.Type=y.Type;rel.Target=y.Target;rel.Id=y.Id;rel.TargetMode=y.TargetMode;var canonictarget=y.TargetMode==="External"?y.Target:resolve_path(y.Target,currentFilePath);rels[canonictarget]=rel;hash[y.Id]=rel}});rels["!id"]=hash;return rels}XMLNS.RELS="http://schemas.openxmlformats.org/package/2006/relationships";var RELS_ROOT=writextag("Relationships",null,{xmlns:XMLNS.RELS});function write_rels(rels){var o=[XML_HEADER,RELS_ROOT];keys(rels["!id"]).forEach(function(rid){o[o.length]=writextag("Relationship",null,rels["!id"][rid])});if(o.length>2){o[o.length]="</Relationships>";o[1]=o[1].replace("/>",">")}return o.join("")}function add_rels(rels,rId,f,type,relobj){if(!relobj)relobj={};if(!rels["!id"])rels["!id"]={};if(rId<0)for(rId=1;rels["!id"]["rId"+rId];++rId){}relobj.Id="rId"+rId;relobj.Type=type;relobj.Target=f;if(relobj.Type==RELS.HLINK)relobj.TargetMode="External";if(rels["!id"][relobj.Id])throw new Error("Cannot rewrite rId "+rId);rels["!id"][relobj.Id]=relobj;rels[("/"+relobj.Target).replace("//","/")]=relobj;return rId}var CT_ODS="application/vnd.oasis.opendocument.spreadsheet";function parse_manifest(d,opts){var str=xlml_normalize(d);var Rn;var FEtag;while(Rn=xlmlregex.exec(str))switch(Rn[3]){case"manifest":break;case"file-entry":FEtag=parsexmltag(Rn[0],false);if(FEtag.path=="/"&&FEtag.type!==CT_ODS)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":;case"algorithm":;case"start-key-generation":;case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(opts&&opts.WTF)throw Rn;}}function write_manifest(manifest,opts){var o=[XML_HEADER];o.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n');o.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var i=0;i<manifest.length;++i)o.push('  <manifest:file-entry manifest:full-path="'+manifest[i][0]+'" manifest:media-type="'+manifest[i][1]+'"/>\n');o.push("</manifest:manifest>");return o.join("")}function write_rdf_type(file,res,tag){return['  <rdf:Description rdf:about="'+file+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(tag||"odf")+"#"+res+'"/>\n',"  </rdf:Description>\n"].join("")}function write_rdf_has(base,file){return['  <rdf:Description rdf:about="'+base+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+file+'"/>\n',"  </rdf:Description>\n"].join("")}function write_rdf(rdf,opts){var o=[XML_HEADER];o.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var i=0;i!=rdf.length;++i){o.push(write_rdf_type(rdf[i][0],rdf[i][1]));o.push(write_rdf_has("",rdf[i][0]))}o.push(write_rdf_type("","Document","pkg"));o.push("</rdf:RDF>");return o.join("")}var write_meta_ods=function(){var payload='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>Sheet'+"JS "+XLSX.version+"</meta:generator></office:meta></office:document-meta>";return function wmo(wb,opts){return payload}}();var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];XMLNS.CORE_PROPS="http://schemas.openxmlformats.org/package/2006/metadata/core-properties";RELS.CORE_PROPS="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties";var CORE_PROPS_REGEX=function(){var r=new Array(CORE_PROPS.length);for(var i=0;i<CORE_PROPS.length;++i){var f=CORE_PROPS[i];var g="(?:"+f[0].substr(0,f[0].indexOf(":"))+":)"+f[0].substr(f[0].indexOf(":")+1);r[i]=new RegExp("<"+g+"[^>]*>([\\s\\S]*?)</"+g+">")}return r}();function parse_core_props(data){var p={};for(var i=0;i<CORE_PROPS.length;++i){var f=CORE_PROPS[i],cur=data.match(CORE_PROPS_REGEX[i]);if(cur!=null&&cur.length>0)p[f[1]]=cur[1];if(f[2]==="date"&&p[f[1]])p[f[1]]=parseDate(p[f[1]])}return p}var CORE_PROPS_XML_ROOT=writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi});function cp_doit(f,g,h,o,p){if(p[f]!=null||g==null||g==="")return;p[f]=g;o[o.length]=h?writextag(f,g,h):writetag(f,g)}function write_core_props(cp,_opts){var opts=_opts||{};var o=[XML_HEADER,CORE_PROPS_XML_ROOT],p={};if(!cp&&!opts.Props)return o.join("");if(cp){if(cp.CreatedDate!=null)cp_doit("dcterms:created",typeof cp.CreatedDate==="string"?cp.CreatedDate:write_w3cdtf(cp.CreatedDate,opts.WTF),{"xsi:type":"dcterms:W3CDTF"},o,p);if(cp.ModifiedDate!=null)cp_doit("dcterms:modified",typeof cp.ModifiedDate==="string"?cp.ModifiedDate:write_w3cdtf(cp.ModifiedDate,opts.WTF),{"xsi:type":"dcterms:W3CDTF"},o,p)}for(var i=0;i!=CORE_PROPS.length;++i){var f=CORE_PROPS[i];var v=opts.Props&&opts.Props[f[1]]!=null?opts.Props[f[1]]:cp?cp[f[1]]:null;if(v===true)v="1";else if(v===false)v="0";else if(typeof v=="number")v=String(v);if(v!=null)cp_doit(f[0],v,null,o,p)}if(o.length>2){o[o.length]="</cp:coreProperties>";o[1]=o[1].replace("/>",">")}return o.join("")}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];XMLNS.EXT_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties";RELS.EXT_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties";function parse_ext_props(data,p){var q={};if(!p)p={};EXT_PROPS.forEach(function(f){switch(f[2]){case"string":p[f[1]]=(data.match(matchtag(f[0]))||[])[1];break;case"bool":p[f[1]]=(data.match(matchtag(f[0]))||[])[1]==="true";break;case"raw":var cur=data.match(new RegExp("<"+f[0]+"[^>]*>([\\s\\S]*?)</"+f[0]+">"));if(cur&&cur.length>0)q[f[1]]=cur[1];break;}});if(q.HeadingPairs&&q.TitlesOfParts){var v=parseVector(q.HeadingPairs);var parts=parseVector(q.TitlesOfParts).map(function(x){return x.v});var idx=0,len=0;for(var i=0;i!==v.length;i+=2){len=+v[i+1].v;switch(v[i].v){case"Worksheets":;case"工作表":;case"Листы":;case"أوراق العمل":;case"ワークシート":;case"גליונות עבודה":;case"Arbeitsblätter":;case"Çalışma Sayfaları":;case"Feuilles de calcul":;case"Fogli di lavoro":;case"Folhas de cálculo":;case"Planilhas":;case"Regneark":;case"Werkbladen":p.Worksheets=len;p.SheetNames=parts.slice(idx,idx+len);break;case"Named Ranges":;case"Benannte Bereiche":;case"Navngivne områder":p.NamedRanges=len;p.DefinedNames=parts.slice(idx,idx+len);break;case"Charts":;case"Diagramme":p.Chartsheets=len;p.ChartNames=parts.slice(idx,idx+len);break;}idx+=len}}return p}var EXT_PROPS_XML_ROOT=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt});function write_ext_props(cp,opts){var o=[],p={},W=writextag;if(!cp)cp={};cp.Application="SheetJS";o[o.length]=XML_HEADER;o[o.length]=EXT_PROPS_XML_ROOT;EXT_PROPS.forEach(function(f){if(cp[f[1]]===undefined)return;var v;switch(f[2]){case"string":v=String(cp[f[1]]);break;case"bool":v=cp[f[1]]?"true":"false";break;}if(v!==undefined)o[o.length]=W(f[0],v)});o[o.length]=W("HeadingPairs",W("vt:vector",W("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+W("vt:variant",W("vt:i4",String(cp.Worksheets))),{size:2,baseType:"variant"}));o[o.length]=W("TitlesOfParts",W("vt:vector",cp.SheetNames.map(function(s){return"<vt:lpstr>"+escapexml(s)+"</vt:lpstr>"}).join(""),{size:cp.Worksheets,baseType:"lpstr"}));if(o.length>2){o[o.length]="</Properties>";o[1]=o[1].replace("/>",">")}return o.join("")}XMLNS.CUST_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/custom-properties";RELS.CUST_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties";var custregex=/<[^>]+>[^<]*/g;function parse_cust_props(data,opts){var p={},name="";var m=data.match(custregex);if(m)for(var i=0;i!=m.length;++i){var x=m[i],y=parsexmltag(x);switch(y[0]){case"<?xml":break;case"<Properties":break;case"<property":name=y.name;break;case"</property>":name=null;break;default:if(x.indexOf("<vt:")===0){var toks=x.split(">");var type=toks[0].substring(4),text=toks[1];switch(type){case"lpstr":;case"bstr":;case"lpwstr":p[name]=unescapexml(text);break;case"bool":p[name]=parsexmlbool(text,"<vt:bool>");break;case"i1":;case"i2":;case"i4":;case"i8":;case"int":;case"uint":p[name]=parseInt(text,10);break;case"r4":;case"r8":;case"decimal":p[name]=parseFloat(text);break;case"filetime":;case"date":p[name]=parseDate(text);break;case"cy":;case"error":p[name]=unescapexml(text);break;default:if(opts.WTF&&typeof console!=="undefined")console.warn("Unexpected",x,type,toks);}}else if(x.substr(0,2)==="</"){}else if(opts.WTF)throw new Error(x);}}return p}var CUST_PROPS_XML_ROOT=writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt});function write_cust_props(cp,opts){var o=[XML_HEADER,CUST_PROPS_XML_ROOT];if(!cp)return o.join("");var pid=1;keys(cp).forEach(function custprop(k){++pid;o[o.length]=writextag("property",write_vt(cp[k]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:pid,name:k})});if(o.length>2){o[o.length]="</Properties>";o[1]=o[1].replace("/>",">")}return o.join("")}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};var evert_XLMLDPM=evert(XLMLDocPropsMap);function xlml_set_prop(Props,tag,val){tag=evert_XLMLDPM[tag]||tag;Props[tag]=val}function xlml_write_docprops(Props,opts){var o=[];keys(XLMLDocPropsMap).map(function(m){for(var i=0;i<CORE_PROPS.length;++i)if(CORE_PROPS[i][1]==m)return CORE_PROPS[i];for(i=0;i<EXT_PROPS.length;++i)if(EXT_PROPS[i][1]==m)return EXT_PROPS[i];throw m}).forEach(function(p){if(Props[p[1]]==null)return;var m=opts&&opts.Props&&opts.Props[p[1]]!=null?opts.Props[p[1]]:Props[p[1]];switch(p[2]){case"date":m=new Date(m).toISOString().replace(/\.\d*Z/,"Z");break;}if(typeof m=="number")m=String(m);else if(m===true||m===false){m=m?"1":"0"}else if(m instanceof Date)m=new Date(m).toISOString().replace(/\.\d*Z/,"");o.push(writetag(XLMLDocPropsMap[p[1]]||p[1],m))});return writextag("DocumentProperties",o.join(""),{xmlns:XLMLNS.o})}function xlml_write_custprops(Props,Custprops,opts){var BLACKLIST=["Worksheets","SheetNames"];var T="CustomDocumentProperties";var o=[];if(Props)keys(Props).forEach(function(k){if(!Props.hasOwnProperty(k))return;for(var i=0;i<CORE_PROPS.length;++i)if(k==CORE_PROPS[i][1])return;for(i=0;i<EXT_PROPS.length;++i)if(k==EXT_PROPS[i][1])return;for(i=0;i<BLACKLIST.length;++i)if(k==BLACKLIST[i])return;var m=Props[k];var t="string";if(typeof m=="number"){t="float";m=String(m)}else if(m===true||m===false){t="boolean";m=m?"1":"0"}else m=String(m);o.push(writextag(escapexmltag(k),m,{"dt:dt":t}))});if(Custprops)keys(Custprops).forEach(function(k){if(!Custprops.hasOwnProperty(k))return;var m=Custprops[k];var t="string";if(typeof m=="number"){t="float";m=String(m)}else if(m===true||m===false){t="boolean";m=m?"1":"0"}else if(m instanceof Date){t="dateTime.tz";m=m.toISOString()}else m=String(m);o.push(writextag(escapexmltag(k),m,{"dt:dt":t}))});return"<"+T+' xmlns="'+XLMLNS.o+'">'+o.join("")+"</"+T+">"}function parse_FILETIME(blob){var dwLowDateTime=blob.read_shift(4),dwHighDateTime=blob.read_shift(4);return new Date((dwHighDateTime/1e7*Math.pow(2,32)+dwLowDateTime/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function parse_lpstr(blob,type,pad){var str=blob.read_shift(0,"lpstr");if(pad)blob.l+=4-(str.length+1&3)&3;return str}function parse_lpwstr(blob,type,pad){var str=blob.read_shift(0,"lpwstr");if(pad)blob.l+=4-(str.length+1&3)&3;return str}function parse_VtStringBase(blob,stringType,pad){if(stringType===31)return parse_lpwstr(blob);return parse_lpstr(blob,stringType,pad)}function parse_VtString(blob,t,pad){return parse_VtStringBase(blob,t,pad===false?0:4)}function parse_VtUnalignedString(blob,t){if(!t)throw new Error("dafuq?");return parse_VtStringBase(blob,t,0)}function parse_VtVecUnalignedLpstrValue(blob){var length=blob.read_shift(4);var ret=[];for(var i=0;i!=length;++i)ret[i]=blob.read_shift(0,"lpstr");return ret}function parse_VtVecUnalignedLpstr(blob){return parse_VtVecUnalignedLpstrValue(blob)}function parse_VtHeadingPair(blob){var headingString=parse_TypedPropertyValue(blob,VT_USTR);var headerParts=parse_TypedPropertyValue(blob,VT_I4);return[headingString,headerParts]}function parse_VtVecHeadingPairValue(blob){var cElements=blob.read_shift(4);var out=[];for(var i=0;i!=cElements/2;++i)out.push(parse_VtHeadingPair(blob));return out}function parse_VtVecHeadingPair(blob){return parse_VtVecHeadingPairValue(blob)}function parse_dictionary(blob,CodePage){var cnt=blob.read_shift(4);var dict={};for(var j=0;j!=cnt;++j){var pid=blob.read_shift(4);var len=blob.read_shift(4);dict[pid]=blob.read_shift(len,CodePage===1200?"utf16le":"utf8").replace(chr0,"").replace(chr1,"!")}if(blob.l&3)blob.l=blob.l>>2+1<<2;return dict}function parse_BLOB(blob){var size=blob.read_shift(4);var bytes=blob.slice(blob.l,blob.l+size);if((size&3)>0)blob.l+=4-(size&3)&3;return bytes}function parse_ClipboardData(blob){var o={};o.Size=blob.read_shift(4);blob.l+=o.Size;return o}function parse_VtVector(blob,cb){}function parse_TypedPropertyValue(blob,type,_opts){var t=blob.read_shift(2),ret,opts=_opts||{};blob.l+=2;if(type!==VT_VARIANT)if(t!==type&&VT_CUSTOM.indexOf(type)===-1)throw new Error("Expected type "+type+" saw "+t);switch(type===VT_VARIANT?t:type){case 2:ret=blob.read_shift(2,"i");if(!opts.raw)blob.l+=2;return ret;case 3:ret=blob.read_shift(4,"i");return ret;case 11:return blob.read_shift(4)!==0;case 19:ret=blob.read_shift(4);return ret;case 30:return parse_lpstr(blob,t,4).replace(chr0,"");case 31:return parse_lpwstr(blob);case 64:return parse_FILETIME(blob);case 65:return parse_BLOB(blob);case 71:return parse_ClipboardData(blob);case 80:return parse_VtString(blob,t,!opts.raw&&4).replace(chr0,"");case 81:return parse_VtUnalignedString(blob,t).replace(chr0,"");case 4108:return parse_VtVecHeadingPair(blob);case 4126:return parse_VtVecUnalignedLpstr(blob);default:throw new Error("TypedPropertyValue unrecognized type "+type+" "+t);}}function parse_PropertySet(blob,PIDSI){var start_addr=blob.l;var size=blob.read_shift(4);var NumProps=blob.read_shift(4);var Props=[],i=0;var CodePage=0;var Dictionary=-1,DictObj={};for(i=0;i!=NumProps;++i){var PropID=blob.read_shift(4);var Offset=blob.read_shift(4);Props[i]=[PropID,Offset+start_addr]}var PropH={};for(i=0;i!=NumProps;++i){if(blob.l!==Props[i][1]){var fail=true;if(i>0&&PIDSI)switch(PIDSI[Props[i-1][0]].t){case 2:if(blob.l+2===Props[i][1]){blob.l+=2;fail=false}break;case 80:if(blob.l<=Props[i][1]){blob.l=Props[i][1];fail=false}break;case 4108:if(blob.l<=Props[i][1]){blob.l=Props[i][1];fail=false}break;}if(!PIDSI&&blob.l<=Props[i][1]){fail=false;blob.l=Props[i][1]}if(fail)throw new Error("Read Error: Expected address "+Props[i][1]+" at "+blob.l+" :"+i)}if(PIDSI){var piddsi=PIDSI[Props[i][0]];PropH[piddsi.n]=parse_TypedPropertyValue(blob,piddsi.t,{raw:true});if(piddsi.p==="version")PropH[piddsi.n]=String(PropH[piddsi.n]>>16)+"."+String(PropH[piddsi.n]&65535);if(piddsi.n=="CodePage")switch(PropH[piddsi.n]){case 0:PropH[piddsi.n]=1252;case 874:;case 932:;case 936:;case 949:;case 950:;case 1250:;case 1251:;case 1253:;case 1254:;case 1255:;case 1256:;case 1257:;case 1258:;case 1e4:;case 1200:;case 1201:;case 1252:;case 65e3:;case-536:;case 65001:;case-535:set_cp(CodePage=PropH[piddsi.n]);break;default:throw new Error("Unsupported CodePage: "+PropH[piddsi.n]);}}else{if(Props[i][0]===1){CodePage=PropH.CodePage=parse_TypedPropertyValue(blob,VT_I2);set_cp(CodePage);if(Dictionary!==-1){var oldpos=blob.l;blob.l=Props[Dictionary][1];DictObj=parse_dictionary(blob,CodePage);blob.l=oldpos}}else if(Props[i][0]===0){if(CodePage===0){Dictionary=i;blob.l=Props[i+1][1];continue}DictObj=parse_dictionary(blob,CodePage)}else{var name=DictObj[Props[i][0]];var val;switch(blob[blob.l]){case 65:blob.l+=4;val=parse_BLOB(blob);break;case 30:blob.l+=4;val=parse_VtString(blob,blob[blob.l-4]);break;case 31:blob.l+=4;val=parse_VtString(blob,blob[blob.l-4]);break;case 3:blob.l+=4;val=blob.read_shift(4,"i");break;case 19:blob.l+=4;val=blob.read_shift(4);break;case 5:blob.l+=4;val=blob.read_shift(8,"f");break;case 11:blob.l+=4;val=parsebool(blob,4);break;case 64:blob.l+=4;val=parseDate(parse_FILETIME(blob));break;default:throw new Error("unparsed value: "+blob[blob.l]);}PropH[name]=val}}}blob.l=start_addr+size;return PropH}function parse_PropertySetStream(file,PIDSI){var blob=file.content;prep_blob(blob,0);var NumSets,FMTID0,FMTID1,Offset0,Offset1=0;blob.chk("feff","Byte Order: ");var vers=blob.read_shift(2);var SystemIdentifier=blob.read_shift(4);blob.chk(CFB.utils.consts.HEADER_CLSID,"CLSID: ");NumSets=blob.read_shift(4);if(NumSets!==1&&NumSets!==2)throw new Error("Unrecognized #Sets: "+NumSets);FMTID0=blob.read_shift(16);Offset0=blob.read_shift(4);if(NumSets===1&&Offset0!==blob.l)throw new Error("Length mismatch: "+Offset0+" !== "+blob.l);else if(NumSets===2){FMTID1=blob.read_shift(16);Offset1=blob.read_shift(4)}var PSet0=parse_PropertySet(blob,PIDSI);var rval={SystemIdentifier:SystemIdentifier};for(var y in PSet0)rval[y]=PSet0[y];rval.FMTID=FMTID0;if(NumSets===1)return rval;if(blob.l!==Offset1)throw new Error("Length mismatch 2: "+blob.l+" !== "+Offset1);var PSet1;try{PSet1=parse_PropertySet(blob,null)}catch(e){}for(y in PSet1)rval[y]=PSet1[y];rval.FMTID=[FMTID0,FMTID1];return rval}function parsenoop2(blob,length){blob.read_shift(length);return null}function parslurp(blob,length,cb){var arr=[],target=blob.l+length;while(blob.l<target)arr.push(cb(blob,target-blob.l));if(target!==blob.l)throw new Error("Slurp error");return arr}function parsebool(blob,length){return blob.read_shift(length)===1}function parseuint16(blob){return blob.read_shift(2,"u")}function parseuint16a(blob,length){return parslurp(blob,length,parseuint16)}var parse_Boolean=parsebool;function parse_Bes(blob){var v=blob.read_shift(1),t=blob.read_shift(1);return t===1?v:v===1}function parse_ShortXLUnicodeString(blob,length,opts){var cch=blob.read_shift(opts&&opts.biff>=12?2:1);var width=1,encoding="sbcs-cont";var cp=current_codepage;if(opts&&opts.biff>=8)current_codepage=1200;if(!opts||opts.biff==8){var fHighByte=blob.read_shift(1);if(fHighByte){width=2;encoding="dbcs-cont"}}else if(opts.biff==12){width=2;encoding="wstr"}var o=cch?blob.read_shift(cch,encoding):"";current_codepage=cp;return o}function parse_XLUnicodeRichExtendedString(blob){var cp=current_codepage;current_codepage=1200;var cch=blob.read_shift(2),flags=blob.read_shift(1);var fHighByte=flags&1,fExtSt=flags&4,fRichSt=flags&8;var width=1+(flags&1);var cRun=0,cbExtRst;var z={};if(fRichSt)cRun=blob.read_shift(2);if(fExtSt)cbExtRst=blob.read_shift(4);var encoding=flags&1?"dbcs-cont":"sbcs-cont";var msg=cch===0?"":blob.read_shift(cch,encoding);if(fRichSt)blob.l+=4*cRun;if(fExtSt)blob.l+=cbExtRst;z.t=msg;if(!fRichSt){z.raw="<t>"+z.t+"</t>";z.r=z.t}current_codepage=cp;return z}function parse_XLUnicodeStringNoCch(blob,cch,opts){var retval;if(opts){if(opts.biff>=2&&opts.biff<=5)return blob.read_shift(cch,"sbcs-cont");if(opts.biff>=12)return blob.read_shift(cch,"dbcs-cont")}var fHighByte=blob.read_shift(1);if(fHighByte===0){retval=blob.read_shift(cch,"sbcs-cont")}else{retval=blob.read_shift(cch,"dbcs-cont")}return retval}function parse_XLUnicodeString(blob,length,opts){var cch=blob.read_shift(opts&&opts.biff==2?1:2);if(cch===0){blob.l++;return""}return parse_XLUnicodeStringNoCch(blob,cch,opts)}function parse_XLUnicodeString2(blob,length,opts){if(opts.biff>5)return parse_XLUnicodeString(blob,length,opts);var cch=blob.read_shift(1);if(cch===0){blob.l++;return""}return blob.read_shift(cch,"sbcs-cont")}var parse_ControlInfo=parsenoop;var parse_URLMoniker=function(blob){var len=blob.read_shift(4),start=blob.l;var extra=false;if(len>24){blob.l+=len-24;if(blob.read_shift(16)==="795881f43b1d7f48af2c825dc4852763")extra=true;blob.l=start}var url=blob.read_shift((extra?len-24:len)>>1,"utf16le").replace(chr0,"");if(extra)blob.l+=24;return url};var parse_FileMoniker=function(blob,length){var cAnti=blob.read_shift(2);var ansiLength=blob.read_shift(4);var ansiPath=blob.read_shift(ansiLength,"cstr");var endServer=blob.read_shift(2);var versionNumber=blob.read_shift(2);var cbUnicodePathSize=blob.read_shift(4);if(cbUnicodePathSize===0)return ansiPath.replace(/\\/g,"/");var cbUnicodePathBytes=blob.read_shift(4);var usKeyValue=blob.read_shift(2);var unicodePath=blob.read_shift(cbUnicodePathBytes>>1,"utf16le").replace(chr0,"");return unicodePath};var parse_HyperlinkMoniker=function(blob,length){var clsid=blob.read_shift(16);length-=16;switch(clsid){case"e0c9ea79f9bace118c8200aa004ba90b":return parse_URLMoniker(blob,length);case"0303000000000000c000000000000046":return parse_FileMoniker(blob,length);default:throw new Error("Unsupported Moniker "+clsid);}};var parse_HyperlinkString=function(blob,length){var len=blob.read_shift(4);var o=blob.read_shift(len,"utf16le").replace(chr0,"");return o};var parse_Hyperlink=function(blob,length){var end=blob.l+length;var sVer=blob.read_shift(4);if(sVer!==2)throw new Error("Unrecognized streamVersion: "+sVer);var flags=blob.read_shift(2);blob.l+=2;var displayName,targetFrameName,moniker,oleMoniker,location,guid,fileTime;if(flags&16)displayName=parse_HyperlinkString(blob,end-blob.l);if(flags&128)targetFrameName=parse_HyperlinkString(blob,end-blob.l);if((flags&257)===257)moniker=parse_HyperlinkString(blob,end-blob.l);if((flags&257)===1)oleMoniker=parse_HyperlinkMoniker(blob,end-blob.l);if(flags&8)location=parse_HyperlinkString(blob,end-blob.l);if(flags&32)guid=blob.read_shift(16);if(flags&64)fileTime=parse_FILETIME(blob,8);blob.l=end;var target=targetFrameName||moniker||oleMoniker;if(location)target+="#"+location;return{Target:target}};function parse_LongRGBA(blob,length){var r=blob.read_shift(1),g=blob.read_shift(1),b=blob.read_shift(1),a=blob.read_shift(1);return[r,g,b,a]}function parse_LongRGB(blob,length){var x=parse_LongRGBA(blob,length);x[3]=0;return x}function parse_XLSCell(blob,length){var rw=blob.read_shift(2);var col=blob.read_shift(2);var ixfe=blob.read_shift(2);return{r:rw,c:col,ixfe:ixfe}}function parse_frtHeader(blob){var rt=blob.read_shift(2);var flags=blob.read_shift(2);blob.l+=8;return{type:rt,flags:flags}}function parse_OptXLUnicodeString(blob,length,opts){return length===0?"":parse_XLUnicodeString2(blob,length,opts)}var parse_HideObjEnum=parseuint16;function parse_XTI(blob,length){var iSupBook=blob.read_shift(2),itabFirst=blob.read_shift(2,"i"),itabLast=blob.read_shift(2,"i");return[iSupBook,itabFirst,itabLast]}function parse_RkRec(blob,length){var ixfe=blob.read_shift(2);var RK=parse_RkNumber(blob);return[ixfe,RK]}function parse_AddinUdf(blob,length,opts){blob.l+=4;length-=4;var l=blob.l+length;var udfName=parse_ShortXLUnicodeString(blob,length,opts);var cb=blob.read_shift(2);l-=blob.l;if(cb!==l)throw new Error("Malformed AddinUdf: padding = "+l+" != "+cb);blob.l+=cb;return udfName}function parse_Ref8U(blob,length){var rwFirst=blob.read_shift(2);var rwLast=blob.read_shift(2);var colFirst=blob.read_shift(2);var colLast=blob.read_shift(2);return{s:{c:colFirst,r:rwFirst},e:{c:colLast,r:rwLast}}}function parse_RefU(blob,length){var rwFirst=blob.read_shift(2);var rwLast=blob.read_shift(2);var colFirst=blob.read_shift(1);var colLast=blob.read_shift(1);return{s:{c:colFirst,r:rwFirst},e:{c:colLast,r:rwLast}}}var parse_Ref=parse_RefU;function parse_FtCmo(blob,length){blob.l+=4;var ot=blob.read_shift(2);var id=blob.read_shift(2);var flags=blob.read_shift(2);blob.l+=12;return[id,ot,flags]}function parse_FtNts(blob,length){var out={};blob.l+=4;blob.l+=16;out.fSharedNote=blob.read_shift(2);blob.l+=4;return out}function parse_FtCf(blob,length){var out={};blob.l+=4;blob.cf=blob.read_shift(2);return out}function parse_FtSkip(blob,length){blob.l+=2;blob.l+=blob.read_shift(2)}var FtTab={0:parse_FtSkip,4:parse_FtSkip,5:parse_FtSkip,6:parse_FtSkip,7:parse_FtCf,8:parse_FtSkip,9:parse_FtSkip,10:parse_FtSkip,11:parse_FtSkip,12:parse_FtSkip,13:parse_FtNts,14:parse_FtSkip,15:parse_FtSkip,16:parse_FtSkip,17:parse_FtSkip,18:parse_FtSkip,19:parse_FtSkip,20:parse_FtSkip,21:parse_FtCmo};function parse_FtArray(blob,length,ot){var tgt=blob.l+length;var fts=[];while(blob.l<tgt){var ft=blob.read_shift(2);blob.l-=2;try{fts.push(FtTab[ft](blob,tgt-blob.l))}catch(e){blob.l=tgt;return fts}}if(blob.l!=tgt)blob.l=tgt;return fts}var parse_FontIndex=parseuint16;function parse_BOF(blob,length){var o={BIFFVer:0,dt:0};o.BIFFVer=blob.read_shift(2);length-=2;if(length>=2){o.dt=blob.read_shift(2);blob.l-=2}switch(o.BIFFVer){case 1536:;case 1280:;case 2:;case 7:break;default:if(length>6)throw new Error("Unexpected BIFF Ver "+o.BIFFVer);}blob.read_shift(length);return o}function parse_InterfaceHdr(blob,length){if(length===0)return 1200;var q;if((q=blob.read_shift(2))!==1200){}return 1200}function parse_WriteAccess(blob,length,opts){if(opts.enc){blob.l+=length;return""}var l=blob.l;var UserName=parse_XLUnicodeString(blob,0,opts);blob.read_shift(length+l-blob.l);return UserName}function parse_BoundSheet8(blob,length,opts){var pos=blob.read_shift(4);var hidden=blob.read_shift(1)&3;var dt=blob.read_shift(1);switch(dt){case 0:dt="Worksheet";break;case 1:dt="Macrosheet";break;case 2:dt="Chartsheet";break;case 6:dt="VBAModule";break;}var name=parse_ShortXLUnicodeString(blob,0,opts);if(name.length===0)name="Sheet1";return{pos:pos,hs:hidden,dt:dt,name:name}}function parse_SST(blob,length){var cnt=blob.read_shift(4);var ucnt=blob.read_shift(4);var strs=[];for(var i=0;i!=ucnt;++i){strs.push(parse_XLUnicodeRichExtendedString(blob))}strs.Count=cnt;strs.Unique=ucnt;return strs}function parse_ExtSST(blob,length){var extsst={};extsst.dsst=blob.read_shift(2);blob.l+=length-2;return extsst}function parse_Row(blob,length){var z={};z.r=blob.read_shift(2);z.c=blob.read_shift(2);z.cnt=blob.read_shift(2)-z.c;var miyRw=blob.read_shift(2);blob.l+=4;var flags=blob.read_shift(1);blob.l+=3;if(flags&7)z.level=flags&7;if(flags&32)z.hidden=true;if(flags&64)z.hpt=miyRw/20;return z}function parse_ForceFullCalculation(blob,length){var header=parse_frtHeader(blob);if(header.type!=2211)throw new Error("Invalid Future Record "+header.type);var fullcalc=blob.read_shift(4);return fullcalc!==0}var parse_CompressPictures=parsenoop2;function parse_RecalcId(blob,length){blob.read_shift(2);return blob.read_shift(4)}function parse_DefaultRowHeight(blob,length,opts){var f=0;if(!(opts&&opts.biff==2)){f=blob.read_shift(2)}var miyRw=blob.read_shift(2);if(opts&&opts.biff==2){f=1-(miyRw>>15);miyRw&=32767}var fl={Unsynced:f&1,DyZero:(f&2)>>1,ExAsc:(f&4)>>2,ExDsc:(f&8)>>3};return[fl,miyRw]}function parse_Window1(blob,length){var xWn=blob.read_shift(2),yWn=blob.read_shift(2),dxWn=blob.read_shift(2),dyWn=blob.read_shift(2);var flags=blob.read_shift(2),iTabCur=blob.read_shift(2),iTabFirst=blob.read_shift(2);var ctabSel=blob.read_shift(2),wTabRatio=blob.read_shift(2);return{Pos:[xWn,yWn],Dim:[dxWn,dyWn],Flags:flags,CurTab:iTabCur,FirstTab:iTabFirst,Selected:ctabSel,TabRatio:wTabRatio}}function parse_Font(blob,length,opts){var o={dyHeight:blob.read_shift(2),fl:blob.read_shift(2)};switch(opts&&opts.biff||8){case 2:break;case 3:;case 4:blob.l+=2;break;default:blob.l+=10;break;}o.name=parse_ShortXLUnicodeString(blob,0,opts);return o}function parse_LabelSst(blob,length){var cell=parse_XLSCell(blob);cell.isst=blob.read_shift(4);return cell}function parse_Label(blob,length,opts){var target=blob.l+length;var cell=parse_XLSCell(blob,6);if(opts.biff==2)blob.l++;var str=parse_XLUnicodeString(blob,target-blob.l,opts);cell.val=str;return cell}function parse_Format(blob,length,opts){var ifmt=blob.read_shift(2);var fmtstr=parse_XLUnicodeString2(blob,0,opts);return[ifmt,fmtstr]}var parse_BIFF2Format=parse_XLUnicodeString2;function parse_Dimensions(blob,length,opts){var end=blob.l+length;var w=opts.biff==8||!opts.biff?4:2;var r=blob.read_shift(w),R=blob.read_shift(w);var c=blob.read_shift(2),C=blob.read_shift(2);blob.l=end;return{s:{r:r,c:c},e:{r:R,c:C}}}function parse_RK(blob,length){var rw=blob.read_shift(2),col=blob.read_shift(2);var rkrec=parse_RkRec(blob);return{r:rw,c:col,ixfe:rkrec[0],rknum:rkrec[1]}}function parse_MulRk(blob,length){var target=blob.l+length-2;var rw=blob.read_shift(2),col=blob.read_shift(2);var rkrecs=[];while(blob.l<target)rkrecs.push(parse_RkRec(blob));if(blob.l!==target)throw new Error("MulRK read error");var lastcol=blob.read_shift(2);if(rkrecs.length!=lastcol-col+1)throw new Error("MulRK length mismatch");return{r:rw,c:col,C:lastcol,rkrec:rkrecs}}function parse_MulBlank(blob,length){var target=blob.l+length-2;var rw=blob.read_shift(2),col=blob.read_shift(2);var ixfes=[];while(blob.l<target)ixfes.push(blob.read_shift(2));if(blob.l!==target)throw new Error("MulBlank read error");var lastcol=blob.read_shift(2);if(ixfes.length!=lastcol-col+1)throw new Error("MulBlank length mismatch");return{r:rw,c:col,C:lastcol,ixfe:ixfes}}function parse_CellStyleXF(blob,length,style,opts){var o={};var a=blob.read_shift(4),b=blob.read_shift(4);var c=blob.read_shift(4),d=blob.read_shift(2);o.patternType=XLSFillPattern[c>>26];if(!opts.cellStyles)return o;o.alc=a&7;o.fWrap=a>>3&1;o.alcV=a>>4&7;o.fJustLast=a>>7&1;o.trot=a>>8&255;o.cIndent=a>>16&15;o.fShrinkToFit=a>>20&1;o.iReadOrder=a>>22&2;o.fAtrNum=a>>26&1;o.fAtrFnt=a>>27&1;o.fAtrAlc=a>>28&1;o.fAtrBdr=a>>29&1;o.fAtrPat=a>>30&1;o.fAtrProt=a>>31&1;o.dgLeft=b&15;o.dgRight=b>>4&15;o.dgTop=b>>8&15;o.dgBottom=b>>12&15;o.icvLeft=b>>16&127;o.icvRight=b>>23&127;o.grbitDiag=b>>30&3;o.icvTop=c&127;o.icvBottom=c>>7&127;o.icvDiag=c>>14&127;o.dgDiag=c>>21&15;o.icvFore=d&127;o.icvBack=d>>7&127;o.fsxButton=d>>14&1;return o}function parse_CellXF(blob,length,opts){return parse_CellStyleXF(blob,length,0,opts)}function parse_StyleXF(blob,length,opts){return parse_CellStyleXF(blob,length,1,opts)}function parse_XF(blob,length,opts){var o={};o.ifnt=blob.read_shift(2);o.ifmt=blob.read_shift(2);o.flags=blob.read_shift(2);o.fStyle=o.flags>>2&1;length-=6;o.data=parse_CellStyleXF(blob,length,o.fStyle,opts);return o}function parse_Guts(blob,length){blob.l+=4;var out=[blob.read_shift(2),blob.read_shift(2)];if(out[0]!==0)out[0]--;if(out[1]!==0)out[1]--;if(out[0]>7||out[1]>7)throw new Error("Bad Gutters: "+out.join("|"));return out}function parse_BoolErr(blob,length,opts){var cell=parse_XLSCell(blob,6);if(opts.biff==2)++blob.l;var val=parse_Bes(blob,2);cell.val=val;cell.t=val===true||val===false?"b":"e";return cell}function parse_Number(blob,length){var cell=parse_XLSCell(blob,6);var xnum=parse_Xnum(blob,8);cell.val=xnum;return cell}var parse_XLHeaderFooter=parse_OptXLUnicodeString;function parse_SupBook(blob,length,opts){var end=blob.l+length;var ctab=blob.read_shift(2);var cch=blob.read_shift(2);opts.sbcch=cch;if(cch==1025||cch==14849)return[cch,ctab];if(cch<1||cch>255)throw new Error("Unexpected SupBook type: "+cch);var virtPath=parse_XLUnicodeStringNoCch(blob,cch);var rgst=blob.read_shift(end-blob.l);return[cch,ctab,virtPath,rgst]}function parse_ExternName(blob,length,opts){var flags=blob.read_shift(2);var body;var o={fBuiltIn:flags&1,fWantAdvise:flags>>>1&1,fWantPict:flags>>>2&1,fOle:flags>>>3&1,fOleLink:flags>>>4&1,cf:flags>>>5&1023,fIcon:flags>>>15&1};if(opts.sbcch===14849)body=parse_AddinUdf(blob,length-2,opts);o.body=body||blob.read_shift(length-2);if(typeof body==="string")o.Name=body;return o}var XLSLblBuiltIn=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function parse_Lbl(blob,length,opts){var target=blob.l+length;var flags=blob.read_shift(2);var chKey=blob.read_shift(1);var cch=blob.read_shift(1);var cce=blob.read_shift(opts&&opts.biff==2?1:2);var itab=0;if(!opts||opts.biff>=5){blob.l+=2;itab=blob.read_shift(2);blob.l+=4}var name=parse_XLUnicodeStringNoCch(blob,cch,opts);if(flags&32)name=XLSLblBuiltIn[name.charCodeAt(0)];var npflen=target-blob.l;if(opts&&opts.biff==2)--npflen;var rgce=target==blob.l||cce==0?[]:parse_NameParsedFormula(blob,npflen,opts,cce);return{chKey:chKey,Name:name,itab:itab,rgce:rgce}}function parse_ExternSheet(blob,length,opts){if(opts.biff<8)return parse_ShortXLUnicodeString(blob,length,opts);var o=[],target=blob.l+length,len=blob.read_shift(2);while(len--!==0)o.push(parse_XTI(blob,6));var oo=[];return o}function parse_NameCmt(blob,length,opts){if(opts.biff<8){blob.l+=length;return}var cchName=blob.read_shift(2);var cchComment=blob.read_shift(2);var name=parse_XLUnicodeStringNoCch(blob,cchName,opts);var comment=parse_XLUnicodeStringNoCch(blob,cchComment,opts);return[name,comment]}function parse_ShrFmla(blob,length,opts){var ref=parse_RefU(blob,6);blob.l++;var cUse=blob.read_shift(1);length-=8;return[parse_SharedParsedFormula(blob,length,opts),cUse]}function parse_Array(blob,length,opts){var ref=parse_Ref(blob,6);switch(opts.biff){case 2:blob.l++;length-=7;break;case 3:;case 4:blob.l+=2;length-=8;break;default:blob.l+=6;length-=12;}return[ref,parse_ArrayParsedFormula(blob,length,opts,ref)]}function parse_MTRSettings(blob,length){var fMTREnabled=blob.read_shift(4)!==0;var fUserSetThreadCount=blob.read_shift(4)!==0;var cUserThreadCount=blob.read_shift(4);return[fMTREnabled,fUserSetThreadCount,cUserThreadCount]}function parse_NoteSh(blob,length,opts){if(opts.biff<8)return;var row=blob.read_shift(2),col=blob.read_shift(2);var flags=blob.read_shift(2),idObj=blob.read_shift(2);var stAuthor=parse_XLUnicodeString2(blob,0,opts);if(opts.biff<8)blob.read_shift(1);return[{r:row,c:col},stAuthor,idObj,flags]}function parse_Note(blob,length,opts){return parse_NoteSh(blob,length,opts)}function parse_MergeCells(blob,length){var merges=[];var cmcs=blob.read_shift(2);while(cmcs--)merges.push(parse_Ref8U(blob,length));return merges}function parse_Obj(blob,length,opts){if(opts&&opts.biff<8)return parse_BIFF5Obj(blob,length,opts);var cmo=parse_FtCmo(blob,22);var fts=parse_FtArray(blob,length-22,cmo[1]);return{cmo:cmo,ft:fts}}var parse_BIFF5OT=[];parse_BIFF5OT[8]=function(blob,length,opts){var tgt=blob.l+length;blob.l+=10;var cf=blob.read_shift(2);blob.l+=4;var cbPictFmla=blob.read_shift(2);blob.l+=2;var grbit=blob.read_shift(2);blob.l+=4;var cchName=blob.read_shift(1);blob.l+=cchName;blob.l=tgt;return{fmt:cf}};function parse_BIFF5Obj(blob,length,opts){var cnt=blob.read_shift(4);var ot=blob.read_shift(2);var id=blob.read_shift(2);var grbit=blob.read_shift(2);var colL=blob.read_shift(2);var dxL=blob.read_shift(2);var rwT=blob.read_shift(2);var dyT=blob.read_shift(2);var colR=blob.read_shift(2);var dxR=blob.read_shift(2);var rwB=blob.read_shift(2);var dyB=blob.read_shift(2);var cbMacro=blob.read_shift(2);blob.l+=6;length-=36;var fts=[];fts.push((parse_BIFF5OT[ot]||parsenoop)(blob,length,opts));return{cmo:[id,ot,grbit],ft:fts}}function parse_TxO(blob,length,opts){var s=blob.l;var texts="";try{blob.l+=4;var ot=(opts.lastobj||{cmo:[0,0]}).cmo[1];var controlInfo;if([0,5,7,11,12,14].indexOf(ot)==-1)blob.l+=6;else controlInfo=parse_ControlInfo(blob,6,opts);var cchText=blob.read_shift(2);var cbRuns=blob.read_shift(2);var ifntEmpty=parse_FontIndex(blob,2);var len=blob.read_shift(2);blob.l+=len;for(var i=1;i<blob.lens.length-1;++i){if(blob.l-s!=blob.lens[i])throw new Error("TxO: bad continue record");var hdr=blob[blob.l];var t=parse_XLUnicodeStringNoCch(blob,blob.lens[i+1]-blob.lens[i]-1);texts+=t;if(texts.length>=(hdr?cchText:2*cchText))break}if(texts.length!==cchText&&texts.length!==cchText*2){throw new Error("cchText: "+cchText+" != "+texts.length)}blob.l=s+length;return{t:texts}}catch(e){blob.l=s+length;return{t:texts}}}var parse_HLink=function(blob,length){var ref=parse_Ref8U(blob,8);blob.l+=16;var hlink=parse_Hyperlink(blob,length-24);return[ref,hlink]};var parse_HLinkTooltip=function(blob,length){var end=blob.l+length;blob.read_shift(2);var ref=parse_Ref8U(blob,8);var wzTooltip=blob.read_shift((length-10)/2,"dbcs-cont");wzTooltip=wzTooltip.replace(chr0,"");return[ref,wzTooltip]};function parse_Country(blob,length){var o=[],d;d=blob.read_shift(2);o[0]=CountryEnum[d]||d;d=blob.read_shift(2);o[1]=CountryEnum[d]||d;return o}function parse_ClrtClient(blob,length){var ccv=blob.read_shift(2);var o=[];while(ccv-->0)o.push(parse_LongRGB(blob,8));return o}function parse_Palette(blob,length){var ccv=blob.read_shift(2);var o=[];while(ccv-->0)o.push(parse_LongRGB(blob,8));return o}function parse_XFCRC(blob,length){blob.l+=2;var o={cxfs:0,crc:0};o.cxfs=blob.read_shift(2);o.crc=blob.read_shift(4);return o}function parse_ColInfo(blob,length,opts){if(!opts.cellStyles)return parsenoop(blob,length);var w=opts&&opts.biff>=12?4:2;var colFirst=blob.read_shift(w);var colLast=blob.read_shift(w);var coldx=blob.read_shift(w);var ixfe=blob.read_shift(w);var flags=blob.read_shift(2);if(w==2)blob.l+=2;return{s:colFirst,e:colLast,w:coldx,ixfe:ixfe,flags:flags}}function parse_Setup(blob,length,opts){var o={};blob.l+=16;o.header=parse_Xnum(blob,8);o.footer=parse_Xnum(blob,8);blob.l+=2;return o}function parse_ShtProps(blob,length,opts){var def={area:false};if(opts.biff!=5){blob.l+=length;return def}var d=blob.read_shift(1);blob.l+=3;if(d&16)def.area=true;return def}var parse_Style=parsenoop;var parse_StyleExt=parsenoop;var parse_Window2=parsenoop;var parse_Backup=parsebool;var parse_Blank=parse_XLSCell;var parse_BottomMargin=parse_Xnum;var parse_BuiltInFnGroupCount=parseuint16;var parse_CalcCount=parseuint16;var parse_CalcDelta=parse_Xnum;var parse_CalcIter=parsebool;var parse_CalcMode=parseuint16;var parse_CalcPrecision=parsebool;var parse_CalcRefMode=parsenoop2;var parse_CalcSaveRecalc=parsebool;var parse_CodePage=parseuint16;var parse_Compat12=parsebool;var parse_Date1904=parsebool;var parse_DefColWidth=parseuint16;var parse_DSF=parsenoop2;var parse_EntExU2=parsenoop2;var parse_EOF=parsenoop2;var parse_Excel9File=parsenoop2;var parse_FeatHdr=parsenoop2;var parse_FontX=parseuint16;var parse_Footer=parse_XLHeaderFooter;var parse_GridSet=parseuint16;var parse_HCenter=parsebool;var parse_Header=parse_XLHeaderFooter;var parse_HideObj=parse_HideObjEnum;var parse_InterfaceEnd=parsenoop2;var parse_LeftMargin=parse_Xnum;var parse_Mms=parsenoop2;var parse_ObjProtect=parsebool;var parse_Password=parseuint16;var parse_PrintGrid=parsebool;var parse_PrintRowCol=parsebool;var parse_PrintSize=parseuint16;var parse_Prot4Rev=parsebool;var parse_Prot4RevPass=parseuint16;var parse_Protect=parsebool;var parse_RefreshAll=parsebool;var parse_RightMargin=parse_Xnum;var parse_RRTabId=parseuint16a;var parse_ScenarioProtect=parsebool;var parse_Scl=parseuint16a;var parse_String=parse_XLUnicodeString;var parse_SxBool=parsebool;var parse_TopMargin=parse_Xnum;var parse_UsesELFs=parsebool;var parse_VCenter=parsebool;var parse_WinProtect=parsebool;var parse_WriteProtect=parsenoop;var parse_VerticalPageBreaks=parsenoop;var parse_HorizontalPageBreaks=parsenoop;var parse_Selection=parsenoop;var parse_Continue=parsenoop;var parse_Pane=parsenoop;var parse_Pls=parsenoop;var parse_DCon=parsenoop;var parse_DConRef=parsenoop;var parse_DConName=parsenoop;var parse_XCT=parsenoop;var parse_CRN=parsenoop;var parse_FileSharing=parsenoop;var parse_Uncalced=parsenoop;var parse_Template=parsenoop;var parse_Intl=parsenoop;var parse_WsBool=parsenoop;var parse_Sort=parsenoop;var parse_Sync=parsenoop;var parse_LPr=parsenoop;var parse_DxGCol=parsenoop;var parse_FnGroupName=parsenoop;var parse_FilterMode=parsenoop;var parse_AutoFilterInfo=parsenoop;var parse_AutoFilter=parsenoop;var parse_ScenMan=parsenoop;var parse_SCENARIO=parsenoop;var parse_SxView=parsenoop;var parse_Sxvd=parsenoop;var parse_SXVI=parsenoop;var parse_SxIvd=parsenoop;var parse_SXLI=parsenoop;var parse_SXPI=parsenoop;var parse_DocRoute=parsenoop;var parse_RecipName=parsenoop;var parse_SXDI=parsenoop;var parse_SXDB=parsenoop;var parse_SXFDB=parsenoop;var parse_SXDBB=parsenoop;var parse_SXNum=parsenoop;var parse_SxErr=parsenoop;var parse_SXInt=parsenoop;var parse_SXString=parsenoop;var parse_SXDtr=parsenoop;var parse_SxNil=parsenoop;var parse_SXTbl=parsenoop;var parse_SXTBRGIITM=parsenoop;var parse_SxTbpg=parsenoop;var parse_ObProj=parsenoop;var parse_SXStreamID=parsenoop;var parse_DBCell=parsenoop;var parse_SXRng=parsenoop;var parse_SxIsxoper=parsenoop;var parse_BookBool=parsenoop;var parse_DbOrParamQry=parsenoop;var parse_OleObjectSize=parsenoop;var parse_SXVS=parsenoop;var parse_BkHim=parsenoop;var parse_MsoDrawingGroup=parsenoop;var parse_MsoDrawing=parsenoop;var parse_MsoDrawingSelection=parsenoop;var parse_PhoneticInfo=parsenoop;var parse_SxRule=parsenoop;var parse_SXEx=parsenoop;var parse_SxFilt=parsenoop;var parse_SxDXF=parsenoop;var parse_SxItm=parsenoop;var parse_SxName=parsenoop;var parse_SxSelect=parsenoop;var parse_SXPair=parsenoop;var parse_SxFmla=parsenoop;var parse_SxFormat=parsenoop;var parse_SXVDEx=parsenoop;var parse_SXFormula=parsenoop;var parse_SXDBEx=parsenoop;var parse_RRDInsDel=parsenoop;var parse_RRDHead=parsenoop;var parse_RRDChgCell=parsenoop;var parse_RRDRenSheet=parsenoop;var parse_RRSort=parsenoop;var parse_RRDMove=parsenoop;var parse_RRFormat=parsenoop;var parse_RRAutoFmt=parsenoop;var parse_RRInsertSh=parsenoop;var parse_RRDMoveBegin=parsenoop;var parse_RRDMoveEnd=parsenoop;var parse_RRDInsDelBegin=parsenoop;var parse_RRDInsDelEnd=parsenoop;var parse_RRDConflict=parsenoop;var parse_RRDDefName=parsenoop;var parse_RRDRstEtxp=parsenoop;var parse_LRng=parsenoop;var parse_CUsr=parsenoop;var parse_CbUsr=parsenoop;var parse_UsrInfo=parsenoop;var parse_UsrExcl=parsenoop;var parse_FileLock=parsenoop;var parse_RRDInfo=parsenoop;var parse_BCUsrs=parsenoop;var parse_UsrChk=parsenoop;var parse_UserBView=parsenoop;var parse_UserSViewBegin=parsenoop;var parse_UserSViewEnd=parsenoop;var parse_RRDUserView=parsenoop;var parse_Qsi=parsenoop;var parse_CondFmt=parsenoop;var parse_CF=parsenoop;var parse_DVal=parsenoop;var parse_DConBin=parsenoop;var parse_Lel=parsenoop;var parse_XLSCodeName=parse_XLUnicodeString;var parse_SXFDBType=parsenoop;var parse_ObNoMacros=parsenoop;var parse_Dv=parsenoop;var parse_Index=parsenoop;var parse_Table=parsenoop;var parse_BigName=parsenoop;var parse_ContinueBigName=parsenoop;var parse_WebPub=parsenoop;var parse_QsiSXTag=parsenoop;var parse_DBQueryExt=parsenoop;var parse_ExtString=parsenoop;var parse_TxtQry=parsenoop;var parse_Qsir=parsenoop;var parse_Qsif=parsenoop;var parse_RRDTQSIF=parsenoop;var parse_OleDbConn=parsenoop;var parse_WOpt=parsenoop;var parse_SXViewEx=parsenoop;var parse_SXTH=parsenoop;var parse_SXPIEx=parsenoop;var parse_SXVDTEx=parsenoop;var parse_SXViewEx9=parsenoop;var parse_ContinueFrt=parsenoop;var parse_RealTimeData=parsenoop;var parse_ChartFrtInfo=parsenoop;var parse_FrtWrapper=parsenoop;var parse_StartBlock=parsenoop;var parse_EndBlock=parsenoop;var parse_StartObject=parsenoop;var parse_EndObject=parsenoop;var parse_CatLab=parsenoop;var parse_YMult=parsenoop;var parse_SXViewLink=parsenoop;var parse_PivotChartBits=parsenoop;var parse_FrtFontList=parsenoop;var parse_SheetExt=parsenoop;var parse_BookExt=parsenoop;var parse_SXAddl=parsenoop;var parse_CrErr=parsenoop;var parse_HFPicture=parsenoop;var parse_Feat=parsenoop;var parse_DataLabExt=parsenoop;var parse_DataLabExtContents=parsenoop;var parse_CellWatch=parsenoop;var parse_FeatHdr11=parsenoop;var parse_Feature11=parsenoop;var parse_DropDownObjIds=parsenoop;var parse_ContinueFrt11=parsenoop;var parse_DConn=parsenoop;var parse_List12=parsenoop;var parse_Feature12=parsenoop;var parse_CondFmt12=parsenoop;var parse_CF12=parsenoop;var parse_CFEx=parsenoop;var parse_AutoFilter12=parsenoop;var parse_ContinueFrt12=parsenoop;var parse_MDTInfo=parsenoop;var parse_MDXStr=parsenoop;var parse_MDXTuple=parsenoop;var parse_MDXSet=parsenoop;var parse_MDXProp=parsenoop;var parse_MDXKPI=parsenoop;var parse_MDB=parsenoop;var parse_PLV=parsenoop;var parse_DXF=parsenoop;var parse_TableStyles=parsenoop;var parse_TableStyle=parsenoop;var parse_TableStyleElement=parsenoop;var parse_NamePublish=parsenoop;var parse_SortData=parsenoop;var parse_GUIDTypeLib=parsenoop;var parse_FnGrp12=parsenoop;var parse_NameFnGrp12=parsenoop;var parse_HeaderFooter=parsenoop;var parse_CrtLayout12=parsenoop;var parse_CrtMlFrt=parsenoop;var parse_CrtMlFrtContinue=parsenoop;var parse_ShapePropsStream=parsenoop;var parse_TextPropsStream=parsenoop;var parse_RichTextStream=parsenoop;var parse_CrtLayout12A=parsenoop;var parse_Units=parsenoop;var parse_Chart=parsenoop;var parse_Series=parsenoop;var parse_DataFormat=parsenoop;var parse_LineFormat=parsenoop;var parse_MarkerFormat=parsenoop;var parse_AreaFormat=parsenoop;var parse_PieFormat=parsenoop;var parse_AttachedLabel=parsenoop;var parse_SeriesText=parsenoop;var parse_ChartFormat=parsenoop;var parse_Legend=parsenoop;var parse_SeriesList=parsenoop;var parse_Bar=parsenoop;var parse_Line=parsenoop;var parse_Pie=parsenoop;var parse_Area=parsenoop;var parse_Scatter=parsenoop;var parse_CrtLine=parsenoop;var parse_Axis=parsenoop;var parse_Tick=parsenoop;var parse_ValueRange=parsenoop;var parse_CatSerRange=parsenoop;var parse_AxisLine=parsenoop;var parse_CrtLink=parsenoop;var parse_DefaultText=parsenoop;var parse_Text=parsenoop;var parse_ObjectLink=parsenoop;var parse_Frame=parsenoop;var parse_Begin=parsenoop;var parse_End=parsenoop;var parse_PlotArea=parsenoop;var parse_Chart3d=parsenoop;var parse_PicF=parsenoop;var parse_DropBar=parsenoop;var parse_Radar=parsenoop;var parse_Surf=parsenoop;var parse_RadarArea=parsenoop;var parse_AxisParent=parsenoop;var parse_LegendException=parsenoop;var parse_SerToCrt=parsenoop;var parse_AxesUsed=parsenoop;var parse_SBaseRef=parsenoop;var parse_SerParent=parsenoop;var parse_SerAuxTrend=parsenoop;var parse_IFmtRecord=parsenoop;var parse_Pos=parsenoop;var parse_AlRuns=parsenoop;var parse_BRAI=parsenoop;var parse_SerAuxErrBar=parsenoop;var parse_SerFmt=parsenoop;var parse_Chart3DBarShape=parsenoop;var parse_Fbi=parsenoop;var parse_BopPop=parsenoop;var parse_AxcExt=parsenoop;var parse_Dat=parsenoop;var parse_PlotGrowth=parsenoop;var parse_SIIndex=parsenoop;var parse_GelFrame=parsenoop;var parse_BopPopCustom=parsenoop;var parse_Fbi2=parsenoop;function parse_ImData(blob,length,opts){var tgt=blob.l+length;var cf=blob.read_shift(2);var env=blob.read_shift(2);var lcb=blob.read_shift(4);var o={fmt:cf,env:env,len:lcb,data:blob.slice(blob.l,blob.l+lcb)};blob.l+=lcb;return o}function parse_BIFF5String(blob){var len=blob.read_shift(1);return blob.read_shift(len,"sbcs-cont")}function parse_BIFF2STR(blob,length,opts){var cell=parse_XLSCell(blob,6);++blob.l;var str=parse_XLUnicodeString2(blob,length-7,opts);cell.t="str";cell.val=str;return cell}function parse_BIFF2NUM(blob,length,opts){var cell=parse_XLSCell(blob,6);++blob.l;var num=parse_Xnum(blob,8);cell.t="n";cell.val=num;return cell}function parse_BIFF2INT(blob,length){var cell=parse_XLSCell(blob,6);++blob.l;var num=blob.read_shift(2);cell.t="n";cell.val=num;return cell}function parse_BIFF2STRING(blob,length){var cch=blob.read_shift(1);if(cch===0){blob.l++;return""}return blob.read_shift(cch,"sbcs-cont")}function parse_BIFF2FONTXTRA(blob,length){blob.l+=6;blob.l+=2;blob.l+=1;blob.l+=3;blob.l+=1;blob.l+=length-13}function parse_RString(blob,length,opts){var end=blob.l+length;var cell=parse_XLSCell(blob,6);var cch=blob.read_shift(2);var str=parse_XLUnicodeStringNoCch(blob,cch,opts);blob.l=end;cell.t="str";cell.val=str;return cell}var DBF=function(){var dbf_codepage_map={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,255:16969};function dbf_to_aoa(buf,opts){var out=[];var d=new_raw_buf(1);switch(opts.type){case"base64":d=s2a(Base64.decode(buf));break;case"binary":d=s2a(buf);break;case"buffer":;case"array":d=buf;break;}prep_blob(d,0);var ft=d.read_shift(1);var memo=false;var vfp=false;switch(ft){case 2:;case 3:break;case 48:vfp=true;memo=true;break;case 49:vfp=true;break;case 131:memo=true;break;case 139:memo=true;break;case 245:memo=true;break;default:throw new Error("DBF Unsupported Version: "+ft.toString(16));}var filedate=new Date,nrow=0,fpos=0;if(ft==2)nrow=d.read_shift(2);filedate=new Date(d.read_shift(1)+1900,d.read_shift(1)-1,d.read_shift(1));if(ft!=2)nrow=d.read_shift(4);if(ft!=2)fpos=d.read_shift(2);var rlen=d.read_shift(2);var flags=0,current_cp=1252;if(ft!=2){d.l+=16;flags=d.read_shift(1);if(d[d.l]!==0)current_cp=dbf_codepage_map[d[d.l]];d.l+=1;d.l+=2}var fields=[],field={};var hend=fpos-10-(vfp?264:0);while(ft==2?d.l<d.length&&d[d.l]!=13:d.l<hend){field={};field.name=cptable.utils.decode(current_cp,d.slice(d.l,d.l+10)).replace(/[\u0000\r\n].*$/g,"");d.l+=11;field.type=String.fromCharCode(d.read_shift(1));if(ft!=2)field.offset=d.read_shift(4);field.len=d.read_shift(1);if(ft==2)field.offset=d.read_shift(2);field.dec=d.read_shift(1);if(field.name.length)fields.push(field);if(ft!=2)d.l+=14;switch(field.type){case"C":break;case"D":break;case"F":break;case"I":break;case"L":break;case"M":break;case"N":break;case"T":break;case"Y":break;case"0":break;case"+":break;case"@":break;default:throw new Error("Unknown Field Type: "+field.type);}}if(d[d.l]!==13)d.l=fpos-1;else if(ft==2)d.l=521;if(ft!=2){if(d.read_shift(1)!==13)throw new Error("DBF Terminator not found "+d.l+" "+d[d.l]);d.l=fpos}var R=0,C=0;out[0]=[];for(C=0;C!=fields.length;++C)out[0][C]=fields[C].name;while(nrow-->0){if(d[d.l]===42){d.l+=rlen;continue}++d.l;out[++R]=[];C=0;for(C=0;C!=fields.length;++C){var dd=d.slice(d.l,d.l+fields[C].len);d.l+=fields[C].len;prep_blob(dd,0);var s=cptable.utils.decode(current_cp,dd);switch(fields[C].type){case"C":out[R][C]=cptable.utils.decode(current_cp,dd);out[R][C]=out[R][C].trim();break;case"D":if(s.length===8)out[R][C]=new Date(+s.substr(0,4),+s.substr(4,2)-1,+s.substr(6,2));else out[R][C]=s;break;case"F":out[R][C]=parseFloat(s.trim());break;case"I":out[R][C]=dd.read_shift(4,"i");break;case"L":switch(s.toUpperCase()){case"Y":;case"T":out[R][C]=true;break;case"N":;case"F":out[R][C]=false;break;case" ":;case"?":out[R][C]=false;break;default:throw new Error("DBF Unrecognized L:|"+s+"|");}break;case"M":if(!memo)throw new Error("DBF Unexpected MEMO for type "+ft.toString(16));out[R][C]="##MEMO##"+dd.read_shift(4);break;case"N":out[R][C]=+s.replace(/\u0000/g,"").trim();break;case"T":var day=dd.read_shift(4),ms=dd.read_shift(4);throw new Error(day+" | "+ms);case"Y":out[R][C]=dd.read(4,"i")/1e4;break;case"0":if(fields[C].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+fields[C].type);}}}if(ft!=2)if(d.l<d.length&&d[d.l++]!=26)throw new Error("DBF EOF Marker missing "+(d.l-1)+" of "+d.length+" "+d[d.l-1].toString(16));return out}function dbf_to_sheet(buf,opts){var o=opts||{};if(!o.dateNF)o.dateNF="yyyymmdd";return aoa_to_sheet(dbf_to_aoa(buf,o),o)}function dbf_to_workbook(buf,opts){try{return sheet_to_workbook(dbf_to_sheet(buf,opts),opts)}catch(e){if(opts&&opts.WTF)throw e}return{SheetNames:[],Sheets:{}}}return{to_workbook:dbf_to_workbook,to_sheet:dbf_to_sheet}}();var SYLK=function(){function sylk_to_aoa(d,opts){switch(opts.type){case"base64":return sylk_to_aoa_str(Base64.decode(d),opts);case"binary":return sylk_to_aoa_str(d,opts);case"buffer":return sylk_to_aoa_str(d.toString("binary"),opts);case"array":return sylk_to_aoa_str(cc2str(d),opts);}throw new Error("Unrecognized type "+opts.type)}function sylk_to_aoa_str(str,opts){var records=str.split(/[\n\r]+/),R=-1,C=-1,ri=0,rj=0,arr=[];var formats=[];var next_cell_format=null;var sht={},rowinfo=[],colinfo=[],cw=[];var Mval=0,j;for(;ri!==records.length;++ri){Mval=0;var rstr=records[ri].trim();var record=rstr.replace(/;;/g,"").split(";").map(function(x){return x.replace(/\u0001/g,";")});var RT=record[0],val;if(rstr.length>0)switch(RT){case"ID":break;case"E":break;case"B":break;case"O":break;case"P":if(record[1].charAt(0)=="P")formats.push(rstr.substr(3).replace(/;;/g,";"));break;case"C":for(rj=1;rj<record.length;++rj)switch(record[rj].charAt(0)){case"X":C=parseInt(record[rj].substr(1))-1;break;case"Y":R=parseInt(record[rj].substr(1))-1;C=0;for(j=arr.length;j<=R;++j)arr[j]=[];break;case"K":val=record[rj].substr(1);if(val.charAt(0)==='"')val=val.substr(1,val.length-2);else if(val==="TRUE")val=true;else if(val==="FALSE")val=false;else if(+val===+val){val=+val;if(next_cell_format!==null&&SSF.is_date(next_cell_format))val=numdate(val)}else if(!isNaN(fuzzydate(val).getDate())){val=parseDate(val)}arr[R][C]=val;next_cell_format=null;break;case"E":var formula=rc_to_a1(record[rj].substr(1),{r:R,c:C});arr[R][C]=[arr[R][C],formula];break;default:if(opts&&opts.WTF)throw new Error("SYLK bad record "+rstr);}break;case"F":var F_seen=0;for(rj=1;rj<record.length;++rj)switch(record[rj].charAt(0)){case"X":C=parseInt(record[rj].substr(1))-1;++F_seen;break;case"Y":R=parseInt(record[rj].substr(1))-1;for(j=arr.length;j<=R;++j)arr[j]=[];break;case"M":Mval=parseInt(record[rj].substr(1))/20;break;case"F":break;case"P":next_cell_format=formats[parseInt(record[rj].substr(1))];break;case"S":break;case"D":break;case"N":break;case"W":cw=record[rj].substr(1).split(" ");for(j=parseInt(cw[0],10);j<=parseInt(cw[1],10);++j){Mval=parseInt(cw[2],10);colinfo[j-1]=Mval==0?{hidden:true}:{wch:Mval};process_col(colinfo[j-1])}break;case"C":C=parseInt(record[rj].substr(1))-1;if(!colinfo[C])colinfo[C]={};break;case"R":R=parseInt(record[rj].substr(1))-1;if(!rowinfo[R])rowinfo[R]={};if(Mval>0){rowinfo[R].hpt=Mval;rowinfo[R].hpx=pt2px(Mval)}else if(Mval==0)rowinfo[R].hidden=true;break;default:if(opts&&opts.WTF)throw new Error("SYLK bad record "+rstr);}if(F_seen<1)next_cell_format=null;break;default:if(opts&&opts.WTF)throw new Error("SYLK bad record "+rstr);}}if(rowinfo.length>0)sht["!rows"]=rowinfo;if(colinfo.length>0)sht["!cols"]=colinfo;return[arr,sht]}function sylk_to_sheet(d,opts){var aoasht=sylk_to_aoa(d,opts);var aoa=aoasht[0],ws=aoasht[1];var o=aoa_to_sheet(aoa,opts);keys(ws).forEach(function(k){o[k]=ws[k]});return o}function sylk_to_workbook(d,opts){return sheet_to_workbook(sylk_to_sheet(d,opts),opts)}function write_ws_cell_sylk(cell,ws,R,C,opts){var o="C;Y"+(R+1)+";X"+(C+1)+";K";switch(cell.t){case"n":o+=cell.v||0;if(cell.f&&!cell.F)o+=";E"+a1_to_rc(cell.f,{r:R,c:C});break;case"b":o+=cell.v?"TRUE":"FALSE";break;case"e":o+=cell.w||cell.v;break;case"d":o+='"'+(cell.w||cell.v)+'"';break;case"s":o+='"'+cell.v.replace(/"/g,"")+'"';break;}return o}function write_ws_cols_sylk(out,cols){cols.forEach(function(col,i){var rec="F;W"+(i+1)+" "+(i+1)+" ";if(col.hidden)rec+="0";else{if(typeof col.width=="number")col.wpx=width2px(col.width);if(typeof col.wpx=="number")col.wch=px2char(col.wpx);if(typeof col.wch=="number")rec+=Math.round(col.wch)}if(rec.charAt(rec.length-1)!=" ")out.push(rec)})}function write_ws_rows_sylk(out,rows){rows.forEach(function(row,i){var rec="F;";if(row.hidden)rec+="M0;";else if(row.hpt)rec+="M"+20*row.hpt+";";else if(row.hpx)rec+="M"+20*px2pt(row.hpx)+";";if(rec.length>2)out.push(rec+"R"+(i+1))})}function sheet_to_sylk(ws,opts){var preamble=["ID;PWXL;N;E"],o=[];var r=decode_range(ws["!ref"]),cell;var dense=Array.isArray(ws);var RS="\r\n";preamble.push("P;PGeneral");preamble.push("F;P0;DG0G8;M255");if(ws["!cols"])write_ws_cols_sylk(preamble,ws["!cols"]);if(ws["!rows"])write_ws_rows_sylk(preamble,ws["!rows"]);preamble.push("B;Y"+(r.e.r-r.s.r+1)+";X"+(r.e.c-r.s.c+1)+";D"+[r.s.c,r.s.r,r.e.c,r.e.r].join(" "));for(var R=r.s.r;R<=r.e.r;++R){for(var C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});cell=dense?(ws[R]||[])[C]:ws[coord];if(!cell||cell.v==null&&(!cell.f||cell.F))continue;o.push(write_ws_cell_sylk(cell,ws,R,C,opts))}}return preamble.join(RS)+RS+o.join(RS)+RS+"E"+RS}return{to_workbook:sylk_to_workbook,to_sheet:sylk_to_sheet,from_sheet:sheet_to_sylk}}();var DIF=function(){function dif_to_aoa(d,opts){switch(opts.type){case"base64":return dif_to_aoa_str(Base64.decode(d),opts);case"binary":return dif_to_aoa_str(d,opts);case"buffer":return dif_to_aoa_str(d.toString("binary"),opts);case"array":return dif_to_aoa_str(cc2str(d),opts);}throw new Error("Unrecognized type "+opts.type)}function dif_to_aoa_str(str,opts){var records=str.split("\n"),R=-1,C=-1,ri=0,arr=[];for(;ri!==records.length;++ri){if(records[ri].trim()==="BOT"){arr[++R]=[];C=0;continue}if(R<0)continue;var metadata=records[ri].trim().split(",");var type=metadata[0],value=metadata[1];++ri;var data=records[ri].trim();switch(+type){case-1:if(data==="BOT"){arr[++R]=[];C=0;continue}else if(data!=="EOD")throw new Error("Unrecognized DIF special command "+data);break;case 0:if(data==="TRUE")arr[R][C]=true;else if(data==="FALSE")arr[R][C]=false;else if(+value==+value)arr[R][C]=+value;else if(!isNaN(fuzzydate(value).getDate()))arr[R][C]=parseDate(value);else arr[R][C]=value;++C;break;case 1:data=data.substr(1,data.length-2);arr[R][C++]=data!==""?data:null;break;}if(data==="EOD")break}return arr}function dif_to_sheet(str,opts){return aoa_to_sheet(dif_to_aoa(str,opts),opts)}function dif_to_workbook(str,opts){return sheet_to_workbook(dif_to_sheet(str,opts),opts)}var sheet_to_dif=function(){var push_field=function pf(o,topic,v,n,s){o.push(topic);o.push(v+","+n);o.push('"'+s.replace(/"/g,'""')+'"')};var push_value=function po(o,type,v,s){o.push(type+","+v);o.push(type==1?'"'+s.replace(/"/g,'""')+'"':s)};return function sheet_to_dif(ws,opts){var o=[];var r=decode_range(ws["!ref"]),cell;var dense=Array.isArray(ws);push_field(o,"TABLE",0,1,"sheetjs");push_field(o,"VECTORS",0,r.e.r-r.s.r+1,"");push_field(o,"TUPLES",0,r.e.c-r.s.c+1,"");push_field(o,"DATA",0,0,"");for(var R=r.s.r;R<=r.e.r;++R){push_value(o,-1,0,"BOT");for(var C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});cell=dense?(ws[R]||[])[C]:ws[coord];if(!cell){push_value(o,1,0,"");continue}switch(cell.t){case"n":var val=DIF_XL?cell.w:cell.v;if(!val&&cell.v!=null)val=cell.v;if(val==null){if(DIF_XL&&cell.f&&!cell.F)push_value(o,1,0,"="+cell.f);else push_value(o,1,0,"")}else push_value(o,0,val,"V");break;case"b":push_value(o,0,cell.v?1:0,cell.v?"TRUE":"FALSE");break;case"s":push_value(o,1,0,!DIF_XL||isNaN(cell.v)?cell.v:'="'+cell.v+'"');break;case"d":if(!cell.w)cell.w=SSF.format(cell.z||SSF._table[14],datenum(parseDate(cell.v)));if(DIF_XL)push_value(o,0,cell.w,"V");else push_value(o,1,0,cell.w);break;default:push_value(o,1,0,"");}}}push_value(o,-1,0,"EOD");var RS="\r\n";var oo=o.join(RS);return oo}}();return{to_workbook:dif_to_workbook,to_sheet:dif_to_sheet,from_sheet:sheet_to_dif}}();var PRN=function(){function set_text_arr(data,arr,R,C){if(data==="TRUE")arr[R][C]=true;else if(data==="FALSE")arr[R][C]=false;else if(data===""){}else if(+data==+data)arr[R][C]=+data;else if(!isNaN(fuzzydate(data).getDate()))arr[R][C]=parseDate(data);else arr[R][C]=data}function prn_to_aoa_str(f,opts){var arr=[];if(!f||f.length===0)return arr;var lines=f.split(/[\r\n]/);var L=lines.length-1;while(L>=0&&lines[L].length===0)--L;var start=10,idx=0;var R=0;for(;R<=L;++R){idx=lines[R].indexOf(" ");if(idx==-1)idx=lines[R].length;else idx++;start=Math.max(start,idx)}for(R=0;R<=L;++R){arr[R]=[];var C=0;set_text_arr(lines[R].slice(0,start).trim(),arr,R,C);for(C=1;C<=(lines[R].length-start)/10+1;++C)set_text_arr(lines[R].slice(start+(C-1)*10,start+C*10).trim(),arr,R,C)}return arr}function dsv_to_sheet_str(str,opts){var o=opts||{};var sep="";if(DENSE!=null&&o.dense==null)o.dense=DENSE;var ws=o.dense?[]:{};var range={s:{c:0,r:0},e:{c:0,r:0}};if(str.substr(0,4)=="sep="&&str.charCodeAt(5)==10){sep=str.charAt(4);str=str.substr(6)}else if(str.substr(0,1024).indexOf("\t")==-1)sep=",";else sep="\t";var R=0,C=0,v=0;var start=0,end=0,sepcc=sep.charCodeAt(0),instr=false,cc=0;str=str.replace(/\r\n/gm,"\n");var _re=o.dateNF!=null?dateNF_regex(o.dateNF):null;function finish_cell(){var s=str.slice(start,end);var cell={};if(o.raw){cell.t="s";cell.v=s}else if(s.charCodeAt(0)==61){cell.t="n";cell.f=s.substr(1)}else if(s=="TRUE"){cell.t="b";cell.v=true}else if(s=="FALSE"){cell.t="b";cell.v=false}else if(!isNaN(v=+s)){cell.t="n";cell.w=s;cell.v=v}else if(!isNaN(fuzzydate(s).getDate())||_re&&s.match(_re)){cell.z=o.dateNF||SSF._table[14];var k=0;if(_re&&s.match(_re)){s=dateNF_fix(s,o.dateNF,s.match(_re)||[]);k=1}if(o.cellDates){cell.t="d";cell.v=parseDate(s,k)}else{cell.t="n";cell.v=datenum(parseDate(s,k))}cell.w=SSF.format(cell.z,cell.v instanceof Date?datenum(cell.v):cell.v)}else{cell.t="s";if(s.charAt(0)=='"'&&s.charAt(s.length-1)=='"')s=s.slice(1,-1).replace(/""/g,'"');cell.v=s}if(o.dense){if(!ws[R])ws[R]=[];ws[R][C]=cell}else ws[encode_cell({c:C,r:R})]=cell;start=end+1;if(range.e.c<C)range.e.c=C;if(range.e.r<R)range.e.r=R;if(cc==sepcc)++C;else{C=0;++R}}for(;end<str.length;++end)switch(cc=str.charCodeAt(end)){case 34:instr=!instr;break;case sepcc:;case 10:;case 13:if(!instr)finish_cell();break;default:break;}if(end-start>0)finish_cell();ws["!ref"]=encode_range(range);return ws}function prn_to_sheet_str(str,opts){if(str.substr(0,4)=="sep=")return dsv_to_sheet_str(str,opts);if(str.indexOf("\t")>=0||str.indexOf(",")>=0)return dsv_to_sheet_str(str,opts);return aoa_to_sheet(prn_to_aoa_str(str,opts),opts)}function prn_to_sheet(d,opts){var str="",bytes=firstbyte(d,opts);switch(opts.type){case"base64":str=Base64.decode(d);break;case"binary":str=d;break;case"buffer":str=d.toString("binary");break;case"array":str=cc2str(d);break;default:throw new Error("Unrecognized type "+opts.type);}if(bytes[0]==239&&bytes[1]==187&&bytes[2]==191)str=utf8read(str);return prn_to_sheet_str(str,opts)}function prn_to_workbook(d,opts){return sheet_to_workbook(prn_to_sheet(d,opts),opts)}function sheet_to_prn(ws,opts){var o=[];var r=decode_range(ws["!ref"]),cell;var dense=Array.isArray(ws);for(var R=r.s.r;R<=r.e.r;++R){var oo=[];for(var C=r.s.c;C<=r.e.c;++C){var coord=encode_cell({r:R,c:C});cell=dense?(ws[R]||[])[C]:ws[coord];if(!cell||cell.v==null){oo.push("          ");continue}var w=(cell.w||(format_cell(cell),cell.w)||"").substr(0,10);while(w.length<10)w+=" ";oo.push(w+(C==0?" ":""))}o.push(oo.join(""))}return o.join("\n")}return{to_workbook:prn_to_workbook,to_sheet:prn_to_sheet,from_sheet:sheet_to_prn}}();function read_wb_ID(d,opts){var o=opts||{},OLD_WTF=!!o.WTF;o.WTF=true;try{var out=SYLK.to_workbook(d,o);o.WTF=OLD_WTF;return out}catch(e){o.WTF=OLD_WTF;if(!e.message.match(/SYLK bad record ID/)&&OLD_WTF)throw e;return PRN.to_workbook(d,opts)}}var WK_=function(){function lotushopper(data,cb,opts){if(!data)return;prep_blob(data,data.l||0);var Enum=opts.Enum||WK1Enum;while(data.l<data.length){var RT=data.read_shift(2);var R=Enum[RT]||Enum[255];var length=data.read_shift(2);var tgt=data.l+length;var d=R.f(data,length,opts);data.l=tgt;if(cb(d,R.n,RT))return}}function lotus_to_workbook(d,opts){switch(opts.type){case"base64":return lotus_to_workbook_buf(s2a(Base64.decode(d)),opts);case"binary":return lotus_to_workbook_buf(s2a(d),opts);case"buffer":;case"array":return lotus_to_workbook_buf(d,opts);}throw"Unsupported type "+opts.type}function lotus_to_workbook_buf(d,opts){if(!d)return d;var o=opts||{};if(DENSE!=null&&o.dense==null)o.dense=DENSE;var s=o.dense?[]:{},n="Sheet1",sidx=0;var sheets={},snames=[n];var refguess={s:{r:0,c:0},e:{r:0,c:0}};if(d[2]==2)o.Enum=WK1Enum;else if(d[2]==26)o.Enum=WK3Enum;else if(d[2]==14){o.Enum=WK3Enum;o.qpro=true;d.l=0}else throw new Error("Unrecognized LOTUS BOF "+d[2]);lotushopper(d,function(val,Rn,RT){if(d[2]==2)switch(RT){case 0:o.vers=val;if(val>=4096)o.qpro=true;break;case 6:refguess=val;break;case 15:if(!o.qpro)val[1].v=val[1].v.substr(1);case 13:;case 14:;case 16:;case 51:if(RT==14&&(val[2]&112)==112&&(val[2]&15)>1&&(val[2]&15)<15){val[1].z=o.dateNF||SSF._table[14];if(o.cellDates){val[1].t="d";val[1].v=numdate(val[1].v)}}if(o.dense){if(!s[val[0].r])s[val[0].r]=[];s[val[0].r][val[0].c]=val[1]}else s[encode_cell(val[0])]=val[1];break;}else switch(RT){case 22:val[1].v=val[1].v.substr(1);case 23:;case 24:;case 25:;case 37:;case 39:;case 40:if(val[3]>sidx){s["!ref"]=encode_range(refguess);sheets[n]=s;s=o.dense?[]:{};refguess={s:{r:0,c:0},e:{r:0,c:0}};sidx=val[3];n="Sheet"+(sidx+1);snames.push(n)}s[encode_cell(val[0])]=val[1];if(refguess.e.c<val[0].c)refguess.e.c=val[0].c;if(refguess.e.r<val[0].r)refguess.e.r=val[0].r;break;default:break;}},o);s["!ref"]=encode_range(refguess);sheets[n]=s;return{SheetNames:snames,Sheets:sheets}}function parse_RANGE(blob,length){var o={s:{c:0,r:0},e:{c:0,r:0}};o.s.c=blob.read_shift(2);o.s.r=blob.read_shift(2);o.e.c=blob.read_shift(2);o.e.r=blob.read_shift(2);if(o.s.c==65535)o.s.c=o.e.c=o.s.r=o.e.r=0;return o}function parse_cell(blob,length,opts){var o=[{c:0,r:0},{t:"n",v:0},0];if(opts.qpro&&opts.vers!=20768){o[0].c=blob.read_shift(1);blob.l++;o[0].r=blob.read_shift(2);blob.l+=2}else{o[2]=blob.read_shift(1);o[0].c=blob.read_shift(2);o[0].r=blob.read_shift(2)}return o}function parse_LABEL(blob,length,opts){var tgt=blob.l+length;var o=parse_cell(blob,length,opts);o[1].t="s";if(opts.vers==20768){blob.l++;var len=blob.read_shift(1);o[1].v=blob.read_shift(len,"utf8");return o}if(opts.qpro)blob.l++;o[1].v=blob.read_shift(tgt-blob.l,"cstr");return o}function parse_INTEGER(blob,length,opts){var o=parse_cell(blob,length,opts);o[1].v=blob.read_shift(2,"i");return o}function parse_NUMBER(blob,length,opts){var o=parse_cell(blob,length,opts);o[1].v=blob.read_shift(8,"f");return o}function parse_FORMULA(blob,length,opts){var tgt=blob.l+length;var o=parse_cell(blob,length,opts);o[1].v=blob.read_shift(8,"f");if(opts.qpro)blob.l=tgt;else{var flen=blob.read_shift(2);blob.l+=flen}return o}function parse_cell_3(blob,length){var o=[{c:0,r:0},{t:"n",v:0},0];o[0].r=blob.read_shift(2);o[3]=blob[blob.l++];o[0].c=blob[blob.l++];return o}function parse_LABEL_16(blob,length){var o=parse_cell_3(blob,length);o[1].t="s";o[1].v=blob.read_shift(length-4,"cstr");return o}function parse_NUMBER_18(blob,length){var o=parse_cell_3(blob,length);o[1].v=blob.read_shift(2);var v=o[1].v>>1;if(o[1].v&1){switch(v&7){case 1:v=(v>>3)*500;break;case 2:v=(v>>3)/20;break;case 4:v=(v>>3)/2e3;break;case 6:v=(v>>3)/16;break;case 7:v=(v>>3)/64;break;default:throw"unknown NUMBER_18 encoding "+(v&7);}}o[1].v=v;return o}function parse_NUMBER_17(blob,length){var o=parse_cell_3(blob,length);var v1=blob.read_shift(4);var v2=blob.read_shift(4);var e=blob.read_shift(2);if(e==65535){o[1].v=0;return o}var s=e&32768;e=(e&32767)-16446;o[1].v=(e>0?v2<<e:v2>>>-e)+(e>-32?v1<<e+32:v1>>>-(e+32));return o}function parse_FORMULA_19(blob,length){var o=parse_NUMBER_17(blob,14);blob.l+=length-14;return o}function parse_NUMBER_25(blob,length){var o=parse_cell_3(blob,length);var v1=blob.read_shift(4);o[1].v=v1>>6;return o}function parse_NUMBER_27(blob,length){var o=parse_cell_3(blob,length);var v1=blob.read_shift(8,"f");o[1].v=v1;return o}function parse_FORMULA_28(blob,length){var o=parse_NUMBER_27(blob,14);blob.l+=length-10;return o}var WK1Enum={0:{n:"BOF",f:parseuint16},1:{n:"EOF",f:parsenoop},2:{n:"CALCMODE",f:parsenoop},3:{n:"CALCORDER",f:parsenoop},4:{n:"SPLIT",f:parsenoop},5:{n:"SYNC",f:parsenoop},6:{n:"RANGE",f:parse_RANGE},7:{n:"WINDOW1",f:parsenoop},8:{n:"COLW1",f:parsenoop},9:{n:"WINTWO",f:parsenoop},10:{n:"COLW2",f:parsenoop},11:{n:"NAME",f:parsenoop},12:{n:"BLANK",f:parsenoop},13:{n:"INTEGER",f:parse_INTEGER},14:{n:"NUMBER",f:parse_NUMBER},15:{n:"LABEL",f:parse_LABEL},16:{n:"FORMULA",f:parse_FORMULA},24:{n:"TABLE",f:parsenoop},25:{n:"ORANGE",f:parsenoop},26:{n:"PRANGE",f:parsenoop},27:{n:"SRANGE",f:parsenoop},28:{n:"FRANGE",f:parsenoop},29:{n:"KRANGE1",f:parsenoop},32:{n:"HRANGE",f:parsenoop},35:{n:"KRANGE2",f:parsenoop},36:{n:"PROTEC",f:parsenoop},37:{n:"FOOTER",f:parsenoop},38:{n:"HEADER",f:parsenoop},39:{n:"SETUP",f:parsenoop},40:{n:"MARGINS",f:parsenoop},41:{n:"LABELFMT",f:parsenoop},42:{n:"TITLES",f:parsenoop},43:{n:"SHEETJS",f:parsenoop},45:{n:"GRAPH",f:parsenoop},46:{n:"NGRAPH",f:parsenoop},47:{n:"CALCCOUNT",f:parsenoop},48:{n:"UNFORMATTED",f:parsenoop},49:{n:"CURSORW12",f:parsenoop},50:{n:"WINDOW",f:parsenoop},51:{n:"STRING",f:parse_LABEL},55:{n:"PASSWORD",f:parsenoop},56:{n:"LOCKED",f:parsenoop},60:{n:"QUERY",f:parsenoop},61:{n:"QUERYNAME",f:parsenoop},62:{n:"PRINT",f:parsenoop},63:{n:"PRINTNAME",f:parsenoop},64:{n:"GRAPH2",f:parsenoop},65:{n:"GRAPHNAME",f:parsenoop},66:{n:"ZOOM",f:parsenoop},67:{n:"SYMSPLIT",f:parsenoop},68:{n:"NSROWS",f:parsenoop},69:{n:"NSCOLS",f:parsenoop},70:{n:"RULER",f:parsenoop},71:{n:"NNAME",f:parsenoop},72:{n:"ACOMM",f:parsenoop},73:{n:"AMACRO",f:parsenoop},74:{n:"PARSE",f:parsenoop},255:{n:"",f:parsenoop}};var WK3Enum={0:{n:"BOF",f:parsenoop},1:{n:"EOF",f:parsenoop},3:{n:"??",f:parsenoop},4:{n:"??",f:parsenoop},5:{n:"??",f:parsenoop},6:{n:"??",f:parsenoop},7:{n:"??",f:parsenoop},9:{n:"??",f:parsenoop},10:{n:"??",f:parsenoop},11:{n:"??",f:parsenoop},12:{n:"??",f:parsenoop},14:{n:"??",f:parsenoop},15:{n:"??",f:parsenoop},16:{n:"??",f:parsenoop},17:{n:"??",f:parsenoop},18:{n:"??",f:parsenoop},19:{n:"??",f:parsenoop},21:{n:"??",f:parsenoop},22:{n:"LABEL16",f:parse_LABEL_16},23:{n:"NUMBER17",f:parse_NUMBER_17},24:{n:"NUMBER18",f:parse_NUMBER_18},25:{n:"FORMULA19",f:parse_FORMULA_19},26:{n:"??",f:parsenoop},27:{n:"??",f:parsenoop},28:{n:"??",f:parsenoop},29:{n:"??",f:parsenoop},30:{n:"??",f:parsenoop},31:{n:"??",f:parsenoop},33:{n:"??",f:parsenoop},37:{n:"NUMBER25",f:parse_NUMBER_25},39:{n:"NUMBER27",f:parse_NUMBER_27},40:{n:"FORMULA28",f:parse_FORMULA_28},255:{n:"",f:parsenoop}};return{to_workbook:lotus_to_workbook}}();var CS2CP={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969};var parse_rs=function parse_rs_factory(){var tregex=matchtag("t"),rpregex=matchtag("rPr"),rregex=/<(?:\w+:)?r>/g,rend=/<\/(?:\w+:)?r>/,nlregex=/\r\n/g;var parse_rpr=function parse_rpr(rpr,intro,outro){var font={},cp=65001,align="";var m=rpr.match(tagregex),i=0;if(m)for(;i!=m.length;++i){var y=parsexmltag(m[i]);switch(y[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!y.val)break;case"<shadow>":;case"<shadow/>":font.shadow=1;break;case"</shadow>":break;case"<charset":if(y.val=="1")break;cp=CS2CP[parseInt(y.val,10)];break;case"<outline":if(!y.val)break;case"<outline>":;case"<outline/>":font.outline=1;break;case"</outline>":break;case"<rFont":font.name=y.val;break;case"<sz":font.sz=y.val;break;case"<strike":if(!y.val)break;case"<strike>":;case"<strike/>":font.strike=1;break;case"</strike>":break;case"<u":if(!y.val)break;switch(y.val){case"double":font.uval="double";break;case"singleAccounting":font.uval="single-accounting";break;case"doubleAccounting":font.uval="double-accounting";break;};case"<u>":;case"<u/>":font.u=1;break;case"</u>":break;case"<b":if(y.val=="0")break;case"<b>":;case"<b/>":font.b=1;break;case"</b>":break;case"<i":if(y.val=="0")break;case"<i>":;case"<i/>":font.i=1;break;case"</i>":break;case"<color":if(y.rgb)font.color=y.rgb.substr(2,6);break;case"<family":font.family=y.val;break;case"<vertAlign":align=y.val;break;case"<scheme":break;default:if(y[0].charCodeAt(1)!==47)throw"Unrecognized rich format "+y[0];}}var style=[];if(font.u)style.push("text-decoration: underline;");if(font.uval)style.push("text-underline-style:"+font.uval+";");if(font.sz)style.push("font-size:"+font.sz+";");if(font.outline)style.push("text-effect: outline;");if(font.shadow)style.push("text-shadow: auto;");intro.push('<span style="'+style.join("")+'">');if(font.b){intro.push("<b>");outro.push("</b>")}if(font.i){intro.push("<i>");outro.push("</i>")}if(font.strike){intro.push("<s>");outro.push("</s>")}if(align=="superscript")align="sup";else if(align=="subscript")align="sub";if(align!=""){intro.push("<"+align+">");outro.push("</"+align+">")}outro.push("</span>");return cp};function parse_r(r){var terms=[[],"",[]];var t=r.match(tregex),cp=65001;if(!isval(t))return"";terms[1]=t[1];var rpr=r.match(rpregex);if(isval(rpr))cp=parse_rpr(rpr[1],terms[0],terms[2]);return terms[0].join("")+terms[1].replace(nlregex,"<br/>")+terms[2].join("")}return function parse_rs(rs){return rs.replace(rregex,"").split(rend).map(parse_r).join("")}}();var sitregex=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,sirregex=/<(?:\w+:)?r>/;var sirphregex=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function parse_si(x,opts){var html=opts?opts.cellHTML:true;var z={};if(!x)return null;var y;if(x.match(/^\s*<(?:\w+:)?t[^>]*>/)){z.t=utf8read(unescapexml(x.substr(x.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]));z.r=utf8read(x);if(html)z.h=escapehtml(z.t)}else if(y=x.match(sirregex)){z.r=utf8read(x);z.t=utf8read(unescapexml((x.replace(sirphregex,"").match(sitregex)||[]).join("").replace(tagregex,"")));if(html)z.h=parse_rs(z.r)}return z}var sstr0=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/;var sstr1=/<(?:\w+:)?(?:si|sstItem)>/g;var sstr2=/<\/(?:\w+:)?(?:si|sstItem)>/;function parse_sst_xml(data,opts){var s=[],ss="";if(!data)return s;var sst=data.match(sstr0);if(isval(sst)){ss=sst[2].replace(sstr1,"").split(sstr2);for(var i=0;i!=ss.length;++i){var o=parse_si(ss[i].trim(),opts);if(o!=null)s[s.length]=o}sst=parsexmltag(sst[1]);s.Count=sst.count;s.Unique=sst.uniqueCount}return s}RELS.SST="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings";var straywsregex=/^\s|\s$|[\t\n\r]/;function write_sst_xml(sst,opts){if(!opts.bookSST)return"";var o=[XML_HEADER];o[o.length]=writextag("sst",null,{xmlns:XMLNS.main[0],count:sst.Count,uniqueCount:sst.Unique});for(var i=0;i!=sst.length;++i){if(sst[i]==null)continue;var s=sst[i];var sitag="<si>";if(s.r)sitag+=s.r;else{sitag+="<t";if(!s.t)s.t="";if(s.t.match(straywsregex))sitag+=' xml:space="preserve"';sitag+=">"+escapexml(s.t)+"</t>"}sitag+="</si>";o[o.length]=sitag}if(o.length>2){o[o.length]="</sst>";o[1]=o[1].replace("/>",">")}return o.join("")}function parse_BrtBeginSst(data,length){return[data.read_shift(4),data.read_shift(4)]}function parse_sst_bin(data,opts){var s=[];var pass=false;recordhopper(data,function hopper_sst(val,R_n,RT){switch(RT){case 159:s.Count=val[0];s.Unique=val[1];break;case 19:s.push(val);break;case 160:return true;case 35:pass=true;break;case 36:pass=false;break;default:if(R_n.indexOf("Begin")>0){}else if(R_n.indexOf("End")>0){}if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}});return s}function write_BrtBeginSst(sst,o){if(!o)o=new_buf(8);o.write_shift(4,sst.Count);o.write_shift(4,sst.Unique);return o}var write_BrtSSTItem=write_RichStr;function write_sst_bin(sst,opts){var ba=buf_array();write_record(ba,"BrtBeginSst",write_BrtBeginSst(sst));for(var i=0;i<sst.length;++i)write_record(ba,"BrtSSTItem",write_BrtSSTItem(sst[i]));write_record(ba,"BrtEndSst");return ba.end()}function _JS2ANSI(str){if(typeof cptable!=="undefined")return cptable.utils.encode(1252,str);var o=[],oo=str.split("");for(var i=0;i<oo.length;++i)o[i]=oo[i].charCodeAt(0);return o}function parse_CRYPTOVersion(blob,length){var o={};o.Major=blob.read_shift(2);o.Minor=blob.read_shift(2);if(length>=4)blob.l+=length-4;return o}function parse_DataSpaceVersionInfo(blob,length){var o={};o.id=blob.read_shift(0,"lpp4");o.R=parse_CRYPTOVersion(blob,4);o.U=parse_CRYPTOVersion(blob,4);o.W=parse_CRYPTOVersion(blob,4);return o}function parse_DataSpaceMapEntry(blob){var len=blob.read_shift(4);var end=blob.l+len-4;var o={};var cnt=blob.read_shift(4);var comps=[];while(cnt-->0){var rc={};rc.t=blob.read_shift(4);rc.v=blob.read_shift(0,"lpp4");comps.push(rc)}o.name=blob.read_shift(0,"lpp4");o.comps=comps;return o}function parse_DataSpaceMap(blob,length){var o=[];blob.l+=4;var cnt=blob.read_shift(4);while(cnt-->0)o.push(parse_DataSpaceMapEntry(blob));return o}function parse_DataSpaceDefinition(blob,length){var o=[];blob.l+=4;var cnt=blob.read_shift(4);while(cnt-->0)o.push(blob.read_shift(0,"lpp4"));return o}function parse_TransformInfoHeader(blob,length){var o={};var len=blob.read_shift(4);var tgt=blob.l+len-4;blob.l+=4;o.id=blob.read_shift(0,"lpp4");o.name=blob.read_shift(0,"lpp4");o.R=parse_CRYPTOVersion(blob,4);o.U=parse_CRYPTOVersion(blob,4);o.W=parse_CRYPTOVersion(blob,4);return o}function parse_Primary(blob,length){var hdr=parse_TransformInfoHeader(blob);hdr.ename=blob.read_shift(0,"8lpp4");hdr.blksz=blob.read_shift(4);hdr.cmode=blob.read_shift(4);if(blob.read_shift(4)!=4)throw new Error("Bad !Primary record");return hdr}function parse_EncryptionHeader(blob,length){var tgt=blob.l+length;var o={};o.Flags=blob.read_shift(4)&63;blob.l+=4;o.AlgID=blob.read_shift(4);var valid=false;switch(o.AlgID){case 26126:;case 26127:;case 26128:valid=o.Flags==36;break;case 26625:valid=o.Flags==4;break;case 0:valid=o.Flags==16||o.Flags==4||o.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+o.AlgID;}if(!valid)throw new Error("Encryption Flags/AlgID mismatch");o.AlgIDHash=blob.read_shift(4);o.KeySize=blob.read_shift(4);o.ProviderType=blob.read_shift(4);blob.l+=8;o.CSPName=blob.read_shift(tgt-blob.l>>1,"utf16le").slice(0,-1);blob.l=tgt;return o}function parse_EncryptionVerifier(blob,length){var o={};blob.l+=4;o.Salt=blob.slice(blob.l,blob.l+16);blob.l+=16;o.Verifier=blob.slice(blob.l,blob.l+16);blob.l+=16;var sz=blob.read_shift(4);o.VerifierHash=blob.slice(blob.l,blob.l+sz);blob.l+=sz;return o}function parse_EncryptionInfo(blob,length){var vers=parse_CRYPTOVersion(blob);switch(vers.Minor){case 2:return parse_EncInfoStd(blob,vers);case 3:return parse_EncInfoExt(blob,vers);case 4:return parse_EncInfoAgl(blob,vers);}throw new Error("ECMA-376 Encryped file unrecognized Version: "+vers.Minor)}function parse_EncInfoStd(blob,vers){var flags=blob.read_shift(4);if((flags&63)!=36)throw new Error("EncryptionInfo mismatch");var sz=blob.read_shift(4);var tgt=blob.l+sz;var hdr=parse_EncryptionHeader(blob,sz);var verifier=parse_EncryptionVerifier(blob,blob.length-blob.l);return{t:"Std",h:hdr,v:verifier}}function parse_EncInfoExt(blob,vers){throw new Error("File is password-protected: ECMA-376 Extensible")}function parse_EncInfoAgl(blob,vers){throw new Error("File is password-protected: ECMA-376 Agile")}function parse_RC4CryptoHeader(blob,length){var o={};var vers=o.EncryptionVersionInfo=parse_CRYPTOVersion(blob,4);length-=4;if(vers.Minor!=2)throw"unrecognized minor version code: "+vers.Minor;if(vers.Major>4||vers.Major<2)throw"unrecognized major version code: "+vers.Major;o.Flags=blob.read_shift(4);length-=4;var sz=blob.read_shift(4);length-=4;o.EncryptionHeader=parse_EncryptionHeader(blob,sz);length-=sz;o.EncryptionVerifier=parse_EncryptionVerifier(blob,length);return o}function parse_RC4Header(blob,length){var o={};var vers=o.EncryptionVersionInfo=parse_CRYPTOVersion(blob,4);length-=4;if(vers.Major!=1||vers.Minor!=1)throw"unrecognized version code "+vers.Major+" : "+vers.Minor;o.Salt=blob.read_shift(16);o.EncryptedVerifier=blob.read_shift(16);o.EncryptedVerifierHash=blob.read_shift(16);return o}function crypto_CreatePasswordVerifier_Method1(Password){var Verifier=0,PasswordArray;var PasswordDecoded=_JS2ANSI(Password);var len=PasswordDecoded.length+1,i,PasswordByte;var Intermediate1,Intermediate2,Intermediate3;PasswordArray=new_raw_buf(len);PasswordArray[0]=PasswordDecoded.length;for(i=1;i!=len;++i)PasswordArray[i]=PasswordDecoded[i-1];for(i=len-1;i>=0;--i){PasswordByte=PasswordArray[i];Intermediate1=(Verifier&16384)===0?0:1;Intermediate2=Verifier<<1&32767;Intermediate3=Intermediate1|Intermediate2;Verifier=Intermediate3^PasswordByte}return Verifier^52811}var crypto_CreateXorArray_Method1=function(){var PadArray=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0];var InitialCode=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163];var XorMatrix=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628];var Ror=function(Byte){return(Byte/2|Byte*128)&255};var XorRor=function(byte1,byte2){return Ror(byte1^byte2)};var CreateXorKey_Method1=function(Password){var XorKey=InitialCode[Password.length-1];var CurrentElement=104;for(var i=Password.length-1;i>=0;--i){var Char=Password[i];for(var j=0;j!=7;++j){if(Char&64)XorKey^=XorMatrix[CurrentElement];Char*=2;--CurrentElement}}return XorKey};return function(password){var Password=_JS2ANSI(password);var XorKey=CreateXorKey_Method1(Password);var Index=Password.length;var ObfuscationArray=new_raw_buf(16);for(var i=0;i!=16;++i)ObfuscationArray[i]=0;var Temp,PasswordLastChar,PadIndex;if((Index&1)===1){Temp=XorKey>>8;ObfuscationArray[Index]=XorRor(PadArray[0],Temp);--Index;Temp=XorKey&255;PasswordLastChar=Password[Password.length-1];ObfuscationArray[Index]=XorRor(PasswordLastChar,Temp)}while(Index>0){--Index;Temp=XorKey>>8;ObfuscationArray[Index]=XorRor(Password[Index],Temp);--Index;Temp=XorKey&255;ObfuscationArray[Index]=XorRor(Password[Index],Temp)}Index=15;PadIndex=15-Password.length;while(PadIndex>0){Temp=XorKey>>8;ObfuscationArray[Index]=XorRor(PadArray[PadIndex],Temp);--Index;--PadIndex;Temp=XorKey&255;ObfuscationArray[Index]=XorRor(Password[Index],Temp);--Index;--PadIndex}return ObfuscationArray}}();var crypto_DecryptData_Method1=function(password,Data,XorArrayIndex,XorArray,O){if(!O)O=Data;if(!XorArray)XorArray=crypto_CreateXorArray_Method1(password);var Index,Value;for(Index=0;Index!=Data.length;++Index){Value=Data[Index];Value^=XorArray[XorArrayIndex];Value=(Value>>5|Value<<3)&255;O[Index]=Value;++XorArrayIndex}return[O,XorArrayIndex,XorArray]};var crypto_MakeXorDecryptor=function(password){var XorArrayIndex=0,XorArray=crypto_CreateXorArray_Method1(password);return function(Data){var O=crypto_DecryptData_Method1("",Data,XorArrayIndex,XorArray);XorArrayIndex=O[1];return O[0]}};function parse_XORObfuscation(blob,length,opts,out){var o={key:parseuint16(blob),verificationBytes:parseuint16(blob)};if(opts.password)o.verifier=crypto_CreatePasswordVerifier_Method1(opts.password);out.valid=o.verificationBytes===o.verifier;if(out.valid)out.insitu_decrypt=crypto_MakeXorDecryptor(opts.password);return o}function parse_FilePassHeader(blob,length,oo){var o=oo||{};o.Info=blob.read_shift(2);blob.l-=2;if(o.Info===1)o.Data=parse_RC4Header(blob,length);else o.Data=parse_RC4CryptoHeader(blob,length);return o}function parse_FilePass(blob,length,opts){var o={Type:blob.read_shift(2)};if(o.Type)parse_FilePassHeader(blob,length-2,o);else parse_XORObfuscation(blob,length-2,opts,o);return o}function hex2RGB(h){var o=h.substr(h[0]==="#"?1:0,6);return[parseInt(o.substr(0,2),16),parseInt(o.substr(2,2),16),parseInt(o.substr(4,2),16)]}function rgb2Hex(rgb){for(var i=0,o=1;i!=3;++i)o=o*256+(rgb[i]>255?255:rgb[i]<0?0:rgb[i]);return o.toString(16).toUpperCase().substr(1)}function rgb2HSL(rgb){var R=rgb[0]/255,G=rgb[1]/255,B=rgb[2]/255;var M=Math.max(R,G,B),m=Math.min(R,G,B),C=M-m;if(C===0)return[0,0,R];var H6=0,S=0,L2=M+m;S=C/(L2>1?2-L2:L2);switch(M){case R:H6=((G-B)/C+6)%6;break;case G:H6=(B-R)/C+2;break;case B:H6=(R-G)/C+4;break;}return[H6/6,S,L2/2]}function hsl2RGB(hsl){var H=hsl[0],S=hsl[1],L=hsl[2];var C=S*2*(L<.5?L:1-L),m=L-C/2;var rgb=[m,m,m],h6=6*H;var X;if(S!==0)switch(h6|0){case 0:;case 6:X=C*h6;rgb[0]+=C;rgb[1]+=X;break;case 1:X=C*(2-h6);rgb[0]+=X;rgb[1]+=C;break;case 2:X=C*(h6-2);rgb[1]+=C;rgb[2]+=X;break;case 3:X=C*(4-h6);rgb[1]+=X;rgb[2]+=C;break;case 4:X=C*(h6-4);rgb[2]+=C;rgb[0]+=X;break;case 5:X=C*(6-h6);rgb[2]+=X;rgb[0]+=C;break;}for(var i=0;i!=3;++i)rgb[i]=Math.round(rgb[i]*255);return rgb}function rgb_tint(hex,tint){if(tint===0)return hex;var hsl=rgb2HSL(hex2RGB(hex));if(tint<0)hsl[2]=hsl[2]*(1+tint);else hsl[2]=1-(1-hsl[2])*(1-tint);return rgb2Hex(hsl2RGB(hsl))}var DEF_MDW=6,MAX_MDW=15,MIN_MDW=1,MDW=DEF_MDW;function width2px(width){return Math.floor((width+Math.round(128/MDW)/256)*MDW)}function px2char(px){return Math.floor((px-5)/MDW*100+.5)/100}function char2width(chr){return Math.round((chr*MDW+5)/MDW*256)/256}function px2char_(px){return((px-5)/MDW*100+.5)/100}function char2width_(chr){return(chr*MDW+5)/MDW*256/256}function cycle_width(collw){return char2width(px2char(width2px(collw)))}function find_mdw_colw(collw){var delta=Math.abs(collw-cycle_width(collw)),_MDW=MDW;if(delta>.005)for(MDW=MIN_MDW;MDW<MAX_MDW;++MDW)if(Math.abs(collw-cycle_width(collw))<=delta){delta=Math.abs(collw-cycle_width(collw));_MDW=MDW}MDW=_MDW}function find_mdw_wpx(wpx){var delta=Infinity,guess=0,_MDW=MIN_MDW;for(MDW=MIN_MDW;MDW<MAX_MDW;++MDW){guess=char2width_(px2char_(wpx))*256;guess=guess%1;if(guess>.5)guess--;if(Math.abs(guess)<delta){delta=Math.abs(guess);_MDW=MDW}}MDW=_MDW}function process_col(coll){if(coll.width){coll.wpx=width2px(coll.width);coll.wch=px2char(coll.wpx);coll.MDW=MDW}else if(coll.wpx){coll.wch=px2char(coll.wpx);coll.width=char2width(coll.wch);coll.MDW=MDW}else if(typeof coll.wch=="number"){coll.width=char2width(coll.wch);coll.wpx=width2px(coll.width);coll.MDW=MDW}if(coll.customWidth)delete coll.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(px){return px*96/PPI}function pt2px(pt){return pt*PPI/96}var XLMLPatternTypeMap={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function parse_borders(t,styles,themes,opts){styles.Borders=[];var border={},sub_border={};t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<borders":;case"<borders>":;case"</borders>":break;case"<border":;case"<border>":border={};if(y.diagonalUp){border.diagonalUp=y.diagonalUp}if(y.diagonalDown){border.diagonalDown=y.diagonalDown}styles.Borders.push(border);break;case"</border>":break;case"<left/>":break;case"<left":;case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":;case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":;case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":;case"<bottom>":break;case"</bottom>":break;case"<diagonal":;case"<diagonal>":;case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":;case"<horizontal>":;case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":;case"<vertical>":;case"<vertical/>":break;case"</vertical>":break;case"<start":;case"<start>":;case"<start/>":break;case"</start>":break;case"<end":;case"<end>":;case"<end/>":break;case"</end>":break;case"<color":;case"<color>":break;case"<color/>":;case"</color>":break;default:if(opts&&opts.WTF)throw new Error("unrecognized "+y[0]+" in borders");}})}function parse_fills(t,styles,themes,opts){styles.Fills=[];var fill={};t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<fills":;case"<fills>":;case"</fills>":break;case"<fill>":;case"<fill":break;case"</fill>":styles.Fills.push(fill);fill={};break;case"<gradientFill>":break;case"</gradientFill>":styles.Fills.push(fill);fill={};break;case"<patternFill":;case"<patternFill>":if(y.patternType)fill.patternType=y.patternType;break;case"<patternFill/>":;case"</patternFill>":break;case"<bgColor":if(!fill.bgColor)fill.bgColor={};if(y.indexed)fill.bgColor.indexed=parseInt(y.indexed,10);if(y.theme)fill.bgColor.theme=parseInt(y.theme,10);if(y.tint)fill.bgColor.tint=parseFloat(y.tint);if(y.rgb)fill.bgColor.rgb=y.rgb.slice(-6);break;case"<bgColor/>":;case"</bgColor>":break;case"<fgColor":if(!fill.fgColor)fill.fgColor={};if(y.theme)fill.fgColor.theme=parseInt(y.theme,10);if(y.tint)fill.fgColor.tint=parseFloat(y.tint);if(y.rgb)fill.fgColor.rgb=y.rgb.slice(-6);break;case"<fgColor/>":;case"</fgColor>":break;case"<stop":;case"<stop/>":break;case"</stop>":break;case"<color":;case"<color/>":break;case"</color>":break;default:if(opts&&opts.WTF)throw new Error("unrecognized "+y[0]+" in fills");}})}function parse_fonts(t,styles,themes,opts){styles.Fonts=[];var font={};t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<fonts":;case"<fonts>":;case"</fonts>":break;case"<font":;case"<font>":break;case"</font>":;case"<font/>":styles.Fonts.push(font);font={};break;case"<name":if(y.val)font.name=y.val;break;case"<name/>":;case"</name>":break;case"<b":font.bold=y.val?parsexmlbool(y.val):1;break;case"<b/>":font.bold=1;break;case"<i":font.italic=y.val?parsexmlbool(y.val):1;break;case"<i/>":font.italic=1;break;case"<u":switch(y.val){case"none":font.underline=0;break;case"single":font.underline=1;break;case"double":font.underline=2;break;case"singleAccounting":font.underline=33;break;case"doubleAccounting":font.underline=34;break;}break;case"<u/>":font.underline=1;break;case"<strike":font.strike=y.val?parsexmlbool(y.val):1;break;case"<strike/>":font.strike=1;break;case"<outline":font.outline=y.val?parsexmlbool(y.val):1;break;case"<outline/>":font.outline=1;break;case"<shadow":font.shadow=y.val?parsexmlbool(y.val):1;break;case"<shadow/>":font.shadow=1;break;case"<condense":font.condense=y.val?parsexmlbool(y.val):1;break;case"<condense/>":font.condense=1;break;case"<extend":font.extend=y.val?parsexmlbool(y.val):1;break;case"<extend/>":font.extend=1;break;case"<sz":if(y.val)font.sz=+y.val;break;case"<sz/>":;case"</sz>":break;case"<vertAlign":if(y.val)font.vertAlign=y.val;break;case"<vertAlign/>":;case"</vertAlign>":break;case"<family":if(y.val)font.family=parseInt(y.val,10);break;case"<family/>":;case"</family>":break;case"<scheme":if(y.val)font.scheme=y.val;break;case"<scheme/>":;case"</scheme>":break;case"<charset":if(y.val=="1")break;y.codepage=CS2CP[parseInt(y.val,10)];break;case"<color":if(!font.color)font.color={};if(y.auto)font.color.auto=parsexmlbool(y.auto);if(y.rgb)font.color.rgb=y.rgb.slice(-6);else if(y.indexed){font.color.index=parseInt(y.indexed,10);var icv=XLSIcv[font.color.index];if(font.color.index==81)icv=XLSIcv[1];if(!icv)throw new Error(x);font.color.rgb=icv[0].toString(16)+icv[1].toString(16)+icv[2].toString(16)}else if(y.theme){font.color.theme=parseInt(y.theme,10);if(y.tint)font.color.tint=parseFloat(y.tint);if(y.theme&&themes.themeElements&&themes.themeElements.clrScheme){font.color.rgb=rgb_tint(themes.themeElements.clrScheme[font.color.theme].rgb,font.color.tint||0)}}break;case"<color/>":;case"</color>":break;default:if(opts&&opts.WTF)throw new Error("unrecognized "+y[0]+" in fonts");}})}function parse_numFmts(t,styles,opts){styles.NumberFmt=[];var k=keys(SSF._table);for(var i=0;i<k.length;++i)styles.NumberFmt[k[i]]=SSF._table[k[i]];var m=t[0].match(tagregex);if(!m)return;for(i=0;i<m.length;++i){var y=parsexmltag(m[i]);switch(y[0]){case"<numFmts":;case"</numFmts>":;case"<numFmts/>":;case"<numFmts>":break;case"<numFmt":{var f=unescapexml(utf8read(y.formatCode)),j=parseInt(y.numFmtId,10);styles.NumberFmt[j]=f;if(j>0){if(j>392){for(j=392;j>60;--j)if(styles.NumberFmt[j]==null)break;styles.NumberFmt[j]=f}SSF.load(f,j)}}break;case"</numFmt>":break;default:if(opts.WTF)throw new Error("unrecognized "+y[0]+" in numFmts");}}}function write_numFmts(NF,opts){var o=["<numFmts>"];[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)if(NF[i]!=null)o[o.length]=writextag("numFmt",null,{numFmtId:i,formatCode:escapexml(NF[i])})});if(o.length===1)return"";o[o.length]="</numFmts>";o[0]=writextag("numFmts",null,{count:o.length-2}).replace("/>",">");return o.join("")}var cellXF_uint=["numFmtId","fillId","fontId","borderId","xfId"];var cellXF_bool=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function parse_cellXfs(t,styles,opts){styles.CellXf=[];var xf;t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x),i=0;switch(y[0]){case"<cellXfs":;case"<cellXfs>":;case"<cellXfs/>":;case"</cellXfs>":break;case"<xf":;case"<xf/>":xf=y;delete xf[0];for(i=0;i<cellXF_uint.length;++i)if(xf[cellXF_uint[i]])xf[cellXF_uint[i]]=parseInt(xf[cellXF_uint[i]],10);for(i=0;i<cellXF_bool.length;++i)if(xf[cellXF_bool[i]])xf[cellXF_bool[i]]=parsexmlbool(xf[cellXF_bool[i]],"");if(xf.numFmtId>392){for(i=392;i>60;--i)if(styles.NumberFmt[xf.numFmtId]==styles.NumberFmt[i]){xf.numFmtId=i;break}}styles.CellXf.push(xf);break;case"</xf>":break;case"<alignment":;case"<alignment/>":var alignment={};if(y.vertical)alignment.vertical=y.vertical;if(y.horizontal)alignment.horizontal=y.horizontal;if(y.textRotation!=null)alignment.textRotation=y.textRotation;if(y.indent)alignment.indent=y.indent;if(y.wrapText)alignment.wrapText=y.wrapText;xf.alignment=alignment;break;case"</alignment>":break;case"<protection":;case"</protection>":;case"<protection/>":break;case"<extLst":;case"</extLst>":break;case"<ext":break;default:if(opts.WTF)throw new Error("unrecognized "+y[0]+" in cellXfs");}})}function write_cellXfs(cellXfs){var o=[];o[o.length]=writextag("cellXfs",null);cellXfs.forEach(function(c){o[o.length]=writextag("xf",null,c)});o[o.length]="</cellXfs>";if(o.length===2)return"";o[0]=writextag("cellXfs",null,{count:o.length-2}).replace("/>",">");return o.join("")}var parse_sty_xml=function make_pstyx(){var numFmtRegex=/<numFmts([^>]*)>[\S\s]*?<\/numFmts>/;var cellXfRegex=/<cellXfs([^>]*)>[\S\s]*?<\/cellXfs>/;var fillsRegex=/<fills([^>]*)>[\S\s]*?<\/fills>/;var fontsRegex=/<fonts([^>]*)>[\S\s]*?<\/fonts>/;var bordersRegex=/<borders([^>]*)>[\S\s]*?<\/borders>/;return function parse_sty_xml(data,themes,opts){var styles={};if(!data)return styles;data=data.replace(/<!--([\s\S]*?)-->/gm,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var t;if(t=data.match(numFmtRegex))parse_numFmts(t,styles,opts);if(t=data.match(fontsRegex))parse_fonts(t,styles,themes,opts);if(t=data.match(fillsRegex))parse_fills(t,styles,themes,opts);if(t=data.match(bordersRegex))parse_borders(t,styles,themes,opts);if(t=data.match(cellXfRegex))parse_cellXfs(t,styles,opts);return styles}}();var STYLES_XML_ROOT=writextag("styleSheet",null,{xmlns:XMLNS.main[0],"xmlns:vt":XMLNS.vt});RELS.STY="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles";function write_sty_xml(wb,opts){var o=[XML_HEADER,STYLES_XML_ROOT],w;if(wb.SSF&&(w=write_numFmts(wb.SSF))!=null)o[o.length]=w;o[o.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>';o[o.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>';o[o.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>';o[o.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>';if(w=write_cellXfs(opts.cellXfs))o[o.length]=w;o[o.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>';o[o.length]='<dxfs count="0"/>';o[o.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>';if(o.length>2){o[o.length]="</styleSheet>";o[1]=o[1].replace("/>",">")}return o.join("")}function parse_BrtFmt(data,length){var ifmt=data.read_shift(2);var stFmtCode=parse_XLWideString(data,length-2);return[ifmt,stFmtCode]}function write_BrtFmt(i,f,o){if(!o)o=new_buf(6+4*f.length);o.write_shift(2,i);write_XLWideString(f,o);return o.length>o.l?o.slice(0,o.l):o}function parse_BrtFont(data,length,opts){var out={};out.sz=data.read_shift(2)/20;var grbit=parse_FontFlags(data,2,opts);if(grbit.fCondense)out.condense=1;if(grbit.fExtend)out.extend=1;if(grbit.fShadow)out.shadow=1;if(grbit.fOutline)out.outline=1;if(grbit.fStrikeout)out.strike=1;if(grbit.fItalic)out.italic=1;var bls=data.read_shift(2);if(bls===700)out.bold=1;switch(data.read_shift(2)){case 1:out.vertAlign="superscript";break;case 2:out.vertAlign="subscript";break;}var underline=data.read_shift(1);if(underline!=0)out.underline=underline;var family=data.read_shift(1);if(family>0)out.family=family;var bCharSet=data.read_shift(1);if(bCharSet>0)out.charset=bCharSet;data.l++;out.color=parse_BrtColor(data,8);switch(data.read_shift(1)){case 1:out.scheme="major";break;case 2:out.scheme="minor";break;}out.name=parse_XLWideString(data,length-21);return out}function write_BrtFont(font,o){if(!o)o=new_buf(25+4*32);o.write_shift(2,font.sz*20);write_FontFlags(font,o);o.write_shift(2,font.bold?700:400);var sss=0;if(font.vertAlign=="superscript")sss=1;else if(font.vertAlign=="subscript")sss=2;o.write_shift(2,sss);o.write_shift(1,font.underline||0);o.write_shift(1,font.family||0);o.write_shift(1,font.charset||0);o.write_shift(1,0);write_BrtColor(font.color,o);var scheme=0;if(font.scheme=="major")scheme=1;if(font.scheme=="minor")scheme=2;o.write_shift(1,scheme);write_XLWideString(font.name,o);return o.length>o.l?o.slice(0,o.l):o}var XLSBFillPTNames=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];var rev_XLSBFillPTNames=evert(XLSBFillPTNames);function write_BrtFill(fill,o){if(!o)o=new_buf(4*3+8*7+16*1);var fls=rev_XLSBFillPTNames[fill.patternType];if(fls==null)fls=40;o.write_shift(4,fls);var j=0;if(fls!=40){write_BrtColor({auto:1},o);write_BrtColor({auto:1},o);for(;j<12;++j)o.write_shift(4,0)}else{for(;j<4;++j)o.write_shift(4,0);for(;j<12;++j)o.write_shift(4,0)}return o.length>o.l?o.slice(0,o.l):o}function parse_BrtXF(data,length){var ixfeParent=data.read_shift(2);var ifmt=data.read_shift(2);parsenoop(data,length-4);return{ixfe:ixfeParent,ifmt:ifmt}}function write_BrtXF(data,ixfeP,o){if(!o)o=new_buf(16);o.write_shift(2,ixfeP||0);o.write_shift(2,data.numFmtId||0);o.write_shift(2,0);o.write_shift(2,0);o.write_shift(2,0);o.write_shift(1,0);o.write_shift(1,0);o.write_shift(1,0);o.write_shift(1,0);o.write_shift(1,0);o.write_shift(1,0);return o}function write_Blxf(data,o){if(!o)o=new_buf(10);o.write_shift(1,0);o.write_shift(1,0);o.write_shift(4,0);o.write_shift(4,0);return o}function write_BrtBorder(border,o){if(!o)o=new_buf(51);o.write_shift(1,0);write_Blxf(null,o);write_Blxf(null,o);write_Blxf(null,o);write_Blxf(null,o);write_Blxf(null,o);return o.length>o.l?o.slice(0,o.l):o}function write_BrtStyle(style,o){if(!o)o=new_buf(12+4*10);o.write_shift(4,style.xfId);o.write_shift(2,1);o.write_shift(1,+style.builtinId);o.write_shift(1,0);write_XLNullableWideString(style.name||"",o);return o.length>o.l?o.slice(0,o.l):o}function write_BrtBeginTableStyles(cnt,defTableStyle,defPivotStyle){var o=new_buf(4+256*2*4);o.write_shift(4,cnt);write_XLNullableWideString(defTableStyle,o);write_XLNullableWideString(defPivotStyle,o);return o.length>o.l?o.slice(0,o.l):o}function parse_sty_bin(data,themes,opts){var styles={};styles.NumberFmt=[];for(var y in SSF._table)styles.NumberFmt[y]=SSF._table[y];styles.CellXf=[];styles.Fonts=[];var state=[];var pass=false;recordhopper(data,function hopper_sty(val,R_n,RT){switch(RT){case 44:styles.NumberFmt[val[0]]=val[1];SSF.load(val[1],val[0]);break;case 43:styles.Fonts.push(val);if(val.color.theme!=null&&themes&&themes.themeElements&&themes.themeElements.clrScheme){val.color.rgb=rgb_tint(themes.themeElements.clrScheme[val.color.theme].rgb,val.color.tint||0)}break;case 1025:break;case 45:break;case 46:break;case 47:if(state[state.length-1]=="BrtBeginCellXFs"){styles.CellXf.push(val)}break;case 48:;case 507:;case 572:;case 475:break;case 1171:;case 2102:;case 1130:;case 512:;case 2095:break;case 35:pass=true;break;case 36:pass=false;break;case 37:state.push(R_n);break;case 38:state.pop();break;default:if((R_n||"").indexOf("Begin")>0)state.push(R_n);else if((R_n||"").indexOf("End")>0)state.pop();else if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}});return styles}function write_FMTS_bin(ba,NF){if(!NF)return;var cnt=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)if(NF[i]!=null)++cnt});if(cnt==0)return;write_record(ba,"BrtBeginFmts",write_UInt32LE(cnt));[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)if(NF[i]!=null)write_record(ba,"BrtFmt",write_BrtFmt(i,NF[i]))});write_record(ba,"BrtEndFmts")}function write_FONTS_bin(ba,data){var cnt=1;if(cnt==0)return;write_record(ba,"BrtBeginFonts",write_UInt32LE(cnt));write_record(ba,"BrtFont",write_BrtFont({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"}));write_record(ba,"BrtEndFonts")}function write_FILLS_bin(ba,data){var cnt=2;if(cnt==0)return;write_record(ba,"BrtBeginFills",write_UInt32LE(cnt));write_record(ba,"BrtFill",write_BrtFill({patternType:"none"}));write_record(ba,"BrtFill",write_BrtFill({patternType:"gray125"}));write_record(ba,"BrtEndFills")}function write_BORDERS_bin(ba,data){var cnt=1;if(cnt==0)return;write_record(ba,"BrtBeginBorders",write_UInt32LE(cnt));write_record(ba,"BrtBorder",write_BrtBorder({}));write_record(ba,"BrtEndBorders")}function write_CELLSTYLEXFS_bin(ba,data){var cnt=1;write_record(ba,"BrtBeginCellStyleXFs",write_UInt32LE(cnt));write_record(ba,"BrtXF",write_BrtXF({numFmtId:0,fontId:0,fillId:0,borderId:0},65535));write_record(ba,"BrtEndCellStyleXFs")}function write_CELLXFS_bin(ba,data){write_record(ba,"BrtBeginCellXFs",write_UInt32LE(data.length));data.forEach(function(c){write_record(ba,"BrtXF",write_BrtXF(c,0))});write_record(ba,"BrtEndCellXFs")}function write_STYLES_bin(ba,data){var cnt=1;write_record(ba,"BrtBeginStyles",write_UInt32LE(1));write_record(ba,"BrtStyle",write_BrtStyle({xfId:0,builtinId:0,name:"Normal"}));write_record(ba,"BrtEndStyles")}function write_DXFS_bin(ba,data){var cnt=0;write_record(ba,"BrtBeginDXFs",write_UInt32LE(cnt));write_record(ba,"BrtEndDXFs")}function write_TABLESTYLES_bin(ba,data){var cnt=0;write_record(ba,"BrtBeginTableStyles",write_BrtBeginTableStyles(cnt,"TableStyleMedium9","PivotStyleMedium4"));write_record(ba,"BrtEndTableStyles")}function write_COLORPALETTE_bin(ba,data){return}function write_sty_bin(wb,opts){var ba=buf_array();write_record(ba,"BrtBeginStyleSheet");write_FMTS_bin(ba,wb.SSF);write_FONTS_bin(ba,wb);write_FILLS_bin(ba,wb);write_BORDERS_bin(ba,wb);write_CELLSTYLEXFS_bin(ba,wb);write_CELLXFS_bin(ba,opts.cellXfs);write_STYLES_bin(ba,wb);write_DXFS_bin(ba,wb);write_TABLESTYLES_bin(ba,wb);write_COLORPALETTE_bin(ba,wb);write_record(ba,"BrtEndStyleSheet");return ba.end()}RELS.THEME="http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme";function parse_clrScheme(t,themes,opts){themes.themeElements.clrScheme=[];var color={};(t[0].match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<a:clrScheme":;case"</a:clrScheme>":break;case"<a:srgbClr":color.rgb=y.val;break;case"<a:sysClr":color.rgb=y.lastClr;break;case"<a:dk1>":;case"</a:dk1>":;case"<a:lt1>":;case"</a:lt1>":;case"<a:dk2>":;case"</a:dk2>":;case"<a:lt2>":;case"</a:lt2>":;case"<a:accent1>":;case"</a:accent1>":;case"<a:accent2>":;case"</a:accent2>":;case"<a:accent3>":;case"</a:accent3>":;case"<a:accent4>":;case"</a:accent4>":;case"<a:accent5>":;case"</a:accent5>":;case"<a:accent6>":;case"</a:accent6>":;case"<a:hlink>":;case"</a:hlink>":;case"<a:folHlink>":;case"</a:folHlink>":if(y[0].charAt(1)==="/"){themes.themeElements.clrScheme.push(color);color={}}else{color.name=y[0].substring(3,y[0].length-1)}break;default:if(opts&&opts.WTF)throw new Error("Unrecognized "+y[0]+" in clrScheme");}})}function parse_fontScheme(t,themes,opts){}function parse_fmtScheme(t,themes,opts){}var clrsregex=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/;var fntsregex=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/;var fmtsregex=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function parse_themeElements(data,themes,opts){themes.themeElements={};var t;[["clrScheme",clrsregex,parse_clrScheme],["fontScheme",fntsregex,parse_fontScheme],["fmtScheme",fmtsregex,parse_fmtScheme]].forEach(function(m){if(!(t=data.match(m[1])))throw new Error(m[0]+" not found in themeElements");m[2](t,themes,opts)})}var themeltregex=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function parse_theme_xml(data,opts){if(!data||data.length===0)return parse_theme_xml(write_theme());var t;var themes={};if(!(t=data.match(themeltregex)))throw new Error("themeElements not found in theme");parse_themeElements(t[0],themes,opts);return themes}function write_theme(Themes,opts){if(opts&&opts.themeXLSX)return opts.themeXLSX;var o=[XML_HEADER];o[o.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">';o[o.length]="<a:themeElements>";o[o.length]='<a:clrScheme name="Office">';o[o.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>';o[o.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>';o[o.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>';o[o.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>';o[o.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>';o[o.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>';o[o.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>';o[o.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>';o[o.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>';o[o.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>';o[o.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>';o[o.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>';o[o.length]="</a:clrScheme>";o[o.length]='<a:fontScheme name="Office">';o[o.length]="<a:majorFont>";o[o.length]='<a:latin typeface="Cambria"/>';o[o.length]='<a:ea typeface=""/>';o[o.length]='<a:cs typeface=""/>';o[o.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>';o[o.length]='<a:font script="Hang" typeface="맑은 고딕"/>';o[o.length]='<a:font script="Hans" typeface="宋体"/>';o[o.length]='<a:font script="Hant" typeface="新細明體"/>';o[o.length]='<a:font script="Arab" typeface="Times New Roman"/>';o[o.length]='<a:font script="Hebr" typeface="Times New Roman"/>';o[o.length]='<a:font script="Thai" typeface="Tahoma"/>';o[o.length]='<a:font script="Ethi" typeface="Nyala"/>';o[o.length]='<a:font script="Beng" typeface="Vrinda"/>';o[o.length]='<a:font script="Gujr" typeface="Shruti"/>';o[o.length]='<a:font script="Khmr" typeface="MoolBoran"/>';o[o.length]='<a:font script="Knda" typeface="Tunga"/>';o[o.length]='<a:font script="Guru" typeface="Raavi"/>';o[o.length]='<a:font script="Cans" typeface="Euphemia"/>';o[o.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>';o[o.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>';o[o.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>';o[o.length]='<a:font script="Thaa" typeface="MV Boli"/>';o[o.length]='<a:font script="Deva" typeface="Mangal"/>';o[o.length]='<a:font script="Telu" typeface="Gautami"/>';o[o.length]='<a:font script="Taml" typeface="Latha"/>';o[o.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>';o[o.length]='<a:font script="Orya" typeface="Kalinga"/>';o[o.length]='<a:font script="Mlym" typeface="Kartika"/>';o[o.length]='<a:font script="Laoo" typeface="DokChampa"/>';o[o.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>';o[o.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>';o[o.length]='<a:font script="Viet" typeface="Times New Roman"/>';o[o.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>';o[o.length]='<a:font script="Geor" typeface="Sylfaen"/>';o[o.length]="</a:majorFont>";o[o.length]="<a:minorFont>";o[o.length]='<a:latin typeface="Calibri"/>';o[o.length]='<a:ea typeface=""/>';o[o.length]='<a:cs typeface=""/>';o[o.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>';o[o.length]='<a:font script="Hang" typeface="맑은 고딕"/>';o[o.length]='<a:font script="Hans" typeface="宋体"/>';o[o.length]='<a:font script="Hant" typeface="新細明體"/>';o[o.length]='<a:font script="Arab" typeface="Arial"/>';o[o.length]='<a:font script="Hebr" typeface="Arial"/>';o[o.length]='<a:font script="Thai" typeface="Tahoma"/>';o[o.length]='<a:font script="Ethi" typeface="Nyala"/>';o[o.length]='<a:font script="Beng" typeface="Vrinda"/>';o[o.length]='<a:font script="Gujr" typeface="Shruti"/>';o[o.length]='<a:font script="Khmr" typeface="DaunPenh"/>';o[o.length]='<a:font script="Knda" typeface="Tunga"/>';o[o.length]='<a:font script="Guru" typeface="Raavi"/>';o[o.length]='<a:font script="Cans" typeface="Euphemia"/>';o[o.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>';o[o.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>';o[o.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>';o[o.length]='<a:font script="Thaa" typeface="MV Boli"/>';o[o.length]='<a:font script="Deva" typeface="Mangal"/>';o[o.length]='<a:font script="Telu" typeface="Gautami"/>';o[o.length]='<a:font script="Taml" typeface="Latha"/>';o[o.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>';o[o.length]='<a:font script="Orya" typeface="Kalinga"/>';o[o.length]='<a:font script="Mlym" typeface="Kartika"/>';o[o.length]='<a:font script="Laoo" typeface="DokChampa"/>';o[o.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>';o[o.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>';o[o.length]='<a:font script="Viet" typeface="Arial"/>';o[o.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>';o[o.length]='<a:font script="Geor" typeface="Sylfaen"/>';o[o.length]="</a:minorFont>";o[o.length]="</a:fontScheme>";o[o.length]='<a:fmtScheme name="Office">';o[o.length]="<a:fillStyleLst>";o[o.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>';o[o.length]='<a:gradFill rotWithShape="1">';o[o.length]="<a:gsLst>";o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>';o[o.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>';o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>';o[o.length]="</a:gsLst>";o[o.length]='<a:lin ang="16200000" scaled="1"/>';o[o.length]="</a:gradFill>";o[o.length]='<a:gradFill rotWithShape="1">';o[o.length]="<a:gsLst>";o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>';o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>';o[o.length]="</a:gsLst>";o[o.length]='<a:lin ang="16200000" scaled="0"/>';o[o.length]="</a:gradFill>";o[o.length]="</a:fillStyleLst>";o[o.length]="<a:lnStyleLst>";o[o.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>';o[o.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>';o[o.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>';o[o.length]="</a:lnStyleLst>";o[o.length]="<a:effectStyleLst>";o[o.length]="<a:effectStyle>";o[o.length]="<a:effectLst>";o[o.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>';o[o.length]="</a:effectLst>";o[o.length]="</a:effectStyle>";o[o.length]="<a:effectStyle>";o[o.length]="<a:effectLst>";o[o.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>';o[o.length]="</a:effectLst>";o[o.length]="</a:effectStyle>";o[o.length]="<a:effectStyle>";o[o.length]="<a:effectLst>";o[o.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>';o[o.length]="</a:effectLst>";o[o.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>';o[o.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>';o[o.length]="</a:effectStyle>";o[o.length]="</a:effectStyleLst>";o[o.length]="<a:bgFillStyleLst>";o[o.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>';o[o.length]='<a:gradFill rotWithShape="1">';o[o.length]="<a:gsLst>";o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>';o[o.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>';o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>';o[o.length]="</a:gsLst>";o[o.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>';o[o.length]="</a:gradFill>";o[o.length]='<a:gradFill rotWithShape="1">';o[o.length]="<a:gsLst>";o[o.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>';o[o.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>';o[o.length]="</a:gsLst>";o[o.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>';o[o.length]="</a:gradFill>";o[o.length]="</a:bgFillStyleLst>";o[o.length]="</a:fmtScheme>";o[o.length]="</a:themeElements>";o[o.length]="<a:objectDefaults>";o[o.length]="<a:spDef>";o[o.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>';o[o.length]="</a:spDef>";o[o.length]="<a:lnDef>";o[o.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>';o[o.length]="</a:lnDef>";o[o.length]="</a:objectDefaults>";o[o.length]="<a:extraClrSchemeLst/>";o[o.length]="</a:theme>";return o.join("")}function parse_Theme(blob,length,opts){var dwThemeVersion=blob.read_shift(4);if(dwThemeVersion===124226)return;blob.l+=length-4}function parse_ColorTheme(blob,length){return blob.read_shift(4)}function parse_FullColorExt(blob,length){var o={};o.xclrType=blob.read_shift(2);o.nTintShade=blob.read_shift(2);switch(o.xclrType){case 0:blob.l+=4;break;case 1:o.xclrValue=parse_IcvXF(blob,4);break;case 2:o.xclrValue=parse_LongRGBA(blob,4);break;case 3:o.xclrValue=parse_ColorTheme(blob,4);break;case 4:blob.l+=4;break;}blob.l+=8;return o}function parse_IcvXF(blob,length){return parsenoop(blob,length)}function parse_XFExtGradient(blob,length){return parsenoop(blob,length)}function parse_ExtProp(blob,length){var extType=blob.read_shift(2);var cb=blob.read_shift(2);var o=[extType];switch(extType){case 4:;case 5:;case 7:;case 8:;case 9:;case 10:;case 11:;case 13:o[1]=parse_FullColorExt(blob,cb);break;case 6:o[1]=parse_XFExtGradient(blob,cb);break;case 14:;case 15:o[1]=blob.read_shift(cb===5?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+extType+" "+cb);}return o}function parse_XFExt(blob,length){var end=blob.l+length;blob.l+=2;var ixfe=blob.read_shift(2);blob.l+=2;var cexts=blob.read_shift(2);var ext=[];while(cexts-->0)ext.push(parse_ExtProp(blob,end-blob.l));return{ixfe:ixfe,ext:ext}}function update_xfext(xf,xfext){xfext.forEach(function(xfe){switch(xfe[0]){case 4:break;case 5:break;case 6:break;case 7:break;case 8:break;case 9:break;case 10:break;case 11:break;case 13:break;case 14:break;case 15:break;}})}function parse_cc_xml(data,opts){var d=[];if(!data)return d;var l=0,i=1;(data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<?xml":break;case"<calcChain":;case"<calcChain>":;case"</calcChain>":break;case"<c":delete y[0];if(y.i)i=y.i;else y.i=i;d.push(y);break;}});return d}function write_cc_xml(data,opts){}function parse_BrtCalcChainItem$(data,length){var out={};out.i=data.read_shift(4);var cell={};cell.r=data.read_shift(4);cell.c=data.read_shift(4);out.r=encode_cell(cell);var flags=data.read_shift(1);if(flags&2)out.l="1";if(flags&8)out.a="1";return out}function parse_cc_bin(data,opts){var out=[];var pass=false;recordhopper(data,function hopper_cc(val,R_n,RT){switch(RT){case 63:out.push(val);break;default:if((R_n||"").indexOf("Begin")>0){}else if((R_n||"").indexOf("End")>0){}else if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}});return out}function write_cc_bin(data,opts){}RELS.IMG="http://schemas.openxmlformats.org/officeDocument/2006/relationships/image";RELS.DRAW="http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing";function parse_drawing(data,rels){if(!data)return"??";var id=(data.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return rels["!id"][id].Target}var _shapeid=1024;function write_comments_vml(rId,comments){var csize=[21600,21600];var bbox=["m0,0l0",csize[1],csize[0],csize[1],csize[0],"0xe"].join(",");var o=[writextag("xml",null,{"xmlns:v":XLMLNS.v,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:mv":XLMLNS.mv}).replace(/\/>/,">"),writextag("o:shapelayout",writextag("o:idmap",null,{"v:ext":"edit",data:rId}),{"v:ext":"edit"}),writextag("v:shapetype",[writextag("v:stroke",null,{joinstyle:"miter"}),writextag("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:csize.join(","),path:bbox})];while(_shapeid<rId*1e3)_shapeid+=1e3;comments.map(function(x){return decode_cell(x[0])}).forEach(function(c,i){o=o.concat(["<v:shape"+wxt_helper({id:"_x0000_s"+ ++_shapeid,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10;visibility:hidden",fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",writextag("v:fill",writextag("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}),{color2:"#BEFF82",angle:"-180",type:"gradient"}),writextag("v:shadow",null,{on:"t",obscured:"t"}),writextag("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",writetag("x:Anchor",[c.c,0,c.r,0,c.c+3,100,c.r+5,100].join(",")),writetag("x:AutoFill","False"),writetag("x:Row",String(c.r)),writetag("x:Column",String(c.c)),"<x:Visible/>","</x:ClientData>","</v:shape>"])});o.push("</xml>");return o.join("")}RELS.CMNT="http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments";function parse_comments(zip,dirComments,sheets,sheetRels,opts){for(var i=0;i!=dirComments.length;++i){var canonicalpath=dirComments[i];var comments=parse_cmnt(getzipdata(zip,canonicalpath.replace(/^\//,""),true),canonicalpath,opts);if(!comments||!comments.length)continue;var sheetNames=keys(sheets);for(var j=0;j!=sheetNames.length;++j){var sheetName=sheetNames[j];var rels=sheetRels[sheetName];if(rels){var rel=rels[canonicalpath];if(rel)insertCommentsIntoSheet(sheetName,sheets[sheetName],comments)}}}}function insertCommentsIntoSheet(sheetName,sheet,comments){var dense=Array.isArray(sheet);var cell,r;comments.forEach(function(comment){if(dense){r=decode_cell(comment.ref);if(!sheet[r.r])sheet[r.r]=[];cell=sheet[r.r][r.c]}else cell=sheet[comment.ref];if(!cell){cell={};if(dense)sheet[r.r][r.c]=cell;else sheet[comment.ref]=cell;var range=safe_decode_range(sheet["!ref"]||"BDWGO1000001:A1");var thisCell=decode_cell(comment.ref);if(range.s.r>thisCell.r)range.s.r=thisCell.r;if(range.e.r<thisCell.r)range.e.r=thisCell.r;if(range.s.c>thisCell.c)range.s.c=thisCell.c;if(range.e.c<thisCell.c)range.e.c=thisCell.c;var encoded=encode_range(range);if(encoded!==sheet["!ref"])sheet["!ref"]=encoded}if(!cell.c)cell.c=[];var o={a:comment.author,t:comment.t,r:comment.r};if(comment.h)o.h=comment.h;cell.c.push(o)})}function parse_comments_xml(data,opts){if(data.match(/<(?:\w+:)?comments *\/>/))return[];var authors=[];var commentList=[];var authtag=data.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);if(authtag&&authtag[1])authtag[1].split(/<\/\w*:?author>/).forEach(function(x){if(x===""||x.trim()==="")return;var a=x.match(/<(?:\w+:)?author[^>]*>(.*)/);if(a)authors.push(a[1])});var cmnttag=data.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);if(cmnttag&&cmnttag[1])cmnttag[1].split(/<\/\w*:?comment>/).forEach(function(x,index){if(x===""||x.trim()==="")return;var cm=x.match(/<(?:\w+:)?comment[^>]*>/);if(!cm)return;var y=parsexmltag(cm[0]);var comment={author:y.authorId&&authors[y.authorId]?authors[y.authorId]:"sheetjsghost",ref:y.ref,guid:y.guid};var cell=decode_cell(y.ref);if(opts.sheetRows&&opts.sheetRows<=cell.r)return;var textMatch=x.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/);var rt=!!textMatch&&!!textMatch[1]&&parse_si(textMatch[1])||{r:"",t:"",h:""};comment.r=rt.r;if(rt.r=="<t></t>")rt.t=rt.h="";comment.t=rt.t.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(opts.cellHTML)comment.h=rt.h;commentList.push(comment)});return commentList}var CMNT_XML_ROOT=writextag("comments",null,{xmlns:XMLNS.main[0]});function write_comments_xml(data,opts){var o=[XML_HEADER,CMNT_XML_ROOT];var iauthor=[];o.push("<authors>");data.map(function(x){return x[1]}).forEach(function(comment){comment.map(function(x){return escapexml(x.a)}).forEach(function(a){if(iauthor.indexOf(a)>-1)return;iauthor.push(a);o.push("<author>"+a+"</author>")})});o.push("</authors>");o.push("<commentList>");data.forEach(function(d){d[1].forEach(function(c){o.push('<comment ref="'+d[0]+'" authorId="'+iauthor.indexOf(escapexml(c.a))+'"><text>');o.push(writetag("t",c.t==null?"":c.t));o.push("</text></comment>")})});o.push("</commentList>");if(o.length>2){o[o.length]="</comments>";o[1]=o[1].replace("/>",">")}return o.join("")}function parse_BrtBeginComment(data,length){var out={};out.iauthor=data.read_shift(4);var rfx=parse_UncheckedRfX(data,16);out.rfx=rfx.s;out.ref=encode_cell(rfx.s);data.l+=16;return out}function write_BrtBeginComment(data,o){if(o==null)o=new_buf(36);o.write_shift(4,data[1].iauthor);write_UncheckedRfX(data[0],o);o.write_shift(4,0);o.write_shift(4,0);o.write_shift(4,0);o.write_shift(4,0);return o}var parse_BrtCommentAuthor=parse_XLWideString;function parse_comments_bin(data,opts){var out=[];var authors=[];var c={};var pass=false;recordhopper(data,function hopper_cmnt(val,R_n,RT){switch(RT){case 632:authors.push(val);break;case 635:c=val;break;case 637:c.t=val.t;c.h=val.h;c.r=val.r;break;case 636:c.author=authors[c.iauthor];delete c.iauthor;if(opts.sheetRows&&opts.sheetRows<=c.rfx.r)break;if(!c.t)c.t="";delete c.rfx;out.push(c);break;case 35:pass=true;break;case 36:pass=false;break;case 37:break;case 38:break;default:if((R_n||"").indexOf("Begin")>0){}else if((R_n||"").indexOf("End")>0){}else if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}});return out}function write_comments_bin(data,opts){var ba=buf_array();var iauthor=[];write_record(ba,"BrtBeginComments");{write_record(ba,"BrtBeginCommentAuthors");data.forEach(function(comment){comment[1].forEach(function(c){if(iauthor.indexOf(c.a)>-1)return;iauthor.push(c.a.substr(0,54));write_record(ba,"BrtCommentAuthor",write_XLWideString(c.a.substr(0,54)))})});write_record(ba,"BrtEndCommentAuthors")}{write_record(ba,"BrtBeginCommentList");data.forEach(function(comment){comment[1].forEach(function(c){c.iauthor=iauthor.indexOf(c.a);var range={s:decode_cell(comment[0]),e:decode_cell(comment[0])};write_record(ba,"BrtBeginComment",write_BrtBeginComment([range,c]));if(c.t&&c.t.length>0)write_record(ba,"BrtCommentText",write_BrtCommentText(c));write_record(ba,"BrtEndComment");delete c.iauthor})});write_record(ba,"BrtEndCommentList")}write_record(ba,"BrtEndComments");return ba.end()}RELS.DS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet";RELS.MS="http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet";function parse_ds_bin(data,opts,rels,wb,themes,styles){return{"!type":"dialog"}}function parse_ds_xml(data,opts,rels,wb,themes,styles){return{"!type":"dialog"}}function parse_ms_bin(data,opts,rels,wb,themes,styles){return{"!type":"macro"}}function parse_ms_xml(data,opts,rels,wb,themes,styles){return{"!type":"macro"}}var rc_to_a1=function(){var rcregex=/(^|[^A-Za-z])R(\[?)(-?\d+|)\]?C(\[?)(-?\d+|)\]?/g;var rcbase={r:0,c:0};function rcfunc($$,$1,$2,$3,$4,$5){var R=$3.length>0?parseInt($3,10)|0:0,C=$5.length>0?parseInt($5,10)|0:0;if(C<0&&$4.length===0)C=0;var cRel=false,rRel=false;if($4.length>0||$5.length==0)cRel=true;if(cRel)C+=rcbase.c;else--C;if($2.length>0||$3.length==0)rRel=true;if(rRel)R+=rcbase.r;else--R;return $1+(cRel?"":"$")+encode_col(C)+(rRel?"":"$")+encode_row(R)}return function rc_to_a1(fstr,base){rcbase=base;return fstr.replace(rcregex,rcfunc)}}();var crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)([1-9]\d{0,5}|10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6])(?![_.\(A-Za-z0-9])/g;var a1_to_rc=function(){return function a1_to_rc(fstr,base){return fstr.replace(crefregex,function($0,$1,$2,$3,$4,$5,off,str){var c=decode_col($3)-base.c;var r=decode_row($5)-base.r;return $1+"R"+(r==0?"":"["+r+"]")+"C"+(c==0?"":"["+c+"]")})}}();function shift_formula_str(f,delta){return f.replace(crefregex,function($0,$1,$2,$3,$4,$5,off,str){return $1+($2=="$"?$2+$3:encode_col(decode_col($3)+delta.c))+($4=="$"?$4+$5:encode_row(decode_row($5)+delta.r))})}function shift_formula_xlsx(f,range,cell){var r=decode_range(range),s=r.s,c=decode_cell(cell);var delta={r:c.r-s.r,c:c.c-s.c};return shift_formula_str(f,delta)}function parseread(l){return function(blob,length){blob.l+=l;return}}function parseread1(blob){blob.l+=1;return}function parse_ColRelU(blob,length){var c=blob.read_shift(length==1?1:2);return[c&16383,c>>14&1,c>>15&1]}function parse_RgceArea(blob,length,opts){var w=2;if(opts){if(opts.biff>=2&&opts.biff<=5)return parse_RgceArea_BIFF2(blob,length,opts);else if(opts.biff==12)w=4}var r=blob.read_shift(w),R=blob.read_shift(w);var c=parse_ColRelU(blob,2);var C=parse_ColRelU(blob,2);return{s:{r:r,c:c[0],cRel:c[1],rRel:c[2]},e:{r:R,c:C[0],cRel:C[1],rRel:C[2]}}}function parse_RgceArea_BIFF2(blob){var r=parse_ColRelU(blob,2),R=parse_ColRelU(blob,2);var c=blob.read_shift(1);var C=blob.read_shift(1);return{s:{r:r[0],c:c,cRel:r[1],rRel:r[2]},e:{r:R[0],c:C,cRel:R[1],rRel:R[2]}}}function parse_RgceAreaRel(blob,length){var r=blob.read_shift(length==12?4:2),R=blob.read_shift(length==12?4:2);var c=parse_ColRelU(blob,2);var C=parse_ColRelU(blob,2);return{s:{r:r,c:c[0],cRel:c[1],rRel:c[2]},e:{r:R,c:C[0],cRel:C[1],rRel:C[2]}}}function parse_RgceLoc(blob,length,opts){if(opts&&opts.biff>=2&&opts.biff<=5)return parse_RgceLoc_BIFF2(blob,length,opts);var r=blob.read_shift(opts&&opts.biff==12?4:2);var c=parse_ColRelU(blob,2);return{r:r,c:c[0],cRel:c[1],rRel:c[2]}}function parse_RgceLoc_BIFF2(blob,length,opts){var r=parse_ColRelU(blob,2);var c=blob.read_shift(1);return{r:r[0],c:c,cRel:r[1],rRel:r[2]}}function parse_RgceLocRel(blob,length,opts){var biff=opts&&opts.biff?opts.biff:8;if(biff>=2&&biff<=5)return parse_RgceLocRel_BIFF2(blob,length,opts);var r=blob.read_shift(biff>=12?4:2);var cl=blob.read_shift(2);var cRel=(cl&32768)>>15,rRel=(cl&16384)>>14;cl&=16383;if(rRel==1)while(r>524287)r-=1048576;if(cRel==1)while(cl>8191)cl=cl-16384;return{r:r,c:cl,cRel:cRel,rRel:rRel}}function parse_RgceLocRel_BIFF2(blob,length){var rl=blob.read_shift(2);var c=blob.read_shift(1);var rRel=(rl&32768)>>15,cRel=(rl&16384)>>14;rl&=16383;if(rRel==1&&rl>=8192)rl=rl-16384;if(cRel==1&&c>=128)c=c-256;return{r:rl,c:c,cRel:cRel,rRel:rRel}}function parse_PtgArea(blob,length,opts){var type=(blob[blob.l++]&96)>>5;var area=parse_RgceArea(blob,opts.biff>=2&&opts.biff<=5?6:8,opts);return[type,area]}function parse_PtgArea3d(blob,length,opts){var type=(blob[blob.l++]&96)>>5;var ixti=blob.read_shift(2,"i");var w=8;if(opts)switch(opts.biff){case 5:blob.l+=12;w=6;break;case 12:w=12;break;}var area=parse_RgceArea(blob,w,opts);return[type,ixti,area]}function parse_PtgAreaErr(blob,length,opts){var type=(blob[blob.l++]&96)>>5;blob.l+=opts&&opts.biff>8?12:8;return[type]}function parse_PtgAreaErr3d(blob,length,opts){var type=(blob[blob.l++]&96)>>5;var ixti=blob.read_shift(2);var w=8;if(opts)switch(opts.biff){case 5:blob.l+=12;w=6;break;case 12:w=12;break;}blob.l+=w;return[type,ixti]}function parse_PtgAreaN(blob,length,opts){var type=(blob[blob.l++]&96)>>5;var area=parse_RgceAreaRel(blob,opts&&opts.biff>8?12:8,opts);return[type,area]}function parse_PtgArray(blob,length,opts){var type=(blob[blob.l++]&96)>>5;blob.l+=opts.biff==2?6:opts.biff==12?14:7;return[type]}function parse_PtgAttrBaxcel(blob,length){var bitSemi=blob[blob.l+1]&1;var bitBaxcel=1;blob.l+=4;return[bitSemi,bitBaxcel]}function parse_PtgAttrChoose(blob,length,opts){blob.l+=2;var offset=blob.read_shift(opts&&opts.biff==2?1:2);var o=[];for(var i=0;i<=offset;++i)o.push(blob.read_shift(opts&&opts.biff==2?1:2));return o}function parse_PtgAttrGoto(blob,length,opts){var bitGoto=blob[blob.l+1]&255?1:0;blob.l+=2;return[bitGoto,blob.read_shift(opts&&opts.biff==2?1:2)]}function parse_PtgAttrIf(blob,length,opts){var bitIf=blob[blob.l+1]&255?1:0;blob.l+=2;return[bitIf,blob.read_shift(opts&&opts.biff==2?1:2)]}function parse_PtgAttrIfError(blob,length){var bitIf=blob[blob.l+1]&255?1:0;blob.l+=2;return[bitIf,blob.read_shift(2)]}function parse_PtgAttrSemi(blob,length,opts){var bitSemi=blob[blob.l+1]&255?1:0;blob.l+=opts&&opts.biff==2?3:4;return[bitSemi]}function parse_PtgAttrSpaceType(blob,length){var type=blob.read_shift(1),cch=blob.read_shift(1);return[type,cch]}function parse_PtgAttrSpace(blob,length){blob.read_shift(2);return parse_PtgAttrSpaceType(blob,2)}function parse_PtgAttrSpaceSemi(blob,length){blob.read_shift(2);return parse_PtgAttrSpaceType(blob,2)}function parse_PtgRef(blob,length,opts){var ptg=blob[blob.l]&31;var type=(blob[blob.l]&96)>>5;blob.l+=1;var loc=parse_RgceLoc(blob,0,opts);return[type,loc]}function parse_PtgRefN(blob,length,opts){var type=(blob[blob.l]&96)>>5;blob.l+=1;var loc=parse_RgceLocRel(blob,0,opts);return[type,loc]}function parse_PtgRef3d(blob,length,opts){var type=(blob[blob.l]&96)>>5;blob.l+=1;var ixti=blob.read_shift(2);var loc=parse_RgceLoc(blob,0,opts);return[type,ixti,loc]}function parse_PtgFunc(blob,length,opts){var ptg=blob[blob.l]&31;var type=(blob[blob.l]&96)>>5;blob.l+=1;var iftab=blob.read_shift(opts&&opts.biff<=3?1:2);return[FtabArgc[iftab],Ftab[iftab],type]}function parse_PtgFuncVar(blob,length,opts){blob.l++;var cparams=blob.read_shift(1),tab=opts&&opts.biff<=3?[0,blob.read_shift(1)]:parsetab(blob);return[cparams,(tab[0]===0?Ftab:Cetab)[tab[1]]]}function parsetab(blob,length){return[blob[blob.l+1]>>7,blob.read_shift(2)&32767]}function parse_PtgAttrSum(blob,length,opts){blob.l+=opts&&opts.biff==2?3:4;return}var parse_PtgConcat=parseread1;function parse_PtgExp(blob,length,opts){blob.l++;if(opts&&opts.biff==12)return[blob.read_shift(4,"i"),0];var row=blob.read_shift(2);var col=blob.read_shift(opts&&opts.biff==2?1:2);return[row,col]}function parse_PtgErr(blob,length){blob.l++;return BErr[blob.read_shift(1)]}function parse_PtgInt(blob,length){blob.l++;return blob.read_shift(2)}function parse_PtgBool(blob,length){blob.l++;return blob.read_shift(1)!==0}function parse_PtgNum(blob,length){blob.l++;return parse_Xnum(blob,8)}function parse_PtgStr(blob,length,opts){blob.l++;return parse_ShortXLUnicodeString(blob,length-1,opts)}function parse_SerAr(blob,biff){var val=[blob.read_shift(1)];if(biff==12)switch(val[0]){case 2:val[0]=4;break;case 4:val[0]=16;break;case 0:val[0]=1;break;case 1:val[0]=2;break;}switch(val[0]){case 4:val[1]=parsebool(blob,1)?"TRUE":"FALSE";blob.l+=7;break;case 16:val[1]=BErr[blob[blob.l]];blob.l+=8;break;case 0:blob.l+=8;break;case 1:val[1]=parse_Xnum(blob,8);break;case 2:val[1]=parse_XLUnicodeString2(blob,0,{biff:biff>0&&biff<8?2:biff});break;}return val}function parse_PtgExtraMem(blob,cce){var count=blob.read_shift(2);var out=[];for(var i=0;i!=count;++i)out.push(parse_Ref8U(blob,8));return out}function parse_PtgExtraArray(blob,length,opts){var rows=0,cols=0;if(opts.biff==12){rows=blob.read_shift(4);cols=blob.read_shift(4)}else{cols=1+blob.read_shift(1);rows=1+blob.read_shift(2)}if(opts.biff>=2&&opts.biff<8){--rows;if(--cols==0)cols=256}for(var i=0,o=[];i!=rows&&(o[i]=[]);++i)for(var j=0;j!=cols;++j)o[i][j]=parse_SerAr(blob,opts.biff);return o}function parse_PtgName(blob,length,opts){var type=blob.read_shift(1)>>>5&3;var w=!opts||opts.biff>=8?4:2;var nameindex=blob.read_shift(w);switch(opts.biff){case 2:blob.l+=5;break;case 3:;case 4:blob.l+=8;break;case 5:blob.l+=12;break;}return[type,0,nameindex]}function parse_PtgNameX(blob,length,opts){if(opts.biff==5)return parse_PtgNameX_BIFF5(blob,length,opts);var type=blob.read_shift(1)>>>5&3;var ixti=blob.read_shift(2);var nameindex=blob.read_shift(4);return[type,ixti,nameindex]}function parse_PtgNameX_BIFF5(blob,length,opts){var type=blob.read_shift(1)>>>5&3;var ixti=blob.read_shift(2,"i");blob.l+=8;var nameindex=blob.read_shift(2);blob.l+=12;return[type,ixti,nameindex]}function parse_PtgMemArea(blob,length,opts){var type=blob.read_shift(1)>>>5&3;blob.l+=opts&&opts.biff==2?3:4;var cce=blob.read_shift(opts&&opts.biff==2?1:2);return[type,cce]}function parse_PtgMemFunc(blob,length,opts){var type=blob.read_shift(1)>>>5&3;var cce=blob.read_shift(opts&&opts.biff==2?1:2);return[type,cce]}function parse_PtgRefErr(blob,length,opts){var type=blob.read_shift(1)>>>5&3;blob.l+=4;if(opts.biff==12)blob.l+=2;return[type]}function parse_PtgRefErr3d(blob,length,opts){var type=(blob[blob.l++]&96)>>5;var ixti=blob.read_shift(2);var w=4;if(opts)switch(opts.biff){case 5:throw new Error("PtgRefErr3d -- 5");case 12:w=6;break;}blob.l+=w;return[type,ixti]}var parse_PtgAdd=parseread1;var parse_PtgDiv=parseread1;var parse_PtgEq=parseread1;var parse_PtgGe=parseread1;var parse_PtgGt=parseread1;var parse_PtgIsect=parseread1;var parse_PtgLe=parseread1;var parse_PtgLt=parseread1;var parse_PtgMissArg=parseread1;var parse_PtgMul=parseread1;var parse_PtgNe=parseread1;var parse_PtgParen=parseread1;var parse_PtgPercent=parseread1;var parse_PtgPower=parseread1;var parse_PtgRange=parseread1;var parse_PtgSub=parseread1;var parse_PtgUminus=parseread1;var parse_PtgUnion=parseread1;var parse_PtgUplus=parseread1;var parse_PtgMemErr=parsenoop;var parse_PtgMemNoMem=parsenoop;var parse_PtgTbl=parsenoop;var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parse_PtgAdd},4:{n:"PtgSub",f:parse_PtgSub},5:{n:"PtgMul",f:parse_PtgMul},6:{n:"PtgDiv",f:parse_PtgDiv},7:{n:"PtgPower",f:parse_PtgPower},8:{n:"PtgConcat",f:parse_PtgConcat},9:{n:"PtgLt",f:parse_PtgLt},10:{n:"PtgLe",f:parse_PtgLe},11:{n:"PtgEq",f:parse_PtgEq},12:{n:"PtgGe",f:parse_PtgGe},13:{n:"PtgGt",f:parse_PtgGt},14:{n:"PtgNe",f:parse_PtgNe},15:{n:"PtgIsect",f:parse_PtgIsect},16:{n:"PtgUnion",f:parse_PtgUnion},17:{n:"PtgRange",f:parse_PtgRange},18:{n:"PtgUplus",f:parse_PtgUplus},19:{n:"PtgUminus",f:parse_PtgUminus},20:{n:"PtgPercent",f:parse_PtgPercent},21:{n:"PtgParen",f:parse_PtgParen},22:{n:"PtgMissArg",f:parse_PtgMissArg},23:{n:"PtgStr",f:parse_PtgStr},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}};var PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61};(function(){for(var y in PtgDupes)PtgTypes[y]=PtgTypes[PtgDupes[y]]})();var Ptg18={};var Ptg19={1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_Formula(blob,length,opts){var end=blob.l+length;var cell=parse_XLSCell(blob,6);if(opts.biff==2)++blob.l;var val=parse_FormulaValue(blob,8);var flags=blob.read_shift(1);if(opts.biff!=2){blob.read_shift(1);if(opts.biff>=5){var chn=blob.read_shift(4)}}var cbf=parse_XLSCellParsedFormula(blob,end-blob.l,opts);return{cell:cell,val:val[0],formula:cbf,shared:flags>>3&1,tt:val[1]}}function parse_FormulaValue(blob){var b;if(__readUInt16LE(blob,blob.l+6)!==65535)return[parse_Xnum(blob),"n"];switch(blob[blob.l]){case 0:blob.l+=8;return["String","s"];case 1:b=blob[blob.l+2]===1;blob.l+=8;return[b,"b"];case 2:b=blob[blob.l+2];blob.l+=8;return[b,"e"];case 3:blob.l+=8;return["","s"];}return[]}function parse_RgbExtra(blob,length,rgce,opts){if(opts.biff<8)return parsenoop(blob,length);var target=blob.l+length;var o=[];for(var i=0;i!==rgce.length;++i){switch(rgce[i][0]){case"PtgArray":rgce[i][1]=parse_PtgExtraArray(blob,0,opts);o.push(rgce[i][1]);break;case"PtgMemArea":rgce[i][2]=parse_PtgExtraMem(blob,rgce[i][1]);o.push(rgce[i][2]);break;case"PtgExp":if(opts&&opts.biff==12){rgce[i][1][1]=blob.read_shift(4);o.push(rgce[i][1])}break;default:break;}}length=target-blob.l;if(length!==0)o.push(parsenoop(blob,length));return o}function parse_NameParsedFormula(blob,length,opts,cce){var target=blob.l+length;var rgce=parse_Rgce(blob,cce,opts);var rgcb;if(target!==blob.l)rgcb=parse_RgbExtra(blob,target-blob.l,rgce,opts);return[rgce,rgcb]}function parse_XLSCellParsedFormula(blob,length,opts){var target=blob.l+length,len=opts.biff==2?1:2;var rgcb,cce=blob.read_shift(len);if(cce==65535)return[[],parsenoop(blob,length-2)];var rgce=parse_Rgce(blob,cce,opts);if(length!==cce+len)rgcb=parse_RgbExtra(blob,length-cce-len,rgce,opts);return[rgce,rgcb]}function parse_SharedParsedFormula(blob,length,opts){var target=blob.l+length;var rgcb,cce=blob.read_shift(2);var rgce=parse_Rgce(blob,cce,opts);if(cce==65535)return[[],parsenoop(blob,length-2)];if(length!==cce+2)rgcb=parse_RgbExtra(blob,target-cce-2,rgce,opts);return[rgce,rgcb]}function parse_ArrayParsedFormula(blob,length,opts,ref){var target=blob.l+length,len=opts.biff==2?1:2;var rgcb,cce=blob.read_shift(len);if(cce==65535)return[[],parsenoop(blob,length-2)];var rgce=parse_Rgce(blob,cce,opts);if(length!==cce+len)rgcb=parse_RgbExtra(blob,length-cce-len,rgce,opts);return[rgce,rgcb]}function parse_Rgce(blob,length,opts){var target=blob.l+length;var R,id,ptgs=[];while(target!=blob.l){length=target-blob.l;id=blob[blob.l];R=PtgTypes[id];if(id===24||id===25){id=blob[blob.l+1];R=(id===24?Ptg18:Ptg19)[id]}if(!R||!R.f){parsenoop(blob,length)}else{ptgs.push([R.n,R.f(blob,length,opts)])}}return ptgs}function stringify_array(f){var o=[];for(var i=0;i<f.length;++i){var x=f[i],r=[];for(var j=0;j<x.length;++j){var y=x[j];if(y)switch(y[0]){case 2:r.push('"'+y[1].replace(/"/g,'""')+'"');break;default:r.push(y[1]);}else r.push("")}o.push(r.join(","))}return o.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function stringify_formula(formula,range,cell,supbooks,opts){var _range={s:{c:0,r:0},e:{c:0,r:0}};var stack=[],e1,e2,type,c,ixti=0,nameidx=0,r,sname="";if(!formula[0]||!formula[0][0])return"";var last_sp=-1,sp="";for(var ff=0,fflen=formula[0].length;ff<fflen;++ff){var f=formula[0][ff];switch(f[0]){case"PtgUminus":stack.push("-"+stack.pop());break;case"PtgUplus":stack.push("+"+stack.pop());break;case"PtgPercent":stack.push(stack.pop()+"%");break;case"PtgAdd":;case"PtgConcat":;case"PtgDiv":;case"PtgEq":;case"PtgGe":;case"PtgGt":;case"PtgLe":;case"PtgLt":;case"PtgMul":;case"PtgNe":;case"PtgPower":;case"PtgSub":e1=stack.pop();e2=stack.pop();if(last_sp>=0){switch(formula[0][last_sp][1][0]){case 0:sp=fill(" ",formula[0][last_sp][1][1]);break;case 1:sp=fill("\r",formula[0][last_sp][1][1]);break;default:sp="";if(opts.WTF)throw new Error("Unexpected PtgAttrSpaceType "+formula[0][last_sp][1][0]);}e2=e2+sp;last_sp=-1}stack.push(e2+PtgBinOp[f[0]]+e1);break;case"PtgIsect":e1=stack.pop();e2=stack.pop();stack.push(e2+" "+e1);break;case"PtgUnion":e1=stack.pop();e2=stack.pop();stack.push(e2+","+e1);break;case"PtgRange":e1=stack.pop();e2=stack.pop();stack.push(e2+":"+e1);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":type=f[1][0];c=shift_cell_xls(f[1][1],_range,opts);stack.push(encode_cell_xls(c));break;case"PtgRefN":type=f[1][0];c=cell?shift_cell_xls(f[1][1],cell,opts):f[1][1];stack.push(encode_cell_xls(c));break;case"PtgRef3d":type=f[1][0];ixti=f[1][1];c=shift_cell_xls(f[1][2],_range,opts);sname=supbooks.SheetNames[ixti];var w=sname;stack.push(sname+"!"+encode_cell_xls(c));break;case"PtgFunc":;case"PtgFuncVar":var argc=f[1][0],func=f[1][1];if(!argc)argc=0;var args=argc==0?[]:stack.slice(-argc);stack.length-=argc;if(func==="User")func=args.shift();stack.push(func+"("+args.join(",")+")");break;case"PtgBool":stack.push(f[1]?"TRUE":"FALSE");break;case"PtgInt":stack.push(f[1]);break;case"PtgNum":stack.push(String(f[1]));break;case"PtgStr":stack.push('"'+f[1]+'"');break;case"PtgErr":stack.push(f[1]);break;case"PtgAreaN":type=f[1][0];r=shift_range_xls(f[1][1],_range,opts);stack.push(encode_range_xls(r,opts));break;case"PtgArea":type=f[1][0];r=shift_range_xls(f[1][1],_range,opts);stack.push(encode_range_xls(r,opts));break;case"PtgArea3d":type=f[1][0];ixti=f[1][1];r=f[1][2];sname=supbooks&&supbooks[1]?supbooks[1][ixti+1]:"**MISSING**";stack.push(sname+"!"+encode_range(r));break;case"PtgAttrSum":stack.push("SUM("+stack.pop()+")");break;case"PtgAttrSemi":break;case"PtgName":nameidx=f[1][2];var lbl=(supbooks.names||[])[nameidx-1]||(supbooks[0]||[])[nameidx];var name=lbl?lbl.Name:"**MISSING**"+String(nameidx);if(name in XLSXFutureFunctions)name=XLSXFutureFunctions[name];stack.push(name);break;case"PtgNameX":var bookidx=f[1][1];nameidx=f[1][2];var externbook;if(opts.biff<=5){if(bookidx<0)bookidx=-bookidx;if(supbooks[bookidx])externbook=supbooks[bookidx][nameidx]}else{var pnxname=supbooks.SheetNames[bookidx];var o="";if(((supbooks[bookidx]||[])[0]||[])[0]==14849){}else if(((supbooks[bookidx]||[])[0]||[])[0]==1025){if(supbooks[bookidx][nameidx]&&supbooks[bookidx][nameidx].itab>0){o=supbooks.SheetNames[supbooks[bookidx][nameidx].itab-1]+"!"}}else o=supbooks.SheetNames[nameidx-1]+"!";if(supbooks[bookidx]&&supbooks[bookidx][nameidx])o+=supbooks[bookidx][nameidx].Name;else if(supbooks[0]&&supbooks[0][nameidx])o+=supbooks[0][nameidx].Name;else o+="??NAMEX??";stack.push(o);break}if(!externbook)externbook={Name:"??NAMEX??"};stack.push(externbook.Name);break;case"PtgParen":var lp="(",rp=")";if(last_sp>=0){sp="";switch(formula[0][last_sp][1][0]){case 2:lp=fill(" ",formula[0][last_sp][1][1])+lp;break;case 3:lp=fill("\r",formula[0][last_sp][1][1])+lp;break;case 4:rp=fill(" ",formula[0][last_sp][1][1])+rp;break;case 5:rp=fill("\r",formula[0][last_sp][1][1])+rp;break;default:if(opts.WTF)throw new Error("Unexpected PtgAttrSpaceType "+formula[0][last_sp][1][0]);}last_sp=-1}stack.push(lp+stack.pop()+rp);break;case"PtgRefErr":stack.push("#REF!");break;case"PtgRefErr3d":stack.push("#REF!");break;case"PtgExp":c={c:f[1][1],r:f[1][0]};var q={c:cell.c,r:cell.r};if(supbooks.sharedf[encode_cell(c)]){var parsedf=supbooks.sharedf[encode_cell(c)];stack.push(stringify_formula(parsedf,_range,q,supbooks,opts))}else{var fnd=false;for(e1=0;e1!=supbooks.arrayf.length;++e1){e2=supbooks.arrayf[e1];if(c.c<e2[0].s.c||c.c>e2[0].e.c)continue;if(c.r<e2[0].s.r||c.r>e2[0].e.r)continue;stack.push(stringify_formula(e2[1],_range,q,supbooks,opts));fnd=true;break}if(!fnd)stack.push(f[1])}break;case"PtgArray":stack.push("{"+stringify_array(f[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":;case"PtgAttrSpaceSemi":last_sp=ff;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":stack.push("");break;case"PtgAreaErr":stack.push("#REF!");break;case"PtgAreaErr3d":stack.push("#REF!");break;case"PtgMemFunc":break;default:throw new Error("Unrecognized Formula Token: "+String(f));}var PtgNonDisp=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(last_sp>=0&&PtgNonDisp.indexOf(formula[0][ff][0])==-1){f=formula[0][last_sp];var _left=true;switch(f[1][0]){case 4:_left=false;case 0:sp=fill(" ",f[1][1]);break;case 5:_left=false;case 1:sp=fill("\r",f[1][1]);break;default:sp="";if(opts.WTF)throw new Error("Unexpected PtgAttrSpaceType "+f[1][0]);}stack.push((_left?sp:"")+stack.pop()+(_left?"":sp));last_sp=-1}}if(stack.length>1&&opts.WTF)throw new Error("bad formula stack");return stack[0]}function parse_XLSBParsedFormula(data,length,opts){var end=data.l+length;var cce=data.read_shift(4);var rgce=parse_Rgce(data,cce,opts);var cb=data.read_shift(4);var rgcb=cb>0?parse_RgbExtra(data,cb,rgce,opts):null;return[rgce,rgcb]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula;var parse_XLSBCellParsedFormula=parse_XLSBParsedFormula;var parse_XLSBNameParsedFormula=parse_XLSBParsedFormula;var parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula;var PtgDataType={1:"REFERENCE",2:"VALUE",3:"ARRAY"};var Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"};var Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"};var FtabArgc={2:1,3:1,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,90:1,97:2,98:1,99:1,101:3,102:3,105:1,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};var XLSXFutureFunctions={"_xlfn.ACOT":"ACOT","_xlfn.ACOTH":"ACOTH","_xlfn.AGGREGATE":"AGGREGATE","_xlfn.ARABIC":"ARABIC","_xlfn.AVERAGEIF":"AVERAGEIF","_xlfn.AVERAGEIFS":"AVERAGEIFS","_xlfn.BASE":"BASE","_xlfn.BETA.DIST":"BETA.DIST","_xlfn.BETA.INV":"BETA.INV","_xlfn.BINOM.DIST":"BINOM.DIST","_xlfn.BINOM.DIST.RANGE":"BINOM.DIST.RANGE","_xlfn.BINOM.INV":"BINOM.INV","_xlfn.BITAND":"BITAND","_xlfn.BITLSHIFT":"BITLSHIFT","_xlfn.BITOR":"BITOR","_xlfn.BITRSHIFT":"BITRSHIFT","_xlfn.BITXOR":"BITXOR","_xlfn.CEILING.MATH":"CEILING.MATH","_xlfn.CEILING.PRECISE":"CEILING.PRECISE","_xlfn.CHISQ.DIST":"CHISQ.DIST","_xlfn.CHISQ.DIST.RT":"CHISQ.DIST.RT","_xlfn.CHISQ.INV":"CHISQ.INV","_xlfn.CHISQ.INV.RT":"CHISQ.INV.RT","_xlfn.CHISQ.TEST":"CHISQ.TEST","_xlfn.COMBINA":"COMBINA","_xlfn.CONFIDENCE.NORM":"CONFIDENCE.NORM","_xlfn.CONFIDENCE.T":"CONFIDENCE.T","_xlfn.COT":"COT","_xlfn.COTH":"COTH","_xlfn.COUNTIFS":"COUNTIFS","_xlfn.COVARIANCE.P":"COVARIANCE.P","_xlfn.COVARIANCE.S":"COVARIANCE.S","_xlfn.CSC":"CSC","_xlfn.CSCH":"CSCH","_xlfn.DAYS":"DAYS","_xlfn.DECIMAL":"DECIMAL","_xlfn.ECMA.CEILING":"ECMA.CEILING","_xlfn.ERF.PRECISE":"ERF.PRECISE","_xlfn.ERFC.PRECISE":"ERFC.PRECISE","_xlfn.EXPON.DIST":"EXPON.DIST","_xlfn.F.DIST":"F.DIST","_xlfn.F.DIST.RT":"F.DIST.RT","_xlfn.F.INV":"F.INV","_xlfn.F.INV.RT":"F.INV.RT","_xlfn.F.TEST":"F.TEST","_xlfn.FILTERXML":"FILTERXML","_xlfn.FLOOR.MATH":"FLOOR.MATH","_xlfn.FLOOR.PRECISE":"FLOOR.PRECISE","_xlfn.FORMULATEXT":"FORMULATEXT","_xlfn.GAMMA":"GAMMA","_xlfn.GAMMA.DIST":"GAMMA.DIST","_xlfn.GAMMA.INV":"GAMMA.INV","_xlfn.GAMMALN.PRECISE":"GAMMALN.PRECISE","_xlfn.GAUSS":"GAUSS","_xlfn.HYPGEOM.DIST":"HYPGEOM.DIST","_xlfn.IFNA":"IFNA","_xlfn.IFERROR":"IFERROR","_xlfn.IMCOSH":"IMCOSH","_xlfn.IMCOT":"IMCOT","_xlfn.IMCSC":"IMCSC","_xlfn.IMCSCH":"IMCSCH","_xlfn.IMSEC":"IMSEC","_xlfn.IMSECH":"IMSECH","_xlfn.IMSINH":"IMSINH","_xlfn.IMTAN":"IMTAN","_xlfn.ISFORMULA":"ISFORMULA","_xlfn.ISO.CEILING":"ISO.CEILING","_xlfn.ISOWEEKNUM":"ISOWEEKNUM","_xlfn.LOGNORM.DIST":"LOGNORM.DIST","_xlfn.LOGNORM.INV":"LOGNORM.INV","_xlfn.MODE.MULT":"MODE.MULT","_xlfn.MODE.SNGL":"MODE.SNGL","_xlfn.MUNIT":"MUNIT","_xlfn.NEGBINOM.DIST":"NEGBINOM.DIST","_xlfn.NETWORKDAYS.INTL":"NETWORKDAYS.INTL","_xlfn.NIGBINOM":"NIGBINOM","_xlfn.NORM.DIST":"NORM.DIST","_xlfn.NORM.INV":"NORM.INV","_xlfn.NORM.S.DIST":"NORM.S.DIST","_xlfn.NORM.S.INV":"NORM.S.INV","_xlfn.NUMBERVALUE":"NUMBERVALUE","_xlfn.PDURATION":"PDURATION","_xlfn.PERCENTILE.EXC":"PERCENTILE.EXC","_xlfn.PERCENTILE.INC":"PERCENTILE.INC","_xlfn.PERCENTRANK.EXC":"PERCENTRANK.EXC","_xlfn.PERCENTRANK.INC":"PERCENTRANK.INC","_xlfn.PERMUTATIONA":"PERMUTATIONA","_xlfn.PHI":"PHI","_xlfn.POISSON.DIST":"POISSON.DIST","_xlfn.QUARTILE.EXC":"QUARTILE.EXC","_xlfn.QUARTILE.INC":"QUARTILE.INC","_xlfn.QUERYSTRING":"QUERYSTRING","_xlfn.RANK.AVG":"RANK.AVG","_xlfn.RANK.EQ":"RANK.EQ","_xlfn.RRI":"RRI","_xlfn.SEC":"SEC","_xlfn.SECH":"SECH","_xlfn.SHEET":"SHEET","_xlfn.SHEETS":"SHEETS","_xlfn.SKEW.P":"SKEW.P","_xlfn.STDEV.P":"STDEV.P","_xlfn.STDEV.S":"STDEV.S","_xlfn.SUMIFS":"SUMIFS","_xlfn.T.DIST":"T.DIST","_xlfn.T.DIST.2T":"T.DIST.2T","_xlfn.T.DIST.RT":"T.DIST.RT","_xlfn.T.INV":"T.INV","_xlfn.T.INV.2T":"T.INV.2T","_xlfn.T.TEST":"T.TEST","_xlfn.UNICHAR":"UNICHAR","_xlfn.UNICODE":"UNICODE","_xlfn.VAR.P":"VAR.P","_xlfn.VAR.S":"VAR.S","_xlfn.WEBSERVICE":"WEBSERVICE","_xlfn.WEIBULL.DIST":"WEIBULL.DIST","_xlfn.WORKDAY.INTL":"WORKDAY.INTL","_xlfn.XOR":"XOR","_xlfn.Z.TEST":"Z.TEST"};function ods_to_csf_formula(f){if(f.substr(0,3)=="of:")f=f.substr(3);if(f.charCodeAt(0)==61){f=f.substr(1);if(f.charCodeAt(0)==61)f=f.substr(1)}f=f.replace(/COM\.MICROSOFT\./g,"");f=f.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function($$,$1){return $1.replace(/\./g,"")});f=f.replace(/\[.(#[A-Z]*[?!])\]/g,"$1");return f.replace(/[;~]/g,",").replace(/\|/g,";")}function csf_to_ods_formula(f){var o="of:="+f.replace(crefregex,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return o.replace(/;/g,"|").replace(/,/g,";")}function ods_to_csf_range_3D(r){var a=r.split(":");var s=a[0].split(".")[0];return[s,a[0].split(".")[1]+":"+a[1].split(".")[1]]}var strs={};var _ssfopts={};RELS.WS=["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"];function get_sst_id(sst,str){for(var i=0,len=sst.length;i<len;++i)if(sst[i].t===str){sst.Count++;return i}sst[len]={t:str};sst.Count++;sst.Unique++;return len}function col_obj_w(C,col){var p={min:C+1,max:C+1};var wch=-1;if(col.MDW)MDW=col.MDW;if(col.width!=null)p.customWidth=1;else if(col.wpx!=null)wch=px2char(col.wpx);else if(col.wch!=null)wch=col.wch;if(wch>-1){p.width=char2width(wch);p.customWidth=1}else if(col.width!=null)p.width=col.width;if(col.hidden)p.hidden=true;return p}function default_margins(margins,mode){if(!margins)return;var defs=[.7,.7,.75,.75,.3,.3];if(mode=="xlml")defs=[1,1,1,1,.5,.5];if(margins.left==null)margins.left=defs[0];if(margins.right==null)margins.right=defs[1];if(margins.top==null)margins.top=defs[2];if(margins.bottom==null)margins.bottom=defs[3];if(margins.header==null)margins.header=defs[4];if(margins.footer==null)margins.footer=defs[5]}function get_cell_style(styles,cell,opts){var z=opts.revssf[cell.z!=null?cell.z:"General"];var i=60,len=styles.length;if(z==null&&opts.ssf){for(;i<392;++i)if(opts.ssf[i]==null){SSF.load(cell.z,i);opts.ssf[i]=cell.z;opts.revssf[cell.z]=z=i;break}}for(i=0;i!=len;++i)if(styles[i].numFmtId===z)return i;styles[len]={numFmtId:z,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1};return len}function safe_format(p,fmtid,fillid,opts,themes,styles){if(p.t==="z")return;if(p.t==="d"&&typeof p.v==="string")p.v=parseDate(p.v);try{if(opts.cellNF)p.z=SSF._table[fmtid]}catch(e){if(opts.WTF)throw e}if(!opts||opts.cellText!==false)try{if(p.t==="e")p.w=p.w||BErr[p.v];else if(fmtid===0){if(p.t==="n"){if((p.v|0)===p.v)p.w=SSF._general_int(p.v,_ssfopts);else p.w=SSF._general_num(p.v,_ssfopts)}else if(p.t==="d"){var dd=datenum(p.v);if((dd|0)===dd)p.w=SSF._general_int(dd,_ssfopts);else p.w=SSF._general_num(dd,_ssfopts)}else if(p.v===undefined)return"";else p.w=SSF._general(p.v,_ssfopts)}else if(p.t==="d")p.w=SSF.format(fmtid,datenum(p.v),_ssfopts);else p.w=SSF.format(fmtid,p.v,_ssfopts)}catch(e){if(opts.WTF)throw e}if(fillid)try{p.s=styles.Fills[fillid];if(p.s.fgColor&&p.s.fgColor.theme&&!p.s.fgColor.rgb){p.s.fgColor.rgb=rgb_tint(themes.themeElements.clrScheme[p.s.fgColor.theme].rgb,p.s.fgColor.tint||0);if(opts.WTF)p.s.fgColor.raw_rgb=themes.themeElements.clrScheme[p.s.fgColor.theme].rgb}if(p.s.bgColor&&p.s.bgColor.theme){p.s.bgColor.rgb=rgb_tint(themes.themeElements.clrScheme[p.s.bgColor.theme].rgb,p.s.bgColor.tint||0);if(opts.WTF)p.s.bgColor.raw_rgb=themes.themeElements.clrScheme[p.s.bgColor.theme].rgb}}catch(e){if(opts.WTF)throw e}}function parse_ws_xml_dim(ws,s){var d=safe_decode_range(s);if(d.s.r<=d.e.r&&d.s.c<=d.e.c&&d.s.r>=0&&d.s.c>=0)ws["!ref"]=encode_range(d)}var mergecregex=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g;var sheetdataregex=/<(?:\w+:)?sheetData>([\s\S]*)<\/(?:\w+:)?sheetData>/;var hlinkregex=/<(?:\w:)?hyperlink [^>]*>/gm;var dimregex=/"(\w*:\w*)"/;var colregex=/<(?:\w:)?col[^>]*[\/]?>/g;var afregex=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g;var marginregex=/<(?:\w:)?pageMargins[^>]*\/>/g;function parse_ws_xml(data,opts,rels,wb,themes,styles){if(!data)return data;if(DENSE!=null&&opts.dense==null)opts.dense=DENSE;var s=opts.dense?[]:{};var refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}};var data1="",data2="";var mtch=data.match(sheetdataregex);if(mtch){data1=data.substr(0,mtch.index);data2=data.substr(mtch.index+mtch[0].length)}else data1=data2=data;var ridx=(data1.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(ridx>0){var ref=data1.substr(ridx,50).match(dimregex);if(ref)parse_ws_xml_dim(s,ref[1])}var columns=[];if(opts.cellStyles){var cols=data1.match(colregex);if(cols)parse_ws_xml_cols(columns,cols)}if(mtch)parse_ws_xml_data(mtch[1],s,opts,refguess,themes,styles);var afilter=data2.match(afregex);if(afilter)s["!autofilter"]=parse_ws_xml_autofilter(afilter[0]);var mergecells=[];var merges=data2.match(mergecregex);if(merges)for(ridx=0;ridx!=merges.length;++ridx)mergecells[ridx]=safe_decode_range(merges[ridx].substr(merges[ridx].indexOf('"')+1));var hlink=data2.match(hlinkregex);if(hlink)parse_ws_xml_hlinks(s,hlink,rels);var margins=data2.match(marginregex);if(margins)s["!margins"]=parse_ws_xml_margins(parsexmltag(margins[0]));if(!s["!ref"]&&refguess.e.c>=refguess.s.c&&refguess.e.r>=refguess.s.r)s["!ref"]=encode_range(refguess);if(opts.sheetRows>0&&s["!ref"]){var tmpref=safe_decode_range(s["!ref"]);if(opts.sheetRows<+tmpref.e.r){tmpref.e.r=opts.sheetRows-1;if(tmpref.e.r>refguess.e.r)tmpref.e.r=refguess.e.r;if(tmpref.e.r<tmpref.s.r)tmpref.s.r=tmpref.e.r;if(tmpref.e.c>refguess.e.c)tmpref.e.c=refguess.e.c;if(tmpref.e.c<tmpref.s.c)tmpref.s.c=tmpref.e.c;s["!fullref"]=s["!ref"];s["!ref"]=encode_range(tmpref)}}if(columns.length>0)s["!cols"]=columns;if(mergecells.length>0)s["!merges"]=mergecells;return s}function write_ws_xml_merges(merges){if(merges.length==0)return"";var o='<mergeCells count="'+merges.length+'">';for(var i=0;i!=merges.length;++i)o+='<mergeCell ref="'+encode_range(merges[i])+'"/>';return o+"</mergeCells>"}function write_ws_xml_protection(sp){var o={sheet:1};var deffalse=["objects","scenarios","selectLockedCells","selectUnlockedCells"];var deftrue=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];deffalse.forEach(function(n){if(sp[n]!=null&&sp[n])o[n]="1"});deftrue.forEach(function(n){if(sp[n]!=null&&!sp[n])o[n]="0"});if(sp.password)o.password=crypto_CreatePasswordVerifier_Method1(sp.password).toString(16).toUpperCase();return writextag("sheetProtection",null,o)}function parse_ws_xml_hlinks(s,data,rels){var dense=Array.isArray(s);for(var i=0;i!=data.length;++i){var val=parsexmltag(utf8read(data[i]),true);if(!val.ref)return;var rel=rels?rels["!id"][val.id]:null;if(rel){val.Target=rel.Target;if(val.location)val.Target+="#"+val.location;val.Rel=rel}else{val.Target=val.location;rel={Target:val.location,TargetMode:"Internal"};val.Rel=rel}if(val.tooltip){val.Tooltip=val.tooltip;delete val.tooltip}var rng=safe_decode_range(val.ref);for(var R=rng.s.r;R<=rng.e.r;++R)for(var C=rng.s.c;C<=rng.e.c;++C){var addr=encode_cell({c:C,r:R});if(dense){if(!s[R])s[R]=[];if(!s[R][C])s[R][C]={t:"z",v:undefined};s[R][C].l=val}else{if(!s[addr])s[addr]={t:"z",v:undefined};s[addr].l=val}}}}function parse_ws_xml_margins(margin){var o={};["left","right","top","bottom","header","footer"].forEach(function(k){if(margin[k])o[k]=parseFloat(margin[k])});return o}function write_ws_xml_margins(margin){default_margins(margin);return writextag("pageMargins",null,margin)}function parse_ws_xml_cols(columns,cols){var seencol=false;for(var coli=0;coli!=cols.length;++coli){var coll=parsexmltag(cols[coli],true);if(coll.hidden)coll.hidden=parsexmlbool(coll.hidden);var colm=parseInt(coll.min,10)-1,colM=parseInt(coll.max,10)-1;delete coll.min;delete coll.max;coll.width=+coll.width;if(!seencol&&coll.width){seencol=true;find_mdw_colw(coll.width)}process_col(coll);while(colm<=colM)columns[colm++]=dup(coll)}}function write_ws_xml_cols(ws,cols){var o=["<cols>"],col,width;for(var i=0;i!=cols.length;++i){if(!(col=cols[i]))continue;o[o.length]=writextag("col",null,col_obj_w(i,col))}o[o.length]="</cols>";return o.join("")}function parse_ws_xml_autofilter(data){var o={ref:(data.match(/ref="([^"]*)"/)||[])[1]};return o}function write_ws_xml_autofilter(data){return writextag("autoFilter",null,{ref:data.ref})}function write_ws_xml_sheetviews(ws,opts,idx,wb){return writextag("sheetViews",writextag("sheetView",null,{workbookViewId:"0"}),{})}function write_ws_xml_cell(cell,ref,ws,opts,idx,wb){if(cell.v===undefined&&cell.f===undefined||cell.t==="z")return"";var vv="";var oldt=cell.t,oldv=cell.v;switch(cell.t){case"b":vv=cell.v?"1":"0";break;case"n":vv=""+cell.v;break;case"e":vv=BErr[cell.v];break;case"d":if(opts.cellDates)vv=parseDate(cell.v,-1).toISOString();else{cell.t="n";vv=""+(cell.v=datenum(parseDate(cell.v)))}if(typeof cell.z==="undefined")cell.z=SSF._table[14];break;default:vv=cell.v;break;}var v=writetag("v",escapexml(vv)),o={r:ref};var os=get_cell_style(opts.cellXfs,cell,opts);if(os!==0)o.s=os;switch(cell.t){case"n":break;case"d":o.t="d";break;case"b":o.t="b";break;case"e":o.t="e";break;default:if(cell.v==null){delete cell.t;break}if(opts.bookSST){v=writetag("v",""+get_sst_id(opts.Strings,cell.v));o.t="s";break}o.t="str";break;}if(cell.t!=oldt){cell.t=oldt;cell.v=oldv}if(cell.f){var ff=cell.F&&cell.F.substr(0,ref.length)==ref?{t:"array",ref:cell.F}:null;v=writextag("f",escapexml(cell.f),ff)+(cell.v!=null?v:"")}if(cell.l)ws["!links"].push([ref,cell.l]);if(cell.c)ws["!comments"].push([ref,cell.c]);return writextag("c",v,o)}var parse_ws_xml_data=function parse_ws_xml_data_factory(){var cellregex=/<(?:\w+:)?c[ >]/,rowregex=/<\/(?:\w+:)?row>/;var rregex=/r=["']([^"']*)["']/,isregex=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/;var refregex=/ref=["']([^"']*)["']/;var match_v=matchtag("v"),match_f=matchtag("f");return function parse_ws_xml_data(sdata,s,opts,guess,themes,styles){var ri=0,x="",cells=[],cref=[],idx=0,i=0,cc=0,d="",p;var tag,tagr=0,tagc=0;var sstr,ftag;var fmtid=0,fillid=0;var do_format=Array.isArray(styles.CellXf),cf;var arrayf=[];var sharedf=[];var dense=Array.isArray(s);var rows=[],rowobj={},rowrite=false;for(var marr=sdata.split(rowregex),mt=0,marrlen=marr.length;mt!=marrlen;++mt){x=marr[mt].trim();var xlen=x.length;if(xlen===0)continue;for(ri=0;ri<xlen;++ri)if(x.charCodeAt(ri)===62)break;++ri;tag=parsexmltag(x.substr(0,ri),true);tagr=tag.r!=null?parseInt(tag.r,10):tagr+1;tagc=-1;if(opts.sheetRows&&opts.sheetRows<tagr)continue;if(guess.s.r>tagr-1)guess.s.r=tagr-1;if(guess.e.r<tagr-1)guess.e.r=tagr-1;if(opts&&opts.cellStyles){rowobj={};rowrite=false;if(tag.ht){rowrite=true;rowobj.hpt=parseFloat(tag.ht);rowobj.hpx=pt2px(rowobj.hpt)}if(tag.hidden=="1"){rowrite=true;rowobj.hidden=true}if(tag.outlineLevel!=null){rowrite=true;rowobj.level=+tag.outlineLevel}if(rowrite)rows[tagr-1]=rowobj}cells=x.substr(ri).split(cellregex);for(ri=0;ri!=cells.length;++ri){x=cells[ri].trim();if(x.length===0)continue;cref=x.match(rregex);idx=ri;i=0;cc=0;x="<c "+(x.substr(0,1)=="<"?">":"")+x;if(cref!=null&&cref.length===2){idx=0;d=cref[1];for(i=0;i!=d.length;++i){if((cc=d.charCodeAt(i)-64)<1||cc>26)break;idx=26*idx+cc}--idx;tagc=idx}else++tagc;for(i=0;i!=x.length;++i)if(x.charCodeAt(i)===62)break;++i;tag=parsexmltag(x.substr(0,i),true);if(!tag.r)tag.r=encode_cell({r:tagr-1,c:tagc});d=x.substr(i);p={t:""};if((cref=d.match(match_v))!=null&&cref[1]!=="")p.v=unescapexml(cref[1]);if(opts.cellFormula){if((cref=d.match(match_f))!=null&&cref[1]!==""){p.f=unescapexml(utf8read(cref[1])).replace(/_xlfn\./,"");if(cref[0].indexOf('t="array"')>-1){p.F=(d.match(refregex)||[])[1];if(p.F.indexOf(":")>-1)arrayf.push([safe_decode_range(p.F),p.F])}else if(cref[0].indexOf('t="shared"')>-1){ftag=parsexmltag(cref[0]);sharedf[parseInt(ftag.si,10)]=[ftag,unescapexml(utf8read(cref[1]))]}}else if(cref=d.match(/<f[^>]*\/>/)){ftag=parsexmltag(cref[0]);if(sharedf[ftag.si])p.f=shift_formula_xlsx(sharedf[ftag.si][1],sharedf[ftag.si][0].ref,tag.r)}var _tag=decode_cell(tag.r);for(i=0;i<arrayf.length;++i)if(_tag.r>=arrayf[i][0].s.r&&_tag.r<=arrayf[i][0].e.r)if(_tag.c>=arrayf[i][0].s.c&&_tag.c<=arrayf[i][0].e.c)p.F=arrayf[i][1]}if(tag.t==null&&p.v===undefined){if(p.f||p.F){p.v=0;p.t="n"}else if(!opts.sheetStubs)continue;else p.t="z"}else p.t=tag.t||"n";if(guess.s.c>idx)guess.s.c=idx;if(guess.e.c<idx)guess.e.c=idx;switch(p.t){case"n":p.v=parseFloat(p.v);break;case"s":if(typeof p.v=="undefined"){if(!opts.sheetStubs)continue;p.t="z"}else{sstr=strs[parseInt(p.v,10)];p.v=sstr.t;p.r=sstr.r;if(opts.cellHTML)p.h=sstr.h}break;case"str":p.t="s";p.v=p.v!=null?utf8read(p.v):"";if(opts.cellHTML)p.h=escapehtml(p.v);break;case"inlineStr":cref=d.match(isregex);p.t="s";if(cref!=null&&(sstr=parse_si(cref[1])))p.v=sstr.t;else p.v="";break;case"b":p.v=parsexmlbool(p.v);break;case"d":if(opts.cellDates)p.v=parseDate(p.v,1);else{p.v=datenum(parseDate(p.v,1));p.t="n"}break;case"e":if(!opts||opts.cellText!==false)p.w=p.v;p.v=RBErr[p.v];break;}fmtid=fillid=0;if(do_format&&tag.s!==undefined){cf=styles.CellXf[tag.s];if(cf!=null){if(cf.numFmtId!=null)fmtid=cf.numFmtId;if(opts.cellStyles){if(cf.fillId!=null)fillid=cf.fillId}}}safe_format(p,fmtid,fillid,opts,themes,styles);if(opts.cellDates&&do_format&&p.t=="n"&&SSF.is_date(SSF._table[fmtid])){p.t="d";p.v=numdate(p.v)}if(dense){var _r=decode_cell(tag.r);if(!s[_r.r])s[_r.r]=[];s[_r.r][_r.c]=p}else s[tag.r]=p}}if(rows.length>0)s["!rows"]=rows}}();function write_ws_xml_data(ws,opts,idx,wb,rels){var o=[],r=[],range=safe_decode_range(ws["!ref"]),cell,ref,rr="",cols=[],R=0,C=0,rows=ws["!rows"];var dense=Array.isArray(ws);for(C=range.s.c;C<=range.e.c;++C)cols[C]=encode_col(C);for(R=range.s.r;R<=range.e.r;++R){r=[];rr=encode_row(R);for(C=range.s.c;C<=range.e.c;++C){ref=cols[C]+rr;var _cell=dense?(ws[R]||[])[C]:ws[ref];if(_cell===undefined)continue;if((cell=write_ws_xml_cell(_cell,ref,ws,opts,idx,wb))!=null)r.push(cell)}if(r.length>0||rows&&rows[R]){var params={r:rr};if(rows&&rows[R]){var row=rows[R];if(row.hidden)params.hidden=1;var height=-1;if(row.hpx)height=px2pt(row.hpx);else if(row.hpt)height=row.hpt;if(height>-1){params.ht=height;params.customHeight=1}if(row.level){params.outlineLevel=row.level}}o[o.length]=writextag("row",r.join(""),params)}}if(rows)for(;R<rows.length;++R){if(rows&&rows[R]){var params={r:R+1};var row=rows[R];if(row.hidden)params.hidden=1;var height=-1;if(row.hpx)height=px2pt(row.hpx);else if(row.hpt)height=row.hpt;if(height>-1){params.ht=height;params.customHeight=1}if(row.level){params.outlineLevel=row.level}o[o.length]=writextag("row","",params)}}return o.join("")}var WS_XML_ROOT=writextag("worksheet",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function write_ws_xml(idx,opts,wb,rels){var o=[XML_HEADER,WS_XML_ROOT];var s=wb.SheetNames[idx],sidx=0,rdata="";var ws=wb.Sheets[s];if(ws==null)ws={};var ref=ws["!ref"];if(ref==null)ref="A1";if(!rels)rels={};ws["!comments"]=[];ws["!drawing"]=[];o[o.length]=writextag("sheetPr",null,{codeName:escapexml(wb.SheetNames[idx])});o[o.length]=writextag("dimension",null,{ref:ref});o[o.length]=write_ws_xml_sheetviews(ws,opts,idx,wb);if(opts.sheetFormat)o[o.length]=writextag("sheetFormatPr",null,{defaultRowHeight:opts.sheetFormat.defaultRowHeight||"16",baseColWidth:opts.sheetFormat.baseColWidth||"10",outlineLevelRow:opts.sheetFormat.outlineLevelRow||"7"});if(ws["!cols"]!=null&&ws["!cols"].length>0)o[o.length]=write_ws_xml_cols(ws,ws["!cols"]);o[sidx=o.length]="<sheetData/>";ws["!links"]=[];if(ws["!ref"]!=null){rdata=write_ws_xml_data(ws,opts,idx,wb,rels);if(rdata.length>0)o[o.length]=rdata}if(o.length>sidx+1){o[o.length]="</sheetData>";o[sidx]=o[sidx].replace("/>",">")}if(ws["!protect"]!=null)o[o.length]=write_ws_xml_protection(ws["!protect"]);if(ws["!autofilter"]!=null)o[o.length]=write_ws_xml_autofilter(ws["!autofilter"]);if(ws["!merges"]!=null&&ws["!merges"].length>0)o[o.length]=write_ws_xml_merges(ws["!merges"]);var relc=-1,rel,rId=-1;if(ws["!links"].length>0){o[o.length]="<hyperlinks>";ws["!links"].forEach(function(l){if(!l[1].Target)return;rId=add_rels(rels,-1,escapexml(l[1].Target).replace(/#.*$/,""),RELS.HLINK);rel={ref:l[0],"r:id":"rId"+rId};if((relc=l[1].Target.indexOf("#"))>-1)rel.location=escapexml(l[1].Target.substr(relc+1));if(l[1].Tooltip)rel.tooltip=escapexml(l[1].Tooltip);o[o.length]=writextag("hyperlink",null,rel)});o[o.length]="</hyperlinks>"}delete ws["!links"];if(ws["!margins"]!=null)o[o.length]=write_ws_xml_margins(ws["!margins"]);var hfidx=o.length;o[o.length]="";if(ws["!drawing"].length>0){rId=add_rels(rels,-1,"../drawings/drawing"+(idx+1)+".xml",RELS.DRAW);o[o.length]=writextag("drawing",null,{"r:id":"rId"+rId})}else delete ws["!drawing"];if(ws["!comments"].length>0){rId=add_rels(rels,-1,"../drawings/vmlDrawing"+(idx+1)+".vml",RELS.VML);o[o.length]=writextag("legacyDrawing",null,{"r:id":"rId"+rId});ws["!legacy"]=rId}if(o.length>2){o[o.length]="</worksheet>";o[1]=o[1].replace("/>",">")}return o.join("")}function parse_BrtRowHdr(data,length){var z={};var tgt=data.l+length;z.r=data.read_shift(4);data.l+=4;var miyRw=data.read_shift(2);data.l+=1;var flags=data.read_shift(1);data.l=tgt;if(flags&7)z.level=flags&7;if(flags&16)z.hidden=true;if(flags&32)z.hpt=miyRw/20;return z}function write_BrtRowHdr(R,range,ws){var o=new_buf(17+8*16);var row=(ws["!rows"]||[])[R]||{};o.write_shift(4,R);o.write_shift(4,0);var miyRw=320;if(row.hpx)miyRw=px2pt(row.hpx)*20;else if(row.hpt)miyRw=row.hpt*20;o.write_shift(2,miyRw);o.write_shift(1,0);var flags=0;if(row.level)flags|=row.level;if(row.hidden)flags|=16;if(row.hpx||row.hpt)flags|=32;o.write_shift(1,flags);o.write_shift(1,0);var ncolspan=0,lcs=o.l;o.l+=4;var caddr={r:R,c:0};for(var i=0;i<16;++i){if(range.s.c>i+1<<10||range.e.c<i<<10)continue;var first=-1,last=-1;for(var j=i<<10;j<i+1<<10;++j){caddr.c=j;var cell=Array.isArray(ws)?(ws[caddr.r]||[])[caddr.c]:ws[encode_cell(caddr)];if(cell){if(first<0)first=j;last=j}}if(first<0)continue;++ncolspan;o.write_shift(4,first);o.write_shift(4,last)}var l=o.l;o.l=lcs;o.write_shift(4,ncolspan);o.l=l;return o.length>o.l?o.slice(0,o.l):o}function write_row_header(ba,ws,range,R){var o=write_BrtRowHdr(R,range,ws);if(o.length>17||(ws["!rows"]||[])[R])write_record(ba,"BrtRowHdr",o)}var parse_BrtWsDim=parse_UncheckedRfX;var write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsProp(data,length){var z={};data.l+=19;z.name=parse_XLSBCodeName(data,length-19);return z}function write_BrtWsProp(str,o){if(o==null)o=new_buf(84+4*str.length);for(var i=0;i<3;++i)o.write_shift(1,0);write_BrtColor({auto:1},o);o.write_shift(-4,-1);o.write_shift(-4,-1);write_XLSBCodeName(str,o);return o.slice(0,o.l)}function parse_BrtCellBlank(data,length){var cell=parse_XLSBCell(data);return[cell]}function write_BrtCellBlank(cell,ncell,o){if(o==null)o=new_buf(8);return write_XLSBCell(ncell,o)}function parse_BrtCellBool(data,length){var cell=parse_XLSBCell(data);var fBool=data.read_shift(1);return[cell,fBool,"b"]}function write_BrtCellBool(cell,ncell,o){if(o==null)o=new_buf(9);write_XLSBCell(ncell,o);o.write_shift(1,cell.v?1:0);return o}function parse_BrtCellError(data,length){var cell=parse_XLSBCell(data);var bError=data.read_shift(1);return[cell,bError,"e"]}function parse_BrtCellIsst(data,length){var cell=parse_XLSBCell(data);var isst=data.read_shift(4);return[cell,isst,"s"]}function write_BrtCellIsst(cell,ncell,o){if(o==null)o=new_buf(12);write_XLSBCell(ncell,o);o.write_shift(4,ncell.v);return o}function parse_BrtCellReal(data,length){var cell=parse_XLSBCell(data);var value=parse_Xnum(data);return[cell,value,"n"]}function write_BrtCellReal(cell,ncell,o){if(o==null)o=new_buf(16);write_XLSBCell(ncell,o);write_Xnum(cell.v,o);return o}function parse_BrtCellRk(data,length){var cell=parse_XLSBCell(data);var value=parse_RkNumber(data);return[cell,value,"n"]}function write_BrtCellRk(cell,ncell,o){if(o==null)o=new_buf(12);write_XLSBCell(ncell,o);write_RkNumber(cell.v,o);return o}function parse_BrtCellSt(data,length){var cell=parse_XLSBCell(data);var value=parse_XLWideString(data);return[cell,value,"str"]}function write_BrtCellSt(cell,ncell,o){if(o==null)o=new_buf(12+4*cell.v.length);write_XLSBCell(ncell,o);write_XLWideString(cell.v,o);return o.length>o.l?o.slice(0,o.l):o}function parse_BrtFmlaBool(data,length,opts){var end=data.l+length;var cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=data.read_shift(1);var o=[cell,value,"b"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}function parse_BrtFmlaError(data,length,opts){var end=data.l+length;var cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=data.read_shift(1);var o=[cell,value,"e"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}function parse_BrtFmlaNum(data,length,opts){var end=data.l+length;var cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=parse_Xnum(data);var o=[cell,value,"n"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}function parse_BrtFmlaString(data,length,opts){var end=data.l+length;var cell=parse_XLSBCell(data);cell.r=opts["!row"];var value=parse_XLWideString(data);var o=[cell,value,"str"];if(opts.cellFormula){data.l+=2;var formula=parse_XLSBCellParsedFormula(data,end-data.l,opts);o[3]=stringify_formula(formula,null,cell,opts.supbooks,opts)}else data.l=end;return o}var parse_BrtMergeCell=parse_UncheckedRfX;var write_BrtMergeCell=write_UncheckedRfX;function write_BrtBeginMergeCells(cnt,o){if(o==null)o=new_buf(4);o.write_shift(4,cnt);return o}function parse_BrtHLink(data,length,opts){var end=data.l+length;var rfx=parse_UncheckedRfX(data,16);var relId=parse_XLNullableWideString(data);var loc=parse_XLWideString(data);var tooltip=parse_XLWideString(data);var display=parse_XLWideString(data);data.l=end;return{rfx:rfx,relId:relId,loc:loc,Tooltip:tooltip,display:display}}function write_BrtHLink(l,rId,o){if(o==null)o=new_buf(50+4*l[1].Target.length);write_UncheckedRfX({s:decode_cell(l[0]),e:decode_cell(l[0])},o);write_RelID("rId"+rId,o);var locidx=l[1].Target.indexOf("#");var loc=locidx==-1?"":l[1].Target.substr(locidx+1);write_XLWideString(loc||"",o);write_XLWideString(l[1].Tooltip||"",o);write_XLWideString("",o);return o.slice(0,o.l)}function parse_BrtArrFmla(data,length,opts){var end=data.l+length;var rfx=parse_RfX(data,16);var fAlwaysCalc=data.read_shift(1);var o=[rfx];o[2]=fAlwaysCalc;if(opts.cellFormula){var formula=parse_XLSBArrayParsedFormula(data,end-data.l,opts);o[1]=formula}else data.l=end;return o}function parse_BrtShrFmla(data,length,opts){var end=data.l+length;var rfx=parse_UncheckedRfX(data,16);var o=[rfx];if(opts.cellFormula){var formula=parse_XLSBSharedParsedFormula(data,end-data.l,opts);o[1]=formula;data.l=end}else data.l=end;return o}function write_BrtColInfo(C,col,o){if(o==null)o=new_buf(18);var p=col_obj_w(C,col);o.write_shift(-4,C);o.write_shift(-4,C);o.write_shift(4,(p.width||10)*256);o.write_shift(4,0);var flags=0;if(col.hidden)flags|=1;if(typeof p.width=="number")flags|=2;o.write_shift(1,flags);o.write_shift(1,0);return o}function parse_BrtMargins(data,length,opts){return{left:parse_Xnum(data,8),right:parse_Xnum(data,8),top:parse_Xnum(data,8),bottom:parse_Xnum(data,8),header:parse_Xnum(data,8),footer:parse_Xnum(data,8)}}function write_BrtMargins(margins,o){if(o==null)o=new_buf(6*8);default_margins(margins);write_Xnum(margins.left,o);write_Xnum(margins.right,o);write_Xnum(margins.top,o);write_Xnum(margins.bottom,o);write_Xnum(margins.header,o);write_Xnum(margins.footer,o);return o}function write_BrtBeginWsView(ws,o){if(o==null)o=new_buf(30);o.write_shift(2,924);o.write_shift(4,0);o.write_shift(4,0);o.write_shift(4,0);o.write_shift(1,0);o.write_shift(1,0);o.write_shift(2,0);o.write_shift(2,100);o.write_shift(2,0);o.write_shift(2,0);o.write_shift(2,0);o.write_shift(4,0);return o}function write_BrtSheetProtection(sp,o){if(o==null)o=new_buf(16*4+2);o.write_shift(2,sp.password?crypto_CreatePasswordVerifier_Method1(sp.password):0);o.write_shift(4,1);[["objects",false],["scenarios",false],["formatCells",true],["formatColumns",true],["formatRows",true],["insertColumns",true],["insertRows",true],["insertHyperlinks",true],["deleteColumns",true],["deleteRows",true],["selectLockedCells",false],["sort",true],["autoFilter",true],["pivotTables",true],["selectUnlockedCells",false]].forEach(function(n){if(n[1])o.write_shift(4,sp[n[0]]!=null&&!sp[n[0]]?1:0);else o.write_shift(4,sp[n[0]]!=null&&sp[n[0]]?0:1)});return o}function parse_ws_bin(data,_opts,rels,wb,themes,styles){if(!data)return data;var opts=_opts||{};if(!rels)rels={"!id":{}};if(DENSE!=null&&opts.dense==null)opts.dense=DENSE;var s=opts.dense?[]:{};var ref;var refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}};var pass=false,end=false;var row,p,cf,R,C,addr,sstr,rr,cell;var mergecells=[];opts.biff=12;opts["!row"]=0;var ai=0,af=false;var array_formulae=[];var shared_formulae={};var supbooks=[[]];supbooks.sharedf=shared_formulae;supbooks.arrayf=array_formulae;supbooks.SheetNames=wb.SheetNames||wb.Sheets.map(function(x){return x.name});opts.supbooks=supbooks;for(var i=0;i<wb.Names.length;++i)supbooks[0][i+1]=wb.Names[i];var colinfo=[],rowinfo=[];var defwidth=0,defheight=0;var seencol=false;recordhopper(data,function ws_parse(val,R_n,RT){if(end)return;switch(RT){case 148:ref=val;break;case 0:row=val;if(opts.sheetRows&&opts.sheetRows<=row.r)end=true;rr=encode_row(R=row.r);opts["!row"]=row.r;if(val.hidden||val.hpt||val.level!=null){if(val.hpt)val.hpx=pt2px(val.hpt);rowinfo[val.r]=val}break;case 2:;case 3:;case 4:;case 5:;case 6:;case 7:;case 8:;case 9:;case 10:;case 11:p={t:val[2]};switch(val[2]){case"n":p.v=val[1];break;case"s":sstr=strs[val[1]];p.v=sstr.t;p.r=sstr.r;break;case"b":p.v=val[1]?true:false;break;case"e":p.v=val[1];if(opts.cellText!==false)p.w=BErr[p.v];break;case"str":p.t="s";p.v=utf8read(val[1]);break;}if(cf=styles.CellXf[val[0].iStyleRef])safe_format(p,cf.ifmt,null,opts,themes,styles);C=val[0].c;if(opts.dense){if(!s[R])s[R]=[];s[R][C]=p}else s[encode_col(C)+rr]=p;if(opts.cellFormula){af=false;for(ai=0;ai<array_formulae.length;++ai){var aii=array_formulae[ai];if(row.r>=aii[0].s.r&&row.r<=aii[0].e.r)if(C>=aii[0].s.c&&C<=aii[0].e.c){p.F=encode_range(aii[0]);af=true}}if(!af&&val.length>3)p.f=val[3]}if(refguess.s.r>row.r)refguess.s.r=row.r;if(refguess.s.c>C)refguess.s.c=C;if(refguess.e.r<row.r)refguess.e.r=row.r;if(refguess.e.c<C)refguess.e.c=C;if(opts.cellDates&&cf&&p.t=="n"&&SSF.is_date(SSF._table[cf.ifmt])){var _d=SSF.parse_date_code(p.v);if(_d){p.t="d";p.v=new Date(_d.y,_d.m-1,_d.d,_d.H,_d.M,_d.S,_d.u)}}break;case 1:if(!opts.sheetStubs||pass)break;p={t:"z",v:undefined};C=val[0].c;if(opts.dense){if(!s[R])s[R]=[];s[R][C]=p}else s[encode_col(C)+rr]=p;if(refguess.s.r>row.r)refguess.s.r=row.r;if(refguess.s.c>C)refguess.s.c=C;if(refguess.e.r<row.r)refguess.e.r=row.r;if(refguess.e.c<C)refguess.e.c=C;break;case 176:mergecells.push(val);break;case 494:var rel=rels["!id"][val.relId];if(rel){val.Target=rel.Target;if(val.loc)val.Target+="#"+val.loc;val.Rel=rel}for(R=val.rfx.s.r;R<=val.rfx.e.r;++R)for(C=val.rfx.s.c;C<=val.rfx.e.c;++C){if(opts.dense){if(!s[R])s[R]=[];if(!s[R][C])s[R][C]={t:"z",v:undefined};s[R][C].l=val}else{addr=encode_cell({c:C,r:R});if(!s[addr])s[addr]={t:"z",v:undefined};s[addr].l=val}}break;case 426:if(!opts.cellFormula)break;array_formulae.push(val);cell=opts.dense?s[R][C]:s[encode_col(C)+rr];cell.f=stringify_formula(val[1],refguess,{r:row.r,c:C},supbooks,opts);cell.F=encode_range(val[0]);break;case 427:if(!opts.cellFormula)break;shared_formulae[encode_cell(val[0].s)]=val[1];cell=opts.dense?s[R][C]:s[encode_col(C)+rr];cell.f=stringify_formula(val[1],refguess,{r:row.r,c:C},supbooks,opts);break;case 60:if(!opts.cellStyles)break;while(val.e>=val.s){colinfo[val.e--]={width:val.w/256,hidden:!!(val.flags&1)};if(!seencol){seencol=true;find_mdw_colw(val.w/256)}process_col(colinfo[val.e+1])}break;case 161:s["!autofilter"]={ref:encode_range(val)};break;case 476:s["!margins"]=val;break;case 485:;case 175:;case 644:;case 625:;case 562:;case 396:;case 1112:;case 1146:;case 471:;case 1050:;case 649:;case 1105:;case 49:;case 589:;case 607:;case 564:;case 1055:;case 168:;case 174:;case 1180:;case 499:;case 64:;case 1053:;case 550:;case 171:;case 167:;case 1177:;case 169:;case 1181:;case 551:;case 552:;case 661:;case 639:;case 478:;case 151:;case 537:;case 477:;case 536:;case 1103:;case 680:;case 1104:;case 1024:;case 152:;case 663:;case 535:;case 678:;case 504:;case 1043:;case 428:;case 170:;case 50:;case 2070:;case 1045:;case 147:break;case 35:pass=true;break;case 36:pass=false;break;case 37:break;case 38:break;default:if((R_n||"").indexOf("Begin")>0){}else if((R_n||"").indexOf("End")>0){}else if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}},opts);delete opts.supbooks;delete opts["!row"];if(!s["!ref"]&&(refguess.s.r<2e6||ref&&(ref.e.r>0||ref.e.c>0||ref.s.r>0||ref.s.c>0)))s["!ref"]=encode_range(ref||refguess);if(opts.sheetRows&&s["!ref"]){var tmpref=safe_decode_range(s["!ref"]);if(opts.sheetRows<+tmpref.e.r){tmpref.e.r=opts.sheetRows-1;if(tmpref.e.r>refguess.e.r)tmpref.e.r=refguess.e.r;if(tmpref.e.r<tmpref.s.r)tmpref.s.r=tmpref.e.r;if(tmpref.e.c>refguess.e.c)tmpref.e.c=refguess.e.c;if(tmpref.e.c<tmpref.s.c)tmpref.s.c=tmpref.e.c;s["!fullref"]=s["!ref"];s["!ref"]=encode_range(tmpref)}}if(mergecells.length>0)s["!merges"]=mergecells;if(colinfo.length>0)s["!cols"]=colinfo;if(rowinfo.length>0)s["!rows"]=rowinfo;return s}function write_ws_bin_cell(ba,cell,R,C,opts,ws){if(cell.v===undefined)return"";var vv="";var olddate=null;switch(cell.t){case"b":vv=cell.v?"1":"0";break;case"d":cell.z=cell.z||SSF._table[14];olddate=cell.v;cell.v=datenum(cell.v);cell.t="n";break;case"n":;case"e":vv=""+cell.v;break;default:vv=cell.v;break;}var o={r:R,c:C};o.s=get_cell_style(opts.cellXfs,cell,opts);if(cell.l)ws["!links"].push([encode_cell(o),cell.l]);if(cell.c)ws["!comments"].push([encode_cell(o),cell.c]);switch(cell.t){case"s":;case"str":if(opts.bookSST){vv=get_sst_id(opts.Strings,cell.v);o.t="s";o.v=vv;write_record(ba,"BrtCellIsst",write_BrtCellIsst(cell,o))}else{o.t="str";write_record(ba,"BrtCellSt",write_BrtCellSt(cell,o))}return;case"n":if(cell.v==(cell.v|0)&&cell.v>-1e3&&cell.v<1e3)write_record(ba,"BrtCellRk",write_BrtCellRk(cell,o));else write_record(ba,"BrtCellReal",write_BrtCellReal(cell,o));if(olddate){cell.t="d";cell.v=olddate}return;case"b":o.t="b";write_record(ba,"BrtCellBool",write_BrtCellBool(cell,o));return;case"e":o.t="e";break;}write_record(ba,"BrtCellBlank",write_BrtCellBlank(cell,o))}function write_CELLTABLE(ba,ws,idx,opts,wb){var range=safe_decode_range(ws["!ref"]||"A1"),ref,rr="",cols=[];write_record(ba,"BrtBeginSheetData");var dense=Array.isArray(ws);var cap=range.e.r;if(ws["!rows"])cap=Math.max(range.e.r,ws["!rows"].length-1);for(var R=range.s.r;R<=cap;++R){rr=encode_row(R);write_row_header(ba,ws,range,R);if(R<=range.e.r)for(var C=range.s.c;C<=range.e.c;++C){if(R===range.s.r)cols[C]=encode_col(C);ref=cols[C]+rr;var cell=dense?(ws[R]||[])[C]:ws[ref];if(!cell)continue;write_ws_bin_cell(ba,cell,R,C,opts,ws)}}write_record(ba,"BrtEndSheetData")}function write_MERGECELLS(ba,ws){if(!ws||!ws["!merges"])return;write_record(ba,"BrtBeginMergeCells",write_BrtBeginMergeCells(ws["!merges"].length));ws["!merges"].forEach(function(m){write_record(ba,"BrtMergeCell",write_BrtMergeCell(m))});write_record(ba,"BrtEndMergeCells")}function write_COLINFOS(ba,ws,idx,opts,wb){if(!ws||!ws["!cols"])return;write_record(ba,"BrtBeginColInfos");ws["!cols"].forEach(function(m,i){if(m)write_record(ba,"BrtColInfo",write_BrtColInfo(i,m))});write_record(ba,"BrtEndColInfos")}function write_HLINKS(ba,ws,rels){ws["!links"].forEach(function(l){if(!l[1].Target)return;var rId=add_rels(rels,-1,l[1].Target.replace(/#.*$/,""),RELS.HLINK);write_record(ba,"BrtHLink",write_BrtHLink(l,rId))});delete ws["!links"]}function write_LEGACYDRAWING(ba,ws,idx,rels){if(ws["!comments"].length>0){var rId=add_rels(rels,-1,"../drawings/vmlDrawing"+(idx+1)+".vml",RELS.VML);write_record(ba,"BrtLegacyDrawing",write_RelID("rId"+rId));ws["!legacy"]=rId}}function write_AUTOFILTER(ba,ws){if(!ws["!autofilter"])return;write_record(ba,"BrtBeginAFilter",write_UncheckedRfX(decode_range(ws["!autofilter"].ref)));write_record(ba,"BrtEndAFilter")}function write_WSVIEWS2(ba,ws){write_record(ba,"BrtBeginWsViews");{write_record(ba,"BrtBeginWsView",write_BrtBeginWsView(ws));write_record(ba,"BrtEndWsView")}write_record(ba,"BrtEndWsViews")}function write_WSFMTINFO(ba,ws){}function write_SHEETPROTECT(ba,ws){if(!ws["!protect"])return;write_record(ba,"BrtSheetProtection",write_BrtSheetProtection(ws["!protect"]))}function write_ws_bin(idx,opts,wb,rels){var ba=buf_array();var s=wb.SheetNames[idx],ws=wb.Sheets[s]||{};var r=safe_decode_range(ws["!ref"]||"A1");ws["!links"]=[];ws["!comments"]=[];write_record(ba,"BrtBeginSheet");write_record(ba,"BrtWsProp",write_BrtWsProp(s));write_record(ba,"BrtWsDim",write_BrtWsDim(r));write_WSVIEWS2(ba,ws);write_WSFMTINFO(ba,ws);write_COLINFOS(ba,ws,idx,opts,wb);write_CELLTABLE(ba,ws,idx,opts,wb);write_SHEETPROTECT(ba,ws);write_AUTOFILTER(ba,ws);write_MERGECELLS(ba,ws);write_HLINKS(ba,ws,rels);if(ws["!margins"])write_record(ba,"BrtMargins",write_BrtMargins(ws["!margins"]));write_LEGACYDRAWING(ba,ws,idx,rels);write_record(ba,"BrtEndSheet");return ba.end()}function parse_numCache(data){var col=[];(data.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/gm)||[]).forEach(function(pt){var q=pt.match(/<c:pt idx="(.*?)"><c:v>(.*)<\/c:v><\/c:pt>/);if(!q)return;col[+q[1]]=+q[2]});var nf=unescapexml((data.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return[col,nf]}function parse_chart(data,name,opts,rels,wb,csheet){var cs=csheet||{"!type":"chart"};if(!data)return csheet;var C=0,R=0,col="A";var refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}};(data.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(nc){var cache=parse_numCache(nc);refguess.s.r=refguess.s.c=0;refguess.e.c=C;col=encode_col(C);cache[0].forEach(function(n,i){cs[col+encode_row(i)]={t:"n",v:n,z:cache[1]};R=i});if(refguess.e.r<R)refguess.e.r=R;++C});if(C>0)cs["!ref"]=encode_range(refguess);return cs}RELS.CS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet";var CS_XML_ROOT=writextag("chartsheet",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function parse_cs_xml(data,opts,rels,wb,themes,styles){if(!data)return data;if(!rels)rels={"!id":{}};var s={"!type":"chart","!chart":null,"!rel":""};var m;if(m=data.match(/drawing r:id="(.*?)"/))s["!rel"]=m[1];if(rels["!id"][s["!rel"]])s["!chart"]=rels["!id"][s["!rel"]];return s}function write_cs_xml(idx,opts,wb,rels){var o=[XML_HEADER,CS_XML_ROOT];o[o.length]=writextag("drawing",null,{"r:id":"rId1"});add_rels(rels,-1,"../drawings/drawing"+(idx+1)+".xml",RELS.DRAW);if(o.length>2){o[o.length]="</chartsheet>";o[1]=o[1].replace("/>",">")}return o.join("")}function parse_cs_bin(data,opts,rels,wb,themes,styles){if(!data)return data;if(!rels)rels={"!id":{}};var s={"!type":"chart","!chart":null,"!rel":""};var state=[];var pass=false;recordhopper(data,function cs_parse(val,R_n,RT){switch(RT){case 550:s["!rel"]=val;break;case 562:;case 652:;case 651:;case 669:;case 679:;case 551:;case 552:;case 476:break;case 35:pass=true;break;case 36:pass=false;break;case 37:state.push(R_n);break;case 38:state.pop();break;default:if((R_n||"").indexOf("Begin")>0)state.push(R_n);else if((R_n||"").indexOf("End")>0)state.pop();else if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}},opts);if(rels["!id"][s["!rel"]])s["!chart"]=rels["!id"][s["!rel"]];return s}function write_cs_bin(idx,opts,wb,rels){var ba=buf_array();write_record(ba,"BrtBeginSheet");write_record(ba,"BrtEndSheet");return ba.end()}var WBPropsDef=[["allowRefreshQuery",false,"bool"],["autoCompressPictures",true,"bool"],["backupFile",false,"bool"],["checkCompatibility",false,"bool"],["codeName",""],["date1904",false,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",false,"bool"],["hidePivotFieldList",false,"bool"],["promptedSolutions",false,"bool"],["publishItems",false,"bool"],["refreshAllConnections",false,"bool"],["saveExternalLinkValues",true,"bool"],["showBorderUnselectedTables",true,"bool"],["showInkAnnotation",true,"bool"],["showObjects","all"],["showPivotChartFilter",false,"bool"],["updateLinks","userSet"]];var WBViewDef=[["activeTab",0,"int"],["autoFilterDateGrouping",true,"bool"],["firstSheet",0,"int"],["minimized",false,"bool"],["showHorizontalScroll",true,"bool"],["showSheetTabs",true,"bool"],["showVerticalScroll",true,"bool"],["tabRatio",600,"int"],["visibility","visible"]];var SheetDef=[];var CalcPrDef=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];var CustomWBViewDef=[["autoUpdate","false"],["changesSavedWin","false"],["includeHiddenRowCol","true"],["includePrintSettings","true"],["maximized","false"],["minimized","false"],["onlySync","false"],["personalView","false"],["showComments","commIndicator"],["showFormulaBar","true"],["showHorizontalScroll","true"],["showObjects","all"],["showSheetTabs","true"],["showStatusbar","true"],["showVerticalScroll","true"],["tabRatio","600"],["xWindow","0"],["yWindow","0"]];function push_defaults_array(target,defaults){for(var j=0;j!=target.length;++j){var w=target[j];for(var i=0;i!=defaults.length;++i){var z=defaults[i];if(w[z[0]]==null)w[z[0]]=z[1];else switch(z[2]){case"bool":if(typeof w[z[0]]=="string")w[z[0]]=parsexmlbool(w[z[0]],z[0]);break;case"int":if(typeof w[z[0]]=="string")w[z[0]]=parseInt(w[z[0]],10);break;}}}}function push_defaults(target,defaults){for(var i=0;i!=defaults.length;++i){var z=defaults[i];if(target[z[0]]==null)target[z[0]]=z[1];else switch(z[2]){case"bool":if(typeof target[z[0]]=="string")target[z[0]]=parsexmlbool(target[z[0]],z[0]);break;case"int":if(typeof target[z[0]]=="string")target[z[0]]=parseInt(target[z[0]],10);break;}}}function parse_wb_defaults(wb){push_defaults(wb.WBProps,WBPropsDef);push_defaults(wb.CalcPr,CalcPrDef);push_defaults_array(wb.WBView,WBViewDef);push_defaults_array(wb.Sheets,SheetDef);_ssfopts.date1904=parsexmlbool(wb.WBProps.date1904,"date1904")}function safe1904(wb){if(!wb.Workbook)return"false";if(!wb.Workbook.WBProps)return"false";return parsexmlbool(wb.Workbook.WBProps.date1904)?"true":"false"}var badchars="][*?/\\".split("");function check_ws_name(n,safe){if(n.length>31){if(safe)return false;throw new Error("Sheet names cannot exceed 31 chars")}var _good=true;badchars.forEach(function(c){if(n.indexOf(c)==-1)return;if(!safe)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");_good=false});return _good}function check_wb_names(N){N.forEach(function(n,i){check_ws_name(n);for(var j=0;j<i;++j)if(n==N[j])throw new Error("Duplicate Sheet Name: "+n)})}function check_wb(wb){if(!wb||!wb.SheetNames||!wb.Sheets)throw new Error("Invalid Workbook");check_wb_names(wb.SheetNames)}var wbnsregex=/<\w+:workbook/;function parse_wb_xml(data,opts){if(!data)throw new Error("Could not find file");var wb={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""};var pass=false,xmlns="xmlns";var dname={},dnstart=0;data.replace(tagregex,function xml_wb(x,idx){var y=parsexmltag(x);switch(strip_ns(y[0])){case"<?xml":break;case"<workbook":if(x.match(wbnsregex))xmlns="xmlns"+x.match(/<(\w+):/)[1];wb.xmlns=y[xmlns];break;case"</workbook>":break;case"<fileVersion":delete y[0];wb.AppVersion=y;break;case"<fileVersion/>":;case"</fileVersion>":break;case"<fileSharing":;case"<fileSharing/>":break;case"<workbookPr":;case"<workbookPr/>":WBPropsDef.forEach(function(w){if(y[w[0]]==null)return;switch(w[2]){case"bool":wb.WBProps[w[0]]=parsexmlbool(y[w[0]],w[0]);break;case"int":wb.WBProps[w[0]]=parseInt(y[w[0]],10);break;default:wb.WBProps[w[0]]=y[w[0]];}});break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews>":;case"</bookViews>":break;case"<workbookView":delete y[0];wb.WBView.push(y);break;case"</workbookView>":break;case"<sheets>":;case"</sheets>":break;case"<sheet":switch(y.state){case"hidden":y.Hidden=1;break;case"veryHidden":y.Hidden=2;break;default:y.Hidden=0;}delete y.state;y.name=unescapexml(utf8read(y.name));delete y[0];wb.Sheets.push(y);break;case"</sheet>":break;case"<functionGroups":;case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":;case"</externalReferences>":;case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":;case"<definedNames":pass=true;break;case"</definedNames>":pass=false;break;case"<definedName":{dname={};dname.Name=y.name;if(y.comment)dname.Comment=y.comment;if(y.localSheetId)dname.Sheet=+y.localSheetId;dnstart=idx+x.length}break;case"</definedName>":{dname.Ref=data.slice(dnstart,idx);wb.Names.push(dname)}break;case"<definedName/>":break;case"<calcPr":delete y[0];wb.CalcPr=y;break;case"<calcPr/>":delete y[0];wb.CalcPr=y;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":;case"</customWorkbookViews>":;case"<customWorkbookViews":break;case"<customWorkbookView":;case"</customWorkbookView>":break;case"<pivotCaches>":;case"</pivotCaches>":;case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":;case"<smartTagPr/>":break;case"<smartTagTypes":;case"<smartTagTypes>":;case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":;case"<webPublishing/>":break;case"<fileRecoveryPr":;case"<fileRecoveryPr/>":break;case"<webPublishObjects>":;case"<webPublishObjects":;case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst>":;case"</extLst>":;case"<extLst/>":break;case"<ext":pass=true;break;case"</ext>":pass=false;break;case"<ArchID":break;case"<AlternateContent":pass=true;break;case"</AlternateContent>":pass=false;break;case"<revisionPtr":break;default:if(!pass&&opts.WTF)throw new Error("unrecognized "+y[0]+" in workbook");}return x});if(XMLNS.main.indexOf(wb.xmlns)===-1)throw new Error("Unknown Namespace: "+wb.xmlns);parse_wb_defaults(wb);return wb}var WB_XML_ROOT=writextag("workbook",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function write_wb_xml(wb,opts){var o=[XML_HEADER];o[o.length]=WB_XML_ROOT;var write_names=wb.Workbook&&(wb.Workbook.Names||[]).length>0;var workbookPr={codeName:"ThisWorkbook"};if(wb.Workbook&&wb.Workbook.WBProps){if(wb.Workbook.WBProps.codeName)workbookPr.codeName=wb.Workbook.WBProps.codeName;WBPropsDef.forEach(function(x){if(wb.Workbook.WBProps[x[0]]==null)return;if(wb.Workbook.WBProps[x[0]]==x[1])return;workbookPr[x[0]]=wb.Workbook.WBProps[x[0]]})}o[o.length]=writextag("workbookPr",null,workbookPr);o[o.length]="<sheets>";var sheets=wb.Workbook&&wb.Workbook.Sheets||[];for(var i=0;i!=wb.SheetNames.length;++i){var sht={name:escapexml(wb.SheetNames[i].substr(0,31))};sht.sheetId=""+(i+1);sht["r:id"]="rId"+(i+1);if(sheets[i])switch(sheets[i].Hidden){case 1:sht.state="hidden";break;case 2:sht.state="veryHidden";break;}o[o.length]=writextag("sheet",null,sht)}o[o.length]="</sheets>";if(write_names){o[o.length]="<definedNames>";if(wb.Workbook&&wb.Workbook.Names)wb.Workbook.Names.forEach(function(n){var d={name:n.Name};if(n.Comment)d.comment=n.Comment;if(n.Sheet!=null)d.localSheetId=""+n.Sheet;if(!n.Ref)return;o[o.length]=writextag("definedName",String(n.Ref),d)});o[o.length]="</definedNames>"}if(o.length>2){o[o.length]="</workbook>";o[1]=o[1].replace("/>",">")}return o.join("")}function parse_BrtBundleSh(data,length){var z={};z.Hidden=data.read_shift(4);z.iTabID=data.read_shift(4);z.strRelID=parse_RelID(data,length-8);z.name=parse_XLWideString(data);return z}function write_BrtBundleSh(data,o){if(!o)o=new_buf(127);o.write_shift(4,data.Hidden);o.write_shift(4,data.iTabID);write_RelID(data.strRelID,o);write_XLWideString(data.name.substr(0,31),o);return o.length>o.l?o.slice(0,o.l):o}function parse_BrtWbProp(data,length){var o={};var flags=data.read_shift(4);o.defaultThemeVersion=data.read_shift(4);var strName=length>8?parse_XLWideString(data):"";if(strName.length>0)o.codeName=strName;o.autoCompressPictures=!!(flags&65536);o.backupFile=!!(flags&64);o.checkCompatibility=!!(flags&4096);o.date1904=!!(flags&1);o.filterPrivacy=!!(flags&8);o.hidePivotFieldList=!!(flags&1024);o.promptedSolutions=!!(flags&16);o.publishItems=!!(flags&2048);o.refreshAllConnections=!!(flags&262144);o.saveExternalLinkValues=!!(flags&128);o.showBorderUnselectedTables=!!(flags&4);o.showInkAnnotation=!!(flags&32);o.showObjects=["all","placeholders","none"][flags>>13&3];o.showPivotChartFilter=!!(flags&32768);o.updateLinks=["userSet","never","always"][flags>>8&3];return o}function write_BrtWbProp(data,o){if(!o)o=new_buf(72);var flags=0;if(data){if(data.filterPrivacy)flags|=8}o.write_shift(4,flags);o.write_shift(4,0);write_XLSBCodeName("ThisWorkbook",o);return o.slice(0,o.l)}function parse_BrtFRTArchID$(data,length){var o={};data.read_shift(4);o.ArchID=data.read_shift(4);data.l+=length-8;return o}function parse_BrtName(data,length,opts){var end=data.l+length;var flags=data.read_shift(4);var chKey=data.read_shift(1);var itab=data.read_shift(4);var name=parse_XLNameWideString(data);var formula=parse_XLSBNameParsedFormula(data,0,opts);var comment=parse_XLNullableWideString(data);data.l=end;var out={Name:name,Ptg:formula,Comment:comment};if(itab<268435455)out.Sheet=itab;return out}function parse_wb_bin(data,opts){var wb={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""};var pass=false,z;if(!opts)opts={};opts.biff=12;var Names=[];var supbooks=[];supbooks.SheetNames=[];recordhopper(data,function hopper_wb(val,R_n,RT){switch(RT){case 156:supbooks.SheetNames.push(val.name);wb.Sheets.push(val);break;case 153:wb.WBProps=val;break;case 39:val.Ref=stringify_formula(val.Ptg,null,null,supbooks,opts);delete val.Ptg;Names.push(val);break;case 1036:break;case 357:;case 358:;case 355:;case 667:;case 362:;case 361:break;case 2071:;case 534:;case 677:;case 158:;case 157:;case 610:;case 2050:;case 155:;case 548:;case 676:;case 128:;case 665:;case 2128:;case 2125:;case 549:;case 2053:;case 596:;case 2076:;case 2075:;case 2082:;case 397:;case 154:;case 1117:;case 553:;case 2091:break;case 35:pass=true;break;case 36:pass=false;break;case 37:break;case 38:break;case 16:break;default:if((R_n||"").indexOf("Begin")>0){}else if((R_n||"").indexOf("End")>0){}else if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R_n);}},opts);parse_wb_defaults(wb);wb.Names=Names;return wb}function write_BUNDLESHS(ba,wb,opts){write_record(ba,"BrtBeginBundleShs");for(var idx=0;idx!=wb.SheetNames.length;++idx){var viz=wb.Workbook&&wb.Workbook.Sheets&&wb.Workbook.Sheets[idx]&&wb.Workbook.Sheets[idx].Hidden||0;var d={Hidden:viz,iTabID:idx+1,strRelID:"rId"+(idx+1),name:wb.SheetNames[idx]};write_record(ba,"BrtBundleSh",write_BrtBundleSh(d))}write_record(ba,"BrtEndBundleShs")}function write_BrtFileVersion(data,o){if(!o)o=new_buf(127);for(var i=0;i!=4;++i)o.write_shift(4,0);write_XLWideString("SheetJS",o);write_XLWideString(XLSX.version,o);write_XLWideString(XLSX.version,o);write_XLWideString("7262",o);o.length=o.l;return o.length>o.l?o.slice(0,o.l):o}function write_BrtBookView(idx,o){if(!o)o=new_buf(29);o.write_shift(-4,0);o.write_shift(-4,460);o.write_shift(4,28800);o.write_shift(4,17600);o.write_shift(4,500);o.write_shift(4,idx);o.write_shift(4,idx);var flags=120;o.write_shift(1,flags);return o.length>o.l?o.slice(0,o.l):o}function write_BOOKVIEWS(ba,wb,opts){if(!wb.Workbook||!wb.Workbook.Sheets)return;var sheets=wb.Workbook.Sheets;var i=0,vistab=-1,hidden=-1;for(;i<sheets.length;++i){if(!sheets[i]||!sheets[i].Hidden&&vistab==-1)vistab=i;else if(sheets[i].Hidden==1&&hidden==-1)hidden=i}if(hidden>vistab)return;write_record(ba,"BrtBeginBookViews");write_record(ba,"BrtBookView",write_BrtBookView(vistab));write_record(ba,"BrtEndBookViews")}function write_BrtCalcProp(data,o){if(!o)o=new_buf(26);o.write_shift(4,0);o.write_shift(4,1);o.write_shift(4,0);write_Xnum(0,o);o.write_shift(-4,1023);o.write_shift(1,51);o.write_shift(1,0);return o}function write_BrtFileRecover(data,o){if(!o)o=new_buf(1);o.write_shift(1,0);return o}function write_wb_bin(wb,opts){var ba=buf_array();write_record(ba,"BrtBeginBook");write_record(ba,"BrtFileVersion",write_BrtFileVersion());write_record(ba,"BrtWbProp",write_BrtWbProp(wb.Workbook&&wb.Workbook.WBProps||null));write_BOOKVIEWS(ba,wb,opts);write_BUNDLESHS(ba,wb,opts);write_record(ba,"BrtEndBook");return ba.end()}function parse_wb(data,name,opts){if(name.slice(-4)===".bin")return parse_wb_bin(data,opts);return parse_wb_xml(data,opts)}function parse_ws(data,name,opts,rels,wb,themes,styles){if(name.slice(-4)===".bin")return parse_ws_bin(data,opts,rels,wb,themes,styles);return parse_ws_xml(data,opts,rels,wb,themes,styles)}function parse_cs(data,name,opts,rels,wb,themes,styles){if(name.slice(-4)===".bin")return parse_cs_bin(data,opts,rels,wb,themes,styles);return parse_cs_xml(data,opts,rels,wb,themes,styles)}function parse_ms(data,name,opts,rels,wb,themes,styles){if(name.slice(-4)===".bin")return parse_ms_bin(data,opts,rels,wb,themes,styles);return parse_ms_xml(data,opts,rels,wb,themes,styles)}function parse_ds(data,name,opts,rels,wb,themes,styles){if(name.slice(-4)===".bin")return parse_ds_bin(data,opts,rels,wb,themes,styles);return parse_ds_xml(data,opts,rels,wb,themes,styles)}function parse_sty(data,name,themes,opts){if(name.slice(-4)===".bin")return parse_sty_bin(data,themes,opts);return parse_sty_xml(data,themes,opts)}function parse_theme(data,name,opts){return parse_theme_xml(data,opts)}function parse_sst(data,name,opts){if(name.slice(-4)===".bin")return parse_sst_bin(data,opts);return parse_sst_xml(data,opts)}function parse_cmnt(data,name,opts){if(name.slice(-4)===".bin")return parse_comments_bin(data,opts);return parse_comments_xml(data,opts)}function parse_cc(data,name,opts){if(name.slice(-4)===".bin")return parse_cc_bin(data,opts);return parse_cc_xml(data,opts)}function write_wb(wb,name,opts){return(name.slice(-4)===".bin"?write_wb_bin:write_wb_xml)(wb,opts)}function write_ws(data,name,opts,wb,rels){return(name.slice(-4)===".bin"?write_ws_bin:write_ws_xml)(data,opts,wb,rels)}function write_cs(data,name,opts,wb,rels){return(name.slice(-4)===".bin"?write_cs_bin:write_cs_xml)(data,opts,wb,rels)}function write_sty(data,name,opts){return(name.slice(-4)===".bin"?write_sty_bin:write_sty_xml)(data,opts)}function write_sst(data,name,opts){return(name.slice(-4)===".bin"?write_sst_bin:write_sst_xml)(data,opts)}function write_cmnt(data,name,opts){return(name.slice(-4)===".bin"?write_comments_bin:write_comments_xml)(data,opts)}var attregexg2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g;var attregex2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;var _chr=function(c){return String.fromCharCode(c)};function xlml_parsexmltag(tag,skip_root){var words=tag.split(/\s+/);var z=[];if(!skip_root)z[0]=words[0];if(words.length===1)return z;var m=tag.match(attregexg2),y,j,w,i;if(m)for(i=0;i!=m.length;++i){y=m[i].match(attregex2);if((j=y[1].indexOf(":"))===-1)z[y[1]]=y[2].substr(1,y[2].length-2);else{if(y[1].substr(0,6)==="xmlns:")w="xmlns"+y[1].substr(6);else w=y[1].substr(j+1);z[w]=y[2].substr(1,y[2].length-2)}}return z}function xlml_parsexmltagobj(tag){var words=tag.split(/\s+/);var z={};if(words.length===1)return z;var m=tag.match(attregexg2),y,j,w,i;if(m)for(i=0;i!=m.length;++i){y=m[i].match(attregex2);if((j=y[1].indexOf(":"))===-1)z[y[1]]=y[2].substr(1,y[2].length-2);else{if(y[1].substr(0,6)==="xmlns:")w="xmlns"+y[1].substr(6);else w=y[1].substr(j+1);z[w]=y[2].substr(1,y[2].length-2)}}return z}function xlml_format(format,value){var fmt=XLMLFormatMap[format]||unescapexml(format);if(fmt==="General")return SSF._general(value);return SSF.format(fmt,value)}function xlml_set_custprop(Custprops,Rn,cp,val){var oval=val;switch((cp[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":oval=parsexmlbool(val);break;case"i2":;case"int":oval=parseInt(val,10);break;case"r4":;case"float":oval=parseFloat(val);break;case"date":;case"dateTime.tz":oval=parseDate(val);break;case"i8":;case"string":;case"fixed":;case"uuid":;case"bin.base64":break;default:throw new Error("bad custprop:"+cp[0]);}Custprops[unescapexml(Rn[3])]=oval}function safe_format_xlml(cell,nf,o){if(cell.t==="z")return;if(!o||o.cellText!==false)try{if(cell.t==="e"){cell.w=cell.w||BErr[cell.v]}else if(nf==="General"){if(cell.t==="n"){if((cell.v|0)===cell.v)cell.w=SSF._general_int(cell.v);else cell.w=SSF._general_num(cell.v)}else cell.w=SSF._general(cell.v)}else cell.w=xlml_format(nf||"General",cell.v)}catch(e){if(o.WTF)throw e}try{var z=XLMLFormatMap[nf]||nf||"General";if(o.cellNF)cell.z=z;if(o.cellDates&&cell.t=="n"&&SSF.is_date(z)){var _d=SSF.parse_date_code(cell.v);if(_d){cell.t="d";cell.v=new Date(_d.y,_d.m-1,_d.d,_d.H,_d.M,_d.S,_d.u)}}}catch(e){if(o.WTF)throw e}}function process_style_xlml(styles,stag,opts){if(opts.cellStyles){if(stag.Interior){var I=stag.Interior;if(I.Pattern)I.patternType=XLMLPatternTypeMap[I.Pattern]||I.Pattern}}styles[stag.ID]=stag}function parse_xlml_data(xml,ss,data,cell,base,styles,csty,row,arrayf,o){var nf="General",sid=cell.StyleID,S={};o=o||{};var interiors=[];var i=0;if(sid===undefined&&row)sid=row.StyleID;if(sid===undefined&&csty)sid=csty.StyleID;while(styles[sid]!==undefined){if(styles[sid].nf)nf=styles[sid].nf;if(styles[sid].Interior)interiors.push(styles[sid].Interior);if(!styles[sid].Parent)break;sid=styles[sid].Parent}switch(data.Type){case"Boolean":cell.t="b";cell.v=parsexmlbool(xml);break;case"String":cell.t="s";cell.r=xlml_fixstr(unescapexml(xml));cell.v=xml.indexOf("<")>-1?unescapexml(ss):cell.r;break;case"DateTime":if(xml.slice(-1)!="Z")xml+="Z";cell.v=(parseDate(xml)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3);if(cell.v!==cell.v)cell.v=unescapexml(xml);else if(cell.v<60)cell.v=cell.v-1;if(!nf||nf=="General")nf="yyyy-mm-dd";case"Number":if(cell.v===undefined)cell.v=+xml;if(!cell.t)cell.t="n";break;case"Error":cell.t="e";cell.v=RBErr[xml];if(o.cellText!==false)cell.w=xml;break;default:cell.t="s";cell.v=xlml_fixstr(ss||xml);break;}safe_format_xlml(cell,nf,o);if(o.cellFormula!==false){if(cell.Formula){var fstr=unescapexml(cell.Formula);if(fstr.charCodeAt(0)==61)fstr=fstr.substr(1);cell.f=rc_to_a1(fstr,base);delete cell.Formula;if(cell.ArrayRange=="RC")cell.F=rc_to_a1("RC:RC",base);else if(cell.ArrayRange){cell.F=rc_to_a1(cell.ArrayRange,base);arrayf.push([safe_decode_range(cell.F),cell.F])}}else{for(i=0;i<arrayf.length;++i)if(base.r>=arrayf[i][0].s.r&&base.r<=arrayf[i][0].e.r)if(base.c>=arrayf[i][0].s.c&&base.c<=arrayf[i][0].e.c)cell.F=arrayf[i][1]}}if(o.cellStyles){interiors.forEach(function(x){if(!S.patternType&&x.patternType)S.patternType=x.patternType});cell.s=S}cell.ixfe=cell.StyleID!==undefined?cell.StyleID:"Default";}function xlml_clean_comment(comment){comment.t=comment.v||"";comment.t=comment.t.replace(/\r\n/g,"\n").replace(/\r/g,"\n");comment.v=comment.w=comment.ixfe=undefined}function xlml_normalize(d){if(has_buf&&Buffer.isBuffer(d))return d.toString("utf8");if(typeof d==="string")return d;throw new Error("Bad input format: expected Buffer or string")}var xlmlregex=/<(\/?)([^\s?>!\/:]*:|)([^\s?>]*[^\s?>\/])[^>]*>/gm;function parse_xlml_xml(d,_opts){var opts=_opts||{};make_ssf(SSF);var str=debom(xlml_normalize(d));if(opts&&opts.type=="binary"&&typeof cptable!=="undefined")str=cptable.utils.decode(65001,char_codes(str));if(str.substr(0,1e3).indexOf("<html")>=0)return HTML_.to_workbook(str,opts);var Rn;var state=[],tmp;if(DENSE!=null&&opts.dense==null)opts.dense=DENSE;var sheets={},sheetnames=[],cursheet=opts.dense?[]:{},sheetname="";var table={},cell={},row={};var dtag=xlml_parsexmltag('<Data ss:Type="String">'),didx=0;var c=0,r=0;var refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}};var styles={},stag={};var ss="",fidx=0;var mergecells=[];var Props={},Custprops={},pidx=0,cp={};var comments=[],comment={};var cstys=[],csty,seencol=false;var arrayf=[];var rowinfo=[],rowobj={};var Workbook={Sheets:[],WBProps:{date1904:false}},wsprops={};xlmlregex.lastIndex=0;str=str.replace(/<!--([\s\S]*?)-->/gm,"");while(Rn=xlmlregex.exec(str))switch(Rn[3]){case"Data":if(state[state.length-1][1])break;if(Rn[1]==="/")parse_xlml_data(str.slice(didx,Rn.index),ss,dtag,state[state.length-1][0]=="Comment"?comment:cell,{c:c,r:r},styles,cstys[c],row,arrayf,opts);else{ss="";dtag=xlml_parsexmltag(Rn[0]);didx=Rn.index+Rn[0].length}break;case"Cell":if(Rn[1]==="/"){if(comments.length>0)cell.c=comments;if((!opts.sheetRows||opts.sheetRows>r)&&cell.v!==undefined){if(opts.dense){if(!cursheet[r])cursheet[r]=[];cursheet[r][c]=cell}else cursheet[encode_col(c)+encode_row(r)]=cell}if(cell.HRef){cell.l={Target:cell.HRef,Tooltip:cell.HRefScreenTip};delete cell.HRef;delete cell.HRefScreenTip}if(cell.MergeAcross||cell.MergeDown){var cc=c+(parseInt(cell.MergeAcross,10)|0);var rr=r+(parseInt(cell.MergeDown,10)|0);mergecells.push({s:{c:c,r:r},e:{c:cc,r:rr}})}if(!opts.sheetStubs){if(cell.MergeAcross)c=cc+1;else++c}else if(cell.MergeAcross||cell.MergeDown){for(var cma=c;cma<=cc;++cma){for(var cmd=r;cmd<=rr;++cmd){if(cma>c||cmd>r){if(opts.dense){if(!cursheet[cmd])cursheet[cmd]=[];cursheet[cmd][cma]={t:"z"}}else cursheet[encode_col(cma)+encode_row(cmd)]={t:"z"}}}}c=cc+1}else++c}else{cell=xlml_parsexmltagobj(Rn[0]);if(cell.Index)c=+cell.Index-1;if(c<refguess.s.c)refguess.s.c=c;if(c>refguess.e.c)refguess.e.c=c;if(Rn[0].slice(-2)==="/>")++c;comments=[]}break;case"Row":if(Rn[1]==="/"||Rn[0].slice(-2)==="/>"){if(r<refguess.s.r)refguess.s.r=r;if(r>refguess.e.r)refguess.e.r=r;if(Rn[0].slice(-2)==="/>"){row=xlml_parsexmltag(Rn[0]);if(row.Index)r=+row.Index-1}c=0;++r}else{row=xlml_parsexmltag(Rn[0]);if(row.Index)r=+row.Index-1;rowobj={};if(row.AutoFitHeight=="0"||row.Height){rowobj.hpx=parseInt(row.Height,10);rowobj.hpt=px2pt(rowobj.hpx);rowinfo[r]=rowobj}if(row.Hidden=="1"){rowobj.hidden=true;rowinfo[r]=rowobj}}break;case"Worksheet":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"));sheetnames.push(sheetname);if(refguess.s.r<=refguess.e.r&&refguess.s.c<=refguess.e.c)cursheet["!ref"]=encode_range(refguess);if(mergecells.length)cursheet["!merges"]=mergecells;if(cstys.length>0)cursheet["!cols"]=cstys;if(rowinfo.length>0)cursheet["!rows"]=rowinfo;sheets[sheetname]=cursheet}else{refguess={s:{r:2e6,c:2e6},e:{r:0,c:0}};r=c=0;state.push([Rn[3],false]);tmp=xlml_parsexmltag(Rn[0]);sheetname=unescapexml(tmp.Name);cursheet=opts.dense?[]:{};mergecells=[];arrayf=[];rowinfo=[];wsprops={name:sheetname,Hidden:0};Workbook.Sheets.push(wsprops)}break;case"Table":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else if(Rn[0].slice(-2)=="/>")break;else{table=xlml_parsexmltag(Rn[0]);state.push([Rn[3],false]);cstys=[];seencol=false}break;case"Style":if(Rn[1]==="/")process_style_xlml(styles,stag,opts);else stag=xlml_parsexmltag(Rn[0]);break;case"NumberFormat":stag.nf=unescapexml(xlml_parsexmltag(Rn[0]).Format||"General");if(XLMLFormatMap[stag.nf])stag.nf=XLMLFormatMap[stag.nf];for(var ssfidx=0;ssfidx!=392;++ssfidx)if(SSF._table[ssfidx]==stag.nf)break;if(ssfidx==392)for(ssfidx=57;ssfidx!=392;++ssfidx)if(SSF._table[ssfidx]==null){SSF.load(stag.nf,ssfidx);break}break;case"Column":if(state[state.length-1][0]!=="Table")break;csty=xlml_parsexmltag(Rn[0]);if(csty.Hidden){csty.hidden=true;delete csty.Hidden}if(csty.Width)csty.wpx=parseInt(csty.Width,10);if(!seencol&&csty.wpx>10){seencol=true;MDW=DEF_MDW;for(var _col=0;_col<cstys.length;++_col)if(cstys[_col])process_col(cstys[_col])}if(seencol)process_col(csty);cstys[csty.Index-1||cstys.length]=csty;for(var i=0;i<+csty.Span;++i)cstys[cstys.length]=dup(csty);break;case"NamedRange":if(!Workbook.Names)Workbook.Names=[];var _NamedRange=parsexmltag(Rn[0]);var _DefinedName={Name:_NamedRange.Name,Ref:rc_to_a1(_NamedRange.RefersTo.substr(1))};if(Workbook.Sheets.length>0)_DefinedName.Sheet=Workbook.Sheets.length-1;Workbook.Names.push(_DefinedName);break;case"NamedCell":break;case"B":break;case"I":break;case"U":break;case"S":break;case"Sub":break;case"Sup":break;case"Span":break;case"Border":break;case"Alignment":break;case"Borders":break;case"Font":if(Rn[0].slice(-2)==="/>")break;else if(Rn[1]==="/")ss+=str.slice(fidx,Rn.index);else fidx=Rn.index+Rn[0].length;break;case"Interior":if(!opts.cellStyles)break;stag.Interior=xlml_parsexmltag(Rn[0]);break;case"Protection":break;case"Author":;case"Title":;case"Description":;case"Created":;case"Keywords":;case"Subject":;case"Category":;case"Company":;case"LastAuthor":;case"LastSaved":;case"LastPrinted":;case"Version":;case"Revision":;case"TotalTime":;case"HyperlinkBase":;case"Manager":;case"ContentStatus":;case"Identifier":;case"Language":if(Rn[0].slice(-2)==="/>")break;else if(Rn[1]==="/")xlml_set_prop(Props,Rn[3],str.slice(pidx,Rn.index));else pidx=Rn.index+Rn[0].length;break;case"Paragraphs":break;case"Styles":;case"Workbook":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else state.push([Rn[3],false]);break;case"Comment":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"));xlml_clean_comment(comment);comments.push(comment)}else{state.push([Rn[3],false]);tmp=xlml_parsexmltag(Rn[0]);comment={a:tmp.Author}}break;case"AutoFilter":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else if(Rn[0].charAt(Rn[0].length-2)!=="/"){var AutoFilter=xlml_parsexmltag(Rn[0]);cursheet["!autofilter"]={ref:rc_to_a1(AutoFilter.Range).replace(/\$/g,"")};state.push([Rn[3],true])}break;case"Name":break;case"ComponentOptions":;case"DocumentProperties":;case"CustomDocumentProperties":;case"OfficeDocumentSettings":;case"PivotTable":;case"PivotCache":;case"Names":;case"MapInfo":;case"PageBreaks":;case"QueryTable":;case"DataValidation":;case"Sorting":;case"Schema":;case"data":;case"ConditionalFormatting":;case"SmartTagType":;case"SmartTags":;case"ExcelWorkbook":;case"WorkbookOptions":;case"WorksheetOptions":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw new Error("Bad state: "+tmp.join("|"))}else if(Rn[0].charAt(Rn[0].length-2)!=="/")state.push([Rn[3],true]);break;default:if(state.length==0&&Rn[3]=="document")return parse_fods(str,opts);if(state.length==0&&Rn[3]=="UOF")return parse_fods(str,opts);var seen=true;switch(state[state.length-1][0]){case"OfficeDocumentSettings":switch(Rn[3]){case"AllowPNG":break;case"RemovePersonalInformation":break;case"DownloadComponents":break;case"LocationOfComponents":break;case"Colors":break;case"Color":break;case"Index":break;case"RGB":break;case"PixelsPerInch":break;case"TargetScreenSize":break;case"ReadOnlyRecommended":break;default:seen=false;}break;case"ComponentOptions":switch(Rn[3]){case"Toolbar":break;case"HideOfficeLogo":break;case"SpreadsheetAutoFit":break;case"Label":break;case"Caption":break;case"MaxHeight":break;case"MaxWidth":break;case"NextSheetNumber":break;default:seen=false;}break;case"ExcelWorkbook":switch(Rn[3]){case"Date1904":Workbook.WBProps.date1904=true;break;case"WindowHeight":break;case"WindowWidth":break;case"WindowTopX":break;case"WindowTopY":break;case"TabRatio":break;case"ProtectStructure":break;case"ProtectWindows":break;case"ActiveSheet":break;case"DisplayInkNotes":break;case"FirstVisibleSheet":break;case"SupBook":break;case"SheetName":break;case"SheetIndex":break;case"SheetIndexFirst":break;case"SheetIndexLast":break;case"Dll":break;case"AcceptLabelsInFormulas":break;case"DoNotSaveLinkValues":break;case"Iteration":break;case"MaxIterations":break;case"MaxChange":break;case"Path":break;case"Xct":break;case"Count":break;case"SelectedSheets":break;case"Calculation":break;case"Uncalced":break;case"StartupPrompt":break;case"Crn":break;case"ExternName":break;case"Formula":break;case"ColFirst":break;case"ColLast":break;case"WantAdvise":break;case"Boolean":break;case"Error":break;case"Text":break;case"OLE":break;case"NoAutoRecover":break;case"PublishObjects":break;case"DoNotCalculateBeforeSave":break;case"Number":break;case"RefModeR1C1":break;case"EmbedSaveSmartTags":break;default:seen=false;}break;case"WorkbookOptions":switch(Rn[3]){case"OWCVersion":break;case"Height":break;case"Width":break;default:seen=false;}break;case"WorksheetOptions":switch(Rn[3]){case"Visible":if(Rn[0].slice(-2)==="/>"){}else if(Rn[1]==="/")switch(str.slice(pidx,Rn.index)){case"SheetHidden":wsprops.Hidden=1;break;case"SheetVeryHidden":wsprops.Hidden=2;break;}else pidx=Rn.index+Rn[0].length;break;case"Header":if(!cursheet["!margins"])default_margins(cursheet["!margins"]={},"xlml");cursheet["!margins"].header=parsexmltag(Rn[0]).Margin;break;case"Footer":if(!cursheet["!margins"])default_margins(cursheet["!margins"]={},"xlml");cursheet["!margins"].footer=parsexmltag(Rn[0]).Margin;break;case"PageMargins":var pagemargins=parsexmltag(Rn[0]);if(!cursheet["!margins"])default_margins(cursheet["!margins"]={},"xlml");if(pagemargins.Top)cursheet["!margins"].top=pagemargins.Top;if(pagemargins.Left)cursheet["!margins"].left=pagemargins.Left;if(pagemargins.Right)cursheet["!margins"].right=pagemargins.Right;if(pagemargins.Bottom)cursheet["!margins"].bottom=pagemargins.Bottom;break;case"Unsynced":break;case"Print":break;case"Panes":break;case"Scale":break;case"Pane":break;case"Number":break;case"Layout":break;case"PageSetup":break;case"Selected":break;case"ProtectObjects":break;case"EnableSelection":break;case"ProtectScenarios":break;case"ValidPrinterInfo":break;case"HorizontalResolution":break;case"VerticalResolution":break;case"NumberofCopies":break;case"ActiveRow":break;case"ActiveCol":break;case"ActivePane":break;case"TopRowVisible":break;case"TopRowBottomPane":break;case"LeftColumnVisible":break;case"LeftColumnRightPane":break;case"FitToPage":break;case"RangeSelection":break;case"PaperSizeIndex":break;case"PageLayoutZoom":break;case"PageBreakZoom":break;case"FilterOn":break;case"DoNotDisplayGridlines":break;case"SplitHorizontal":break;case"SplitVertical":break;case"FreezePanes":break;case"FrozenNoSplit":break;case"FitWidth":break;case"FitHeight":break;case"CommentsLayout":break;case"Zoom":break;case"LeftToRight":break;case"Gridlines":break;case"AllowSort":break;case"AllowFilter":break;case"AllowInsertRows":break;case"AllowDeleteRows":break;case"AllowInsertCols":break;case"AllowDeleteCols":break;case"AllowInsertHyperlinks":break;case"AllowFormatCells":break;case"AllowSizeCols":break;case"AllowSizeRows":break;case"NoSummaryRowsBelowDetail":break;case"TabColorIndex":break;case"DoNotDisplayHeadings":break;case"ShowPageLayoutZoom":break;case"NoSummaryColumnsRightDetail":break;case"BlackAndWhite":break;case"DoNotDisplayZeros":break;case"DisplayPageBreak":break;case"RowColHeadings":break;case"DoNotDisplayOutline":break;case"NoOrientation":break;case"AllowUsePivotTables":break;case"ZeroHeight":break;case"ViewableRange":break;case"Selection":break;case"ProtectContents":break;default:seen=false;}break;case"PivotTable":;case"PivotCache":switch(Rn[3]){case"ImmediateItemsOnDrop":break;case"ShowPageMultipleItemLabel":break;case"CompactRowIndent":break;case"Location":break;case"PivotField":break;case"Orientation":break;case"LayoutForm":break;case"LayoutSubtotalLocation":break;case"LayoutCompactRow":break;case"Position":break;case"PivotItem":break;case"DataType":break;case"DataField":break;case"SourceName":break;case"ParentField":break;case"PTLineItems":break;case"PTLineItem":break;case"CountOfSameItems":break;case"Item":break;case"ItemType":break;case"PTSource":break;case"CacheIndex":break;case"ConsolidationReference":break;case"FileName":break;case"Reference":break;case"NoColumnGrand":break;case"NoRowGrand":break;case"BlankLineAfterItems":break;case"Hidden":break;case"Subtotal":break;case"BaseField":break;case"MapChildItems":break;case"Function":break;case"RefreshOnFileOpen":break;case"PrintSetTitles":break;case"MergeLabels":break;case"DefaultVersion":break;case"RefreshName":break;case"RefreshDate":break;case"RefreshDateCopy":break;case"VersionLastRefresh":break;case"VersionLastUpdate":break;case"VersionUpdateableMin":break;case"VersionRefreshableMin":break;case"Calculation":break;default:seen=false;}break;case"PageBreaks":switch(Rn[3]){case"ColBreaks":break;case"ColBreak":break;case"RowBreaks":break;case"RowBreak":break;case"ColStart":break;case"ColEnd":break;case"RowEnd":break;default:seen=false;}break;case"AutoFilter":switch(Rn[3]){case"AutoFilterColumn":break;case"AutoFilterCondition":break;case"AutoFilterAnd":break;case"AutoFilterOr":break;default:seen=false;}break;case"QueryTable":switch(Rn[3]){case"Id":break;case"AutoFormatFont":break;case"AutoFormatPattern":break;case"QuerySource":break;case"QueryType":break;case"EnableRedirections":break;case"RefreshedInXl9":break;case"URLString":break;case"HTMLTables":break;case"Connection":break;case"CommandText":break;case"RefreshInfo":break;case"NoTitles":break;case"NextId":break;case"ColumnInfo":break;case"OverwriteCells":break;case"DoNotPromptForFile":break;case"TextWizardSettings":break;case"Source":break;case"Number":break;case"Decimal":break;case"ThousandSeparator":break;case"TrailingMinusNumbers":break;case"FormatSettings":break;case"FieldType":break;case"Delimiters":break;case"Tab":break;case"Comma":break;case"AutoFormatName":break;case"VersionLastEdit":break;case"VersionLastRefresh":break;default:seen=false;}break;case"Sorting":;case"ConditionalFormatting":;case"DataValidation":switch(Rn[3]){case"Range":break;case"Type":break;case"Min":break;case"Max":break;case"Sort":break;case"Descending":break;case"Order":break;case"CaseSensitive":break;case"Value":break;case"ErrorStyle":break;case"ErrorMessage":break;case"ErrorTitle":break;case"CellRangeList":break;case"InputMessage":break;case"InputTitle":break;case"ComboHide":break;case"InputHide":break;case"Condition":break;case"Qualifier":break;case"UseBlank":break;case"Value1":break;case"Value2":break;case"Format":break;default:seen=false;}break;case"MapInfo":;case"Schema":;case"data":switch(Rn[3]){case"Map":break;case"Entry":break;case"Range":break;case"XPath":break;case"Field":break;case"XSDType":break;case"FilterOn":break;case"Aggregate":break;case"ElementType":break;case"AttributeType":break;case"schema":;case"element":;case"complexType":;case"datatype":;case"all":;case"attribute":;case"extends":break;case"row":break;default:seen=false;}break;case"SmartTags":break;default:seen=false;break;}if(seen)break;if(!state[state.length-1][1])throw"Unrecognized tag: "+Rn[3]+"|"+state.join("|");if(state[state.length-1][0]==="CustomDocumentProperties"){if(Rn[0].slice(-2)==="/>")break;else if(Rn[1]==="/")xlml_set_custprop(Custprops,Rn,cp,str.slice(pidx,Rn.index));else{cp=Rn;pidx=Rn.index+Rn[0].length}break}if(opts.WTF)throw"Unrecognized tag: "+Rn[3]+"|"+state.join("|");}var out={};if(!opts.bookSheets&&!opts.bookProps)out.Sheets=sheets;out.SheetNames=sheetnames;out.Workbook=Workbook;out.SSF=SSF.get_table();out.Props=Props;out.Custprops=Custprops;return out}function parse_xlml(data,opts){fix_read_opts(opts=opts||{});switch(opts.type||"base64"){case"base64":return parse_xlml_xml(Base64.decode(data),opts);case"binary":;case"buffer":;case"file":return parse_xlml_xml(data,opts);case"array":return parse_xlml_xml(data.map(_chr).join(""),opts);}}function write_props_xlml(wb,opts){var o=[];if(wb.Props)o.push(xlml_write_docprops(wb.Props,opts));if(wb.Custprops)o.push(xlml_write_custprops(wb.Props,wb.Custprops,opts));return o.join("")}function write_wb_xlml(wb,opts){return""}function write_sty_xlml(wb,opts){return""}function write_ws_xlml_wsopts(ws,opts,idx,wb){if(!ws)return"";var o=[];if(ws["!margins"]){o.push("<PageSetup>");if(ws["!margins"].header)o.push(writextag("Header",null,{"x:Margin":ws["!margins"].header}));if(ws["!margins"].footer)o.push(writextag("Footer",null,{"x:Margin":ws["!margins"].footer}));o.push(writextag("PageMargins",null,{"x:Bottom":ws["!margins"].bottom||"0.75","x:Left":ws["!margins"].left||"0.7","x:Right":ws["!margins"].right||"0.7","x:Top":ws["!margins"].top||"0.75"}));o.push("</PageSetup>")}if(wb&&wb.Workbook&&wb.Workbook.Sheets&&wb.Workbook.Sheets[idx]){if(wb.Workbook.Sheets[idx].Hidden)o.push(writextag("Visible",wb.Workbook.Sheets[idx].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<idx;++i)if(wb.Workbook.Sheets[i]&&!wb.Workbook.Sheets[i].Hidden)break;if(i==idx)o.push("<Selected/>")}}if(ws["!protect"]){o.push(writetag("ProtectContents","True"));if(ws["!protect"].objects)o.push(writetag("ProtectObjects","True"));if(ws["!protect"].scenarios)o.push(writetag("ProtectScenarios","True"));if(ws["!protect"].selectLockedCells!=null&&!ws["!protect"].selectLockedCells)o.push(writetag("EnableSelection","NoSelection"));else if(ws["!protect"].selectUnlockedCells!=null&&!ws["!protect"].selectUnlockedCells)o.push(writetag("EnableSelection","UnlockedCells"));[["formatColumns","AllowFormatCells"],["formatRows","AllowSizeCols"],["formatCells","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(x){if(ws["!protect"][x[0]])o.push("<"+x[1]+"/>")})}if(o.length==0)return"";return writextag("WorksheetOptions",o.join(""),{xmlns:XLMLNS.x})}function write_ws_xlml_comment(comments){return comments.map(function(c){var t=xlml_unfixstr(c.t||"");var d=writextag("ss:Data",t,{xmlns:"http://www.w3.org/TR/REC-html40"});return writextag("Comment",d,{"ss:Author":c.a})}).join("")}function write_ws_xlml_cell(cell,ref,ws,opts,idx,wb,addr){if(!cell||cell.v==undefined&&cell.f==undefined)return"<Cell></Cell>";var attr={};if(cell.f)attr["ss:Formula"]="="+escapexml(a1_to_rc(cell.f,addr));if(cell.F&&cell.F.substr(0,ref.length)==ref){var end=decode_cell(cell.F.substr(ref.length+1));attr["ss:ArrayRange"]="RC:R"+(end.r==addr.r?"":"["+(end.r-addr.r)+"]")+"C"+(end.c==addr.c?"":"["+(end.c-addr.c)+"]")}if(cell.l&&cell.l.Target){attr["ss:HRef"]=escapexml(cell.l.Target);if(cell.l.Tooltip)attr["x:HRefScreenTip"]=escapexml(cell.l.Tooltip)}if(ws["!merges"]){var marr=ws["!merges"];for(var mi=0;mi!=marr.length;++mi){if(marr[mi].s.c!=addr.c||marr[mi].s.r!=addr.r)continue;if(marr[mi].e.c>marr[mi].s.c)attr["ss:MergeAcross"]=marr[mi].e.c-marr[mi].s.c;if(marr[mi].e.r>marr[mi].s.r)attr["ss:MergeDown"]=marr[mi].e.r-marr[mi].s.r}}var t="",p="";switch(cell.t){case"z":return"";case"n":t="Number";p=String(cell.v);break;case"b":t="Boolean";p=cell.v?"1":"0";break;case"e":t="Error";p=BErr[cell.v];break;case"d":t="DateTime";p=new Date(cell.v).toISOString();break;case"s":t="String";p=escapexml(cell.v||"");break;}var _v=cell.v!=null?p:"";if(opts&&opts.type=="binary"&&typeof cptable!=="undefined"&&cell.t=="s"){_v=cptable.utils.encode(65001,_v);var __v="";for(var __i=0;__i<_v.length;++__i)__v+=String.fromCharCode(_v[__i]);_v=__v}var m='<Data ss:Type="'+t+'">'+_v+"</Data>";if((cell.c||[]).length>0)m+=write_ws_xlml_comment(cell.c);return writextag("Cell",m,attr)}function write_ws_xlml_row(R,row){var o='<Row ss:Index="'+(R+1)+'"';if(row){if(row.hpt&&!row.hpx)row.hpx=pt2px(row.hpt);if(row.hpx)o+=' ss:AutoFitHeight="0" ss:Height="'+row.hpx+'"';if(row.hidden)o+=' ss:Hidden="1"'}return o+">"}function write_ws_xlml_table(ws,opts,idx,wb){if(!ws["!ref"])return"";var range=safe_decode_range(ws["!ref"]);var marr=ws["!merges"]||[],mi=0;var o=[];if(ws["!cols"])ws["!cols"].forEach(function(n,i){process_col(n);var w=!!n.width;var p=col_obj_w(i,n);var k={"ss:Index":i+1};if(w)k["ss:Width"]=width2px(p.width);if(n.hidden)k["ss:Hidden"]="1";o.push(writextag("Column",null,k))});var dense=Array.isArray(ws);for(var R=range.s.r;R<=range.e.r;++R){var row=[write_ws_xlml_row(R,(ws["!rows"]||[])[R])];for(var C=range.s.c;C<=range.e.c;++C){var skip=false;for(mi=0;mi!=marr.length;++mi){if(marr[mi].s.c>C)continue;if(marr[mi].s.r>R)continue;if(marr[mi].e.c<C)continue;if(marr[mi].e.r<R)continue;if(marr[mi].s.c!=C||marr[mi].s.r!=R)skip=true;break}if(skip)continue;var addr={r:R,c:C};var ref=encode_cell(addr),cell=dense?(ws[R]||[])[C]:ws[ref];row.push(write_ws_xlml_cell(cell,ref,ws,opts,idx,wb,addr))}row.push("</Row>");if(row.length>2)o.push(row.join(""))}return o.join("")}function write_ws_xlml(idx,opts,wb){var o=[];var s=wb.SheetNames[idx];var ws=wb.Sheets[s];var t=ws?write_ws_xlml_table(ws,opts,idx,wb):"";if(t.length>0)o.push("<Table>"+t+"</Table>");o.push(write_ws_xlml_wsopts(ws,opts,idx,wb));return o.join("")}function write_xlml(wb,opts){var d=[];d.push(write_props_xlml(wb,opts));d.push(write_wb_xlml(wb,opts));d.push(write_sty_xlml(wb,opts));for(var i=0;i<wb.SheetNames.length;++i)d.push(writextag("Worksheet",write_ws_xlml(i,opts,wb),{"ss:Name":escapexml(wb.SheetNames[i])}));return XML_HEADER+writextag("Workbook",d.join(""),{xmlns:XLMLNS.ss,"xmlns:o":XLMLNS.o,"xmlns:x":XLMLNS.x,"xmlns:ss":XLMLNS.ss,"xmlns:dt":XLMLNS.dt,"xmlns:html":XLMLNS.html})}function parse_compobj(obj){var v={};var o=obj.content;var l=28,m;m=__lpstr(o,l);l+=4+__readUInt32LE(o,l);v.UserType=m;m=__readUInt32LE(o,l);l+=4;switch(m){case 0:break;case 4294967295:;case 4294967294:l+=4;break;default:if(m>400)throw new Error("Unsupported Clipboard: "+m.toString(16));l+=m;}m=__lpstr(o,l);l+=m.length===0?0:5+m.length;v.Reserved1=m;if((m=__readUInt32LE(o,l))!==1907550708)return v;throw new Error("Unsupported Unicode Extension")}function slurp(R,blob,length,opts){var l=length;var bufs=[];var d=blob.slice(blob.l,blob.l+l);if(opts&&opts.enc&&opts.enc.insitu_decrypt)switch(R.n){case"BOF":;case"FilePass":;case"FileLock":;case"InterfaceHdr":;case"RRDInfo":;case"RRDHead":;case"UsrExcl":break;default:if(d.length===0)break;opts.enc.insitu_decrypt(d);}bufs.push(d);blob.l+=l;var next=XLSRecordEnum[__readUInt16LE(blob,blob.l)];while(next!=null&&next.n==="Continue"){l=__readUInt16LE(blob,blob.l+2);bufs.push(blob.slice(blob.l+4,blob.l+4+l));blob.l+=4+l;next=XLSRecordEnum[__readUInt16LE(blob,blob.l)]}var b=bconcat(bufs);prep_blob(b,0);var ll=0;b.lens=[];for(var j=0;j<bufs.length;++j){b.lens.push(ll);ll+=bufs[j].length}return R.f(b,b.length,opts)}function safe_format_xf(p,opts,date1904){if(p.t==="z")return;if(!p.XF)return;var fmtid=0;try{fmtid=p.z||p.XF.ifmt||0;if(opts.cellNF)p.z=SSF._table[fmtid]}catch(e){if(opts.WTF)throw e}if(!opts||opts.cellText!==false)try{if(p.t==="e"){p.w=p.w||BErr[p.v]}else if(fmtid===0){if(p.t==="n"){if((p.v|0)===p.v)p.w=SSF._general_int(p.v);else p.w=SSF._general_num(p.v)}else p.w=SSF._general(p.v)}else p.w=SSF.format(fmtid,p.v,{date1904:!!date1904});if(opts.cellDates&&fmtid&&p.t=="n"&&SSF.is_date(SSF._table[fmtid])){var _d=SSF.parse_date_code(p.v);if(_d){p.t="d";p.v=new Date(_d.y,_d.m-1,_d.d,_d.H,_d.M,_d.S,_d.u)}}}catch(e){if(opts.WTF)throw e}}function make_cell(val,ixfe,t){return{v:val,ixfe:ixfe,t:t}}function parse_workbook(blob,options){var wb={opts:{}};var Sheets={};if(DENSE!=null&&options.dense==null)options.dense=DENSE;var out=options.dense?[]:{};var Directory={};var found_sheet=false;var range={};var last_formula=null;var sst=[];var cur_sheet="";var Preamble={};var lastcell,last_cell="",cc,cmnt,rng,rngC,rngR;var shared_formulae={};var array_formulae=[];var temp_val;var country;var cell_valid=true;var XFs=[];var palette=[];var Workbook={Sheets:[],WBProps:{date1904:false}},wsprops={};var get_rgb=function getrgb(icv){if(icv<8)return XLSIcv[icv];if(icv<64)return palette[icv-8]||XLSIcv[icv];return XLSIcv[icv]};var process_cell_style=function pcs(cell,line,options){var xfd=line.XF.data;if(!xfd||!xfd.patternType||!options||!options.cellStyles)return;line.s={};line.s.patternType=xfd.patternType;var t;if(t=rgb2Hex(get_rgb(xfd.icvFore))){line.s.fgColor={rgb:t}}if(t=rgb2Hex(get_rgb(xfd.icvBack))){line.s.bgColor={rgb:t}}};var addcell=function addcell(cell,line,options){if(file_depth>1)return;if(!cell_valid)return;if(options.cellStyles&&line.XF&&line.XF.data)process_cell_style(cell,line,options);lastcell=cell;last_cell=encode_cell(cell);if(range.s){if(cell.r<range.s.r)range.s.r=cell.r;if(cell.c<range.s.c)range.s.c=cell.c}if(range.e){if(cell.r+1>range.e.r)range.e.r=cell.r+1;if(cell.c+1>range.e.c)range.e.c=cell.c+1}if(options.cellFormula&&line.f){for(var afi=0;afi<array_formulae.length;++afi){if(array_formulae[afi][0].s.c>cell.c)continue;if(array_formulae[afi][0].s.r>cell.r)continue;if(array_formulae[afi][0].e.c<cell.c)continue;if(array_formulae[afi][0].e.r<cell.r)continue;line.F=encode_range(array_formulae[afi][0]);if(array_formulae[afi][0].s.c!=cell.c)delete line.f;if(array_formulae[afi][0].s.r!=cell.r)delete line.f;if(line.f)line.f=""+stringify_formula(array_formulae[afi][1],range,cell,supbooks,opts);break}}if(options.sheetRows&&lastcell.r>=options.sheetRows)cell_valid=false;else{if(options.dense){if(!out[cell.r])out[cell.r]=[];out[cell.r][cell.c]=line}else out[last_cell]=line}};var opts={enc:false,sbcch:0,snames:[],sharedf:shared_formulae,arrayf:array_formulae,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!options&&!!options.cellStyles,WTF:!!options&&!!options.wtf};if(options.password)opts.password=options.password;var mergecells=[];var objects=[];var colinfo=[],rowinfo=[];var defwidth=0,defheight=0;var seencol=false;var supbooks=[];supbooks.SheetNames=opts.snames;supbooks.sharedf=opts.sharedf;supbooks.arrayf=opts.arrayf;supbooks.names=[];supbooks.XTI=[];var last_Rn="";var file_depth=0;var BIFF2Fmt=0;var BIFF2FmtTable=[];var FilterDatabases=[];var last_lbl;opts.codepage=1200;set_cp(1200);while(blob.l<blob.length-1){var s=blob.l;var RecordType=blob.read_shift(2);if(RecordType===0&&last_Rn==="EOF")break;var length=blob.l===blob.length?0:blob.read_shift(2),y;var R=XLSRecordEnum[RecordType];if(R&&R.f){if(options.bookSheets){if(last_Rn==="BoundSheet8"&&R.n!=="BoundSheet8")break}last_Rn=R.n;if(R.r===2||R.r==12){var rt=blob.read_shift(2);length-=2;if(!opts.enc&&rt!==RecordType)throw"rt mismatch";if(R.r==12){blob.l+=10;length-=10}}var val;if(R.n==="EOF")val=R.f(blob,length,opts);else val=slurp(R,blob,length,opts);var Rn=R.n;switch(Rn){case"Date1904":wb.opts.Date1904=Workbook.WBProps.date1904=val;break;case"WriteProtect":wb.opts.WriteProtect=true;break;case"FilePass":if(!opts.enc)blob.l=0;opts.enc=val;if(opts.WTF)console.error(val);if(!options.password)throw new Error("File is password-protected");if(val.valid==null)throw new Error("Encryption scheme unsupported");if(!val.valid)throw new Error("Password is incorrect");break;case"WriteAccess":opts.lastuser=val;break;case"FileSharing":break;case"CodePage":if(val===21010)val=1200;else if(val===32769)val=1252;opts.codepage=val;set_cp(val);break;case"RRTabId":opts.rrtabid=val;break;case"WinProtect":opts.winlocked=val;break;case"Template":break;case"RefreshAll":wb.opts.RefreshAll=val;break;case"BookBool":break;case"UsesELFs":break;case"MTRSettings":break;case"CalcCount":wb.opts.CalcCount=val;break;case"CalcDelta":wb.opts.CalcDelta=val;break;case"CalcIter":wb.opts.CalcIter=val;break;case"CalcMode":wb.opts.CalcMode=val;break;case"CalcPrecision":wb.opts.CalcPrecision=val;break;case"CalcSaveRecalc":wb.opts.CalcSaveRecalc=val;break;case"CalcRefMode":opts.CalcRefMode=val;break;case"Uncalced":break;case"ForceFullCalculation":wb.opts.FullCalc=val;break;case"WsBool":break;case"XF":XFs.push(val);break;case"ExtSST":break;case"BookExt":break;case"RichTextStream":break;case"BkHim":break;case"SupBook":supbooks.push([val]);supbooks[supbooks.length-1].XTI=[];break;case"ExternName":supbooks[supbooks.length-1].push(val);break;case"Index":break;case"Lbl":last_lbl={Name:val.Name,Ref:stringify_formula(val.rgce,range,null,supbooks,opts)};if(val.itab>0)last_lbl.Sheet=val.itab-1;supbooks.names.push(last_lbl);if(!supbooks[0])supbooks[0]=[];supbooks[supbooks.length-1].push(val);if(val.Name=="_xlnm._FilterDatabase"&&val.itab>0)if(val.rgce&&val.rgce[0]&&val.rgce[0][0]&&val.rgce[0][0][0]=="PtgArea3d")FilterDatabases[val.itab-1]={ref:encode_range(val.rgce[0][0][1][2])};break;case"ExternSheet":if(supbooks.length==0){supbooks[0]=[];supbooks[0].XTI=[]}supbooks[supbooks.length-1].XTI=supbooks[supbooks.length-1].XTI.concat(val);supbooks.XTI=supbooks.XTI.concat(val);break;case"NameCmt":if(opts.biff<8)break;if(last_lbl!=null)last_lbl.Comment=val[1];break;case"Protect":out["!protect"]=val;break;case"Password":if(val!==0&&opts.WTF)console.error("Password verifier: "+val);break;case"Prot4Rev":;case"Prot4RevPass":break;case"BoundSheet8":{Directory[val.pos]=val;opts.snames.push(val.name)}break;case"EOF":{if(--file_depth)break;if(range.e){if(range.e.r>0&&range.e.c>0){range.e.r--;range.e.c--;out["!ref"]=encode_range(range);range.e.r++;range.e.c++}if(mergecells.length>0)out["!merges"]=mergecells;if(objects.length>0)out["!objects"]=objects;if(colinfo.length>0)out["!cols"]=colinfo;if(rowinfo.length>0)out["!rows"]=rowinfo;Workbook.Sheets.push(wsprops)}if(cur_sheet==="")Preamble=out;else Sheets[cur_sheet]=out;out=options.dense?[]:{}}break;case"BOF":{if(opts.biff!==8){}else if(RecordType===9)opts.biff=2;else if(RecordType===521)opts.biff=3;else if(RecordType===1033)opts.biff=4;else if(val.BIFFVer===1280)opts.biff=5;else if(val.BIFFVer===1536)opts.biff=8;else if(val.BIFFVer===2)opts.biff=2;else if(val.BIFFVer===7)opts.biff=2;if(file_depth++)break;cell_valid=true;out=options.dense?[]:{};if(opts.biff<5){if(cur_sheet==="")cur_sheet="Sheet1";range={s:{r:0,c:0},e:{r:0,c:0}};var fakebs8={pos:blob.l-length,name:cur_sheet};Directory[fakebs8.pos]=fakebs8;opts.snames.push(cur_sheet)}else cur_sheet=(Directory[s]||{name:""}).name;if(val.dt==32)out["!type"]="chart";mergecells=[];objects=[];array_formulae=[];opts.arrayf=array_formulae;colinfo=[];rowinfo=[];defwidth=defheight=0;seencol=false;wsprops={Hidden:(Directory[s]||{hs:0}).hs,name:cur_sheet}}break;case"Number":;case"BIFF2NUM":;case"BIFF2INT":{if(out["!type"]=="chart")if(options.dense?(out[val.r]||[])[val.c]:out[encode_cell({c:val.c,r:val.r})])++val.c;temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe]||{},v:val.val,t:"n"};if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:val.c,r:val.r},temp_val,options)}break;case"BoolErr":{temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.val,t:val.t};if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:val.c,r:val.r},temp_val,options)}break;case"RK":{temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.rknum,t:"n"};if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:val.c,r:val.r},temp_val,options)}break;case"MulRk":{for(var j=val.c;j<=val.C;++j){var ixfe=val.rkrec[j-val.c][0];temp_val={ixfe:ixfe,XF:XFs[ixfe],v:val.rkrec[j-val.c][1],t:"n"};if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:j,r:val.r},temp_val,options)}}break;case"Formula":{if(val.val=="String"){last_formula=val;break}temp_val=make_cell(val.val,val.cell.ixfe,val.tt);temp_val.XF=XFs[temp_val.ixfe];if(options.cellFormula){var _f=val.formula;if(_f&&_f[0]&&_f[0][0]&&_f[0][0][0]=="PtgExp"){var _fr=_f[0][0][1][0],_fc=_f[0][0][1][1];var _fe=encode_cell({r:_fr,c:_fc});if(shared_formulae[_fe])temp_val.f=""+stringify_formula(val.formula,range,val.cell,supbooks,opts);else temp_val.F=((options.dense?(out[_fr]||[])[_fc]:out[_fe])||{}).F}else temp_val.f=""+stringify_formula(val.formula,range,val.cell,supbooks,opts)}if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell(val.cell,temp_val,options);last_formula=val}break;case"String":{if(last_formula){last_formula.val=val;temp_val=make_cell(val,last_formula.cell.ixfe,"s");temp_val.XF=XFs[temp_val.ixfe];if(options.cellFormula){temp_val.f=""+stringify_formula(last_formula.formula,range,last_formula.cell,supbooks,opts)}if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell(last_formula.cell,temp_val,options);last_formula=null}else throw new Error("String record expects Formula")}break;case"Array":{array_formulae.push(val);var _arraystart=encode_cell(val[0].s);cc=options.dense?(out[val[0].s.r]||[])[val[0].s.c]:out[_arraystart];if(options.cellFormula&&cc){if(!last_formula)break;if(!_arraystart||!cc)break;cc.f=""+stringify_formula(val[1],range,val[0],supbooks,opts);cc.F=encode_range(val[0])}}break;case"ShrFmla":{if(!cell_valid)break;if(!options.cellFormula)break;if(last_cell){if(!last_formula)break;shared_formulae[encode_cell(last_formula.cell)]=val[0];cc=options.dense?(out[last_formula.cell.r]||[])[last_formula.cell.c]:out[encode_cell(last_formula.cell)];(cc||{}).f=""+stringify_formula(val[0],range,lastcell,supbooks,opts)}}break;case"LabelSst":temp_val=make_cell(sst[val.isst].t,val.ixfe,"s");temp_val.XF=XFs[temp_val.ixfe];if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:val.c,r:val.r},temp_val,options);break;case"Blank":if(options.sheetStubs){temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],t:"z"};if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:val.c,r:val.r},temp_val,options)}break;case"MulBlank":if(options.sheetStubs){for(var _j=val.c;_j<=val.C;++_j){var _ixfe=val.ixfe[_j-val.c];temp_val={ixfe:_ixfe,XF:XFs[_ixfe],t:"z"};if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:_j,r:val.r},temp_val,options)}}break;case"RString":;case"Label":;case"BIFF2STR":temp_val=make_cell(val.val,val.ixfe,"s");temp_val.XF=XFs[temp_val.ixfe];if(BIFF2Fmt>0)temp_val.z=BIFF2FmtTable[temp_val.ixfe>>8&31];safe_format_xf(temp_val,options,wb.opts.Date1904);addcell({c:val.c,r:val.r},temp_val,options);break;case"Dimensions":{if(file_depth===1)range=val}break;case"SST":{sst=val}break;case"Format":{SSF.load(val[1],val[0])}break;case"BIFF2FORMAT":{BIFF2FmtTable[BIFF2Fmt++]=val;for(var b2idx=0;b2idx<BIFF2Fmt+163;++b2idx)if(SSF._table[b2idx]==val)break;if(b2idx>=163)SSF.load(val,BIFF2Fmt+163)}break;case"MergeCells":mergecells=mergecells.concat(val);break;case"Obj":objects[val.cmo[0]]=opts.lastobj=val;break;case"TxO":opts.lastobj.TxO=val;break;case"ImData":opts.lastobj.ImData=val;break;case"HLink":{for(rngR=val[0].s.r;rngR<=val[0].e.r;++rngR)for(rngC=val[0].s.c;rngC<=val[0].e.c;++rngC){cc=options.dense?(out[rngR]||[])[rngC]:out[encode_cell({c:rngC,r:rngR})];if(cc)cc.l=val[1]}}break;case"HLinkTooltip":{for(rngR=val[0].s.r;rngR<=val[0].e.r;++rngR)for(rngC=val[0].s.c;rngC<=val[0].e.c;++rngC){cc=options.dense?(out[rngR]||[])[rngC]:out[encode_cell({c:rngC,r:rngR})];if(cc)cc.l.Tooltip=val[1]}}break;case"Note":{if(opts.biff<=5&&opts.biff>=2)break;cc=options.dense?(out[val[0].r]||[])[val[0].c]:out[encode_cell(val[0])];var noteobj=objects[val[2]];if(!cc)break;if(!cc.c)cc.c=[];cmnt={a:val[1],t:noteobj.TxO.t};cc.c.push(cmnt)}break;default:switch(R.n){case"ClrtClient":break;case"XFExt":update_xfext(XFs[val.ixfe],val.ext);break;case"DefColWidth":defwidth=val;break;case"DefaultRowHeight":defheight=val[1];break;case"ColInfo":{if(!opts.cellStyles)break;while(val.e>=val.s){colinfo[val.e--]={width:val.w/256};if(!seencol){seencol=true;find_mdw_colw(val.w/256)}process_col(colinfo[val.e+1])}}break;case"Row":{var rowobj={};if(val.level!=null){rowinfo[val.r]=rowobj;rowobj.level=val.level}if(val.hidden){rowinfo[val.r]=rowobj;rowobj.hidden=true}if(val.hpt){rowinfo[val.r]=rowobj;rowobj.hpt=val.hpt;rowobj.hpx=pt2px(val.hpt)}}break;case"LeftMargin":;case"RightMargin":;case"TopMargin":;case"BottomMargin":if(!out["!margins"])default_margins(out["!margins"]={});out["!margins"][Rn.slice(0,-6).toLowerCase()]=val;break;case"Setup":if(!out["!margins"])default_margins(out["!margins"]={});out["!margins"].header=val.header;out["!margins"].footer=val.footer;break;case"Header":break;case"Footer":break;case"HCenter":break;case"VCenter":break;case"Pls":break;case"GCW":break;case"LHRecord":break;case"DBCell":break;case"EntExU2":break;case"SxView":break;case"Sxvd":break;case"SXVI":break;case"SXVDEx":break;case"SxIvd":break;case"SXDI":break;case"SXLI":break;case"SXEx":break;case"QsiSXTag":break;case"Selection":break;case"Feat":break;case"FeatHdr":;case"FeatHdr11":break;case"Feature11":;case"Feature12":;case"List12":break;case"Country":country=val;break;case"RecalcId":break;case"DxGCol":break;case"Fbi":;case"Fbi2":;case"GelFrame":break;case"Font":break;case"XFCRC":break;case"Style":break;case"StyleExt":break;case"Palette":palette=val;break;case"Theme":break;case"ScenarioProtect":break;case"ObjProtect":break;case"CondFmt12":break;case"Table":break;case"TableStyles":break;case"TableStyle":break;case"TableStyleElement":break;case"SXStreamID":break;case"SXVS":break;case"DConRef":break;case"SXAddl":break;case"DConBin":break;case"DConName":break;case"SXPI":break;case"SxFormat":break;case"SxSelect":break;case"SxRule":break;case"SxFilt":break;case"SxItm":break;case"SxDXF":break;case"ScenMan":break;case"DCon":break;case"CellWatch":break;case"PrintRowCol":break;case"PrintGrid":break;case"PrintSize":break;case"XCT":break;case"CRN":break;case"Scl":{}break;case"SheetExt":{}break;case"SheetExtOptional":{}break;case"ObNoMacros":{}break;case"ObProj":{}break;case"CodeName":{}break;case"GUIDTypeLib":{}break;case"WOpt":break;case"PhoneticInfo":break;case"OleObjectSize":break;case"DXF":;case"DXFN":;case"DXFN12":;case"DXFN12List":;case"DXFN12NoCB":break;case"Dv":;case"DVal":break;case"BRAI":;case"Series":;case"SeriesText":break;case"DConn":break;case"DbOrParamQry":break;case"DBQueryExt":break;case"IFmtRecord":break;case"CondFmt":;case"CF":;case"CF12":;case"CFEx":break;case"Excel9File":break;case"Units":break;case"InterfaceHdr":;case"Mms":;case"InterfaceEnd":;case"DSF":;case"BuiltInFnGroupCount":break;case"Window1":;case"Window2":;case"HideObj":;case"GridSet":;case"Guts":;case"UserBView":;case"UserSViewBegin":;case"UserSViewEnd":;case"Pane":break;default:switch(R.n){case"Dat":;case"Begin":;case"End":;case"StartBlock":;case"EndBlock":;case"Frame":;case"Area":;case"Axis":;case"AxisLine":;case"Tick":break;case"AxesUsed":;case"CrtLayout12":;case"CrtLayout12A":;case"CrtLink":;case"CrtLine":;case"CrtMlFrt":;case"CrtMlFrtContinue":break;case"LineFormat":;case"AreaFormat":;case"Chart":;case"Chart3d":;case"Chart3DBarShape":;case"ChartFormat":;case"ChartFrtInfo":break;case"PlotArea":;case"PlotGrowth":break;case"SeriesList":;case"SerParent":;case"SerAuxTrend":break;case"DataFormat":;case"SerToCrt":;case"FontX":break;case"CatSerRange":;case"AxcExt":;case"SerFmt":break;case"ShtProps":break;case"DefaultText":;case"Text":;case"CatLab":break;case"DataLabExtContents":break;case"Legend":;case"LegendException":break;case"Pie":;case"Scatter":break;case"PieFormat":;case"MarkerFormat":break;case"StartObject":;case"EndObject":break;case"AlRuns":;case"ObjectLink":break;case"SIIndex":break;case"AttachedLabel":;case"YMult":break;case"Line":;case"Bar":break;case"Surf":break;case"AxisParent":break;case"Pos":break;case"ValueRange":break;case"SXViewEx9":break;case"SXViewLink":break;case"PivotChartBits":break;case"SBaseRef":break;case"TextPropsStream":break;case"LnExt":break;case"MkrExt":break;case"CrtCoopt":break;case"Qsi":;case"Qsif":;case"Qsir":;case"QsiSXTag":break;case"TxtQry":break;case"FilterMode":break;case"AutoFilter":;case"AutoFilterInfo":break;case"AutoFilter12":break;case"DropDownObjIds":break;case"Sort":break;case"SortData":break;case"ShapePropsStream":break;case"MsoDrawing":;case"MsoDrawingGroup":;case"MsoDrawingSelection":break;case"WebPub":;case"AutoWebPub":break;case"HeaderFooter":;case"HFPicture":;case"PLV":;case"HorizontalPageBreaks":;case"VerticalPageBreaks":break;case"Backup":;case"CompressPictures":;case"Compat12":break;case"Continue":;case"ContinueFrt12":break;case"FrtFontList":;case"FrtWrapper":break;default:switch(R.n){case"ExternCount":break;case"TabIdConf":;case"Radar":;case"RadarArea":;case"DropBar":;case"Intl":;case"CoordList":;case"SerAuxErrBar":break;case"BIFF2FONTCLR":;case"BIFF2FMTCNT":;case"BIFF2FONTXTRA":break;case"BIFF2XF":;case"BIFF3XF":;case"BIFF4XF":break;case"BIFF4FMTCNT":;case"BIFF2ROW":;case"BIFF2WINDOW2":break;case"SCENARIO":;case"DConBin":;case"PicF":;case"DataLabExt":;case"Lel":;case"BopPop":;case"BopPopCustom":;case"RealTimeData":;case"Name":break;default:if(options.WTF)throw"Unrecognized Record "+R.n;};};};}}else blob.l+=length}var sheetnamesraw=Object.keys(Directory).sort(function(a,b){return Number(a)-Number(b)}).map(function(x){return Directory[x].name});var sheetnames=sheetnamesraw.slice();wb.Directory=sheetnamesraw;wb.SheetNames=sheetnamesraw;if(!options.bookSheets)wb.Sheets=Sheets;if(wb.Sheets)FilterDatabases.forEach(function(r,i){wb.Sheets[wb.SheetNames[i]]["!autofilter"]=r});wb.Preamble=Preamble;wb.Strings=sst;wb.SSF=SSF.get_table();if(opts.enc)wb.Encryption=opts.enc;wb.Metadata={};if(country!==undefined)wb.Metadata.Country=country;if(supbooks.names.length>0)Workbook.Names=supbooks.names;wb.Workbook=Workbook;return wb}function parse_props(cfb){var DSI=cfb.find("!DocumentSummaryInformation");if(DSI)try{cfb.DocSummary=parse_PropertySetStream(DSI,DocSummaryPIDDSI)}catch(e){}var SI=cfb.find("!SummaryInformation");if(SI)try{cfb.Summary=parse_PropertySetStream(SI,SummaryPIDSI)}catch(e){}}function parse_xlscfb(cfb,options){if(!options)options={};fix_read_opts(options);reset_cp();var CompObj,Summary,Workbook;if(cfb.FullPaths){CompObj=cfb.find("!CompObj");Summary=cfb.find("!SummaryInformation");Workbook=cfb.find("/Workbook")}else{prep_blob(cfb,0);Workbook={content:cfb}}if(!Workbook)Workbook=cfb.find("/Book");var CompObjP,SummaryP,WorkbookP;if(CompObj)CompObjP=parse_compobj(CompObj);if(options.bookProps&&!options.bookSheets)WorkbookP={};else{if(Workbook)WorkbookP=parse_workbook(Workbook.content,options,!!Workbook.find);else if(cfb.find("PerfectOffice_MAIN"))WorkbookP=WK_.to_workbook(cfb.find("PerfectOffice_MAIN").content,options);else if(cfb.find("NativeContent_MAIN"))WorkbookP=WK_.to_workbook(cfb.find("NativeContent_MAIN").content,options);else throw new Error("Cannot find Workbook stream")}if(cfb.FullPaths)parse_props(cfb);var props={};for(var y in cfb.Summary)props[y]=cfb.Summary[y];for(y in cfb.DocSummary)props[y]=cfb.DocSummary[y];WorkbookP.Props=WorkbookP.Custprops=props;if(options.bookFiles)WorkbookP.cfb=cfb;return WorkbookP}var XLSBRecordEnum={0:{n:"BrtRowHdr",f:parse_BrtRowHdr},1:{n:"BrtCellBlank",f:parse_BrtCellBlank},2:{n:"BrtCellRk",f:parse_BrtCellRk},3:{n:"BrtCellError",f:parse_BrtCellError},4:{n:"BrtCellBool",f:parse_BrtCellBool},5:{n:"BrtCellReal",f:parse_BrtCellReal},6:{n:"BrtCellSt",f:parse_BrtCellSt},7:{n:"BrtCellIsst",f:parse_BrtCellIsst},8:{n:"BrtFmlaString",f:parse_BrtFmlaString},9:{n:"BrtFmlaNum",f:parse_BrtFmlaNum},10:{n:"BrtFmlaBool",f:parse_BrtFmlaBool},11:{n:"BrtFmlaError",f:parse_BrtFmlaError},16:{n:"BrtFRTArchID$",f:parse_BrtFRTArchID$},19:{n:"BrtSSTItem",f:parse_RichStr},20:{n:"BrtPCDIMissing",f:parsenoop},21:{n:"BrtPCDINumber",f:parsenoop},22:{n:"BrtPCDIBoolean",f:parsenoop},23:{n:"BrtPCDIError",f:parsenoop},24:{n:"BrtPCDIString",f:parsenoop},25:{n:"BrtPCDIDatetime",f:parsenoop},26:{n:"BrtPCDIIndex",f:parsenoop},27:{n:"BrtPCDIAMissing",f:parsenoop},28:{n:"BrtPCDIANumber",f:parsenoop},29:{n:"BrtPCDIABoolean",f:parsenoop},30:{n:"BrtPCDIAError",f:parsenoop},31:{n:"BrtPCDIAString",f:parsenoop},32:{n:"BrtPCDIADatetime",f:parsenoop},33:{n:"BrtPCRRecord",f:parsenoop},34:{n:"BrtPCRRecordDt",f:parsenoop},35:{n:"BrtFRTBegin",f:parsenoop},36:{n:"BrtFRTEnd",f:parsenoop},37:{n:"BrtACBegin",f:parsenoop},38:{n:"BrtACEnd",f:parsenoop},39:{n:"BrtName",f:parse_BrtName},40:{n:"BrtIndexRowBlock",f:parsenoop},42:{n:"BrtIndexBlock",f:parsenoop},43:{n:"BrtFont",f:parse_BrtFont},44:{n:"BrtFmt",f:parse_BrtFmt},45:{n:"BrtFill",f:parsenoop},46:{n:"BrtBorder",f:parsenoop},47:{n:"BrtXF",f:parse_BrtXF},48:{n:"BrtStyle",f:parsenoop},49:{n:"BrtCellMeta",f:parsenoop},50:{n:"BrtValueMeta",f:parsenoop},51:{n:"BrtMdb",f:parsenoop},52:{n:"BrtBeginFmd",f:parsenoop},53:{n:"BrtEndFmd",f:parsenoop},54:{n:"BrtBeginMdx",f:parsenoop},55:{n:"BrtEndMdx",f:parsenoop},56:{n:"BrtBeginMdxTuple",f:parsenoop},57:{n:"BrtEndMdxTuple",f:parsenoop},58:{n:"BrtMdxMbrIstr",f:parsenoop},59:{n:"BrtStr",f:parsenoop},60:{n:"BrtColInfo",f:parse_ColInfo},62:{n:"BrtCellRString",f:parsenoop},63:{n:"BrtCalcChainItem$",f:parse_BrtCalcChainItem$},64:{n:"BrtDVal",f:parsenoop},65:{n:"BrtSxvcellNum",f:parsenoop},66:{n:"BrtSxvcellStr",f:parsenoop},67:{n:"BrtSxvcellBool",f:parsenoop},68:{n:"BrtSxvcellErr",f:parsenoop},69:{n:"BrtSxvcellDate",f:parsenoop},70:{n:"BrtSxvcellNil",f:parsenoop},128:{n:"BrtFileVersion",f:parsenoop},129:{n:"BrtBeginSheet",f:parsenoop},130:{n:"BrtEndSheet",f:parsenoop},131:{n:"BrtBeginBook",f:parsenoop,p:0},132:{n:"BrtEndBook",f:parsenoop},133:{n:"BrtBeginWsViews",f:parsenoop},134:{n:"BrtEndWsViews",f:parsenoop},135:{n:"BrtBeginBookViews",f:parsenoop},136:{n:"BrtEndBookViews",f:parsenoop},137:{n:"BrtBeginWsView",f:parsenoop},138:{n:"BrtEndWsView",f:parsenoop},139:{n:"BrtBeginCsViews",f:parsenoop},140:{n:"BrtEndCsViews",f:parsenoop},141:{n:"BrtBeginCsView",f:parsenoop},142:{n:"BrtEndCsView",f:parsenoop},143:{n:"BrtBeginBundleShs",f:parsenoop},144:{n:"BrtEndBundleShs",f:parsenoop},145:{n:"BrtBeginSheetData",f:parsenoop},146:{n:"BrtEndSheetData",f:parsenoop},147:{n:"BrtWsProp",f:parse_BrtWsProp},148:{n:"BrtWsDim",f:parse_BrtWsDim,p:16},151:{n:"BrtPane",f:parsenoop},152:{n:"BrtSel",f:parsenoop},153:{n:"BrtWbProp",f:parse_BrtWbProp},154:{n:"BrtWbFactoid",f:parsenoop},155:{n:"BrtFileRecover",f:parsenoop},156:{n:"BrtBundleSh",f:parse_BrtBundleSh},157:{n:"BrtCalcProp",f:parsenoop},158:{n:"BrtBookView",f:parsenoop},159:{n:"BrtBeginSst",f:parse_BrtBeginSst},160:{n:"BrtEndSst",f:parsenoop},161:{n:"BrtBeginAFilter",f:parse_UncheckedRfX},162:{n:"BrtEndAFilter",f:parsenoop},163:{n:"BrtBeginFilterColumn",f:parsenoop},164:{n:"BrtEndFilterColumn",f:parsenoop},165:{n:"BrtBeginFilters",f:parsenoop},166:{n:"BrtEndFilters",f:parsenoop},167:{n:"BrtFilter",f:parsenoop},168:{n:"BrtColorFilter",f:parsenoop},169:{n:"BrtIconFilter",f:parsenoop},170:{n:"BrtTop10Filter",f:parsenoop},171:{n:"BrtDynamicFilter",f:parsenoop},172:{n:"BrtBeginCustomFilters",f:parsenoop},173:{n:"BrtEndCustomFilters",f:parsenoop},174:{n:"BrtCustomFilter",f:parsenoop},175:{n:"BrtAFilterDateGroupItem",f:parsenoop},176:{n:"BrtMergeCell",f:parse_BrtMergeCell},177:{n:"BrtBeginMergeCells",f:parsenoop},178:{n:"BrtEndMergeCells",f:parsenoop},179:{n:"BrtBeginPivotCacheDef",f:parsenoop},180:{n:"BrtEndPivotCacheDef",f:parsenoop},181:{n:"BrtBeginPCDFields",f:parsenoop},182:{n:"BrtEndPCDFields",f:parsenoop},183:{n:"BrtBeginPCDField",f:parsenoop},184:{n:"BrtEndPCDField",f:parsenoop},185:{n:"BrtBeginPCDSource",f:parsenoop},186:{n:"BrtEndPCDSource",f:parsenoop},187:{n:"BrtBeginPCDSRange",f:parsenoop},188:{n:"BrtEndPCDSRange",f:parsenoop},189:{n:"BrtBeginPCDFAtbl",f:parsenoop},190:{n:"BrtEndPCDFAtbl",f:parsenoop},191:{n:"BrtBeginPCDIRun",f:parsenoop},192:{n:"BrtEndPCDIRun",f:parsenoop},193:{n:"BrtBeginPivotCacheRecords",f:parsenoop},194:{n:"BrtEndPivotCacheRecords",f:parsenoop},195:{n:"BrtBeginPCDHierarchies",f:parsenoop},196:{n:"BrtEndPCDHierarchies",f:parsenoop},197:{n:"BrtBeginPCDHierarchy",f:parsenoop},198:{n:"BrtEndPCDHierarchy",f:parsenoop},199:{n:"BrtBeginPCDHFieldsUsage",f:parsenoop},200:{n:"BrtEndPCDHFieldsUsage",f:parsenoop},201:{n:"BrtBeginExtConnection",f:parsenoop},202:{n:"BrtEndExtConnection",f:parsenoop},203:{n:"BrtBeginECDbProps",f:parsenoop},204:{n:"BrtEndECDbProps",f:parsenoop},205:{n:"BrtBeginECOlapProps",f:parsenoop},206:{n:"BrtEndECOlapProps",f:parsenoop},207:{n:"BrtBeginPCDSConsol",f:parsenoop},208:{n:"BrtEndPCDSConsol",f:parsenoop},209:{n:"BrtBeginPCDSCPages",f:parsenoop},210:{n:"BrtEndPCDSCPages",f:parsenoop},211:{n:"BrtBeginPCDSCPage",f:parsenoop},212:{n:"BrtEndPCDSCPage",f:parsenoop},213:{n:"BrtBeginPCDSCPItem",f:parsenoop},214:{n:"BrtEndPCDSCPItem",f:parsenoop},215:{n:"BrtBeginPCDSCSets",f:parsenoop},216:{n:"BrtEndPCDSCSets",f:parsenoop},217:{n:"BrtBeginPCDSCSet",f:parsenoop},218:{n:"BrtEndPCDSCSet",f:parsenoop},219:{n:"BrtBeginPCDFGroup",f:parsenoop},220:{n:"BrtEndPCDFGroup",f:parsenoop},221:{n:"BrtBeginPCDFGItems",f:parsenoop},222:{n:"BrtEndPCDFGItems",f:parsenoop},223:{n:"BrtBeginPCDFGRange",f:parsenoop},224:{n:"BrtEndPCDFGRange",f:parsenoop},225:{n:"BrtBeginPCDFGDiscrete",f:parsenoop},226:{n:"BrtEndPCDFGDiscrete",f:parsenoop},227:{n:"BrtBeginPCDSDTupleCache",f:parsenoop},228:{n:"BrtEndPCDSDTupleCache",f:parsenoop},229:{n:"BrtBeginPCDSDTCEntries",f:parsenoop},230:{n:"BrtEndPCDSDTCEntries",f:parsenoop},231:{n:"BrtBeginPCDSDTCEMembers",f:parsenoop},232:{n:"BrtEndPCDSDTCEMembers",f:parsenoop},233:{n:"BrtBeginPCDSDTCEMember",f:parsenoop},234:{n:"BrtEndPCDSDTCEMember",f:parsenoop},235:{n:"BrtBeginPCDSDTCQueries",f:parsenoop},236:{n:"BrtEndPCDSDTCQueries",f:parsenoop},237:{n:"BrtBeginPCDSDTCQuery",f:parsenoop},238:{n:"BrtEndPCDSDTCQuery",f:parsenoop},239:{n:"BrtBeginPCDSDTCSets",f:parsenoop},240:{n:"BrtEndPCDSDTCSets",f:parsenoop},241:{n:"BrtBeginPCDSDTCSet",f:parsenoop},242:{n:"BrtEndPCDSDTCSet",f:parsenoop},243:{n:"BrtBeginPCDCalcItems",f:parsenoop},244:{n:"BrtEndPCDCalcItems",f:parsenoop},245:{n:"BrtBeginPCDCalcItem",f:parsenoop},246:{n:"BrtEndPCDCalcItem",f:parsenoop},247:{n:"BrtBeginPRule",f:parsenoop},248:{n:"BrtEndPRule",f:parsenoop},249:{n:"BrtBeginPRFilters",f:parsenoop},250:{n:"BrtEndPRFilters",f:parsenoop},251:{n:"BrtBeginPRFilter",f:parsenoop},252:{n:"BrtEndPRFilter",f:parsenoop},253:{n:"BrtBeginPNames",f:parsenoop},254:{n:"BrtEndPNames",f:parsenoop},255:{n:"BrtBeginPName",f:parsenoop},256:{n:"BrtEndPName",f:parsenoop},257:{n:"BrtBeginPNPairs",f:parsenoop},258:{n:"BrtEndPNPairs",f:parsenoop},259:{n:"BrtBeginPNPair",f:parsenoop},260:{n:"BrtEndPNPair",f:parsenoop},261:{n:"BrtBeginECWebProps",f:parsenoop},262:{n:"BrtEndECWebProps",f:parsenoop},263:{n:"BrtBeginEcWpTables",f:parsenoop},264:{n:"BrtEndECWPTables",f:parsenoop},265:{n:"BrtBeginECParams",f:parsenoop},266:{n:"BrtEndECParams",f:parsenoop},267:{n:"BrtBeginECParam",f:parsenoop},268:{n:"BrtEndECParam",f:parsenoop},269:{n:"BrtBeginPCDKPIs",f:parsenoop},270:{n:"BrtEndPCDKPIs",f:parsenoop},271:{n:"BrtBeginPCDKPI",f:parsenoop},272:{n:"BrtEndPCDKPI",f:parsenoop},273:{n:"BrtBeginDims",f:parsenoop},274:{n:"BrtEndDims",f:parsenoop},275:{n:"BrtBeginDim",f:parsenoop},276:{n:"BrtEndDim",f:parsenoop},277:{n:"BrtIndexPartEnd",f:parsenoop},278:{n:"BrtBeginStyleSheet",f:parsenoop},279:{n:"BrtEndStyleSheet",f:parsenoop},280:{n:"BrtBeginSXView",f:parsenoop},281:{n:"BrtEndSXVI",f:parsenoop},282:{n:"BrtBeginSXVI",f:parsenoop},283:{n:"BrtBeginSXVIs",f:parsenoop},284:{n:"BrtEndSXVIs",f:parsenoop},285:{n:"BrtBeginSXVD",f:parsenoop},286:{n:"BrtEndSXVD",f:parsenoop},287:{n:"BrtBeginSXVDs",f:parsenoop},288:{n:"BrtEndSXVDs",f:parsenoop},289:{n:"BrtBeginSXPI",f:parsenoop},290:{n:"BrtEndSXPI",f:parsenoop},291:{n:"BrtBeginSXPIs",f:parsenoop},292:{n:"BrtEndSXPIs",f:parsenoop},293:{n:"BrtBeginSXDI",f:parsenoop},294:{n:"BrtEndSXDI",f:parsenoop},295:{n:"BrtBeginSXDIs",f:parsenoop},296:{n:"BrtEndSXDIs",f:parsenoop},297:{n:"BrtBeginSXLI",f:parsenoop},298:{n:"BrtEndSXLI",f:parsenoop},299:{n:"BrtBeginSXLIRws",f:parsenoop},300:{n:"BrtEndSXLIRws",f:parsenoop},301:{n:"BrtBeginSXLICols",f:parsenoop},302:{n:"BrtEndSXLICols",f:parsenoop},303:{n:"BrtBeginSXFormat",f:parsenoop},304:{n:"BrtEndSXFormat",f:parsenoop},305:{n:"BrtBeginSXFormats",f:parsenoop},306:{n:"BrtEndSxFormats",f:parsenoop},307:{n:"BrtBeginSxSelect",f:parsenoop},308:{n:"BrtEndSxSelect",f:parsenoop},309:{n:"BrtBeginISXVDRws",f:parsenoop},310:{n:"BrtEndISXVDRws",f:parsenoop},311:{n:"BrtBeginISXVDCols",f:parsenoop},312:{n:"BrtEndISXVDCols",f:parsenoop},313:{n:"BrtEndSXLocation",f:parsenoop},314:{n:"BrtBeginSXLocation",f:parsenoop},315:{n:"BrtEndSXView",f:parsenoop},316:{n:"BrtBeginSXTHs",f:parsenoop},317:{n:"BrtEndSXTHs",f:parsenoop},318:{n:"BrtBeginSXTH",f:parsenoop},319:{n:"BrtEndSXTH",f:parsenoop},320:{n:"BrtBeginISXTHRws",f:parsenoop},321:{n:"BrtEndISXTHRws",f:parsenoop},322:{n:"BrtBeginISXTHCols",f:parsenoop},323:{n:"BrtEndISXTHCols",f:parsenoop},324:{n:"BrtBeginSXTDMPS",f:parsenoop},325:{n:"BrtEndSXTDMPs",f:parsenoop},326:{n:"BrtBeginSXTDMP",f:parsenoop},327:{n:"BrtEndSXTDMP",f:parsenoop},328:{n:"BrtBeginSXTHItems",f:parsenoop},329:{n:"BrtEndSXTHItems",f:parsenoop},330:{n:"BrtBeginSXTHItem",f:parsenoop},331:{n:"BrtEndSXTHItem",f:parsenoop},332:{n:"BrtBeginMetadata",f:parsenoop},333:{n:"BrtEndMetadata",f:parsenoop},334:{n:"BrtBeginEsmdtinfo",f:parsenoop},335:{n:"BrtMdtinfo",f:parsenoop},336:{n:"BrtEndEsmdtinfo",f:parsenoop},337:{n:"BrtBeginEsmdb",f:parsenoop},338:{n:"BrtEndEsmdb",f:parsenoop},339:{n:"BrtBeginEsfmd",f:parsenoop},340:{n:"BrtEndEsfmd",f:parsenoop},341:{n:"BrtBeginSingleCells",f:parsenoop},342:{n:"BrtEndSingleCells",f:parsenoop},343:{n:"BrtBeginList",f:parsenoop},344:{n:"BrtEndList",f:parsenoop},345:{n:"BrtBeginListCols",f:parsenoop},346:{n:"BrtEndListCols",f:parsenoop},347:{n:"BrtBeginListCol",f:parsenoop},348:{n:"BrtEndListCol",f:parsenoop},349:{n:"BrtBeginListXmlCPr",f:parsenoop},350:{n:"BrtEndListXmlCPr",f:parsenoop},351:{n:"BrtListCCFmla",f:parsenoop},352:{n:"BrtListTrFmla",f:parsenoop},353:{n:"BrtBeginExternals",f:parsenoop},354:{n:"BrtEndExternals",f:parsenoop},355:{n:"BrtSupBookSrc",f:parse_RelID},357:{n:"BrtSupSelf",f:parsenoop},358:{n:"BrtSupSame",f:parsenoop},359:{n:"BrtSupTabs",f:parsenoop},360:{n:"BrtBeginSupBook",f:parsenoop},361:{n:"BrtPlaceholderName",f:parsenoop},362:{n:"BrtExternSheet",f:parsenoop},363:{n:"BrtExternTableStart",f:parsenoop},364:{n:"BrtExternTableEnd",f:parsenoop},366:{n:"BrtExternRowHdr",f:parsenoop},367:{n:"BrtExternCellBlank",f:parsenoop},368:{n:"BrtExternCellReal",f:parsenoop},369:{n:"BrtExternCellBool",f:parsenoop},370:{n:"BrtExternCellError",f:parsenoop},371:{n:"BrtExternCellString",f:parsenoop},372:{n:"BrtBeginEsmdx",f:parsenoop},373:{n:"BrtEndEsmdx",f:parsenoop},374:{n:"BrtBeginMdxSet",f:parsenoop},375:{n:"BrtEndMdxSet",f:parsenoop},376:{n:"BrtBeginMdxMbrProp",f:parsenoop},377:{n:"BrtEndMdxMbrProp",f:parsenoop},378:{n:"BrtBeginMdxKPI",f:parsenoop},379:{n:"BrtEndMdxKPI",f:parsenoop},380:{n:"BrtBeginEsstr",f:parsenoop},381:{n:"BrtEndEsstr",f:parsenoop},382:{n:"BrtBeginPRFItem",f:parsenoop},383:{n:"BrtEndPRFItem",f:parsenoop},384:{n:"BrtBeginPivotCacheIDs",f:parsenoop},385:{n:"BrtEndPivotCacheIDs",f:parsenoop},386:{n:"BrtBeginPivotCacheID",f:parsenoop},387:{n:"BrtEndPivotCacheID",f:parsenoop},388:{n:"BrtBeginISXVIs",f:parsenoop},389:{n:"BrtEndISXVIs",f:parsenoop},390:{n:"BrtBeginColInfos",f:parsenoop},391:{n:"BrtEndColInfos",f:parsenoop},392:{n:"BrtBeginRwBrk",f:parsenoop},393:{n:"BrtEndRwBrk",f:parsenoop},394:{n:"BrtBeginColBrk",f:parsenoop},395:{n:"BrtEndColBrk",f:parsenoop},396:{n:"BrtBrk",f:parsenoop},397:{n:"BrtUserBookView",f:parsenoop},398:{n:"BrtInfo",f:parsenoop},399:{n:"BrtCUsr",f:parsenoop},400:{n:"BrtUsr",f:parsenoop},401:{n:"BrtBeginUsers",f:parsenoop},403:{n:"BrtEOF",f:parsenoop},404:{n:"BrtUCR",f:parsenoop},405:{n:"BrtRRInsDel",f:parsenoop},406:{n:"BrtRREndInsDel",f:parsenoop},407:{n:"BrtRRMove",f:parsenoop},408:{n:"BrtRREndMove",f:parsenoop},409:{n:"BrtRRChgCell",f:parsenoop},410:{n:"BrtRREndChgCell",f:parsenoop},411:{n:"BrtRRHeader",f:parsenoop},412:{n:"BrtRRUserView",f:parsenoop},413:{n:"BrtRRRenSheet",f:parsenoop},414:{n:"BrtRRInsertSh",f:parsenoop},415:{n:"BrtRRDefName",f:parsenoop},416:{n:"BrtRRNote",f:parsenoop},417:{n:"BrtRRConflict",f:parsenoop},418:{n:"BrtRRTQSIF",f:parsenoop},419:{n:"BrtRRFormat",f:parsenoop},420:{n:"BrtRREndFormat",f:parsenoop},421:{n:"BrtRRAutoFmt",f:parsenoop},422:{n:"BrtBeginUserShViews",f:parsenoop},423:{n:"BrtBeginUserShView",f:parsenoop},424:{n:"BrtEndUserShView",f:parsenoop},425:{n:"BrtEndUserShViews",f:parsenoop},426:{n:"BrtArrFmla",f:parse_BrtArrFmla},427:{n:"BrtShrFmla",f:parse_BrtShrFmla},428:{n:"BrtTable",f:parsenoop},429:{n:"BrtBeginExtConnections",f:parsenoop},430:{n:"BrtEndExtConnections",f:parsenoop},431:{n:"BrtBeginPCDCalcMems",f:parsenoop},432:{n:"BrtEndPCDCalcMems",f:parsenoop},433:{n:"BrtBeginPCDCalcMem",f:parsenoop},434:{n:"BrtEndPCDCalcMem",f:parsenoop},435:{n:"BrtBeginPCDHGLevels",f:parsenoop},436:{n:"BrtEndPCDHGLevels",f:parsenoop},437:{n:"BrtBeginPCDHGLevel",f:parsenoop},438:{n:"BrtEndPCDHGLevel",f:parsenoop},439:{n:"BrtBeginPCDHGLGroups",f:parsenoop},440:{n:"BrtEndPCDHGLGroups",f:parsenoop},441:{n:"BrtBeginPCDHGLGroup",f:parsenoop},442:{n:"BrtEndPCDHGLGroup",f:parsenoop},443:{n:"BrtBeginPCDHGLGMembers",f:parsenoop},444:{n:"BrtEndPCDHGLGMembers",f:parsenoop},445:{n:"BrtBeginPCDHGLGMember",f:parsenoop},446:{n:"BrtEndPCDHGLGMember",f:parsenoop},447:{n:"BrtBeginQSI",f:parsenoop},448:{n:"BrtEndQSI",f:parsenoop},449:{n:"BrtBeginQSIR",f:parsenoop},450:{n:"BrtEndQSIR",f:parsenoop},451:{n:"BrtBeginDeletedNames",f:parsenoop},452:{n:"BrtEndDeletedNames",f:parsenoop},453:{n:"BrtBeginDeletedName",f:parsenoop},454:{n:"BrtEndDeletedName",f:parsenoop},455:{n:"BrtBeginQSIFs",f:parsenoop},456:{n:"BrtEndQSIFs",f:parsenoop},457:{n:"BrtBeginQSIF",f:parsenoop},458:{n:"BrtEndQSIF",f:parsenoop},459:{n:"BrtBeginAutoSortScope",f:parsenoop},460:{n:"BrtEndAutoSortScope",f:parsenoop},461:{n:"BrtBeginConditionalFormatting",f:parsenoop},462:{n:"BrtEndConditionalFormatting",f:parsenoop},463:{n:"BrtBeginCFRule",f:parsenoop},464:{n:"BrtEndCFRule",f:parsenoop},465:{n:"BrtBeginIconSet",f:parsenoop},466:{n:"BrtEndIconSet",f:parsenoop},467:{n:"BrtBeginDatabar",f:parsenoop},468:{n:"BrtEndDatabar",f:parsenoop},469:{n:"BrtBeginColorScale",f:parsenoop},470:{n:"BrtEndColorScale",f:parsenoop},471:{n:"BrtCFVO",f:parsenoop},472:{n:"BrtExternValueMeta",f:parsenoop},473:{n:"BrtBeginColorPalette",f:parsenoop},474:{n:"BrtEndColorPalette",f:parsenoop},475:{n:"BrtIndexedColor",f:parsenoop},476:{n:"BrtMargins",f:parse_BrtMargins},477:{n:"BrtPrintOptions",f:parsenoop},478:{n:"BrtPageSetup",f:parsenoop},479:{n:"BrtBeginHeaderFooter",f:parsenoop},480:{n:"BrtEndHeaderFooter",f:parsenoop},481:{n:"BrtBeginSXCrtFormat",f:parsenoop},482:{n:"BrtEndSXCrtFormat",f:parsenoop},483:{n:"BrtBeginSXCrtFormats",f:parsenoop},484:{n:"BrtEndSXCrtFormats",f:parsenoop},485:{n:"BrtWsFmtInfo",f:parsenoop},486:{n:"BrtBeginMgs",f:parsenoop},487:{n:"BrtEndMGs",f:parsenoop},488:{n:"BrtBeginMGMaps",f:parsenoop},489:{n:"BrtEndMGMaps",f:parsenoop},490:{n:"BrtBeginMG",f:parsenoop},491:{n:"BrtEndMG",f:parsenoop},492:{n:"BrtBeginMap",f:parsenoop},493:{n:"BrtEndMap",f:parsenoop},494:{n:"BrtHLink",f:parse_BrtHLink},495:{n:"BrtBeginDCon",f:parsenoop},496:{n:"BrtEndDCon",f:parsenoop},497:{n:"BrtBeginDRefs",f:parsenoop},498:{n:"BrtEndDRefs",f:parsenoop},499:{n:"BrtDRef",f:parsenoop},500:{n:"BrtBeginScenMan",f:parsenoop},501:{n:"BrtEndScenMan",f:parsenoop},502:{n:"BrtBeginSct",f:parsenoop},503:{n:"BrtEndSct",f:parsenoop},504:{n:"BrtSlc",f:parsenoop},505:{n:"BrtBeginDXFs",f:parsenoop},506:{n:"BrtEndDXFs",f:parsenoop},507:{n:"BrtDXF",f:parsenoop},508:{n:"BrtBeginTableStyles",f:parsenoop},509:{n:"BrtEndTableStyles",f:parsenoop},510:{n:"BrtBeginTableStyle",f:parsenoop},511:{n:"BrtEndTableStyle",f:parsenoop},512:{n:"BrtTableStyleElement",f:parsenoop},513:{n:"BrtTableStyleClient",f:parsenoop},514:{n:"BrtBeginVolDeps",f:parsenoop},515:{n:"BrtEndVolDeps",f:parsenoop},516:{n:"BrtBeginVolType",f:parsenoop},517:{n:"BrtEndVolType",f:parsenoop},518:{n:"BrtBeginVolMain",f:parsenoop},519:{n:"BrtEndVolMain",f:parsenoop},520:{n:"BrtBeginVolTopic",f:parsenoop},521:{n:"BrtEndVolTopic",f:parsenoop},522:{n:"BrtVolSubtopic",f:parsenoop},523:{n:"BrtVolRef",f:parsenoop},524:{n:"BrtVolNum",f:parsenoop},525:{n:"BrtVolErr",f:parsenoop},526:{n:"BrtVolStr",f:parsenoop},527:{n:"BrtVolBool",f:parsenoop},528:{n:"BrtBeginCalcChain$",f:parsenoop},529:{n:"BrtEndCalcChain$",f:parsenoop},530:{n:"BrtBeginSortState",f:parsenoop},531:{n:"BrtEndSortState",f:parsenoop},532:{n:"BrtBeginSortCond",f:parsenoop},533:{n:"BrtEndSortCond",f:parsenoop},534:{n:"BrtBookProtection",f:parsenoop},535:{n:"BrtSheetProtection",f:parsenoop},536:{n:"BrtRangeProtection",f:parsenoop},537:{n:"BrtPhoneticInfo",f:parsenoop},538:{n:"BrtBeginECTxtWiz",f:parsenoop},539:{n:"BrtEndECTxtWiz",f:parsenoop},540:{n:"BrtBeginECTWFldInfoLst",f:parsenoop},541:{n:"BrtEndECTWFldInfoLst",f:parsenoop},542:{n:"BrtBeginECTwFldInfo",f:parsenoop},548:{n:"BrtFileSharing",f:parsenoop},549:{n:"BrtOleSize",f:parsenoop},550:{n:"BrtDrawing",f:parse_RelID},551:{n:"BrtLegacyDrawing",f:parsenoop},552:{n:"BrtLegacyDrawingHF",f:parsenoop},553:{n:"BrtWebOpt",f:parsenoop},554:{n:"BrtBeginWebPubItems",f:parsenoop},555:{n:"BrtEndWebPubItems",f:parsenoop},556:{n:"BrtBeginWebPubItem",f:parsenoop},557:{n:"BrtEndWebPubItem",f:parsenoop},558:{n:"BrtBeginSXCondFmt",f:parsenoop},559:{n:"BrtEndSXCondFmt",f:parsenoop},560:{n:"BrtBeginSXCondFmts",f:parsenoop},561:{n:"BrtEndSXCondFmts",f:parsenoop},562:{n:"BrtBkHim",f:parsenoop},564:{n:"BrtColor",f:parsenoop},565:{n:"BrtBeginIndexedColors",f:parsenoop},566:{n:"BrtEndIndexedColors",f:parsenoop},569:{n:"BrtBeginMRUColors",f:parsenoop},570:{n:"BrtEndMRUColors",f:parsenoop},572:{n:"BrtMRUColor",f:parsenoop},573:{n:"BrtBeginDVals",f:parsenoop},574:{n:"BrtEndDVals",f:parsenoop},577:{n:"BrtSupNameStart",f:parsenoop},578:{n:"BrtSupNameValueStart",f:parsenoop},579:{n:"BrtSupNameValueEnd",f:parsenoop},580:{n:"BrtSupNameNum",f:parsenoop},581:{n:"BrtSupNameErr",f:parsenoop},582:{n:"BrtSupNameSt",f:parsenoop},583:{n:"BrtSupNameNil",f:parsenoop},584:{n:"BrtSupNameBool",f:parsenoop},585:{n:"BrtSupNameFmla",f:parsenoop},586:{n:"BrtSupNameBits",f:parsenoop},587:{n:"BrtSupNameEnd",f:parsenoop},588:{n:"BrtEndSupBook",f:parsenoop},589:{n:"BrtCellSmartTagProperty",f:parsenoop},590:{n:"BrtBeginCellSmartTag",f:parsenoop},591:{n:"BrtEndCellSmartTag",f:parsenoop},592:{n:"BrtBeginCellSmartTags",f:parsenoop},593:{n:"BrtEndCellSmartTags",f:parsenoop},594:{n:"BrtBeginSmartTags",f:parsenoop},595:{n:"BrtEndSmartTags",f:parsenoop},596:{n:"BrtSmartTagType",f:parsenoop},597:{n:"BrtBeginSmartTagTypes",f:parsenoop},598:{n:"BrtEndSmartTagTypes",f:parsenoop},599:{n:"BrtBeginSXFilters",f:parsenoop},600:{n:"BrtEndSXFilters",f:parsenoop},601:{n:"BrtBeginSXFILTER",f:parsenoop},602:{n:"BrtEndSXFilter",f:parsenoop},603:{n:"BrtBeginFills",f:parsenoop},604:{n:"BrtEndFills",f:parsenoop},605:{n:"BrtBeginCellWatches",f:parsenoop},606:{n:"BrtEndCellWatches",f:parsenoop},607:{n:"BrtCellWatch",f:parsenoop},608:{n:"BrtBeginCRErrs",f:parsenoop},609:{n:"BrtEndCRErrs",f:parsenoop},610:{n:"BrtCrashRecErr",f:parsenoop},611:{n:"BrtBeginFonts",f:parsenoop},612:{n:"BrtEndFonts",f:parsenoop},613:{n:"BrtBeginBorders",f:parsenoop},614:{n:"BrtEndBorders",f:parsenoop},615:{n:"BrtBeginFmts",f:parsenoop},616:{n:"BrtEndFmts",f:parsenoop},617:{n:"BrtBeginCellXFs",f:parsenoop},618:{n:"BrtEndCellXFs",f:parsenoop},619:{n:"BrtBeginStyles",f:parsenoop},620:{n:"BrtEndStyles",f:parsenoop},625:{n:"BrtBigName",f:parsenoop},626:{n:"BrtBeginCellStyleXFs",f:parsenoop},627:{n:"BrtEndCellStyleXFs",f:parsenoop},628:{n:"BrtBeginComments",f:parsenoop},629:{n:"BrtEndComments",f:parsenoop},630:{n:"BrtBeginCommentAuthors",f:parsenoop},631:{n:"BrtEndCommentAuthors",f:parsenoop},632:{n:"BrtCommentAuthor",f:parse_BrtCommentAuthor},633:{n:"BrtBeginCommentList",f:parsenoop},634:{n:"BrtEndCommentList",f:parsenoop},635:{n:"BrtBeginComment",f:parse_BrtBeginComment},636:{n:"BrtEndComment",f:parsenoop},637:{n:"BrtCommentText",f:parse_BrtCommentText},638:{n:"BrtBeginOleObjects",f:parsenoop},639:{n:"BrtOleObject",f:parsenoop},640:{n:"BrtEndOleObjects",f:parsenoop},641:{n:"BrtBeginSxrules",f:parsenoop},642:{n:"BrtEndSxRules",f:parsenoop},643:{n:"BrtBeginActiveXControls",f:parsenoop},644:{n:"BrtActiveX",f:parsenoop},645:{n:"BrtEndActiveXControls",f:parsenoop},646:{n:"BrtBeginPCDSDTCEMembersSortBy",f:parsenoop},648:{n:"BrtBeginCellIgnoreECs",f:parsenoop},649:{n:"BrtCellIgnoreEC",f:parsenoop},650:{n:"BrtEndCellIgnoreECs",f:parsenoop},651:{n:"BrtCsProp",f:parsenoop},652:{n:"BrtCsPageSetup",f:parsenoop},653:{n:"BrtBeginUserCsViews",f:parsenoop},654:{n:"BrtEndUserCsViews",f:parsenoop},655:{n:"BrtBeginUserCsView",f:parsenoop},656:{n:"BrtEndUserCsView",f:parsenoop},657:{n:"BrtBeginPcdSFCIEntries",f:parsenoop},658:{n:"BrtEndPCDSFCIEntries",f:parsenoop},659:{n:"BrtPCDSFCIEntry",f:parsenoop},660:{n:"BrtBeginListParts",f:parsenoop},661:{n:"BrtListPart",f:parsenoop},662:{n:"BrtEndListParts",f:parsenoop},663:{n:"BrtSheetCalcProp",f:parsenoop},664:{n:"BrtBeginFnGroup",f:parsenoop},665:{n:"BrtFnGroup",f:parsenoop},666:{n:"BrtEndFnGroup",f:parsenoop},667:{n:"BrtSupAddin",f:parsenoop},668:{n:"BrtSXTDMPOrder",f:parsenoop},669:{n:"BrtCsProtection",f:parsenoop},671:{n:"BrtBeginWsSortMap",f:parsenoop},672:{n:"BrtEndWsSortMap",f:parsenoop},673:{n:"BrtBeginRRSort",f:parsenoop},674:{n:"BrtEndRRSort",f:parsenoop},675:{n:"BrtRRSortItem",f:parsenoop},676:{n:"BrtFileSharingIso",f:parsenoop},677:{n:"BrtBookProtectionIso",f:parsenoop},678:{n:"BrtSheetProtectionIso",f:parsenoop},679:{n:"BrtCsProtectionIso",f:parsenoop},680:{n:"BrtRangeProtectionIso",f:parsenoop},1024:{n:"BrtRwDescent",f:parsenoop},1025:{n:"BrtKnownFonts",f:parsenoop},1026:{n:"BrtBeginSXTupleSet",f:parsenoop},1027:{n:"BrtEndSXTupleSet",f:parsenoop},1028:{n:"BrtBeginSXTupleSetHeader",f:parsenoop},1029:{n:"BrtEndSXTupleSetHeader",f:parsenoop},1030:{n:"BrtSXTupleSetHeaderItem",f:parsenoop},1031:{n:"BrtBeginSXTupleSetData",f:parsenoop},1032:{n:"BrtEndSXTupleSetData",f:parsenoop},1033:{n:"BrtBeginSXTupleSetRow",f:parsenoop},1034:{n:"BrtEndSXTupleSetRow",f:parsenoop},1035:{n:"BrtSXTupleSetRowItem",f:parsenoop},1036:{n:"BrtNameExt",f:parsenoop},1037:{n:"BrtPCDH14",f:parsenoop},1038:{n:"BrtBeginPCDCalcMem14",f:parsenoop},1039:{n:"BrtEndPCDCalcMem14",f:parsenoop},1040:{n:"BrtSXTH14",f:parsenoop},1041:{n:"BrtBeginSparklineGroup",f:parsenoop},1042:{n:"BrtEndSparklineGroup",f:parsenoop},1043:{n:"BrtSparkline",f:parsenoop},1044:{n:"BrtSXDI14",f:parsenoop},1045:{n:"BrtWsFmtInfoEx14",f:parsenoop},1046:{n:"BrtBeginConditionalFormatting14",f:parsenoop},1047:{n:"BrtEndConditionalFormatting14",f:parsenoop},1048:{n:"BrtBeginCFRule14",f:parsenoop},1049:{n:"BrtEndCFRule14",f:parsenoop},1050:{n:"BrtCFVO14",f:parsenoop},1051:{n:"BrtBeginDatabar14",f:parsenoop},1052:{n:"BrtBeginIconSet14",f:parsenoop},1053:{n:"BrtDVal14",f:parsenoop},1054:{n:"BrtBeginDVals14",f:parsenoop},1055:{n:"BrtColor14",f:parsenoop},1056:{n:"BrtBeginSparklines",f:parsenoop},1057:{n:"BrtEndSparklines",f:parsenoop},1058:{n:"BrtBeginSparklineGroups",f:parsenoop},1059:{n:"BrtEndSparklineGroups",f:parsenoop},1061:{n:"BrtSXVD14",f:parsenoop},1062:{n:"BrtBeginSxview14",f:parsenoop},1063:{n:"BrtEndSxview14",f:parsenoop},1066:{n:"BrtBeginPCD14",f:parsenoop},1067:{n:"BrtEndPCD14",f:parsenoop},1068:{n:"BrtBeginExtConn14",f:parsenoop},1069:{n:"BrtEndExtConn14",f:parsenoop},1070:{n:"BrtBeginSlicerCacheIDs",f:parsenoop},1071:{n:"BrtEndSlicerCacheIDs",f:parsenoop},1072:{n:"BrtBeginSlicerCacheID",f:parsenoop},1073:{n:"BrtEndSlicerCacheID",f:parsenoop},1075:{n:"BrtBeginSlicerCache",f:parsenoop},1076:{n:"BrtEndSlicerCache",f:parsenoop},1077:{n:"BrtBeginSlicerCacheDef",f:parsenoop},1078:{n:"BrtEndSlicerCacheDef",f:parsenoop},1079:{n:"BrtBeginSlicersEx",f:parsenoop},1080:{n:"BrtEndSlicersEx",f:parsenoop},1081:{n:"BrtBeginSlicerEx",f:parsenoop},1082:{n:"BrtEndSlicerEx",f:parsenoop},1083:{n:"BrtBeginSlicer",f:parsenoop},1084:{n:"BrtEndSlicer",f:parsenoop},1085:{n:"BrtSlicerCachePivotTables",f:parsenoop},1086:{n:"BrtBeginSlicerCacheOlapImpl",f:parsenoop},1087:{n:"BrtEndSlicerCacheOlapImpl",f:parsenoop},1088:{n:"BrtBeginSlicerCacheLevelsData",f:parsenoop},1089:{n:"BrtEndSlicerCacheLevelsData",f:parsenoop},1090:{n:"BrtBeginSlicerCacheLevelData",f:parsenoop},1091:{n:"BrtEndSlicerCacheLevelData",f:parsenoop},1092:{n:"BrtBeginSlicerCacheSiRanges",f:parsenoop},1093:{n:"BrtEndSlicerCacheSiRanges",f:parsenoop},1094:{n:"BrtBeginSlicerCacheSiRange",f:parsenoop},1095:{n:"BrtEndSlicerCacheSiRange",f:parsenoop},1096:{n:"BrtSlicerCacheOlapItem",f:parsenoop},1097:{n:"BrtBeginSlicerCacheSelections",f:parsenoop},1098:{n:"BrtSlicerCacheSelection",f:parsenoop},1099:{n:"BrtEndSlicerCacheSelections",f:parsenoop},1100:{n:"BrtBeginSlicerCacheNative",f:parsenoop},1101:{n:"BrtEndSlicerCacheNative",f:parsenoop},1102:{n:"BrtSlicerCacheNativeItem",f:parsenoop},1103:{n:"BrtRangeProtection14",f:parsenoop},1104:{n:"BrtRangeProtectionIso14",f:parsenoop},1105:{n:"BrtCellIgnoreEC14",f:parsenoop},1111:{n:"BrtList14",f:parsenoop},1112:{n:"BrtCFIcon",f:parsenoop},1113:{n:"BrtBeginSlicerCachesPivotCacheIDs",f:parsenoop},1114:{n:"BrtEndSlicerCachesPivotCacheIDs",f:parsenoop},1115:{n:"BrtBeginSlicers",f:parsenoop},1116:{n:"BrtEndSlicers",f:parsenoop},1117:{n:"BrtWbProp14",f:parsenoop},1118:{n:"BrtBeginSXEdit",f:parsenoop},1119:{n:"BrtEndSXEdit",f:parsenoop},1120:{n:"BrtBeginSXEdits",f:parsenoop},1121:{n:"BrtEndSXEdits",f:parsenoop},1122:{n:"BrtBeginSXChange",f:parsenoop},1123:{n:"BrtEndSXChange",f:parsenoop},1124:{n:"BrtBeginSXChanges",f:parsenoop},1125:{n:"BrtEndSXChanges",f:parsenoop},1126:{n:"BrtSXTupleItems",f:parsenoop},1128:{n:"BrtBeginSlicerStyle",f:parsenoop},1129:{n:"BrtEndSlicerStyle",f:parsenoop},1130:{n:"BrtSlicerStyleElement",f:parsenoop},1131:{n:"BrtBeginStyleSheetExt14",f:parsenoop},1132:{n:"BrtEndStyleSheetExt14",f:parsenoop},1133:{n:"BrtBeginSlicerCachesPivotCacheID",f:parsenoop},1134:{n:"BrtEndSlicerCachesPivotCacheID",f:parsenoop},1135:{n:"BrtBeginConditionalFormattings",f:parsenoop},1136:{n:"BrtEndConditionalFormattings",f:parsenoop},1137:{n:"BrtBeginPCDCalcMemExt",f:parsenoop},1138:{n:"BrtEndPCDCalcMemExt",f:parsenoop},1139:{n:"BrtBeginPCDCalcMemsExt",f:parsenoop},1140:{n:"BrtEndPCDCalcMemsExt",f:parsenoop},1141:{n:"BrtPCDField14",f:parsenoop},1142:{n:"BrtBeginSlicerStyles",f:parsenoop},1143:{n:"BrtEndSlicerStyles",f:parsenoop},1144:{n:"BrtBeginSlicerStyleElements",f:parsenoop},1145:{n:"BrtEndSlicerStyleElements",f:parsenoop},1146:{n:"BrtCFRuleExt",f:parsenoop},1147:{n:"BrtBeginSXCondFmt14",f:parsenoop},1148:{n:"BrtEndSXCondFmt14",f:parsenoop},1149:{n:"BrtBeginSXCondFmts14",f:parsenoop},1150:{n:"BrtEndSXCondFmts14",f:parsenoop},1152:{n:"BrtBeginSortCond14",f:parsenoop},1153:{n:"BrtEndSortCond14",f:parsenoop},1154:{n:"BrtEndDVals14",f:parsenoop},1155:{n:"BrtEndIconSet14",f:parsenoop},1156:{n:"BrtEndDatabar14",f:parsenoop},1157:{n:"BrtBeginColorScale14",f:parsenoop},1158:{n:"BrtEndColorScale14",f:parsenoop},1159:{n:"BrtBeginSxrules14",f:parsenoop},1160:{n:"BrtEndSxrules14",f:parsenoop},1161:{n:"BrtBeginPRule14",f:parsenoop},1162:{n:"BrtEndPRule14",f:parsenoop},1163:{n:"BrtBeginPRFilters14",f:parsenoop},1164:{n:"BrtEndPRFilters14",f:parsenoop},1165:{n:"BrtBeginPRFilter14",f:parsenoop},1166:{n:"BrtEndPRFilter14",f:parsenoop},1167:{n:"BrtBeginPRFItem14",f:parsenoop},1168:{n:"BrtEndPRFItem14",f:parsenoop},1169:{n:"BrtBeginCellIgnoreECs14",f:parsenoop},1170:{n:"BrtEndCellIgnoreECs14",f:parsenoop},1171:{n:"BrtDxf14",f:parsenoop},1172:{n:"BrtBeginDxF14s",f:parsenoop},1173:{n:"BrtEndDxf14s",f:parsenoop},1177:{n:"BrtFilter14",f:parsenoop},1178:{n:"BrtBeginCustomFilters14",f:parsenoop},1180:{n:"BrtCustomFilter14",f:parsenoop},1181:{n:"BrtIconFilter14",f:parsenoop},1182:{n:"BrtPivotCacheConnectionName",f:parsenoop},2048:{n:"BrtBeginDecoupledPivotCacheIDs",f:parsenoop},2049:{n:"BrtEndDecoupledPivotCacheIDs",f:parsenoop},2050:{n:"BrtDecoupledPivotCacheID",f:parsenoop},2051:{n:"BrtBeginPivotTableRefs",f:parsenoop},2052:{n:"BrtEndPivotTableRefs",f:parsenoop},2053:{n:"BrtPivotTableRef",f:parsenoop},2054:{n:"BrtSlicerCacheBookPivotTables",f:parsenoop},2055:{n:"BrtBeginSxvcells",f:parsenoop},2056:{n:"BrtEndSxvcells",f:parsenoop},2057:{n:"BrtBeginSxRow",f:parsenoop},2058:{n:"BrtEndSxRow",f:parsenoop},2060:{n:"BrtPcdCalcMem15",f:parsenoop},2067:{n:"BrtQsi15",f:parsenoop},2068:{n:"BrtBeginWebExtensions",f:parsenoop},2069:{n:"BrtEndWebExtensions",f:parsenoop},2070:{n:"BrtWebExtension",f:parsenoop},2071:{n:"BrtAbsPath15",f:parsenoop},2072:{n:"BrtBeginPivotTableUISettings",f:parsenoop},2073:{n:"BrtEndPivotTableUISettings",f:parsenoop},2075:{n:"BrtTableSlicerCacheIDs",f:parsenoop},2076:{n:"BrtTableSlicerCacheID",f:parsenoop},2077:{n:"BrtBeginTableSlicerCache",f:parsenoop},2078:{n:"BrtEndTableSlicerCache",f:parsenoop},2079:{n:"BrtSxFilter15",f:parsenoop},2080:{n:"BrtBeginTimelineCachePivotCacheIDs",f:parsenoop},2081:{n:"BrtEndTimelineCachePivotCacheIDs",f:parsenoop},2082:{n:"BrtTimelineCachePivotCacheID",f:parsenoop},2083:{n:"BrtBeginTimelineCacheIDs",f:parsenoop},2084:{n:"BrtEndTimelineCacheIDs",f:parsenoop},2085:{n:"BrtBeginTimelineCacheID",f:parsenoop},2086:{n:"BrtEndTimelineCacheID",f:parsenoop},2087:{n:"BrtBeginTimelinesEx",f:parsenoop},2088:{n:"BrtEndTimelinesEx",f:parsenoop},2089:{n:"BrtBeginTimelineEx",f:parsenoop},2090:{n:"BrtEndTimelineEx",f:parsenoop},2091:{n:"BrtWorkBookPr15",f:parsenoop},2092:{n:"BrtPCDH15",f:parsenoop},2093:{n:"BrtBeginTimelineStyle",f:parsenoop},2094:{n:"BrtEndTimelineStyle",f:parsenoop},2095:{n:"BrtTimelineStyleElement",f:parsenoop},2096:{n:"BrtBeginTimelineStylesheetExt15",f:parsenoop},2097:{n:"BrtEndTimelineStylesheetExt15",f:parsenoop},2098:{n:"BrtBeginTimelineStyles",f:parsenoop},2099:{n:"BrtEndTimelineStyles",f:parsenoop},2100:{n:"BrtBeginTimelineStyleElements",f:parsenoop},2101:{n:"BrtEndTimelineStyleElements",f:parsenoop},2102:{n:"BrtDxf15",f:parsenoop},2103:{n:"BrtBeginDxfs15",f:parsenoop},2104:{n:"brtEndDxfs15",f:parsenoop},2105:{n:"BrtSlicerCacheHideItemsWithNoData",f:parsenoop},2106:{n:"BrtBeginItemUniqueNames",f:parsenoop},2107:{n:"BrtEndItemUniqueNames",f:parsenoop},2108:{n:"BrtItemUniqueName",f:parsenoop},2109:{n:"BrtBeginExtConn15",f:parsenoop},2110:{n:"BrtEndExtConn15",f:parsenoop},2111:{n:"BrtBeginOledbPr15",f:parsenoop},2112:{n:"BrtEndOledbPr15",f:parsenoop},2113:{n:"BrtBeginDataFeedPr15",f:parsenoop},2114:{n:"BrtEndDataFeedPr15",f:parsenoop},2115:{n:"BrtTextPr15",f:parsenoop},2116:{n:"BrtRangePr15",f:parsenoop},2117:{n:"BrtDbCommand15",f:parsenoop},2118:{n:"BrtBeginDbTables15",f:parsenoop},2119:{n:"BrtEndDbTables15",f:parsenoop},2120:{n:"BrtDbTable15",f:parsenoop},2121:{n:"BrtBeginDataModel",f:parsenoop},2122:{n:"BrtEndDataModel",f:parsenoop},2123:{n:"BrtBeginModelTables",f:parsenoop},2124:{n:"BrtEndModelTables",f:parsenoop},2125:{n:"BrtModelTable",f:parsenoop},2126:{n:"BrtBeginModelRelationships",f:parsenoop},2127:{n:"BrtEndModelRelationships",f:parsenoop},2128:{n:"BrtModelRelationship",f:parsenoop},2129:{n:"BrtBeginECTxtWiz15",f:parsenoop},2130:{n:"BrtEndECTxtWiz15",f:parsenoop},2131:{n:"BrtBeginECTWFldInfoLst15",f:parsenoop},2132:{n:"BrtEndECTWFldInfoLst15",f:parsenoop},2133:{n:"BrtBeginECTWFldInfo15",f:parsenoop},2134:{n:"BrtFieldListActiveItem",f:parsenoop},2135:{n:"BrtPivotCacheIdVersion",f:parsenoop},2136:{n:"BrtSXDI15",f:parsenoop},65535:{n:"",f:parsenoop}};var evert_RE=evert_key(XLSBRecordEnum,"n");var XLSRecordEnum={3:{n:"BIFF2NUM",f:parse_BIFF2NUM},4:{n:"BIFF2STR",f:parse_BIFF2STR},6:{n:"Formula",f:parse_Formula},9:{n:"BOF",f:parse_BOF},10:{n:"EOF",f:parse_EOF},12:{n:"CalcCount",f:parse_CalcCount},13:{n:"CalcMode",f:parse_CalcMode},14:{n:"CalcPrecision",f:parse_CalcPrecision},15:{n:"CalcRefMode",f:parse_CalcRefMode},16:{n:"CalcDelta",f:parse_CalcDelta},17:{n:"CalcIter",f:parse_CalcIter},18:{n:"Protect",f:parse_Protect},19:{n:"Password",f:parse_Password},20:{n:"Header",f:parse_Header},21:{n:"Footer",f:parse_Footer},23:{n:"ExternSheet",f:parse_ExternSheet},24:{n:"Lbl",f:parse_Lbl},25:{n:"WinProtect",f:parse_WinProtect},26:{n:"VerticalPageBreaks",f:parse_VerticalPageBreaks},27:{n:"HorizontalPageBreaks",f:parse_HorizontalPageBreaks},28:{n:"Note",f:parse_Note},29:{n:"Selection",f:parse_Selection},34:{n:"Date1904",f:parse_Date1904},35:{n:"ExternName",f:parse_ExternName},38:{n:"LeftMargin",f:parse_LeftMargin},39:{n:"RightMargin",f:parse_RightMargin},40:{n:"TopMargin",f:parse_TopMargin},41:{n:"BottomMargin",f:parse_BottomMargin},42:{n:"PrintRowCol",f:parse_PrintRowCol},43:{n:"PrintGrid",f:parse_PrintGrid},47:{n:"FilePass",f:parse_FilePass},49:{n:"Font",f:parse_Font},51:{n:"PrintSize",f:parse_PrintSize},60:{n:"Continue",f:parse_Continue},61:{n:"Window1",f:parse_Window1},64:{n:"Backup",f:parse_Backup},65:{n:"Pane",f:parse_Pane},66:{n:"CodePage",f:parse_CodePage},77:{n:"Pls",f:parse_Pls},80:{n:"DCon",f:parse_DCon},81:{n:"DConRef",f:parse_DConRef},82:{n:"DConName",f:parse_DConName},85:{n:"DefColWidth",f:parse_DefColWidth},89:{n:"XCT",f:parse_XCT},90:{n:"CRN",f:parse_CRN},91:{n:"FileSharing",f:parse_FileSharing},92:{n:"WriteAccess",f:parse_WriteAccess},93:{n:"Obj",f:parse_Obj},94:{n:"Uncalced",f:parse_Uncalced},95:{n:"CalcSaveRecalc",f:parse_CalcSaveRecalc},96:{n:"Template",f:parse_Template},97:{n:"Intl",f:parse_Intl},99:{n:"ObjProtect",f:parse_ObjProtect},125:{n:"ColInfo",f:parse_ColInfo},128:{n:"Guts",f:parse_Guts},129:{n:"WsBool",f:parse_WsBool},130:{n:"GridSet",f:parse_GridSet},131:{n:"HCenter",f:parse_HCenter},132:{n:"VCenter",f:parse_VCenter},133:{n:"BoundSheet8",f:parse_BoundSheet8},134:{n:"WriteProtect",f:parse_WriteProtect},140:{n:"Country",f:parse_Country},141:{n:"HideObj",f:parse_HideObj},144:{n:"Sort",f:parse_Sort},146:{n:"Palette",f:parse_Palette},151:{n:"Sync",f:parse_Sync},152:{n:"LPr",f:parse_LPr},153:{n:"DxGCol",f:parse_DxGCol},154:{n:"FnGroupName",f:parse_FnGroupName},155:{n:"FilterMode",f:parse_FilterMode},156:{n:"BuiltInFnGroupCount",f:parse_BuiltInFnGroupCount},157:{n:"AutoFilterInfo",f:parse_AutoFilterInfo},158:{n:"AutoFilter",f:parse_AutoFilter},160:{n:"Scl",f:parse_Scl},161:{n:"Setup",f:parse_Setup},174:{n:"ScenMan",f:parse_ScenMan},175:{n:"SCENARIO",f:parse_SCENARIO},176:{n:"SxView",f:parse_SxView},177:{n:"Sxvd",f:parse_Sxvd},178:{n:"SXVI",f:parse_SXVI},180:{n:"SxIvd",f:parse_SxIvd},181:{n:"SXLI",f:parse_SXLI},182:{n:"SXPI",f:parse_SXPI},184:{n:"DocRoute",f:parse_DocRoute},185:{n:"RecipName",f:parse_RecipName},189:{n:"MulRk",f:parse_MulRk},190:{n:"MulBlank",f:parse_MulBlank},193:{n:"Mms",f:parse_Mms},197:{n:"SXDI",f:parse_SXDI},198:{n:"SXDB",f:parse_SXDB},199:{n:"SXFDB",f:parse_SXFDB},200:{n:"SXDBB",f:parse_SXDBB},201:{n:"SXNum",f:parse_SXNum},202:{n:"SxBool",f:parse_SxBool},203:{n:"SxErr",f:parse_SxErr},204:{n:"SXInt",f:parse_SXInt},205:{n:"SXString",f:parse_SXString},206:{n:"SXDtr",f:parse_SXDtr},207:{n:"SxNil",f:parse_SxNil},208:{n:"SXTbl",f:parse_SXTbl},209:{n:"SXTBRGIITM",f:parse_SXTBRGIITM},210:{n:"SxTbpg",f:parse_SxTbpg},211:{n:"ObProj",f:parse_ObProj},213:{n:"SXStreamID",f:parse_SXStreamID},215:{n:"DBCell",f:parse_DBCell},216:{n:"SXRng",f:parse_SXRng},217:{n:"SxIsxoper",f:parse_SxIsxoper},218:{n:"BookBool",f:parse_BookBool},220:{n:"DbOrParamQry",f:parse_DbOrParamQry},221:{n:"ScenarioProtect",f:parse_ScenarioProtect},222:{n:"OleObjectSize",f:parse_OleObjectSize},224:{n:"XF",f:parse_XF},225:{n:"InterfaceHdr",f:parse_InterfaceHdr},226:{n:"InterfaceEnd",f:parse_InterfaceEnd},227:{n:"SXVS",f:parse_SXVS},229:{n:"MergeCells",f:parse_MergeCells},233:{n:"BkHim",f:parse_BkHim},235:{n:"MsoDrawingGroup",f:parse_MsoDrawingGroup},236:{n:"MsoDrawing",f:parse_MsoDrawing},237:{n:"MsoDrawingSelection",f:parse_MsoDrawingSelection},239:{n:"PhoneticInfo",f:parse_PhoneticInfo},240:{n:"SxRule",f:parse_SxRule},241:{n:"SXEx",f:parse_SXEx},242:{n:"SxFilt",f:parse_SxFilt},244:{n:"SxDXF",f:parse_SxDXF},245:{n:"SxItm",f:parse_SxItm},246:{n:"SxName",f:parse_SxName},247:{n:"SxSelect",f:parse_SxSelect},248:{n:"SXPair",f:parse_SXPair},249:{n:"SxFmla",f:parse_SxFmla},251:{n:"SxFormat",f:parse_SxFormat},252:{n:"SST",f:parse_SST},253:{n:"LabelSst",f:parse_LabelSst},255:{n:"ExtSST",f:parse_ExtSST},256:{n:"SXVDEx",f:parse_SXVDEx},259:{n:"SXFormula",f:parse_SXFormula},290:{n:"SXDBEx",f:parse_SXDBEx},311:{n:"RRDInsDel",f:parse_RRDInsDel},312:{n:"RRDHead",f:parse_RRDHead},315:{n:"RRDChgCell",f:parse_RRDChgCell},317:{n:"RRTabId",f:parse_RRTabId},318:{n:"RRDRenSheet",f:parse_RRDRenSheet},319:{n:"RRSort",f:parse_RRSort},320:{n:"RRDMove",f:parse_RRDMove},330:{n:"RRFormat",f:parse_RRFormat},331:{n:"RRAutoFmt",f:parse_RRAutoFmt},333:{n:"RRInsertSh",f:parse_RRInsertSh},334:{n:"RRDMoveBegin",f:parse_RRDMoveBegin},335:{n:"RRDMoveEnd",f:parse_RRDMoveEnd},336:{n:"RRDInsDelBegin",f:parse_RRDInsDelBegin},337:{n:"RRDInsDelEnd",f:parse_RRDInsDelEnd},338:{n:"RRDConflict",f:parse_RRDConflict},339:{n:"RRDDefName",f:parse_RRDDefName},340:{n:"RRDRstEtxp",f:parse_RRDRstEtxp},351:{n:"LRng",f:parse_LRng},352:{n:"UsesELFs",f:parse_UsesELFs},353:{n:"DSF",f:parse_DSF},401:{n:"CUsr",f:parse_CUsr},402:{n:"CbUsr",f:parse_CbUsr},403:{n:"UsrInfo",f:parse_UsrInfo},404:{n:"UsrExcl",f:parse_UsrExcl},405:{n:"FileLock",f:parse_FileLock},406:{n:"RRDInfo",f:parse_RRDInfo},407:{n:"BCUsrs",f:parse_BCUsrs},408:{n:"UsrChk",f:parse_UsrChk},425:{n:"UserBView",f:parse_UserBView},426:{n:"UserSViewBegin",f:parse_UserSViewBegin},427:{n:"UserSViewEnd",f:parse_UserSViewEnd},428:{n:"RRDUserView",f:parse_RRDUserView},429:{n:"Qsi",f:parse_Qsi},430:{n:"SupBook",f:parse_SupBook},431:{n:"Prot4Rev",f:parse_Prot4Rev},432:{n:"CondFmt",f:parse_CondFmt},433:{n:"CF",f:parse_CF},434:{n:"DVal",f:parse_DVal},437:{n:"DConBin",f:parse_DConBin},438:{n:"TxO",f:parse_TxO},439:{n:"RefreshAll",f:parse_RefreshAll},440:{n:"HLink",f:parse_HLink},441:{n:"Lel",f:parse_Lel},442:{n:"CodeName",f:parse_XLSCodeName},443:{n:"SXFDBType",f:parse_SXFDBType},444:{n:"Prot4RevPass",f:parse_Prot4RevPass},445:{n:"ObNoMacros",f:parse_ObNoMacros},446:{n:"Dv",f:parse_Dv},448:{n:"Excel9File",f:parse_Excel9File},449:{n:"RecalcId",f:parse_RecalcId,r:2},450:{n:"EntExU2",f:parse_EntExU2},512:{n:"Dimensions",f:parse_Dimensions},513:{n:"Blank",f:parse_Blank},515:{n:"Number",f:parse_Number},516:{n:"Label",f:parse_Label},517:{n:"BoolErr",f:parse_BoolErr},518:{n:"Formula",f:parse_Formula},519:{n:"String",f:parse_String},520:{n:"Row",f:parse_Row},523:{n:"Index",f:parse_Index},545:{n:"Array",f:parse_Array},549:{n:"DefaultRowHeight",f:parse_DefaultRowHeight},566:{n:"Table",f:parse_Table},574:{n:"Window2",f:parse_Window2},638:{n:"RK",f:parse_RK},659:{n:"Style",f:parse_Style},1030:{n:"Formula",f:parse_Formula},1048:{n:"BigName",f:parse_BigName},1054:{n:"Format",f:parse_Format},1084:{n:"ContinueBigName",f:parse_ContinueBigName},1212:{n:"ShrFmla",f:parse_ShrFmla},2048:{n:"HLinkTooltip",f:parse_HLinkTooltip},2049:{n:"WebPub",f:parse_WebPub},2050:{n:"QsiSXTag",f:parse_QsiSXTag},2051:{n:"DBQueryExt",f:parse_DBQueryExt},2052:{n:"ExtString",f:parse_ExtString},2053:{n:"TxtQry",f:parse_TxtQry},2054:{n:"Qsir",f:parse_Qsir},2055:{n:"Qsif",f:parse_Qsif},2056:{n:"RRDTQSIF",f:parse_RRDTQSIF},2057:{n:"BOF",f:parse_BOF},2058:{n:"OleDbConn",f:parse_OleDbConn},2059:{n:"WOpt",f:parse_WOpt},2060:{n:"SXViewEx",f:parse_SXViewEx},2061:{n:"SXTH",f:parse_SXTH},2062:{n:"SXPIEx",f:parse_SXPIEx},2063:{n:"SXVDTEx",f:parse_SXVDTEx},2064:{n:"SXViewEx9",f:parse_SXViewEx9},2066:{n:"ContinueFrt",f:parse_ContinueFrt},2067:{n:"RealTimeData",f:parse_RealTimeData},2128:{n:"ChartFrtInfo",f:parse_ChartFrtInfo},2129:{n:"FrtWrapper",f:parse_FrtWrapper},2130:{n:"StartBlock",f:parse_StartBlock},2131:{n:"EndBlock",f:parse_EndBlock},2132:{n:"StartObject",f:parse_StartObject},2133:{n:"EndObject",f:parse_EndObject},2134:{n:"CatLab",f:parse_CatLab},2135:{n:"YMult",f:parse_YMult},2136:{n:"SXViewLink",f:parse_SXViewLink},2137:{n:"PivotChartBits",f:parse_PivotChartBits},2138:{n:"FrtFontList",f:parse_FrtFontList},2146:{n:"SheetExt",f:parse_SheetExt},2147:{n:"BookExt",f:parse_BookExt,r:12},2148:{n:"SXAddl",f:parse_SXAddl},2149:{n:"CrErr",f:parse_CrErr},2150:{n:"HFPicture",f:parse_HFPicture},2151:{n:"FeatHdr",f:parse_FeatHdr},2152:{n:"Feat",f:parse_Feat},2154:{n:"DataLabExt",f:parse_DataLabExt},2155:{n:"DataLabExtContents",f:parse_DataLabExtContents},2156:{n:"CellWatch",f:parse_CellWatch},2161:{n:"FeatHdr11",f:parse_FeatHdr11},2162:{n:"Feature11",f:parse_Feature11},2164:{n:"DropDownObjIds",f:parse_DropDownObjIds},2165:{n:"ContinueFrt11",f:parse_ContinueFrt11},2166:{n:"DConn",f:parse_DConn},2167:{n:"List12",f:parse_List12},2168:{n:"Feature12",f:parse_Feature12},2169:{n:"CondFmt12",f:parse_CondFmt12},2170:{n:"CF12",f:parse_CF12},2171:{n:"CFEx",f:parse_CFEx},2172:{n:"XFCRC",f:parse_XFCRC,r:12},2173:{n:"XFExt",f:parse_XFExt,r:12},2174:{n:"AutoFilter12",f:parse_AutoFilter12},2175:{n:"ContinueFrt12",f:parse_ContinueFrt12},2180:{n:"MDTInfo",f:parse_MDTInfo},2181:{n:"MDXStr",f:parse_MDXStr},2182:{n:"MDXTuple",f:parse_MDXTuple},2183:{n:"MDXSet",f:parse_MDXSet},2184:{n:"MDXProp",f:parse_MDXProp},2185:{n:"MDXKPI",f:parse_MDXKPI},2186:{n:"MDB",f:parse_MDB},2187:{n:"PLV",f:parse_PLV},2188:{n:"Compat12",f:parse_Compat12,r:12},2189:{n:"DXF",f:parse_DXF},2190:{n:"TableStyles",f:parse_TableStyles,r:12},2191:{n:"TableStyle",f:parse_TableStyle},2192:{n:"TableStyleElement",f:parse_TableStyleElement},2194:{n:"StyleExt",f:parse_StyleExt},2195:{n:"NamePublish",f:parse_NamePublish},2196:{n:"NameCmt",f:parse_NameCmt,r:12},2197:{n:"SortData",f:parse_SortData},2198:{n:"Theme",f:parse_Theme,r:12},2199:{n:"GUIDTypeLib",f:parse_GUIDTypeLib},2200:{n:"FnGrp12",f:parse_FnGrp12},2201:{n:"NameFnGrp12",f:parse_NameFnGrp12},2202:{n:"MTRSettings",f:parse_MTRSettings,r:12},2203:{n:"CompressPictures",f:parse_CompressPictures},2204:{n:"HeaderFooter",f:parse_HeaderFooter},2205:{n:"CrtLayout12",f:parse_CrtLayout12},2206:{n:"CrtMlFrt",f:parse_CrtMlFrt},2207:{n:"CrtMlFrtContinue",f:parse_CrtMlFrtContinue},2211:{n:"ForceFullCalculation",f:parse_ForceFullCalculation},2212:{n:"ShapePropsStream",f:parse_ShapePropsStream},2213:{n:"TextPropsStream",f:parse_TextPropsStream},2214:{n:"RichTextStream",f:parse_RichTextStream},2215:{n:"CrtLayout12A",f:parse_CrtLayout12A},4097:{n:"Units",f:parse_Units},4098:{n:"Chart",f:parse_Chart},4099:{n:"Series",f:parse_Series},4102:{n:"DataFormat",f:parse_DataFormat},4103:{n:"LineFormat",f:parse_LineFormat},4105:{n:"MarkerFormat",f:parse_MarkerFormat},4106:{n:"AreaFormat",f:parse_AreaFormat},4107:{n:"PieFormat",f:parse_PieFormat},4108:{n:"AttachedLabel",f:parse_AttachedLabel},4109:{n:"SeriesText",f:parse_SeriesText},4116:{n:"ChartFormat",f:parse_ChartFormat},4117:{n:"Legend",f:parse_Legend},4118:{n:"SeriesList",f:parse_SeriesList},4119:{n:"Bar",f:parse_Bar},4120:{n:"Line",f:parse_Line},4121:{n:"Pie",f:parse_Pie},4122:{n:"Area",f:parse_Area},4123:{n:"Scatter",f:parse_Scatter},4124:{n:"CrtLine",f:parse_CrtLine},4125:{n:"Axis",f:parse_Axis},4126:{n:"Tick",f:parse_Tick},4127:{n:"ValueRange",f:parse_ValueRange},4128:{n:"CatSerRange",f:parse_CatSerRange},4129:{n:"AxisLine",f:parse_AxisLine},4130:{n:"CrtLink",f:parse_CrtLink},4132:{n:"DefaultText",f:parse_DefaultText},4133:{n:"Text",f:parse_Text},4134:{n:"FontX",f:parse_FontX},4135:{n:"ObjectLink",f:parse_ObjectLink},4146:{n:"Frame",f:parse_Frame},4147:{n:"Begin",f:parse_Begin},4148:{n:"End",f:parse_End},4149:{n:"PlotArea",f:parse_PlotArea},4154:{n:"Chart3d",f:parse_Chart3d},4156:{n:"PicF",f:parse_PicF},4157:{n:"DropBar",f:parse_DropBar},4158:{n:"Radar",f:parse_Radar},4159:{n:"Surf",f:parse_Surf},4160:{n:"RadarArea",f:parse_RadarArea},4161:{n:"AxisParent",f:parse_AxisParent},4163:{n:"LegendException",f:parse_LegendException},4164:{n:"ShtProps",f:parse_ShtProps},4165:{n:"SerToCrt",f:parse_SerToCrt},4166:{n:"AxesUsed",f:parse_AxesUsed},4168:{n:"SBaseRef",f:parse_SBaseRef},4170:{n:"SerParent",f:parse_SerParent},4171:{n:"SerAuxTrend",f:parse_SerAuxTrend},4174:{n:"IFmtRecord",f:parse_IFmtRecord},4175:{n:"Pos",f:parse_Pos},4176:{n:"AlRuns",f:parse_AlRuns},4177:{n:"BRAI",f:parse_BRAI},4187:{n:"SerAuxErrBar",f:parse_SerAuxErrBar},4188:{n:"ClrtClient",f:parse_ClrtClient},4189:{n:"SerFmt",f:parse_SerFmt},4191:{n:"Chart3DBarShape",f:parse_Chart3DBarShape},4192:{n:"Fbi",f:parse_Fbi},4193:{n:"BopPop",f:parse_BopPop},4194:{n:"AxcExt",f:parse_AxcExt},4195:{n:"Dat",f:parse_Dat},4196:{n:"PlotGrowth",f:parse_PlotGrowth},4197:{n:"SIIndex",f:parse_SIIndex},4198:{n:"GelFrame",f:parse_GelFrame},4199:{n:"BopPopCustom",f:parse_BopPopCustom},4200:{n:"Fbi2",f:parse_Fbi2},0:{n:"Dimensions",f:parse_Dimensions},2:{n:"BIFF2INT",f:parse_BIFF2INT},5:{n:"BoolErr",f:parse_BoolErr},7:{n:"String",f:parse_BIFF2STRING},8:{n:"BIFF2ROW",f:parsenoop},11:{n:"Index",f:parse_Index},22:{n:"ExternCount",f:parsenoop},30:{n:"BIFF2FORMAT",f:parse_BIFF2Format},31:{n:"BIFF2FMTCNT",f:parsenoop},32:{n:"BIFF2COLINFO",f:parsenoop},33:{n:"Array",f:parse_Array},37:{n:"DefaultRowHeight",f:parse_DefaultRowHeight},50:{n:"BIFF2FONTXTRA",f:parse_BIFF2FONTXTRA},62:{n:"BIFF2WINDOW2",f:parsenoop},69:{n:"BIFF2FONTCLR",f:parsenoop},86:{n:"BIFF4FMTCNT",f:parsenoop},126:{n:"RK",f:parsenoop},127:{n:"ImData",f:parse_ImData},135:{n:"Addin",f:parsenoop},136:{n:"Edg",f:parsenoop},137:{n:"Pub",f:parsenoop},145:{n:"Sub",f:parsenoop},148:{n:"LHRecord",f:parsenoop},149:{n:"LHNGraph",f:parsenoop},150:{n:"Sound",f:parsenoop},169:{n:"CoordList",f:parsenoop},171:{n:"GCW",f:parsenoop},188:{n:"ShrFmla",f:parsenoop},194:{n:"AddMenu",f:parsenoop},195:{n:"DelMenu",f:parsenoop},214:{n:"RString",f:parse_RString},223:{n:"UDDesc",f:parsenoop},234:{n:"TabIdConf",f:parsenoop},354:{n:"XL5Modify",f:parsenoop},421:{n:"FileSharing2",f:parsenoop},521:{n:"BOF",f:parse_BOF},536:{n:"Lbl",f:parse_Lbl},547:{n:"ExternName",f:parse_ExternName},561:{n:"Font",f:parsenoop},1033:{n:"BOF",f:parse_BOF},2157:{n:"FeatInfo",f:parsenoop},2163:{n:"FeatInfo11",f:parsenoop},2177:{n:"SXAddl12",f:parsenoop},2240:{n:"AutoWebPub",f:parsenoop},2241:{n:"ListObj",f:parsenoop},2242:{n:"ListField",f:parsenoop},2243:{n:"ListDV",f:parsenoop},2244:{n:"ListCondFmt",f:parsenoop},2245:{n:"ListCF",f:parsenoop},2246:{n:"FMQry",f:parsenoop},2247:{n:"FMSQry",f:parsenoop},2248:{n:"PLV",f:parsenoop},2249:{n:"LnExt",f:parsenoop},2250:{n:"MkrExt",f:parsenoop},2251:{n:"CrtCoopt",f:parsenoop},67:{n:"BIFF2XF",f:parsenoop},579:{n:"BIFF3XF",f:parsenoop},1091:{n:"BIFF4XF",f:parsenoop},29282:{}};function write_biff_rec(ba,t,payload,length){var len=length||(payload||[]).length;var o=ba.next(4+len);o.write_shift(2,t);o.write_shift(2,len);if(len>0&&is_buf(payload))ba.push(payload)}function write_BOF(wb,o){if(o.bookType!="biff2")throw"unsupported BIFF version";var out=new_buf(4);out.write_shift(2,2);out.write_shift(2,16);return out}function write_BIFF2Cell(out,r,c){if(!out)out=new_buf(7);out.write_shift(2,r);out.write_shift(2,c);out.write_shift(1,0);out.write_shift(1,0);out.write_shift(1,0);return out}function write_BIFF2INT(r,c,val){var out=new_buf(9);write_BIFF2Cell(out,r,c);out.write_shift(2,val);return out}function write_BIFF2NUMBER(r,c,val){var out=new_buf(15);write_BIFF2Cell(out,r,c);out.write_shift(8,val,"f");return out}function write_BIFF2BERR(r,c,val,t){var out=new_buf(9);write_BIFF2Cell(out,r,c);if(t=="e"){out.write_shift(1,val);out.write_shift(1,1)}else{out.write_shift(1,val?1:0);out.write_shift(1,0)}return out}function write_BIFF2LABEL(r,c,val){var out=new_buf(8+2*val.length);write_BIFF2Cell(out,r,c);out.write_shift(1,val.length);out.write_shift(val.length,val,"sbcs");return out.l<out.length?out.slice(0,out.l):out}function write_ws_biff_cell(ba,cell,R,C,opts){if(cell.v!=null)switch(cell.t){case"d":;case"n":var v=cell.t=="d"?datenum(cell.v):cell.v;if(v==(v|0)&&v>=0&&v<65536)write_biff_rec(ba,2,write_BIFF2INT(R,C,v));else write_biff_rec(ba,3,write_BIFF2NUMBER(R,C,v));return;case"b":;case"e":write_biff_rec(ba,5,write_BIFF2BERR(R,C,cell.v,cell.t));return;case"s":;case"str":write_biff_rec(ba,4,write_BIFF2LABEL(R,C,cell.v));return;}write_biff_rec(ba,1,write_BIFF2Cell(null,R,C))}function write_biff_ws(ba,ws,idx,opts,wb){var dense=Array.isArray(ws);var range=safe_decode_range(ws["!ref"]||"A1"),ref,rr="",cols=[];for(var R=range.s.r;R<=range.e.r;++R){rr=encode_row(R);for(var C=range.s.c;C<=range.e.c;++C){if(R===range.s.r)cols[C]=encode_col(C);ref=cols[C]+rr;var cell=dense?(ws[R]||[])[C]:ws[ref];if(!cell)continue;write_ws_biff_cell(ba,cell,R,C,opts)}}}function write_biff_buf(wb,opts){var o=opts||{};if(DENSE!=null&&o.dense==null)o.dense=DENSE;var ba=buf_array();var idx=0;for(var i=0;i<wb.SheetNames.length;++i)if(wb.SheetNames[i]==o.sheet)idx=i;if(idx==0&&!!o.sheet&&wb.SheetNames[0]!=o.sheet)throw new Error("Sheet not found: "+o.sheet);write_biff_rec(ba,9,write_BOF(wb,o));write_biff_ws(ba,wb.Sheets[wb.SheetNames[idx]],idx,o,wb);write_biff_rec(ba,10);return ba.end()}var HTML_=function(){function html_to_sheet(str,_opts){var opts=_opts||{};if(DENSE!=null&&opts.dense==null)opts.dense=DENSE;var ws=opts.dense?[]:{};var i=str.indexOf("<table"),j=str.indexOf("</table");if(i==-1||j==-1)throw new Error("Invalid HTML: missing <table> / </table> pair");var rows=str.slice(i,j).split(/(:?<tr[^>]*>)/);var R=-1,C=0,RS=0,CS=0;var range={s:{r:1e7,c:1e7},e:{r:0,c:0}};var merges=[],midx=0;for(i=0;i<rows.length;++i){var row=rows[i].trim();if(row.substr(0,3)=="<tr"){++R;C=0;continue}if(row.substr(0,3)!="<td")continue;var cells=row.split("</td>");for(j=0;j<cells.length;++j){var cell=cells[j].trim();if(cell.substr(0,3)!="<td")continue;var m=cell,cc=0;while(m.charAt(0)=="<"&&(cc=m.indexOf(">"))>-1)m=m.slice(cc+1);while(m.indexOf(">")>-1)m=m.slice(0,m.lastIndexOf("<"));var tag=parsexmltag(cell.slice(0,cell.indexOf(">")));CS=tag.colspan?+tag.colspan:1;if((RS=+tag.rowspan)>0||CS>1)merges.push({s:{r:R,c:C},e:{r:R+(RS||1)-1,c:C+CS-1}});if(!m.length){C+=CS;continue}m=unescapexml(m).replace(/[\r\n]/g,"");if(range.s.r>R)range.s.r=R;if(range.e.r<R)range.e.r=R;if(range.s.c>C)range.s.c=C;if(range.e.c<C)range.e.c=C;if(opts.dense){if(!ws[R])ws[R]=[];if(Number(m)==Number(m))ws[R][C]={t:"n",v:+m};else ws[R][C]={t:"s",v:m}}else{var coord=encode_cell({r:R,c:C});if(Number(m)==Number(m))ws[coord]={t:"n",v:+m};else ws[coord]={t:"s",v:m}}C+=CS}}ws["!ref"]=encode_range(range);return ws}function html_to_book(str,opts){return sheet_to_workbook(html_to_sheet(str,opts),opts)}function make_html_row(ws,r,R,o){var M=ws["!merges"]||[];var oo=[];var nullcell="<td"+(o.editable?' contenteditable="true"':"")+"></td>";for(var C=r.s.c;C<=r.e.c;++C){var RS=0,CS=0;for(var j=0;j<M.length;++j){if(M[j].s.r>R||M[j].s.c>C)continue;if(M[j].e.r<R||M[j].e.c<C)continue;if(M[j].s.r<R||M[j].s.c<C){RS=-1;break}RS=M[j].e.r-M[j].s.r+1;CS=M[j].e.c-M[j].s.c+1;break}if(RS<0)continue;var coord=encode_cell({r:R,c:C});var cell=o.dense?(ws[R]||[])[C]:ws[coord];if(!cell||cell.v==null){oo.push(nullcell);continue}var w=cell.h||escapexml(cell.w||(format_cell(cell),cell.w)||"");var sp={};if(RS>1)sp.rowspan=RS;if(CS>1)sp.colspan=CS;if(o.editable)sp.contenteditable="true";sp.id="sjs-"+coord;oo.push(writextag("td",w,sp))}var preamble="<tr>";return preamble+oo.join("")+"</tr>"}function make_html_preamble(ws,R,o){var out=[];return out.join("")+"<table>"}var _BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>';var _END="</body></html>";function sheet_to_html(ws,opts,wb){var o=opts||{};var header=o.header!=null?o.header:_BEGIN;var footer=o.footer!=null?o.footer:_END;var out=[header];var r=decode_range(ws["!ref"]);o.dense=Array.isArray(ws);out.push(make_html_preamble(ws,r,o));for(var R=r.s.r;R<=r.e.r;++R)out.push(make_html_row(ws,r,R,o));out.push("</table>"+footer);return out.join("")}return{to_workbook:html_to_book,to_sheet:html_to_sheet,_row:make_html_row,BEGIN:_BEGIN,END:_END,_preamble:make_html_preamble,from_sheet:sheet_to_html}}();function parse_dom_table(table,_opts){var opts=_opts||{};if(DENSE!=null)opts.dense=DENSE;var ws=opts.dense?[]:{};var rows=table.getElementsByTagName("tr");var range={s:{r:0,c:0},e:{r:rows.length-1,c:0}};var merges=[],midx=0;var R=0,_C=0,C=0,RS=0,CS=0;for(;R<rows.length;++R){var row=rows[R];var elts=row.children;for(_C=C=0;_C<elts.length;++_C){var elt=elts[_C],v=elts[_C].innerText||elts[_C].textContent;for(midx=0;midx<merges.length;++midx){var m=merges[midx];if(m.s.c==C&&m.s.r<=R&&R<=m.e.r){C=m.e.c+1;midx=-1}}CS=+elt.getAttribute("colspan")||1;if((RS=+elt.getAttribute("rowspan"))>0||CS>1)merges.push({s:{r:R,c:C},e:{r:R+(RS||1)-1,c:C+CS-1}});var o={t:"s",v:v};if(v!=null&&v.length){if(!isNaN(Number(v)))o={t:"n",v:Number(v)};else if(!isNaN(fuzzydate(v).getDate())){o={t:"d",v:parseDate(v)};if(!opts.cellDates)o={t:"n",v:datenum(o.v)};o.z=opts.dateNF||SSF._table[14]}}if(opts.dense){if(!ws[R])ws[R]=[];ws[R][C]=o}else ws[encode_cell({c:C,r:R})]=o;if(range.e.c<C)range.e.c=C;C+=CS}}ws["!merges"]=merges;ws["!ref"]=encode_range(range);return ws}function table_to_book(table,opts){return sheet_to_workbook(parse_dom_table(table,opts),opts)}var parse_content_xml=function(){var parse_text_p=function(text,tag){return unescapexml(text.replace(/<text:s\/>/g," ").replace(/<[^>]*>/g,""))};var number_formats={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"]};return function pcx(d,_opts){var opts=_opts||{};if(DENSE!=null&&opts.dense==null)opts.dense=DENSE;var str=xlml_normalize(d);var state=[],tmp;var tag;var NFtag={name:""},NF="",pidx=0;var sheetag;var rowtag;var Sheets={},SheetNames=[];var ws=opts.dense?[]:{};var Rn,q;var ctag={value:""};var textp="",textpidx=0,textptag;var R=-1,C=-1,range={s:{r:1e6,c:1e7},e:{r:0,c:0}};var number_format_map={};var merges=[],mrange={},mR=0,mC=0;var arrayf=[];var comments=[],comment={};var creator="",creatoridx=0;var rept=1,isstub=false;var i=0;xlmlregex.lastIndex=0;str=str.replace(/<!--([\s\S]*?)-->/gm,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");while(Rn=xlmlregex.exec(str))switch(Rn[3]=Rn[3].replace(/_.*$/,"")){case"table":;case"工作表":if(Rn[1]==="/"){if(range.e.c>=range.s.c&&range.e.r>=range.s.r)ws["!ref"]=encode_range(range);if(merges.length)ws["!merges"]=merges;sheetag.name=utf8read(sheetag["名称"]||sheetag.name);SheetNames.push(sheetag.name);Sheets[sheetag.name]=ws}else if(Rn[0].charAt(Rn[0].length-2)!=="/"){sheetag=parsexmltag(Rn[0],false);R=C=-1;range.s.r=range.s.c=1e7;range.e.r=range.e.c=0;ws=opts.dense?[]:{};merges=[]}break;case"table-row":;case"行":if(Rn[1]==="/")break;rowtag=parsexmltag(Rn[0],false);if(rowtag["行号"])R=rowtag["行号"]-1;else++R;C=-1;break;case"covered-table-cell":++C;if(opts.sheetStubs){if(opts.dense){if(!ws[R])ws[R]=[];ws[R][C]={t:"z"}}else ws[encode_cell({r:R,c:C})]={t:"z"}}break;case"table-cell":;case"数据":if(Rn[0].charAt(Rn[0].length-2)==="/"){ctag=parsexmltag(Rn[0],false);if(ctag["number-columns-repeated"])C+=parseInt(ctag["number-columns-repeated"],10);else++C}else if(Rn[1]!=="/"){++C;rept=1;if(C>range.e.c)range.e.c=C;if(R>range.e.r)range.e.r=R;if(C<range.s.c)range.s.c=C;if(R<range.s.r)range.s.r=R;ctag=parsexmltag(Rn[0],false);comments=[];comment={};q={t:ctag["数据类型"]||ctag["value-type"],v:null};if(opts.cellFormula){if(ctag.formula)ctag.formula=unescapexml(ctag.formula);if(ctag["number-matrix-columns-spanned"]&&ctag["number-matrix-rows-spanned"]){mR=parseInt(ctag["number-matrix-rows-spanned"],10)||0;mC=parseInt(ctag["number-matrix-columns-spanned"],10)||0;mrange={s:{r:R,c:C},e:{r:R+mR-1,c:C+mC-1}};q.F=encode_range(mrange);arrayf.push([mrange,q.F])}if(ctag.formula)q.f=ods_to_csf_formula(ctag.formula);else for(i=0;i<arrayf.length;++i)if(R>=arrayf[i][0].s.r&&R<=arrayf[i][0].e.r)if(C>=arrayf[i][0].s.c&&C<=arrayf[i][0].e.c)q.F=arrayf[i][1]}if(ctag["number-columns-spanned"]||ctag["number-rows-spanned"]){mR=parseInt(ctag["number-rows-spanned"],10)||0;mC=parseInt(ctag["number-columns-spanned"],10)||0;mrange={s:{r:R,c:C},e:{r:R+mR-1,c:C+mC-1}};merges.push(mrange)}if(ctag["number-columns-repeated"])rept=parseInt(ctag["number-columns-repeated"],10);switch(q.t){case"boolean":q.t="b";q.v=parsexmlbool(ctag["boolean-value"]);break;case"float":q.t="n";q.v=parseFloat(ctag.value);break;case"percentage":q.t="n";q.v=parseFloat(ctag.value);break;case"currency":q.t="n";q.v=parseFloat(ctag.value);break;case"date":q.t="d";q.v=parseDate(ctag["date-value"]);if(!opts.cellDates){q.t="n";q.v=datenum(q.v)}q.z="m/d/yy";break;case"time":q.t="n";q.v=parse_isodur(ctag["time-value"])/86400;break;case"number":q.t="n";q.v=parseFloat(ctag["数据数值"]);break;default:if(q.t==="string"||q.t==="text"||!q.t){q.t="s";if(ctag["string-value"]!=null)textp=unescapexml(ctag["string-value"])}else throw new Error("Unsupported value type "+q.t);}}else{isstub=false;if(q.t==="s"){q.v=textp||"";isstub=textpidx==0}if(comments.length>0){q.c=comments;comments=[]}if(textp&&opts.cellText!==false)q.w=textp;if(!isstub||opts.sheetStubs){if(!(opts.sheetRows&&opts.sheetRows<R)){if(opts.dense){if(!ws[R])ws[R]=[];ws[R][C]=q;while(--rept>0)ws[R][++C]=dup(q)}else{ws[encode_cell({r:R,c:C})]=q;while(--rept>0)ws[encode_cell({r:R,c:++C})]=dup(q)}if(range.e.c<=C)range.e.c=C}}else{C+=rept;rept=0}q={};textp=""}break;case"document":;case"document-content":;case"电子表格文档":;case"spreadsheet":;case"主体":;case"scripts":;case"styles":;case"font-face-decls":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else if(Rn[0].charAt(Rn[0].length-2)!=="/")state.push([Rn[3],true]);break;case"annotation":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp;comment.t=textp;comment.a=creator;comments.push(comment)}else if(Rn[0].charAt(Rn[0].length-2)!=="/"){state.push([Rn[3],false])}creator="";creatoridx=0;textp="";textpidx=0;break;case"creator":if(Rn[1]==="/"){creator=str.slice(creatoridx,Rn.index)}else creatoridx=Rn.index+Rn[0].length;break;case"meta":;case"元数据":;case"settings":;case"config-item-set":;case"config-item-map-indexed":;case"config-item-map-entry":;case"config-item-map-named":;case"shapes":;case"frame":;case"text-box":;case"image":;case"data-pilot-tables":;case"list-style":;case"form":;case"dde-links":;case"event-listeners":if(Rn[1]==="/"){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else if(Rn[0].charAt(Rn[0].length-2)!=="/")state.push([Rn[3],false]);textp="";textpidx=0;break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":;case"percentage-style":;case"date-style":;case"time-style":if(Rn[1]==="/"){number_format_map[NFtag.name]=NF;if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else if(Rn[0].charAt(Rn[0].length-2)!=="/"){NF="";NFtag=parsexmltag(Rn[0],false);state.push([Rn[3],true])}break;case"script":break;case"libraries":break;case"automatic-styles":break;case"master-styles":break;case"default-style":;case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(state[state.length-1][0]){case"time-style":;case"date-style":tag=parsexmltag(Rn[0],false);NF+=number_formats[Rn[3]][tag.style==="long"?1:0];break;}break;case"fraction":break;case"day":;case"month":;case"year":;case"era":;case"day-of-week":;case"week-of-year":;case"quarter":;case"hours":;case"minutes":;case"seconds":;case"am-pm":switch(state[state.length-1][0]){case"time-style":;case"date-style":tag=parsexmltag(Rn[0],false);NF+=number_formats[Rn[3]][tag.style==="long"?1:0];break;}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(Rn[0].slice(-2)==="/>")break;else if(Rn[1]==="/")switch(state[state.length-1][0]){case"number-style":;case"date-style":;case"time-style":NF+=str.slice(pidx,Rn.index);break;}else pidx=Rn.index+Rn[0].length;break;case"text-content":break;case"text-properties":break;case"body":;case"电子表格":break;case"forms":break;case"table-column":break;case"table-row-group":break;case"table-column-group":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"named-range":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"span":break;case"line-break":break;case"p":;case"文本串":if(Rn[1]==="/")textp=(textp.length>0?textp+"\n":"")+parse_text_p(str.slice(textpidx,Rn.index),textptag);else{textptag=parsexmltag(Rn[0],false);textpidx=Rn.index+Rn[0].length}break;case"database-range":if(Rn[1]==="/")break;try{var AutoFilter=ods_to_csf_range_3D(parsexmltag(Rn[0])["target-range-address"]);Sheets[AutoFilter[0]]["!autofilter"]={ref:AutoFilter[1]}}catch(e){}break;case"s":break;case"date":break;case"object":break;case"title":;case"标题":break;case"desc":break;case"table-source":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":;case"sender-lastname":;case"sender-initials":;case"sender-title":;case"sender-position":;case"sender-email":;case"sender-phone-private":;case"sender-fax":;case"sender-company":;case"sender-phone-work":;case"sender-street":;case"sender-city":;case"sender-postal-code":;case"sender-country":;case"sender-state-or-province":;case"author-name":;case"author-initials":;case"chapter":;case"file-name":;case"template-name":;case"sheet-name":break;case"event-listener":break;case"initial-creator":;case"creation-date":;case"generator":;case"document-statistic":;case"user-defined":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"data-pilot-table":;case"source-cell-range":;case"source-service":;case"data-pilot-field":;case"data-pilot-level":;case"data-pilot-subtotals":;case"data-pilot-subtotal":;case"data-pilot-members":;case"data-pilot-member":;case"data-pilot-display-info":;case"data-pilot-sort-info":;case"data-pilot-layout-info":;case"data-pilot-field-reference":;case"data-pilot-groups":;case"data-pilot-group":;case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":;case"dde-connection-decl":;case"dde-link":;case"dde-source":break;case"properties":break;case"property":break;case"a":break;case"table-protection":break;case"data-pilot-grand-total":break;default:if(Rn[2]==="dc:")break;if(Rn[2]==="draw:")break;if(Rn[2]==="style:")break;if(Rn[2]==="calcext:")break;if(Rn[2]==="loext:")break;if(Rn[2]==="uof:")break;if(Rn[2]==="表:")break;if(Rn[2]==="字:")break;if(opts.WTF)throw new Error(Rn);}var out={Sheets:Sheets,SheetNames:SheetNames};return out}}();function parse_ods(zip,opts){opts=opts||{};var ods=!!safegetzipfile(zip,"objectdata");if(ods)var manifest=parse_manifest(getzipdata(zip,"META-INF/manifest.xml"),opts);var content=getzipstr(zip,"content.xml");if(!content)throw new Error("Missing content.xml in "+(ods?"ODS":"UOF")+" file");return parse_content_xml(ods?content:utf8read(content),opts)}function parse_fods(data,opts){return parse_content_xml(data,opts)}var write_styles_ods=function(){var payload='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><office:document-styles xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" office:version="1.2"></office:document-styles>';return function wso(wb,opts){return payload}}();var write_content_ods=function(){var null_cell_xml="          <table:table-cell />\n";var covered_cell_xml="          <table:covered-table-cell/>\n";var write_ws=function(ws,wb,i,opts){var o=[];o.push('      <table:table table:name="'+escapexml(wb.SheetNames[i])+'">\n');var R=0,C=0,range=decode_range(ws["!ref"]);var marr=ws["!merges"]||[],mi=0;var dense=Array.isArray(ws);for(R=0;R<range.s.r;++R)o.push("        <table:table-row></table:table-row>\n");for(;R<=range.e.r;++R){o.push("        <table:table-row>\n");for(C=0;C<range.s.c;++C)o.push(null_cell_xml);for(;C<=range.e.c;++C){var skip=false,ct={},textp="";for(mi=0;mi!=marr.length;++mi){if(marr[mi].s.c>C)continue;if(marr[mi].s.r>R)continue;if(marr[mi].e.c<C)continue;if(marr[mi].e.r<R)continue;if(marr[mi].s.c!=C||marr[mi].s.r!=R)skip=true;ct["table:number-columns-spanned"]=marr[mi].e.c-marr[mi].s.c+1;ct["table:number-rows-spanned"]=marr[mi].e.r-marr[mi].s.r+1;break}if(skip){o.push(covered_cell_xml);continue}var ref=encode_cell({r:R,c:C}),cell=dense?(ws[R]||[])[C]:ws[ref];if(cell&&cell.f){ct["table:formula"]=escapexml(csf_to_ods_formula(cell.f));if(cell.F){if(cell.F.substr(0,ref.length)==ref){var _Fref=decode_range(cell.F);ct["table:number-matrix-columns-spanned"]=_Fref.e.c-_Fref.s.c+1;ct["table:number-matrix-rows-spanned"]=_Fref.e.r-_Fref.s.r+1}}}if(!cell){o.push(null_cell_xml);continue}switch(cell.t){case"b":textp=cell.v?"TRUE":"FALSE";ct["office:value-type"]="boolean";ct["office:boolean-value"]=cell.v?"true":"false";break;case"n":textp=cell.w||String(cell.v||0);ct["office:value-type"]="float";ct["office:value"]=cell.v||0;break;case"s":;case"str":textp=escapexml(cell.v);ct["office:value-type"]="string";break;case"d":textp=cell.w||parseDate(cell.v).toISOString();ct["office:value-type"]="date";ct["office:date-value"]=parseDate(cell.v).toISOString();ct["table:style-name"]="ce1";break;default:o.push(null_cell_xml);continue;}o.push("          "+writextag("table:table-cell",writextag("text:p",textp,{}),ct)+"\n")}o.push("        </table:table-row>\n")}o.push("      </table:table>\n");return o.join("")};var write_automatic_styles_ods=function(o){o.push(" <office:automatic-styles>\n");o.push('  <number:date-style style:name="N37" number:automatic-order="true">\n');o.push('   <number:month number:style="long"/>\n');o.push("   <number:text>/</number:text>\n");o.push('   <number:day number:style="long"/>\n');o.push("   <number:text>/</number:text>\n");o.push("   <number:year/>\n");o.push("  </number:date-style>\n");o.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n');o.push(" </office:automatic-styles>\n")};return function wcx(wb,opts){var o=[XML_HEADER];var attr=wxt_helper({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"});var fods=wxt_helper({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});if(opts.bookType=="fods")o.push("<office:document"+attr+fods+">\n");else o.push("<office:document-content"+attr+">\n");write_automatic_styles_ods(o);o.push("  <office:body>\n");o.push("    <office:spreadsheet>\n");for(var i=0;i!=wb.SheetNames.length;++i)o.push(write_ws(wb.Sheets[wb.SheetNames[i]],wb,i,opts));o.push("    </office:spreadsheet>\n");o.push("  </office:body>\n");if(opts.bookType=="fods")o.push("</office:document>");else o.push("</office:document-content>");return o.join("")}}();function write_ods(wb,opts){if(opts.bookType=="fods")return write_content_ods(wb,opts);var zip=new jszip;var f="";var manifest=[];var rdf=[];f="mimetype";zip.file(f,"application/vnd.oasis.opendocument.spreadsheet");f="content.xml";zip.file(f,write_content_ods(wb,opts));manifest.push([f,"text/xml"]);rdf.push([f,"ContentFile"]);f="styles.xml";zip.file(f,write_styles_ods(wb,opts));manifest.push([f,"text/xml"]);rdf.push([f,"StylesFile"]);f="manifest.rdf";zip.file(f,write_rdf(rdf,opts));manifest.push([f,"application/rdf+xml"]);f="meta.xml";zip.file(f,write_meta_ods(wb,opts));manifest.push([f,"text/xml"]);rdf.push([f,"MetadataFile"]);f="META-INF/manifest.xml";zip.file(f,write_manifest(manifest,opts));return zip}function write_obj_str(factory){return function write_str(wb,o){var idx=0;for(var i=0;i<wb.SheetNames.length;++i)if(wb.SheetNames[i]==o.sheet)idx=i;if(idx==0&&!!o.sheet&&wb.SheetNames[0]!=o.sheet)throw new Error("Sheet not found: "+o.sheet);return factory.from_sheet(wb.Sheets[wb.SheetNames[idx]],o,wb)}}var write_htm_str=write_obj_str(HTML_);var write_csv_str=write_obj_str({from_sheet:sheet_to_csv});var write_slk_str=write_obj_str(SYLK);var write_dif_str=write_obj_str(DIF);var write_prn_str=write_obj_str(PRN);var write_txt_str=write_obj_str({from_sheet:sheet_to_txt});function fix_opts_func(defaults){return function fix_opts(opts){for(var i=0;i!=defaults.length;++i){var d=defaults[i];if(opts[d[0]]===undefined)opts[d[0]]=d[1];if(d[2]==="n")opts[d[0]]=Number(opts[d[0]])}}}var fix_read_opts=fix_opts_func([["cellNF",false],["cellHTML",true],["cellFormula",true],["cellStyles",false],["cellText",true],["cellDates",false],["sheetStubs",false],["sheetRows",0,"n"],["bookDeps",false],["bookSheets",false],["bookProps",false],["bookFiles",false],["bookVBA",false],["password",""],["WTF",false]]);var fix_write_opts=fix_opts_func([["cellDates",false],["bookSST",false],["bookType","xlsx"],["compression",false],["WTF",false]]);function get_sheet_type(n){if(RELS.WS.indexOf(n)>-1)return"sheet";if(RELS.CS&&n==RELS.CS)return"chart";if(RELS.DS&&n==RELS.DS)return"dialog";if(RELS.MS&&n==RELS.MS)return"macro";if(!n||!n.length)return"sheet";return n}function safe_parse_wbrels(wbrels,sheets){if(!wbrels)return 0;try{wbrels=sheets.map(function pwbr(w){if(!w.id)w.id=w.strRelID;return[w.name,wbrels["!id"][w.id].Target,get_sheet_type(wbrels["!id"][w.id].Type)]})}catch(e){return null}return!wbrels||wbrels.length===0?null:wbrels}function safe_parse_sheet(zip,path,relsPath,sheet,sheetRels,sheets,stype,opts,wb,themes,styles){try{sheetRels[sheet]=parse_rels(getzipstr(zip,relsPath,true),path);var data=getzipdata(zip,path);switch(stype){case"sheet":sheets[sheet]=parse_ws(data,path,opts,sheetRels[sheet],wb,themes,styles);break;case"chart":var cs=parse_cs(data,path,opts,sheetRels[sheet],wb,themes,styles);sheets[sheet]=cs;if(!cs||!cs["!chart"])break;var dfile=resolve_path(cs["!chart"].Target,path);var drelsp=get_rels_path(dfile);var draw=parse_drawing(getzipstr(zip,dfile,true),parse_rels(getzipstr(zip,drelsp,true),dfile));var chartp=resolve_path(draw,dfile);var crelsp=get_rels_path(chartp);cs=parse_chart(getzipstr(zip,chartp,true),chartp,opts,parse_rels(getzipstr(zip,crelsp,true),chartp),wb,cs);break;case"macro":sheets[sheet]=parse_ms(data,path,opts,sheetRels[sheet],wb,themes,styles);break;case"dialog":sheets[sheet]=parse_ds(data,path,opts,sheetRels[sheet],wb,themes,styles);break;}}catch(e){if(opts.WTF)throw e}}var nodirs=function nodirs(x){return x.slice(-1)!="/"};function parse_zip(zip,opts){make_ssf(SSF);opts=opts||{};fix_read_opts(opts);reset_cp();if(safegetzipfile(zip,"META-INF/manifest.xml"))return parse_ods(zip,opts);if(safegetzipfile(zip,"objectdata.xml"))return parse_ods(zip,opts);var entries=keys(zip.files).filter(nodirs).sort();var dir=parse_ct(getzipstr(zip,"[Content_Types].xml"),opts);var xlsb=false;var sheets,binname;if(dir.workbooks.length===0){binname="xl/workbook.xml";if(getzipdata(zip,binname,true))dir.workbooks.push(binname)}if(dir.workbooks.length===0){binname="xl/workbook.bin";if(!getzipdata(zip,binname,true))throw new Error("Could not find workbook");dir.workbooks.push(binname);xlsb=true}if(dir.workbooks[0].slice(-3)=="bin")xlsb=true;if(xlsb)set_cp(1200);var themes={};var styles={};if(!opts.bookSheets&&!opts.bookProps){strs=[];if(dir.sst)strs=parse_sst(getzipdata(zip,dir.sst.replace(/^\//,"")),dir.sst,opts);if(opts.cellStyles&&dir.themes.length)themes=parse_theme(getzipstr(zip,dir.themes[0].replace(/^\//,""),true)||"",dir.themes[0],opts);if(dir.style)styles=parse_sty(getzipdata(zip,dir.style.replace(/^\//,"")),dir.style,themes,opts)}var wb=parse_wb(getzipdata(zip,dir.workbooks[0].replace(/^\//,"")),dir.workbooks[0],opts);var props={},propdata="";if(dir.coreprops.length!==0){propdata=getzipstr(zip,dir.coreprops[0].replace(/^\//,""),true);if(propdata)props=parse_core_props(propdata);if(dir.extprops.length!==0){propdata=getzipstr(zip,dir.extprops[0].replace(/^\//,""),true);if(propdata)parse_ext_props(propdata,props)}}var custprops={};if(!opts.bookSheets||opts.bookProps){if(dir.custprops.length!==0){propdata=getzipstr(zip,dir.custprops[0].replace(/^\//,""),true);if(propdata)custprops=parse_cust_props(propdata,opts)}}var out={};if(opts.bookSheets||opts.bookProps){if(wb.Sheets)sheets=wb.Sheets.map(function pluck(x){return x.name});else if(props.Worksheets&&props.SheetNames.length>0)sheets=props.SheetNames;if(opts.bookProps){out.Props=props;out.Custprops=custprops}if(opts.bookSheets&&typeof sheets!=="undefined")out.SheetNames=sheets;if(opts.bookSheets?out.SheetNames:opts.bookProps)return out}sheets={};var deps={};if(opts.bookDeps&&dir.calcchain)deps=parse_cc(getzipdata(zip,dir.calcchain.replace(/^\//,"")),dir.calcchain,opts);var i=0;var sheetRels={};var path,relsPath;{var wbsheets=wb.Sheets;props.Worksheets=wbsheets.length;props.SheetNames=[];for(var j=0;j!=wbsheets.length;++j){props.SheetNames[j]=wbsheets[j].name}}var wbext=xlsb?"bin":"xml";var wbrelsfile="xl/_rels/workbook."+wbext+".rels";var wbrels=parse_rels(getzipstr(zip,wbrelsfile,true),wbrelsfile);if(wbrels)wbrels=safe_parse_wbrels(wbrels,wb.Sheets);var nmode=getzipdata(zip,"xl/worksheets/sheet.xml",true)?1:0;for(i=0;i!=props.Worksheets;++i){var stype="sheet";if(wbrels&&wbrels[i]){path="xl/"+wbrels[i][1].replace(/[\/]?xl\//,"");stype=wbrels[i][2]}else{path="xl/worksheets/sheet"+(i+1-nmode)+"."+wbext;path=path.replace(/sheet0\./,"sheet.")}relsPath=path.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels");safe_parse_sheet(zip,path,relsPath,props.SheetNames[i],sheetRels,sheets,stype,opts,wb,themes,styles)}if(dir.comments)parse_comments(zip,dir.comments,sheets,sheetRels,opts);out={Directory:dir,Workbook:wb,Props:props,Custprops:custprops,Deps:deps,Sheets:sheets,SheetNames:props.SheetNames,Strings:strs,Styles:styles,Themes:themes,SSF:SSF.get_table()};if(opts.bookFiles){out.keys=entries;out.files=zip.files}if(opts.bookVBA){if(dir.vba.length>0)out.vbaraw=getzipdata(zip,dir.vba[0].replace(/^\//,""),true);else if(dir.defaults&&dir.defaults.bin==="application/vnd.ms-office.vbaProject")out.vbaraw=getzipdata(zip,"xl/vbaProject.bin",true)}return out}function parse_xlsxcfb(cfb,opts){var f="Version";var data=cfb.find(f);if(!data)throw new Error("ECMA-376 Encrypted file missing "+f);var version=parse_DataSpaceVersionInfo(data.content);f="DataSpaceMap";data=cfb.find(f);if(!data)throw new Error("ECMA-376 Encrypted file missing "+f);var dsm=parse_DataSpaceMap(data.content);if(dsm.length!=1||dsm[0].comps.length!=1||dsm[0].comps[0].t!=0||dsm[0].name!="StrongEncryptionDataSpace"||dsm[0].comps[0].v!="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+f);f="StrongEncryptionDataSpace";data=cfb.find(f);if(!data)throw new Error("ECMA-376 Encrypted file missing "+f);var seds=parse_DataSpaceDefinition(data.content);if(seds.length!=1||seds[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+f);f="!Primary";data=cfb.find(f);if(!data)throw new Error("ECMA-376 Encrypted file missing "+f);var hdr=parse_Primary(data.content);f="EncryptionInfo";data=cfb.find(f);if(!data)throw new Error("ECMA-376 Encrypted file missing "+f);var einfo=parse_EncryptionInfo(data.content);throw new Error("File is password-protected")}function write_zip(wb,opts){_shapeid=1024;if(opts.bookType=="ods")return write_ods(wb,opts);if(wb&&!wb.SSF){wb.SSF=SSF.get_table()}if(wb&&wb.SSF){make_ssf(SSF);SSF.load_table(wb.SSF);opts.revssf=evert_num(wb.SSF);opts.revssf[wb.SSF[65535]]=0;opts.ssf=wb.SSF}opts.rels={};opts.wbrels={};opts.Strings=[];opts.Strings.Count=0;opts.Strings.Unique=0;var wbext=opts.bookType=="xlsb"?"bin":"xml";var vbafmt=opts.bookType=="xlsb"||opts.bookType=="xlsm";var ct={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],TODO:[],xmlns:""};fix_write_opts(opts=opts||{});var zip=new jszip;var f="",rId=0;opts.cellXfs=[];get_cell_style(opts.cellXfs,{},{revssf:{General:0}});if(!wb.Props)wb.Props={};f="docProps/core.xml";zip.file(f,write_core_props(wb.Props,opts));ct.coreprops.push(f);add_rels(opts.rels,2,f,RELS.CORE_PROPS);f="docProps/app.xml";if(wb.Props&&wb.Props.SheetNames){}else if(!wb.Workbook||!wb.Workbook.Sheets)wb.Props.SheetNames=wb.SheetNames;else wb.Props.SheetNames=wb.SheetNames.map(function(x,i){return[(wb.Workbook.Sheets[i]||{}).Hidden!=2,x]}).filter(function(x){return x[0]}).map(function(x){return x[1]});wb.Props.Worksheets=wb.Props.SheetNames.length;zip.file(f,write_ext_props(wb.Props,opts));ct.extprops.push(f);add_rels(opts.rels,3,f,RELS.EXT_PROPS);if(wb.Custprops!==wb.Props&&keys(wb.Custprops||{}).length>0){f="docProps/custom.xml";zip.file(f,write_cust_props(wb.Custprops,opts));ct.custprops.push(f);add_rels(opts.rels,4,f,RELS.CUST_PROPS)}f="xl/workbook."+wbext;zip.file(f,write_wb(wb,f,opts));ct.workbooks.push(f);add_rels(opts.rels,1,f,RELS.WB);for(rId=1;rId<=wb.SheetNames.length;++rId){var wsrels={"!id":{}};var ws=wb.Sheets[wb.SheetNames[rId-1]];var _type=(ws||{})["!type"]||"sheet";switch(_type){case"chart":;default:f="xl/worksheets/sheet"+rId+"."+wbext;zip.file(f,write_ws(rId-1,f,opts,wb,wsrels));ct.sheets.push(f);add_rels(opts.wbrels,-1,"worksheets/sheet"+rId+"."+wbext,RELS.WS[0]);}if(ws){var comments=ws["!comments"];if(comments&&comments.length>0){var cf="xl/comments"+rId+"."+wbext;zip.file(cf,write_cmnt(comments,cf,opts));ct.comments.push(cf);add_rels(wsrels,-1,"../comments"+rId+"."+wbext,RELS.CMNT)}if(ws["!legacy"]){zip.file("xl/drawings/vmlDrawing"+rId+".vml",write_comments_vml(rId,ws["!comments"]))}delete ws["!comments"];delete ws["!legacy"]}if(wsrels["!id"].rId1)zip.file(get_rels_path(f),write_rels(wsrels))}if(opts.Strings!=null&&opts.Strings.length>0){f="xl/sharedStrings."+wbext;zip.file(f,write_sst(opts.Strings,f,opts));ct.strs.push(f);add_rels(opts.wbrels,-1,"sharedStrings."+wbext,RELS.SST)}f="xl/theme/theme1.xml";zip.file(f,write_theme(wb.Themes,opts));ct.themes.push(f);add_rels(opts.wbrels,-1,"theme/theme1.xml",RELS.THEME);f="xl/styles."+wbext;zip.file(f,write_sty(wb,f,opts));ct.styles.push(f);add_rels(opts.wbrels,-1,"styles."+wbext,RELS.STY);if(wb.vbaraw&&vbafmt){f="xl/vbaProject.bin";zip.file(f,wb.vbaraw);ct.vba.push(f);add_rels(opts.wbrels,-1,"vbaProject.bin",RELS.VBA)}zip.file("[Content_Types].xml",write_ct(ct,opts));zip.file("_rels/.rels",write_rels(opts.rels));zip.file("xl/_rels/workbook."+wbext+".rels",write_rels(opts.wbrels));delete opts.revssf;delete opts.ssf;return zip}function firstbyte(f,o){var x="";switch((o||{}).type||"base64"){case"buffer":return[f[0],f[1],f[2],f[3]];case"base64":x=Base64.decode(f.substr(0,24));break;case"binary":x=f;break;case"array":return[f[0],f[1],f[2],f[3]];default:throw new Error("Unrecognized type "+(o?o.type:"undefined"));}return[x.charCodeAt(0),x.charCodeAt(1),x.charCodeAt(2),x.charCodeAt(3)]}function read_cfb(cfb,opts){if(cfb.find("EncryptedPackage"))return parse_xlsxcfb(cfb,opts);return parse_xlscfb(cfb,opts)}function read_zip(data,opts){var zip,d=data;var o=opts||{};if(!o.type)o.type=has_buf&&Buffer.isBuffer(data)?"buffer":"base64";switch(o.type){case"base64":zip=new jszip(d,{base64:true});break;case"binary":;case"array":zip=new jszip(d,{base64:false});break;case"buffer":zip=new jszip(d);break;default:throw new Error("Unrecognized type "+o.type);}return parse_zip(zip,o)}function read_utf16(data,o){var d=data;if(o.type=="base64")d=Base64.decode(d);d=cptable.utils.decode(1200,d.slice(2));o.type="binary";if(d.charCodeAt(0)==60)return parse_xlml(d,o);return PRN.to_workbook(d,o)}function readSync(data,opts){var zip,d=data,n=[0];var o=opts||{};_ssfopts={};if(o.dateNF)_ssfopts.dateNF=o.dateNF;if(!o.type)o.type=has_buf&&Buffer.isBuffer(data)?"buffer":"base64";if(o.type=="file"){o.type="buffer";d=_fs.readFileSync(data)}switch((n=firstbyte(d,o))[0]){case 208:return read_cfb(CFB.read(d,o),o);case 9:return parse_xlscfb(s2a(o.type==="base64"?Base64.decode(d):d),o);case 60:return parse_xlml(d,o);case 73:if(n[1]==68)return read_wb_ID(d,o);break;case 84:if(n[1]==65&&n[2]==66&&n[3]==76)return DIF.to_workbook(d,o);break;case 80:if(n[1]==75&&n[2]<32&&n[3]<32)return read_zip(d,o);break;case 239:return n[3]==60?parse_xlml(d,o):PRN.to_workbook(d,o);case 255:if(n[1]==254){return read_utf16(d,o)}break;case 0:if(n[1]==0&&n[2]>=2&&n[3]==0)return WK_.to_workbook(d,o);break;case 3:;case 131:;case 139:return DBF.to_workbook(d,o);}if(n[2]<=12&&n[3]<=31)return DBF.to_workbook(d,o);if(32>n[0]||n[0]>127)throw new Error("Unsupported file "+n.join("|"));return PRN.to_workbook(d,o)}function readFileSync(filename,opts){var o=opts||{};o.type="file";return readSync(filename,o)}function write_zip_type(wb,opts){var o=opts||{};var z=write_zip(wb,o);var oopts={};if(o.compression)oopts.compression="DEFLATE";switch(o.type){case"base64":oopts.type="base64";break;case"binary":oopts.type="string";break;case"buffer":;case"file":oopts.type="nodebuffer";break;default:throw new Error("Unrecognized type "+o.type);}if(o.type==="file")return _fs.writeFileSync(o.file,z.generate(oopts));return z.generate(oopts)}function write_bstr_type(out,opts){switch(opts.type){case"base64":return Base64.encode(out);case"binary":return out;case"file":return _fs.writeFileSync(opts.file,out,"binary");case"buffer":{if(has_buf)return new Buffer(out,"utf8");else return out.split("").map(function(c){return c.charCodeAt(0)})};}throw new Error("Unrecognized type "+opts.type)}function write_string_type(out,opts){switch(opts.type){case"base64":return Base64.encode(out);case"binary":return out;case"file":return _fs.writeFileSync(opts.file,out,"utf8");case"buffer":{if(has_buf)return new Buffer(out,"utf8");else return out.split("").map(function(c){return c.charCodeAt(0)})};}throw new Error("Unrecognized type "+opts.type)}function write_binary_type(out,opts){switch(opts.type){case"base64":;case"binary":var bstr="";for(var i=0;i<out.length;++i)bstr+=String.fromCharCode(out[i]);return opts.type=="base64"?Base64.encode(bstr):bstr;case"file":return _fs.writeFileSync(opts.file,out);case"buffer":return out;default:throw new Error("Unrecognized type "+opts.type);}}function writeSync(wb,opts){check_wb(wb);var o=opts||{};switch(o.bookType||"xlsb"){case"xml":;case"xlml":return write_string_type(write_xlml(wb,o),o);case"slk":;case"sylk":return write_string_type(write_slk_str(wb,o),o);case"html":return write_string_type(write_htm_str(wb,o),o);case"txt":return write_bstr_type(write_txt_str(wb,o),o);case"csv":return write_string_type(write_csv_str(wb,o),o);case"dif":return write_string_type(write_dif_str(wb,o),o);case"prn":return write_string_type(write_prn_str(wb,o),o);case"fods":return write_string_type(write_ods(wb,o),o);case"biff2":return write_binary_type(write_biff_buf(wb,o),o);case"xlsx":;case"xlsm":;case"xlsb":;case"ods":return write_zip_type(wb,o);default:throw new Error("Unrecognized bookType |"+o.bookType+"|");}}function resolve_book_type(o){if(!o.bookType)switch(o.file.slice(o.file.lastIndexOf(".")).toLowerCase()){case".xlsx":o.bookType="xlsx";break;case".xlsm":o.bookType="xlsm";break;case".xlsb":o.bookType="xlsb";break;case".fods":o.bookType="fods";break;case".xlml":o.bookType="xlml";break;case".sylk":o.bookType="sylk";break;case".html":o.bookType="html";break;case".xls":o.bookType="biff2";break;case".xml":o.bookType="xml";break;case".ods":o.bookType="ods";break;case".csv":o.bookType="csv";break;case".txt":o.bookType="txt";break;case".dif":o.bookType="dif";break;case".prn":o.bookType="prn";break;case".slk":o.bookType="sylk";break;case".htm":o.bookType="html";break;}}function writeFileSync(wb,filename,opts){var o=opts||{};o.type="file";o.file=filename;resolve_book_type(o);return writeSync(wb,o)}function writeFileAsync(filename,wb,opts,cb){var o=opts||{};o.type="file";o.file=filename;resolve_book_type(o);o.type="buffer";var _cb=cb;if(!(_cb instanceof Function))_cb=opts;return _fs.writeFile(filename,writeSync(wb,o),_cb)}function sheet_to_json(sheet,opts){if(sheet==null||sheet["!ref"]==null)return[];var val={t:"n",v:0},header=0,offset=1,hdr=[],isempty=true,v=0,vv="";var r={s:{r:0,c:0},e:{r:0,c:0}};var o=opts!=null?opts:{};var raw=o.raw;var defval=o.defval;var range=o.range!=null?o.range:sheet["!ref"];if(o.header===1)header=1;else if(o.header==="A")header=2;else if(Array.isArray(o.header))header=3;switch(typeof range){case"string":r=safe_decode_range(range);break;case"number":r=safe_decode_range(sheet["!ref"]);r.s.r=range;break;default:r=range;}if(header>0)offset=0;var rr=encode_row(r.s.r);var cols=new Array(r.e.c-r.s.c+1);var out=new Array(r.e.r-r.s.r-offset+1);var outi=0,counter=0;var dense=Array.isArray(sheet);var R=r.s.r,C=0,CC=0;if(dense&&!sheet[R])sheet[R]=[];for(C=r.s.c;C<=r.e.c;++C){cols[C]=encode_col(C);val=dense?sheet[R][C]:sheet[cols[C]+rr];switch(header){case 1:hdr[C]=C-r.s.c;break;case 2:hdr[C]=cols[C];break;case 3:hdr[C]=o.header[C-r.s.c];break;default:if(val==null)continue;vv=v=format_cell(val,null,o);counter=0;for(CC=0;CC<hdr.length;++CC)if(hdr[CC]==vv)vv=v+"_"+ ++counter;hdr[C]=vv;}}var row=header===1?[]:{};for(R=r.s.r+offset;R<=r.e.r;++R){rr=encode_row(R);isempty=true;if(header===1)row=[];else{row={};if(Object.defineProperty)try{Object.defineProperty(row,"__rowNum__",{value:R,enumerable:false})}catch(e){row.__rowNum__=R}else row.__rowNum__=R}if(!dense||sheet[R])for(C=r.s.c;C<=r.e.c;++C){val=dense?sheet[R][C]:sheet[cols[C]+rr];if(val===undefined||val.t===undefined){if(defval===undefined)continue;if(hdr[C]!=null){row[hdr[C]]=defval;isempty=false}continue}v=val.v;switch(val.t){case"z":if(v==null)break;continue;case"e":continue;case"s":;case"d":;case"b":;case"n":break;default:throw new Error("unrecognized type "+val.t);}if(hdr[C]!=null){if(v==null){if(defval!==undefined)row[hdr[C]]=defval;else if(raw&&v===null)row[hdr[C]]=null;else continue}else{row[hdr[C]]=raw?v:format_cell(val,v,o)}isempty=false}}if(isempty===false||(header===1?o.blankrows!==false:!!o.blankrows))out[outi++]=row}out.length=outi;return out}var qreg=/"/g;function make_csv_row(sheet,r,R,cols,fs,rs,FS,o){var isempty=true;var row="",txt="",rr=encode_row(R);for(var C=r.s.c;C<=r.e.c;++C){var val=o.dense?(sheet[R]||[])[C]:sheet[cols[C]+rr];if(val==null)txt="";else if(val.v!=null){isempty=false;txt=""+format_cell(val,null,o);for(var i=0,cc=0;i!==txt.length;++i)if((cc=txt.charCodeAt(i))===fs||cc===rs||cc===34){txt='"'+txt.replace(qreg,'""')+'"';break}if(txt=="ID")txt='"ID"'}else if(val.f!=null&&!val.F){isempty=false;txt="="+val.f;if(txt.indexOf(",")>=0)txt='"'+txt.replace(qreg,'""')+'"'}else txt="";row+=(C===r.s.c?"":FS)+txt}if(o.blankrows===false&&isempty)return null;return row}function sheet_to_csv(sheet,opts){var out=[];var o=opts==null?{}:opts;if(sheet==null||sheet["!ref"]==null)return"";var r=safe_decode_range(sheet["!ref"]);var FS=o.FS!==undefined?o.FS:",",fs=FS.charCodeAt(0);var RS=o.RS!==undefined?o.RS:"\n",rs=RS.charCodeAt(0);var endregex=new RegExp((FS=="|"?"\\|":FS)+"+$");var row="",cols=[];o.dense=Array.isArray(sheet);for(var C=r.s.c;C<=r.e.c;++C)cols[C]=encode_col(C);for(var R=r.s.r;R<=r.e.r;++R){row=make_csv_row(sheet,r,R,cols,fs,rs,FS,o);if(row==null){continue}if(o.strip)row=row.replace(endregex,"");out.push(row+RS)}delete o.dense;return out.join("")}function sheet_to_txt(sheet,opts){if(!opts)opts={};opts.FS="\t";opts.RS="\n";var s=sheet_to_csv(sheet,opts);if(typeof cptable=="undefined")return s;var o=cptable.utils.encode(1200,s);return"ÿþ"+o}function sheet_to_formulae(sheet){var y="",x,val="";if(sheet==null||sheet["!ref"]==null)return[];var r=safe_decode_range(sheet["!ref"]),rr="",cols=[],C;var cmds=[];var dense=Array.isArray(sheet);for(C=r.s.c;C<=r.e.c;++C)cols[C]=encode_col(C);for(var R=r.s.r;R<=r.e.r;++R){rr=encode_row(R);for(C=r.s.c;C<=r.e.c;++C){y=cols[C]+rr;x=dense?(sheet[R]||[])[C]:sheet[y];val="";if(x===undefined)continue;else if(x.F!=null){y=x.F;if(!x.f)continue;val=x.f;if(y.indexOf(":")==-1)y=y+":"+y}if(x.f!=null)val=x.f;else if(x.t=="z")continue;else if(x.t=="n"&&x.v!=null)val=""+x.v;else if(x.t=="b")val=x.v?"TRUE":"FALSE";else if(x.w!==undefined)val="'"+x.w;else if(x.v===undefined)continue;else if(x.t=="s")val="'"+x.v;else val=""+x.v;cmds[cmds.length]=y+"="+val}}return cmds}function json_to_sheet(js,opts){var o=opts||{};var ws={};var cell;var range={s:{c:0,r:0},e:{c:0,r:js.length}};var hdr=o.header||[],C=0;for(var R=0;R!=js.length;++R){Object.keys(js[R]).filter(function(x){return js[R].hasOwnProperty(x)}).forEach(function(k){if((C=hdr.indexOf(k))==-1)hdr[C=hdr.length]=k;var v=js[R][k];var t="z";var z="";if(typeof v=="number")t="n";else if(typeof v=="boolean")t="b";else if(typeof v=="string")t="s";else if(v instanceof Date){t="d";if(!o.cellDates){t="n";v=datenum(v)}z=o.dateNF||SSF._table[14]}ws[encode_cell({c:C,r:R+1})]=cell={t:t,v:v};if(z)cell.z=z})}range.e.c=hdr.length-1;for(C=0;C<hdr.length;++C)ws[encode_col(C)+"1"]={t:"s",v:hdr[C]};ws["!ref"]=encode_range(range);return ws}var utils={encode_col:encode_col,encode_row:encode_row,encode_cell:encode_cell,encode_range:encode_range,decode_col:decode_col,decode_row:decode_row,split_cell:split_cell,decode_cell:decode_cell,decode_range:decode_range,format_cell:format_cell,get_formulae:sheet_to_formulae,make_csv:sheet_to_csv,make_json:sheet_to_json,make_formulae:sheet_to_formulae,aoa_to_sheet:aoa_to_sheet,json_to_sheet:json_to_sheet,table_to_sheet:parse_dom_table,table_to_book:table_to_book,sheet_to_csv:sheet_to_csv,sheet_to_json:sheet_to_json,sheet_to_html:HTML_.from_sheet,sheet_to_formulae:sheet_to_formulae,sheet_to_row_object_array:sheet_to_json};(function(utils){utils.consts=utils.consts||{};function add_consts(R){R.forEach(function(a){utils.consts[a[0]]=a[1]})}function get_default(x,y,z){return x[y]!=null?x[y]:x[y]=z}function ws_get_cell_stub(ws,R,C){if(typeof R=="string")return ws[R]||(ws[R]={t:"z"});if(typeof R!="number")return ws_get_cell_stub(ws,encode_cell(R));return ws_get_cell_stub(ws,encode_cell({r:R,c:C||0}))}function wb_sheet_idx(wb,sh){if(typeof sh=="number"){if(sh>=0&&wb.SheetNames.length>sh)return sh;throw new Error("Cannot find sheet # "+sh)}else if(typeof sh=="string"){var idx=wb.SheetNames.indexOf(sh);if(idx>-1)return idx;throw new Error("Cannot find sheet name |"+sh+"|")}else throw new Error("Cannot find sheet |"+sh+"|")}utils.book_new=function(){return{SheetNames:[],Sheets:{}}};utils.book_append_sheet=function(wb,ws,name){if(!name)for(var i=1;i<=65535;++i)if(wb.SheetNames.indexOf(name="Sheet"+i)==-1)break;if(!name)throw new Error("Too many worksheets");check_ws_name(name);if(wb.SheetNames.indexOf(name)>=0)throw new Error("Worksheet with name |"+name+"| already exists!");wb.SheetNames.push(name);wb.Sheets[name]=ws};utils.book_set_sheet_visibility=function(wb,sh,vis){get_default(wb,"Workbook",{});get_default(wb.Workbook,"Sheets",[]);var idx=wb_sheet_idx(wb,sh);get_default(wb.Workbook.Sheets,idx,{});switch(vis){case 0:;case 1:;case 2:break;default:throw new Error("Bad sheet visibility setting "+vis);}wb.Workbook.Sheets[idx].Hidden=vis};add_consts([["SHEET_VISIBLE",0],["SHEET_HIDDEN",1],["SHEET_VERY_HIDDEN",2]]);utils.cell_set_number_format=function(cell,fmt){cell.z=fmt;return cell};utils.cell_set_hyperlink=function(cell,target,tooltip){if(!target){delete cell.l}else{cell.l={Target:target};if(tooltip)cell.l.Tooltip=tooltip}return cell};utils.cell_add_comment=function(cell,text,author){if(!cell.c)cell.c=[];cell.c.push({t:text,a:author||"SheetJS"})};utils.sheet_set_array_formula=function(ws,range,formula){var rng=typeof range!="string"?range:safe_decode_range(range);var rngstr=typeof range=="string"?range:encode_range(range);for(var R=rng.s.r;R<=rng.e.r;++R)for(var C=rng.s.c;C<=rng.e.c;++C){var cell=ws_get_cell_stub(ws,R,C);cell.t="n";cell.F=rngstr;delete cell.v;if(R==rng.s.r&&C==rng.s.c)cell.f=formula}return ws};return utils})(utils);if(has_buf&&typeof require!="undefined")(function(){var Readable=require("stream").Readable;var write_csv_stream=function(sheet,opts){var stream=Readable();var out="";var o=opts==null?{}:opts;if(sheet==null||sheet["!ref"]==null){stream.push(null);return stream}var r=safe_decode_range(sheet["!ref"]);var FS=o.FS!==undefined?o.FS:",",fs=FS.charCodeAt(0);var RS=o.RS!==undefined?o.RS:"\n",rs=RS.charCodeAt(0);var endregex=new RegExp((FS=="|"?"\\|":FS)+"+$");var row="",cols=[];o.dense=Array.isArray(sheet);for(var C=r.s.c;C<=r.e.c;++C)cols[C]=encode_col(C);var R=r.s.r;stream._read=function(){if(R>r.e.r)return stream.push(null);while(R<=r.e.r){row=make_csv_row(sheet,r,R,cols,fs,rs,FS,o);++R;if(row!=null){if(o.strip)row=row.replace(endregex,"");stream.push(row+RS);break}}};return stream};var write_html_stream=function(ws,opts){var stream=Readable();var o=opts||{};var header=o.header!=null?o.header:HTML_.BEGIN;var footer=o.footer!=null?o.footer:HTML_.END;stream.push(header);var r=decode_range(ws["!ref"]);o.dense=Array.isArray(ws);stream.push(HTML_._preamble(ws,r,o));var R=r.s.r;var end=false;stream._read=function(){if(R>r.e.r){if(!end){end=true;stream.push("</table>"+footer)}return stream.push(null)}while(R<=r.e.r){stream.push(HTML_._row(ws,r,R,o));++R;break}};return stream};XLSX.stream={to_html:write_html_stream,to_csv:write_csv_stream}})();XLSX.parse_xlscfb=parse_xlscfb;XLSX.parse_ods=parse_ods;XLSX.parse_fods=parse_fods;XLSX.write_ods=write_ods;XLSX.parse_zip=parse_zip;XLSX.read=readSync;XLSX.readFile=readFileSync;XLSX.readFileSync=readFileSync;XLSX.write=writeSync;XLSX.writeFile=writeFileSync;XLSX.writeFileSync=writeFileSync;XLSX.writeFileAsync=writeFileAsync;XLSX.utils=utils;XLSX.SSF=SSF})(typeof exports!=="undefined"?exports:XLSX);var XLS=XLSX;var ODS=XLSX;;

/* /muk_web_preview_msoffice/static/lib/handsontable/handsontable.js defined in bundle 'web.assets_backend' */
(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory(require("moment"),require("numbro"),require("pikaday"));else if(typeof define==='function'&&define.amd)
define("Handsontable",["moment","numbro","pikaday"],factory);else if(typeof exports==='object')
exports["Handsontable"]=factory(require("moment"),require("numbro"),require("pikaday"));else
root["Handsontable"]=factory(root["moment"],root["numbro"],root["Pikaday"]);})(this,function(__WEBPACK_EXTERNAL_MODULE_61__,__WEBPACK_EXTERNAL_MODULE_87__,__WEBPACK_EXTERNAL_MODULE_302__){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports;}
var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value;};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter});}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default'];}:function getModuleExports(){return module;};__webpack_require__.d(getter,'a',getter);return getter;};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=208);})
([(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.HTML_CHARACTERS=undefined;exports.getParent=getParent;exports.closest=closest;exports.closestDown=closestDown;exports.isChildOf=isChildOf;exports.isChildOfWebComponentTable=isChildOfWebComponentTable;exports.polymerWrap=polymerWrap;exports.polymerUnwrap=polymerUnwrap;exports.index=index;exports.overlayContainsElement=overlayContainsElement;exports.hasClass=hasClass;exports.addClass=addClass;exports.removeClass=removeClass;exports.removeTextNodes=removeTextNodes;exports.empty=empty;exports.fastInnerHTML=fastInnerHTML;exports.fastInnerText=fastInnerText;exports.isVisible=isVisible;exports.offset=offset;exports.getWindowScrollTop=getWindowScrollTop;exports.getWindowScrollLeft=getWindowScrollLeft;exports.getScrollTop=getScrollTop;exports.getScrollLeft=getScrollLeft;exports.getScrollableElement=getScrollableElement;exports.getTrimmingContainer=getTrimmingContainer;exports.getStyle=getStyle;exports.getComputedStyle=getComputedStyle;exports.outerWidth=outerWidth;exports.outerHeight=outerHeight;exports.innerHeight=innerHeight;exports.innerWidth=innerWidth;exports.addEvent=addEvent;exports.removeEvent=removeEvent;exports.getCaretPosition=getCaretPosition;exports.getSelectionEndPosition=getSelectionEndPosition;exports.getSelectionText=getSelectionText;exports.setCaretPosition=setCaretPosition;exports.getScrollbarWidth=getScrollbarWidth;exports.hasVerticalScrollbar=hasVerticalScrollbar;exports.hasHorizontalScrollbar=hasHorizontalScrollbar;exports.setOverlayPosition=setOverlayPosition;exports.getCssTransform=getCssTransform;exports.resetCssTransform=resetCssTransform;exports.isInput=isInput;exports.isOutsideInput=isOutsideInput;var _browser=__webpack_require__(25);var _feature=__webpack_require__(34);function getParent(element){var level=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var iteration=-1;var parent=null;while(element!=null){if(iteration===level){parent=element;break;}
if(element.host&&element.nodeType===Node.DOCUMENT_FRAGMENT_NODE){element=element.host;}else{iteration++;element=element.parentNode;}}
return parent;}
function closest(element,nodes,until){while(element!=null&&element!==until){if(element.nodeType===Node.ELEMENT_NODE&&(nodes.indexOf(element.nodeName)>-1||nodes.indexOf(element)>-1)){return element;}
if(element.host&&element.nodeType===Node.DOCUMENT_FRAGMENT_NODE){element=element.host;}else{element=element.parentNode;}}
return null;}
function closestDown(element,nodes,until){var matched=[];while(element){element=closest(element,nodes,until);if(!element||until&&!until.contains(element)){break;}
matched.push(element);if(element.host&&element.nodeType===Node.DOCUMENT_FRAGMENT_NODE){element=element.host;}else{element=element.parentNode;}}
var length=matched.length;return length?matched[length-1]:null;}
function isChildOf(child,parent){var node=child.parentNode;var queriedParents=[];if(typeof parent==='string'){queriedParents=Array.prototype.slice.call(document.querySelectorAll(parent),0);}else{queriedParents.push(parent);}
while(node!=null){if(queriedParents.indexOf(node)>-1){return true;}
node=node.parentNode;}
return false;}
function isChildOfWebComponentTable(element){var hotTableName='hot-table',result=false,parentNode;parentNode=polymerWrap(element);function isHotTable(element){return element.nodeType===Node.ELEMENT_NODE&&element.nodeName===hotTableName.toUpperCase();}
while(parentNode!=null){if(isHotTable(parentNode)){result=true;break;}else if(parentNode.host&&parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){result=isHotTable(parentNode.host);if(result){break;}
parentNode=parentNode.host;}
parentNode=parentNode.parentNode;}
return result;}
function polymerWrap(element){return typeof Polymer!=='undefined'&&typeof wrap==='function'?wrap(element):element;}
function polymerUnwrap(element){return typeof Polymer!=='undefined'&&typeof unwrap==='function'?unwrap(element):element;}
function index(element){var i=0;if(element.previousSibling){while(element=element.previousSibling){++i;}}
return i;}
function overlayContainsElement(overlayType,element){var overlayElement=document.querySelector('.ht_clone_'+overlayType);return overlayElement?overlayElement.contains(element):null;}
var classListSupport=!!document.documentElement.classList;var _hasClass,_addClass,_removeClass;function filterEmptyClassNames(classNames){var len=0,result=[];if(!classNames||!classNames.length){return result;}
while(classNames[len]){result.push(classNames[len]);len++;}
return result;}
if(classListSupport){var isSupportMultipleClassesArg=function(){var element=document.createElement('div');element.classList.add('test','test2');return element.classList.contains('test2');}();_hasClass=function _hasClass(element,className){if(className===''){return false;}
return element.classList.contains(className);};_addClass=function _addClass(element,className){var len=0;if(typeof className==='string'){className=className.split(' ');}
className=filterEmptyClassNames(className);if(isSupportMultipleClassesArg){element.classList.add.apply(element.classList,className);}else{while(className&&className[len]){element.classList.add(className[len]);len++;}}};_removeClass=function _removeClass(element,className){var len=0;if(typeof className==='string'){className=className.split(' ');}
className=filterEmptyClassNames(className);if(isSupportMultipleClassesArg){element.classList.remove.apply(element.classList,className);}else{while(className&&className[len]){element.classList.remove(className[len]);len++;}}};}else{var createClassNameRegExp=function createClassNameRegExp(className){return new RegExp('(\\s|^)'+className+'(\\s|$)');};_hasClass=function _hasClass(element,className){return!!element.className.match(createClassNameRegExp(className));};_addClass=function _addClass(element,className){var len=0,_className=element.className;if(typeof className==='string'){className=className.split(' ');}
if(_className===''){_className=className.join(' ');}else{while(className&&className[len]){if(!createClassNameRegExp(className[len]).test(_className)){_className+=' '+className[len];}
len++;}}
element.className=_className;};_removeClass=function _removeClass(element,className){var len=0,_className=element.className;if(typeof className==='string'){className=className.split(' ');}
while(className&&className[len]){_className=_className.replace(createClassNameRegExp(className[len]),' ').trim();len++;}
if(element.className!==_className){element.className=_className;}};}
function hasClass(element,className){return _hasClass(element,className);}
function addClass(element,className){return _addClass(element,className);}
function removeClass(element,className){return _removeClass(element,className);}
function removeTextNodes(element,parent){if(element.nodeType===3){parent.removeChild(element);}else if(['TABLE','THEAD','TBODY','TFOOT','TR'].indexOf(element.nodeName)>-1){var childs=element.childNodes;for(var i=childs.length-1;i>=0;i--){removeTextNodes(childs[i],element);}}}
function empty(element){var child;while(child=element.lastChild){element.removeChild(child);}}
var HTML_CHARACTERS=exports.HTML_CHARACTERS=/(<(.*)>|&(.*);)/;function fastInnerHTML(element,content){if(HTML_CHARACTERS.test(content)){element.innerHTML=content;}else{fastInnerText(element,content);}}
var textContextSupport=!!document.createTextNode('test').textContent;function fastInnerText(element,content){var child=element.firstChild;if(child&&child.nodeType===3&&child.nextSibling===null){if(textContextSupport){child.textContent=content;}else{child.data=content;}}else{empty(element);element.appendChild(document.createTextNode(content));}}
function isVisible(elem){var next=elem;while(polymerUnwrap(next)!==document.documentElement){if(next===null){return false;}else if(next.nodeType===Node.DOCUMENT_FRAGMENT_NODE){if(next.host){if(next.host.impl){return isVisible(next.host.impl);}else if(next.host){return isVisible(next.host);}
throw new Error('Lost in Web Components world');}else{return false;}}else if(next.style.display==='none'){return false;}
next=next.parentNode;}
return true;}
function offset(elem){var offsetLeft,offsetTop,lastElem,docElem,box;docElem=document.documentElement;if((0,_feature.hasCaptionProblem)()&&elem.firstChild&&elem.firstChild.nodeName==='CAPTION'){box=elem.getBoundingClientRect();return{top:box.top+(window.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(window.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)};}
offsetLeft=elem.offsetLeft;offsetTop=elem.offsetTop;lastElem=elem;while(elem=elem.offsetParent){if(elem===document.body){break;}
offsetLeft+=elem.offsetLeft;offsetTop+=elem.offsetTop;lastElem=elem;}
if(lastElem&&lastElem.style.position==='fixed'){offsetLeft+=window.pageXOffset||docElem.scrollLeft;offsetTop+=window.pageYOffset||docElem.scrollTop;}
return{left:offsetLeft,top:offsetTop};}
function getWindowScrollTop(){var res=window.scrollY;if(res===void 0){res=document.documentElement.scrollTop;}
return res;}
function getWindowScrollLeft(){var res=window.scrollX;if(res===void 0){res=document.documentElement.scrollLeft;}
return res;}
function getScrollTop(element){if(element===window){return getWindowScrollTop();}
return element.scrollTop;}
function getScrollLeft(element){if(element===window){return getWindowScrollLeft();}
return element.scrollLeft;}
function getScrollableElement(element){var el=element.parentNode,props=['auto','scroll'],overflow,overflowX,overflowY,computedStyle='',computedOverflow='',computedOverflowY='',computedOverflowX='';while(el&&el.style&&document.body!==el){overflow=el.style.overflow;overflowX=el.style.overflowX;overflowY=el.style.overflowY;if(overflow=='scroll'||overflowX=='scroll'||overflowY=='scroll'){return el;}else if(window.getComputedStyle){computedStyle=window.getComputedStyle(el);computedOverflow=computedStyle.getPropertyValue('overflow');computedOverflowY=computedStyle.getPropertyValue('overflow-y');computedOverflowX=computedStyle.getPropertyValue('overflow-x');if(computedOverflow==='scroll'||computedOverflowX==='scroll'||computedOverflowY==='scroll'){return el;}}
if(el.clientHeight<=el.scrollHeight&&(props.indexOf(overflowY)!==-1||props.indexOf(overflow)!==-1||props.indexOf(computedOverflow)!==-1||props.indexOf(computedOverflowY)!==-1)){return el;}
if(el.clientWidth<=el.scrollWidth&&(props.indexOf(overflowX)!==-1||props.indexOf(overflow)!==-1||props.indexOf(computedOverflow)!==-1||props.indexOf(computedOverflowX)!==-1)){return el;}
el=el.parentNode;}
return window;}
function getTrimmingContainer(base){var el=base.parentNode;while(el&&el.style&&document.body!==el){if(el.style.overflow!=='visible'&&el.style.overflow!==''){return el;}else if(window.getComputedStyle){var computedStyle=window.getComputedStyle(el);if(computedStyle.getPropertyValue('overflow')!=='visible'&&computedStyle.getPropertyValue('overflow')!==''){return el;}}
el=el.parentNode;}
return window;}
function getStyle(element,prop){if(!element){return;}else if(element===window){if(prop==='width'){return window.innerWidth+'px';}else if(prop==='height'){return window.innerHeight+'px';}
return;}
var styleProp=element.style[prop],computedStyle;if(styleProp!==''&&styleProp!==void 0){return styleProp;}else{computedStyle=getComputedStyle(element);if(computedStyle[prop]!==''&&computedStyle[prop]!==void 0){return computedStyle[prop];}}}
function getComputedStyle(element){return element.currentStyle||document.defaultView.getComputedStyle(element);}
function outerWidth(element){return element.offsetWidth;}
function outerHeight(elem){if((0,_feature.hasCaptionProblem)()&&elem.firstChild&&elem.firstChild.nodeName==='CAPTION'){return elem.offsetHeight+elem.firstChild.offsetHeight;}
return elem.offsetHeight;}
function innerHeight(element){return element.clientHeight||element.innerHeight;}
function innerWidth(element){return element.clientWidth||element.innerWidth;}
function addEvent(element,event,callback){if(window.addEventListener){element.addEventListener(event,callback,false);}else{element.attachEvent('on'+event,callback);}}
function removeEvent(element,event,callback){if(window.removeEventListener){element.removeEventListener(event,callback,false);}else{element.detachEvent('on'+event,callback);}}
function getCaretPosition(el){if(el.selectionStart){return el.selectionStart;}else if(document.selection){el.focus();var r=document.selection.createRange();if(r==null){return 0;}
var re=el.createTextRange();var rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint('EndToStart',re);return rc.text.length;}
return 0;}
function getSelectionEndPosition(el){if(el.selectionEnd){return el.selectionEnd;}else if(document.selection){var r=document.selection.createRange();if(r==null){return 0;}
var re=el.createTextRange();return re.text.indexOf(r.text)+r.text.length;}
return 0;}
function getSelectionText(){var text='';if(window.getSelection){text=window.getSelection().toString();}else if(document.selection&&document.selection.type!=='Control'){text=document.selection.createRange().text;}
return text;}
function setCaretPosition(element,pos,endPos){if(endPos===void 0){endPos=pos;}
if(element.setSelectionRange){element.focus();try{element.setSelectionRange(pos,endPos);}catch(err){var elementParent=element.parentNode;var parentDisplayValue=elementParent.style.display;elementParent.style.display='block';element.setSelectionRange(pos,endPos);elementParent.style.display=parentDisplayValue;}}else if(element.createTextRange){var range=element.createTextRange();range.collapse(true);range.moveEnd('character',endPos);range.moveStart('character',pos);range.select();}}
var cachedScrollbarWidth;function walkontableCalculateScrollbarWidth(){var inner=document.createElement('div');inner.style.height='200px';inner.style.width='100%';var outer=document.createElement('div');outer.style.boxSizing='content-box';outer.style.height='150px';outer.style.left='0px';outer.style.overflow='hidden';outer.style.position='absolute';outer.style.top='0px';outer.style.width='200px';outer.style.visibility='hidden';outer.appendChild(inner);(document.body||document.documentElement).appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow='scroll';var w2=inner.offsetWidth;if(w1==w2){w2=outer.clientWidth;}
(document.body||document.documentElement).removeChild(outer);return w1-w2;}
function getScrollbarWidth(){if(cachedScrollbarWidth===void 0){cachedScrollbarWidth=walkontableCalculateScrollbarWidth();}
return cachedScrollbarWidth;}
function hasVerticalScrollbar(element){return element.offsetWidth!==element.clientWidth;}
function hasHorizontalScrollbar(element){return element.offsetHeight!==element.clientHeight;}
function setOverlayPosition(overlayElem,left,top){if((0,_browser.isIE8)()||(0,_browser.isIE9)()){overlayElem.style.top=top;overlayElem.style.left=left;}else if((0,_browser.isSafari)()){overlayElem.style['-webkit-transform']='translate3d('+left+','+top+',0)';}else{overlayElem.style.transform='translate3d('+left+','+top+',0)';}}
function getCssTransform(element){var transform;if(element.style.transform&&(transform=element.style.transform)!==''){return['transform',transform];}else if(element.style['-webkit-transform']&&(transform=element.style['-webkit-transform'])!==''){return['-webkit-transform',transform];}
return-1;}
function resetCssTransform(element){if(element.style.transform&&element.style.transform!==''){element.style.transform='';}else if(element.style['-webkit-transform']&&element.style['-webkit-transform']!==''){element.style['-webkit-transform']='';}}
function isInput(element){var inputs=['INPUT','SELECT','TEXTAREA'];return element&&(inputs.indexOf(element.nodeName)>-1||element.contentEditable==='true');}
function isOutsideInput(element){return isInput(element)&&element.className.indexOf('handsontableInput')==-1&&element.className.indexOf('copyPaste')==-1;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.duckSchema=duckSchema;exports.inherit=inherit;exports.extend=extend;exports.deepExtend=deepExtend;exports.deepClone=deepClone;exports.clone=clone;exports.mixin=mixin;exports.isObjectEquals=isObjectEquals;exports.isObject=isObject;exports.defineGetter=defineGetter;exports.objectEach=objectEach;exports.getProperty=getProperty;exports.deepObjectSize=deepObjectSize;exports.createObjectPropListener=createObjectPropListener;exports.hasOwnProperty=hasOwnProperty;var _array=__webpack_require__(2);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}
function duckSchema(object){var schema;if(Array.isArray(object)){schema=[];}else{schema={};objectEach(object,function(value,key){if(key==='__children'){return;}
if(value&&(typeof value==='undefined'?'undefined':_typeof(value))==='object'&&!Array.isArray(value)){schema[key]=duckSchema(value);}else if(Array.isArray(value)){if(value.length&&_typeof(value[0])==='object'&&!Array.isArray(value[0])){schema[key]=[duckSchema(value[0])];}else{schema[key]=[];}}else{schema[key]=null;}});}
return schema;}
function inherit(Child,Parent){Parent.prototype.constructor=Parent;Child.prototype=new Parent();Child.prototype.constructor=Child;return Child;}
function extend(target,extension){objectEach(extension,function(value,key){target[key]=value;});return target;}
function deepExtend(target,extension){objectEach(extension,function(value,key){if(extension[key]&&_typeof(extension[key])==='object'){if(!target[key]){if(Array.isArray(extension[key])){target[key]=[];}else if(Object.prototype.toString.call(extension[key])==='[object Date]'){target[key]=extension[key];}else{target[key]={};}}
deepExtend(target[key],extension[key]);}else{target[key]=extension[key];}});}
function deepClone(obj){if((typeof obj==='undefined'?'undefined':_typeof(obj))==='object'){return JSON.parse(JSON.stringify(obj));}
return obj;}
function clone(object){var result={};objectEach(object,function(value,key){result[key]=value;});return result;}
function mixin(Base){if(!Base.MIXINS){Base.MIXINS=[];}
for(var _len=arguments.length,mixins=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){mixins[_key-1]=arguments[_key];}
(0,_array.arrayEach)(mixins,function(mixin){Base.MIXINS.push(mixin.MIXIN_NAME);objectEach(mixin,function(value,key){if(Base.prototype[key]!==void 0){throw new Error('Mixin conflict. Property \''+key+'\' already exist and cannot be overwritten.');}
if(typeof value==='function'){Base.prototype[key]=value;}else{var getter=function _getter(propertyName,initialValue){propertyName='_'+propertyName;var initValue=function initValue(value){if(Array.isArray(value)||isObject(value)){value=deepClone(value);}
return value;};return function(){if(this[propertyName]===void 0){this[propertyName]=initValue(initialValue);}
return this[propertyName];};};var setter=function _setter(propertyName){propertyName='_'+propertyName;return function(value){this[propertyName]=value;};};Object.defineProperty(Base.prototype,key,{get:getter(key,value),set:setter(key),configurable:true});}});});return Base;}
function isObjectEquals(object1,object2){return JSON.stringify(object1)===JSON.stringify(object2);}
function isObject(obj){return Object.prototype.toString.call(obj)=='[object Object]';}
function defineGetter(object,property,value,options){options.value=value;options.writable=options.writable!==false;options.enumerable=options.enumerable!==false;options.configurable=options.configurable!==false;Object.defineProperty(object,property,options);}
function objectEach(object,iteratee){for(var key in object){if(!object.hasOwnProperty||object.hasOwnProperty&&Object.prototype.hasOwnProperty.call(object,key)){if(iteratee(object[key],key,object)===false){break;}}}
return object;}
function getProperty(object,name){var names=name.split('.');var result=object;objectEach(names,function(name){result=result[name];if(result===void 0){result=void 0;return false;}});return result;}
function deepObjectSize(object){if(!isObject(object)){return 0;}
var recursObjLen=function recursObjLen(obj){var result=0;if(isObject(obj)){objectEach(obj,function(key){result+=recursObjLen(key);});}else{result++;}
return result;};return recursObjLen(object);}
function createObjectPropListener(defaultValue){var _holder;var propertyToListen=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'value';var privateProperty='_'+propertyToListen;var holder=(_holder={_touched:false},_defineProperty(_holder,privateProperty,defaultValue),_defineProperty(_holder,'isTouched',function isTouched(){return this._touched;}),_holder);Object.defineProperty(holder,propertyToListen,{get:function get(){return this[privateProperty];},set:function set(value){this._touched=true;this[privateProperty]=value;},enumerable:true,configurable:true});return holder;}
function hasOwnProperty(object,key){return Object.prototype.hasOwnProperty.call(object,key);}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.to2dArray=to2dArray;exports.extendArray=extendArray;exports.pivot=pivot;exports.arrayReduce=arrayReduce;exports.arrayFilter=arrayFilter;exports.arrayMap=arrayMap;exports.arrayEach=arrayEach;exports.arraySum=arraySum;exports.arrayMax=arrayMax;exports.arrayMin=arrayMin;exports.arrayAvg=arrayAvg;exports.arrayFlatten=arrayFlatten;exports.arrayUnique=arrayUnique;function to2dArray(arr){var i=0,ilen=arr.length;while(i<ilen){arr[i]=[arr[i]];i++;}}
function extendArray(arr,extension){var i=0,ilen=extension.length;while(i<ilen){arr.push(extension[i]);i++;}}
function pivot(arr){var pivotedArr=[];if(!arr||arr.length===0||!arr[0]||arr[0].length===0){return pivotedArr;}
var rowCount=arr.length;var colCount=arr[0].length;for(var i=0;i<rowCount;i++){for(var j=0;j<colCount;j++){if(!pivotedArr[j]){pivotedArr[j]=[];}
pivotedArr[j][i]=arr[i][j];}}
return pivotedArr;}
function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index];}
while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}
return accumulator;}
function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value;}}
return result;}
function arrayMap(array,iteratee){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];result[++resIndex]=iteratee(value,index,array);}
return result;}
function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}
return array;}
function arraySum(array){return arrayReduce(array,function(a,b){return a+b;},0);}
function arrayMax(array){return arrayReduce(array,function(a,b){return a>b?a:b;},Array.isArray(array)?array[0]:void 0);}
function arrayMin(array){return arrayReduce(array,function(a,b){return a<b?a:b;},Array.isArray(array)?array[0]:void 0);}
function arrayAvg(array){if(!array.length){return 0;}
return arraySum(array)/array.length;}
function arrayFlatten(array){return arrayReduce(array,function(initial,value){return initial.concat(Array.isArray(value)?arrayFlatten(value):value);},[]);}
function arrayUnique(array){var unique=[];arrayEach(array,function(value){if(unique.indexOf(value)===-1){unique.push(value);}});return unique;}}),(function(module,exports,__webpack_require__){var global=__webpack_require__(13),core=__webpack_require__(44),hide=__webpack_require__(32),redefine=__webpack_require__(33),ctx=__webpack_require__(29),PROTOTYPE='prototype';var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={}),key,own,out,exp;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;out=(own?target:source)[key];exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&typeof out=='function'?ctx(Function.call,out):out;if(target)redefine(target,key,out,type&$export.U);if(exports[key]!=out)hide(exports,key,exp);if(IS_PROTO&&expProto[key]!=out)expProto[key]=out;}};global.core=core;$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;module.exports=$export;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();exports.getListenersCounter=getListenersCounter;var _element=__webpack_require__(0);var _feature=__webpack_require__(34);var _event=__webpack_require__(7);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var listenersCounter=0;var EventManager=function(){function EventManager(){var context=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,EventManager);this.context=context||this;if(!this.context.eventListeners){this.context.eventListeners=[];}}
_createClass(EventManager,[{key:'addEventListener',value:function addEventListener(element,eventName,callback){var _this=this;var context=this.context;function callbackProxy(event){event=extendEvent(context,event);callback.call(this,event);}
this.context.eventListeners.push({element:element,event:eventName,callback:callback,callbackProxy:callbackProxy});if(window.addEventListener){element.addEventListener(eventName,callbackProxy,false);}else{element.attachEvent('on'+eventName,callbackProxy);}
listenersCounter++;return function(){_this.removeEventListener(element,eventName,callback);};}},{key:'removeEventListener',value:function removeEventListener(element,eventName,callback){var len=this.context.eventListeners.length;var tmpEvent=void 0;while(len--){tmpEvent=this.context.eventListeners[len];if(tmpEvent.event==eventName&&tmpEvent.element==element){if(callback&&callback!=tmpEvent.callback){continue;}
this.context.eventListeners.splice(len,1);if(tmpEvent.element.removeEventListener){tmpEvent.element.removeEventListener(tmpEvent.event,tmpEvent.callbackProxy,false);}else{tmpEvent.element.detachEvent('on'+tmpEvent.event,tmpEvent.callbackProxy);}
listenersCounter--;}}}},{key:'clearEvents',value:function clearEvents(){if(!this.context){return;}
var len=this.context.eventListeners.length;while(len--){var event=this.context.eventListeners[len];if(event){this.removeEventListener(event.element,event.event,event.callback);}}}},{key:'clear',value:function clear(){this.clearEvents();}},{key:'destroy',value:function destroy(){this.clearEvents();this.context=null;}},{key:'fireEvent',value:function fireEvent(element,eventName){var options={bubbles:true,cancelable:eventName!=='mousemove',view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined};var event;if(document.createEvent){event=document.createEvent('MouseEvents');event.initMouseEvent(eventName,options.bubbles,options.cancelable,options.view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.button,options.relatedTarget||document.body.parentNode);}else{event=document.createEventObject();}
if(element.dispatchEvent){element.dispatchEvent(event);}else{element.fireEvent('on'+eventName,event);}}}]);return EventManager;}();function extendEvent(context,event){var componentName='HOT-TABLE';var isHotTableSpotted=void 0;var fromElement=void 0;var realTarget=void 0;var target=void 0;var len=void 0;var nativeStopImmediatePropagation=void 0;event.isTargetWebComponent=false;event.realTarget=event.target;nativeStopImmediatePropagation=event.stopImmediatePropagation;event.stopImmediatePropagation=function(){nativeStopImmediatePropagation.apply(this);(0,_event.stopImmediatePropagation)(this);};if(!EventManager.isHotTableEnv){return event;}
event=(0,_element.polymerWrap)(event);len=event.path?event.path.length:0;while(len--){if(event.path[len].nodeName===componentName){isHotTableSpotted=true;}else if(isHotTableSpotted&&event.path[len].shadowRoot){target=event.path[len];break;}
if(len===0&&!target){target=event.path[len];}}
if(!target){target=event.target;}
event.isTargetWebComponent=true;if((0,_feature.isWebComponentSupportedNatively)()){event.realTarget=event.srcElement||event.toElement;}else if(context instanceof Core||context instanceof Walkontable){if(context instanceof Core){fromElement=context.view?context.view.wt.wtTable.TABLE:null;}else if(context instanceof Walkontable){fromElement=context.wtTable.TABLE.parentNode.parentNode;}
realTarget=(0,_element.closest)(event.target,[componentName],fromElement);if(realTarget){event.realTarget=fromElement.querySelector(componentName)||event.target;}else{event.realTarget=event.target;}}
Object.defineProperty(event,'target',{get:function get(){return(0,_element.polymerWrap)(target);},enumerable:true,configurable:true});return event;}
exports.default=EventManager;function getListenersCounter(){return listenersCounter;};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getPluginName=exports.getRegistredPluginNames=exports.getPlugin=exports.registerPlugin=undefined;var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _object=__webpack_require__(1);var _string=__webpack_require__(27);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var registeredPlugins=new WeakMap();function registerPlugin(pluginName,PluginClass){pluginName=(0,_string.toUpperCaseFirst)(pluginName);_pluginHooks2.default.getSingleton().add('construct',function(){var holder=void 0;if(!registeredPlugins.has(this)){registeredPlugins.set(this,{});}
holder=registeredPlugins.get(this);if(!holder[pluginName]){holder[pluginName]=new PluginClass(this);}});_pluginHooks2.default.getSingleton().add('afterDestroy',function(){if(registeredPlugins.has(this)){var pluginsHolder=registeredPlugins.get(this);(0,_object.objectEach)(pluginsHolder,function(plugin){return plugin.destroy();});registeredPlugins.delete(this);}});}
function getPlugin(instance,pluginName){if(typeof pluginName!='string'){throw Error('Only strings can be passed as "plugin" parameter');}
var _pluginName=(0,_string.toUpperCaseFirst)(pluginName);if(!registeredPlugins.has(instance)||!registeredPlugins.get(instance)[_pluginName]){return void 0;}
return registeredPlugins.get(instance)[_pluginName];}
function getRegistredPluginNames(hotInstance){return registeredPlugins.has(hotInstance)?Object.keys(registeredPlugins.get(hotInstance)):[];}
function getPluginName(hotInstance,plugin){var pluginName=null;if(registeredPlugins.has(hotInstance)){(0,_object.objectEach)(registeredPlugins.get(hotInstance),function(pluginInstance,name){if(pluginInstance===plugin){pluginName=name;}});}
return pluginName;}
exports.registerPlugin=registerPlugin;exports.getPlugin=getPlugin;exports.getRegistredPluginNames=getRegistredPluginNames;exports.getPluginName=getPluginName;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.isNumeric=isNumeric;exports.rangeEach=rangeEach;exports.rangeEachReverse=rangeEachReverse;exports.valueAccordingPercent=valueAccordingPercent;function isNumeric(n){var t=typeof n==='undefined'?'undefined':_typeof(n);return t=='number'?!isNaN(n)&&isFinite(n):t=='string'?!n.length?false:n.length==1?/\d/.test(n):/^\s*[+-]?\s*(?:(?:\d+(?:\.\d+)?(?:e[+-]?\d+)?)|(?:0x[a-f\d]+))\s*$/i.test(n):t=='object'?!!n&&typeof n.valueOf()=='number'&&!(n instanceof Date):false;}
function rangeEach(rangeFrom,rangeTo,iteratee){var index=-1;if(typeof rangeTo==='function'){iteratee=rangeTo;rangeTo=rangeFrom;}else{index=rangeFrom-1;}
while(++index<=rangeTo){if(iteratee(index)===false){break;}}}
function rangeEachReverse(rangeFrom,rangeTo,iteratee){var index=rangeFrom+1;if(typeof rangeTo==='function'){iteratee=rangeTo;rangeTo=0;}
while(--index>=rangeTo){if(iteratee(index)===false){break;}}}
function valueAccordingPercent(value,percent){percent=parseInt(percent.toString().replace('%',''),10);percent=parseInt(value*percent/100,10);return percent;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.stopImmediatePropagation=stopImmediatePropagation;exports.isImmediatePropagationStopped=isImmediatePropagationStopped;exports.stopPropagation=stopPropagation;exports.pageX=pageX;exports.pageY=pageY;exports.isRightClick=isRightClick;exports.isLeftClick=isLeftClick;var _element=__webpack_require__(0);function stopImmediatePropagation(event){event.isImmediatePropagationEnabled=false;event.cancelBubble=true;}
function isImmediatePropagationStopped(event){return event.isImmediatePropagationEnabled===false;}
function stopPropagation(event){if(typeof event.stopPropagation==='function'){event.stopPropagation();}else{event.cancelBubble=true;}}
function pageX(event){if(event.pageX){return event.pageX;}
return event.clientX+(0,_element.getWindowScrollLeft)();}
function pageY(event){if(event.pageY){return event.pageY;}
return event.clientY+(0,_element.getWindowScrollTop)();}
function isRightClick(event){return event.button===2;}
function isLeftClick(event){return event.button===0;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _array=__webpack_require__(2);var _object=__webpack_require__(1);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var REGISTERED_HOOKS=['afterCellMetaReset','afterChange','afterChangesObserved','afterContextMenuDefaultOptions','beforeContextMenuSetItems','afterDropdownMenuDefaultOptions','beforeDropdownMenuSetItems','afterContextMenuHide','afterContextMenuShow','afterCopyLimit','beforeCreateCol','afterCreateCol','beforeCreateRow','afterCreateRow','afterDeselect','afterDestroy','afterDocumentKeyDown','afterGetCellMeta','afterGetColHeader','afterGetRowHeader','afterInit','afterLoadData','afterMomentumScroll','afterOnCellCornerMouseDown','afterOnCellCornerDblClick','afterOnCellMouseDown','afterOnCellMouseOver','afterOnCellMouseOut','afterRemoveCol','afterRemoveRow','afterRender','beforeRenderer','afterRenderer','afterScrollHorizontally','afterScrollVertically','afterSelection','afterSelectionByProp','afterSelectionEnd','afterSelectionEndByProp','afterSetCellMeta','afterRemoveCellMeta','afterSetDataAtCell','afterSetDataAtRowProp','afterUpdateSettings','afterValidate','beforeAutofill','beforeCellAlignment','beforeChange','beforeChangeRender','beforeDrawBorders','beforeGetCellMeta','beforeRemoveCellMeta','beforeInit','beforeInitWalkontable','beforeKeyDown','beforeOnCellMouseDown','beforeOnCellMouseOver','beforeOnCellMouseOut','beforeRemoveCol','beforeRemoveRow','beforeRender','beforeSetRangeStart','beforeSetRangeEnd','beforeTouchScroll','beforeValidate','beforeValueRender','construct','init','modifyCol','unmodifyCol','unmodifyRow','modifyColHeader','modifyColWidth','modifyRow','modifyRowHeader','modifyRowHeight','modifyData','modifyRowData','persistentStateLoad','persistentStateReset','persistentStateSave','beforeColumnSort','afterColumnSort','modifyAutofillRange','modifyCopyableRange','beforeCut','afterCut','beforeCopy','afterCopy','beforePaste','afterPaste','beforeColumnMove','afterColumnMove','beforeRowMove','afterRowMove','beforeColumnResize','afterColumnResize','beforeRowResize','afterRowResize','afterGetColumnHeaderRenderers','afterGetRowHeaderRenderers','beforeStretchingColumnWidth','beforeFilter','afterFilter','modifyColumnHeaderHeight','beforeUndo','afterUndo','beforeRedo','afterRedo','modifyRowHeaderWidth','beforeAutofillInsidePopulate','modifyTransformStart','modifyTransformEnd','afterModifyTransformStart','afterModifyTransformEnd','afterViewportRowCalculatorOverride','afterViewportColumnCalculatorOverride','afterPluginsInitialized','manualRowHeights','skipLengthCache','afterTrimRow','afterUntrimRow','afterDropdownMenuShow','afterDropdownMenuHide','hiddenRow','hiddenColumn','beforeAddChild','afterAddChild','beforeDetachChild','afterDetachChild','afterBeginEditing'];var Hooks=function(){_createClass(Hooks,null,[{key:'getSingleton',value:function getSingleton(){return globalSingleton;}}]);function Hooks(){_classCallCheck(this,Hooks);this.globalBucket=this.createEmptyBucket();}
_createClass(Hooks,[{key:'createEmptyBucket',value:function createEmptyBucket(){var bucket=Object.create(null);(0,_array.arrayEach)(REGISTERED_HOOKS,function(hook){return bucket[hook]=[];});return bucket;}},{key:'getBucket',value:function getBucket(){var context=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(context){if(!context.pluginHookBucket){context.pluginHookBucket=this.createEmptyBucket();}
return context.pluginHookBucket;}
return this.globalBucket;}},{key:'add',value:function add(key,callback){var _this=this;var context=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(Array.isArray(callback)){(0,_array.arrayEach)(callback,function(c){return _this.add(key,c,context);});}else{var bucket=this.getBucket(context);if(typeof bucket[key]==='undefined'){this.register(key);bucket[key]=[];}
callback.skip=false;if(bucket[key].indexOf(callback)===-1){var foundInitialHook=false;if(callback.initialHook){(0,_array.arrayEach)(bucket[key],function(cb,i){if(cb.initialHook){bucket[key][i]=callback;foundInitialHook=true;return false;}});}
if(!foundInitialHook){bucket[key].push(callback);}}}
return this;}},{key:'once',value:function once(key,callback){var _this2=this;var context=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(Array.isArray(callback)){(0,_array.arrayEach)(callback,function(c){return _this2.once(key,c,context);});}else{callback.runOnce=true;this.add(key,callback,context);}}},{key:'remove',value:function remove(key,callback){var context=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var bucket=this.getBucket(context);if(typeof bucket[key]!=='undefined'){if(bucket[key].indexOf(callback)>=0){callback.skip=true;return true;}}
return false;}},{key:'has',value:function has(key){var context=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var bucket=this.getBucket(context);return!!(bucket[key]!==void 0&&bucket[key].length);}},{key:'run',value:function run(context,key,p1,p2,p3,p4,p5,p6){{var globalHandlers=this.globalBucket[key];var index=-1;var length=globalHandlers?globalHandlers.length:0;if(length){while(++index<length){if(!globalHandlers[index]||globalHandlers[index].skip){continue;}
var res=globalHandlers[index].call(context,p1,p2,p3,p4,p5,p6);if(res!==void 0){p1=res;}
if(globalHandlers[index]&&globalHandlers[index].runOnce){this.remove(key,globalHandlers[index]);}}}}
{var localHandlers=this.getBucket(context)[key];var _index=-1;var _length=localHandlers?localHandlers.length:0;if(_length){while(++_index<_length){if(!localHandlers[_index]||localHandlers[_index].skip){continue;}
var _res=localHandlers[_index].call(context,p1,p2,p3,p4,p5,p6);if(_res!==void 0){p1=_res;}
if(localHandlers[_index]&&localHandlers[_index].runOnce){this.remove(key,localHandlers[_index],context);}}}}
return p1;}},{key:'destroy',value:function destroy(){var context=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;(0,_object.objectEach)(this.getBucket(context),function(value,key,bucket){return bucket[key].length=0;});}},{key:'register',value:function register(key){if(!this.isRegistered(key)){REGISTERED_HOOKS.push(key);}}},{key:'deregister',value:function deregister(key){if(this.isRegistered(key)){REGISTERED_HOOKS.splice(REGISTERED_HOOKS.indexOf(key),1);}}},{key:'isRegistered',value:function isRegistered(key){return REGISTERED_HOOKS.indexOf(key)>=0;}},{key:'getRegistered',value:function getRegistered(){return REGISTERED_HOOKS;}}]);return Hooks;}();var globalSingleton=new Hooks();exports.default=Hooks;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getRegisteredRenderers=exports.getRegisteredRendererNames=exports.hasRenderer=exports.getRenderer=exports.registerRenderer=undefined;var _staticRegister2=__webpack_require__(50);var _staticRegister3=_interopRequireDefault(_staticRegister2);var _cellDecorator=__webpack_require__(262);var _cellDecorator2=_interopRequireDefault(_cellDecorator);var _autocompleteRenderer=__webpack_require__(263);var _autocompleteRenderer2=_interopRequireDefault(_autocompleteRenderer);var _checkboxRenderer=__webpack_require__(264);var _checkboxRenderer2=_interopRequireDefault(_checkboxRenderer);var _htmlRenderer=__webpack_require__(265);var _htmlRenderer2=_interopRequireDefault(_htmlRenderer);var _numericRenderer=__webpack_require__(266);var _numericRenderer2=_interopRequireDefault(_numericRenderer);var _passwordRenderer=__webpack_require__(267);var _passwordRenderer2=_interopRequireDefault(_passwordRenderer);var _textRenderer=__webpack_require__(268);var _textRenderer2=_interopRequireDefault(_textRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var _staticRegister=(0,_staticRegister3.default)('renderers'),register=_staticRegister.register,getItem=_staticRegister.getItem,hasItem=_staticRegister.hasItem,getNames=_staticRegister.getNames,getValues=_staticRegister.getValues;register('base',_cellDecorator2.default);register('autocomplete',_autocompleteRenderer2.default);register('checkbox',_checkboxRenderer2.default);register('html',_htmlRenderer2.default);register('numeric',_numericRenderer2.default);register('password',_passwordRenderer2.default);register('text',_textRenderer2.default);function _getItem(name){if(typeof name==='function'){return name;}
if(!hasItem(name)){throw Error('No registered renderer found under "'+name+'" name');}
return getItem(name);}
exports.registerRenderer=register;exports.getRenderer=_getItem;exports.hasRenderer=hasItem;exports.getRegisteredRendererNames=getNames;exports.getRegisteredRenderers=getValues;}),(function(module,exports,__webpack_require__){var store=__webpack_require__(83)('wks'),uid=__webpack_require__(49),Symbol=__webpack_require__(13).Symbol,USE_SYMBOL=typeof Symbol=='function';var $exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)('Symbol.'+name));};$exports.store=store;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.Viewport=exports.TableRenderer=exports.Table=exports.Settings=exports.Selection=exports.Scroll=exports.Overlays=exports.Event=exports.Core=exports.default=exports.Border=exports.TopLeftCornerOverlay=exports.TopOverlay=exports.LeftOverlay=exports.DebugOverlay=exports.RowFilter=exports.ColumnFilter=exports.CellRange=exports.CellCoords=exports.ViewportRowsCalculator=exports.ViewportColumnsCalculator=undefined;__webpack_require__(97);__webpack_require__(114);__webpack_require__(123);__webpack_require__(124);__webpack_require__(108);__webpack_require__(122);__webpack_require__(105);__webpack_require__(106);__webpack_require__(107);__webpack_require__(96);__webpack_require__(119);__webpack_require__(117);__webpack_require__(115);__webpack_require__(120);__webpack_require__(121);__webpack_require__(116);__webpack_require__(118);__webpack_require__(109);__webpack_require__(110);__webpack_require__(111);__webpack_require__(113);__webpack_require__(112);__webpack_require__(94);__webpack_require__(95);__webpack_require__(90);__webpack_require__(93);__webpack_require__(92);__webpack_require__(91);__webpack_require__(67);__webpack_require__(99);__webpack_require__(100);__webpack_require__(102);__webpack_require__(101);__webpack_require__(98);__webpack_require__(104);__webpack_require__(103);__webpack_require__(125);__webpack_require__(128);__webpack_require__(126);__webpack_require__(127);__webpack_require__(130);__webpack_require__(129);__webpack_require__(132);__webpack_require__(131);var _viewportColumns=__webpack_require__(136);var _viewportColumns2=_interopRequireDefault(_viewportColumns);var _viewportRows=__webpack_require__(137);var _viewportRows2=_interopRequireDefault(_viewportRows);var _coords=__webpack_require__(42);var _coords2=_interopRequireDefault(_coords);var _range=__webpack_require__(68);var _range2=_interopRequireDefault(_range);var _column=__webpack_require__(140);var _column2=_interopRequireDefault(_column);var _row=__webpack_require__(141);var _row2=_interopRequireDefault(_row);var _debug=__webpack_require__(184);var _debug2=_interopRequireDefault(_debug);var _left=__webpack_require__(185);var _left2=_interopRequireDefault(_left);var _top=__webpack_require__(186);var _top2=_interopRequireDefault(_top);var _topLeftCorner=__webpack_require__(187);var _topLeftCorner2=_interopRequireDefault(_topLeftCorner);var _border=__webpack_require__(135);var _border2=_interopRequireDefault(_border);var _core=__webpack_require__(138);var _core2=_interopRequireDefault(_core);var _event=__webpack_require__(139);var _event2=_interopRequireDefault(_event);var _overlays=__webpack_require__(142);var _overlays2=_interopRequireDefault(_overlays);var _scroll=__webpack_require__(143);var _scroll2=_interopRequireDefault(_scroll);var _selection=__webpack_require__(188);var _selection2=_interopRequireDefault(_selection);var _settings=__webpack_require__(144);var _settings2=_interopRequireDefault(_settings);var _table=__webpack_require__(145);var _table2=_interopRequireDefault(_table);var _tableRenderer=__webpack_require__(146);var _tableRenderer2=_interopRequireDefault(_tableRenderer);var _viewport=__webpack_require__(147);var _viewport2=_interopRequireDefault(_viewport);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
exports.ViewportColumnsCalculator=_viewportColumns2.default;exports.ViewportRowsCalculator=_viewportRows2.default;exports.CellCoords=_coords2.default;exports.CellRange=_range2.default;exports.ColumnFilter=_column2.default;exports.RowFilter=_row2.default;exports.DebugOverlay=_debug2.default;exports.LeftOverlay=_left2.default;exports.TopOverlay=_top2.default;exports.TopLeftCornerOverlay=_topLeftCorner2.default;exports.Border=_border2.default;exports.default=_core2.default;exports.Core=_core2.default;exports.Event=_event2.default;exports.Overlays=_overlays2.default;exports.Scroll=_scroll2.default;exports.Selection=_selection2.default;exports.Settings=_settings2.default;exports.Table=_table2.default;exports.TableRenderer=_tableRenderer2.default;exports.Viewport=_viewport2.default;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _object=__webpack_require__(1);var _array=__webpack_require__(2);var _recordTranslator=__webpack_require__(153);var _plugins=__webpack_require__(5);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var privatePool=new WeakMap();var initializedPlugins=null;var BasePlugin=function(){function BasePlugin(hotInstance){var _this=this;_classCallCheck(this,BasePlugin);(0,_object.defineGetter)(this,'hot',hotInstance,{writable:false});(0,_object.defineGetter)(this,'t',(0,_recordTranslator.getTranslator)(hotInstance),{writable:false});privatePool.set(this,{hooks:{}});initializedPlugins=null;this.pluginName=null;this.pluginsInitializedCallbacks=[];this.isPluginsReady=false;this.enabled=false;this.initialized=false;this.hot.addHook('afterPluginsInitialized',function(){return _this.onAfterPluginsInitialized();});this.hot.addHook('afterUpdateSettings',function(){return _this.onUpdateSettings();});this.hot.addHook('beforeInit',function(){return _this.init();});}
_createClass(BasePlugin,[{key:'init',value:function init(){this.pluginName=(0,_plugins.getPluginName)(this.hot,this);if(this.isEnabled&&this.isEnabled()){this.enablePlugin();}
if(!initializedPlugins){initializedPlugins=(0,_plugins.getRegistredPluginNames)(this.hot);}
if(initializedPlugins.indexOf(this.pluginName)>=0){initializedPlugins.splice(initializedPlugins.indexOf(this.pluginName),1);}
if(!initializedPlugins.length){this.hot.runHooks('afterPluginsInitialized');}
this.initialized=true;}},{key:'enablePlugin',value:function enablePlugin(){this.enabled=true;}},{key:'disablePlugin',value:function disablePlugin(){if(this.eventManager){this.eventManager.clear();}
this.clearHooks();this.enabled=false;}},{key:'addHook',value:function addHook(name,callback){privatePool.get(this).hooks[name]=privatePool.get(this).hooks[name]||[];var hooks=privatePool.get(this).hooks[name];this.hot.addHook(name,callback);hooks.push(callback);privatePool.get(this).hooks[name]=hooks;}},{key:'removeHooks',value:function removeHooks(name){var _this2=this;(0,_array.arrayEach)(privatePool.get(this).hooks[name]||[],function(callback){_this2.hot.removeHook(name,callback);});}},{key:'clearHooks',value:function clearHooks(){var _this3=this;var hooks=privatePool.get(this).hooks;(0,_object.objectEach)(hooks,function(callbacks,name){return _this3.removeHooks(name);});hooks.length=0;}},{key:'callOnPluginsReady',value:function callOnPluginsReady(callback){if(this.isPluginsReady){callback();}else{this.pluginsInitializedCallbacks.push(callback);}}},{key:'onAfterPluginsInitialized',value:function onAfterPluginsInitialized(){(0,_array.arrayEach)(this.pluginsInitializedCallbacks,function(callback){return callback();});this.pluginsInitializedCallbacks.length=0;this.isPluginsReady=true;}},{key:'onUpdateSettings',value:function onUpdateSettings(){if(this.isEnabled){if(this.enabled&&!this.isEnabled()){this.disablePlugin();}
if(!this.enabled&&this.isEnabled()){this.enablePlugin();}
if(this.enabled&&this.isEnabled()){this.updatePlugin();}}}},{key:'updatePlugin',value:function updatePlugin(){}},{key:'destroy',value:function destroy(){var _this4=this;if(this.eventManager){this.eventManager.destroy();}
this.clearHooks();(0,_object.objectEach)(this,function(value,property){if(property!=='hot'&&property!=='t'){_this4[property]=null;}});delete this.t;delete this.hot;}}]);return BasePlugin;}();exports.default=BasePlugin;}),(function(module,exports){var global=module.exports=typeof window!='undefined'&&window.Math==Math?window:typeof self!='undefined'&&self.Math==Math?self:Function('return this')();if(typeof __g=='number')__g=global;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getRegisteredEditors=exports.getRegisteredEditorNames=exports.hasEditor=exports.getEditorInstance=exports.getEditor=exports.registerEditor=undefined;exports.RegisteredEditor=RegisteredEditor;exports._getEditorInstance=_getEditorInstance;var _staticRegister2=__webpack_require__(50);var _staticRegister3=_interopRequireDefault(_staticRegister2);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _baseEditor=__webpack_require__(36);var _baseEditor2=_interopRequireDefault(_baseEditor);var _autocompleteEditor=__webpack_require__(148);var _autocompleteEditor2=_interopRequireDefault(_autocompleteEditor);var _checkboxEditor=__webpack_require__(201);var _checkboxEditor2=_interopRequireDefault(_checkboxEditor);var _dateEditor=__webpack_require__(202);var _dateEditor2=_interopRequireDefault(_dateEditor);var _dropdownEditor=__webpack_require__(203);var _dropdownEditor2=_interopRequireDefault(_dropdownEditor);var _handsontableEditor=__webpack_require__(149);var _handsontableEditor2=_interopRequireDefault(_handsontableEditor);var _mobileTextEditor=__webpack_require__(204);var _mobileTextEditor2=_interopRequireDefault(_mobileTextEditor);var _numericEditor=__webpack_require__(205);var _numericEditor2=_interopRequireDefault(_numericEditor);var _passwordEditor=__webpack_require__(206);var _passwordEditor2=_interopRequireDefault(_passwordEditor);var _selectEditor=__webpack_require__(207);var _selectEditor2=_interopRequireDefault(_selectEditor);var _textEditor=__webpack_require__(43);var _textEditor2=_interopRequireDefault(_textEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var registeredEditorClasses=new WeakMap();var _staticRegister=(0,_staticRegister3.default)('editors'),register=_staticRegister.register,getItem=_staticRegister.getItem,hasItem=_staticRegister.hasItem,getNames=_staticRegister.getNames,getValues=_staticRegister.getValues;_register('base',_baseEditor2.default);_register('autocomplete',_autocompleteEditor2.default);_register('checkbox',_checkboxEditor2.default);_register('date',_dateEditor2.default);_register('dropdown',_dropdownEditor2.default);_register('handsontable',_handsontableEditor2.default);_register('mobile',_mobileTextEditor2.default);_register('numeric',_numericEditor2.default);_register('password',_passwordEditor2.default);_register('select',_selectEditor2.default);_register('text',_textEditor2.default);function RegisteredEditor(editorClass){var instances={};var Clazz=editorClass;this.getConstructor=function(){return editorClass;};this.getInstance=function(hotInstance){if(!(hotInstance.guid in instances)){instances[hotInstance.guid]=new Clazz(hotInstance);}
return instances[hotInstance.guid];};_pluginHooks2.default.getSingleton().add('afterDestroy',function(){instances={};});}
function _getEditorInstance(name,hotInstance){var editor=void 0;if(typeof name==='function'){if(!registeredEditorClasses.get(name)){_register(null,name);}
editor=registeredEditorClasses.get(name);}else if(typeof name==='string'){editor=getItem(name);}else{throw Error('Only strings and functions can be passed as "editor" parameter');}
if(!editor){throw Error('No editor registered under name "'+name+'"');}
return editor.getInstance(hotInstance);}
function _getItem(name){if(!hasItem(name)){throw Error('No registered editor found under "'+name+'" name');}
return getItem(name).getConstructor();}
function _register(name,editorClass){var editorWrapper=new RegisteredEditor(editorClass);if(typeof name==='string'){register(name,editorWrapper);}
registeredEditorClasses.set(editorClass,editorWrapper);}
exports.registerEditor=_register;exports.getEditor=_getItem;exports.getEditorInstance=_getEditorInstance;exports.hasEditor=hasItem;exports.getRegisteredEditorNames=getNames;exports.getRegisteredEditors=getValues;}),(function(module,exports){module.exports=function(it){return typeof it==='object'?it!==null:typeof it==='function';};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY_CODES=undefined;exports.isPrintableChar=isPrintableChar;exports.isMetaKey=isMetaKey;exports.isCtrlKey=isCtrlKey;exports.isKey=isKey;var _array=__webpack_require__(2);var KEY_CODES=exports.KEY_CODES={MOUSE_LEFT:1,MOUSE_RIGHT:3,MOUSE_MIDDLE:2,BACKSPACE:8,COMMA:188,INSERT:45,DELETE:46,END:35,ENTER:13,ESCAPE:27,CONTROL_LEFT:91,COMMAND_LEFT:17,COMMAND_RIGHT:93,ALT:18,HOME:36,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,SPACE:32,SHIFT:16,CAPS_LOCK:20,TAB:9,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_UP:38,ARROW_DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,A:65,X:88,C:67,V:86};function isPrintableChar(keyCode){return keyCode==32||keyCode>=48&&keyCode<=57||keyCode>=96&&keyCode<=111||keyCode>=186&&keyCode<=192||keyCode>=219&&keyCode<=222||keyCode>=226||keyCode>=65&&keyCode<=90;}
function isMetaKey(keyCode){var metaKeys=[KEY_CODES.ARROW_DOWN,KEY_CODES.ARROW_UP,KEY_CODES.ARROW_LEFT,KEY_CODES.ARROW_RIGHT,KEY_CODES.HOME,KEY_CODES.END,KEY_CODES.DELETE,KEY_CODES.BACKSPACE,KEY_CODES.F1,KEY_CODES.F2,KEY_CODES.F3,KEY_CODES.F4,KEY_CODES.F5,KEY_CODES.F6,KEY_CODES.F7,KEY_CODES.F8,KEY_CODES.F9,KEY_CODES.F10,KEY_CODES.F11,KEY_CODES.F12,KEY_CODES.TAB,KEY_CODES.PAGE_DOWN,KEY_CODES.PAGE_UP,KEY_CODES.ENTER,KEY_CODES.ESCAPE,KEY_CODES.SHIFT,KEY_CODES.CAPS_LOCK,KEY_CODES.ALT];return metaKeys.indexOf(keyCode)!==-1;}
function isCtrlKey(keyCode){return[KEY_CODES.CONTROL_LEFT,224,KEY_CODES.COMMAND_LEFT,KEY_CODES.COMMAND_RIGHT].indexOf(keyCode)!==-1;}
function isKey(keyCode,baseCode){var keys=baseCode.split('|');var result=false;(0,_array.arrayEach)(keys,function(key){if(keyCode===KEY_CODES[key]){result=true;return false;}});return result;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.normalizeSelection=normalizeSelection;exports.isSeparator=isSeparator;exports.hasSubMenu=hasSubMenu;exports.isDisabled=isDisabled;exports.isSelectionDisabled=isSelectionDisabled;exports.getValidSelection=getValidSelection;exports.prepareVerticalAlignClass=prepareVerticalAlignClass;exports.prepareHorizontalAlignClass=prepareHorizontalAlignClass;exports.getAlignmentClasses=getAlignmentClasses;exports.align=align;exports.checkSelectionConsistency=checkSelectionConsistency;exports.markLabelAsSelected=markLabelAsSelected;exports.isItemHidden=isItemHidden;exports.filterSeparators=filterSeparators;var _array=__webpack_require__(2);var _element=__webpack_require__(0);var _separator=__webpack_require__(71);function normalizeSelection(selRange){return{start:selRange.getTopLeftCorner(),end:selRange.getBottomRightCorner()};}
function isSeparator(cell){return(0,_element.hasClass)(cell,'htSeparator');}
function hasSubMenu(cell){return(0,_element.hasClass)(cell,'htSubmenu');}
function isDisabled(cell){return(0,_element.hasClass)(cell,'htDisabled');}
function isSelectionDisabled(cell){return(0,_element.hasClass)(cell,'htSelectionDisabled');}
function getValidSelection(hot){var selected=hot.getSelected();if(!selected){return null;}
if(selected[0]<0){return null;}
return selected;}
function prepareVerticalAlignClass(className,alignment){if(className.indexOf(alignment)!=-1){return className;}
className=className.replace('htTop','').replace('htMiddle','').replace('htBottom','').replace('  ','');className+=' '+alignment;return className;}
function prepareHorizontalAlignClass(className,alignment){if(className.indexOf(alignment)!=-1){return className;}
className=className.replace('htLeft','').replace('htCenter','').replace('htRight','').replace('htJustify','').replace('  ','');className+=' '+alignment;return className;}
function getAlignmentClasses(range,callback){var classes={};for(var row=range.from.row;row<=range.to.row;row++){for(var col=range.from.col;col<=range.to.col;col++){if(!classes[row]){classes[row]=[];}
classes[row][col]=callback(row,col);}}
return classes;}
function align(range,type,alignment,cellDescriptor,propertySetter){if(range.from.row==range.to.row&&range.from.col==range.to.col){applyAlignClassName(range.from.row,range.from.col,type,alignment,cellDescriptor,propertySetter);}else{for(var row=range.from.row;row<=range.to.row;row++){for(var col=range.from.col;col<=range.to.col;col++){applyAlignClassName(row,col,type,alignment,cellDescriptor,propertySetter);}}}}
function applyAlignClassName(row,col,type,alignment,cellDescriptor,propertySetter){var cellMeta=cellDescriptor(row,col);var className=alignment;if(cellMeta.className){if(type==='vertical'){className=prepareVerticalAlignClass(cellMeta.className,alignment);}else{className=prepareHorizontalAlignClass(cellMeta.className,alignment);}}
propertySetter(row,col,'className',className);}
function checkSelectionConsistency(range,comparator){var result=false;if(range){range.forAll(function(row,col){if(comparator(row,col)){result=true;return false;}});}
return result;}
function markLabelAsSelected(label){return'<span class="selected">'+String.fromCharCode(10003)+'</span>'+label;}
function isItemHidden(item,instance){return!item.hidden||!(typeof item.hidden=='function'&&item.hidden.call(instance));}
function shiftSeparators(items,separator){var result=items.slice(0);for(var i=0;i<result.length;){if(result[i].name===separator){result.shift();}else{break;}}
return result;}
function popSeparators(items,separator){var result=items.slice(0);result.reverse();result=shiftSeparators(result,separator);result.reverse();return result;}
function removeDuplicatedSeparators(items){var result=[];(0,_array.arrayEach)(items,function(value,index){if(index>0){if(result[result.length-1].name!==value.name){result.push(value);}}else{result.push(value);}});return result;}
function filterSeparators(items){var separator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_separator.KEY;var result=items.slice(0);result=shiftSeparators(result,separator);result=popSeparators(result,separator);result=removeDuplicatedSeparators(result);return result;}}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15);module.exports=function(it){if(!isObject(it))throw TypeError(it+' is not an object!');return it;};}),(function(module,exports,__webpack_require__){var anObject=__webpack_require__(18),IE8_DOM_DEFINE=__webpack_require__(160),toPrimitive=__webpack_require__(86),dP=Object.defineProperty;exports.f=__webpack_require__(21)?Object.defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(IE8_DOM_DEFINE)try{return dP(O,P,Attributes);}catch(e){}
if('get'in Attributes||'set'in Attributes)throw TypeError('Accessors not supported!');if('value'in Attributes)O[P]=Attributes.value;return O;};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.stringify=stringify;exports.isDefined=isDefined;exports.isUndefined=isUndefined;exports.isEmpty=isEmpty;exports.isRegExp=isRegExp;function stringify(value){var result=void 0;switch(typeof value==='undefined'?'undefined':_typeof(value)){case'string':case'number':result=''+value;break;case'object':result=value===null?'':value.toString();break;case'undefined':result='';break;default:result=value.toString();break;}
return result;}
function isDefined(variable){return typeof variable!=='undefined';}
function isUndefined(variable){return typeof variable==='undefined';}
function isEmpty(variable){return variable===null||variable===''||isUndefined(variable);}
function isRegExp(variable){return Object.prototype.toString.call(variable)==='[object RegExp]';}}),(function(module,exports,__webpack_require__){module.exports=!__webpack_require__(31)(function(){return Object.defineProperty({},'a',{get:function(){return 7;}}).a!=7;});}),(function(module,exports){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key);};}),(function(module,exports,__webpack_require__){var IObject=__webpack_require__(77),defined=__webpack_require__(30);module.exports=function(it){return IObject(defined(it));};}),(function(module,exports,__webpack_require__){var toInteger=__webpack_require__(60),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),0x1fffffffffffff):0;};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.isIE8=isIE8;exports.isIE9=isIE9;exports.isSafari=isSafari;exports.isChrome=isChrome;exports.isMobileBrowser=isMobileBrowser;var _isIE8=!document.createTextNode('test').textContent;function isIE8(){return _isIE8;}
var _isIE9=!!document.documentMode;function isIE9(){return _isIE9;}
var _isSafari=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);function isSafari(){return _isSafari;}
var _isChrome=/Chrome/.test(navigator.userAgent)&&/Google/.test(navigator.vendor);function isChrome(){return _isChrome;}
function isMobileBrowser(userAgent){if(!userAgent){userAgent=navigator.userAgent;}
return(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent));}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getRegisteredValidators=exports.getRegisteredValidatorNames=exports.hasValidator=exports.getValidator=exports.registerValidator=undefined;var _staticRegister2=__webpack_require__(50);var _staticRegister3=_interopRequireDefault(_staticRegister2);var _autocompleteValidator=__webpack_require__(273);var _autocompleteValidator2=_interopRequireDefault(_autocompleteValidator);var _dateValidator=__webpack_require__(274);var _dateValidator2=_interopRequireDefault(_dateValidator);var _numericValidator=__webpack_require__(275);var _numericValidator2=_interopRequireDefault(_numericValidator);var _timeValidator=__webpack_require__(276);var _timeValidator2=_interopRequireDefault(_timeValidator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var _staticRegister=(0,_staticRegister3.default)('validators'),register=_staticRegister.register,getItem=_staticRegister.getItem,hasItem=_staticRegister.hasItem,getNames=_staticRegister.getNames,getValues=_staticRegister.getValues;register('autocomplete',_autocompleteValidator2.default);register('date',_dateValidator2.default);register('numeric',_numericValidator2.default);register('time',_timeValidator2.default);function _getItem(name){if(typeof name==='function'){return name;}
if(!hasItem(name)){throw Error('No registered validator found under "'+name+'" name');}
return getItem(name);}
exports.registerValidator=register;exports.getValidator=_getItem;exports.hasValidator=hasItem;exports.getRegisteredValidatorNames=getNames;exports.getRegisteredValidators=getValues;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.toUpperCaseFirst=toUpperCaseFirst;exports.equalsIgnoreCase=equalsIgnoreCase;exports.randomString=randomString;exports.isPercentValue=isPercentValue;exports.substitute=substitute;exports.stripTags=stripTags;var _mixed=__webpack_require__(20);var _number=__webpack_require__(6);function toUpperCaseFirst(string){return string[0].toUpperCase()+string.substr(1);}
function equalsIgnoreCase(){var unique=[];for(var _len=arguments.length,strings=Array(_len),_key=0;_key<_len;_key++){strings[_key]=arguments[_key];}
var length=strings.length;while(length--){var string=(0,_mixed.stringify)(strings[length]).toLowerCase();if(unique.indexOf(string)===-1){unique.push(string);}}
return unique.length===1;}
function randomString(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}
return s4()+s4()+s4()+s4();}
function isPercentValue(value){return(/^([0-9][0-9]?%$)|(^100%$)/.test(value));}
function substitute(template){var variables=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return(''+template).replace(/(?:\\)?\[([^[\]]+)]/g,function(match,name){if(match.charAt(0)==='\\'){return match.substr(1,match.length-1);}
return variables[name]===void 0?'':variables[name];});}
var STRIP_TAGS_REGEX=/<\/?\w+\/?>|<\w+[\s|/][^>]*>/gi;function stripTags(string){string+='';return string.replace(STRIP_TAGS_REGEX,'');}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _object=__webpack_require__(1);var _array=__webpack_require__(2);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _core=__webpack_require__(138);var _core2=_interopRequireDefault(_core);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var registeredOverlays={};var Overlay=function(){_createClass(Overlay,null,[{key:'registerOverlay',value:function registerOverlay(type,overlayClass){if(Overlay.CLONE_TYPES.indexOf(type)===-1){throw new Error('Unsupported overlay ('+type+').');}
registeredOverlays[type]=overlayClass;}},{key:'createOverlay',value:function createOverlay(type,wot){return new registeredOverlays[type](wot);}},{key:'hasOverlay',value:function hasOverlay(type){return registeredOverlays[type]!==void 0;}},{key:'isOverlayTypeOf',value:function isOverlayTypeOf(overlay,type){if(!overlay||!registeredOverlays[type]){return false;}
return overlay instanceof registeredOverlays[type];}},{key:'CLONE_TOP',get:function get(){return'top';}},{key:'CLONE_BOTTOM',get:function get(){return'bottom';}},{key:'CLONE_LEFT',get:function get(){return'left';}},{key:'CLONE_TOP_LEFT_CORNER',get:function get(){return'top_left_corner';}},{key:'CLONE_BOTTOM_LEFT_CORNER',get:function get(){return'bottom_left_corner';}},{key:'CLONE_DEBUG',get:function get(){return'debug';}},{key:'CLONE_TYPES',get:function get(){return[Overlay.CLONE_TOP,Overlay.CLONE_BOTTOM,Overlay.CLONE_LEFT,Overlay.CLONE_TOP_LEFT_CORNER,Overlay.CLONE_BOTTOM_LEFT_CORNER,Overlay.CLONE_DEBUG];}}]);function Overlay(wotInstance){_classCallCheck(this,Overlay);(0,_object.defineGetter)(this,'wot',wotInstance,{writable:false});this.instance=this.wot;this.type='';this.mainTableScrollableElement=null;this.TABLE=this.wot.wtTable.TABLE;this.hider=this.wot.wtTable.hider;this.spreader=this.wot.wtTable.spreader;this.holder=this.wot.wtTable.holder;this.wtRootElement=this.wot.wtTable.wtRootElement;this.trimmingContainer=(0,_element.getTrimmingContainer)(this.hider.parentNode.parentNode);this.areElementSizesAdjusted=false;this.updateStateOfRendering();}
_createClass(Overlay,[{key:'updateStateOfRendering',value:function updateStateOfRendering(){var previousState=this.needFullRender;this.needFullRender=this.shouldBeRendered();var changed=previousState!==this.needFullRender;if(changed&&!this.needFullRender){this.reset();}
return changed;}},{key:'shouldBeRendered',value:function shouldBeRendered(){return true;}},{key:'updateTrimmingContainer',value:function updateTrimmingContainer(){this.trimmingContainer=(0,_element.getTrimmingContainer)(this.hider.parentNode.parentNode);}},{key:'updateMainScrollableElement',value:function updateMainScrollableElement(){this.mainTableScrollableElement=(0,_element.getScrollableElement)(this.wot.wtTable.TABLE);}},{key:'makeClone',value:function makeClone(direction){if(Overlay.CLONE_TYPES.indexOf(direction)===-1){throw new Error('Clone type "'+direction+'" is not supported.');}
var clone=document.createElement('DIV');var clonedTable=document.createElement('TABLE');clone.className='ht_clone_'+direction+' handsontable';clone.style.position='absolute';clone.style.top=0;clone.style.left=0;clone.style.overflow='hidden';clonedTable.className=this.wot.wtTable.TABLE.className;clone.appendChild(clonedTable);this.type=direction;this.wot.wtTable.wtRootElement.parentNode.appendChild(clone);var preventOverflow=this.wot.getSetting('preventOverflow');if(preventOverflow===true||preventOverflow==='horizontal'&&this.type===Overlay.CLONE_TOP||preventOverflow==='vertical'&&this.type===Overlay.CLONE_LEFT){this.mainTableScrollableElement=window;}else{this.mainTableScrollableElement=(0,_element.getScrollableElement)(this.wot.wtTable.TABLE);}
return new _core2.default({cloneSource:this.wot,cloneOverlay:this,table:clonedTable});}},{key:'refresh',value:function refresh(){var fastDraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var nextCycleRenderFlag=this.shouldBeRendered();if(this.clone&&(this.needFullRender||nextCycleRenderFlag)){this.clone.draw(fastDraw);}
this.needFullRender=nextCycleRenderFlag;}},{key:'reset',value:function reset(){if(!this.clone){return;}
var holder=this.clone.wtTable.holder;var hider=this.clone.wtTable.hider;var holderStyle=holder.style;var hidderStyle=hider.style;var rootStyle=holder.parentNode.style;(0,_array.arrayEach)([holderStyle,hidderStyle,rootStyle],function(style){style.width='';style.height='';});}},{key:'destroy',value:function destroy(){new _eventManager2.default(this.clone).destroy();}}]);return Overlay;}();exports.default=Overlay;}),(function(module,exports,__webpack_require__){var aFunction=__webpack_require__(72);module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a);};case 2:return function(a,b){return fn.call(that,a,b);};case 3:return function(a,b,c){return fn.call(that,a,b,c);};}
return function(){return fn.apply(that,arguments);};};}),(function(module,exports){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it;};}),(function(module,exports){module.exports=function(exec){try{return!!exec();}catch(e){return true;}};}),(function(module,exports,__webpack_require__){var dP=__webpack_require__(19),createDesc=__webpack_require__(40);module.exports=__webpack_require__(21)?function(object,key,value){return dP.f(object,key,createDesc(1,value));}:function(object,key,value){object[key]=value;return object;};}),(function(module,exports,__webpack_require__){var global=__webpack_require__(13),hide=__webpack_require__(32),has=__webpack_require__(22),SRC=__webpack_require__(49)('src'),TO_STRING='toString',$toString=Function[TO_STRING],TPL=(''+$toString).split(TO_STRING);__webpack_require__(44).inspectSource=function(it){return $toString.call(it);};(module.exports=function(O,key,val,safe){var isFunction=typeof val=='function';if(isFunction)has(val,'name')||hide(val,'name',key);if(O[key]===val)return;if(isFunction)has(val,SRC)||hide(val,SRC,O[key]?''+O[key]:TPL.join(String(key)));if(O===global){O[key]=val;}else{if(!safe){delete O[key];hide(O,key,val);}else{if(O[key])O[key]=val;else hide(O,key,val);}}})(Function.prototype,TO_STRING,function toString(){return typeof this=='function'&&this[SRC]||$toString.call(this);});}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.requestAnimationFrame=requestAnimationFrame;exports.cancelAnimationFrame=cancelAnimationFrame;exports.isTouchSupported=isTouchSupported;exports.isWebComponentSupportedNatively=isWebComponentSupportedNatively;exports.hasCaptionProblem=hasCaptionProblem;exports.getComparisonFunction=getComparisonFunction;var lastTime=0;var vendors=['ms','moz','webkit','o'];var _requestAnimationFrame=window.requestAnimationFrame;var _cancelAnimationFrame=window.cancelAnimationFrame;for(var x=0;x<vendors.length&&!_requestAnimationFrame;++x){_requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];_cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(!_requestAnimationFrame){_requestAnimationFrame=function _requestAnimationFrame(callback){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};}
if(!_cancelAnimationFrame){_cancelAnimationFrame=function _cancelAnimationFrame(id){clearTimeout(id);};}
function requestAnimationFrame(callback){return _requestAnimationFrame.call(window,callback);}
function cancelAnimationFrame(id){_cancelAnimationFrame.call(window,id);}
function isTouchSupported(){return'ontouchstart'in window;}
function isWebComponentSupportedNatively(){var test=document.createElement('div');return!!(test.createShadowRoot&&test.createShadowRoot.toString().match(/\[native code\]/));}
var _hasCaptionProblem;function detectCaptionProblem(){var TABLE=document.createElement('TABLE');TABLE.style.borderSpacing=0;TABLE.style.borderWidth=0;TABLE.style.padding=0;var TBODY=document.createElement('TBODY');TABLE.appendChild(TBODY);TBODY.appendChild(document.createElement('TR'));TBODY.firstChild.appendChild(document.createElement('TD'));TBODY.firstChild.firstChild.innerHTML='<tr><td>t<br>t</td></tr>';var CAPTION=document.createElement('CAPTION');CAPTION.innerHTML='c<br>c<br>c<br>c';CAPTION.style.padding=0;CAPTION.style.margin=0;TABLE.insertBefore(CAPTION,TBODY);document.body.appendChild(TABLE);_hasCaptionProblem=TABLE.offsetHeight<2*TABLE.lastChild.offsetHeight;document.body.removeChild(TABLE);}
function hasCaptionProblem(){if(_hasCaptionProblem===void 0){detectCaptionProblem();}
return _hasCaptionProblem;}
var comparisonFunction=void 0;function getComparisonFunction(language){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(comparisonFunction){return comparisonFunction;}
if((typeof Intl==='undefined'?'undefined':_typeof(Intl))==='object'){comparisonFunction=new Intl.Collator(language,options).compare;}else if(typeof String.prototype.localeCompare==='function'){comparisonFunction=function comparisonFunction(a,b){return(''+a).localeCompare(b);};}else{comparisonFunction=function comparisonFunction(a,b){if(a===b){return 0;}
return a>b?-1:1;};}
return comparisonFunction;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.isFunction=isFunction;exports.throttle=throttle;exports.throttleAfterHits=throttleAfterHits;exports.debounce=debounce;exports.pipe=pipe;exports.partial=partial;exports.curry=curry;exports.curryRight=curryRight;var _array=__webpack_require__(2);function isFunction(func){return typeof func==='function';}
function throttle(func){var wait=arguments.length>1&&arguments[1]!==undefined?arguments[1]:200;var lastCalled=0;var result={lastCallThrottled:true};var lastTimer=null;function _throttle(){var _this=this;var args=arguments;var stamp=Date.now();var needCall=false;result.lastCallThrottled=true;if(!lastCalled){lastCalled=stamp;needCall=true;}
var remaining=wait-(stamp-lastCalled);if(needCall){result.lastCallThrottled=false;func.apply(this,args);}else{if(lastTimer){clearTimeout(lastTimer);}
lastTimer=setTimeout(function(){result.lastCallThrottled=false;func.apply(_this,args);lastCalled=0;lastTimer=void 0;},remaining);}
return result;}
return _throttle;}
function throttleAfterHits(func){var wait=arguments.length>1&&arguments[1]!==undefined?arguments[1]:200;var hits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var funcThrottle=throttle(func,wait);var remainHits=hits;function _clearHits(){remainHits=hits;}
function _throttleAfterHits(){if(remainHits){remainHits--;return func.apply(this,arguments);}
return funcThrottle.apply(this,arguments);}
_throttleAfterHits.clearHits=_clearHits;return _throttleAfterHits;}
function debounce(func){var wait=arguments.length>1&&arguments[1]!==undefined?arguments[1]:200;var lastTimer=null;var result=void 0;function _debounce(){var _this2=this;var args=arguments;if(lastTimer){clearTimeout(lastTimer);}
lastTimer=setTimeout(function(){result=func.apply(_this2,args);},wait);return result;}
return _debounce;}
function pipe(){for(var _len=arguments.length,functions=Array(_len),_key=0;_key<_len;_key++){functions[_key]=arguments[_key];}
var firstFunc=functions[0],restFunc=functions.slice(1);return function _pipe(){return(0,_array.arrayReduce)(restFunc,function(acc,fn){return fn(acc);},firstFunc.apply(this,arguments));};}
function partial(func){for(var _len2=arguments.length,params=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){params[_key2-1]=arguments[_key2];}
return function _partial(){for(var _len3=arguments.length,restParams=Array(_len3),_key3=0;_key3<_len3;_key3++){restParams[_key3]=arguments[_key3];}
return func.apply(this,params.concat(restParams));};}
function curry(func){var argsLength=func.length;function given(argsSoFar){return function _curry(){for(var _len4=arguments.length,params=Array(_len4),_key4=0;_key4<_len4;_key4++){params[_key4]=arguments[_key4];}
var passedArgsSoFar=argsSoFar.concat(params);var result=void 0;if(passedArgsSoFar.length>=argsLength){result=func.apply(this,passedArgsSoFar);}else{result=given(passedArgsSoFar);}
return result;};}
return given([]);}
function curryRight(func){var argsLength=func.length;function given(argsSoFar){return function _curry(){for(var _len5=arguments.length,params=Array(_len5),_key5=0;_key5<_len5;_key5++){params[_key5]=arguments[_key5];}
var passedArgsSoFar=argsSoFar.concat(params.reverse());var result=void 0;if(passedArgsSoFar.length>=argsLength){result=func.apply(this,passedArgsSoFar);}else{result=given(passedArgsSoFar);}
return result;};}
return given([]);}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.EditorState=undefined;var _src=__webpack_require__(11);var _mixed=__webpack_require__(20);var EditorState=exports.EditorState={VIRGIN:'STATE_VIRGIN',EDITING:'STATE_EDITING',WAITING:'STATE_WAITING',FINISHED:'STATE_FINISHED'};function BaseEditor(instance){this.instance=instance;this.state=EditorState.VIRGIN;this._opened=false;this._fullEditMode=false;this._closeCallback=null;this.init();}
BaseEditor.prototype._fireCallbacks=function(result){if(this._closeCallback){this._closeCallback(result);this._closeCallback=null;}};BaseEditor.prototype.init=function(){};BaseEditor.prototype.getValue=function(){throw Error('Editor getValue() method unimplemented');};BaseEditor.prototype.setValue=function(newValue){throw Error('Editor setValue() method unimplemented');};BaseEditor.prototype.open=function(){throw Error('Editor open() method unimplemented');};BaseEditor.prototype.close=function(){throw Error('Editor close() method unimplemented');};BaseEditor.prototype.prepare=function(row,col,prop,td,originalValue,cellProperties){this.TD=td;this.row=row;this.col=col;this.prop=prop;this.originalValue=originalValue;this.cellProperties=cellProperties;this.state=EditorState.VIRGIN;};BaseEditor.prototype.extend=function(){var baseClass=this.constructor;function Editor(){baseClass.apply(this,arguments);}
function inherit(Child,Parent){function Bridge(){}
Bridge.prototype=Parent.prototype;Child.prototype=new Bridge();Child.prototype.constructor=Child;return Child;}
return inherit(Editor,baseClass);};BaseEditor.prototype.saveValue=function(value,ctrlDown){var selection=void 0;var tmp=void 0;if(ctrlDown){selection=this.instance.getSelected();if(selection[0]>selection[2]){tmp=selection[0];selection[0]=selection[2];selection[2]=tmp;}
if(selection[1]>selection[3]){tmp=selection[1];selection[1]=selection[3];selection[3]=tmp;}}else{selection=[this.row,this.col,null,null];}
this.instance.populateFromArray(selection[0],selection[1],value,selection[2],selection[3],'edit');};BaseEditor.prototype.beginEditing=function(initialValue,event){if(this.state!=EditorState.VIRGIN){return;}
this.instance.view.scrollViewport(new _src.CellCoords(this.row,this.col));this.instance.view.render();this.state=EditorState.EDITING;initialValue=typeof initialValue=='string'?initialValue:this.originalValue;this.setValue((0,_mixed.stringify)(initialValue));this.open(event);this._opened=true;this.focus();this.instance.view.render();this.instance.runHooks('afterBeginEditing',this.row,this.col);};BaseEditor.prototype.finishEditing=function(restoreOriginalValue,ctrlDown,callback){var _this=this,val;if(callback){var previousCloseCallback=this._closeCallback;this._closeCallback=function(result){if(previousCloseCallback){previousCloseCallback(result);}
callback(result);_this.instance.view.render();};}
if(this.isWaiting()){return;}
if(this.state==EditorState.VIRGIN){this.instance._registerTimeout(setTimeout(function(){_this._fireCallbacks(true);},0));return;}
if(this.state==EditorState.EDITING){if(restoreOriginalValue){this.cancelChanges();this.instance.view.render();return;}
var value=this.getValue();if(this.instance.getSettings().trimWhitespace){val=[[typeof value==='string'?String.prototype.trim.call(value||''):value]];}else{val=[[value]];}
this.state=EditorState.WAITING;this.saveValue(val,ctrlDown);if(this.instance.getCellValidator(this.cellProperties)){this.instance.addHookOnce('postAfterValidate',function(result){_this.state=EditorState.FINISHED;_this.discardEditor(result);});}else{this.state=EditorState.FINISHED;this.discardEditor(true);}}};BaseEditor.prototype.cancelChanges=function(){this.state=EditorState.FINISHED;this.discardEditor();};BaseEditor.prototype.discardEditor=function(result){if(this.state!==EditorState.FINISHED){return;}
if(result===false&&this.cellProperties.allowInvalid!==true){this.instance.selectCell(this.row,this.col);this.focus();this.state=EditorState.EDITING;this._fireCallbacks(false);}else{this.close();this._opened=false;this._fullEditMode=false;this.state=EditorState.VIRGIN;this._fireCallbacks(true);}};BaseEditor.prototype.enableFullEditMode=function(){this._fullEditMode=true;};BaseEditor.prototype.isInFullEditMode=function(){return this._fullEditMode;};BaseEditor.prototype.isOpened=function(){return this._opened;};BaseEditor.prototype.isWaiting=function(){return this.state===EditorState.WAITING;};BaseEditor.prototype.checkEditorSection=function(){var totalRows=this.instance.countRows();var section='';if(this.row<this.instance.getSettings().fixedRowsTop){if(this.col<this.instance.getSettings().fixedColumnsLeft){section='top-left-corner';}else{section='top';}}else if(this.instance.getSettings().fixedRowsBottom&&this.row>=totalRows-this.instance.getSettings().fixedRowsBottom){if(this.col<this.instance.getSettings().fixedColumnsLeft){section='bottom-left-corner';}else{section='bottom';}}else if(this.col<this.instance.getSettings().fixedColumnsLeft){section='left';}
return section;};exports.default=BaseEditor;}),(function(module,exports,__webpack_require__){var UNSCOPABLES=__webpack_require__(10)('unscopables'),ArrayProto=Array.prototype;if(ArrayProto[UNSCOPABLES]==undefined)__webpack_require__(32)(ArrayProto,UNSCOPABLES,{});module.exports=function(key){ArrayProto[UNSCOPABLES][key]=true;};}),(function(module,exports){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1);};}),(function(module,exports,__webpack_require__){var $keys=__webpack_require__(169),enumBugKeys=__webpack_require__(75);module.exports=Object.keys||function keys(O){return $keys(O,enumBugKeys);};}),(function(module,exports){module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value};};}),(function(module,exports,__webpack_require__){var defined=__webpack_require__(30);module.exports=function(it){return Object(defined(it));};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var CellCoords=function(){function CellCoords(row,col){_classCallCheck(this,CellCoords);if(typeof row!=='undefined'&&typeof col!=='undefined'){this.row=row;this.col=col;}else{this.row=null;this.col=null;}}
_createClass(CellCoords,[{key:'isValid',value:function isValid(wotInstance){if(this.row<0||this.col<0){return false;}
if(this.row>=wotInstance.getSetting('totalRows')||this.col>=wotInstance.getSetting('totalColumns')){return false;}
return true;}},{key:'isEqual',value:function isEqual(cellCoords){if(cellCoords===this){return true;}
return this.row===cellCoords.row&&this.col===cellCoords.col;}},{key:'isSouthEastOf',value:function isSouthEastOf(testedCoords){return this.row>=testedCoords.row&&this.col>=testedCoords.col;}},{key:'isNorthWestOf',value:function isNorthWestOf(testedCoords){return this.row<=testedCoords.row&&this.col<=testedCoords.col;}},{key:'isSouthWestOf',value:function isSouthWestOf(testedCoords){return this.row>=testedCoords.row&&this.col<=testedCoords.col;}},{key:'isNorthEastOf',value:function isNorthEastOf(testedCoords){return this.row<=testedCoords.row&&this.col>=testedCoords.col;}}]);return CellCoords;}();exports.default=CellCoords;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _autoResize=__webpack_require__(183);var _autoResize2=_interopRequireDefault(_autoResize);var _baseEditor=__webpack_require__(36);var _baseEditor2=_interopRequireDefault(_baseEditor);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _unicode=__webpack_require__(16);var _event=__webpack_require__(7);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var TextEditor=_baseEditor2.default.prototype.extend();TextEditor.prototype.init=function(){var that=this;this.createElements();this.eventManager=new _eventManager2.default(this);this.bindEvents();this.autoResize=(0,_autoResize2.default)();this.instance.addHook('afterDestroy',function(){that.destroy();});};TextEditor.prototype.getValue=function(){return this.TEXTAREA.value;};TextEditor.prototype.setValue=function(newValue){this.TEXTAREA.value=newValue;};var onBeforeKeyDown=function onBeforeKeyDown(event){var instance=this,that=instance.getActiveEditor(),ctrlDown;ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(event.target!==that.TEXTAREA||(0,_event.isImmediatePropagationStopped)(event)){return;}
if(event.keyCode===17||event.keyCode===224||event.keyCode===91||event.keyCode===93){(0,_event.stopImmediatePropagation)(event);return;}
switch(event.keyCode){case _unicode.KEY_CODES.ARROW_RIGHT:if(that.isInFullEditMode()){if(!that.isWaiting()&&!that.allowKeyEventPropagation||!that.isWaiting()&&that.allowKeyEventPropagation&&!that.allowKeyEventPropagation(event.keyCode)){(0,_event.stopImmediatePropagation)(event);}}
break;case _unicode.KEY_CODES.ARROW_LEFT:if(that.isInFullEditMode()){if(!that.isWaiting()&&!that.allowKeyEventPropagation||!that.isWaiting()&&that.allowKeyEventPropagation&&!that.allowKeyEventPropagation(event.keyCode)){(0,_event.stopImmediatePropagation)(event);}}
break;case _unicode.KEY_CODES.ARROW_UP:case _unicode.KEY_CODES.ARROW_DOWN:if(that.isInFullEditMode()){if(!that.isWaiting()&&!that.allowKeyEventPropagation||!that.isWaiting()&&that.allowKeyEventPropagation&&!that.allowKeyEventPropagation(event.keyCode)){(0,_event.stopImmediatePropagation)(event);}}
break;case _unicode.KEY_CODES.ENTER:var selected=that.instance.getSelected();var isMultipleSelection=!(selected[0]===selected[2]&&selected[1]===selected[3]);if(ctrlDown&&!isMultipleSelection||event.altKey){if(that.isOpened()){var caretPosition=(0,_element.getCaretPosition)(that.TEXTAREA),value=that.getValue();var newValue=value.slice(0,caretPosition)+'\n'+value.slice(caretPosition);that.setValue(newValue);(0,_element.setCaretPosition)(that.TEXTAREA,caretPosition+1);}else{that.beginEditing(that.originalValue+'\n');}
(0,_event.stopImmediatePropagation)(event);}
event.preventDefault();break;case _unicode.KEY_CODES.A:case _unicode.KEY_CODES.X:case _unicode.KEY_CODES.C:case _unicode.KEY_CODES.V:if(ctrlDown){(0,_event.stopImmediatePropagation)(event);}
break;case _unicode.KEY_CODES.BACKSPACE:case _unicode.KEY_CODES.DELETE:case _unicode.KEY_CODES.HOME:case _unicode.KEY_CODES.END:(0,_event.stopImmediatePropagation)(event);break;default:break;}
if([_unicode.KEY_CODES.ARROW_UP,_unicode.KEY_CODES.ARROW_RIGHT,_unicode.KEY_CODES.ARROW_DOWN,_unicode.KEY_CODES.ARROW_LEFT].indexOf(event.keyCode)===-1){that.autoResize.resize(String.fromCharCode(event.keyCode));}};TextEditor.prototype.open=function(){this.refreshDimensions();this.instance.addHook('beforeKeyDown',onBeforeKeyDown);};TextEditor.prototype.close=function(tdOutside){this.textareaParentStyle.display='none';this.autoResize.unObserve();if(document.activeElement===this.TEXTAREA){this.instance.listen();}
this.instance.removeHook('beforeKeyDown',onBeforeKeyDown);};TextEditor.prototype.focus=function(){this.TEXTAREA.focus();(0,_element.setCaretPosition)(this.TEXTAREA,this.TEXTAREA.value.length);};TextEditor.prototype.createElements=function(){this.TEXTAREA=document.createElement('TEXTAREA');(0,_element.addClass)(this.TEXTAREA,'handsontableInput');this.textareaStyle=this.TEXTAREA.style;this.textareaStyle.width=0;this.textareaStyle.height=0;this.TEXTAREA_PARENT=document.createElement('DIV');(0,_element.addClass)(this.TEXTAREA_PARENT,'handsontableInputHolder');this.textareaParentStyle=this.TEXTAREA_PARENT.style;this.textareaParentStyle.top=0;this.textareaParentStyle.left=0;this.textareaParentStyle.display='none';this.TEXTAREA_PARENT.appendChild(this.TEXTAREA);this.instance.rootElement.appendChild(this.TEXTAREA_PARENT);var that=this;this.instance._registerTimeout(setTimeout(function(){that.refreshDimensions();},0));};TextEditor.prototype.getEditedCell=function(){var editorSection=this.checkEditorSection(),editedCell;switch(editorSection){case'top':editedCell=this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=101;break;case'top-left-corner':editedCell=this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=103;break;case'bottom-left-corner':editedCell=this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=103;break;case'left':editedCell=this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=102;break;case'bottom':editedCell=this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=102;break;default:editedCell=this.instance.getCell(this.row,this.col);this.textareaParentStyle.zIndex='';break;}
return editedCell!=-1&&editedCell!=-2?editedCell:void 0;};TextEditor.prototype.refreshValue=function(){var sourceData=this.instance.getSourceDataAtCell(this.row,this.prop);this.originalValue=sourceData;this.setValue(sourceData);this.refreshDimensions();};TextEditor.prototype.refreshDimensions=function(){if(this.state!==_baseEditor.EditorState.EDITING){return;}
this.TD=this.getEditedCell();if(!this.TD){this.close(true);return;}
var currentOffset=(0,_element.offset)(this.TD),containerOffset=(0,_element.offset)(this.instance.rootElement),scrollableContainer=(0,_element.getScrollableElement)(this.TD),totalRowsCount=this.instance.countRows(),editTopModifier=currentOffset.top===containerOffset.top?0:1,editTop=currentOffset.top-containerOffset.top-editTopModifier-(scrollableContainer.scrollTop||0),editLeft=currentOffset.left-containerOffset.left-1-(scrollableContainer.scrollLeft||0),settings=this.instance.getSettings(),rowHeadersCount=this.instance.hasRowHeaders(),colHeadersCount=this.instance.hasColHeaders(),editorSection=this.checkEditorSection(),backgroundColor=this.TD.style.backgroundColor,cssTransformOffset;switch(editorSection){case'top':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.holder.parentNode);break;case'left':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.holder.parentNode);break;case'top-left-corner':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case'bottom-left-corner':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case'bottom':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.holder.parentNode);break;default:break;}
if(colHeadersCount&&this.instance.getSelected()[0]===0||settings.fixedRowsBottom&&this.instance.getSelected()[0]===totalRowsCount-settings.fixedRowsBottom){editTop+=1;}
if(this.instance.getSelected()[1]===0){editLeft+=1;}
if(cssTransformOffset&&cssTransformOffset!=-1){this.textareaParentStyle[cssTransformOffset[0]]=cssTransformOffset[1];}else{(0,_element.resetCssTransform)(this.TEXTAREA_PARENT);}
this.textareaParentStyle.top=editTop+'px';this.textareaParentStyle.left=editLeft+'px';var firstRowOffset=this.instance.view.wt.wtViewport.rowsRenderCalculator.startPosition;var firstColumnOffset=this.instance.view.wt.wtViewport.columnsRenderCalculator.startPosition;var horizontalScrollPosition=this.instance.view.wt.wtOverlays.leftOverlay.getScrollPosition();var verticalScrollPosition=this.instance.view.wt.wtOverlays.topOverlay.getScrollPosition();var scrollbarWidth=(0,_element.getScrollbarWidth)();var cellTopOffset=this.TD.offsetTop+firstRowOffset-verticalScrollPosition;var cellLeftOffset=this.TD.offsetLeft+firstColumnOffset-horizontalScrollPosition;var width=(0,_element.innerWidth)(this.TD)-8;var actualVerticalScrollbarWidth=(0,_element.hasVerticalScrollbar)(scrollableContainer)?scrollbarWidth:0;var actualHorizontalScrollbarWidth=(0,_element.hasHorizontalScrollbar)(scrollableContainer)?scrollbarWidth:0;var maxWidth=this.instance.view.maximumVisibleElementWidth(cellLeftOffset)-9-actualVerticalScrollbarWidth;var height=this.TD.scrollHeight+1;var maxHeight=Math.max(this.instance.view.maximumVisibleElementHeight(cellTopOffset)-actualHorizontalScrollbarWidth,23);var cellComputedStyle=(0,_element.getComputedStyle)(this.TD);this.TEXTAREA.style.fontSize=cellComputedStyle.fontSize;this.TEXTAREA.style.fontFamily=cellComputedStyle.fontFamily;this.TEXTAREA.style.backgroundColor='';this.TEXTAREA.style.backgroundColor=backgroundColor?backgroundColor:(0,_element.getComputedStyle)(this.TEXTAREA).backgroundColor;this.autoResize.init(this.TEXTAREA,{minHeight:Math.min(height,maxHeight),maxHeight:maxHeight,minWidth:Math.min(width,maxWidth),maxWidth:maxWidth},true);this.textareaParentStyle.display='block';};TextEditor.prototype.bindEvents=function(){var editor=this;this.eventManager.addEventListener(this.TEXTAREA,'cut',function(event){(0,_event.stopPropagation)(event);});this.eventManager.addEventListener(this.TEXTAREA,'paste',function(event){(0,_event.stopPropagation)(event);});this.instance.addHook('afterScrollHorizontally',function(){editor.refreshDimensions();});this.instance.addHook('afterScrollVertically',function(){editor.refreshDimensions();});this.instance.addHook('afterColumnResize',function(){editor.refreshDimensions();editor.focus();});this.instance.addHook('afterRowResize',function(){editor.refreshDimensions();editor.focus();});this.instance.addHook('afterDestroy',function(){editor.eventManager.destroy();});};TextEditor.prototype.destroy=function(){this.eventManager.destroy();};exports.default=TextEditor;}),(function(module,exports){var core=module.exports={version:'2.4.0'};if(typeof __e=='number')__e=core;}),(function(module,exports){module.exports={};}),(function(module,exports,__webpack_require__){var META=__webpack_require__(49)('meta'),isObject=__webpack_require__(15),has=__webpack_require__(22),setDesc=__webpack_require__(19).f,id=0;var isExtensible=Object.isExtensible||function(){return true;};var FREEZE=!__webpack_require__(31)(function(){return isExtensible(Object.preventExtensions({}));});var setMeta=function(it){setDesc(it,META,{value:{i:'O'+ ++id,w:{}}});};var fastKey=function(it,create){if(!isObject(it))return typeof it=='symbol'?it:(typeof it=='string'?'S':'P')+it;if(!has(it,META)){if(!isExtensible(it))return'F';if(!create)return'E';setMeta(it);}return it[META].i;};var getWeak=function(it,create){if(!has(it,META)){if(!isExtensible(it))return true;if(!create)return false;setMeta(it);}return it[META].w;};var onFreeze=function(it){if(FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META))setMeta(it);return it;};var meta=module.exports={KEY:META,NEED:false,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze};}),(function(module,exports){exports.f={}.propertyIsEnumerable;}),(function(module,exports,__webpack_require__){var def=__webpack_require__(19).f,has=__webpack_require__(22),TAG=__webpack_require__(10)('toStringTag');module.exports=function(it,tag,stat){if(it&&!has(it=stat?it:it.prototype,TAG))def(it,TAG,{configurable:true,value:tag});};}),(function(module,exports){var id=0,px=Math.random();module.exports=function(key){return'Symbol('.concat(key===undefined?'':key,')_',(++id+px).toString(36));};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=staticRegister;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}
var collection=exports.collection=new Map();function staticRegister(){var namespace=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'common';if(!collection.has(namespace)){collection.set(namespace,new Map());}
var subCollection=collection.get(namespace);function register(name,item){subCollection.set(name,item);}
function getItem(name){return subCollection.get(name);}
function hasItem(name){return subCollection.has(name);}
function getNames(){return[].concat(_toConsumableArray(subCollection.keys()));}
function getValues(){return[].concat(_toConsumableArray(subCollection.values()));}
return{register:register,getItem:getItem,hasItem:hasItem,getNames:getNames,getValues:getValues};}}),(function(module,exports){module.exports=function(it,Constructor,name,forbiddenField){if(!(it instanceof Constructor)||(forbiddenField!==undefined&&forbiddenField in it)){throw TypeError(name+': incorrect invocation!');}return it;};}),(function(module,exports,__webpack_require__){var ctx=__webpack_require__(29),IObject=__webpack_require__(77),toObject=__webpack_require__(41),toLength=__webpack_require__(24),asc=__webpack_require__(280);module.exports=function(TYPE,$create){var IS_MAP=TYPE==1,IS_FILTER=TYPE==2,IS_SOME=TYPE==3,IS_EVERY=TYPE==4,IS_FIND_INDEX=TYPE==6,NO_HOLES=TYPE==5||IS_FIND_INDEX,create=$create||asc;return function($this,callbackfn,that){var O=toObject($this),self=IObject(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=IS_MAP?create($this,length):IS_FILTER?create($this,0):undefined,val,res;for(;length>index;index++)if(NO_HOLES||index in self){val=self[index];res=f(val,index,O);if(TYPE){if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return true;case 5:return val;case 6:return index;case 2:result.push(val);}else if(IS_EVERY)return false;}}
return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result;};};}),(function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(13),$export=__webpack_require__(3),redefine=__webpack_require__(33),redefineAll=__webpack_require__(58),meta=__webpack_require__(46),forOf=__webpack_require__(55),anInstance=__webpack_require__(51),isObject=__webpack_require__(15),fails=__webpack_require__(31),$iterDetect=__webpack_require__(78),setToStringTag=__webpack_require__(48),inheritIfRequired=__webpack_require__(283);module.exports=function(NAME,wrapper,methods,common,IS_MAP,IS_WEAK){var Base=global[NAME],C=Base,ADDER=IS_MAP?'set':'add',proto=C&&C.prototype,O={};var fixMethod=function(KEY){var fn=proto[KEY];redefine(proto,KEY,KEY=='delete'?function(a){return IS_WEAK&&!isObject(a)?false:fn.call(this,a===0?0:a);}:KEY=='has'?function has(a){return IS_WEAK&&!isObject(a)?false:fn.call(this,a===0?0:a);}:KEY=='get'?function get(a){return IS_WEAK&&!isObject(a)?undefined:fn.call(this,a===0?0:a);}:KEY=='add'?function add(a){fn.call(this,a===0?0:a);return this;}:function set(a,b){fn.call(this,a===0?0:a,b);return this;});};if(typeof C!='function'||!(IS_WEAK||proto.forEach&&!fails(function(){new C().entries().next();}))){C=common.getConstructor(wrapper,NAME,IS_MAP,ADDER);redefineAll(C.prototype,methods);meta.NEED=true;}else{var instance=new C,HASNT_CHAINING=instance[ADDER](IS_WEAK?{}:-0,1)!=instance,THROWS_ON_PRIMITIVES=fails(function(){instance.has(1);}),ACCEPT_ITERABLES=$iterDetect(function(iter){new C(iter);}),BUGGY_ZERO=!IS_WEAK&&fails(function(){var $instance=new C(),index=5;while(index--)$instance[ADDER](index,index);return!$instance.has(-0);});if(!ACCEPT_ITERABLES){C=wrapper(function(target,iterable){anInstance(target,C,NAME);var that=inheritIfRequired(new Base,target,C);if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that);return that;});C.prototype=proto;proto.constructor=C;}
if(THROWS_ON_PRIMITIVES||BUGGY_ZERO){fixMethod('delete');fixMethod('has');IS_MAP&&fixMethod('get');}
if(BUGGY_ZERO||HASNT_CHAINING)fixMethod(ADDER);if(IS_WEAK&&proto.clear)delete proto.clear;}
setToStringTag(C,NAME);O[NAME]=C;$export($export.G+$export.W+$export.F*(C!=Base),O);if(!IS_WEAK)common.setStrong(C,NAME,IS_MAP);return C;};}),(function(module,exports,__webpack_require__){"use strict";var hide=__webpack_require__(32),redefine=__webpack_require__(33),fails=__webpack_require__(31),defined=__webpack_require__(30),wks=__webpack_require__(10);module.exports=function(KEY,length,exec){var SYMBOL=wks(KEY),fns=exec(defined,SYMBOL,''[KEY]),strfn=fns[0],rxfn=fns[1];if(fails(function(){var O={};O[SYMBOL]=function(){return 7;};return''[KEY](O)!=7;})){redefine(String.prototype,KEY,strfn);hide(RegExp.prototype,SYMBOL,length==2?function(string,arg){return rxfn.call(string,this,arg);}:function(string){return rxfn.call(string,this);});}};}),(function(module,exports,__webpack_require__){var ctx=__webpack_require__(29),call=__webpack_require__(165),isArrayIter=__webpack_require__(161),anObject=__webpack_require__(18),toLength=__webpack_require__(24),getIterFn=__webpack_require__(176),BREAK={},RETURN={};var exports=module.exports=function(iterable,entries,fn,that,ITERATOR){var iterFn=ITERATOR?function(){return iterable;}:getIterFn(iterable),f=ctx(fn,that,entries?2:1),index=0,length,step,iterator,result;if(typeof iterFn!='function')throw TypeError(iterable+' is not iterable!');if(isArrayIter(iterFn))for(length=toLength(iterable.length);length>index;index++){result=entries?f(anObject(step=iterable[index])[0],step[1]):f(iterable[index]);if(result===BREAK||result===RETURN)return result;}else for(iterator=iterFn.call(iterable);!(step=iterator.next()).done;){result=call(iterator,f,step.value,entries);if(result===BREAK||result===RETURN)return result;}};exports.BREAK=BREAK;exports.RETURN=RETURN;}),(function(module,exports){module.exports=false;}),(function(module,exports){exports.f=Object.getOwnPropertySymbols;}),(function(module,exports,__webpack_require__){var redefine=__webpack_require__(33);module.exports=function(target,src,safe){for(var key in src)redefine(target,key,src[key],safe);return target;};}),(function(module,exports,__webpack_require__){var toInteger=__webpack_require__(60),max=Math.max,min=Math.min;module.exports=function(index,length){index=toInteger(index);return index<0?max(index+length,0):min(index,length);};}),(function(module,exports){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it);};}),(function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_61__;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getRegisteredCellTypes=exports.getRegisteredCellTypeNames=exports.hasCellType=exports.getCellType=exports.registerCellType=undefined;var _staticRegister2=__webpack_require__(50);var _staticRegister3=_interopRequireDefault(_staticRegister2);var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var _autocompleteType=__webpack_require__(189);var _autocompleteType2=_interopRequireDefault(_autocompleteType);var _checkboxType=__webpack_require__(190);var _checkboxType2=_interopRequireDefault(_checkboxType);var _dateType=__webpack_require__(191);var _dateType2=_interopRequireDefault(_dateType);var _dropdownType=__webpack_require__(192);var _dropdownType2=_interopRequireDefault(_dropdownType);var _handsontableType=__webpack_require__(193);var _handsontableType2=_interopRequireDefault(_handsontableType);var _numericType=__webpack_require__(194);var _numericType2=_interopRequireDefault(_numericType);var _passwordType=__webpack_require__(195);var _passwordType2=_interopRequireDefault(_passwordType);var _textType=__webpack_require__(196);var _textType2=_interopRequireDefault(_textType);var _timeType=__webpack_require__(197);var _timeType2=_interopRequireDefault(_timeType);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var _staticRegister=(0,_staticRegister3.default)('cellTypes'),register=_staticRegister.register,getItem=_staticRegister.getItem,hasItem=_staticRegister.hasItem,getNames=_staticRegister.getNames,getValues=_staticRegister.getValues;_register('autocomplete',_autocompleteType2.default);_register('checkbox',_checkboxType2.default);_register('date',_dateType2.default);_register('dropdown',_dropdownType2.default);_register('handsontable',_handsontableType2.default);_register('numeric',_numericType2.default);_register('password',_passwordType2.default);_register('text',_textType2.default);_register('time',_timeType2.default);function _getItem(name){if(!hasItem(name)){throw Error('You declared cell type "'+name+'" as a string that is not mapped to a known object.\n                 Cell type must be an object or a string mapped to an object registered by "Handsontable.cellTypes.registerCellType" method');}
return getItem(name);}
function _register(name,type){var editor=type.editor,renderer=type.renderer,validator=type.validator;if(editor){(0,_editors.registerEditor)(name,editor);}
if(renderer){(0,_renderers.registerRenderer)(name,renderer);}
if(validator){(0,_validators.registerValidator)(name,validator);}
register(name,type);}
exports.registerCellType=_register;exports.getCellType=_getItem;exports.hasCellType=hasItem;exports.getRegisteredCellTypeNames=getNames;exports.getRegisteredCellTypes=getValues;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};exports.default=Core;var _numbro=__webpack_require__(87);var _numbro2=_interopRequireDefault(_numbro);var _element=__webpack_require__(0);var _setting=__webpack_require__(65);var _function=__webpack_require__(35);var _mixed=__webpack_require__(20);var _browser=__webpack_require__(25);var _dataMap=__webpack_require__(198);var _dataMap2=_interopRequireDefault(_dataMap);var _editorManager=__webpack_require__(200);var _editorManager2=_interopRequireDefault(_editorManager);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _object=__webpack_require__(1);var _array=__webpack_require__(2);var _plugins=__webpack_require__(5);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var _string=__webpack_require__(27);var _number=__webpack_require__(6);var _tableView=__webpack_require__(269);var _tableView2=_interopRequireDefault(_tableView);var _dataSource=__webpack_require__(199);var _dataSource2=_interopRequireDefault(_dataSource);var _data=__webpack_require__(64);var _recordTranslator=__webpack_require__(153);var _src=__webpack_require__(11);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _defaultSettings=__webpack_require__(88);var _defaultSettings2=_interopRequireDefault(_defaultSettings);var _cellTypes=__webpack_require__(62);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}
var activeGuid=null;function Core(rootElement,userSettings){var priv,datamap,dataSource,grid,selection,editorManager,instance=this,GridSettings=function GridSettings(){},eventManager=new _eventManager2.default(instance);(0,_object.extend)(GridSettings.prototype,_defaultSettings2.default.prototype);(0,_object.extend)(GridSettings.prototype,userSettings);(0,_object.extend)(GridSettings.prototype,expandType(userSettings));this.rootElement=rootElement;this.isHotTableEnv=(0,_element.isChildOfWebComponentTable)(this.rootElement);_eventManager2.default.isHotTableEnv=this.isHotTableEnv;this.container=document.createElement('DIV');this.renderCall=false;rootElement.insertBefore(this.container,rootElement.firstChild);this.guid='ht_'+(0,_string.randomString)();var recordTranslator=(0,_recordTranslator.getTranslator)(instance);dataSource=new _dataSource2.default(instance);if(!this.rootElement.id||this.rootElement.id.substring(0,3)==='ht_'){this.rootElement.id=this.guid;}
priv={cellSettings:[],columnSettings:[],columnsSettingConflicts:['data','width'],settings:new GridSettings(),selRange:null,isPopulated:null,scrollable:null,firstRun:true};grid={alter:function alter(action,index,amount,source,keepEmptyRows){var delta;amount=amount||1;function spliceWith(data,index,count,toInject){var valueFactory=function valueFactory(){var result=void 0;if(toInject==='array'){result=[];}else if(toInject==='object'){result={};}
return result;};var spliceArgs=(0,_array.arrayMap)(new Array(count),function(){return valueFactory();});spliceArgs.unshift(index,0);data.splice.apply(data,_toConsumableArray(spliceArgs));}
switch(action){case'insert_row':var numberOfSourceRows=instance.countSourceRows();if(instance.getSettings().maxRows===numberOfSourceRows){return;}
index=(0,_mixed.isDefined)(index)?index:numberOfSourceRows;delta=datamap.createRow(index,amount,source);spliceWith(priv.cellSettings,index,amount,'array');if(delta){if(selection.isSelected()&&priv.selRange.from.row>=index){priv.selRange.from.row+=delta;selection.transformEnd(delta,0);}else{selection.refreshBorders();}}
break;case'insert_col':delta=datamap.createCol(index,amount,source);for(var row=0,len=instance.countSourceRows();row<len;row++){if(priv.cellSettings[row]){spliceWith(priv.cellSettings[row],index,amount);}}
if(delta){if(Array.isArray(instance.getSettings().colHeaders)){var spliceArray=[index,0];spliceArray.length+=delta;Array.prototype.splice.apply(instance.getSettings().colHeaders,spliceArray);}
if(selection.isSelected()&&priv.selRange.from.col>=index){priv.selRange.from.col+=delta;selection.transformEnd(0,delta);}else{selection.refreshBorders();}}
break;case'remove_row':datamap.removeRow(index,amount,source);priv.cellSettings.splice(index,amount);var totalRows=instance.countRows();var fixedRowsTop=instance.getSettings().fixedRowsTop;if(fixedRowsTop>=index+1){instance.getSettings().fixedRowsTop-=Math.min(amount,fixedRowsTop-index);}
var fixedRowsBottom=instance.getSettings().fixedRowsBottom;if(fixedRowsBottom&&index>=totalRows-fixedRowsBottom){instance.getSettings().fixedRowsBottom-=Math.min(amount,fixedRowsBottom);}
grid.adjustRowsAndCols();selection.refreshBorders();break;case'remove_col':var visualColumnIndex=recordTranslator.toPhysicalColumn(index);datamap.removeCol(index,amount,source);for(var _row=0,_len=instance.countSourceRows();_row<_len;_row++){if(priv.cellSettings[_row]){priv.cellSettings[_row].splice(visualColumnIndex,amount);}}
var fixedColumnsLeft=instance.getSettings().fixedColumnsLeft;if(fixedColumnsLeft>=index+1){instance.getSettings().fixedColumnsLeft-=Math.min(amount,fixedColumnsLeft-index);}
if(Array.isArray(instance.getSettings().colHeaders)){if(typeof visualColumnIndex==='undefined'){visualColumnIndex=-1;}
instance.getSettings().colHeaders.splice(visualColumnIndex,amount);}
grid.adjustRowsAndCols();selection.refreshBorders();break;default:throw new Error('There is no such action "'+action+'"');}
if(!keepEmptyRows){grid.adjustRowsAndCols();}},adjustRowsAndCols:function adjustRowsAndCols(){if(priv.settings.minRows){var rows=instance.countRows();if(rows<priv.settings.minRows){for(var r=0,minRows=priv.settings.minRows;r<minRows-rows;r++){datamap.createRow(instance.countRows(),1,'auto');}}}
if(priv.settings.minSpareRows){var emptyRows=instance.countEmptyRows(true);if(emptyRows<priv.settings.minSpareRows){for(;emptyRows<priv.settings.minSpareRows&&instance.countSourceRows()<priv.settings.maxRows;emptyRows++){datamap.createRow(instance.countRows(),1,'auto');}}}
{var emptyCols=void 0;if(priv.settings.minCols||priv.settings.minSpareCols){emptyCols=instance.countEmptyCols(true);}
if(priv.settings.minCols&&!priv.settings.columns&&instance.countCols()<priv.settings.minCols){for(;instance.countCols()<priv.settings.minCols;emptyCols++){datamap.createCol(instance.countCols(),1,'auto');}}
if(priv.settings.minSpareCols&&!priv.settings.columns&&instance.dataType==='array'&&emptyCols<priv.settings.minSpareCols){for(;emptyCols<priv.settings.minSpareCols&&instance.countCols()<priv.settings.maxCols;emptyCols++){datamap.createCol(instance.countCols(),1,'auto');}}}
var rowCount=instance.countRows();var colCount=instance.countCols();if(rowCount===0||colCount===0){selection.deselect();}
if(selection.isSelected()){var selectionChanged=false;var fromRow=priv.selRange.from.row;var fromCol=priv.selRange.from.col;var toRow=priv.selRange.to.row;var toCol=priv.selRange.to.col;if(fromRow>rowCount-1){fromRow=rowCount-1;selectionChanged=true;if(toRow>fromRow){toRow=fromRow;}}else if(toRow>rowCount-1){toRow=rowCount-1;selectionChanged=true;if(fromRow>toRow){fromRow=toRow;}}
if(fromCol>colCount-1){fromCol=colCount-1;selectionChanged=true;if(toCol>fromCol){toCol=fromCol;}}else if(toCol>colCount-1){toCol=colCount-1;selectionChanged=true;if(fromCol>toCol){fromCol=toCol;}}
if(selectionChanged){instance.selectCell(fromRow,fromCol,toRow,toCol);}}
if(instance.view){instance.view.wt.wtOverlays.adjustElementsSize();}},populateFromArray:function populateFromArray(start,input,end,source,method,direction,deltas){var r,rlen,c,clen,setData=[],current={};rlen=input.length;if(rlen===0){return false;}
var repeatCol,repeatRow,cmax,rmax,baseEnd={row:end===null?null:end.row,col:end===null?null:end.col};switch(method){case'shift_down':repeatCol=end?end.col-start.col+1:0;repeatRow=end?end.row-start.row+1:0;input=(0,_data.translateRowsToColumns)(input);for(c=0,clen=input.length,cmax=Math.max(clen,repeatCol);c<cmax;c++){if(c<clen){var _instance;for(r=0,rlen=input[c].length;r<repeatRow-rlen;r++){input[c].push(input[c][r%rlen]);}
input[c].unshift(start.col+c,start.row,0);(_instance=instance).spliceCol.apply(_instance,_toConsumableArray(input[c]));}else{var _instance2;input[c%clen][0]=start.col+c;(_instance2=instance).spliceCol.apply(_instance2,_toConsumableArray(input[c%clen]));}}
break;case'shift_right':repeatCol=end?end.col-start.col+1:0;repeatRow=end?end.row-start.row+1:0;for(r=0,rlen=input.length,rmax=Math.max(rlen,repeatRow);r<rmax;r++){if(r<rlen){var _instance3;for(c=0,clen=input[r].length;c<repeatCol-clen;c++){input[r].push(input[r][c%clen]);}
input[r].unshift(start.row+r,start.col,0);(_instance3=instance).spliceRow.apply(_instance3,_toConsumableArray(input[r]));}else{var _instance4;input[r%rlen][0]=start.row+r;(_instance4=instance).spliceRow.apply(_instance4,_toConsumableArray(input[r%rlen]));}}
break;case'overwrite':default:current.row=start.row;current.col=start.col;var selected={row:end&&start?end.row-start.row+1:1,col:end&&start?end.col-start.col+1:1};var skippedRow=0;var skippedColumn=0;var pushData=true;var cellMeta=void 0;var getInputValue=function getInputValue(row){var col=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var rowValue=input[row%input.length];if(col!==null){return rowValue[col%rowValue.length];}
return rowValue;};var rowInputLength=input.length;var rowSelectionLength=end?end.row-start.row+1:0;if(end){rlen=rowSelectionLength;}else{rlen=Math.max(rowInputLength,rowSelectionLength);}
for(r=0;r<rlen;r++){if(end&&current.row>end.row&&rowSelectionLength>rowInputLength||!priv.settings.allowInsertRow&&current.row>instance.countRows()-1||current.row>=priv.settings.maxRows){break;}
var visualRow=r-skippedRow;var colInputLength=getInputValue(visualRow).length;var colSelectionLength=end?end.col-start.col+1:0;if(end){clen=colSelectionLength;}else{clen=Math.max(colInputLength,colSelectionLength);}
current.col=start.col;cellMeta=instance.getCellMeta(current.row,current.col);if((source==='CopyPaste.paste'||source==='Autofill.autofill')&&cellMeta.skipRowOnPaste){skippedRow++;current.row++;rlen++;continue;}
skippedColumn=0;for(c=0;c<clen;c++){if(end&&current.col>end.col&&colSelectionLength>colInputLength||!priv.settings.allowInsertColumn&&current.col>instance.countCols()-1||current.col>=priv.settings.maxCols){break;}
cellMeta=instance.getCellMeta(current.row,current.col);if((source==='CopyPaste.paste'||source==='Autofill.fill')&&cellMeta.skipColumnOnPaste){skippedColumn++;current.col++;clen++;continue;}
if(cellMeta.readOnly){current.col++;continue;}
var visualColumn=c-skippedColumn;var value=getInputValue(visualRow,visualColumn);var orgValue=instance.getDataAtCell(current.row,current.col);var index={row:visualRow,col:visualColumn};if(source==='Autofill.fill'){var result=instance.runHooks('beforeAutofillInsidePopulate',index,direction,input,deltas,{},selected);if(result){value=(0,_mixed.isUndefined)(result.value)?value:result.value;}}
if(value!==null&&(typeof value==='undefined'?'undefined':_typeof(value))==='object'){if(orgValue===null||(typeof orgValue==='undefined'?'undefined':_typeof(orgValue))!=='object'){pushData=false;}else{var orgValueSchema=(0,_object.duckSchema)(orgValue[0]||orgValue);var valueSchema=(0,_object.duckSchema)(value[0]||value);if((0,_object.isObjectEquals)(orgValueSchema,valueSchema)){value=(0,_object.deepClone)(value);}else{pushData=false;}}}else if(orgValue!==null&&(typeof orgValue==='undefined'?'undefined':_typeof(orgValue))==='object'){pushData=false;}
if(pushData){setData.push([current.row,current.col,value]);}
pushData=true;current.col++;}
current.row++;}
instance.setDataAtCell(setData,null,null,source||'populateFromArray');break;}}};this.selection=selection={inProgress:false,selectedHeader:{cols:false,rows:false},setSelectedHeaders:function setSelectedHeaders(){var rows=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var cols=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var corner=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;instance.selection.selectedHeader.rows=rows;instance.selection.selectedHeader.cols=cols;instance.selection.selectedHeader.corner=corner;},begin:function begin(){instance.selection.inProgress=true;},finish:function finish(){var sel=instance.getSelected();instance.runHooks('afterSelectionEnd',sel[0],sel[1],sel[2],sel[3]);instance.runHooks('afterSelectionEndByProp',sel[0],instance.colToProp(sel[1]),sel[2],instance.colToProp(sel[3]));instance.selection.inProgress=false;},isInProgress:function isInProgress(){return instance.selection.inProgress;},setRangeStart:function setRangeStart(coords,keepEditorOpened){instance.runHooks('beforeSetRangeStart',coords);priv.selRange=new _src.CellRange(coords,coords,coords);selection.setRangeEnd(coords,null,keepEditorOpened);},setRangeStartOnly:function setRangeStartOnly(coords){instance.runHooks('beforeSetRangeStartOnly',coords);priv.selRange=new _src.CellRange(coords,coords,coords);},setRangeEnd:function setRangeEnd(coords,scrollToCell,keepEditorOpened){if(priv.selRange===null){return;}
var disableVisualSelection,isHeaderSelected=false,areCoordsPositive=true;var firstVisibleRow=instance.view.wt.wtTable.getFirstVisibleRow();var firstVisibleColumn=instance.view.wt.wtTable.getFirstVisibleColumn();var newRangeCoords={row:null,col:null};instance.runHooks('beforeSetRangeEnd',coords);instance.selection.begin();newRangeCoords.row=coords.row<0?firstVisibleRow:coords.row;newRangeCoords.col=coords.col<0?firstVisibleColumn:coords.col;priv.selRange.to=new _src.CellCoords(newRangeCoords.row,newRangeCoords.col);if(!priv.settings.multiSelect){priv.selRange.from=coords;}
instance.view.wt.selections.current.clear();disableVisualSelection=instance.getCellMeta(priv.selRange.highlight.row,priv.selRange.highlight.col).disableVisualSelection;if(typeof disableVisualSelection==='string'){disableVisualSelection=[disableVisualSelection];}
if(disableVisualSelection===false||Array.isArray(disableVisualSelection)&&disableVisualSelection.indexOf('current')===-1){instance.view.wt.selections.current.add(priv.selRange.highlight);}
instance.view.wt.selections.area.clear();if((disableVisualSelection===false||Array.isArray(disableVisualSelection)&&disableVisualSelection.indexOf('area')===-1)&&selection.isMultiple()){instance.view.wt.selections.area.add(priv.selRange.from);instance.view.wt.selections.area.add(priv.selRange.to);}
if(priv.settings.currentHeaderClassName||priv.settings.currentRowClassName||priv.settings.currentColClassName){instance.view.wt.selections.highlight.clear();instance.view.wt.selections.highlight.add(priv.selRange.from);instance.view.wt.selections.highlight.add(priv.selRange.to);}
var preventScrolling=(0,_object.createObjectPropListener)('value');instance.runHooks('afterSelection',priv.selRange.from.row,priv.selRange.from.col,priv.selRange.to.row,priv.selRange.to.col,preventScrolling);instance.runHooks('afterSelectionByProp',priv.selRange.from.row,datamap.colToProp(priv.selRange.from.col),priv.selRange.to.row,datamap.colToProp(priv.selRange.to.col),preventScrolling);if(priv.selRange.from.row===0&&priv.selRange.to.row===instance.countRows()-1&&instance.countRows()>1||priv.selRange.from.col===0&&priv.selRange.to.col===instance.countCols()-1&&instance.countCols()>1){isHeaderSelected=true;}
if(coords.row<0||coords.col<0){areCoordsPositive=false;}
if(preventScrolling.isTouched()){scrollToCell=!preventScrolling.value;}
if(scrollToCell!==false&&!isHeaderSelected&&areCoordsPositive){if(priv.selRange.from&&!selection.isMultiple()){instance.view.scrollViewport(priv.selRange.from);}else{instance.view.scrollViewport(coords);}}
if(selection.selectedHeader.rows&&selection.selectedHeader.cols){(0,_element.addClass)(instance.rootElement,['ht__selection--rows','ht__selection--columns']);}else if(selection.selectedHeader.rows){(0,_element.removeClass)(instance.rootElement,'ht__selection--columns');(0,_element.addClass)(instance.rootElement,'ht__selection--rows');}else if(selection.selectedHeader.cols){(0,_element.removeClass)(instance.rootElement,'ht__selection--rows');(0,_element.addClass)(instance.rootElement,'ht__selection--columns');}else{(0,_element.removeClass)(instance.rootElement,['ht__selection--rows','ht__selection--columns']);}
selection.refreshBorders(null,keepEditorOpened);},refreshBorders:function refreshBorders(revertOriginal,keepEditor){if(!keepEditor){editorManager.destroyEditor(revertOriginal);}
instance.view.render();if(selection.isSelected()&&!keepEditor){editorManager.prepareEditor();}},isMultiple:function isMultiple(){var isMultiple=!(priv.selRange.to.col===priv.selRange.from.col&&priv.selRange.to.row===priv.selRange.from.row),modifier=instance.runHooks('afterIsMultipleSelection',isMultiple);if(isMultiple){return modifier;}},transformStart:function transformStart(rowDelta,colDelta,force,keepEditorOpened){var delta=new _src.CellCoords(rowDelta,colDelta),rowTransformDir=0,colTransformDir=0,totalRows,totalCols,coords,fixedRowsBottom;instance.runHooks('modifyTransformStart',delta);totalRows=instance.countRows();totalCols=instance.countCols();fixedRowsBottom=instance.getSettings().fixedRowsBottom;if(priv.selRange.highlight.row+rowDelta>totalRows-1){if(force&&priv.settings.minSpareRows>0&&!(fixedRowsBottom&&priv.selRange.highlight.row>=totalRows-fixedRowsBottom-1)){instance.alter('insert_row',totalRows);totalRows=instance.countRows();}else if(priv.settings.autoWrapCol){delta.row=1-totalRows;delta.col=priv.selRange.highlight.col+delta.col==totalCols-1?1-totalCols:1;}}else if(priv.settings.autoWrapCol&&priv.selRange.highlight.row+delta.row<0&&priv.selRange.highlight.col+delta.col>=0){delta.row=totalRows-1;delta.col=priv.selRange.highlight.col+delta.col==0?totalCols-1:-1;}
if(priv.selRange.highlight.col+delta.col>totalCols-1){if(force&&priv.settings.minSpareCols>0){instance.alter('insert_col',totalCols);totalCols=instance.countCols();}else if(priv.settings.autoWrapRow){delta.row=priv.selRange.highlight.row+delta.row==totalRows-1?1-totalRows:1;delta.col=1-totalCols;}}else if(priv.settings.autoWrapRow&&priv.selRange.highlight.col+delta.col<0&&priv.selRange.highlight.row+delta.row>=0){delta.row=priv.selRange.highlight.row+delta.row==0?totalRows-1:-1;delta.col=totalCols-1;}
coords=new _src.CellCoords(priv.selRange.highlight.row+delta.row,priv.selRange.highlight.col+delta.col);if(coords.row<0){rowTransformDir=-1;coords.row=0;}else if(coords.row>0&&coords.row>=totalRows){rowTransformDir=1;coords.row=totalRows-1;}
if(coords.col<0){colTransformDir=-1;coords.col=0;}else if(coords.col>0&&coords.col>=totalCols){colTransformDir=1;coords.col=totalCols-1;}
instance.runHooks('afterModifyTransformStart',coords,rowTransformDir,colTransformDir);selection.setRangeStart(coords,keepEditorOpened);},transformEnd:function transformEnd(rowDelta,colDelta){var delta=new _src.CellCoords(rowDelta,colDelta),rowTransformDir=0,colTransformDir=0,totalRows,totalCols,coords;instance.runHooks('modifyTransformEnd',delta);totalRows=instance.countRows();totalCols=instance.countCols();coords=new _src.CellCoords(priv.selRange.to.row+delta.row,priv.selRange.to.col+delta.col);if(coords.row<0){rowTransformDir=-1;coords.row=0;}else if(coords.row>0&&coords.row>=totalRows){rowTransformDir=1;coords.row=totalRows-1;}
if(coords.col<0){colTransformDir=-1;coords.col=0;}else if(coords.col>0&&coords.col>=totalCols){colTransformDir=1;coords.col=totalCols-1;}
instance.runHooks('afterModifyTransformEnd',coords,rowTransformDir,colTransformDir);selection.setRangeEnd(coords,true);},isSelected:function isSelected(){return priv.selRange!==null;},inInSelection:function inInSelection(coords){if(!selection.isSelected()){return false;}
return priv.selRange.includes(coords);},deselect:function deselect(){if(!selection.isSelected()){return;}
instance.selection.inProgress=false;priv.selRange=null;instance.view.wt.selections.current.clear();instance.view.wt.selections.area.clear();if(priv.settings.currentHeaderClassName||priv.settings.currentRowClassName||priv.settings.currentColClassName){instance.view.wt.selections.highlight.clear();}
editorManager.destroyEditor();selection.refreshBorders();(0,_element.removeClass)(instance.rootElement,['ht__selection--rows','ht__selection--columns']);instance.runHooks('afterDeselect');},selectAll:function selectAll(){if(!priv.settings.multiSelect){return;}
selection.setSelectedHeaders(true,true,true);selection.setRangeStart(new _src.CellCoords(0,0));selection.setRangeEnd(new _src.CellCoords(instance.countRows()-1,instance.countCols()-1),false);},empty:function empty(){if(!selection.isSelected()){return;}
var topLeft=priv.selRange.getTopLeftCorner();var bottomRight=priv.selRange.getBottomRightCorner();var r,c,changes=[];for(r=topLeft.row;r<=bottomRight.row;r++){for(c=topLeft.col;c<=bottomRight.col;c++){if(!instance.getCellMeta(r,c).readOnly){changes.push([r,c,'']);}}}
instance.setDataAtCell(changes);}};this.init=function(){dataSource.setData(priv.settings.data);instance.runHooks('beforeInit');if((0,_browser.isMobileBrowser)()){(0,_element.addClass)(instance.rootElement,'mobile');}
this.updateSettings(priv.settings,true);this.view=new _tableView2.default(this);editorManager=new _editorManager2.default(instance,priv,selection,datamap);this.forceFullRender=true;instance.runHooks('init');this.view.render();if(_typeof(priv.firstRun)==='object'){instance.runHooks('afterChange',priv.firstRun[0],priv.firstRun[1]);priv.firstRun=false;}
instance.runHooks('afterInit');};function ValidatorsQueue(){var resolved=false;return{validatorsInQueue:0,valid:true,addValidatorToQueue:function addValidatorToQueue(){this.validatorsInQueue++;resolved=false;},removeValidatorFormQueue:function removeValidatorFormQueue(){this.validatorsInQueue=this.validatorsInQueue-1<0?0:this.validatorsInQueue-1;this.checkIfQueueIsEmpty();},onQueueEmpty:function onQueueEmpty(valid){},checkIfQueueIsEmpty:function checkIfQueueIsEmpty(){if(this.validatorsInQueue==0&&resolved==false){resolved=true;this.onQueueEmpty(this.valid);}}};}
function validateChanges(changes,source,callback){var waitingForValidator=new ValidatorsQueue();waitingForValidator.onQueueEmpty=resolve;for(var i=changes.length-1;i>=0;i--){if(changes[i]===null){changes.splice(i,1);}else{var row=changes[i][0];var col=datamap.propToCol(changes[i][1]);var cellProperties=instance.getCellMeta(row,col);if(cellProperties.type==='numeric'&&typeof changes[i][3]==='string'){if(changes[i][3].length>0&&(/^-?[\d\s]*(\.|,)?\d*$/.test(changes[i][3])||cellProperties.format)){var len=changes[i][3].length;if((0,_mixed.isUndefined)(cellProperties.language)){_numbro2.default.culture('en-US');}else if(changes[i][3].indexOf('.')===len-3&&changes[i][3].indexOf(',')===-1){_numbro2.default.culture('en-US');}else{_numbro2.default.culture(cellProperties.language);}
var _numbro$cultureData=_numbro2.default.cultureData(_numbro2.default.culture()),delimiters=_numbro$cultureData.delimiters;if(_numbro2.default.validate(changes[i][3])&&!isNaN(changes[i][3])){changes[i][3]=parseFloat(changes[i][3]);}else{changes[i][3]=(0,_numbro2.default)().unformat(changes[i][3])||changes[i][3];}}}
if(instance.getCellValidator(cellProperties)){waitingForValidator.addValidatorToQueue();instance.validateCell(changes[i][3],cellProperties,function(i,cellProperties){return function(result){if(typeof result!=='boolean'){throw new Error('Validation error: result is not boolean');}
if(result===false&&cellProperties.allowInvalid===false){changes.splice(i,1);cellProperties.valid=true;var cell=instance.getCell(cellProperties.row,cellProperties.col);(0,_element.removeClass)(cell,instance.getSettings().invalidCellClassName);--i;}
waitingForValidator.removeValidatorFormQueue();};}(i,cellProperties),source);}}}
waitingForValidator.checkIfQueueIsEmpty();function resolve(){var beforeChangeResult;if(changes.length){beforeChangeResult=instance.runHooks('beforeChange',changes,source);if((0,_function.isFunction)(beforeChangeResult)){console.warn('Your beforeChange callback returns a function. It\'s not supported since Handsontable 0.12.1 (and the returned function will not be executed).');}else if(beforeChangeResult===false){changes.splice(0,changes.length);}}
callback();}}
function applyChanges(changes,source){var i=changes.length-1;if(i<0){return;}
for(;i>=0;i--){var skipThisChange=false;if(changes[i]===null){changes.splice(i,1);continue;}
if(changes[i][2]==null&&changes[i][3]==null){continue;}
if(priv.settings.allowInsertRow){while(changes[i][0]>instance.countRows()-1){var numberOfCreatedRows=datamap.createRow(void 0,void 0,source);if(numberOfCreatedRows===0){skipThisChange=true;break;}}}
if(skipThisChange){continue;}
if(instance.dataType==='array'&&(!priv.settings.columns||priv.settings.columns.length===0)&&priv.settings.allowInsertColumn){while(datamap.propToCol(changes[i][1])>instance.countCols()-1){datamap.createCol(void 0,void 0,source);}}
datamap.set(changes[i][0],changes[i][1],changes[i][3]);}
instance.forceFullRender=true;grid.adjustRowsAndCols();instance.runHooks('beforeChangeRender',changes,source);selection.refreshBorders(null,true);instance.view.wt.wtOverlays.adjustElementsSize();instance.runHooks('afterChange',changes,source||'edit');var activeEditor=instance.getActiveEditor();if(activeEditor&&(0,_mixed.isDefined)(activeEditor.refreshValue)){activeEditor.refreshValue();}}
this.validateCell=function(value,cellProperties,callback,source){var validator=instance.getCellValidator(cellProperties);function done(valid){var col=cellProperties.visualCol,row=cellProperties.visualRow,td=instance.getCell(row,col,true);if(td&&td.nodeName!='TH'){instance.view.wt.wtSettings.settings.cellRenderer(row,col,td);}
callback(valid);}
if((0,_mixed.isRegExp)(validator)){validator=function(validator){return function(value,callback){callback(validator.test(value));};}(validator);}
if((0,_function.isFunction)(validator)){value=instance.runHooks('beforeValidate',value,cellProperties.visualRow,cellProperties.prop,source);instance._registerTimeout(setTimeout(function(){validator.call(cellProperties,value,function(valid){valid=instance.runHooks('afterValidate',valid,value,cellProperties.visualRow,cellProperties.prop,source);cellProperties.valid=valid;done(valid);instance.runHooks('postAfterValidate',valid,value,cellProperties.visualRow,cellProperties.prop,source);});},0));}else{instance._registerTimeout(setTimeout(function(){cellProperties.valid=true;done(cellProperties.valid);},0));}};function setDataInputToArray(row,propOrCol,value){if((typeof row==='undefined'?'undefined':_typeof(row))==='object'){return row;}
return[[row,propOrCol,value]];}
this.setDataAtCell=function(row,col,value,source){var input=setDataInputToArray(row,col,value),i,ilen,changes=[],prop;for(i=0,ilen=input.length;i<ilen;i++){if(_typeof(input[i])!=='object'){throw new Error('Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter');}
if(typeof input[i][1]!=='number'){throw new Error('Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`');}
prop=datamap.colToProp(input[i][1]);changes.push([input[i][0],prop,dataSource.getAtCell(recordTranslator.toPhysicalRow(input[i][0]),input[i][1]),input[i][2]]);}
if(!source&&(typeof row==='undefined'?'undefined':_typeof(row))==='object'){source=col;}
instance.runHooks('afterSetDataAtCell',changes,source);validateChanges(changes,source,function(){applyChanges(changes,source);});};this.setDataAtRowProp=function(row,prop,value,source){var input=setDataInputToArray(row,prop,value),i,ilen,changes=[];for(i=0,ilen=input.length;i<ilen;i++){changes.push([input[i][0],input[i][1],dataSource.getAtCell(recordTranslator.toPhysicalRow(input[i][0]),input[i][1]),input[i][2]]);}
if(!source&&(typeof row==='undefined'?'undefined':_typeof(row))==='object'){source=prop;}
instance.runHooks('afterSetDataAtRowProp',changes,source);validateChanges(changes,source,function(){applyChanges(changes,source);});};this.listen=function(){var invalidActiveElement=!document.activeElement||document.activeElement&&document.activeElement.nodeName===void 0;if(document.activeElement&&document.activeElement!==document.body&&!invalidActiveElement){document.activeElement.blur();}else if(invalidActiveElement){document.body.focus();}
activeGuid=instance.guid;};this.unlisten=function(){if(this.isListening()){activeGuid=null;}};this.isListening=function(){return activeGuid===instance.guid;};this.destroyEditor=function(revertOriginal){selection.refreshBorders(revertOriginal);};this.populateFromArray=function(row,col,input,endRow,endCol,source,method,direction,deltas){var c;if(!((typeof input==='undefined'?'undefined':_typeof(input))==='object'&&_typeof(input[0])==='object')){throw new Error('populateFromArray parameter `input` must be an array of arrays');}
c=typeof endRow==='number'?new _src.CellCoords(endRow,endCol):null;return grid.populateFromArray(new _src.CellCoords(row,col),input,c,source,method,direction,deltas);};this.spliceCol=function(col,index,amount){var _datamap;return(_datamap=datamap).spliceCol.apply(_datamap,arguments);};this.spliceRow=function(row,index,amount){var _datamap2;return(_datamap2=datamap).spliceRow.apply(_datamap2,arguments);};this.getSelected=function(){if(selection.isSelected()){return[priv.selRange.from.row,priv.selRange.from.col,priv.selRange.to.row,priv.selRange.to.col];}};this.getSelectedRange=function(){if(selection.isSelected()){return priv.selRange;}};this.render=function(){if(instance.view){instance.renderCall=true;instance.forceFullRender=true;selection.refreshBorders(null,true);}};this.loadData=function(data){if(Array.isArray(priv.settings.dataSchema)){instance.dataType='array';}else if((0,_function.isFunction)(priv.settings.dataSchema)){instance.dataType='function';}else{instance.dataType='object';}
if(datamap){datamap.destroy();}
datamap=new _dataMap2.default(instance,priv,GridSettings);if((typeof data==='undefined'?'undefined':_typeof(data))==='object'&&data!==null){if(!(data.push&&data.splice)){data=[data];}}else if(data===null){data=[];var row;var r=0;var rlen=0;var dataSchema=datamap.getSchema();for(r=0,rlen=priv.settings.startRows;r<rlen;r++){if((instance.dataType==='object'||instance.dataType==='function')&&priv.settings.dataSchema){row=(0,_object.deepClone)(dataSchema);data.push(row);}else if(instance.dataType==='array'){row=(0,_object.deepClone)(dataSchema[0]);data.push(row);}else{row=[];for(var c=0,clen=priv.settings.startCols;c<clen;c++){row.push(null);}
data.push(row);}}}else{throw new Error('loadData only accepts array of objects or array of arrays ('+(typeof data==='undefined'?'undefined':_typeof(data))+' given)');}
priv.isPopulated=false;GridSettings.prototype.data=data;if(Array.isArray(data[0])){instance.dataType='array';}
datamap.dataSource=data;dataSource.data=data;dataSource.dataType=instance.dataType;dataSource.colToProp=datamap.colToProp.bind(datamap);dataSource.propToCol=datamap.propToCol.bind(datamap);clearCellSettingCache();grid.adjustRowsAndCols();instance.runHooks('afterLoadData',priv.firstRun);if(priv.firstRun){priv.firstRun=[null,'loadData'];}else{instance.runHooks('afterChange',null,'loadData');instance.render();}
priv.isPopulated=true;function clearCellSettingCache(){priv.cellSettings.length=0;}};this.getData=function(r,c,r2,c2){if((0,_mixed.isUndefined)(r)){return datamap.getAll();}
return datamap.getRange(new _src.CellCoords(r,c),new _src.CellCoords(r2,c2),datamap.DESTINATION_RENDERER);};this.getCopyableText=function(startRow,startCol,endRow,endCol){return datamap.getCopyableText(new _src.CellCoords(startRow,startCol),new _src.CellCoords(endRow,endCol));};this.getCopyableData=function(row,column){return datamap.getCopyable(row,datamap.colToProp(column));};this.getSchema=function(){return datamap.getSchema();};this.updateSettings=function(settings,init){var columnsAsFunc=false;var i=void 0;var j=void 0;var clen=void 0;if((0,_mixed.isDefined)(settings.rows)){throw new Error('"rows" setting is no longer supported. do you mean startRows, minRows or maxRows?');}
if((0,_mixed.isDefined)(settings.cols)){throw new Error('"cols" setting is no longer supported. do you mean startCols, minCols or maxCols?');}
for(i in settings){if(i==='data'){continue;}else if(_pluginHooks2.default.getSingleton().getRegistered().indexOf(i)>-1){if((0,_function.isFunction)(settings[i])||Array.isArray(settings[i])){settings[i].initialHook=true;instance.addHook(i,settings[i]);}}else if(!init&&(0,_object.hasOwnProperty)(settings,i)){GridSettings.prototype[i]=settings[i];}}
if(settings.data===void 0&&priv.settings.data===void 0){instance.loadData(null);}else if(settings.data!==void 0){instance.loadData(settings.data);}else if(settings.columns!==void 0){datamap.createMap();}
clen=instance.countCols();var columnSetting=settings.columns||GridSettings.prototype.columns;if(columnSetting&&(0,_function.isFunction)(columnSetting)){clen=instance.countSourceCols();columnsAsFunc=true;}
if(settings.cell!==void 0||settings.cells!==void 0||settings.columns!==void 0){priv.cellSettings.length=0;}
if(clen>0){var proto=void 0;var column=void 0;for(i=0,j=0;i<clen;i++){if(columnsAsFunc&&!columnSetting(i)){continue;}
priv.columnSettings[j]=(0,_setting.columnFactory)(GridSettings,priv.columnsSettingConflicts);proto=priv.columnSettings[j].prototype;if(columnSetting){if(columnsAsFunc){column=columnSetting(i);}else{column=columnSetting[j];}
if(column){(0,_object.extend)(proto,column);(0,_object.extend)(proto,expandType(column));}}
j++;}}
if((0,_mixed.isDefined)(settings.cell)){for(var key in settings.cell){if((0,_object.hasOwnProperty)(settings.cell,key)){var cell=settings.cell[key];instance.setCellMetaObject(cell.row,cell.col,cell);}}}
instance.runHooks('afterCellMetaReset');if((0,_mixed.isDefined)(settings.className)){if(GridSettings.prototype.className){(0,_element.removeClass)(instance.rootElement,GridSettings.prototype.className);}
if(settings.className){(0,_element.addClass)(instance.rootElement,settings.className);}}
var currentHeight=instance.rootElement.style.height;if(currentHeight!==''){currentHeight=parseInt(instance.rootElement.style.height,10);}
var height=settings.height;if((0,_function.isFunction)(height)){height=height();}
if(init){var initialStyle=instance.rootElement.getAttribute('style');if(initialStyle){instance.rootElement.setAttribute('data-initialstyle',instance.rootElement.getAttribute('style'));}}
if(height===null){var _initialStyle=instance.rootElement.getAttribute('data-initialstyle');if(_initialStyle&&(_initialStyle.indexOf('height')>-1||_initialStyle.indexOf('overflow')>-1)){instance.rootElement.setAttribute('style',_initialStyle);}else{instance.rootElement.style.height='';instance.rootElement.style.overflow='';}}else if(height!==void 0){instance.rootElement.style.height=height+'px';instance.rootElement.style.overflow='hidden';}
if(typeof settings.width!=='undefined'){var width=settings.width;if((0,_function.isFunction)(width)){width=width();}
instance.rootElement.style.width=width+'px';}
if(!init){datamap.clearLengthCache();if(instance.view){instance.view.wt.wtViewport.resetHasOversizedColumnHeadersMarked();}
instance.runHooks('afterUpdateSettings',settings);}
grid.adjustRowsAndCols();if(instance.view&&!priv.firstRun){instance.forceFullRender=true;selection.refreshBorders(null,true);}
if(!init&&instance.view&&(currentHeight===''||height===''||height===void 0)&&currentHeight!==height){instance.view.wt.wtOverlays.updateMainScrollableElements();}};this.getValue=function(){var sel=instance.getSelected();if(GridSettings.prototype.getValue){if((0,_function.isFunction)(GridSettings.prototype.getValue)){return GridSettings.prototype.getValue.call(instance);}else if(sel){return instance.getData()[sel[0]][GridSettings.prototype.getValue];}}else if(sel){return instance.getDataAtCell(sel[0],sel[1]);}};function expandType(obj){if(!(0,_object.hasOwnProperty)(obj,'type')){return;}
var type,expandedType={};if(_typeof(obj.type)==='object'){type=obj.type;}else if(typeof obj.type==='string'){type=(0,_cellTypes.getCellType)(obj.type);}
for(var i in type){if((0,_object.hasOwnProperty)(type,i)&&!(0,_object.hasOwnProperty)(obj,i)){expandedType[i]=type[i];}}
return expandedType;}
this.getSettings=function(){return priv.settings;};this.clear=function(){selection.selectAll();selection.empty();};this.alter=function(action,index,amount,source,keepEmptyRows){grid.alter(action,index,amount,source,keepEmptyRows);};this.getCell=function(row,col,topmost){return instance.view.getCellAtCoords(new _src.CellCoords(row,col),topmost);};this.getCoords=function(elem){return this.view.wt.wtTable.getCoords.call(this.view.wt.wtTable,elem);};this.colToProp=function(col){return datamap.colToProp(col);};this.propToCol=function(prop){return datamap.propToCol(prop);};this.toVisualRow=function(row){return recordTranslator.toVisualRow(row);};this.toVisualColumn=function(column){return recordTranslator.toVisualColumn(column);};this.toPhysicalRow=function(row){return recordTranslator.toPhysicalRow(row);};this.toPhysicalColumn=function(column){return recordTranslator.toPhysicalColumn(column);};this.getDataAtCell=function(row,col){return datamap.get(row,datamap.colToProp(col));};this.getDataAtRowProp=function(row,prop){return datamap.get(row,prop);};this.getDataAtCol=function(col){var out=[];return out.concat.apply(out,_toConsumableArray(datamap.getRange(new _src.CellCoords(0,col),new _src.CellCoords(priv.settings.data.length-1,col),datamap.DESTINATION_RENDERER)));};this.getDataAtProp=function(prop){var out=[],range;range=datamap.getRange(new _src.CellCoords(0,datamap.propToCol(prop)),new _src.CellCoords(priv.settings.data.length-1,datamap.propToCol(prop)),datamap.DESTINATION_RENDERER);return out.concat.apply(out,_toConsumableArray(range));};this.getSourceData=function(r,c,r2,c2){var data=void 0;if(r===void 0){data=dataSource.getData();}else{data=dataSource.getByRange(new _src.CellCoords(r,c),new _src.CellCoords(r2,c2));}
return data;};this.getSourceDataArray=function(r,c,r2,c2){var data=void 0;if(r===void 0){data=dataSource.getData(true);}else{data=dataSource.getByRange(new _src.CellCoords(r,c),new _src.CellCoords(r2,c2),true);}
return data;};this.getSourceDataAtCol=function(column){return dataSource.getAtColumn(column);};this.getSourceDataAtRow=function(row){return dataSource.getAtRow(row);};this.getSourceDataAtCell=function(row,column){return dataSource.getAtCell(row,column);};this.getDataAtRow=function(row){var data=datamap.getRange(new _src.CellCoords(row,0),new _src.CellCoords(row,this.countCols()-1),datamap.DESTINATION_RENDERER);return data[0]||[];};this.getDataType=function(rowFrom,columnFrom,rowTo,columnTo){var _this=this;var previousType=null;var currentType=null;if(rowFrom===void 0){rowFrom=0;rowTo=this.countRows();columnFrom=0;columnTo=this.countCols();}
if(rowTo===void 0){rowTo=rowFrom;}
if(columnTo===void 0){columnTo=columnFrom;}
var type='mixed';(0,_number.rangeEach)(Math.min(rowFrom,rowTo),Math.max(rowFrom,rowTo),function(row){var isTypeEqual=true;(0,_number.rangeEach)(Math.min(columnFrom,columnTo),Math.max(columnFrom,columnTo),function(column){var cellType=_this.getCellMeta(row,column);currentType=cellType.type;if(previousType){isTypeEqual=previousType===currentType;}else{previousType=currentType;}
return isTypeEqual;});type=isTypeEqual?currentType:'mixed';return isTypeEqual;});return type;};this.removeCellMeta=function(row,col,key){var _recordTranslator$toP=recordTranslator.toPhysical(row,col),_recordTranslator$toP2=_slicedToArray(_recordTranslator$toP,2),physicalRow=_recordTranslator$toP2[0],physicalColumn=_recordTranslator$toP2[1];var cachedValue=priv.cellSettings[physicalRow][physicalColumn][key];var hookResult=instance.runHooks('beforeRemoveCellMeta',row,col,key,cachedValue);if(hookResult!==false){delete priv.cellSettings[physicalRow][physicalColumn][key];instance.runHooks('afterRemoveCellMeta',row,col,key,cachedValue);}
cachedValue=null;};this.spliceCellsMeta=function(index,deleteAmount){var _priv$cellSettings;for(var _len2=arguments.length,items=Array(_len2>2?_len2-2:0),_key=2;_key<_len2;_key++){items[_key-2]=arguments[_key];}
(_priv$cellSettings=priv.cellSettings).splice.apply(_priv$cellSettings,[index,deleteAmount].concat(items));};this.setCellMetaObject=function(row,col,prop){if((typeof prop==='undefined'?'undefined':_typeof(prop))==='object'){for(var key in prop){if((0,_object.hasOwnProperty)(prop,key)){var value=prop[key];this.setCellMeta(row,col,key,value);}}}};this.setCellMeta=function(row,col,key,val){var _recordTranslator$toP3=recordTranslator.toPhysical(row,col),_recordTranslator$toP4=_slicedToArray(_recordTranslator$toP3,2),physicalRow=_recordTranslator$toP4[0],physicalColumn=_recordTranslator$toP4[1];if(!priv.columnSettings[physicalColumn]){priv.columnSettings[physicalColumn]=(0,_setting.columnFactory)(GridSettings,priv.columnsSettingConflicts);}
if(!priv.cellSettings[physicalRow]){priv.cellSettings[physicalRow]=[];}
if(!priv.cellSettings[physicalRow][physicalColumn]){priv.cellSettings[physicalRow][physicalColumn]=new priv.columnSettings[physicalColumn]();}
priv.cellSettings[physicalRow][physicalColumn][key]=val;instance.runHooks('afterSetCellMeta',row,col,key,val);};this.getCellsMeta=function(){return(0,_array.arrayFlatten)(priv.cellSettings);};this.getCellMeta=function(row,col){var prop=datamap.colToProp(col);var cellProperties=void 0;var _recordTranslator$toP5=recordTranslator.toPhysical(row,col),_recordTranslator$toP6=_slicedToArray(_recordTranslator$toP5,2),physicalRow=_recordTranslator$toP6[0],physicalColumn=_recordTranslator$toP6[1];if(!priv.columnSettings[physicalColumn]){priv.columnSettings[physicalColumn]=(0,_setting.columnFactory)(GridSettings,priv.columnsSettingConflicts);}
if(!priv.cellSettings[physicalRow]){priv.cellSettings[physicalRow]=[];}
if(!priv.cellSettings[physicalRow][physicalColumn]){priv.cellSettings[physicalRow][physicalColumn]=new priv.columnSettings[physicalColumn]();}
cellProperties=priv.cellSettings[physicalRow][physicalColumn];cellProperties.row=physicalRow;cellProperties.col=physicalColumn;cellProperties.visualRow=row;cellProperties.visualCol=col;cellProperties.prop=prop;cellProperties.instance=instance;instance.runHooks('beforeGetCellMeta',row,col,cellProperties);(0,_object.extend)(cellProperties,expandType(cellProperties));if(cellProperties.cells){var settings=cellProperties.cells.call(cellProperties,physicalRow,physicalColumn,prop);if(settings){(0,_object.extend)(cellProperties,settings);(0,_object.extend)(cellProperties,expandType(settings));}}
instance.runHooks('afterGetCellMeta',row,col,cellProperties);return cellProperties;};this.getCellMetaAtRow=function(row){return priv.cellSettings[row];};this.isColumnModificationAllowed=function(){return!(instance.dataType==='object'||instance.getSettings().columns);};var rendererLookup=(0,_data.cellMethodLookupFactory)('renderer');this.getCellRenderer=function(row,col){return(0,_renderers.getRenderer)(rendererLookup.call(this,row,col));};this.getCellEditor=(0,_data.cellMethodLookupFactory)('editor');var validatorLookup=(0,_data.cellMethodLookupFactory)('validator');this.getCellValidator=function(row,col){var validator=validatorLookup.call(this,row,col);if(typeof validator==='string'){validator=(0,_validators.getValidator)(validator);}
return validator;};this.validateCells=function(callback){var waitingForValidator=new ValidatorsQueue();if(callback){waitingForValidator.onQueueEmpty=callback;}
var i=instance.countRows()-1;while(i>=0){var j=instance.countCols()-1;while(j>=0){waitingForValidator.addValidatorToQueue();instance.validateCell(instance.getDataAtCell(i,j),instance.getCellMeta(i,j),function(result){if(typeof result!=='boolean'){throw new Error('Validation error: result is not boolean');}
if(result===false){waitingForValidator.valid=false;}
waitingForValidator.removeValidatorFormQueue();},'validateCells');j--;}
i--;}
waitingForValidator.checkIfQueueIsEmpty();};this.getRowHeader=function(row){var rowHeader=priv.settings.rowHeaders;if(row!==void 0){row=instance.runHooks('modifyRowHeader',row);}
if(row===void 0){rowHeader=[];(0,_number.rangeEach)(instance.countRows()-1,function(i){rowHeader.push(instance.getRowHeader(i));});}else if(Array.isArray(rowHeader)&&rowHeader[row]!==void 0){rowHeader=rowHeader[row];}else if((0,_function.isFunction)(rowHeader)){rowHeader=rowHeader(row);}else if(rowHeader&&typeof rowHeader!=='string'&&typeof rowHeader!=='number'){rowHeader=row+1;}
return rowHeader;};this.hasRowHeaders=function(){return!!priv.settings.rowHeaders;};this.hasColHeaders=function(){if(priv.settings.colHeaders!==void 0&&priv.settings.colHeaders!==null){return!!priv.settings.colHeaders;}
for(var i=0,ilen=instance.countCols();i<ilen;i++){if(instance.getColHeader(i)){return true;}}
return false;};this.getColHeader=function(col){var columnsAsFunc=priv.settings.columns&&(0,_function.isFunction)(priv.settings.columns);var result=priv.settings.colHeaders;col=instance.runHooks('modifyColHeader',col);if(col===void 0){var out=[];var ilen=columnsAsFunc?instance.countSourceCols():instance.countCols();for(var i=0;i<ilen;i++){out.push(instance.getColHeader(i));}
result=out;}else{var translateVisualIndexToColumns=function translateVisualIndexToColumns(col){var arr=[];var columnsLen=instance.countSourceCols();var index=0;for(;index<columnsLen;index++){if((0,_function.isFunction)(instance.getSettings().columns)&&instance.getSettings().columns(index)){arr.push(index);}}
return arr[col];};var baseCol=col;col=instance.runHooks('modifyCol',col);var prop=translateVisualIndexToColumns(col);if(priv.settings.columns&&(0,_function.isFunction)(priv.settings.columns)&&priv.settings.columns(prop)&&priv.settings.columns(prop).title){result=priv.settings.columns(prop).title;}else if(priv.settings.columns&&priv.settings.columns[col]&&priv.settings.columns[col].title){result=priv.settings.columns[col].title;}else if(Array.isArray(priv.settings.colHeaders)&&priv.settings.colHeaders[col]!==void 0){result=priv.settings.colHeaders[col];}else if((0,_function.isFunction)(priv.settings.colHeaders)){result=priv.settings.colHeaders(col);}else if(priv.settings.colHeaders&&typeof priv.settings.colHeaders!=='string'&&typeof priv.settings.colHeaders!=='number'){result=(0,_data.spreadsheetColumnLabel)(baseCol);}}
return result;};this._getColWidthFromSettings=function(col){var cellProperties=instance.getCellMeta(0,col);var width=cellProperties.width;if(width===void 0||width===priv.settings.width){width=cellProperties.colWidths;}
if(width!==void 0&&width!==null){switch(typeof width==='undefined'?'undefined':_typeof(width)){case'object':width=width[col];break;case'function':width=width(col);break;default:break;}
if(typeof width==='string'){width=parseInt(width,10);}}
return width;};this.getColWidth=function(col){var width=instance._getColWidthFromSettings(col);width=instance.runHooks('modifyColWidth',width,col);if(width===void 0){width=_src.ViewportColumnsCalculator.DEFAULT_WIDTH;}
return width;};this._getRowHeightFromSettings=function(row){var height=priv.settings.rowHeights;if(height!==void 0&&height!==null){switch(typeof height==='undefined'?'undefined':_typeof(height)){case'object':height=height[row];break;case'function':height=height(row);break;default:break;}
if(typeof height==='string'){height=parseInt(height,10);}}
return height;};this.getRowHeight=function(row){var height=instance._getRowHeightFromSettings(row);height=instance.runHooks('modifyRowHeight',height,row);return height;};this.countSourceRows=function(){var sourceLength=instance.runHooks('modifySourceLength');return sourceLength||(instance.getSourceData()?instance.getSourceData().length:0);};this.countSourceCols=function(){var len=0;var obj=instance.getSourceData()&&instance.getSourceData()[0]?instance.getSourceData()[0]:[];if((0,_object.isObject)(obj)){len=(0,_object.deepObjectSize)(obj);}else{len=obj.length||0;}
return len;};this.countRows=function(){return datamap.getLength();};this.countCols=function(){var maxCols=this.getSettings().maxCols;var dataHasLength=false;var dataLen=0;if(instance.dataType==='array'){dataHasLength=priv.settings.data&&priv.settings.data[0]&&priv.settings.data[0].length;}
if(dataHasLength){dataLen=priv.settings.data[0].length;}
if(priv.settings.columns){var columnsIsFunction=(0,_function.isFunction)(priv.settings.columns);if(columnsIsFunction){if(instance.dataType==='array'){var columnLen=0;for(var i=0;i<dataLen;i++){if(priv.settings.columns(i)){columnLen++;}}
dataLen=columnLen;}else if(instance.dataType==='object'||instance.dataType==='function'){dataLen=datamap.colToPropCache.length;}}else{dataLen=priv.settings.columns.length;}}else if(instance.dataType==='object'||instance.dataType==='function'){dataLen=datamap.colToPropCache.length;}
return Math.min(maxCols,dataLen);};this.rowOffset=function(){return instance.view.wt.wtTable.getFirstRenderedRow();};this.colOffset=function(){return instance.view.wt.wtTable.getFirstRenderedColumn();};this.countRenderedRows=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.getRenderedRowsCount():-1;};this.countVisibleRows=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.getVisibleRowsCount():-1;};this.countRenderedCols=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.getRenderedColumnsCount():-1;};this.countVisibleCols=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.getVisibleColumnsCount():-1;};this.countEmptyRows=function(ending){var i=instance.countRows()-1,empty=0,row;while(i>=0){row=instance.runHooks('modifyRow',i);if(instance.isEmptyRow(row)){empty++;}else if(ending){break;}
i--;}
return empty;};this.countEmptyCols=function(ending){if(instance.countRows()<1){return 0;}
var i=instance.countCols()-1,empty=0;while(i>=0){if(instance.isEmptyCol(i)){empty++;}else if(ending){break;}
i--;}
return empty;};this.isEmptyRow=function(row){return priv.settings.isEmptyRow.call(instance,row);};this.isEmptyCol=function(col){return priv.settings.isEmptyCol.call(instance,col);};this.selectCell=function(row,col,endRow,endCol,scrollToCell,changeListener){var coords;changeListener=(0,_mixed.isUndefined)(changeListener)||changeListener===true;if(typeof row!=='number'||row<0||row>=instance.countRows()){return false;}
if(typeof col!=='number'||col<0||col>=instance.countCols()){return false;}
if((0,_mixed.isDefined)(endRow)){if(typeof endRow!=='number'||endRow<0||endRow>=instance.countRows()){return false;}
if(typeof endCol!=='number'||endCol<0||endCol>=instance.countCols()){return false;}}
coords=new _src.CellCoords(row,col);priv.selRange=new _src.CellRange(coords,coords,coords);if(changeListener){instance.listen();}
if((0,_mixed.isUndefined)(endRow)){selection.setRangeEnd(priv.selRange.from,scrollToCell);}else{selection.setRangeEnd(new _src.CellCoords(endRow,endCol),scrollToCell);}
instance.selection.finish();return true;};this.selectCellByProp=function(row,prop,endRow,endProp,scrollToCell){var _instance5;arguments[1]=datamap.propToCol(arguments[1]);if((0,_mixed.isDefined)(arguments[3])){arguments[3]=datamap.propToCol(arguments[3]);}
return(_instance5=instance).selectCell.apply(_instance5,arguments);};this.deselectCell=function(){selection.deselect();};this.scrollViewportTo=function(row,column){var snapToBottom=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var snapToRight=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(row!==void 0&&(row<0||row>=instance.countRows())){return false;}
if(column!==void 0&&(column<0||column>=instance.countCols())){return false;}
var result=false;if(row!==void 0&&column!==void 0){instance.view.wt.wtOverlays.topOverlay.scrollTo(row,snapToBottom);instance.view.wt.wtOverlays.leftOverlay.scrollTo(column,snapToRight);result=true;}
if(typeof row==='number'&&typeof column!=='number'){instance.view.wt.wtOverlays.topOverlay.scrollTo(row,snapToBottom);result=true;}
if(typeof column==='number'&&typeof row!=='number'){instance.view.wt.wtOverlays.leftOverlay.scrollTo(column,snapToRight);result=true;}
return result;};this.destroy=function(){instance._clearTimeouts();if(instance.view){instance.view.destroy();}
if(dataSource){dataSource.destroy();}
dataSource=null;(0,_element.empty)(instance.rootElement);eventManager.destroy();instance.runHooks('afterDestroy');_pluginHooks2.default.getSingleton().destroy(instance);for(var i in instance){if((0,_object.hasOwnProperty)(instance,i)){if((0,_function.isFunction)(instance[i])){instance[i]=postMortem;}else if(i!=='guid'){instance[i]=null;}}}
if(datamap){datamap.destroy();}
datamap=null;priv=null;grid=null;selection=null;editorManager=null;instance=null;GridSettings=null;};function postMortem(){throw new Error('This method cannot be called because this Handsontable instance has been destroyed');}
this.getActiveEditor=function(){return editorManager.getActiveEditor();};this.getPlugin=function(pluginName){return(0,_plugins.getPlugin)(this,pluginName);};this.getInstance=function(){return instance;};this.addHook=function(key,callback){_pluginHooks2.default.getSingleton().add(key,callback,instance);};this.hasHook=function(key){return _pluginHooks2.default.getSingleton().has(key,instance);};this.addHookOnce=function(key,callback){_pluginHooks2.default.getSingleton().once(key,callback,instance);};this.removeHook=function(key,callback){_pluginHooks2.default.getSingleton().remove(key,callback,instance);};this.runHooks=function(key,p1,p2,p3,p4,p5,p6){return _pluginHooks2.default.getSingleton().run(instance,key,p1,p2,p3,p4,p5,p6);};this.timeouts=[];this._registerTimeout=function(handle){this.timeouts.push(handle);};this._clearTimeouts=function(){for(var i=0,ilen=this.timeouts.length;i<ilen;i++){clearTimeout(this.timeouts[i]);}};_pluginHooks2.default.getSingleton().run(instance,'construct');};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.spreadsheetColumnLabel=spreadsheetColumnLabel;exports.spreadsheetColumnIndex=spreadsheetColumnIndex;exports.createSpreadsheetData=createSpreadsheetData;exports.createSpreadsheetObjectData=createSpreadsheetObjectData;exports.createEmptySpreadsheetData=createEmptySpreadsheetData;exports.translateRowsToColumns=translateRowsToColumns;exports.cellMethodLookupFactory=cellMethodLookupFactory;var _cellTypes=__webpack_require__(62);var _object=__webpack_require__(1);var COLUMN_LABEL_BASE='ABCDEFGHIJKLMNOPQRSTUVWXYZ';var COLUMN_LABEL_BASE_LENGTH=COLUMN_LABEL_BASE.length;function spreadsheetColumnLabel(index){var dividend=index+1;var columnLabel='';var modulo=void 0;while(dividend>0){modulo=(dividend-1)%COLUMN_LABEL_BASE_LENGTH;columnLabel=String.fromCharCode(65+modulo)+columnLabel;dividend=parseInt((dividend-modulo)/COLUMN_LABEL_BASE_LENGTH,10);}
return columnLabel;}
function spreadsheetColumnIndex(label){var result=0;if(label){for(var i=0,j=label.length-1;i<label.length;i+=1,j-=1){result+=Math.pow(COLUMN_LABEL_BASE_LENGTH,j)*(COLUMN_LABEL_BASE.indexOf(label[i])+1);}}
--result;return result;}
function createSpreadsheetData(){var rows=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var columns=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var _rows=[],i,j;for(i=0;i<rows;i++){var row=[];for(j=0;j<columns;j++){row.push(spreadsheetColumnLabel(j)+(i+1));}
_rows.push(row);}
return _rows;}
function createSpreadsheetObjectData(){var rows=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var colCount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var _rows=[],i,j;for(i=0;i<rows;i++){var row={};for(j=0;j<colCount;j++){row['prop'+j]=spreadsheetColumnLabel(j)+(i+1);}
_rows.push(row);}
return _rows;}
function createEmptySpreadsheetData(rows,columns){var data=[];var row=void 0;for(var i=0;i<rows;i++){row=[];for(var j=0;j<columns;j++){row.push('');}
data.push(row);}
return data;}
function translateRowsToColumns(input){var i,ilen,j,jlen,output=[],olen=0;for(i=0,ilen=input.length;i<ilen;i++){for(j=0,jlen=input[i].length;j<jlen;j++){if(j==olen){output.push([]);olen++;}
output[j].push(input[i][j]);}}
return output;}
function cellMethodLookupFactory(methodName,allowUndefined){allowUndefined=typeof allowUndefined=='undefined'?true:allowUndefined;return function cellMethodLookup(row,col){return function getMethodFromProperties(properties){if(!properties){return;}else if((0,_object.hasOwnProperty)(properties,methodName)&&properties[methodName]!==void 0){return properties[methodName];}else if((0,_object.hasOwnProperty)(properties,'type')&&properties.type){var type;if(typeof properties.type!='string'){throw new Error('Cell type must be a string ');}
type=(0,_cellTypes.getCellType)(properties.type);if((0,_object.hasOwnProperty)(type,methodName)){return type[methodName];}else if(allowUndefined){return;}}
return getMethodFromProperties(Object.getPrototypeOf(properties));}(typeof row=='number'?this.getCellMeta(row,col):row);};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.columnFactory=columnFactory;var _object=__webpack_require__(1);function columnFactory(GridSettings,conflictList){function ColumnSettings(){};(0,_object.inherit)(ColumnSettings,GridSettings);for(var i=0,len=conflictList.length;i<len;i++){ColumnSettings.prototype[conflictList[i]]=void 0;}
return ColumnSettings;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _array=__webpack_require__(2);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var GhostTable=function(){function GhostTable(hotInstance){_classCallCheck(this,GhostTable);this.hot=hotInstance;this.container=null;this.injected=false;this.rows=[];this.columns=[];this.samples=null;this.settings={useHeaders:true};}
_createClass(GhostTable,[{key:'addRow',value:function addRow(row,samples){if(this.columns.length){throw new Error('Doesn\'t support multi-dimensional table');}
if(!this.rows.length){this.container=this.createContainer(this.hot.rootElement.className);}
var rowObject={row:row};this.rows.push(rowObject);this.samples=samples;this.table=this.createTable(this.hot.table.className);this.table.colGroup.appendChild(this.createColGroupsCol());this.table.tr.appendChild(this.createRow(row));this.container.container.appendChild(this.table.fragment);rowObject.table=this.table.table;}},{key:'addColumnHeadersRow',value:function addColumnHeadersRow(samples){if(this.hot.getColHeader(0)!=null){var rowObject={row:-1};this.rows.push(rowObject);this.container=this.createContainer(this.hot.rootElement.className);this.samples=samples;this.table=this.createTable(this.hot.table.className);this.table.colGroup.appendChild(this.createColGroupsCol());this.table.tHead.appendChild(this.createColumnHeadersRow());this.container.container.appendChild(this.table.fragment);rowObject.table=this.table.table;}}},{key:'addColumn',value:function addColumn(column,samples){if(this.rows.length){throw new Error('Doesn\'t support multi-dimensional table');}
if(!this.columns.length){this.container=this.createContainer(this.hot.rootElement.className);}
var columnObject={col:column};this.columns.push(columnObject);this.samples=samples;this.table=this.createTable(this.hot.table.className);if(this.getSetting('useHeaders')&&this.hot.getColHeader(column)!==null){this.hot.view.appendColHeader(column,this.table.th);}
this.table.tBody.appendChild(this.createCol(column));this.container.container.appendChild(this.table.fragment);columnObject.table=this.table.table;}},{key:'getHeights',value:function getHeights(callback){if(!this.injected){this.injectTable();}
(0,_array.arrayEach)(this.rows,function(row){callback(row.row,(0,_element.outerHeight)(row.table)-1);});}},{key:'getWidths',value:function getWidths(callback){if(!this.injected){this.injectTable();}
(0,_array.arrayEach)(this.columns,function(column){callback(column.col,(0,_element.outerWidth)(column.table));});}},{key:'setSettings',value:function setSettings(settings){this.settings=settings;}},{key:'setSetting',value:function setSetting(name,value){if(!this.settings){this.settings={};}
this.settings[name]=value;}},{key:'getSettings',value:function getSettings(){return this.settings;}},{key:'getSetting',value:function getSetting(name){if(this.settings){return this.settings[name];}
return null;}},{key:'createColGroupsCol',value:function createColGroupsCol(){var _this=this;var d=document;var fragment=d.createDocumentFragment();if(this.hot.hasRowHeaders()){fragment.appendChild(this.createColElement(-1));}
this.samples.forEach(function(sample){(0,_array.arrayEach)(sample.strings,function(string){fragment.appendChild(_this.createColElement(string.col));});});return fragment;}},{key:'createRow',value:function createRow(row){var _this2=this;var d=document;var fragment=d.createDocumentFragment();var th=d.createElement('th');if(this.hot.hasRowHeaders()){this.hot.view.appendRowHeader(row,th);fragment.appendChild(th);}
this.samples.forEach(function(sample){(0,_array.arrayEach)(sample.strings,function(string){var column=string.col;var cellProperties=_this2.hot.getCellMeta(row,column);cellProperties.col=column;cellProperties.row=row;var renderer=_this2.hot.getCellRenderer(cellProperties);var td=d.createElement('td');renderer(_this2.hot,td,row,column,_this2.hot.colToProp(column),string.value,cellProperties);fragment.appendChild(td);});});return fragment;}},{key:'createColumnHeadersRow',value:function createColumnHeadersRow(){var _this3=this;var d=document;var fragment=d.createDocumentFragment();if(this.hot.hasRowHeaders()){var th=d.createElement('th');this.hot.view.appendColHeader(-1,th);fragment.appendChild(th);}
this.samples.forEach(function(sample){(0,_array.arrayEach)(sample.strings,function(string){var column=string.col;var th=d.createElement('th');_this3.hot.view.appendColHeader(column,th);fragment.appendChild(th);});});return fragment;}},{key:'createCol',value:function createCol(column){var _this4=this;var d=document;var fragment=d.createDocumentFragment();this.samples.forEach(function(sample){(0,_array.arrayEach)(sample.strings,function(string){var row=string.row;var cellProperties=_this4.hot.getCellMeta(row,column);cellProperties.col=column;cellProperties.row=row;var renderer=_this4.hot.getCellRenderer(cellProperties);var td=d.createElement('td');var tr=d.createElement('tr');renderer(_this4.hot,td,row,column,_this4.hot.colToProp(column),string.value,cellProperties);tr.appendChild(td);fragment.appendChild(tr);});});return fragment;}},{key:'clean',value:function clean(){this.rows.length=0;this.rows[-1]=void 0;this.columns.length=0;if(this.samples){this.samples.clear();}
this.samples=null;this.removeTable();}},{key:'injectTable',value:function injectTable(){var parent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.injected){(parent||this.hot.rootElement).appendChild(this.container.fragment);this.injected=true;}}},{key:'removeTable',value:function removeTable(){if(this.injected&&this.container.container.parentNode){this.container.container.parentNode.removeChild(this.container.container);this.container=null;this.injected=false;}}},{key:'createColElement',value:function createColElement(column){var d=document;var col=d.createElement('col');col.style.width=this.hot.view.wt.wtTable.getStretchedColumnWidth(column)+'px';return col;}},{key:'createTable',value:function createTable(){var className=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var d=document;var fragment=d.createDocumentFragment();var table=d.createElement('table');var tHead=d.createElement('thead');var tBody=d.createElement('tbody');var colGroup=d.createElement('colgroup');var tr=d.createElement('tr');var th=d.createElement('th');if(this.isVertical()){table.appendChild(colGroup);}
if(this.isHorizontal()){tr.appendChild(th);tHead.appendChild(tr);table.style.tableLayout='auto';table.style.width='auto';}
table.appendChild(tHead);if(this.isVertical()){tBody.appendChild(tr);}
table.appendChild(tBody);(0,_element.addClass)(table,className);fragment.appendChild(table);return{fragment:fragment,table:table,tHead:tHead,tBody:tBody,colGroup:colGroup,tr:tr,th:th};}},{key:'createContainer',value:function createContainer(){var className=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var d=document;var fragment=d.createDocumentFragment();var container=d.createElement('div');className='htGhostTable htAutoSize '+className.trim();(0,_element.addClass)(container,className);fragment.appendChild(container);return{fragment:fragment,container:container};}},{key:'isVertical',value:function isVertical(){return!!(this.rows.length&&!this.columns.length);}},{key:'isHorizontal',value:function isHorizontal(){return!!(this.columns.length&&!this.rows.length);}}]);return GhostTable;}();exports.default=GhostTable;}),(function(module,exports,__webpack_require__){"use strict";var addToUnscopables=__webpack_require__(37),step=__webpack_require__(167),Iterators=__webpack_require__(45),toIObject=__webpack_require__(23);module.exports=__webpack_require__(166)(Array,'Array',function(iterated,kind){this._t=toIObject(iterated);this._i=0;this._k=kind;},function(){var O=this._t,kind=this._k,index=this._i++;if(!O||index>=O.length){this._t=undefined;return step(1);}
if(kind=='keys')return step(0,index);if(kind=='values')return step(0,O[index]);return step(0,[index,O[index]]);},'values');Iterators.Arguments=Iterators.Array;addToUnscopables('keys');addToUnscopables('values');addToUnscopables('entries');}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _coords=__webpack_require__(42);var _coords2=_interopRequireDefault(_coords);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var CellRange=function(){function CellRange(highlight,from,to){_classCallCheck(this,CellRange);this.highlight=highlight;this.from=from;this.to=to;}
_createClass(CellRange,[{key:'isValid',value:function isValid(wotInstance){return this.from.isValid(wotInstance)&&this.to.isValid(wotInstance);}},{key:'isSingle',value:function isSingle(){return this.from.row===this.to.row&&this.from.col===this.to.col;}},{key:'getHeight',value:function getHeight(){return Math.max(this.from.row,this.to.row)-Math.min(this.from.row,this.to.row)+1;}},{key:'getWidth',value:function getWidth(){return Math.max(this.from.col,this.to.col)-Math.min(this.from.col,this.to.col)+1;}},{key:'includes',value:function includes(cellCoords){var row=cellCoords.row,col=cellCoords.col;var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();return topLeft.row<=row&&bottomRight.row>=row&&topLeft.col<=col&&bottomRight.col>=col;}},{key:'includesRange',value:function includesRange(testedRange){return this.includes(testedRange.getTopLeftCorner())&&this.includes(testedRange.getBottomRightCorner());}},{key:'isEqual',value:function isEqual(testedRange){return Math.min(this.from.row,this.to.row)==Math.min(testedRange.from.row,testedRange.to.row)&&Math.max(this.from.row,this.to.row)==Math.max(testedRange.from.row,testedRange.to.row)&&Math.min(this.from.col,this.to.col)==Math.min(testedRange.from.col,testedRange.to.col)&&Math.max(this.from.col,this.to.col)==Math.max(testedRange.from.col,testedRange.to.col);}},{key:'overlaps',value:function overlaps(testedRange){return testedRange.isSouthEastOf(this.getTopLeftCorner())&&testedRange.isNorthWestOf(this.getBottomRightCorner());}},{key:'isSouthEastOf',value:function isSouthEastOf(testedCoords){return this.getTopLeftCorner().isSouthEastOf(testedCoords)||this.getBottomRightCorner().isSouthEastOf(testedCoords);}},{key:'isNorthWestOf',value:function isNorthWestOf(testedCoords){return this.getTopLeftCorner().isNorthWestOf(testedCoords)||this.getBottomRightCorner().isNorthWestOf(testedCoords);}},{key:'expand',value:function expand(cellCoords){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();if(cellCoords.row<topLeft.row||cellCoords.col<topLeft.col||cellCoords.row>bottomRight.row||cellCoords.col>bottomRight.col){this.from=new _coords2.default(Math.min(topLeft.row,cellCoords.row),Math.min(topLeft.col,cellCoords.col));this.to=new _coords2.default(Math.max(bottomRight.row,cellCoords.row),Math.max(bottomRight.col,cellCoords.col));return true;}
return false;}},{key:'expandByRange',value:function expandByRange(expandingRange){if(this.includesRange(expandingRange)||!this.overlaps(expandingRange)){return false;}
var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();var topRight=this.getTopRightCorner();var bottomLeft=this.getBottomLeftCorner();var expandingTopLeft=expandingRange.getTopLeftCorner();var expandingBottomRight=expandingRange.getBottomRightCorner();var resultTopRow=Math.min(topLeft.row,expandingTopLeft.row);var resultTopCol=Math.min(topLeft.col,expandingTopLeft.col);var resultBottomRow=Math.max(bottomRight.row,expandingBottomRight.row);var resultBottomCol=Math.max(bottomRight.col,expandingBottomRight.col);var finalFrom=new _coords2.default(resultTopRow,resultTopCol),finalTo=new _coords2.default(resultBottomRow,resultBottomCol);var isCorner=new CellRange(finalFrom,finalFrom,finalTo).isCorner(this.from,expandingRange),onlyMerge=expandingRange.isEqual(new CellRange(finalFrom,finalFrom,finalTo));if(isCorner&&!onlyMerge){if(this.from.col>finalFrom.col){finalFrom.col=resultBottomCol;finalTo.col=resultTopCol;}
if(this.from.row>finalFrom.row){finalFrom.row=resultBottomRow;finalTo.row=resultTopRow;}}
this.from=finalFrom;this.to=finalTo;return true;}},{key:'getDirection',value:function getDirection(){if(this.from.isNorthWestOf(this.to)){return'NW-SE';}else if(this.from.isNorthEastOf(this.to)){return'NE-SW';}else if(this.from.isSouthEastOf(this.to)){return'SE-NW';}else if(this.from.isSouthWestOf(this.to)){return'SW-NE';}}},{key:'setDirection',value:function setDirection(direction){switch(direction){case'NW-SE':var _ref=[this.getTopLeftCorner(),this.getBottomRightCorner()];this.from=_ref[0];this.to=_ref[1];break;case'NE-SW':var _ref2=[this.getTopRightCorner(),this.getBottomLeftCorner()];this.from=_ref2[0];this.to=_ref2[1];break;case'SE-NW':var _ref3=[this.getBottomRightCorner(),this.getTopLeftCorner()];this.from=_ref3[0];this.to=_ref3[1];break;case'SW-NE':var _ref4=[this.getBottomLeftCorner(),this.getTopRightCorner()];this.from=_ref4[0];this.to=_ref4[1];break;default:break;}}},{key:'getTopLeftCorner',value:function getTopLeftCorner(){return new _coords2.default(Math.min(this.from.row,this.to.row),Math.min(this.from.col,this.to.col));}},{key:'getBottomRightCorner',value:function getBottomRightCorner(){return new _coords2.default(Math.max(this.from.row,this.to.row),Math.max(this.from.col,this.to.col));}},{key:'getTopRightCorner',value:function getTopRightCorner(){return new _coords2.default(Math.min(this.from.row,this.to.row),Math.max(this.from.col,this.to.col));}},{key:'getBottomLeftCorner',value:function getBottomLeftCorner(){return new _coords2.default(Math.max(this.from.row,this.to.row),Math.min(this.from.col,this.to.col));}},{key:'isCorner',value:function isCorner(coords,expandedRange){if(expandedRange){if(expandedRange.includes(coords)){if(this.getTopLeftCorner().isEqual(new _coords2.default(expandedRange.from.row,expandedRange.from.col))||this.getTopRightCorner().isEqual(new _coords2.default(expandedRange.from.row,expandedRange.to.col))||this.getBottomLeftCorner().isEqual(new _coords2.default(expandedRange.to.row,expandedRange.from.col))||this.getBottomRightCorner().isEqual(new _coords2.default(expandedRange.to.row,expandedRange.to.col))){return true;}}}
return coords.isEqual(this.getTopLeftCorner())||coords.isEqual(this.getTopRightCorner())||coords.isEqual(this.getBottomLeftCorner())||coords.isEqual(this.getBottomRightCorner());}},{key:'getOppositeCorner',value:function getOppositeCorner(coords,expandedRange){if(!(coords instanceof _coords2.default)){return false;}
if(expandedRange){if(expandedRange.includes(coords)){if(this.getTopLeftCorner().isEqual(new _coords2.default(expandedRange.from.row,expandedRange.from.col))){return this.getBottomRightCorner();}
if(this.getTopRightCorner().isEqual(new _coords2.default(expandedRange.from.row,expandedRange.to.col))){return this.getBottomLeftCorner();}
if(this.getBottomLeftCorner().isEqual(new _coords2.default(expandedRange.to.row,expandedRange.from.col))){return this.getTopRightCorner();}
if(this.getBottomRightCorner().isEqual(new _coords2.default(expandedRange.to.row,expandedRange.to.col))){return this.getTopLeftCorner();}}}
if(coords.isEqual(this.getBottomRightCorner())){return this.getTopLeftCorner();}else if(coords.isEqual(this.getTopLeftCorner())){return this.getBottomRightCorner();}else if(coords.isEqual(this.getTopRightCorner())){return this.getBottomLeftCorner();}else if(coords.isEqual(this.getBottomLeftCorner())){return this.getTopRightCorner();}}},{key:'getBordersSharedWith',value:function getBordersSharedWith(range){if(!this.includesRange(range)){return[];}
var thisBorders={top:Math.min(this.from.row,this.to.row),bottom:Math.max(this.from.row,this.to.row),left:Math.min(this.from.col,this.to.col),right:Math.max(this.from.col,this.to.col)};var rangeBorders={top:Math.min(range.from.row,range.to.row),bottom:Math.max(range.from.row,range.to.row),left:Math.min(range.from.col,range.to.col),right:Math.max(range.from.col,range.to.col)};var result=[];if(thisBorders.top==rangeBorders.top){result.push('top');}
if(thisBorders.right==rangeBorders.right){result.push('right');}
if(thisBorders.bottom==rangeBorders.bottom){result.push('bottom');}
if(thisBorders.left==rangeBorders.left){result.push('left');}
return result;}},{key:'getInner',value:function getInner(){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();var out=[];for(var r=topLeft.row;r<=bottomRight.row;r++){for(var c=topLeft.col;c<=bottomRight.col;c++){if(!(this.from.row===r&&this.from.col===c)&&!(this.to.row===r&&this.to.col===c)){out.push(new _coords2.default(r,c));}}}
return out;}},{key:'getAll',value:function getAll(){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();var out=[];for(var r=topLeft.row;r<=bottomRight.row;r++){for(var c=topLeft.col;c<=bottomRight.col;c++){if(topLeft.row===r&&topLeft.col===c){out.push(topLeft);}else if(bottomRight.row===r&&bottomRight.col===c){out.push(bottomRight);}else{out.push(new _coords2.default(r,c));}}}
return out;}},{key:'forAll',value:function forAll(callback){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();for(var r=topLeft.row;r<=bottomRight.row;r++){for(var c=topLeft.col;c<=bottomRight.col;c++){var breakIteration=callback(r,c);if(breakIteration===false){return;}}}}}]);return CellRange;}();exports.default=CellRange;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _array=__webpack_require__(2);var _object=__webpack_require__(1);var MIXIN_NAME='localHooks';var localHooks={_localHooks:Object.create(null),addLocalHook:function addLocalHook(key,callback){if(!this._localHooks[key]){this._localHooks[key]=[];}
this._localHooks[key].push(callback);},runLocalHooks:function runLocalHooks(key){var _this=this;for(var _len=arguments.length,params=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){params[_key-1]=arguments[_key];}
if(this._localHooks[key]){(0,_array.arrayEach)(this._localHooks[key],function(callback){return callback.apply(_this,params);});}},clearLocalHooks:function clearLocalHooks(){this._localHooks={};}};(0,_object.defineGetter)(localHooks,'MIXIN_NAME',MIXIN_NAME,{writable:false,enumerable:false});exports.default=localHooks;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.ITEMS=exports.UNDO=exports.SEPARATOR=exports.ROW_BELOW=exports.ROW_ABOVE=exports.REMOVE_ROW=exports.REMOVE_COLUMN=exports.REDO=exports.READ_ONLY=exports.COLUMN_RIGHT=exports.COLUMN_LEFT=exports.CLEAR_COLUMN=exports.ALIGNMENT=undefined;var _predefinedItems2;var _alignment=__webpack_require__(223);Object.defineProperty(exports,'ALIGNMENT',{enumerable:true,get:function get(){return _alignment.KEY;}});var _clearColumn=__webpack_require__(224);Object.defineProperty(exports,'CLEAR_COLUMN',{enumerable:true,get:function get(){return _clearColumn.KEY;}});var _columnLeft=__webpack_require__(225);Object.defineProperty(exports,'COLUMN_LEFT',{enumerable:true,get:function get(){return _columnLeft.KEY;}});var _columnRight=__webpack_require__(226);Object.defineProperty(exports,'COLUMN_RIGHT',{enumerable:true,get:function get(){return _columnRight.KEY;}});var _readOnly=__webpack_require__(227);Object.defineProperty(exports,'READ_ONLY',{enumerable:true,get:function get(){return _readOnly.KEY;}});var _redo=__webpack_require__(228);Object.defineProperty(exports,'REDO',{enumerable:true,get:function get(){return _redo.KEY;}});var _removeColumn=__webpack_require__(229);Object.defineProperty(exports,'REMOVE_COLUMN',{enumerable:true,get:function get(){return _removeColumn.KEY;}});var _removeRow=__webpack_require__(230);Object.defineProperty(exports,'REMOVE_ROW',{enumerable:true,get:function get(){return _removeRow.KEY;}});var _rowAbove=__webpack_require__(231);Object.defineProperty(exports,'ROW_ABOVE',{enumerable:true,get:function get(){return _rowAbove.KEY;}});var _rowBelow=__webpack_require__(232);Object.defineProperty(exports,'ROW_BELOW',{enumerable:true,get:function get(){return _rowBelow.KEY;}});var _separator=__webpack_require__(71);Object.defineProperty(exports,'SEPARATOR',{enumerable:true,get:function get(){return _separator.KEY;}});var _undo=__webpack_require__(233);Object.defineProperty(exports,'UNDO',{enumerable:true,get:function get(){return _undo.KEY;}});exports.predefinedItems=predefinedItems;exports.addItem=addItem;var _object=__webpack_require__(1);var _alignment2=_interopRequireDefault(_alignment);var _clearColumn2=_interopRequireDefault(_clearColumn);var _columnLeft2=_interopRequireDefault(_columnLeft);var _columnRight2=_interopRequireDefault(_columnRight);var _readOnly2=_interopRequireDefault(_readOnly);var _redo2=_interopRequireDefault(_redo);var _removeColumn2=_interopRequireDefault(_removeColumn);var _removeRow2=_interopRequireDefault(_removeRow);var _rowAbove2=_interopRequireDefault(_rowAbove);var _rowBelow2=_interopRequireDefault(_rowBelow);var _separator2=_interopRequireDefault(_separator);var _undo2=_interopRequireDefault(_undo);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}
var ITEMS=exports.ITEMS=[_rowAbove.KEY,_rowBelow.KEY,_columnLeft.KEY,_columnRight.KEY,_clearColumn.KEY,_removeRow.KEY,_removeColumn.KEY,_undo.KEY,_redo.KEY,_readOnly.KEY,_alignment.KEY,_separator.KEY];var _predefinedItems=(_predefinedItems2={},_defineProperty(_predefinedItems2,_separator.KEY,_separator2.default),_defineProperty(_predefinedItems2,_rowAbove.KEY,_rowAbove2.default),_defineProperty(_predefinedItems2,_rowBelow.KEY,_rowBelow2.default),_defineProperty(_predefinedItems2,_columnLeft.KEY,_columnLeft2.default),_defineProperty(_predefinedItems2,_columnRight.KEY,_columnRight2.default),_defineProperty(_predefinedItems2,_clearColumn.KEY,_clearColumn2.default),_defineProperty(_predefinedItems2,_removeRow.KEY,_removeRow2.default),_defineProperty(_predefinedItems2,_removeColumn.KEY,_removeColumn2.default),_defineProperty(_predefinedItems2,_undo.KEY,_undo2.default),_defineProperty(_predefinedItems2,_redo.KEY,_redo2.default),_defineProperty(_predefinedItems2,_readOnly.KEY,_readOnly2.default),_defineProperty(_predefinedItems2,_alignment.KEY,_alignment2.default),_predefinedItems2);function predefinedItems(){var items={};(0,_object.objectEach)(_predefinedItems,function(itemFactory,key){items[key]=itemFactory();});return items;}
function addItem(key,item){if(ITEMS.indexOf(key)===-1){_predefinedItems[key]=item;}}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=separatorItem;var KEY=exports.KEY='---------';function separatorItem(){return{name:KEY};}}),(function(module,exports){module.exports=function(it){if(typeof it!='function')throw TypeError(it+' is not a function!');return it;};}),(function(module,exports,__webpack_require__){"use strict";var $defineProperty=__webpack_require__(19),createDesc=__webpack_require__(40);module.exports=function(object,index,value){if(index in object)$defineProperty.f(object,index,createDesc(0,value));else object[index]=value;};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15),document=__webpack_require__(13).document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{};};}),(function(module,exports){module.exports=('constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf').split(',');}),(function(module,exports,__webpack_require__){var MATCH=__webpack_require__(10)('match');module.exports=function(KEY){var re=/./;try{'/./'[KEY](re);}catch(e){try{re[MATCH]=false;return!'/./'[KEY](re);}catch(f){}}return true;};}),(function(module,exports,__webpack_require__){var cof=__webpack_require__(38);module.exports=Object('z').propertyIsEnumerable(0)?Object:function(it){return cof(it)=='String'?it.split(''):Object(it);};}),(function(module,exports,__webpack_require__){var ITERATOR=__webpack_require__(10)('iterator'),SAFE_CLOSING=false;try{var riter=[7][ITERATOR]();riter['return']=function(){SAFE_CLOSING=true;};Array.from(riter,function(){throw 2;});}catch(e){}
module.exports=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return false;var safe=false;try{var arr=[7],iter=arr[ITERATOR]();iter.next=function(){return{done:safe=true};};arr[ITERATOR]=function(){return iter;};exec(arr);}catch(e){}
return safe;};}),(function(module,exports,__webpack_require__){var anObject=__webpack_require__(18),dPs=__webpack_require__(288),enumBugKeys=__webpack_require__(75),IE_PROTO=__webpack_require__(82)('IE_PROTO'),Empty=function(){},PROTOTYPE='prototype';var createDict=function(){var iframe=__webpack_require__(74)('iframe'),i=enumBugKeys.length,lt='<',gt='>',iframeDocument;iframe.style.display='none';__webpack_require__(159).appendChild(iframe);iframe.src='javascript:';iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(lt+'script'+gt+'document.F=Object'+lt+'/script'+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];return createDict();};module.exports=Object.create||function create(O,Properties){var result;if(O!==null){Empty[PROTOTYPE]=anObject(O);result=new Empty;Empty[PROTOTYPE]=null;result[IE_PROTO]=O;}else result=createDict();return Properties===undefined?result:dPs(result,Properties);};}),(function(module,exports,__webpack_require__){var pIE=__webpack_require__(47),createDesc=__webpack_require__(40),toIObject=__webpack_require__(23),toPrimitive=__webpack_require__(86),has=__webpack_require__(22),IE8_DOM_DEFINE=__webpack_require__(160),gOPD=Object.getOwnPropertyDescriptor;exports.f=__webpack_require__(21)?gOPD:function getOwnPropertyDescriptor(O,P){O=toIObject(O);P=toPrimitive(P,true);if(IE8_DOM_DEFINE)try{return gOPD(O,P);}catch(e){}
if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P]);};}),(function(module,exports,__webpack_require__){var $keys=__webpack_require__(169),hiddenKeys=__webpack_require__(75).concat('length','prototype');exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return $keys(O,hiddenKeys);};}),(function(module,exports,__webpack_require__){var shared=__webpack_require__(83)('keys'),uid=__webpack_require__(49);module.exports=function(key){return shared[key]||(shared[key]=uid(key));};}),(function(module,exports,__webpack_require__){var global=__webpack_require__(13),SHARED='__core-js_shared__',store=global[SHARED]||(global[SHARED]={});module.exports=function(key){return store[key]||(store[key]={});};}),(function(module,exports,__webpack_require__){var isRegExp=__webpack_require__(164),defined=__webpack_require__(30);module.exports=function(that,searchString,NAME){if(isRegExp(searchString))throw TypeError('String#'+NAME+" doesn't accept regex!");return String(defined(that));};}),(function(module,exports,__webpack_require__){var ctx=__webpack_require__(29),invoke=__webpack_require__(284),html=__webpack_require__(159),cel=__webpack_require__(74),global=__webpack_require__(13),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,counter=0,queue={},ONREADYSTATECHANGE='onreadystatechange',defer,channel,port;var run=function(){var id=+this;if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id];fn();}};var listener=function(event){run.call(event.data);};if(!setTask||!clearTask){setTask=function setImmediate(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);queue[++counter]=function(){invoke(typeof fn=='function'?fn:Function(fn),args);};defer(counter);return counter;};clearTask=function clearImmediate(id){delete queue[id];};if(__webpack_require__(38)(process)=='process'){defer=function(id){process.nextTick(ctx(run,id,1));};}else if(MessageChannel){channel=new MessageChannel;port=channel.port2;channel.port1.onmessage=listener;defer=ctx(port.postMessage,port,1);}else if(global.addEventListener&&typeof postMessage=='function'&&!global.importScripts){defer=function(id){global.postMessage(id+'','*');};global.addEventListener('message',listener,false);}else if(ONREADYSTATECHANGE in cel('script')){defer=function(id){html.appendChild(cel('script'))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run.call(id);};};}else{defer=function(id){setTimeout(ctx(run,id,1),0);};}}
module.exports={set:setTask,clear:clearTask};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15);module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&typeof(fn=it.toString)=='function'&&!isObject(val=fn.call(it)))return val;if(typeof(fn=it.valueOf)=='function'&&!isObject(val=fn.call(it)))return val;if(!S&&typeof(fn=it.toString)=='function'&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value");};}),(function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_87__;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _mixed=__webpack_require__(20);var _object=__webpack_require__(1);function DefaultSettings(){};DefaultSettings.prototype={data:void 0,dataSchema:void 0,width:void 0,height:void 0,startRows:5,startCols:5,rowHeaders:void 0,colHeaders:null,colWidths:void 0,rowHeights:void 0,columns:void 0,cells:void 0,cell:[],comments:false,customBorders:false,minRows:0,minCols:0,maxRows:Infinity,maxCols:Infinity,minSpareRows:0,minSpareCols:0,allowInsertRow:true,allowInsertColumn:true,allowRemoveRow:true,allowRemoveColumn:true,multiSelect:true,fillHandle:true,fixedRowsTop:0,fixedRowsBottom:0,fixedColumnsLeft:0,outsideClickDeselects:true,enterBeginsEditing:true,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:false,autoWrapCol:false,persistentState:void 0,currentRowClassName:void 0,currentColClassName:void 0,currentHeaderClassName:'ht__highlight',className:void 0,tableClassName:void 0,stretchH:'none',isEmptyRow:function isEmptyRow(row){var col,colLen,value,meta;for(col=0,colLen=this.countCols();col<colLen;col++){value=this.getDataAtCell(row,col);if(value!==''&&value!==null&&(0,_mixed.isDefined)(value)){if((typeof value==='undefined'?'undefined':_typeof(value))==='object'){meta=this.getCellMeta(row,col);return(0,_object.isObjectEquals)(this.getSchema()[meta.prop],value);}
return false;}}
return true;},isEmptyCol:function isEmptyCol(col){var row,rowLen,value;for(row=0,rowLen=this.countRows();row<rowLen;row++){value=this.getDataAtCell(row,col);if(value!==''&&value!==null&&(0,_mixed.isDefined)(value)){return false;}}
return true;},observeDOMVisibility:true,allowInvalid:true,allowEmpty:true,invalidCellClassName:'htInvalid',placeholder:false,placeholderCellClassName:'htPlaceholder',readOnlyCellClassName:'htDimmed',renderer:void 0,commentedCellClassName:'htCommentCell',fragmentSelection:false,readOnly:false,skipColumnOnPaste:false,search:false,type:'text',copyable:true,editor:void 0,autoComplete:void 0,visibleRows:10,trimDropdown:true,debug:false,wordWrap:true,noWordWrapClassName:'htNoWrap',contextMenu:void 0,copyPaste:true,undo:void 0,columnSorting:void 0,manualColumnMove:void 0,manualColumnResize:void 0,manualRowMove:void 0,manualRowResize:void 0,mergeCells:false,viewportRowRenderingOffset:'auto',viewportColumnRenderingOffset:'auto',validator:void 0,disableVisualSelection:false,sortIndicator:void 0,manualColumnFreeze:void 0,trimWhitespace:true,settings:void 0,source:void 0,title:void 0,checkedTemplate:void 0,uncheckedTemplate:void 0,label:void 0,format:void 0,language:void 0,selectOptions:void 0,autoColumnSize:void 0,autoRowSize:void 0,dateFormat:void 0,correctFormat:false,defaultDate:void 0,strict:void 0,allowHtml:false,renderAllRows:void 0,preventOverflow:false,bindRowsWithHeaders:void 0,collapsibleColumns:void 0,columnSummary:void 0,dropdownMenu:void 0,filters:void 0,formulas:void 0,ganttChart:void 0,headerTooltips:void 0,hiddenColumns:void 0,hiddenRows:void 0,nestedHeaders:void 0,trimRows:void 0,rowHeaderWidth:void 0,columnHeaderHeight:void 0,observeChanges:void 0,sortFunction:void 0,sortByRelevance:true,filter:true,filteringCaseSensitive:false};exports.default=DefaultSettings;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getNormalizedDate=getNormalizedDate;function getNormalizedDate(dateString){var nativeDate=new Date(dateString);if(!isNaN(new Date(dateString+"T00:00").getDate())){return new Date(nativeDate.getTime()+nativeDate.getTimezoneOffset()*60000);}
return nativeDate;}}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.P,'Array',{copyWithin:__webpack_require__(277)});__webpack_require__(37)('copyWithin');}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.P,'Array',{fill:__webpack_require__(278)});__webpack_require__(37)('fill');}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),$find=__webpack_require__(52)(6),KEY='findIndex',forced=true;if(KEY in[])Array(1)[KEY](function(){forced=false;});$export($export.P+$export.F*forced,'Array',{findIndex:function findIndex(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined);}});__webpack_require__(37)(KEY);}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),$find=__webpack_require__(52)(5),KEY='find',forced=true;if(KEY in[])Array(1)[KEY](function(){forced=false;});$export($export.P+$export.F*forced,'Array',{find:function find(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined);}});__webpack_require__(37)(KEY);}),(function(module,exports,__webpack_require__){"use strict";var ctx=__webpack_require__(29),$export=__webpack_require__(3),toObject=__webpack_require__(41),call=__webpack_require__(165),isArrayIter=__webpack_require__(161),toLength=__webpack_require__(24),createProperty=__webpack_require__(73),getIterFn=__webpack_require__(176);$export($export.S+$export.F*!__webpack_require__(78)(function(iter){Array.from(iter);}),'Array',{from:function from(arrayLike){var O=toObject(arrayLike),C=typeof this=='function'?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:undefined,mapping=mapfn!==undefined,index=0,iterFn=getIterFn(O),length,result,step,iterator;if(mapping)mapfn=ctx(mapfn,aLen>2?arguments[2]:undefined,2);if(iterFn!=undefined&&!(C==Array&&isArrayIter(iterFn))){for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++){createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],true):step.value);}}else{length=toLength(O.length);for(result=new C(length);length>index;index++){createProperty(result,index,mapping?mapfn(O[index],index):O[index]);}}
result.length=index;return result;}});}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),createProperty=__webpack_require__(73);$export($export.S+$export.F*__webpack_require__(31)(function(){function F(){}
return!(Array.of.call(F)instanceof F);}),'Array',{of:function of(){var index=0,aLen=arguments.length,result=new(typeof this=='function'?this:Array)(aLen);while(aLen>index)createProperty(result,index,arguments[index++]);result.length=aLen;return result;}});}),(function(module,exports,__webpack_require__){var dP=__webpack_require__(19).f,createDesc=__webpack_require__(40),has=__webpack_require__(22),FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME='name';var isExtensible=Object.isExtensible||function(){return true;};NAME in FProto||__webpack_require__(21)&&dP(FProto,NAME,{configurable:true,get:function(){try{var that=this,name=(''+that).match(nameRE)[1];has(that,NAME)||!isExtensible(that)||dP(that,NAME,createDesc(5,name));return name;}catch(e){return'';}}});}),(function(module,exports,__webpack_require__){"use strict";var strong=__webpack_require__(157);module.exports=__webpack_require__(53)('Map',function(get){return function Map(){return get(this,arguments.length>0?arguments[0]:undefined);};},{get:function get(key){var entry=strong.getEntry(this,key);return entry&&entry.v;},set:function set(key,value){return strong.def(this,key===0?0:key,value);}},strong,true);}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Number',{EPSILON:Math.pow(2,-52)});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),_isFinite=__webpack_require__(13).isFinite;$export($export.S,'Number',{isFinite:function isFinite(it){return typeof it=='number'&&_isFinite(it);}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Number',{isInteger:__webpack_require__(163)});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Number',{isNaN:function isNaN(number){return number!=number;}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),isInteger=__webpack_require__(163),abs=Math.abs;$export($export.S,'Number',{isSafeInteger:function isSafeInteger(number){return isInteger(number)&&abs(number)<=0x1fffffffffffff;}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Number',{MAX_SAFE_INTEGER:0x1fffffffffffff});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Number',{MIN_SAFE_INTEGER:-0x1fffffffffffff});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S+$export.F,'Object',{assign:__webpack_require__(168)});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Object',{is:__webpack_require__(292)});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.S,'Object',{setPrototypeOf:__webpack_require__(171).set});}),(function(module,exports,__webpack_require__){"use strict";var LIBRARY=__webpack_require__(56),global=__webpack_require__(13),ctx=__webpack_require__(29),classof=__webpack_require__(156),$export=__webpack_require__(3),isObject=__webpack_require__(15),aFunction=__webpack_require__(72),anInstance=__webpack_require__(51),forOf=__webpack_require__(55),speciesConstructor=__webpack_require__(293),task=__webpack_require__(85).set,microtask=__webpack_require__(287)(),PROMISE='Promise',TypeError=global.TypeError,process=global.process,$Promise=global[PROMISE],process=global.process,isNode=classof(process)=='process',empty=function(){},Internal,GenericPromiseCapability,Wrapper;var USE_NATIVE=!!function(){try{var promise=$Promise.resolve(1),FakePromise=(promise.constructor={})[__webpack_require__(10)('species')]=function(exec){exec(empty,empty);};return(isNode||typeof PromiseRejectionEvent=='function')&&promise.then(empty)instanceof FakePromise;}catch(e){}}();var sameConstructor=function(a,b){return a===b||a===$Promise&&b===Wrapper;};var isThenable=function(it){var then;return isObject(it)&&typeof(then=it.then)=='function'?then:false;};var newPromiseCapability=function(C){return sameConstructor($Promise,C)?new PromiseCapability(C):new GenericPromiseCapability(C);};var PromiseCapability=GenericPromiseCapability=function(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(resolve!==undefined||reject!==undefined)throw TypeError('Bad Promise constructor');resolve=$$resolve;reject=$$reject;});this.resolve=aFunction(resolve);this.reject=aFunction(reject);};var perform=function(exec){try{exec();}catch(e){return{error:e};}};var notify=function(promise,isReject){if(promise._n)return;promise._n=true;var chain=promise._c;microtask(function(){var value=promise._v,ok=promise._s==1,i=0;var run=function(reaction){var handler=ok?reaction.ok:reaction.fail,resolve=reaction.resolve,reject=reaction.reject,domain=reaction.domain,result,then;try{if(handler){if(!ok){if(promise._h==2)onHandleUnhandled(promise);promise._h=1;}
if(handler===true)result=value;else{if(domain)domain.enter();result=handler(value);if(domain)domain.exit();}
if(result===reaction.promise){reject(TypeError('Promise-chain cycle'));}else if(then=isThenable(result)){then.call(result,resolve,reject);}else resolve(result);}else reject(value);}catch(e){reject(e);}};while(chain.length>i)run(chain[i++]);promise._c=[];promise._n=false;if(isReject&&!promise._h)onUnhandled(promise);});};var onUnhandled=function(promise){task.call(global,function(){var value=promise._v,abrupt,handler,console;if(isUnhandled(promise)){abrupt=perform(function(){if(isNode){process.emit('unhandledRejection',value,promise);}else if(handler=global.onunhandledrejection){handler({promise:promise,reason:value});}else if((console=global.console)&&console.error){console.error('Unhandled promise rejection',value);}});promise._h=isNode||isUnhandled(promise)?2:1;}promise._a=undefined;if(abrupt)throw abrupt.error;});};var isUnhandled=function(promise){if(promise._h==1)return false;var chain=promise._a||promise._c,i=0,reaction;while(chain.length>i){reaction=chain[i++];if(reaction.fail||!isUnhandled(reaction.promise))return false;}return true;};var onHandleUnhandled=function(promise){task.call(global,function(){var handler;if(isNode){process.emit('rejectionHandled',promise);}else if(handler=global.onrejectionhandled){handler({promise:promise,reason:promise._v});}});};var $reject=function(value){var promise=this;if(promise._d)return;promise._d=true;promise=promise._w||promise;promise._v=value;promise._s=2;if(!promise._a)promise._a=promise._c.slice();notify(promise,true);};var $resolve=function(value){var promise=this,then;if(promise._d)return;promise._d=true;promise=promise._w||promise;try{if(promise===value)throw TypeError("Promise can't be resolved itself");if(then=isThenable(value)){microtask(function(){var wrapper={_w:promise,_d:false};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1));}catch(e){$reject.call(wrapper,e);}});}else{promise._v=value;promise._s=1;notify(promise,false);}}catch(e){$reject.call({_w:promise,_d:false},e);}};if(!USE_NATIVE){$Promise=function Promise(executor){anInstance(this,$Promise,PROMISE,'_h');aFunction(executor);Internal.call(this);try{executor(ctx($resolve,this,1),ctx($reject,this,1));}catch(err){$reject.call(this,err);}};Internal=function Promise(executor){this._c=[];this._a=undefined;this._s=0;this._d=false;this._v=undefined;this._h=0;this._n=false;};Internal.prototype=__webpack_require__(58)($Promise.prototype,{then:function then(onFulfilled,onRejected){var reaction=newPromiseCapability(speciesConstructor(this,$Promise));reaction.ok=typeof onFulfilled=='function'?onFulfilled:true;reaction.fail=typeof onRejected=='function'&&onRejected;reaction.domain=isNode?process.domain:undefined;this._c.push(reaction);if(this._a)this._a.push(reaction);if(this._s)notify(this,false);return reaction.promise;},'catch':function(onRejected){return this.then(undefined,onRejected);}});PromiseCapability=function(){var promise=new Internal;this.promise=promise;this.resolve=ctx($resolve,promise,1);this.reject=ctx($reject,promise,1);};}
$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise});__webpack_require__(48)($Promise,PROMISE);__webpack_require__(172)(PROMISE);Wrapper=__webpack_require__(44)[PROMISE];$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function reject(r){var capability=newPromiseCapability(this),$$reject=capability.reject;$$reject(r);return capability.promise;}});$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{resolve:function resolve(x){if(x instanceof $Promise&&sameConstructor(x.constructor,this))return x;var capability=newPromiseCapability(this),$$resolve=capability.resolve;$$resolve(x);return capability.promise;}});$export($export.S+$export.F*!(USE_NATIVE&&__webpack_require__(78)(function(iter){$Promise.all(iter)['catch'](empty);})),PROMISE,{all:function all(iterable){var C=this,capability=newPromiseCapability(C),resolve=capability.resolve,reject=capability.reject;var abrupt=perform(function(){var values=[],index=0,remaining=1;forOf(iterable,false,function(promise){var $index=index++,alreadyCalled=false;values.push(undefined);remaining++;C.resolve(promise).then(function(value){if(alreadyCalled)return;alreadyCalled=true;values[$index]=value;--remaining||resolve(values);},reject);});--remaining||resolve(values);});if(abrupt)reject(abrupt.error);return capability.promise;},race:function race(iterable){var C=this,capability=newPromiseCapability(C),reject=capability.reject;var abrupt=perform(function(){forOf(iterable,false,function(promise){C.resolve(promise).then(capability.resolve,reject);});});if(abrupt)reject(abrupt.error);return capability.promise;}});}),(function(module,exports,__webpack_require__){if(__webpack_require__(21)&&/./g.flags!='g')__webpack_require__(19).f(RegExp.prototype,'flags',{configurable:true,get:__webpack_require__(282)});}),(function(module,exports,__webpack_require__){__webpack_require__(54)('match',1,function(defined,MATCH,$match){return[function match(regexp){'use strict';var O=defined(this),fn=regexp==undefined?undefined:regexp[MATCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[MATCH](String(O));},$match];});}),(function(module,exports,__webpack_require__){__webpack_require__(54)('replace',2,function(defined,REPLACE,$replace){return[function replace(searchValue,replaceValue){'use strict';var O=defined(this),fn=searchValue==undefined?undefined:searchValue[REPLACE];return fn!==undefined?fn.call(searchValue,O,replaceValue):$replace.call(String(O),searchValue,replaceValue);},$replace];});}),(function(module,exports,__webpack_require__){__webpack_require__(54)('search',1,function(defined,SEARCH,$search){return[function search(regexp){'use strict';var O=defined(this),fn=regexp==undefined?undefined:regexp[SEARCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[SEARCH](String(O));},$search];});}),(function(module,exports,__webpack_require__){__webpack_require__(54)('split',2,function(defined,SPLIT,$split){'use strict';var isRegExp=__webpack_require__(164),_split=$split,$push=[].push,$SPLIT='split',LENGTH='length',LAST_INDEX='lastIndex';if('abbc'[$SPLIT](/(b)*/)[1]=='c'||'test'[$SPLIT](/(?:)/,-1)[LENGTH]!=4||'ab'[$SPLIT](/(?:ab)*/)[LENGTH]!=2||'.'[$SPLIT](/(.?)(.?)/)[LENGTH]!=4||'.'[$SPLIT](/()()/)[LENGTH]>1||''[$SPLIT](/.?/)[LENGTH]){var NPCG=/()??/.exec('')[1]===undefined;$split=function(separator,limit){var string=String(this);if(separator===undefined&&limit===0)return[];if(!isRegExp(separator))return _split.call(string,separator,limit);var output=[];var flags=(separator.ignoreCase?'i':'')+
(separator.multiline?'m':'')+
(separator.unicode?'u':'')+
(separator.sticky?'y':'');var lastLastIndex=0;var splitLimit=limit===undefined?4294967295:limit>>>0;var separatorCopy=new RegExp(separator.source,flags+'g');var separator2,match,lastIndex,lastLength,i;if(!NPCG)separator2=new RegExp('^'+separatorCopy.source+'$(?!\\s)',flags);while(match=separatorCopy.exec(string)){lastIndex=match.index+match[0][LENGTH];if(lastIndex>lastLastIndex){output.push(string.slice(lastLastIndex,match.index));if(!NPCG&&match[LENGTH]>1)match[0].replace(separator2,function(){for(i=1;i<arguments[LENGTH]-2;i++)if(arguments[i]===undefined)match[i]=undefined;});if(match[LENGTH]>1&&match.index<string[LENGTH])$push.apply(output,match.slice(1));lastLength=match[0][LENGTH];lastLastIndex=lastIndex;if(output[LENGTH]>=splitLimit)break;}
if(separatorCopy[LAST_INDEX]===match.index)separatorCopy[LAST_INDEX]++;}
if(lastLastIndex===string[LENGTH]){if(lastLength||!separatorCopy.test(''))output.push('');}else output.push(string.slice(lastLastIndex));return output[LENGTH]>splitLimit?output.slice(0,splitLimit):output;};}else if('0'[$SPLIT](undefined,0)[LENGTH]){$split=function(separator,limit){return separator===undefined&&limit===0?[]:_split.call(this,separator,limit);};}
return[function split(separator,limit){var O=defined(this),fn=separator==undefined?undefined:separator[SPLIT];return fn!==undefined?fn.call(separator,O,limit):$split.call(String(O),separator,limit);},$split];});}),(function(module,exports,__webpack_require__){"use strict";var strong=__webpack_require__(157);module.exports=__webpack_require__(53)('Set',function(get){return function Set(){return get(this,arguments.length>0?arguments[0]:undefined);};},{add:function add(value){return strong.def(this,value=value===0?0:value,value);}},strong);}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),$at=__webpack_require__(294)(false);$export($export.P,'String',{codePointAt:function codePointAt(pos){return $at(this,pos);}});}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),toLength=__webpack_require__(24),context=__webpack_require__(84),ENDS_WITH='endsWith',$endsWith=''[ENDS_WITH];$export($export.P+$export.F*__webpack_require__(76)(ENDS_WITH),'String',{endsWith:function endsWith(searchString){var that=context(this,searchString,ENDS_WITH),endPosition=arguments.length>1?arguments[1]:undefined,len=toLength(that.length),end=endPosition===undefined?len:Math.min(toLength(endPosition),len),search=String(searchString);return $endsWith?$endsWith.call(that,search,end):that.slice(end-search.length,end)===search;}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),toIndex=__webpack_require__(59),fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint;$export($export.S+$export.F*(!!$fromCodePoint&&$fromCodePoint.length!=1),'String',{fromCodePoint:function fromCodePoint(x){var res=[],aLen=arguments.length,i=0,code;while(aLen>i){code=+arguments[i++];if(toIndex(code,0x10ffff)!==code)throw RangeError(code+' is not a valid code point');res.push(code<0x10000?fromCharCode(code):fromCharCode(((code-=0x10000)>>10)+0xd800,code%0x400+0xdc00));}return res.join('');}});}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),context=__webpack_require__(84),INCLUDES='includes';$export($export.P+$export.F*__webpack_require__(76)(INCLUDES),'String',{includes:function includes(searchString){return!!~context(this,searchString,INCLUDES).indexOf(searchString,arguments.length>1?arguments[1]:undefined);}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),toIObject=__webpack_require__(23),toLength=__webpack_require__(24);$export($export.S,'String',{raw:function raw(callSite){var tpl=toIObject(callSite.raw),len=toLength(tpl.length),aLen=arguments.length,res=[],i=0;while(len>i){res.push(String(tpl[i++]));if(i<aLen)res.push(String(arguments[i]));}return res.join('');}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3);$export($export.P,'String',{repeat:__webpack_require__(174)});}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),toLength=__webpack_require__(24),context=__webpack_require__(84),STARTS_WITH='startsWith',$startsWith=''[STARTS_WITH];$export($export.P+$export.F*__webpack_require__(76)(STARTS_WITH),'String',{startsWith:function startsWith(searchString){var that=context(this,searchString,STARTS_WITH),index=toLength(Math.min(arguments.length>1?arguments[1]:undefined,that.length)),search=String(searchString);return $startsWith?$startsWith.call(that,search,index):that.slice(index,index+search.length)===search;}});}),(function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(13),has=__webpack_require__(22),DESCRIPTORS=__webpack_require__(21),$export=__webpack_require__(3),redefine=__webpack_require__(33),META=__webpack_require__(46).KEY,$fails=__webpack_require__(31),shared=__webpack_require__(83),setToStringTag=__webpack_require__(48),uid=__webpack_require__(49),wks=__webpack_require__(10),wksExt=__webpack_require__(175),wksDefine=__webpack_require__(295),keyOf=__webpack_require__(286),enumKeys=__webpack_require__(281),isArray=__webpack_require__(162),anObject=__webpack_require__(18),toIObject=__webpack_require__(23),toPrimitive=__webpack_require__(86),createDesc=__webpack_require__(40),_create=__webpack_require__(79),gOPNExt=__webpack_require__(289),$GOPD=__webpack_require__(80),$DP=__webpack_require__(19),$keys=__webpack_require__(39),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE='prototype',HIDDEN=wks('_hidden'),TO_PRIMITIVE=wks('toPrimitive'),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared('symbol-registry'),AllSymbols=shared('symbols'),OPSymbols=shared('op-symbols'),ObjectProto=Object[PROTOTYPE],USE_NATIVE=typeof $Symbol=='function',QObject=global.QObject;var setter=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild;var setSymbolDesc=DESCRIPTORS&&$fails(function(){return _create(dP({},'a',{get:function(){return dP(this,'a',{value:7}).a;}})).a!=7;})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);if(protoDesc)delete ObjectProto[key];dP(it,key,D);if(protoDesc&&it!==ObjectProto)dP(ObjectProto,key,protoDesc);}:dP;var wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol[PROTOTYPE]);sym._k=tag;return sym;};var isSymbol=USE_NATIVE&&typeof $Symbol.iterator=='symbol'?function(it){return typeof it=='symbol';}:function(it){return it instanceof $Symbol;};var $defineProperty=function defineProperty(it,key,D){if(it===ObjectProto)$defineProperty(OPSymbols,key,D);anObject(it);key=toPrimitive(key,true);anObject(D);if(has(AllSymbols,key)){if(!D.enumerable){if(!has(it,HIDDEN))dP(it,HIDDEN,createDesc(1,{}));it[HIDDEN][key]=true;}else{if(has(it,HIDDEN)&&it[HIDDEN][key])it[HIDDEN][key]=false;D=_create(D,{enumerable:createDesc(0,false)});}return setSymbolDesc(it,key,D);}return dP(it,key,D);};var $defineProperties=function defineProperties(it,P){anObject(it);var keys=enumKeys(P=toIObject(P)),i=0,l=keys.length,key;while(l>i)$defineProperty(it,key=keys[i++],P[key]);return it;};var $create=function create(it,P){return P===undefined?_create(it):$defineProperties(_create(it),P);};var $propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=toPrimitive(key,true));if(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return false;return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:true;};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){it=toIObject(it);key=toPrimitive(key,true);if(it===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))return;var D=gOPD(it,key);if(D&&has(AllSymbols,key)&&!(has(it,HIDDEN)&&it[HIDDEN][key]))D.enumerable=true;return D;};var $getOwnPropertyNames=function getOwnPropertyNames(it){var names=gOPN(toIObject(it)),result=[],i=0,key;while(names.length>i){if(!has(AllSymbols,key=names[i++])&&key!=HIDDEN&&key!=META)result.push(key);}return result;};var $getOwnPropertySymbols=function getOwnPropertySymbols(it){var IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0,key;while(names.length>i){if(has(AllSymbols,key=names[i++])&&(IS_OP?has(ObjectProto,key):true))result.push(AllSymbols[key]);}return result;};if(!USE_NATIVE){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError('Symbol is not a constructor!');var tag=uid(arguments.length>0?arguments[0]:undefined);var $set=function(value){if(this===ObjectProto)$set.call(OPSymbols,value);if(has(this,HIDDEN)&&has(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDesc(this,tag,createDesc(1,value));};if(DESCRIPTORS&&setter)setSymbolDesc(ObjectProto,tag,{configurable:true,set:$set});return wrap(tag);};redefine($Symbol[PROTOTYPE],'toString',function toString(){return this._k;});$GOPD.f=$getOwnPropertyDescriptor;$DP.f=$defineProperty;__webpack_require__(81).f=gOPNExt.f=$getOwnPropertyNames;__webpack_require__(47).f=$propertyIsEnumerable;__webpack_require__(57).f=$getOwnPropertySymbols;if(DESCRIPTORS&&!__webpack_require__(56)){redefine(ObjectProto,'propertyIsEnumerable',$propertyIsEnumerable,true);}
wksExt.f=function(name){return wrap(wks(name));}}
$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var symbols=('hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables').split(','),i=0;symbols.length>i;)wks(symbols[i++]);for(var symbols=$keys(wks.store),i=0;symbols.length>i;)wksDefine(symbols[i++]);$export($export.S+$export.F*!USE_NATIVE,'Symbol',{'for':function(key){return has(SymbolRegistry,key+='')?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key);},keyFor:function keyFor(key){if(isSymbol(key))return keyOf(SymbolRegistry,key);throw TypeError(key+' is not a symbol!');},useSetter:function(){setter=true;},useSimple:function(){setter=false;}});$export($export.S+$export.F*!USE_NATIVE,'Object',{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return _stringify([S])!='[null]'||_stringify({a:S})!='{}'||_stringify(Object(S))!='{}';})),'JSON',{stringify:function stringify(it){if(it===undefined||isSymbol(it))return;var args=[it],i=1,replacer,$replacer;while(arguments.length>i)args.push(arguments[i++]);replacer=args[1];if(typeof replacer=='function')$replacer=replacer;if($replacer||!isArray(replacer))replacer=function(key,value){if($replacer)value=$replacer.call(this,key,value);if(!isSymbol(value))return value;};args[1]=replacer;return _stringify.apply($JSON,args);}});$Symbol[PROTOTYPE][TO_PRIMITIVE]||__webpack_require__(32)($Symbol[PROTOTYPE],TO_PRIMITIVE,$Symbol[PROTOTYPE].valueOf);setToStringTag($Symbol,'Symbol');setToStringTag(Math,'Math',true);setToStringTag(global.JSON,'JSON',true);}),(function(module,exports,__webpack_require__){"use strict";var each=__webpack_require__(52)(0),redefine=__webpack_require__(33),meta=__webpack_require__(46),assign=__webpack_require__(168),weak=__webpack_require__(158),isObject=__webpack_require__(15),getWeak=meta.getWeak,isExtensible=Object.isExtensible,uncaughtFrozenStore=weak.ufstore,tmp={},InternalMap;var wrapper=function(get){return function WeakMap(){return get(this,arguments.length>0?arguments[0]:undefined);};};var methods={get:function get(key){if(isObject(key)){var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this).get(key);return data?data[this._i]:undefined;}},set:function set(key,value){return weak.def(this,key,value);}};var $WeakMap=module.exports=__webpack_require__(53)('WeakMap',wrapper,methods,weak,true,true);if(new $WeakMap().set((Object.freeze||Object)(tmp),7).get(tmp)!=7){InternalMap=weak.getConstructor(wrapper);assign(InternalMap.prototype,methods);meta.NEED=true;each(['delete','has','get','set'],function(key){var proto=$WeakMap.prototype,method=proto[key];redefine(proto,key,function(a,b){if(isObject(a)&&!isExtensible(a)){if(!this._f)this._f=new InternalMap;var result=this._f[key](a,b);return key=='set'?this:result;}return method.call(this,a,b);});});}}),(function(module,exports,__webpack_require__){"use strict";var weak=__webpack_require__(158);__webpack_require__(53)('WeakSet',function(get){return function WeakSet(){return get(this,arguments.length>0?arguments[0]:undefined);};},{add:function add(value){return weak.def(this,value,true);}},weak,false,true);}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),$includes=__webpack_require__(155)(true);$export($export.P,'Array',{includes:function includes(el){return $includes(this,el,arguments.length>1?arguments[1]:undefined);}});__webpack_require__(37)('includes');}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),$entries=__webpack_require__(170)(true);$export($export.S,'Object',{entries:function entries(it){return $entries(it);}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),ownKeys=__webpack_require__(291),toIObject=__webpack_require__(23),gOPD=__webpack_require__(80),createProperty=__webpack_require__(73);$export($export.S,'Object',{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var O=toIObject(object),getDesc=gOPD.f,keys=ownKeys(O),result={},i=0,key;while(keys.length>i)createProperty(result,key=keys[i++],getDesc(O,key));return result;}});}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),$values=__webpack_require__(170)(false);$export($export.S,'Object',{values:function values(it){return $values(it);}});}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),$pad=__webpack_require__(173);$export($export.P,'String',{padEnd:function padEnd(maxLength){return $pad(this,maxLength,arguments.length>1?arguments[1]:undefined,false);}});}),(function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(3),$pad=__webpack_require__(173);$export($export.P,'String',{padStart:function padStart(maxLength){return $pad(this,maxLength,arguments.length>1?arguments[1]:undefined,true);}});}),(function(module,exports,__webpack_require__){var $iterators=__webpack_require__(67),redefine=__webpack_require__(33),global=__webpack_require__(13),hide=__webpack_require__(32),Iterators=__webpack_require__(45),wks=__webpack_require__(10),ITERATOR=wks('iterator'),TO_STRING_TAG=wks('toStringTag'),ArrayValues=Iterators.Array;for(var collections=['NodeList','DOMTokenList','MediaList','StyleSheetList','CSSRuleList'],i=0;i<5;i++){var NAME=collections[i],Collection=global[NAME],proto=Collection&&Collection.prototype,key;if(proto){if(!proto[ITERATOR])hide(proto,ITERATOR,ArrayValues);if(!proto[TO_STRING_TAG])hide(proto,TO_STRING_TAG,NAME);Iterators[NAME]=ArrayValues;for(key in $iterators)if(!proto[key])redefine(proto,key,$iterators[key],true);}}}),(function(module,exports,__webpack_require__){var $export=__webpack_require__(3),$task=__webpack_require__(85);$export($export.G+$export.B,{setImmediate:$task.set,clearImmediate:$task.clear});}),(function(module,exports,__webpack_require__){"use strict";(function(global){"use strict";function countQuotes(str){return str.split('"').length-1;}
var SheetClip={parse:function parse(str){var r,rLen,rows,arr=[],a=0,c,cLen,multiline,last;rows=str.split('\n');if(rows.length>1&&rows[rows.length-1]===''){rows.pop();}
for(r=0,rLen=rows.length;r<rLen;r+=1){rows[r]=rows[r].split('\t');for(c=0,cLen=rows[r].length;c<cLen;c+=1){if(!arr[a]){arr[a]=[];}
if(multiline&&c===0){last=arr[a].length-1;arr[a][last]=arr[a][last]+'\n'+rows[r][0];if(multiline&&countQuotes(rows[r][0])&1){multiline=false;arr[a][last]=arr[a][last].substring(0,arr[a][last].length-1).replace(/""/g,'"');}}else{if(c===cLen-1&&rows[r][c].indexOf('"')===0&&countQuotes(rows[r][c])&1){arr[a].push(rows[r][c].substring(1).replace(/""/g,'"'));multiline=true;}else{arr[a].push(rows[r][c].replace(/""/g,'"'));multiline=false;}}}
if(!multiline){a+=1;}}
return arr;},stringify:function stringify(arr){var r,rLen,c,cLen,str='',val;for(r=0,rLen=arr.length;r<rLen;r+=1){cLen=arr[r].length;for(c=0;c<cLen;c+=1){if(c>0){str+='\t';}
val=arr[r][c];if(typeof val==='string'){if(val.indexOf('\n')>-1){str+='"'+val.replace(/"/g,'""')+'"';}else{str+=val;}}else if(val===null||val===void 0){str+='';}else{str+=val;}}
if(r!==rLen-1){str+='\n';}}
return str;}};if(true){exports.parse=SheetClip.parse;exports.stringify=SheetClip.stringify;}else{global.SheetClip=SheetClip;}})(window);}),(function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var __extends=undefined&&undefined.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p];}function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var OriginalError=Error;var jsonpatch;(function(jsonpatch){var _objectKeys=function _objectKeys(obj){if(_isArray(obj)){var keys=new Array(obj.length);for(var k=0;k<keys.length;k++){keys[k]=""+k;}
return keys;}
if(Object.keys){return Object.keys(obj);}
var keys=[];for(var i in obj){if(obj.hasOwnProperty(i)){keys.push(i);}}
return keys;};function _equals(a,b){switch(typeof a==='undefined'?'undefined':_typeof(a)){case'undefined':case'boolean':case'string':case'number':return a===b;case'object':if(a===null)return b===null;if(_isArray(a)){if(!_isArray(b)||a.length!==b.length)return false;for(var i=0,l=a.length;i<l;i++){if(!_equals(a[i],b[i]))return false;}return true;}
var bKeys=_objectKeys(b);var bLength=bKeys.length;if(_objectKeys(a).length!==bLength)return false;for(var i=0;i<bLength;i++){if(!_equals(a[i],b[i]))return false;}return true;default:return false;}}
var objOps={add:function add(obj,key){obj[key]=this.value;return true;},remove:function remove(obj,key){delete obj[key];return true;},replace:function replace(obj,key){obj[key]=this.value;return true;},move:function move(obj,key,tree){var temp={op:"_get",path:this.from};apply(tree,[temp]);apply(tree,[{op:"remove",path:this.from}]);apply(tree,[{op:"add",path:this.path,value:temp.value}]);return true;},copy:function copy(obj,key,tree){var temp={op:"_get",path:this.from};apply(tree,[temp]);apply(tree,[{op:"add",path:this.path,value:temp.value}]);return true;},test:function test(obj,key){return _equals(obj[key],this.value);},_get:function _get(obj,key){this.value=obj[key];}};var arrOps={add:function add(arr,i){arr.splice(i,0,this.value);return true;},remove:function remove(arr,i){arr.splice(i,1);return true;},replace:function replace(arr,i){arr[i]=this.value;return true;},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};var rootOps={add:function add(obj){rootOps.remove.call(this,obj);for(var key in this.value){if(this.value.hasOwnProperty(key)){obj[key]=this.value[key];}}
return true;},remove:function remove(obj){for(var key in obj){if(obj.hasOwnProperty(key)){objOps.remove.call(this,obj,key);}}
return true;},replace:function replace(obj){apply(obj,[{op:"remove",path:this.path}]);apply(obj,[{op:"add",path:this.path,value:this.value}]);return true;},move:objOps.move,copy:objOps.copy,test:function test(obj){return JSON.stringify(obj)===JSON.stringify(this.value);},_get:function _get(obj){this.value=obj;}};var observeOps={add:function add(patches,path){var patch={op:"add",path:path+escapePathComponent(this.name),value:this.object[this.name]};patches.push(patch);},'delete':function _delete(patches,path){var patch={op:"remove",path:path+escapePathComponent(this.name)};patches.push(patch);},update:function update(patches,path){var patch={op:"replace",path:path+escapePathComponent(this.name),value:this.object[this.name]};patches.push(patch);}};function escapePathComponent(str){if(str.indexOf('/')===-1&&str.indexOf('~')===-1)return str;return str.replace(/~/g,'~0').replace(/\//g,'~1');}
function _getPathRecursive(root,obj){var found;for(var key in root){if(root.hasOwnProperty(key)){if(root[key]===obj){return escapePathComponent(key)+'/';}else if(_typeof(root[key])==='object'){found=_getPathRecursive(root[key],obj);if(found!=''){return escapePathComponent(key)+'/'+found;}}}}
return'';}
function getPath(root,obj){if(root===obj){return'/';}
var path=_getPathRecursive(root,obj);if(path===''){throw new OriginalError("Object not found in root");}
return'/'+path;}
var beforeDict=[];var Mirror=function(){function Mirror(obj){this.observers=[];this.obj=obj;}
return Mirror;}();var ObserverInfo=function(){function ObserverInfo(callback,observer){this.callback=callback;this.observer=observer;}
return ObserverInfo;}();function getMirror(obj){for(var i=0,ilen=beforeDict.length;i<ilen;i++){if(beforeDict[i].obj===obj){return beforeDict[i];}}}
function getObserverFromMirror(mirror,callback){for(var j=0,jlen=mirror.observers.length;j<jlen;j++){if(mirror.observers[j].callback===callback){return mirror.observers[j].observer;}}}
function removeObserverFromMirror(mirror,observer){for(var j=0,jlen=mirror.observers.length;j<jlen;j++){if(mirror.observers[j].observer===observer){mirror.observers.splice(j,1);return;}}}
function unobserve(root,observer){observer.unobserve();}
jsonpatch.unobserve=unobserve;function deepClone(obj){if((typeof obj==='undefined'?'undefined':_typeof(obj))==="object"){return JSON.parse(JSON.stringify(obj));}else{return obj;}}
function observe(obj,callback){var patches=[];var root=obj;var observer;var mirror=getMirror(obj);if(!mirror){mirror=new Mirror(obj);beforeDict.push(mirror);}else{observer=getObserverFromMirror(mirror,callback);}
if(observer){return observer;}
observer={};mirror.value=deepClone(obj);if(callback){observer.callback=callback;observer.next=null;var intervals=this.intervals||[100,1000,10000,60000];if(intervals.push===void 0){throw new OriginalError("jsonpatch.intervals must be an array");}
var currentInterval=0;var dirtyCheck=function dirtyCheck(){generate(observer);};var fastCheck=function fastCheck(){clearTimeout(observer.next);observer.next=setTimeout(function(){dirtyCheck();currentInterval=0;observer.next=setTimeout(slowCheck,intervals[currentInterval++]);},0);};var slowCheck=function slowCheck(){dirtyCheck();if(currentInterval==intervals.length)currentInterval=intervals.length-1;observer.next=setTimeout(slowCheck,intervals[currentInterval++]);};if(typeof window!=='undefined'){if(window.addEventListener){window.addEventListener('mousedown',fastCheck);window.addEventListener('mouseup',fastCheck);window.addEventListener('keydown',fastCheck);}else{document.documentElement.attachEvent('onmousedown',fastCheck);document.documentElement.attachEvent('onmouseup',fastCheck);document.documentElement.attachEvent('onkeydown',fastCheck);}}
observer.next=setTimeout(slowCheck,intervals[currentInterval++]);}
observer.patches=patches;observer.object=obj;observer.unobserve=function(){generate(observer);clearTimeout(observer.next);removeObserverFromMirror(mirror,observer);if(typeof window!=='undefined'){if(window.removeEventListener){window.removeEventListener('mousedown',fastCheck);window.removeEventListener('mouseup',fastCheck);window.removeEventListener('keydown',fastCheck);}else{document.documentElement.detachEvent('onmousedown',fastCheck);document.documentElement.detachEvent('onmouseup',fastCheck);document.documentElement.detachEvent('onkeydown',fastCheck);}}};mirror.observers.push(new ObserverInfo(callback,observer));return observer;}
jsonpatch.observe=observe;function generate(observer){var mirror;for(var i=0,ilen=beforeDict.length;i<ilen;i++){if(beforeDict[i].obj===observer.object){mirror=beforeDict[i];break;}}
_generate(mirror.value,observer.object,observer.patches,"");if(observer.patches.length){apply(mirror.value,observer.patches);}
var temp=observer.patches;if(temp.length>0){observer.patches=[];if(observer.callback){observer.callback(temp);}}
return temp;}
jsonpatch.generate=generate;function _generate(mirror,obj,patches,path){var newKeys=_objectKeys(obj);var oldKeys=_objectKeys(mirror);var changed=false;var deleted=false;for(var t=oldKeys.length-1;t>=0;t--){var key=oldKeys[t];var oldVal=mirror[key];if(obj.hasOwnProperty(key)){var newVal=obj[key];if((typeof oldVal==='undefined'?'undefined':_typeof(oldVal))=="object"&&oldVal!=null&&(typeof newVal==='undefined'?'undefined':_typeof(newVal))=="object"&&newVal!=null){_generate(oldVal,newVal,patches,path+"/"+escapePathComponent(key));}else{if(oldVal!=newVal){changed=true;patches.push({op:"replace",path:path+"/"+escapePathComponent(key),value:deepClone(newVal)});}}}else{patches.push({op:"remove",path:path+"/"+escapePathComponent(key)});deleted=true;}}
if(!deleted&&newKeys.length==oldKeys.length){return;}
for(var t=0;t<newKeys.length;t++){var key=newKeys[t];if(!mirror.hasOwnProperty(key)){patches.push({op:"add",path:path+"/"+escapePathComponent(key),value:deepClone(obj[key])});}}}
var _isArray;if(Array.isArray){_isArray=Array.isArray;}else{_isArray=function _isArray(obj){return obj.push&&typeof obj.length==='number';};}
function isInteger(str){var i=0;var len=str.length;var charCode;while(i<len){charCode=str.charCodeAt(i);if(charCode>=48&&charCode<=57){i++;continue;}
return false;}
return true;}
function apply(tree,patches,validate){var result=false,p=0,plen=patches.length,patch,key;while(p<plen){patch=patches[p];p++;var path=patch.path||"";var keys=path.split('/');var obj=tree;var t=1;var len=keys.length;var existingPathFragment=undefined;while(true){key=keys[t];if(validate){if(existingPathFragment===undefined){if(obj[key]===undefined){existingPathFragment=keys.slice(0,t).join('/');}else if(t==len-1){existingPathFragment=patch.path;}
if(existingPathFragment!==undefined){this.validator(patch,p-1,tree,existingPathFragment);}}}
t++;if(key===undefined){if(t>=len){result=rootOps[patch.op].call(patch,obj,key,tree);break;}}
if(_isArray(obj)){if(key==='-'){key=obj.length;}else{if(validate&&!isInteger(key)){throw new JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",p-1,patch.path,patch);}
key=parseInt(key,10);}
if(t>=len){if(validate&&patch.op==="add"&&key>obj.length){throw new JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",p-1,patch.path,patch);}
result=arrOps[patch.op].call(patch,obj,key,tree);break;}}else{if(key&&key.indexOf('~')!=-1)key=key.replace(/~1/g,'/').replace(/~0/g,'~');if(t>=len){result=objOps[patch.op].call(patch,obj,key,tree);break;}}
obj=obj[key];}}
return result;}
jsonpatch.apply=apply;function compare(tree1,tree2){var patches=[];_generate(tree1,tree2,patches,'');return patches;}
jsonpatch.compare=compare;var JsonPatchError=function(_super){__extends(JsonPatchError,_super);function JsonPatchError(message,name,index,operation,tree){_super.call(this,message);this.message=message;this.name=name;this.index=index;this.operation=operation;this.tree=tree;}
return JsonPatchError;}(OriginalError);jsonpatch.JsonPatchError=JsonPatchError;jsonpatch.Error=JsonPatchError;function hasUndefined(obj){if(obj===undefined){return true;}
if(typeof obj=="array"||(typeof obj==='undefined'?'undefined':_typeof(obj))=="object"){for(var i in obj){if(hasUndefined(obj[i])){return true;}}}
return false;}
function validator(operation,index,tree,existingPathFragment){if((typeof operation==='undefined'?'undefined':_typeof(operation))!=='object'||operation===null||_isArray(operation)){throw new JsonPatchError('Operation is not an object','OPERATION_NOT_AN_OBJECT',index,operation,tree);}else if(!objOps[operation.op]){throw new JsonPatchError('Operation `op` property is not one of operations defined in RFC-6902','OPERATION_OP_INVALID',index,operation,tree);}else if(typeof operation.path!=='string'){throw new JsonPatchError('Operation `path` property is not a string','OPERATION_PATH_INVALID',index,operation,tree);}else if((operation.op==='move'||operation.op==='copy')&&typeof operation.from!=='string'){throw new JsonPatchError('Operation `from` property is not present (applicable in `move` and `copy` operations)','OPERATION_FROM_REQUIRED',index,operation,tree);}else if((operation.op==='add'||operation.op==='replace'||operation.op==='test')&&operation.value===undefined){throw new JsonPatchError('Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)','OPERATION_VALUE_REQUIRED',index,operation,tree);}else if((operation.op==='add'||operation.op==='replace'||operation.op==='test')&&hasUndefined(operation.value)){throw new JsonPatchError('Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)','OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED',index,operation,tree);}else if(tree){if(operation.op=="add"){var pathLen=operation.path.split("/").length;var existingPathLen=existingPathFragment.split("/").length;if(pathLen!==existingPathLen+1&&pathLen!==existingPathLen){throw new JsonPatchError('Cannot perform an `add` operation at the desired path','OPERATION_PATH_CANNOT_ADD',index,operation,tree);}}else if(operation.op==='replace'||operation.op==='remove'||operation.op==='_get'){if(operation.path!==existingPathFragment){throw new JsonPatchError('Cannot perform the operation at a path that does not exist','OPERATION_PATH_UNRESOLVABLE',index,operation,tree);}}else if(operation.op==='move'||operation.op==='copy'){var existingValue={op:"_get",path:operation.from,value:undefined};var error=jsonpatch.validate([existingValue],tree);if(error&&error.name==='OPERATION_PATH_UNRESOLVABLE'){throw new JsonPatchError('Cannot perform the operation from a path that does not exist','OPERATION_FROM_UNRESOLVABLE',index,operation,tree);}}}}
jsonpatch.validator=validator;function validate(sequence,tree){try{if(!_isArray(sequence)){throw new JsonPatchError('Patch sequence must be an array','SEQUENCE_NOT_AN_ARRAY');}
if(tree){tree=JSON.parse(JSON.stringify(tree));apply.call(this,tree,sequence,true);}else{for(var i=0;i<sequence.length;i++){this.validator(sequence[i],i);}}}catch(e){if(e instanceof JsonPatchError){return e;}else{throw e;}}}
jsonpatch.validate=validate;})(jsonpatch||(jsonpatch={}));if(true){exports.apply=jsonpatch.apply;exports.observe=jsonpatch.observe;exports.unobserve=jsonpatch.unobserve;exports.generate=jsonpatch.generate;exports.compare=jsonpatch.compare;exports.validate=jsonpatch.validate;exports.validator=jsonpatch.validator;exports.JsonPatchError=jsonpatch.JsonPatchError;exports.Error=jsonpatch.Error;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _event=__webpack_require__(7);var _object=__webpack_require__(1);var _browser=__webpack_require__(25);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _coords=__webpack_require__(42);var _coords2=_interopRequireDefault(_coords);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Border=function(){function Border(wotInstance,settings){_classCallCheck(this,Border);if(!settings){return;}
this.eventManager=new _eventManager2.default(wotInstance);this.instance=wotInstance;this.wot=wotInstance;this.settings=settings;this.mouseDown=false;this.main=null;this.top=null;this.left=null;this.bottom=null;this.right=null;this.topStyle=null;this.leftStyle=null;this.bottomStyle=null;this.rightStyle=null;this.cornerDefaultStyle={width:'5px',height:'5px',borderWidth:'2px',borderStyle:'solid',borderColor:'#FFF'};this.corner=null;this.cornerStyle=null;this.createBorders(settings);this.registerListeners();}
_createClass(Border,[{key:'registerListeners',value:function registerListeners(){var _this2=this;this.eventManager.addEventListener(document.body,'mousedown',function(){return _this2.onMouseDown();});this.eventManager.addEventListener(document.body,'mouseup',function(){return _this2.onMouseUp();});var _loop=function _loop(c,len){_this2.eventManager.addEventListener(_this2.main.childNodes[c],'mouseenter',function(event){return _this2.onMouseEnter(event,_this2.main.childNodes[c]);});};for(var c=0,len=this.main.childNodes.length;c<len;c++){_loop(c,len);}}},{key:'onMouseDown',value:function onMouseDown(){this.mouseDown=true;}},{key:'onMouseUp',value:function onMouseUp(){this.mouseDown=false;}},{key:'onMouseEnter',value:function onMouseEnter(event,parentElement){if(!this.mouseDown||!this.wot.getSetting('hideBorderOnMouseDownOver')){return;}
event.preventDefault();(0,_event.stopImmediatePropagation)(event);var _this=this;var bounds=parentElement.getBoundingClientRect();parentElement.style.display='none';function isOutside(event){if(event.clientY<Math.floor(bounds.top)){return true;}
if(event.clientY>Math.ceil(bounds.top+bounds.height)){return true;}
if(event.clientX<Math.floor(bounds.left)){return true;}
if(event.clientX>Math.ceil(bounds.left+bounds.width)){return true;}}
function handler(event){if(isOutside(event)){_this.eventManager.removeEventListener(document.body,'mousemove',handler);parentElement.style.display='block';}}
this.eventManager.addEventListener(document.body,'mousemove',handler);}},{key:'createBorders',value:function createBorders(settings){this.main=document.createElement('div');var borderDivs=['top','left','bottom','right','corner'];var style=this.main.style;style.position='absolute';style.top=0;style.left=0;for(var i=0;i<5;i++){var position=borderDivs[i];var div=document.createElement('div');div.className='wtBorder '+(this.settings.className||'');if(this.settings[position]&&this.settings[position].hide){div.className+=' hidden';}
style=div.style;style.backgroundColor=this.settings[position]&&this.settings[position].color?this.settings[position].color:settings.border.color;style.height=this.settings[position]&&this.settings[position].width?this.settings[position].width+'px':settings.border.width+'px';style.width=this.settings[position]&&this.settings[position].width?this.settings[position].width+'px':settings.border.width+'px';this.main.appendChild(div);}
this.top=this.main.childNodes[0];this.left=this.main.childNodes[1];this.bottom=this.main.childNodes[2];this.right=this.main.childNodes[3];this.topStyle=this.top.style;this.leftStyle=this.left.style;this.bottomStyle=this.bottom.style;this.rightStyle=this.right.style;this.corner=this.main.childNodes[4];this.corner.className+=' corner';this.cornerStyle=this.corner.style;this.cornerStyle.width=this.cornerDefaultStyle.width;this.cornerStyle.height=this.cornerDefaultStyle.height;this.cornerStyle.border=[this.cornerDefaultStyle.borderWidth,this.cornerDefaultStyle.borderStyle,this.cornerDefaultStyle.borderColor].join(' ');if((0,_browser.isMobileBrowser)()){this.createMultipleSelectorHandles();}
this.disappear();if(!this.wot.wtTable.bordersHolder){this.wot.wtTable.bordersHolder=document.createElement('div');this.wot.wtTable.bordersHolder.className='htBorders';this.wot.wtTable.spreader.appendChild(this.wot.wtTable.bordersHolder);}
this.wot.wtTable.bordersHolder.insertBefore(this.main,this.wot.wtTable.bordersHolder.firstChild);}},{key:'createMultipleSelectorHandles',value:function createMultipleSelectorHandles(){this.selectionHandles={topLeft:document.createElement('DIV'),topLeftHitArea:document.createElement('DIV'),bottomRight:document.createElement('DIV'),bottomRightHitArea:document.createElement('DIV')};var width=10;var hitAreaWidth=40;this.selectionHandles.topLeft.className='topLeftSelectionHandle';this.selectionHandles.topLeftHitArea.className='topLeftSelectionHandle-HitArea';this.selectionHandles.bottomRight.className='bottomRightSelectionHandle';this.selectionHandles.bottomRightHitArea.className='bottomRightSelectionHandle-HitArea';this.selectionHandles.styles={topLeft:this.selectionHandles.topLeft.style,topLeftHitArea:this.selectionHandles.topLeftHitArea.style,bottomRight:this.selectionHandles.bottomRight.style,bottomRightHitArea:this.selectionHandles.bottomRightHitArea.style};var hitAreaStyle={position:'absolute',height:hitAreaWidth+'px',width:hitAreaWidth+'px','border-radius':parseInt(hitAreaWidth/1.5,10)+'px'};for(var prop in hitAreaStyle){if((0,_object.hasOwnProperty)(hitAreaStyle,prop)){this.selectionHandles.styles.bottomRightHitArea[prop]=hitAreaStyle[prop];this.selectionHandles.styles.topLeftHitArea[prop]=hitAreaStyle[prop];}}
var handleStyle={position:'absolute',height:width+'px',width:width+'px','border-radius':parseInt(width/1.5,10)+'px',background:'#F5F5FF',border:'1px solid #4285c8'};for(var _prop in handleStyle){if((0,_object.hasOwnProperty)(handleStyle,_prop)){this.selectionHandles.styles.bottomRight[_prop]=handleStyle[_prop];this.selectionHandles.styles.topLeft[_prop]=handleStyle[_prop];}}
this.main.appendChild(this.selectionHandles.topLeft);this.main.appendChild(this.selectionHandles.bottomRight);this.main.appendChild(this.selectionHandles.topLeftHitArea);this.main.appendChild(this.selectionHandles.bottomRightHitArea);}},{key:'isPartRange',value:function isPartRange(row,col){if(this.wot.selections.area.cellRange){if(row!=this.wot.selections.area.cellRange.to.row||col!=this.wot.selections.area.cellRange.to.col){return true;}}
return false;}},{key:'updateMultipleSelectionHandlesPosition',value:function updateMultipleSelectionHandlesPosition(row,col,top,left,width,height){var handleWidth=parseInt(this.selectionHandles.styles.topLeft.width,10);var hitAreaWidth=parseInt(this.selectionHandles.styles.topLeftHitArea.width,10);this.selectionHandles.styles.topLeft.top=parseInt(top-handleWidth,10)+'px';this.selectionHandles.styles.topLeft.left=parseInt(left-handleWidth,10)+'px';this.selectionHandles.styles.topLeftHitArea.top=parseInt(top-hitAreaWidth/4*3,10)+'px';this.selectionHandles.styles.topLeftHitArea.left=parseInt(left-hitAreaWidth/4*3,10)+'px';this.selectionHandles.styles.bottomRight.top=parseInt(top+height,10)+'px';this.selectionHandles.styles.bottomRight.left=parseInt(left+width,10)+'px';this.selectionHandles.styles.bottomRightHitArea.top=parseInt(top+height-hitAreaWidth/4,10)+'px';this.selectionHandles.styles.bottomRightHitArea.left=parseInt(left+width-hitAreaWidth/4,10)+'px';if(this.settings.border.multipleSelectionHandlesVisible&&this.settings.border.multipleSelectionHandlesVisible()){this.selectionHandles.styles.topLeft.display='block';this.selectionHandles.styles.topLeftHitArea.display='block';if(this.isPartRange(row,col)){this.selectionHandles.styles.bottomRight.display='none';this.selectionHandles.styles.bottomRightHitArea.display='none';}else{this.selectionHandles.styles.bottomRight.display='block';this.selectionHandles.styles.bottomRightHitArea.display='block';}}else{this.selectionHandles.styles.topLeft.display='none';this.selectionHandles.styles.bottomRight.display='none';this.selectionHandles.styles.topLeftHitArea.display='none';this.selectionHandles.styles.bottomRightHitArea.display='none';}
if(row==this.wot.wtSettings.getSetting('fixedRowsTop')||col==this.wot.wtSettings.getSetting('fixedColumnsLeft')){this.selectionHandles.styles.topLeft.zIndex='9999';this.selectionHandles.styles.topLeftHitArea.zIndex='9999';}else{this.selectionHandles.styles.topLeft.zIndex='';this.selectionHandles.styles.topLeftHitArea.zIndex='';}}},{key:'appear',value:function appear(corners){if(this.disabled){return;}
var isMultiple,fromTD,toTD,fromOffset,toOffset,containerOffset,top,minTop,left,minLeft,height,width,fromRow,fromColumn,toRow,toColumn,trimmingContainer,cornerOverlappingContainer,ilen;ilen=this.wot.wtTable.getRenderedRowsCount();for(var i=0;i<ilen;i++){var s=this.wot.wtTable.rowFilter.renderedToSource(i);if(s>=corners[0]&&s<=corners[2]){fromRow=s;break;}}
for(var _i=ilen-1;_i>=0;_i--){var _s=this.wot.wtTable.rowFilter.renderedToSource(_i);if(_s>=corners[0]&&_s<=corners[2]){toRow=_s;break;}}
ilen=this.wot.wtTable.getRenderedColumnsCount();for(var _i2=0;_i2<ilen;_i2++){var _s2=this.wot.wtTable.columnFilter.renderedToSource(_i2);if(_s2>=corners[1]&&_s2<=corners[3]){fromColumn=_s2;break;}}
for(var _i3=ilen-1;_i3>=0;_i3--){var _s3=this.wot.wtTable.columnFilter.renderedToSource(_i3);if(_s3>=corners[1]&&_s3<=corners[3]){toColumn=_s3;break;}}
if(fromRow===void 0||fromColumn===void 0){this.disappear();return;}
isMultiple=fromRow!==toRow||fromColumn!==toColumn;fromTD=this.wot.wtTable.getCell(new _coords2.default(fromRow,fromColumn));toTD=isMultiple?this.wot.wtTable.getCell(new _coords2.default(toRow,toColumn)):fromTD;fromOffset=(0,_element.offset)(fromTD);toOffset=isMultiple?(0,_element.offset)(toTD):fromOffset;containerOffset=(0,_element.offset)(this.wot.wtTable.TABLE);minTop=fromOffset.top;height=toOffset.top+(0,_element.outerHeight)(toTD)-minTop;minLeft=fromOffset.left;width=toOffset.left+(0,_element.outerWidth)(toTD)-minLeft;top=minTop-containerOffset.top-1;left=minLeft-containerOffset.left-1;var style=(0,_element.getComputedStyle)(fromTD);if(parseInt(style.borderTopWidth,10)>0){top+=1;height=height>0?height-1:0;}
if(parseInt(style.borderLeftWidth,10)>0){left+=1;width=width>0?width-1:0;}
this.topStyle.top=top+'px';this.topStyle.left=left+'px';this.topStyle.width=width+'px';this.topStyle.display='block';this.leftStyle.top=top+'px';this.leftStyle.left=left+'px';this.leftStyle.height=height+'px';this.leftStyle.display='block';var delta=Math.floor(this.settings.border.width/2);this.bottomStyle.top=top+height-delta+'px';this.bottomStyle.left=left+'px';this.bottomStyle.width=width+'px';this.bottomStyle.display='block';this.rightStyle.top=top+'px';this.rightStyle.left=left+width-delta+'px';this.rightStyle.height=height+1+'px';this.rightStyle.display='block';if((0,_browser.isMobileBrowser)()||!this.hasSetting(this.settings.border.cornerVisible)||this.isPartRange(toRow,toColumn)){this.cornerStyle.display='none';}else{this.cornerStyle.top=top+height-4+'px';this.cornerStyle.left=left+width-4+'px';this.cornerStyle.borderRightWidth=this.cornerDefaultStyle.borderWidth;this.cornerStyle.width=this.cornerDefaultStyle.width;this.cornerStyle.display='none';trimmingContainer=(0,_element.getTrimmingContainer)(this.wot.wtTable.TABLE);if(toColumn===this.wot.getSetting('totalColumns')-1){cornerOverlappingContainer=toTD.offsetLeft+(0,_element.outerWidth)(toTD)+parseInt(this.cornerDefaultStyle.width,10)/2>=(0,_element.innerWidth)(trimmingContainer);if(cornerOverlappingContainer){this.cornerStyle.left=Math.floor(left+width-3-parseInt(this.cornerDefaultStyle.width,10)/2)+'px';this.cornerStyle.borderRightWidth=0;}}
if(toRow===this.wot.getSetting('totalRows')-1){cornerOverlappingContainer=toTD.offsetTop+(0,_element.outerHeight)(toTD)+parseInt(this.cornerDefaultStyle.height,10)/2>=(0,_element.innerHeight)(trimmingContainer);if(cornerOverlappingContainer){this.cornerStyle.top=Math.floor(top+height-3-parseInt(this.cornerDefaultStyle.height,10)/2)+'px';this.cornerStyle.borderBottomWidth=0;}}
this.cornerStyle.display='block';}
if((0,_browser.isMobileBrowser)()){this.updateMultipleSelectionHandlesPosition(fromRow,fromColumn,top,left,width,height);}}},{key:'disappear',value:function disappear(){this.topStyle.display='none';this.leftStyle.display='none';this.bottomStyle.display='none';this.rightStyle.display='none';this.cornerStyle.display='none';if((0,_browser.isMobileBrowser)()){this.selectionHandles.styles.topLeft.display='none';this.selectionHandles.styles.bottomRight.display='none';}}},{key:'hasSetting',value:function hasSetting(setting){if(typeof setting==='function'){return setting();}
return!!setting;}}]);return Border;}();exports.default=Border;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var privatePool=new WeakMap();var ViewportColumnsCalculator=function(){_createClass(ViewportColumnsCalculator,null,[{key:'DEFAULT_WIDTH',get:function get(){return 50;}}]);function ViewportColumnsCalculator(viewportWidth,scrollOffset,totalColumns,columnWidthFn,overrideFn,onlyFullyVisible,stretchH){var stretchingColumnWidthFn=arguments.length>7&&arguments[7]!==undefined?arguments[7]:function(width){return width;};_classCallCheck(this,ViewportColumnsCalculator);privatePool.set(this,{viewportWidth:viewportWidth,scrollOffset:scrollOffset,totalColumns:totalColumns,columnWidthFn:columnWidthFn,overrideFn:overrideFn,onlyFullyVisible:onlyFullyVisible,stretchingColumnWidthFn:stretchingColumnWidthFn});this.count=0;this.startColumn=null;this.endColumn=null;this.startPosition=null;this.stretchAllRatio=0;this.stretchLastWidth=0;this.stretch=stretchH;this.totalTargetWidth=0;this.needVerifyLastColumnWidth=true;this.stretchAllColumnsWidth=[];this.calculate();}
_createClass(ViewportColumnsCalculator,[{key:'calculate',value:function calculate(){var sum=0;var needReverse=true;var startPositions=[];var columnWidth=void 0;var priv=privatePool.get(this);var onlyFullyVisible=priv.onlyFullyVisible;var overrideFn=priv.overrideFn;var scrollOffset=priv.scrollOffset;var totalColumns=priv.totalColumns;var viewportWidth=priv.viewportWidth;for(var i=0;i<totalColumns;i++){columnWidth=this._getColumnWidth(i);if(sum<=scrollOffset&&!onlyFullyVisible){this.startColumn=i;}
var compensatedViewportWidth=scrollOffset>0?viewportWidth+1:viewportWidth;if(sum>=scrollOffset&&sum+columnWidth<=scrollOffset+compensatedViewportWidth){if(this.startColumn==null){this.startColumn=i;}
this.endColumn=i;}
startPositions.push(sum);sum+=columnWidth;if(!onlyFullyVisible){this.endColumn=i;}
if(sum>=scrollOffset+viewportWidth){needReverse=false;break;}}
if(this.endColumn===totalColumns-1&&needReverse){this.startColumn=this.endColumn;while(this.startColumn>0){var viewportSum=startPositions[this.endColumn]+columnWidth-startPositions[this.startColumn-1];if(viewportSum<=viewportWidth||!onlyFullyVisible){this.startColumn--;}
if(viewportSum>viewportWidth){break;}}}
if(this.startColumn!==null&&overrideFn){overrideFn(this);}
this.startPosition=startPositions[this.startColumn];if(this.startPosition==void 0){this.startPosition=null;}
if(this.startColumn!==null){this.count=this.endColumn-this.startColumn+1;}}},{key:'refreshStretching',value:function refreshStretching(totalWidth){if(this.stretch==='none'){return;}
this.totalTargetWidth=totalWidth;var priv=privatePool.get(this);var totalColumns=priv.totalColumns;var sumAll=0;for(var i=0;i<totalColumns;i++){var columnWidth=this._getColumnWidth(i);var permanentColumnWidth=priv.stretchingColumnWidthFn(void 0,i);if(typeof permanentColumnWidth==='number'){totalWidth-=permanentColumnWidth;}else{sumAll+=columnWidth;}}
var remainingSize=totalWidth-sumAll;if(this.stretch==='all'&&remainingSize>0){this.stretchAllRatio=totalWidth/sumAll;this.stretchAllColumnsWidth=[];this.needVerifyLastColumnWidth=true;}else if(this.stretch==='last'&&totalWidth!==Infinity){var _columnWidth=this._getColumnWidth(totalColumns-1);var lastColumnWidth=remainingSize+_columnWidth;this.stretchLastWidth=lastColumnWidth>=0?lastColumnWidth:_columnWidth;}}},{key:'getStretchedColumnWidth',value:function getStretchedColumnWidth(column,baseWidth){var result=null;if(this.stretch==='all'&&this.stretchAllRatio!==0){result=this._getStretchedAllColumnWidth(column,baseWidth);}else if(this.stretch==='last'&&this.stretchLastWidth!==0){result=this._getStretchedLastColumnWidth(column);}
return result;}},{key:'_getStretchedAllColumnWidth',value:function _getStretchedAllColumnWidth(column,baseWidth){var sumRatioWidth=0;var priv=privatePool.get(this);var totalColumns=priv.totalColumns;if(!this.stretchAllColumnsWidth[column]){var stretchedWidth=Math.round(baseWidth*this.stretchAllRatio);var newStretchedWidth=priv.stretchingColumnWidthFn(stretchedWidth,column);if(newStretchedWidth===void 0){this.stretchAllColumnsWidth[column]=stretchedWidth;}else{this.stretchAllColumnsWidth[column]=isNaN(newStretchedWidth)?this._getColumnWidth(column):newStretchedWidth;}}
if(this.stretchAllColumnsWidth.length===totalColumns&&this.needVerifyLastColumnWidth){this.needVerifyLastColumnWidth=false;for(var i=0;i<this.stretchAllColumnsWidth.length;i++){sumRatioWidth+=this.stretchAllColumnsWidth[i];}
if(sumRatioWidth!==this.totalTargetWidth){this.stretchAllColumnsWidth[this.stretchAllColumnsWidth.length-1]+=this.totalTargetWidth-sumRatioWidth;}}
return this.stretchAllColumnsWidth[column];}},{key:'_getStretchedLastColumnWidth',value:function _getStretchedLastColumnWidth(column){var priv=privatePool.get(this);var totalColumns=priv.totalColumns;if(column===totalColumns-1){return this.stretchLastWidth;}
return null;}},{key:'_getColumnWidth',value:function _getColumnWidth(column){var width=privatePool.get(this).columnWidthFn(column);if(width===void 0){width=ViewportColumnsCalculator.DEFAULT_WIDTH;}
return width;}}]);return ViewportColumnsCalculator;}();exports.default=ViewportColumnsCalculator;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var privatePool=new WeakMap();var ViewportRowsCalculator=function(){_createClass(ViewportRowsCalculator,null,[{key:"DEFAULT_HEIGHT",get:function get(){return 23;}}]);function ViewportRowsCalculator(viewportHeight,scrollOffset,totalRows,rowHeightFn,overrideFn,onlyFullyVisible,horizontalScrollbarHeight){_classCallCheck(this,ViewportRowsCalculator);privatePool.set(this,{viewportHeight:viewportHeight,scrollOffset:scrollOffset,totalRows:totalRows,rowHeightFn:rowHeightFn,overrideFn:overrideFn,onlyFullyVisible:onlyFullyVisible,horizontalScrollbarHeight:horizontalScrollbarHeight});this.count=0;this.startRow=null;this.endRow=null;this.startPosition=null;this.calculate();}
_createClass(ViewportRowsCalculator,[{key:"calculate",value:function calculate(){var sum=0;var needReverse=true;var startPositions=[];var priv=privatePool.get(this);var onlyFullyVisible=priv.onlyFullyVisible;var overrideFn=priv.overrideFn;var rowHeightFn=priv.rowHeightFn;var scrollOffset=priv.scrollOffset;var totalRows=priv.totalRows;var viewportHeight=priv.viewportHeight;var horizontalScrollbarHeight=priv.horizontalScrollbarHeight||0;var rowHeight=void 0;for(var i=0;i<totalRows;i++){rowHeight=rowHeightFn(i);if(rowHeight===undefined){rowHeight=ViewportRowsCalculator.DEFAULT_HEIGHT;}
if(sum<=scrollOffset&&!onlyFullyVisible){this.startRow=i;}
if(sum>=scrollOffset&&sum+rowHeight<=scrollOffset+viewportHeight-horizontalScrollbarHeight){if(this.startRow===null){this.startRow=i;}
this.endRow=i;}
startPositions.push(sum);sum+=rowHeight;if(!onlyFullyVisible){this.endRow=i;}
if(sum>=scrollOffset+viewportHeight-horizontalScrollbarHeight){needReverse=false;break;}}
if(this.endRow===totalRows-1&&needReverse){this.startRow=this.endRow;while(this.startRow>0){var viewportSum=startPositions[this.endRow]+rowHeight-startPositions[this.startRow-1];if(viewportSum<=viewportHeight-horizontalScrollbarHeight||!onlyFullyVisible){this.startRow--;}
if(viewportSum>=viewportHeight-horizontalScrollbarHeight){break;}}}
if(this.startRow!==null&&overrideFn){overrideFn(this);}
this.startPosition=startPositions[this.startRow];if(this.startPosition==void 0){this.startPosition=null;}
if(this.startRow!==null){this.count=this.endRow-this.startRow+1;}}}]);return ViewportRowsCalculator;}();exports.default=ViewportRowsCalculator;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _object=__webpack_require__(1);var _string=__webpack_require__(27);var _event=__webpack_require__(139);var _event2=_interopRequireDefault(_event);var _overlays=__webpack_require__(142);var _overlays2=_interopRequireDefault(_overlays);var _scroll=__webpack_require__(143);var _scroll2=_interopRequireDefault(_scroll);var _settings=__webpack_require__(144);var _settings2=_interopRequireDefault(_settings);var _table=__webpack_require__(145);var _table2=_interopRequireDefault(_table);var _viewport=__webpack_require__(147);var _viewport2=_interopRequireDefault(_viewport);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Walkontable=function(){function Walkontable(settings){_classCallCheck(this,Walkontable);var originalHeaders=[];this.guid='wt_'+(0,_string.randomString)();if(settings.cloneSource){this.cloneSource=settings.cloneSource;this.cloneOverlay=settings.cloneOverlay;this.wtSettings=settings.cloneSource.wtSettings;this.wtTable=new _table2.default(this,settings.table,settings.wtRootElement);this.wtScroll=new _scroll2.default(this);this.wtViewport=settings.cloneSource.wtViewport;this.wtEvent=new _event2.default(this);this.selections=this.cloneSource.selections;}else{this.wtSettings=new _settings2.default(this,settings);this.wtTable=new _table2.default(this,settings.table);this.wtScroll=new _scroll2.default(this);this.wtViewport=new _viewport2.default(this);this.wtEvent=new _event2.default(this);this.selections=this.getSetting('selections');this.wtOverlays=new _overlays2.default(this);this.exportSettingsAsClassNames();}
if(this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var c=0,clen=this.wtTable.THEAD.childNodes[0].childNodes.length;c<clen;c++){originalHeaders.push(this.wtTable.THEAD.childNodes[0].childNodes[c].innerHTML);}
if(!this.getSetting('columnHeaders').length){this.update('columnHeaders',[function(column,TH){(0,_element.fastInnerText)(TH,originalHeaders[column]);}]);}}
this.drawn=false;this.drawInterrupted=false;}
_createClass(Walkontable,[{key:'draw',value:function draw(){var fastDraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.drawInterrupted=false;if(!fastDraw&&!(0,_element.isVisible)(this.wtTable.TABLE)){this.drawInterrupted=true;}else{this.wtTable.draw(fastDraw);}
return this;}},{key:'getCell',value:function getCell(coords){var topmost=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!topmost){return this.wtTable.getCell(coords);}
var totalRows=this.wtSettings.getSetting('totalRows');var fixedRowsTop=this.wtSettings.getSetting('fixedRowsTop');var fixedRowsBottom=this.wtSettings.getSetting('fixedRowsBottom');var fixedColumns=this.wtSettings.getSetting('fixedColumnsLeft');if(coords.row<fixedRowsTop&&coords.col<fixedColumns){return this.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell(coords);}else if(coords.row<fixedRowsTop){return this.wtOverlays.topOverlay.clone.wtTable.getCell(coords);}else if(coords.col<fixedColumns&&coords.row>=totalRows-fixedRowsBottom){if(this.wtOverlays.bottomLeftCornerOverlay&&this.wtOverlays.bottomLeftCornerOverlay.clone){return this.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.getCell(coords);}}else if(coords.col<fixedColumns){return this.wtOverlays.leftOverlay.clone.wtTable.getCell(coords);}else if(coords.row<totalRows&&coords.row>totalRows-fixedRowsBottom){if(this.wtOverlays.bottomOverlay&&this.wtOverlays.bottomOverlay.clone){return this.wtOverlays.bottomOverlay.clone.wtTable.getCell(coords);}}
return this.wtTable.getCell(coords);}},{key:'update',value:function update(settings,value){return this.wtSettings.update(settings,value);}},{key:'scrollVertical',value:function scrollVertical(row){this.wtOverlays.topOverlay.scrollTo(row);this.getSetting('onScrollVertically');return this;}},{key:'scrollHorizontal',value:function scrollHorizontal(column){this.wtOverlays.leftOverlay.scrollTo(column);this.getSetting('onScrollHorizontally');return this;}},{key:'scrollViewport',value:function scrollViewport(coords){this.wtScroll.scrollViewport(coords);return this;}},{key:'getViewport',value:function getViewport(){return[this.wtTable.getFirstVisibleRow(),this.wtTable.getFirstVisibleColumn(),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()];}},{key:'getOverlayName',value:function getOverlayName(){return this.cloneOverlay?this.cloneOverlay.type:'master';}},{key:'isOverlayName',value:function isOverlayName(name){if(this.cloneOverlay){return this.cloneOverlay.type===name;}
return false;}},{key:'exportSettingsAsClassNames',value:function exportSettingsAsClassNames(){var _this=this;var toExport={rowHeaders:['array'],columnHeaders:['array']};var allClassNames=[];var newClassNames=[];(0,_object.objectEach)(toExport,function(optionType,key){if(optionType.indexOf('array')>-1&&_this.getSetting(key).length){newClassNames.push('ht'+(0,_string.toUpperCaseFirst)(key));}
allClassNames.push('ht'+(0,_string.toUpperCaseFirst)(key));});(0,_element.removeClass)(this.wtTable.wtRootElement.parentNode,allClassNames);(0,_element.addClass)(this.wtTable.wtRootElement.parentNode,newClassNames);}},{key:'getSetting',value:function getSetting(key,param1,param2,param3,param4){return this.wtSettings.getSetting(key,param1,param2,param3,param4);}},{key:'hasSetting',value:function hasSetting(key){return this.wtSettings.has(key);}},{key:'destroy',value:function destroy(){this.wtOverlays.destroy();this.wtEvent.destroy();}}]);return Walkontable;}();exports.default=Walkontable;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _function=__webpack_require__(35);var _browser=__webpack_require__(25);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function Event(instance){var that=this;var eventManager=new _eventManager2.default(instance);this.instance=instance;var dblClickOrigin=[null,null];this.dblClickTimeout=[null,null];var onMouseDown=function onMouseDown(event){var activeElement=document.activeElement;var getParentNode=(0,_function.partial)(_element.getParent,event.realTarget);var realTarget=event.realTarget;if(realTarget===activeElement||getParentNode(0)===activeElement||getParentNode(1)===activeElement){return;}
var cell=that.parentCell(realTarget);if((0,_element.hasClass)(realTarget,'corner')){that.instance.getSetting('onCellCornerMouseDown',event,realTarget);}else if(cell.TD){if(that.instance.hasSetting('onCellMouseDown')){that.instance.getSetting('onCellMouseDown',event,cell.coords,cell.TD,that.instance);}}
if(event.button!==2){if(cell.TD){dblClickOrigin[0]=cell.TD;clearTimeout(that.dblClickTimeout[0]);that.dblClickTimeout[0]=setTimeout(function(){dblClickOrigin[0]=null;},1000);}}};var onTouchMove=function onTouchMove(event){that.instance.touchMoving=true;};var longTouchTimeout;var onTouchStart=function onTouchStart(event){var container=this;eventManager.addEventListener(this,'touchmove',onTouchMove);that.checkIfTouchMove=setTimeout(function(){if(that.instance.touchMoving===true){that.instance.touchMoving=void 0;eventManager.removeEventListener('touchmove',onTouchMove,false);}
onMouseDown(event);},30);};var onMouseOver=function onMouseOver(event){var table,td,mainWOT;if(that.instance.hasSetting('onCellMouseOver')){table=that.instance.wtTable.TABLE;td=(0,_element.closestDown)(event.realTarget,['TD','TH'],table);mainWOT=that.instance.cloneSource||that.instance;if(td&&td!==mainWOT.lastMouseOver&&(0,_element.isChildOf)(td,table)){mainWOT.lastMouseOver=td;that.instance.getSetting('onCellMouseOver',event,that.instance.wtTable.getCoords(td),td,that.instance);}}};var onMouseOut=function onMouseOut(event){var table=void 0;var lastTD=void 0;var nextTD=void 0;if(that.instance.hasSetting('onCellMouseOut')){table=that.instance.wtTable.TABLE;lastTD=(0,_element.closestDown)(event.realTarget,['TD','TH'],table);nextTD=(0,_element.closestDown)(event.relatedTarget,['TD','TH'],table);if(lastTD&&lastTD!==nextTD&&(0,_element.isChildOf)(lastTD,table)){that.instance.getSetting('onCellMouseOut',event,that.instance.wtTable.getCoords(lastTD),lastTD,that.instance);}}};var onMouseUp=function onMouseUp(event){if(event.button!==2){var cell=that.parentCell(event.realTarget);if(cell.TD===dblClickOrigin[0]&&cell.TD===dblClickOrigin[1]){if((0,_element.hasClass)(event.realTarget,'corner')){that.instance.getSetting('onCellCornerDblClick',event,cell.coords,cell.TD,that.instance);}else{that.instance.getSetting('onCellDblClick',event,cell.coords,cell.TD,that.instance);}
dblClickOrigin[0]=null;dblClickOrigin[1]=null;}else if(cell.TD===dblClickOrigin[0]){that.instance.getSetting('onCellMouseUp',event,cell.coords,cell.TD,that.instance);dblClickOrigin[1]=cell.TD;clearTimeout(that.dblClickTimeout[1]);that.dblClickTimeout[1]=setTimeout(function(){dblClickOrigin[1]=null;},500);}else if(cell.TD&&that.instance.hasSetting('onCellMouseUp')){that.instance.getSetting('onCellMouseUp',event,cell.coords,cell.TD,that.instance);}}};var onTouchEnd=function onTouchEnd(event){clearTimeout(longTouchTimeout);event.preventDefault();onMouseUp(event);};eventManager.addEventListener(this.instance.wtTable.holder,'mousedown',onMouseDown);eventManager.addEventListener(this.instance.wtTable.TABLE,'mouseover',onMouseOver);eventManager.addEventListener(this.instance.wtTable.TABLE,'mouseout',onMouseOut);eventManager.addEventListener(this.instance.wtTable.holder,'mouseup',onMouseUp);if(this.instance.wtTable.holder.parentNode.parentNode&&(0,_browser.isMobileBrowser)()&&!that.instance.wtTable.isWorkingOnClone()){var classSelector='.'+this.instance.wtTable.holder.parentNode.className.split(' ').join('.');eventManager.addEventListener(this.instance.wtTable.holder,'touchstart',function(event){that.instance.touchApplied=true;if((0,_element.isChildOf)(event.target,classSelector)){onTouchStart.call(event.target,event);}});eventManager.addEventListener(this.instance.wtTable.holder,'touchend',function(event){that.instance.touchApplied=false;if((0,_element.isChildOf)(event.target,classSelector)){onTouchEnd.call(event.target,event);}});if(!that.instance.momentumScrolling){that.instance.momentumScrolling={};}
eventManager.addEventListener(this.instance.wtTable.holder,'scroll',function(event){clearTimeout(that.instance.momentumScrolling._timeout);if(!that.instance.momentumScrolling.ongoing){that.instance.getSetting('onBeforeTouchScroll');}
that.instance.momentumScrolling.ongoing=true;that.instance.momentumScrolling._timeout=setTimeout(function(){if(!that.instance.touchApplied){that.instance.momentumScrolling.ongoing=false;that.instance.getSetting('onAfterMomentumScroll');}},200);});}
eventManager.addEventListener(window,'resize',function(){if(that.instance.getSetting('stretchH')!=='none'){that.instance.draw();}});this.destroy=function(){clearTimeout(this.dblClickTimeout[0]);clearTimeout(this.dblClickTimeout[1]);eventManager.destroy();};}
Event.prototype.parentCell=function(elem){var cell={};var TABLE=this.instance.wtTable.TABLE;var TD=(0,_element.closestDown)(elem,['TD','TH'],TABLE);if(TD){cell.coords=this.instance.wtTable.getCoords(TD);cell.TD=TD;}else if((0,_element.hasClass)(elem,'wtBorder')&&(0,_element.hasClass)(elem,'current')){cell.coords=this.instance.selections.current.cellRange.highlight;cell.TD=this.instance.wtTable.getCell(cell.coords);}else if((0,_element.hasClass)(elem,'wtBorder')&&(0,_element.hasClass)(elem,'area')){if(this.instance.selections.area.cellRange){cell.coords=this.instance.selections.area.cellRange.to;cell.TD=this.instance.wtTable.getCell(cell.coords);}}
return cell;};exports.default=Event;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var ColumnFilter=function(){function ColumnFilter(offset,total,countTH){_classCallCheck(this,ColumnFilter);this.offset=offset;this.total=total;this.countTH=countTH;}
_createClass(ColumnFilter,[{key:"offsetted",value:function offsetted(index){return index+this.offset;}},{key:"unOffsetted",value:function unOffsetted(index){return index-this.offset;}},{key:"renderedToSource",value:function renderedToSource(index){return this.offsetted(index);}},{key:"sourceToRendered",value:function sourceToRendered(index){return this.unOffsetted(index);}},{key:"offsettedTH",value:function offsettedTH(index){return index-this.countTH;}},{key:"unOffsettedTH",value:function unOffsettedTH(index){return index+this.countTH;}},{key:"visibleRowHeadedColumnToSourceColumn",value:function visibleRowHeadedColumnToSourceColumn(index){return this.renderedToSource(this.offsettedTH(index));}},{key:"sourceColumnToVisibleRowHeadedColumn",value:function sourceColumnToVisibleRowHeadedColumn(index){return this.unOffsettedTH(this.sourceToRendered(index));}}]);return ColumnFilter;}();exports.default=ColumnFilter;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var RowFilter=function(){function RowFilter(offset,total,countTH){_classCallCheck(this,RowFilter);this.offset=offset;this.total=total;this.countTH=countTH;}
_createClass(RowFilter,[{key:"offsetted",value:function offsetted(index){return index+this.offset;}},{key:"unOffsetted",value:function unOffsetted(index){return index-this.offset;}},{key:"renderedToSource",value:function renderedToSource(index){return this.offsetted(index);}},{key:"sourceToRendered",value:function sourceToRendered(index){return this.unOffsetted(index);}},{key:"offsettedTH",value:function offsettedTH(index){return index-this.countTH;}},{key:"unOffsettedTH",value:function unOffsettedTH(index){return index+this.countTH;}},{key:"visibleColHeadedRowToSourceRow",value:function visibleColHeadedRowToSourceRow(index){return this.renderedToSource(this.offsettedTH(index));}},{key:"sourceRowToVisibleColHeadedRow",value:function sourceRowToVisibleColHeadedRow(index){return this.unOffsettedTH(this.sourceToRendered(index));}}]);return RowFilter;}();exports.default=RowFilter;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _array=__webpack_require__(2);var _unicode=__webpack_require__(16);var _browser=__webpack_require__(25);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Overlays=function(){function Overlays(wotInstance){_classCallCheck(this,Overlays);this.wot=wotInstance;this.instance=this.wot;this.eventManager=new _eventManager2.default(this.wot);this.wot.update('scrollbarWidth',(0,_element.getScrollbarWidth)());this.wot.update('scrollbarHeight',(0,_element.getScrollbarWidth)());this.scrollableElement=(0,_element.getScrollableElement)(this.wot.wtTable.TABLE);this.prepareOverlays();this.destroyed=false;this.keyPressed=false;this.spreaderLastSize={width:null,height:null};this.overlayScrollPositions={master:{top:0,left:0},top:{top:null,left:0},bottom:{top:null,left:0},left:{top:0,left:null}};this.pendingScrollCallbacks={master:{top:0,left:0},top:{left:0},bottom:{left:0},left:{top:0}};this.verticalScrolling=false;this.horizontalScrolling=false;this.delegatedScrollCallback=false;this.registeredListeners=[];this.registerListeners();}
_createClass(Overlays,[{key:'prepareOverlays',value:function prepareOverlays(){var syncScroll=false;if(this.topOverlay){syncScroll=this.topOverlay.updateStateOfRendering()||syncScroll;}else{this.topOverlay=_base2.default.createOverlay(_base2.default.CLONE_TOP,this.wot);}
if(!_base2.default.hasOverlay(_base2.default.CLONE_BOTTOM)){this.bottomOverlay={needFullRender:false,updateStateOfRendering:function updateStateOfRendering(){return false;}};}
if(!_base2.default.hasOverlay(_base2.default.CLONE_BOTTOM_LEFT_CORNER)){this.bottomLeftCornerOverlay={needFullRender:false,updateStateOfRendering:function updateStateOfRendering(){return false;}};}
if(this.bottomOverlay){syncScroll=this.bottomOverlay.updateStateOfRendering()||syncScroll;}else{this.bottomOverlay=_base2.default.createOverlay(_base2.default.CLONE_BOTTOM,this.wot);}
if(this.leftOverlay){syncScroll=this.leftOverlay.updateStateOfRendering()||syncScroll;}else{this.leftOverlay=_base2.default.createOverlay(_base2.default.CLONE_LEFT,this.wot);}
if(this.topOverlay.needFullRender&&this.leftOverlay.needFullRender){if(this.topLeftCornerOverlay){syncScroll=this.topLeftCornerOverlay.updateStateOfRendering()||syncScroll;}else{this.topLeftCornerOverlay=_base2.default.createOverlay(_base2.default.CLONE_TOP_LEFT_CORNER,this.wot);}}
if(this.bottomOverlay.needFullRender&&this.leftOverlay.needFullRender){if(this.bottomLeftCornerOverlay){syncScroll=this.bottomLeftCornerOverlay.updateStateOfRendering()||syncScroll;}else{this.bottomLeftCornerOverlay=_base2.default.createOverlay(_base2.default.CLONE_BOTTOM_LEFT_CORNER,this.wot);}}
if(this.wot.getSetting('debug')&&!this.debug){this.debug=_base2.default.createOverlay(_base2.default.CLONE_DEBUG,this.wot);}
return syncScroll;}},{key:'refreshAll',value:function refreshAll(){if(!this.wot.drawn){return;}
if(!this.wot.wtTable.holder.parentNode){this.destroy();return;}
this.wot.draw(true);if(this.verticalScrolling){this.leftOverlay.onScroll();}
if(this.horizontalScrolling){this.topOverlay.onScroll();}
this.verticalScrolling=false;this.horizontalScrolling=false;}},{key:'registerListeners',value:function registerListeners(){var _this=this;var topOverlayScrollable=this.topOverlay.mainTableScrollableElement;var leftOverlayScrollable=this.leftOverlay.mainTableScrollableElement;var listenersToRegister=[];listenersToRegister.push([document.documentElement,'keydown',function(event){return _this.onKeyDown(event);}]);listenersToRegister.push([document.documentElement,'keyup',function(){return _this.onKeyUp();}]);listenersToRegister.push([document,'visibilitychange',function(){return _this.onKeyUp();}]);listenersToRegister.push([topOverlayScrollable,'scroll',function(event){return _this.onTableScroll(event);}]);if(topOverlayScrollable!==leftOverlayScrollable){listenersToRegister.push([leftOverlayScrollable,'scroll',function(event){return _this.onTableScroll(event);}]);}
if(this.topOverlay.needFullRender){listenersToRegister.push([this.topOverlay.clone.wtTable.holder,'scroll',function(event){return _this.onTableScroll(event);}]);listenersToRegister.push([this.topOverlay.clone.wtTable.holder,'wheel',function(event){return _this.onTableScroll(event);}]);}
if(this.bottomOverlay.needFullRender){listenersToRegister.push([this.bottomOverlay.clone.wtTable.holder,'scroll',function(event){return _this.onTableScroll(event);}]);listenersToRegister.push([this.bottomOverlay.clone.wtTable.holder,'wheel',function(event){return _this.onTableScroll(event);}]);}
if(this.leftOverlay.needFullRender){listenersToRegister.push([this.leftOverlay.clone.wtTable.holder,'scroll',function(event){return _this.onTableScroll(event);}]);listenersToRegister.push([this.leftOverlay.clone.wtTable.holder,'wheel',function(event){return _this.onTableScroll(event);}]);}
if(this.topLeftCornerOverlay&&this.topLeftCornerOverlay.needFullRender){listenersToRegister.push([this.topLeftCornerOverlay.clone.wtTable.holder,'wheel',function(event){return _this.onTableScroll(event);}]);}
if(this.bottomLeftCornerOverlay&&this.bottomLeftCornerOverlay.needFullRender){listenersToRegister.push([this.bottomLeftCornerOverlay.clone.wtTable.holder,'wheel',function(event){return _this.onTableScroll(event);}]);}
if(this.topOverlay.trimmingContainer!==window&&this.leftOverlay.trimmingContainer!==window){listenersToRegister.push([window,'wheel',function(event){var overlay=void 0;var deltaY=event.wheelDeltaY||event.deltaY;var deltaX=event.wheelDeltaX||event.deltaX;if(_this.topOverlay.clone.wtTable.holder.contains(event.realTarget)){overlay='top';}else if(_this.bottomOverlay.clone&&_this.bottomOverlay.clone.wtTable.holder.contains(event.realTarget)){overlay='bottom';}else if(_this.leftOverlay.clone.wtTable.holder.contains(event.realTarget)){overlay='left';}else if(_this.topLeftCornerOverlay&&_this.topLeftCornerOverlay.clone&&_this.topLeftCornerOverlay.clone.wtTable.holder.contains(event.realTarget)){overlay='topLeft';}else if(_this.bottomLeftCornerOverlay&&_this.bottomLeftCornerOverlay.clone&&_this.bottomLeftCornerOverlay.clone.wtTable.holder.contains(event.realTarget)){overlay='bottomLeft';}
if(overlay=='top'&&deltaY!==0||overlay=='left'&&deltaX!==0||overlay=='bottom'&&deltaY!==0||(overlay==='topLeft'||overlay==='bottomLeft')&&(deltaY!==0||deltaX!==0)){event.preventDefault();}}]);}
while(listenersToRegister.length){var listener=listenersToRegister.pop();this.eventManager.addEventListener(listener[0],listener[1],listener[2]);this.registeredListeners.push(listener);}}},{key:'deregisterListeners',value:function deregisterListeners(){while(this.registeredListeners.length){var listener=this.registeredListeners.pop();this.eventManager.removeEventListener(listener[0],listener[1],listener[2]);}}},{key:'onTableScroll',value:function onTableScroll(event){if((0,_browser.isMobileBrowser)()){return;}
var masterHorizontal=this.leftOverlay.mainTableScrollableElement;var masterVertical=this.topOverlay.mainTableScrollableElement;var target=event.target;if(this.keyPressed){if(masterVertical!==window&&target!==window&&!event.target.contains(masterVertical)||masterHorizontal!==window&&target!==window&&!event.target.contains(masterHorizontal)){return;}}
if(event.type==='scroll'){this.syncScrollPositions(event);}else{this.translateMouseWheelToScroll(event);}}},{key:'onKeyDown',value:function onKeyDown(event){this.keyPressed=(0,_unicode.isKey)(event.keyCode,'ARROW_UP|ARROW_RIGHT|ARROW_DOWN|ARROW_LEFT');}},{key:'onKeyUp',value:function onKeyUp(){this.keyPressed=false;}},{key:'translateMouseWheelToScroll',value:function translateMouseWheelToScroll(event){var topOverlay=this.topOverlay.clone.wtTable.holder;var bottomOverlay=this.bottomOverlay.clone?this.bottomOverlay.clone.wtTable.holder:null;var leftOverlay=this.leftOverlay.clone.wtTable.holder;var topLeftCornerOverlay=this.topLeftCornerOverlay&&this.topLeftCornerOverlay.clone?this.topLeftCornerOverlay.clone.wtTable.holder:null;var bottomLeftCornerOverlay=this.bottomLeftCornerOverlay&&this.bottomLeftCornerOverlay.clone?this.bottomLeftCornerOverlay.clone.wtTable.holder:null;var mouseWheelSpeedRatio=-0.2;var deltaY=event.wheelDeltaY||-1*event.deltaY;var deltaX=event.wheelDeltaX||-1*event.deltaX;var parentHolder=null;var eventMockup={type:'wheel'};var tempElem=event.target;var delta=null;if(event.deltaMode===1){deltaY*=120;deltaX*=120;}
while(tempElem!=document&&tempElem!=null){if(tempElem.className.indexOf('wtHolder')>-1){parentHolder=tempElem;break;}
tempElem=tempElem.parentNode;}
eventMockup.target=parentHolder;if(parentHolder===topLeftCornerOverlay||parentHolder===bottomLeftCornerOverlay){this.syncScrollPositions(eventMockup,mouseWheelSpeedRatio*deltaX,'x');this.syncScrollPositions(eventMockup,mouseWheelSpeedRatio*deltaY,'y');}else{if(parentHolder===topOverlay||parentHolder===bottomOverlay){delta=deltaY;}else if(parentHolder===leftOverlay){delta=deltaX;}
this.syncScrollPositions(eventMockup,mouseWheelSpeedRatio*delta);}
return false;}},{key:'syncScrollPositions',value:function syncScrollPositions(event){var fakeScrollValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var fakeScrollDirection=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(this.destroyed){return;}
if(arguments.length===0){this.syncScrollWithMaster();return;}
var masterHorizontal=this.leftOverlay.mainTableScrollableElement;var masterVertical=this.topOverlay.mainTableScrollableElement;var target=event.target;var tempScrollValue=0;var scrollValueChanged=false;var topOverlay=void 0;var leftOverlay=void 0;var topLeftCornerOverlay=void 0;var bottomLeftCornerOverlay=void 0;var bottomOverlay=void 0;var delegatedScroll=false;var preventOverflow=this.wot.getSetting('preventOverflow');if(this.topOverlay.needFullRender){topOverlay=this.topOverlay.clone.wtTable.holder;}
if(this.bottomOverlay.needFullRender){bottomOverlay=this.bottomOverlay.clone.wtTable.holder;}
if(this.leftOverlay.needFullRender){leftOverlay=this.leftOverlay.clone.wtTable.holder;}
if(this.leftOverlay.needFullRender&&this.topOverlay.needFullRender){topLeftCornerOverlay=this.topLeftCornerOverlay.clone.wtTable.holder;}
if(this.leftOverlay.needFullRender&&this.bottomOverlay.needFullRender){bottomLeftCornerOverlay=this.bottomLeftCornerOverlay.clone.wtTable.holder;}
if(target===document){target=window;}
if(target===masterHorizontal||target===masterVertical){if(preventOverflow){tempScrollValue=(0,_element.getScrollLeft)(this.scrollableElement);}else{tempScrollValue=(0,_element.getScrollLeft)(target);}
this.horizontalScrolling=true;this.overlayScrollPositions.master.left=tempScrollValue;scrollValueChanged=true;if(this.pendingScrollCallbacks.master.left>0){this.pendingScrollCallbacks.master.left--;}else{if(topOverlay&&topOverlay.scrollLeft!==tempScrollValue){if(fakeScrollValue==null){this.pendingScrollCallbacks.top.left++;}
topOverlay.scrollLeft=tempScrollValue;delegatedScroll=masterHorizontal!==window;}
if(bottomOverlay&&bottomOverlay.scrollLeft!==tempScrollValue){if(fakeScrollValue==null){this.pendingScrollCallbacks.bottom.left++;}
bottomOverlay.scrollLeft=tempScrollValue;delegatedScroll=masterHorizontal!==window;}}
tempScrollValue=(0,_element.getScrollTop)(target);this.verticalScrolling=true;this.overlayScrollPositions.master.top=tempScrollValue;scrollValueChanged=true;if(this.pendingScrollCallbacks.master.top>0){this.pendingScrollCallbacks.master.top--;}else if(leftOverlay&&leftOverlay.scrollTop!==tempScrollValue){if(fakeScrollValue==null){this.pendingScrollCallbacks.left.top++;}
leftOverlay.scrollTop=tempScrollValue;delegatedScroll=masterVertical!==window;}}else if(target===bottomOverlay){tempScrollValue=(0,_element.getScrollLeft)(target);this.horizontalScrolling=true;this.overlayScrollPositions.bottom.left=tempScrollValue;scrollValueChanged=true;if(this.pendingScrollCallbacks.bottom.left>0){this.pendingScrollCallbacks.bottom.left--;}else{if(fakeScrollValue==null){this.pendingScrollCallbacks.master.left++;}
masterHorizontal.scrollLeft=tempScrollValue;if(topOverlay&&topOverlay.scrollLeft!==tempScrollValue){if(fakeScrollValue==null){this.pendingScrollCallbacks.top.left++;}
topOverlay.scrollLeft=tempScrollValue;delegatedScroll=masterVertical!==window;}}
if(fakeScrollValue!==null){scrollValueChanged=true;masterVertical.scrollTop+=fakeScrollValue;}}else if(target===topOverlay){tempScrollValue=(0,_element.getScrollLeft)(target);this.horizontalScrolling=true;this.overlayScrollPositions.top.left=tempScrollValue;scrollValueChanged=true;if(this.pendingScrollCallbacks.top.left>0){this.pendingScrollCallbacks.top.left--;}else{if(fakeScrollValue==null){this.pendingScrollCallbacks.master.left++;}
masterHorizontal.scrollLeft=tempScrollValue;}
if(fakeScrollValue!==null){scrollValueChanged=true;masterVertical.scrollTop+=fakeScrollValue;}
if(bottomOverlay&&bottomOverlay.scrollLeft!==tempScrollValue){if(fakeScrollValue==null){this.pendingScrollCallbacks.bottom.left++;}
bottomOverlay.scrollLeft=tempScrollValue;delegatedScroll=masterVertical!==window;}}else if(target===leftOverlay){tempScrollValue=(0,_element.getScrollTop)(target);if(this.overlayScrollPositions.left.top!==tempScrollValue){this.verticalScrolling=true;this.overlayScrollPositions.left.top=tempScrollValue;scrollValueChanged=true;if(this.pendingScrollCallbacks.left.top>0){this.pendingScrollCallbacks.left.top--;}else{if(fakeScrollValue==null){this.pendingScrollCallbacks.master.top++;}
masterVertical.scrollTop=tempScrollValue;}}
if(fakeScrollValue!==null){scrollValueChanged=true;masterVertical.scrollLeft+=fakeScrollValue;}}else if(target===topLeftCornerOverlay||target===bottomLeftCornerOverlay){if(fakeScrollValue!==null){scrollValueChanged=true;if(fakeScrollDirection==='x'){masterVertical.scrollLeft+=fakeScrollValue;}else if(fakeScrollDirection==='y'){masterVertical.scrollTop+=fakeScrollValue;}}}
if(!this.keyPressed&&scrollValueChanged&&event.type==='scroll'){if(this.delegatedScrollCallback){this.delegatedScrollCallback=false;}else{this.refreshAll();}
if(delegatedScroll){this.delegatedScrollCallback=true;}}}},{key:'syncScrollWithMaster',value:function syncScrollWithMaster(){var master=this.topOverlay.mainTableScrollableElement;var scrollLeft=master.scrollLeft,scrollTop=master.scrollTop;if(this.topOverlay.needFullRender){this.topOverlay.clone.wtTable.holder.scrollLeft=scrollLeft;}
if(this.bottomOverlay.needFullRender){this.bottomOverlay.clone.wtTable.holder.scrollLeft=scrollLeft;}
if(this.leftOverlay.needFullRender){this.leftOverlay.clone.wtTable.holder.scrollTop=scrollTop;}}},{key:'updateMainScrollableElements',value:function updateMainScrollableElements(){this.deregisterListeners();this.leftOverlay.updateMainScrollableElement();this.topOverlay.updateMainScrollableElement();if(this.bottomOverlay.needFullRender){this.bottomOverlay.updateMainScrollableElement();}
this.scrollableElement=(0,_element.getScrollableElement)(this.wot.wtTable.TABLE);this.registerListeners();}},{key:'destroy',value:function destroy(){this.eventManager.destroy();this.topOverlay.destroy();if(this.bottomOverlay.clone){this.bottomOverlay.destroy();}
this.leftOverlay.destroy();if(this.topLeftCornerOverlay){this.topLeftCornerOverlay.destroy();}
if(this.bottomLeftCornerOverlay&&this.bottomLeftCornerOverlay.clone){this.bottomLeftCornerOverlay.destroy();}
if(this.debug){this.debug.destroy();}
this.destroyed=true;}},{key:'refresh',value:function refresh(){var fastDraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.topOverlay.areElementSizesAdjusted&&this.leftOverlay.areElementSizesAdjusted){var container=this.wot.wtTable.wtRootElement.parentNode||this.wot.wtTable.wtRootElement;var width=container.clientWidth;var height=container.clientHeight;if(width!==this.spreaderLastSize.width||height!==this.spreaderLastSize.height){this.spreaderLastSize.width=width;this.spreaderLastSize.height=height;this.adjustElementsSize();}}
if(this.bottomOverlay.clone){this.bottomOverlay.refresh(fastDraw);}
this.leftOverlay.refresh(fastDraw);this.topOverlay.refresh(fastDraw);if(this.topLeftCornerOverlay){this.topLeftCornerOverlay.refresh(fastDraw);}
if(this.bottomLeftCornerOverlay&&this.bottomLeftCornerOverlay.clone){this.bottomLeftCornerOverlay.refresh(fastDraw);}
if(this.debug){this.debug.refresh(fastDraw);}}},{key:'adjustElementsSize',value:function adjustElementsSize(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var totalColumns=this.wot.getSetting('totalColumns');var totalRows=this.wot.getSetting('totalRows');var headerRowSize=this.wot.wtViewport.getRowHeaderWidth();var headerColumnSize=this.wot.wtViewport.getColumnHeaderHeight();var hiderStyle=this.wot.wtTable.hider.style;hiderStyle.width=headerRowSize+this.leftOverlay.sumCellSizes(0,totalColumns)+'px';hiderStyle.height=headerColumnSize+this.topOverlay.sumCellSizes(0,totalRows)+1+'px';this.topOverlay.adjustElementsSize(force);this.leftOverlay.adjustElementsSize(force);if(this.bottomOverlay.clone){this.bottomOverlay.adjustElementsSize(force);}}},{key:'applyToDOM',value:function applyToDOM(){if(!this.topOverlay.areElementSizesAdjusted||!this.leftOverlay.areElementSizesAdjusted){this.adjustElementsSize();}
this.topOverlay.applyToDOM();if(this.bottomOverlay.clone){this.bottomOverlay.applyToDOM();}
this.leftOverlay.applyToDOM();}},{key:'getParentOverlay',value:function getParentOverlay(element){if(!element){return null;}
var overlays=[this.topOverlay,this.leftOverlay,this.bottomOverlay,this.topLeftCornerOverlay,this.bottomLeftCornerOverlay];var result=null;(0,_array.arrayEach)(overlays,function(elem,i){if(!elem){return;}
if(elem.clone&&elem.clone.wtTable.TABLE.contains(element)){result=elem.clone;}});return result;}}]);return Overlays;}();exports.default=Overlays;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _number=__webpack_require__(6);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Scroll=function(){function Scroll(wotInstance){_classCallCheck(this,Scroll);this.wot=wotInstance;this.instance=wotInstance;}
_createClass(Scroll,[{key:'scrollViewport',value:function scrollViewport(coords){if(!this.wot.drawn){return;}
var _getVariables2=this._getVariables(),topOverlay=_getVariables2.topOverlay,leftOverlay=_getVariables2.leftOverlay,totalRows=_getVariables2.totalRows,totalColumns=_getVariables2.totalColumns,fixedRowsTop=_getVariables2.fixedRowsTop,fixedRowsBottom=_getVariables2.fixedRowsBottom,fixedColumnsLeft=_getVariables2.fixedColumnsLeft;if(coords.row<0||coords.row>Math.max(totalRows-1,0)){throw new Error('row '+coords.row+' does not exist');}
if(coords.col<0||coords.col>Math.max(totalColumns-1,0)){throw new Error('column '+coords.col+' does not exist');}
if(coords.row>=fixedRowsTop&&coords.row<this.getFirstVisibleRow()){topOverlay.scrollTo(coords.row);}else if(coords.row>this.getLastVisibleRow()&&coords.row<totalRows-fixedRowsBottom){topOverlay.scrollTo(coords.row,true);}
if(coords.col>=fixedColumnsLeft&&coords.col<this.getFirstVisibleColumn()){leftOverlay.scrollTo(coords.col);}else if(coords.col>this.getLastVisibleColumn()){leftOverlay.scrollTo(coords.col,true);}}},{key:'getFirstVisibleRow',value:function getFirstVisibleRow(){var _getVariables3=this._getVariables(),topOverlay=_getVariables3.topOverlay,wtTable=_getVariables3.wtTable,wtViewport=_getVariables3.wtViewport,totalRows=_getVariables3.totalRows,fixedRowsTop=_getVariables3.fixedRowsTop;var firstVisibleRow=wtTable.getFirstVisibleRow();if(topOverlay.mainTableScrollableElement===window){var rootElementOffset=(0,_element.offset)(wtTable.wtRootElement);var totalTableHeight=(0,_element.innerHeight)(wtTable.hider);var windowHeight=(0,_element.innerHeight)(window);var windowScrollTop=(0,_element.getScrollTop)(window);if(rootElementOffset.top+totalTableHeight-windowHeight<=windowScrollTop){var rowsHeight=wtViewport.getColumnHeaderHeight();rowsHeight+=topOverlay.sumCellSizes(0,fixedRowsTop);(0,_number.rangeEachReverse)(totalRows,1,function(row){rowsHeight+=topOverlay.sumCellSizes(row-1,row);if(rootElementOffset.top+totalTableHeight-rowsHeight<=windowScrollTop){firstVisibleRow=row;return false;}});}}
return firstVisibleRow;}},{key:'getLastVisibleRow',value:function getLastVisibleRow(){var _getVariables4=this._getVariables(),topOverlay=_getVariables4.topOverlay,wtTable=_getVariables4.wtTable,wtViewport=_getVariables4.wtViewport,totalRows=_getVariables4.totalRows;var lastVisibleRow=wtTable.getLastVisibleRow();if(topOverlay.mainTableScrollableElement===window){var rootElementOffset=(0,_element.offset)(wtTable.wtRootElement);var windowHeight=(0,_element.innerHeight)(window);var windowScrollTop=(0,_element.getScrollTop)(window);if(rootElementOffset.top>windowScrollTop){var rowsHeight=wtViewport.getColumnHeaderHeight();(0,_number.rangeEach)(1,totalRows,function(row){rowsHeight+=topOverlay.sumCellSizes(row-1,row);if(rootElementOffset.top+rowsHeight-windowScrollTop>=windowHeight){lastVisibleRow=row-2;return false;}});}}
return lastVisibleRow;}},{key:'getFirstVisibleColumn',value:function getFirstVisibleColumn(){var _getVariables5=this._getVariables(),leftOverlay=_getVariables5.leftOverlay,wtTable=_getVariables5.wtTable,wtViewport=_getVariables5.wtViewport,totalColumns=_getVariables5.totalColumns,fixedColumnsLeft=_getVariables5.fixedColumnsLeft;var firstVisibleColumn=wtTable.getFirstVisibleColumn();if(leftOverlay.mainTableScrollableElement===window){var rootElementOffset=(0,_element.offset)(wtTable.wtRootElement);var totalTableWidth=(0,_element.innerWidth)(wtTable.hider);var windowWidth=(0,_element.innerWidth)(window);var windowScrollLeft=(0,_element.getScrollLeft)(window);if(rootElementOffset.left+totalTableWidth-windowWidth<=windowScrollLeft){var columnsWidth=wtViewport.getRowHeaderWidth();(0,_number.rangeEachReverse)(totalColumns,1,function(column){columnsWidth+=leftOverlay.sumCellSizes(column-1,column);if(rootElementOffset.left+totalTableWidth-columnsWidth<=windowScrollLeft){firstVisibleColumn=column;return false;}});}}
return firstVisibleColumn;}},{key:'getLastVisibleColumn',value:function getLastVisibleColumn(){var _getVariables6=this._getVariables(),leftOverlay=_getVariables6.leftOverlay,wtTable=_getVariables6.wtTable,wtViewport=_getVariables6.wtViewport,totalColumns=_getVariables6.totalColumns;var lastVisibleColumn=wtTable.getLastVisibleColumn();if(leftOverlay.mainTableScrollableElement===window){var rootElementOffset=(0,_element.offset)(wtTable.wtRootElement);var windowWidth=(0,_element.innerWidth)(window);var windowScrollLeft=(0,_element.getScrollLeft)(window);if(rootElementOffset.left>windowScrollLeft){var columnsWidth=wtViewport.getRowHeaderWidth();(0,_number.rangeEach)(1,totalColumns,function(column){columnsWidth+=leftOverlay.sumCellSizes(column-1,column);if(rootElementOffset.left+columnsWidth-windowScrollLeft>=windowWidth){lastVisibleColumn=column-2;return false;}});}}
return lastVisibleColumn;}},{key:'_getVariables',value:function _getVariables(){var wot=this.wot;var topOverlay=wot.wtOverlays.topOverlay;var leftOverlay=wot.wtOverlays.leftOverlay;var wtTable=wot.wtTable;var wtViewport=wot.wtViewport;var totalRows=wot.getSetting('totalRows');var totalColumns=wot.getSetting('totalColumns');var fixedRowsTop=wot.getSetting('fixedRowsTop');var fixedRowsBottom=wot.getSetting('fixedRowsBottom');var fixedColumnsLeft=wot.getSetting('fixedColumnsLeft');return{topOverlay:topOverlay,leftOverlay:leftOverlay,wtTable:wtTable,wtViewport:wtViewport,totalRows:totalRows,totalColumns:totalColumns,fixedRowsTop:fixedRowsTop,fixedRowsBottom:fixedRowsBottom,fixedColumnsLeft:fixedColumnsLeft};}}]);return Scroll;}();exports.default=Scroll;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _object=__webpack_require__(1);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Settings=function(){function Settings(wotInstance,settings){var _this=this;_classCallCheck(this,Settings);this.wot=wotInstance;this.instance=wotInstance;this.defaults={table:void 0,debug:false,externalRowCalculator:false,stretchH:'none',currentRowClassName:null,currentColumnClassName:null,preventOverflow:function preventOverflow(){return false;},data:void 0,freezeOverlays:false,fixedColumnsLeft:0,fixedRowsTop:0,fixedRowsBottom:0,minSpareRows:0,rowHeaders:function rowHeaders(){return[];},columnHeaders:function columnHeaders(){return[];},totalRows:void 0,totalColumns:void 0,cellRenderer:function cellRenderer(row,column,TD){var cellData=_this.getSetting('data',row,column);(0,_element.fastInnerText)(TD,cellData===void 0||cellData===null?'':cellData);},columnWidth:function columnWidth(col){},rowHeight:function rowHeight(row){},defaultRowHeight:23,defaultColumnWidth:50,selections:null,hideBorderOnMouseDownOver:false,viewportRowCalculatorOverride:null,viewportColumnCalculatorOverride:null,onCellMouseDown:null,onCellMouseOver:null,onCellMouseOut:null,onCellMouseUp:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,onBeforeDrawBorders:null,onScrollVertically:null,onScrollHorizontally:null,onBeforeTouchScroll:null,onAfterMomentumScroll:null,onBeforeStretchingColumnWidth:function onBeforeStretchingColumnWidth(width){return width;},onModifyRowHeaderWidth:null,scrollbarWidth:10,scrollbarHeight:10,renderAllRows:false,groups:false,rowHeaderWidth:null,columnHeaderHeight:null,headerClassName:null};this.settings={};for(var i in this.defaults){if((0,_object.hasOwnProperty)(this.defaults,i)){if(settings[i]!==void 0){this.settings[i]=settings[i];}else if(this.defaults[i]===void 0){throw new Error('A required setting "'+i+'" was not provided');}else{this.settings[i]=this.defaults[i];}}}}
_createClass(Settings,[{key:'update',value:function update(settings,value){if(value===void 0){for(var i in settings){if((0,_object.hasOwnProperty)(settings,i)){this.settings[i]=settings[i];}}}else{this.settings[settings]=value;}
return this.wot;}},{key:'getSetting',value:function getSetting(key,param1,param2,param3,param4){if(typeof this.settings[key]==='function'){return this.settings[key](param1,param2,param3,param4);}else if(param1!==void 0&&Array.isArray(this.settings[key])){return this.settings[key][param1];}
return this.settings[key];}},{key:'has',value:function has(key){return!!this.settings[key];}}]);return Settings;}();exports.default=Settings;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _function=__webpack_require__(35);var _coords=__webpack_require__(42);var _coords2=_interopRequireDefault(_coords);var _range=__webpack_require__(68);var _range2=_interopRequireDefault(_range);var _column=__webpack_require__(140);var _column2=_interopRequireDefault(_column);var _row=__webpack_require__(141);var _row2=_interopRequireDefault(_row);var _tableRenderer=__webpack_require__(146);var _tableRenderer2=_interopRequireDefault(_tableRenderer);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Table=function(){function Table(wotInstance,table){var _this=this;_classCallCheck(this,Table);this.wot=wotInstance;this.instance=this.wot;this.TABLE=table;this.TBODY=null;this.THEAD=null;this.COLGROUP=null;this.tableOffset=0;this.holderOffset=0;(0,_element.removeTextNodes)(this.TABLE);this.spreader=this.createSpreader(this.TABLE);this.hider=this.createHider(this.spreader);this.holder=this.createHolder(this.hider);this.wtRootElement=this.holder.parentNode;this.alignOverlaysWithTrimmingContainer();this.fixTableDomTree();this.colgroupChildrenLength=this.COLGROUP.childNodes.length;this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0;this.tbodyChildrenLength=this.TBODY.childNodes.length;this.rowFilter=null;this.columnFilter=null;this.correctHeaderWidth=false;var origRowHeaderWidth=this.wot.wtSettings.settings.rowHeaderWidth;this.wot.wtSettings.settings.rowHeaderWidth=function(){return _this._modifyRowHeaderWidth(origRowHeaderWidth);};}
_createClass(Table,[{key:'fixTableDomTree',value:function fixTableDomTree(){this.TBODY=this.TABLE.querySelector('tbody');if(!this.TBODY){this.TBODY=document.createElement('tbody');this.TABLE.appendChild(this.TBODY);}
this.THEAD=this.TABLE.querySelector('thead');if(!this.THEAD){this.THEAD=document.createElement('thead');this.TABLE.insertBefore(this.THEAD,this.TBODY);}
this.COLGROUP=this.TABLE.querySelector('colgroup');if(!this.COLGROUP){this.COLGROUP=document.createElement('colgroup');this.TABLE.insertBefore(this.COLGROUP,this.THEAD);}
if(this.wot.getSetting('columnHeaders').length&&!this.THEAD.childNodes.length){this.THEAD.appendChild(document.createElement('TR'));}}},{key:'createSpreader',value:function createSpreader(table){var parent=table.parentNode;var spreader=void 0;if(!parent||parent.nodeType!==1||!(0,_element.hasClass)(parent,'wtHolder')){spreader=document.createElement('div');spreader.className='wtSpreader';if(parent){parent.insertBefore(spreader,table);}
spreader.appendChild(table);}
spreader.style.position='relative';return spreader;}},{key:'createHider',value:function createHider(spreader){var parent=spreader.parentNode;var hider=void 0;if(!parent||parent.nodeType!==1||!(0,_element.hasClass)(parent,'wtHolder')){hider=document.createElement('div');hider.className='wtHider';if(parent){parent.insertBefore(hider,spreader);}
hider.appendChild(spreader);}
return hider;}},{key:'createHolder',value:function createHolder(hider){var parent=hider.parentNode;var holder=void 0;if(!parent||parent.nodeType!==1||!(0,_element.hasClass)(parent,'wtHolder')){holder=document.createElement('div');holder.style.position='relative';holder.className='wtHolder';if(parent){parent.insertBefore(holder,hider);}
if(!this.isWorkingOnClone()){holder.parentNode.className+='ht_master handsontable';}
holder.appendChild(hider);}
return holder;}},{key:'alignOverlaysWithTrimmingContainer',value:function alignOverlaysWithTrimmingContainer(){var trimmingElement=(0,_element.getTrimmingContainer)(this.wtRootElement);if(!this.isWorkingOnClone()){this.holder.parentNode.style.position='relative';if(trimmingElement===window){var preventOverflow=this.wot.getSetting('preventOverflow');if(!preventOverflow){this.holder.style.overflow='visible';this.wtRootElement.style.overflow='visible';}}else{this.holder.style.width=(0,_element.getStyle)(trimmingElement,'width');this.holder.style.height=(0,_element.getStyle)(trimmingElement,'height');this.holder.style.overflow='';}}}},{key:'isWorkingOnClone',value:function isWorkingOnClone(){return!!this.wot.cloneSource;}},{key:'draw',value:function draw(fastDraw){var _wot=this.wot,wtOverlays=_wot.wtOverlays,wtViewport=_wot.wtViewport;var totalRows=this.instance.getSetting('totalRows');var rowHeaders=this.wot.getSetting('rowHeaders').length;var columnHeaders=this.wot.getSetting('columnHeaders').length;var syncScroll=false;if(!this.isWorkingOnClone()){this.holderOffset=(0,_element.offset)(this.holder);fastDraw=wtViewport.createRenderCalculators(fastDraw);if(rowHeaders&&!this.wot.getSetting('fixedColumnsLeft')){var leftScrollPos=wtOverlays.leftOverlay.getScrollPosition();var previousState=this.correctHeaderWidth;this.correctHeaderWidth=leftScrollPos>0;if(previousState!==this.correctHeaderWidth){fastDraw=false;}}}
if(!this.isWorkingOnClone()){syncScroll=wtOverlays.prepareOverlays();}
if(fastDraw){if(!this.isWorkingOnClone()){wtViewport.createVisibleCalculators();}
if(wtOverlays){wtOverlays.refresh(true);}}else{if(this.isWorkingOnClone()){this.tableOffset=this.wot.cloneSource.wtTable.tableOffset;}else{this.tableOffset=(0,_element.offset)(this.TABLE);}
var startRow=void 0;if(_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_DEBUG)||_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_TOP)||_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_TOP_LEFT_CORNER)){startRow=0;}else if(_base2.default.isOverlayTypeOf(this.instance.cloneOverlay,_base2.default.CLONE_BOTTOM)||_base2.default.isOverlayTypeOf(this.instance.cloneOverlay,_base2.default.CLONE_BOTTOM_LEFT_CORNER)){startRow=Math.max(totalRows-this.wot.getSetting('fixedRowsBottom'),0);}else{startRow=wtViewport.rowsRenderCalculator.startRow;}
var startColumn=void 0;if(_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_DEBUG)||_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_LEFT)||_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_TOP_LEFT_CORNER)||_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_BOTTOM_LEFT_CORNER)){startColumn=0;}else{startColumn=wtViewport.columnsRenderCalculator.startColumn;}
this.rowFilter=new _row2.default(startRow,totalRows,columnHeaders);this.columnFilter=new _column2.default(startColumn,this.wot.getSetting('totalColumns'),rowHeaders);this.alignOverlaysWithTrimmingContainer();this._doDraw();}
this.refreshSelections(fastDraw);if(!this.isWorkingOnClone()){wtOverlays.topOverlay.resetFixedPosition();if(wtOverlays.bottomOverlay.clone){wtOverlays.bottomOverlay.resetFixedPosition();}
wtOverlays.leftOverlay.resetFixedPosition();if(wtOverlays.topLeftCornerOverlay){wtOverlays.topLeftCornerOverlay.resetFixedPosition();}
if(wtOverlays.bottomLeftCornerOverlay&&wtOverlays.bottomLeftCornerOverlay.clone){wtOverlays.bottomLeftCornerOverlay.resetFixedPosition();}}
if(syncScroll){wtOverlays.syncScrollWithMaster();}
this.wot.drawn=true;return this;}},{key:'_doDraw',value:function _doDraw(){var wtRenderer=new _tableRenderer2.default(this);wtRenderer.render();}},{key:'removeClassFromCells',value:function removeClassFromCells(className){var nodes=this.TABLE.querySelectorAll('.'+className);for(var i=0,len=nodes.length;i<len;i++){(0,_element.removeClass)(nodes[i],className);}}},{key:'refreshSelections',value:function refreshSelections(fastDraw){if(!this.wot.selections){return;}
var len=this.wot.selections.length;if(fastDraw){for(var i=0;i<len;i++){if(this.wot.selections[i].settings.className){this.removeClassFromCells(this.wot.selections[i].settings.className);}
if(this.wot.selections[i].settings.highlightHeaderClassName){this.removeClassFromCells(this.wot.selections[i].settings.highlightHeaderClassName);}
if(this.wot.selections[i].settings.highlightRowClassName){this.removeClassFromCells(this.wot.selections[i].settings.highlightRowClassName);}
if(this.wot.selections[i].settings.highlightColumnClassName){this.removeClassFromCells(this.wot.selections[i].settings.highlightColumnClassName);}}}
for(var _i=0;_i<len;_i++){this.wot.selections[_i].draw(this.wot,fastDraw);}}},{key:'getCell',value:function getCell(coords){if(this.isRowBeforeRenderedRows(coords.row)){return-1;}else if(this.isRowAfterRenderedRows(coords.row)){return-2;}
var TR=this.TBODY.childNodes[this.rowFilter.sourceToRendered(coords.row)];if(TR){return TR.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(coords.col)];}}},{key:'getColumnHeader',value:function getColumnHeader(col){var level=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var TR=this.THEAD.childNodes[level];if(TR){return TR.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(col)];}}},{key:'getRowHeader',value:function getRowHeader(row){if(this.columnFilter.sourceColumnToVisibleRowHeadedColumn(0)===0){return null;}
var TR=this.TBODY.childNodes[this.rowFilter.sourceToRendered(row)];if(TR){return TR.childNodes[0];}}},{key:'getCoords',value:function getCoords(TD){if(TD.nodeName!=='TD'&&TD.nodeName!=='TH'){TD=(0,_element.closest)(TD,['TD','TH']);}
if(TD===null){return null;}
var TR=TD.parentNode;var CONTAINER=TR.parentNode;var row=(0,_element.index)(TR);var col=TD.cellIndex;if((0,_element.overlayContainsElement)(_base2.default.CLONE_TOP_LEFT_CORNER,TD)||(0,_element.overlayContainsElement)(_base2.default.CLONE_TOP,TD)){if(CONTAINER.nodeName==='THEAD'){row-=CONTAINER.childNodes.length;}}else if(CONTAINER===this.THEAD){row=this.rowFilter.visibleColHeadedRowToSourceRow(row);}else{row=this.rowFilter.renderedToSource(row);}
if((0,_element.overlayContainsElement)(_base2.default.CLONE_TOP_LEFT_CORNER,TD)||(0,_element.overlayContainsElement)(_base2.default.CLONE_LEFT,TD)){col=this.columnFilter.offsettedTH(col);}else{col=this.columnFilter.visibleRowHeadedColumnToSourceColumn(col);}
return new _coords2.default(row,col);}},{key:'getTrForRow',value:function getTrForRow(row){return this.TBODY.childNodes[this.rowFilter.sourceToRendered(row)];}},{key:'getFirstRenderedRow',value:function getFirstRenderedRow(){return this.wot.wtViewport.rowsRenderCalculator.startRow;}},{key:'getFirstVisibleRow',value:function getFirstVisibleRow(){return this.wot.wtViewport.rowsVisibleCalculator.startRow;}},{key:'getFirstRenderedColumn',value:function getFirstRenderedColumn(){return this.wot.wtViewport.columnsRenderCalculator.startColumn;}},{key:'getFirstVisibleColumn',value:function getFirstVisibleColumn(){return this.wot.wtViewport.columnsVisibleCalculator.startColumn;}},{key:'getLastRenderedRow',value:function getLastRenderedRow(){return this.wot.wtViewport.rowsRenderCalculator.endRow;}},{key:'getLastVisibleRow',value:function getLastVisibleRow(){return this.wot.wtViewport.rowsVisibleCalculator.endRow;}},{key:'getLastRenderedColumn',value:function getLastRenderedColumn(){return this.wot.wtViewport.columnsRenderCalculator.endColumn;}},{key:'getLastVisibleColumn',value:function getLastVisibleColumn(){return this.wot.wtViewport.columnsVisibleCalculator.endColumn;}},{key:'isRowBeforeRenderedRows',value:function isRowBeforeRenderedRows(row){return this.rowFilter&&this.rowFilter.sourceToRendered(row)<0&&row>=0;}},{key:'isRowAfterViewport',value:function isRowAfterViewport(row){return this.rowFilter&&this.rowFilter.sourceToRendered(row)>this.getLastVisibleRow();}},{key:'isRowAfterRenderedRows',value:function isRowAfterRenderedRows(row){return this.rowFilter&&this.rowFilter.sourceToRendered(row)>this.getLastRenderedRow();}},{key:'isColumnBeforeViewport',value:function isColumnBeforeViewport(column){return this.columnFilter&&this.columnFilter.sourceToRendered(column)<0&&column>=0;}},{key:'isColumnAfterViewport',value:function isColumnAfterViewport(column){return this.columnFilter&&this.columnFilter.sourceToRendered(column)>this.getLastVisibleColumn();}},{key:'isLastRowFullyVisible',value:function isLastRowFullyVisible(){return this.getLastVisibleRow()===this.getLastRenderedRow();}},{key:'isLastColumnFullyVisible',value:function isLastColumnFullyVisible(){return this.getLastVisibleColumn()===this.getLastRenderedColumn();}},{key:'getRenderedColumnsCount',value:function getRenderedColumnsCount(){var columnsCount=this.wot.wtViewport.columnsRenderCalculator.count;var totalColumns=this.wot.getSetting('totalColumns');if(this.wot.isOverlayName(_base2.default.CLONE_DEBUG)){columnsCount=totalColumns;}else if(this.wot.isOverlayName(_base2.default.CLONE_LEFT)||this.wot.isOverlayName(_base2.default.CLONE_TOP_LEFT_CORNER)||this.wot.isOverlayName(_base2.default.CLONE_BOTTOM_LEFT_CORNER)){return Math.min(this.wot.getSetting('fixedColumnsLeft'),totalColumns);}
return columnsCount;}},{key:'getRenderedRowsCount',value:function getRenderedRowsCount(){var rowsCount=this.wot.wtViewport.rowsRenderCalculator.count;var totalRows=this.wot.getSetting('totalRows');if(this.wot.isOverlayName(_base2.default.CLONE_DEBUG)){rowsCount=totalRows;}else if(this.wot.isOverlayName(_base2.default.CLONE_TOP)||this.wot.isOverlayName(_base2.default.CLONE_TOP_LEFT_CORNER)){rowsCount=Math.min(this.wot.getSetting('fixedRowsTop'),totalRows);}else if(this.wot.isOverlayName(_base2.default.CLONE_BOTTOM)||this.wot.isOverlayName(_base2.default.CLONE_BOTTOM_LEFT_CORNER)){rowsCount=Math.min(this.wot.getSetting('fixedRowsBottom'),totalRows);}
return rowsCount;}},{key:'getVisibleRowsCount',value:function getVisibleRowsCount(){return this.wot.wtViewport.rowsVisibleCalculator.count;}},{key:'allRowsInViewport',value:function allRowsInViewport(){return this.wot.getSetting('totalRows')==this.getVisibleRowsCount();}},{key:'getRowHeight',value:function getRowHeight(sourceRow){var height=this.wot.wtSettings.settings.rowHeight(sourceRow);var oversizedHeight=this.wot.wtViewport.oversizedRows[sourceRow];if(oversizedHeight!==void 0){height=height===void 0?oversizedHeight:Math.max(height,oversizedHeight);}
return height;}},{key:'getColumnHeaderHeight',value:function getColumnHeaderHeight(level){var height=this.wot.wtSettings.settings.defaultRowHeight;var oversizedHeight=this.wot.wtViewport.oversizedColumnHeaders[level];if(oversizedHeight!==void 0){height=height?Math.max(height,oversizedHeight):oversizedHeight;}
return height;}},{key:'getVisibleColumnsCount',value:function getVisibleColumnsCount(){return this.wot.wtViewport.columnsVisibleCalculator.count;}},{key:'allColumnsInViewport',value:function allColumnsInViewport(){return this.wot.getSetting('totalColumns')==this.getVisibleColumnsCount();}},{key:'getColumnWidth',value:function getColumnWidth(sourceColumn){var width=this.wot.wtSettings.settings.columnWidth;if(typeof width==='function'){width=width(sourceColumn);}else if((typeof width==='undefined'?'undefined':_typeof(width))==='object'){width=width[sourceColumn];}
return width||this.wot.wtSettings.settings.defaultColumnWidth;}},{key:'getStretchedColumnWidth',value:function getStretchedColumnWidth(sourceColumn){var columnWidth=this.getColumnWidth(sourceColumn);var width=columnWidth==null?this.instance.wtSettings.settings.defaultColumnWidth:columnWidth;var calculator=this.wot.wtViewport.columnsRenderCalculator;if(calculator){var stretchedWidth=calculator.getStretchedColumnWidth(sourceColumn,width);if(stretchedWidth){width=stretchedWidth;}}
return width;}},{key:'_modifyRowHeaderWidth',value:function _modifyRowHeaderWidth(rowHeaderWidthFactory){var widths=(0,_function.isFunction)(rowHeaderWidthFactory)?rowHeaderWidthFactory():null;if(Array.isArray(widths)){widths=[].concat(_toConsumableArray(widths));widths[widths.length-1]=this._correctRowHeaderWidth(widths[widths.length-1]);}else{widths=this._correctRowHeaderWidth(widths);}
return widths;}},{key:'_correctRowHeaderWidth',value:function _correctRowHeaderWidth(width){if(typeof width!=='number'){width=this.wot.getSetting('defaultColumnWidth');}
if(this.correctHeaderWidth){width++;}
return width;}}]);return Table;}();exports.default=Table;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var performanceWarningAppeared=false;var TableRenderer=function(){function TableRenderer(wtTable){_classCallCheck(this,TableRenderer);this.wtTable=wtTable;this.wot=wtTable.instance;this.instance=wtTable.instance;this.rowFilter=wtTable.rowFilter;this.columnFilter=wtTable.columnFilter;this.TABLE=wtTable.TABLE;this.THEAD=wtTable.THEAD;this.TBODY=wtTable.TBODY;this.COLGROUP=wtTable.COLGROUP;this.rowHeaders=[];this.rowHeaderCount=0;this.columnHeaders=[];this.columnHeaderCount=0;this.fixedRowsTop=0;this.fixedRowsBottom=0;}
_createClass(TableRenderer,[{key:'render',value:function render(){if(!this.wtTable.isWorkingOnClone()){var skipRender={};this.wot.getSetting('beforeDraw',true,skipRender);if(skipRender.skipRender===true){return;}}
this.rowHeaders=this.wot.getSetting('rowHeaders');this.rowHeaderCount=this.rowHeaders.length;this.fixedRowsTop=this.wot.getSetting('fixedRowsTop');this.fixedRowsBottom=this.wot.getSetting('fixedRowsBottom');this.columnHeaders=this.wot.getSetting('columnHeaders');this.columnHeaderCount=this.columnHeaders.length;var columnsToRender=this.wtTable.getRenderedColumnsCount();var rowsToRender=this.wtTable.getRenderedRowsCount();var totalColumns=this.wot.getSetting('totalColumns');var totalRows=this.wot.getSetting('totalRows');var workspaceWidth=void 0;var adjusted=false;if(_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_BOTTOM)||_base2.default.isOverlayTypeOf(this.wot.cloneOverlay,_base2.default.CLONE_BOTTOM_LEFT_CORNER)){this.columnHeaders=[];this.columnHeaderCount=0;}
if(totalColumns>=0){this.adjustAvailableNodes();adjusted=true;this.renderColumnHeaders();this.renderRows(totalRows,rowsToRender,columnsToRender);if(!this.wtTable.isWorkingOnClone()){workspaceWidth=this.wot.wtViewport.getWorkspaceWidth();this.wot.wtViewport.containerWidth=null;}
this.adjustColumnWidths(columnsToRender);this.markOversizedColumnHeaders();this.adjustColumnHeaderHeights();}
if(!adjusted){this.adjustAvailableNodes();}
this.removeRedundantRows(rowsToRender);if(!this.wtTable.isWorkingOnClone()||this.wot.isOverlayName(_base2.default.CLONE_BOTTOM)){this.markOversizedRows();}
if(!this.wtTable.isWorkingOnClone()){this.wot.wtViewport.createVisibleCalculators();this.wot.wtOverlays.refresh(false);this.wot.wtOverlays.applyToDOM();var hiderWidth=(0,_element.outerWidth)(this.wtTable.hider);var tableWidth=(0,_element.outerWidth)(this.wtTable.TABLE);if(hiderWidth!==0&&tableWidth!==hiderWidth){this.adjustColumnWidths(columnsToRender);}
if(workspaceWidth!==this.wot.wtViewport.getWorkspaceWidth()){this.wot.wtViewport.containerWidth=null;var firstRendered=this.wtTable.getFirstRenderedColumn();var lastRendered=this.wtTable.getLastRenderedColumn();var defaultColumnWidth=this.wot.getSetting('defaultColumnWidth');var rowHeaderWidthSetting=this.wot.getSetting('rowHeaderWidth');rowHeaderWidthSetting=this.instance.getSetting('onModifyRowHeaderWidth',rowHeaderWidthSetting);if(rowHeaderWidthSetting!=null){for(var i=0;i<this.rowHeaderCount;i++){var width=Array.isArray(rowHeaderWidthSetting)?rowHeaderWidthSetting[i]:rowHeaderWidthSetting;width=width==null?defaultColumnWidth:width;this.COLGROUP.childNodes[i].style.width=width+'px';}}
for(var _i=firstRendered;_i<lastRendered;_i++){var _width=this.wtTable.getStretchedColumnWidth(_i);var renderedIndex=this.columnFilter.sourceToRendered(_i);this.COLGROUP.childNodes[renderedIndex+this.rowHeaderCount].style.width=_width+'px';}}
this.wot.getSetting('onDraw',true);}else if(this.wot.isOverlayName(_base2.default.CLONE_BOTTOM)){this.wot.cloneSource.wtOverlays.adjustElementsSize();}}},{key:'removeRedundantRows',value:function removeRedundantRows(renderedRowsCount){while(this.wtTable.tbodyChildrenLength>renderedRowsCount){this.TBODY.removeChild(this.TBODY.lastChild);this.wtTable.tbodyChildrenLength--;}}},{key:'renderRows',value:function renderRows(totalRows,rowsToRender,columnsToRender){var lastTD=void 0,TR=void 0;var visibleRowIndex=0;var sourceRowIndex=this.rowFilter.renderedToSource(visibleRowIndex);var isWorkingOnClone=this.wtTable.isWorkingOnClone();while(sourceRowIndex<totalRows&&sourceRowIndex>=0){if(!performanceWarningAppeared&&visibleRowIndex>1000){performanceWarningAppeared=true;console.warn('Performance tip: Handsontable rendered more than 1000 visible rows. Consider limiting the number '+'of rendered rows by specifying the table height and/or turning off the "renderAllRows" option.');}
if(rowsToRender!==void 0&&visibleRowIndex===rowsToRender){break;}
TR=this.getOrCreateTrForRow(visibleRowIndex,TR);this.renderRowHeaders(sourceRowIndex,TR);this.adjustColumns(TR,columnsToRender+this.rowHeaderCount);lastTD=this.renderCells(sourceRowIndex,TR,columnsToRender);if(!isWorkingOnClone||this.wot.isOverlayName(_base2.default.CLONE_BOTTOM)){this.resetOversizedRow(sourceRowIndex);}
if(TR.firstChild){var height=this.wot.wtTable.getRowHeight(sourceRowIndex);if(height){height--;TR.firstChild.style.height=height+'px';}else{TR.firstChild.style.height='';}}
visibleRowIndex++;sourceRowIndex=this.rowFilter.renderedToSource(visibleRowIndex);}}},{key:'resetOversizedRow',value:function resetOversizedRow(sourceRow){if(this.wot.getSetting('externalRowCalculator')){return;}
if(this.wot.wtViewport.oversizedRows&&this.wot.wtViewport.oversizedRows[sourceRow]){this.wot.wtViewport.oversizedRows[sourceRow]=void 0;}}},{key:'markOversizedRows',value:function markOversizedRows(){if(this.wot.getSetting('externalRowCalculator')){return;}
var rowCount=this.instance.wtTable.TBODY.childNodes.length;var expectedTableHeight=rowCount*this.instance.wtSettings.settings.defaultRowHeight;var actualTableHeight=(0,_element.innerHeight)(this.instance.wtTable.TBODY)-1;var previousRowHeight=void 0;var rowInnerHeight=void 0;var sourceRowIndex=void 0;var currentTr=void 0;var rowHeader=void 0;var totalRows=this.instance.getSetting('totalRows');if(expectedTableHeight===actualTableHeight&&!this.instance.getSetting('fixedRowsBottom')){return;}
while(rowCount){rowCount--;sourceRowIndex=this.instance.wtTable.rowFilter.renderedToSource(rowCount);previousRowHeight=this.instance.wtTable.getRowHeight(sourceRowIndex);currentTr=this.instance.wtTable.getTrForRow(sourceRowIndex);rowHeader=currentTr.querySelector('th');if(rowHeader){rowInnerHeight=(0,_element.innerHeight)(rowHeader);}else{rowInnerHeight=(0,_element.innerHeight)(currentTr)-1;}
if(!previousRowHeight&&this.instance.wtSettings.settings.defaultRowHeight<rowInnerHeight||previousRowHeight<rowInnerHeight){this.instance.wtViewport.oversizedRows[sourceRowIndex]=++rowInnerHeight;}}}},{key:'markOversizedColumnHeaders',value:function markOversizedColumnHeaders(){var overlayName=this.wot.getOverlayName();if(!this.columnHeaderCount||this.wot.wtViewport.hasOversizedColumnHeadersMarked[overlayName]||this.wtTable.isWorkingOnClone()){return;}
var columnCount=this.wtTable.getRenderedColumnsCount();for(var i=0;i<this.columnHeaderCount;i++){for(var renderedColumnIndex=-1*this.rowHeaderCount;renderedColumnIndex<columnCount;renderedColumnIndex++){this.markIfOversizedColumnHeader(renderedColumnIndex);}}
this.wot.wtViewport.hasOversizedColumnHeadersMarked[overlayName]=true;}},{key:'adjustColumnHeaderHeights',value:function adjustColumnHeaderHeights(){var columnHeaders=this.wot.getSetting('columnHeaders');var children=this.wot.wtTable.THEAD.childNodes;var oversizedColumnHeaders=this.wot.wtViewport.oversizedColumnHeaders;for(var i=0,len=columnHeaders.length;i<len;i++){if(oversizedColumnHeaders[i]){if(!children[i]||children[i].childNodes.length===0){return;}
children[i].childNodes[0].style.height=oversizedColumnHeaders[i]+'px';}}}},{key:'markIfOversizedColumnHeader',value:function markIfOversizedColumnHeader(col){var sourceColIndex=this.wot.wtTable.columnFilter.renderedToSource(col);var level=this.columnHeaderCount;var defaultRowHeight=this.wot.wtSettings.settings.defaultRowHeight;var previousColHeaderHeight=void 0;var currentHeader=void 0;var currentHeaderHeight=void 0;var columnHeaderHeightSetting=this.wot.getSetting('columnHeaderHeight')||[];while(level){level--;previousColHeaderHeight=this.wot.wtTable.getColumnHeaderHeight(level);currentHeader=this.wot.wtTable.getColumnHeader(sourceColIndex,level);if(!currentHeader){continue;}
currentHeaderHeight=(0,_element.innerHeight)(currentHeader);if(!previousColHeaderHeight&&defaultRowHeight<currentHeaderHeight||previousColHeaderHeight<currentHeaderHeight){this.wot.wtViewport.oversizedColumnHeaders[level]=currentHeaderHeight;}
if(Array.isArray(columnHeaderHeightSetting)){if(columnHeaderHeightSetting[level]!=null){this.wot.wtViewport.oversizedColumnHeaders[level]=columnHeaderHeightSetting[level];}}else if(!isNaN(columnHeaderHeightSetting)){this.wot.wtViewport.oversizedColumnHeaders[level]=columnHeaderHeightSetting;}
if(this.wot.wtViewport.oversizedColumnHeaders[level]<(columnHeaderHeightSetting[level]||columnHeaderHeightSetting)){this.wot.wtViewport.oversizedColumnHeaders[level]=columnHeaderHeightSetting[level]||columnHeaderHeightSetting;}}}},{key:'renderCells',value:function renderCells(sourceRowIndex,TR,columnsToRender){var TD=void 0;var sourceColIndex=void 0;for(var visibleColIndex=0;visibleColIndex<columnsToRender;visibleColIndex++){sourceColIndex=this.columnFilter.renderedToSource(visibleColIndex);if(visibleColIndex===0){TD=TR.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(sourceColIndex)];}else{TD=TD.nextSibling;}
if(TD.nodeName=='TH'){TD=replaceThWithTd(TD,TR);}
if(!(0,_element.hasClass)(TD,'hide')){TD.className='';}
TD.removeAttribute('style');this.wot.wtSettings.settings.cellRenderer(sourceRowIndex,sourceColIndex,TD);}
return TD;}},{key:'adjustColumnWidths',value:function adjustColumnWidths(columnsToRender){var scrollbarCompensation=0;var sourceInstance=this.wot.cloneSource?this.wot.cloneSource:this.wot;var mainHolder=sourceInstance.wtTable.holder;var defaultColumnWidth=this.wot.getSetting('defaultColumnWidth');var rowHeaderWidthSetting=this.wot.getSetting('rowHeaderWidth');if(mainHolder.offsetHeight<mainHolder.scrollHeight){scrollbarCompensation=(0,_element.getScrollbarWidth)();}
this.wot.wtViewport.columnsRenderCalculator.refreshStretching(this.wot.wtViewport.getViewportWidth()-scrollbarCompensation);rowHeaderWidthSetting=this.instance.getSetting('onModifyRowHeaderWidth',rowHeaderWidthSetting);if(rowHeaderWidthSetting!=null){for(var i=0;i<this.rowHeaderCount;i++){var width=Array.isArray(rowHeaderWidthSetting)?rowHeaderWidthSetting[i]:rowHeaderWidthSetting;width=width==null?defaultColumnWidth:width;this.COLGROUP.childNodes[i].style.width=width+'px';}}
for(var renderedColIndex=0;renderedColIndex<columnsToRender;renderedColIndex++){var _width2=this.wtTable.getStretchedColumnWidth(this.columnFilter.renderedToSource(renderedColIndex));this.COLGROUP.childNodes[renderedColIndex+this.rowHeaderCount].style.width=_width2+'px';}}},{key:'appendToTbody',value:function appendToTbody(TR){this.TBODY.appendChild(TR);this.wtTable.tbodyChildrenLength++;}},{key:'getOrCreateTrForRow',value:function getOrCreateTrForRow(rowIndex,currentTr){var TR=void 0;if(rowIndex>=this.wtTable.tbodyChildrenLength){TR=this.createRow();this.appendToTbody(TR);}else if(rowIndex===0){TR=this.TBODY.firstChild;}else{TR=currentTr.nextSibling;}
if(TR.className){TR.removeAttribute('class');}
return TR;}},{key:'createRow',value:function createRow(){var TR=document.createElement('TR');for(var visibleColIndex=0;visibleColIndex<this.rowHeaderCount;visibleColIndex++){TR.appendChild(document.createElement('TH'));}
return TR;}},{key:'renderRowHeader',value:function renderRowHeader(row,col,TH){TH.className='';TH.removeAttribute('style');this.rowHeaders[col](row,TH,col);}},{key:'renderRowHeaders',value:function renderRowHeaders(row,TR){for(var TH=TR.firstChild,visibleColIndex=0;visibleColIndex<this.rowHeaderCount;visibleColIndex++){if(!TH){TH=document.createElement('TH');TR.appendChild(TH);}else if(TH.nodeName=='TD'){TH=replaceTdWithTh(TH,TR);}
this.renderRowHeader(row,visibleColIndex,TH);TH=TH.nextSibling;}}},{key:'adjustAvailableNodes',value:function adjustAvailableNodes(){this.adjustColGroups();this.adjustThead();}},{key:'renderColumnHeaders',value:function renderColumnHeaders(){if(!this.columnHeaderCount){return;}
var columnCount=this.wtTable.getRenderedColumnsCount();for(var i=0;i<this.columnHeaderCount;i++){var TR=this.getTrForColumnHeaders(i);for(var renderedColumnIndex=-1*this.rowHeaderCount;renderedColumnIndex<columnCount;renderedColumnIndex++){var sourceCol=this.columnFilter.renderedToSource(renderedColumnIndex);this.renderColumnHeader(i,sourceCol,TR.childNodes[renderedColumnIndex+this.rowHeaderCount]);}}}},{key:'adjustColGroups',value:function adjustColGroups(){var columnCount=this.wtTable.getRenderedColumnsCount();while(this.wtTable.colgroupChildrenLength<columnCount+this.rowHeaderCount){this.COLGROUP.appendChild(document.createElement('COL'));this.wtTable.colgroupChildrenLength++;}
while(this.wtTable.colgroupChildrenLength>columnCount+this.rowHeaderCount){this.COLGROUP.removeChild(this.COLGROUP.lastChild);this.wtTable.colgroupChildrenLength--;}
if(this.rowHeaderCount){(0,_element.addClass)(this.COLGROUP.childNodes[0],'rowHeader');}}},{key:'adjustThead',value:function adjustThead(){var columnCount=this.wtTable.getRenderedColumnsCount();var TR=this.THEAD.firstChild;if(this.columnHeaders.length){for(var i=0,len=this.columnHeaders.length;i<len;i++){TR=this.THEAD.childNodes[i];if(!TR){TR=document.createElement('TR');this.THEAD.appendChild(TR);}
this.theadChildrenLength=TR.childNodes.length;while(this.theadChildrenLength<columnCount+this.rowHeaderCount){TR.appendChild(document.createElement('TH'));this.theadChildrenLength++;}
while(this.theadChildrenLength>columnCount+this.rowHeaderCount){TR.removeChild(TR.lastChild);this.theadChildrenLength--;}}
var theadChildrenLength=this.THEAD.childNodes.length;if(theadChildrenLength>this.columnHeaders.length){for(var _i2=this.columnHeaders.length;_i2<theadChildrenLength;_i2++){this.THEAD.removeChild(this.THEAD.lastChild);}}}else if(TR){(0,_element.empty)(TR);}}},{key:'getTrForColumnHeaders',value:function getTrForColumnHeaders(index){return this.THEAD.childNodes[index];}},{key:'renderColumnHeader',value:function renderColumnHeader(row,col,TH){TH.className='';TH.removeAttribute('style');return this.columnHeaders[row](col,TH,row);}},{key:'adjustColumns',value:function adjustColumns(TR,desiredCount){var count=TR.childNodes.length;while(count<desiredCount){var TD=document.createElement('TD');TR.appendChild(TD);count++;}
while(count>desiredCount){TR.removeChild(TR.lastChild);count--;}}},{key:'removeRedundantColumns',value:function removeRedundantColumns(columnsToRender){while(this.wtTable.tbodyChildrenLength>columnsToRender){this.TBODY.removeChild(this.TBODY.lastChild);this.wtTable.tbodyChildrenLength--;}}}]);return TableRenderer;}();function replaceTdWithTh(TD,TR){var TH=document.createElement('TH');TR.insertBefore(TH,TD);TR.removeChild(TD);return TH;}
function replaceThWithTd(TH,TR){var TD=document.createElement('TD');TR.insertBefore(TD,TH);TR.removeChild(TH);return TD;}
exports.default=TableRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _object=__webpack_require__(1);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _viewportColumns=__webpack_require__(136);var _viewportColumns2=_interopRequireDefault(_viewportColumns);var _viewportRows=__webpack_require__(137);var _viewportRows2=_interopRequireDefault(_viewportRows);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Viewport=function(){function Viewport(wotInstance){var _this=this;_classCallCheck(this,Viewport);this.wot=wotInstance;this.instance=this.wot;this.oversizedRows=[];this.oversizedColumnHeaders=[];this.hasOversizedColumnHeadersMarked={};this.clientHeight=0;this.containerWidth=NaN;this.rowHeaderWidth=NaN;this.rowsVisibleCalculator=null;this.columnsVisibleCalculator=null;this.eventManager=new _eventManager2.default(this.wot);this.eventManager.addEventListener(window,'resize',function(){_this.clientHeight=_this.getWorkspaceHeight();});}
_createClass(Viewport,[{key:'getWorkspaceHeight',value:function getWorkspaceHeight(){var trimmingContainer=this.instance.wtOverlays.topOverlay.trimmingContainer;var elemHeight=void 0;var height=0;if(trimmingContainer===window){height=document.documentElement.clientHeight;}else{elemHeight=(0,_element.outerHeight)(trimmingContainer);height=elemHeight>0&&trimmingContainer.clientHeight>0?trimmingContainer.clientHeight:Infinity;}
return height;}},{key:'getWorkspaceWidth',value:function getWorkspaceWidth(){var width=void 0;var totalColumns=this.wot.getSetting('totalColumns');var trimmingContainer=this.instance.wtOverlays.leftOverlay.trimmingContainer;var overflow=void 0;var stretchSetting=this.wot.getSetting('stretchH');var docOffsetWidth=document.documentElement.offsetWidth;var preventOverflow=this.wot.getSetting('preventOverflow');if(preventOverflow){return(0,_element.outerWidth)(this.instance.wtTable.wtRootElement);}
if(this.wot.getSetting('freezeOverlays')){width=Math.min(docOffsetWidth-this.getWorkspaceOffset().left,docOffsetWidth);}else{width=Math.min(this.getContainerFillWidth(),docOffsetWidth-this.getWorkspaceOffset().left,docOffsetWidth);}
if(trimmingContainer===window&&totalColumns>0&&this.sumColumnWidths(0,totalColumns-1)>width){return document.documentElement.clientWidth;}
if(trimmingContainer!==window){overflow=(0,_element.getStyle)(this.instance.wtOverlays.leftOverlay.trimmingContainer,'overflow');if(overflow=='scroll'||overflow=='hidden'||overflow=='auto'){return Math.max(width,trimmingContainer.clientWidth);}}
if(stretchSetting==='none'||!stretchSetting){return Math.max(width,(0,_element.outerWidth)(this.instance.wtTable.TABLE));}
return width;}},{key:'hasVerticalScroll',value:function hasVerticalScroll(){return this.getWorkspaceActualHeight()>this.getWorkspaceHeight();}},{key:'hasHorizontalScroll',value:function hasHorizontalScroll(){return this.getWorkspaceActualWidth()>this.getWorkspaceWidth();}},{key:'sumColumnWidths',value:function sumColumnWidths(from,length){var sum=0;while(from<length){sum+=this.wot.wtTable.getColumnWidth(from);from++;}
return sum;}},{key:'getContainerFillWidth',value:function getContainerFillWidth(){if(this.containerWidth){return this.containerWidth;}
var mainContainer=this.instance.wtTable.holder;var fillWidth=void 0;var dummyElement=void 0;dummyElement=document.createElement('div');dummyElement.style.width='100%';dummyElement.style.height='1px';mainContainer.appendChild(dummyElement);fillWidth=dummyElement.offsetWidth;this.containerWidth=fillWidth;mainContainer.removeChild(dummyElement);return fillWidth;}},{key:'getWorkspaceOffset',value:function getWorkspaceOffset(){return(0,_element.offset)(this.wot.wtTable.TABLE);}},{key:'getWorkspaceActualHeight',value:function getWorkspaceActualHeight(){return(0,_element.outerHeight)(this.wot.wtTable.TABLE);}},{key:'getWorkspaceActualWidth',value:function getWorkspaceActualWidth(){return(0,_element.outerWidth)(this.wot.wtTable.TABLE)||(0,_element.outerWidth)(this.wot.wtTable.TBODY)||(0,_element.outerWidth)(this.wot.wtTable.THEAD);}},{key:'getColumnHeaderHeight',value:function getColumnHeaderHeight(){if(isNaN(this.columnHeaderHeight)){this.columnHeaderHeight=(0,_element.outerHeight)(this.wot.wtTable.THEAD);}
return this.columnHeaderHeight;}},{key:'getViewportHeight',value:function getViewportHeight(){var containerHeight=this.getWorkspaceHeight();var columnHeaderHeight=void 0;if(containerHeight===Infinity){return containerHeight;}
columnHeaderHeight=this.getColumnHeaderHeight();if(columnHeaderHeight>0){containerHeight-=columnHeaderHeight;}
return containerHeight;}},{key:'getRowHeaderWidth',value:function getRowHeaderWidth(){var rowHeadersHeightSetting=this.instance.getSetting('rowHeaderWidth');var rowHeaders=this.instance.getSetting('rowHeaders');if(rowHeadersHeightSetting){this.rowHeaderWidth=0;for(var i=0,len=rowHeaders.length;i<len;i++){this.rowHeaderWidth+=rowHeadersHeightSetting[i]||rowHeadersHeightSetting;}}
if(this.wot.cloneSource){return this.wot.cloneSource.wtViewport.getRowHeaderWidth();}
if(isNaN(this.rowHeaderWidth)){if(rowHeaders.length){var TH=this.instance.wtTable.TABLE.querySelector('TH');this.rowHeaderWidth=0;for(var _i=0,_len=rowHeaders.length;_i<_len;_i++){if(TH){this.rowHeaderWidth+=(0,_element.outerWidth)(TH);TH=TH.nextSibling;}else{this.rowHeaderWidth+=50;}}}else{this.rowHeaderWidth=0;}}
this.rowHeaderWidth=this.instance.getSetting('onModifyRowHeaderWidth',this.rowHeaderWidth)||this.rowHeaderWidth;return this.rowHeaderWidth;}},{key:'getViewportWidth',value:function getViewportWidth(){var containerWidth=this.getWorkspaceWidth();var rowHeaderWidth=void 0;if(containerWidth===Infinity){return containerWidth;}
rowHeaderWidth=this.getRowHeaderWidth();if(rowHeaderWidth>0){return containerWidth-rowHeaderWidth;}
return containerWidth;}},{key:'createRowsCalculator',value:function createRowsCalculator(){var _this2=this;var visible=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var height=void 0;var pos=void 0;var fixedRowsTop=void 0;var scrollbarHeight=void 0;var fixedRowsBottom=void 0;var fixedRowsHeight=void 0;var totalRows=void 0;this.rowHeaderWidth=NaN;if(this.wot.wtSettings.settings.renderAllRows){height=Infinity;}else{height=this.getViewportHeight();}
pos=this.wot.wtOverlays.topOverlay.getScrollPosition()-this.wot.wtOverlays.topOverlay.getTableParentOffset();if(pos<0){pos=0;}
fixedRowsTop=this.wot.getSetting('fixedRowsTop');fixedRowsBottom=this.wot.getSetting('fixedRowsBottom');totalRows=this.wot.getSetting('totalRows');if(fixedRowsTop){fixedRowsHeight=this.wot.wtOverlays.topOverlay.sumCellSizes(0,fixedRowsTop);pos+=fixedRowsHeight;height-=fixedRowsHeight;}
if(fixedRowsBottom&&this.wot.wtOverlays.bottomOverlay.clone){fixedRowsHeight=this.wot.wtOverlays.bottomOverlay.sumCellSizes(totalRows-fixedRowsBottom,totalRows);height-=fixedRowsHeight;}
if(this.wot.wtTable.holder.clientHeight===this.wot.wtTable.holder.offsetHeight){scrollbarHeight=0;}else{scrollbarHeight=(0,_element.getScrollbarWidth)();}
return new _viewportRows2.default(height,pos,this.wot.getSetting('totalRows'),function(sourceRow){return _this2.wot.wtTable.getRowHeight(sourceRow);},visible?null:this.wot.wtSettings.settings.viewportRowCalculatorOverride,visible,scrollbarHeight);}},{key:'createColumnsCalculator',value:function createColumnsCalculator(){var _this3=this;var visible=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var width=this.getViewportWidth();var pos=void 0;var fixedColumnsLeft=void 0;this.columnHeaderHeight=NaN;pos=this.wot.wtOverlays.leftOverlay.getScrollPosition()-this.wot.wtOverlays.leftOverlay.getTableParentOffset();if(pos<0){pos=0;}
fixedColumnsLeft=this.wot.getSetting('fixedColumnsLeft');if(fixedColumnsLeft){var fixedColumnsWidth=this.wot.wtOverlays.leftOverlay.sumCellSizes(0,fixedColumnsLeft);pos+=fixedColumnsWidth;width-=fixedColumnsWidth;}
if(this.wot.wtTable.holder.clientWidth!==this.wot.wtTable.holder.offsetWidth){width-=(0,_element.getScrollbarWidth)();}
return new _viewportColumns2.default(width,pos,this.wot.getSetting('totalColumns'),function(sourceCol){return _this3.wot.wtTable.getColumnWidth(sourceCol);},visible?null:this.wot.wtSettings.settings.viewportColumnCalculatorOverride,visible,this.wot.getSetting('stretchH'),function(stretchedWidth,column){return _this3.wot.getSetting('onBeforeStretchingColumnWidth',stretchedWidth,column);});}},{key:'createRenderCalculators',value:function createRenderCalculators(){var fastDraw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(fastDraw){var proposedRowsVisibleCalculator=this.createRowsCalculator(true);var proposedColumnsVisibleCalculator=this.createColumnsCalculator(true);if(!(this.areAllProposedVisibleRowsAlreadyRendered(proposedRowsVisibleCalculator)&&this.areAllProposedVisibleColumnsAlreadyRendered(proposedColumnsVisibleCalculator))){fastDraw=false;}}
if(!fastDraw){this.rowsRenderCalculator=this.createRowsCalculator();this.columnsRenderCalculator=this.createColumnsCalculator();}
this.rowsVisibleCalculator=null;this.columnsVisibleCalculator=null;return fastDraw;}},{key:'createVisibleCalculators',value:function createVisibleCalculators(){this.rowsVisibleCalculator=this.createRowsCalculator(true);this.columnsVisibleCalculator=this.createColumnsCalculator(true);}},{key:'areAllProposedVisibleRowsAlreadyRendered',value:function areAllProposedVisibleRowsAlreadyRendered(proposedRowsVisibleCalculator){if(this.rowsVisibleCalculator){if(proposedRowsVisibleCalculator.startRow<this.rowsRenderCalculator.startRow||proposedRowsVisibleCalculator.startRow===this.rowsRenderCalculator.startRow&&proposedRowsVisibleCalculator.startRow>0){return false;}else if(proposedRowsVisibleCalculator.endRow>this.rowsRenderCalculator.endRow||proposedRowsVisibleCalculator.endRow===this.rowsRenderCalculator.endRow&&proposedRowsVisibleCalculator.endRow<this.wot.getSetting('totalRows')-1){return false;}
return true;}
return false;}},{key:'areAllProposedVisibleColumnsAlreadyRendered',value:function areAllProposedVisibleColumnsAlreadyRendered(proposedColumnsVisibleCalculator){if(this.columnsVisibleCalculator){if(proposedColumnsVisibleCalculator.startColumn<this.columnsRenderCalculator.startColumn||proposedColumnsVisibleCalculator.startColumn===this.columnsRenderCalculator.startColumn&&proposedColumnsVisibleCalculator.startColumn>0){return false;}else if(proposedColumnsVisibleCalculator.endColumn>this.columnsRenderCalculator.endColumn||proposedColumnsVisibleCalculator.endColumn===this.columnsRenderCalculator.endColumn&&proposedColumnsVisibleCalculator.endColumn<this.wot.getSetting('totalColumns')-1){return false;}
return true;}
return false;}},{key:'resetHasOversizedColumnHeadersMarked',value:function resetHasOversizedColumnHeadersMarked(){(0,_object.objectEach)(this.hasOversizedColumnHeadersMarked,function(value,key,object){object[key]=void 0;});}}]);return Viewport;}();exports.default=Viewport;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _unicode=__webpack_require__(16);var _mixed=__webpack_require__(20);var _string=__webpack_require__(27);var _array=__webpack_require__(2);var _element=__webpack_require__(0);var _handsontableEditor=__webpack_require__(149);var _handsontableEditor2=_interopRequireDefault(_handsontableEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var AutocompleteEditor=_handsontableEditor2.default.prototype.extend();AutocompleteEditor.prototype.init=function(){_handsontableEditor2.default.prototype.init.apply(this,arguments);this.query=null;this.strippedChoices=[];this.rawChoices=[];};AutocompleteEditor.prototype.getValue=function(){var _this2=this;var selectedValue=this.rawChoices.find(function(value){var strippedValue=_this2.stripValueIfNeeded(value);return strippedValue===_this2.TEXTAREA.value;});if((0,_mixed.isDefined)(selectedValue)){return selectedValue;}
return this.TEXTAREA.value;};AutocompleteEditor.prototype.createElements=function(){_handsontableEditor2.default.prototype.createElements.apply(this,arguments);(0,_element.addClass)(this.htContainer,'autocompleteEditor');(0,_element.addClass)(this.htContainer,window.navigator.platform.indexOf('Mac')===-1?'':'htMacScroll');};var skipOne=false;function onBeforeKeyDown(event){skipOne=false;var editor=this.getActiveEditor();if((0,_unicode.isPrintableChar)(event.keyCode)||event.keyCode===_unicode.KEY_CODES.BACKSPACE||event.keyCode===_unicode.KEY_CODES.DELETE||event.keyCode===_unicode.KEY_CODES.INSERT){var timeOffset=0;if(event.keyCode===_unicode.KEY_CODES.C&&(event.ctrlKey||event.metaKey)){return;}
if(!editor.isOpened()){timeOffset+=10;}
if(editor.htEditor){editor.instance._registerTimeout(setTimeout(function(){editor.queryChoices(editor.TEXTAREA.value);skipOne=true;},timeOffset));}}}
AutocompleteEditor.prototype.prepare=function(){this.instance.addHook('beforeKeyDown',onBeforeKeyDown);_handsontableEditor2.default.prototype.prepare.apply(this,arguments);};AutocompleteEditor.prototype.open=function(){this.TEXTAREA_PARENT.style.overflow='auto';_handsontableEditor2.default.prototype.open.apply(this,arguments);this.TEXTAREA_PARENT.style.overflow='';var choicesListHot=this.htEditor.getInstance();var _this=this;var trimDropdown=this.cellProperties.trimDropdown===void 0?true:this.cellProperties.trimDropdown;this.TEXTAREA.style.visibility='visible';this.focus();choicesListHot.updateSettings({colWidths:trimDropdown?[(0,_element.outerWidth)(this.TEXTAREA)-2]:void 0,width:trimDropdown?(0,_element.outerWidth)(this.TEXTAREA)+(0,_element.getScrollbarWidth)()+2:void 0,afterRenderer:function afterRenderer(TD,row,col,prop,value,cellProperties){var _this$cellProperties=_this.cellProperties,filteringCaseSensitive=_this$cellProperties.filteringCaseSensitive,allowHtml=_this$cellProperties.allowHtml;var indexOfMatch=void 0;var match=void 0;value=(0,_mixed.stringify)(value);if(value&&!allowHtml){indexOfMatch=filteringCaseSensitive===true?value.indexOf(this.query):value.toLowerCase().indexOf(_this.query.toLowerCase());if(indexOfMatch!==-1){match=value.substr(indexOfMatch,_this.query.length);value=value.replace(match,'<strong>'+match+'</strong>');}}
TD.innerHTML=value;},autoColumnSize:true,modifyColWidth:function modifyColWidth(width,col){var autoWidths=this.getPlugin('autoColumnSize').widths;if(autoWidths[col]){width=autoWidths[col];}
return trimDropdown?width:width+15;}});this.htEditor.view.wt.wtTable.holder.parentNode.style['padding-right']=(0,_element.getScrollbarWidth)()+2+'px';if(skipOne){skipOne=false;}
_this.instance._registerTimeout(setTimeout(function(){_this.queryChoices(_this.TEXTAREA.value);},0));};AutocompleteEditor.prototype.close=function(){_handsontableEditor2.default.prototype.close.apply(this,arguments);};AutocompleteEditor.prototype.queryChoices=function(query){var _this3=this;this.query=query;var source=this.cellProperties.source;if(typeof source=='function'){source.call(this.cellProperties,query,function(choices){_this3.rawChoices=choices;_this3.updateChoicesList(_this3.stripValuesIfNeeded(choices));});}else if(Array.isArray(source)){this.rawChoices=source;this.updateChoicesList(this.stripValuesIfNeeded(source));}else{this.updateChoicesList([]);}};AutocompleteEditor.prototype.updateChoicesList=function(choices){var pos=(0,_element.getCaretPosition)(this.TEXTAREA);var endPos=(0,_element.getSelectionEndPosition)(this.TEXTAREA);var sortByRelevanceSetting=this.cellProperties.sortByRelevance;var filterSetting=this.cellProperties.filter;var orderByRelevance=null;var highlightIndex=null;if(sortByRelevanceSetting){orderByRelevance=AutocompleteEditor.sortByRelevance(this.stripValueIfNeeded(this.getValue()),choices,this.cellProperties.filteringCaseSensitive);}
var orderByRelevanceLength=Array.isArray(orderByRelevance)?orderByRelevance.length:0;if(filterSetting===false){if(orderByRelevanceLength){highlightIndex=orderByRelevance[0];}}else{var sorted=[];for(var i=0,choicesCount=choices.length;i<choicesCount;i++){if(sortByRelevanceSetting&&orderByRelevanceLength<=i){break;}
if(orderByRelevanceLength){sorted.push(choices[orderByRelevance[i]]);}else{sorted.push(choices[i]);}}
highlightIndex=0;choices=sorted;}
this.strippedChoices=choices;this.htEditor.loadData((0,_array.pivot)([choices]));this.updateDropdownHeight();this.flipDropdownIfNeeded();if(this.cellProperties.strict===true){this.highlightBestMatchingChoice(highlightIndex);}
this.instance.listen();this.TEXTAREA.focus();(0,_element.setCaretPosition)(this.TEXTAREA,pos,pos===endPos?void 0:endPos);};AutocompleteEditor.prototype.flipDropdownIfNeeded=function(){var textareaOffset=(0,_element.offset)(this.TEXTAREA);var textareaHeight=(0,_element.outerHeight)(this.TEXTAREA);var dropdownHeight=this.getDropdownHeight();var trimmingContainer=(0,_element.getTrimmingContainer)(this.instance.view.wt.wtTable.TABLE);var trimmingContainerScrollTop=trimmingContainer.scrollTop;var headersHeight=(0,_element.outerHeight)(this.instance.view.wt.wtTable.THEAD);var containerOffset={row:0,col:0};if(trimmingContainer!==window){containerOffset=(0,_element.offset)(trimmingContainer);}
var spaceAbove=textareaOffset.top-containerOffset.top-headersHeight+trimmingContainerScrollTop;var spaceBelow=trimmingContainer.scrollHeight-spaceAbove-headersHeight-textareaHeight;var flipNeeded=dropdownHeight>spaceBelow&&spaceAbove>spaceBelow;if(flipNeeded){this.flipDropdown(dropdownHeight);}else{this.unflipDropdown();}
this.limitDropdownIfNeeded(flipNeeded?spaceAbove:spaceBelow,dropdownHeight);return flipNeeded;};AutocompleteEditor.prototype.limitDropdownIfNeeded=function(spaceAvailable,dropdownHeight){if(dropdownHeight>spaceAvailable){var tempHeight=0;var i=0;var lastRowHeight=0;var height=null;do{lastRowHeight=this.htEditor.getRowHeight(i)||this.htEditor.view.wt.wtSettings.settings.defaultRowHeight;tempHeight+=lastRowHeight;i++;}while(tempHeight<spaceAvailable);height=tempHeight-lastRowHeight;if(this.htEditor.flipped){this.htEditor.rootElement.style.top=parseInt(this.htEditor.rootElement.style.top,10)+dropdownHeight-height+'px';}
this.setDropdownHeight(tempHeight-lastRowHeight);}};AutocompleteEditor.prototype.flipDropdown=function(dropdownHeight){var dropdownStyle=this.htEditor.rootElement.style;dropdownStyle.position='absolute';dropdownStyle.top=-dropdownHeight+'px';this.htEditor.flipped=true;};AutocompleteEditor.prototype.unflipDropdown=function(){var dropdownStyle=this.htEditor.rootElement.style;if(dropdownStyle.position==='absolute'){dropdownStyle.position='';dropdownStyle.top='';}
this.htEditor.flipped=void 0;};AutocompleteEditor.prototype.updateDropdownHeight=function(){var currentDropdownWidth=this.htEditor.getColWidth(0)+(0,_element.getScrollbarWidth)()+2;var trimDropdown=this.cellProperties.trimDropdown;this.htEditor.updateSettings({height:this.getDropdownHeight(),width:trimDropdown?void 0:currentDropdownWidth});this.htEditor.view.wt.wtTable.alignOverlaysWithTrimmingContainer();};AutocompleteEditor.prototype.setDropdownHeight=function(height){this.htEditor.updateSettings({height:height});};AutocompleteEditor.prototype.finishEditing=function(restoreOriginalValue){if(!restoreOriginalValue){this.instance.removeHook('beforeKeyDown',onBeforeKeyDown);}
_handsontableEditor2.default.prototype.finishEditing.apply(this,arguments);};AutocompleteEditor.prototype.highlightBestMatchingChoice=function(index){if(typeof index==='number'){this.htEditor.selectCell(index,0);}else{this.htEditor.deselectCell();}};AutocompleteEditor.sortByRelevance=function(value,choices,caseSensitive){var choicesRelevance=[];var currentItem=void 0;var valueLength=value.length;var valueIndex=void 0;var charsLeft=void 0;var result=[];var i=void 0;var choicesCount=choices.length;if(valueLength===0){for(i=0;i<choicesCount;i++){result.push(i);}
return result;}
for(i=0;i<choicesCount;i++){currentItem=(0,_string.stripTags)((0,_mixed.stringify)(choices[i]));if(caseSensitive){valueIndex=currentItem.indexOf(value);}else{valueIndex=currentItem.toLowerCase().indexOf(value.toLowerCase());}
if(valueIndex!==-1){charsLeft=currentItem.length-valueIndex-valueLength;choicesRelevance.push({baseIndex:i,index:valueIndex,charsLeft:charsLeft,value:currentItem});}}
choicesRelevance.sort(function(a,b){if(b.index===-1){return-1;}
if(a.index===-1){return 1;}
if(a.index<b.index){return-1;}else if(b.index<a.index){return 1;}else if(a.index===b.index){if(a.charsLeft<b.charsLeft){return-1;}else if(a.charsLeft>b.charsLeft){return 1;}}
return 0;});for(i=0,choicesCount=choicesRelevance.length;i<choicesCount;i++){result.push(choicesRelevance[i].baseIndex);}
return result;};AutocompleteEditor.prototype.getDropdownHeight=function(){var firstRowHeight=this.htEditor.getInstance().getRowHeight(0)||23;var visibleRows=this.cellProperties.visibleRows;return this.strippedChoices.length>=visibleRows?visibleRows*firstRowHeight:this.strippedChoices.length*firstRowHeight+8;};AutocompleteEditor.prototype.stripValueIfNeeded=function(value){return this.stripValuesIfNeeded([value])[0];};AutocompleteEditor.prototype.stripValuesIfNeeded=function(values){var allowHtml=this.cellProperties.allowHtml;var stringifiedValues=(0,_array.arrayMap)(values,function(value){return(0,_mixed.stringify)(value);});var strippedValues=(0,_array.arrayMap)(stringifiedValues,function(value){return allowHtml?value:(0,_string.stripTags)(value);});return strippedValues;};AutocompleteEditor.prototype.allowKeyEventPropagation=function(keyCode){var selected={row:this.htEditor.getSelectedRange()?this.htEditor.getSelectedRange().from.row:-1};var allowed=false;if(keyCode===_unicode.KEY_CODES.ARROW_DOWN&&selected.row>0&&selected.row<this.htEditor.countRows()-1){allowed=true;}
if(keyCode===_unicode.KEY_CODES.ARROW_UP&&selected.row>-1){allowed=true;}
return allowed;};AutocompleteEditor.prototype.discardEditor=function(result){_handsontableEditor2.default.prototype.discardEditor.apply(this,arguments);this.instance.view.render();};exports.default=AutocompleteEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _unicode=__webpack_require__(16);var _object=__webpack_require__(1);var _element=__webpack_require__(0);var _event=__webpack_require__(7);var _textEditor=__webpack_require__(43);var _textEditor2=_interopRequireDefault(_textEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var HandsontableEditor=_textEditor2.default.prototype.extend();HandsontableEditor.prototype.createElements=function(){_textEditor2.default.prototype.createElements.apply(this,arguments);var DIV=document.createElement('DIV');DIV.className='handsontableEditor';this.TEXTAREA_PARENT.appendChild(DIV);this.htContainer=DIV;this.assignHooks();};HandsontableEditor.prototype.prepare=function(td,row,col,prop,value,cellProperties){_textEditor2.default.prototype.prepare.apply(this,arguments);var parent=this;var options={startRows:0,startCols:0,minRows:0,minCols:0,className:'listbox',copyPaste:false,autoColumnSize:false,autoRowSize:false,readOnly:true,fillHandle:false,afterOnCellMouseDown:function afterOnCellMouseDown(_,coords){var value=this.getSourceData(coords.row,coords.col);if(value!==void 0){parent.setValue(value);}
parent.instance.destroyEditor();}};if(this.cellProperties.handsontable){(0,_object.extend)(options,cellProperties.handsontable);}
this.htOptions=options;};var onBeforeKeyDown=function onBeforeKeyDown(event){if((0,_event.isImmediatePropagationStopped)(event)){return;}
var editor=this.getActiveEditor();var innerHOT=editor.htEditor.getInstance();var rowToSelect;var selectedRow;if(event.keyCode==_unicode.KEY_CODES.ARROW_DOWN){if(!innerHOT.getSelected()&&!innerHOT.flipped){rowToSelect=0;}else if(innerHOT.getSelected()){if(innerHOT.flipped){rowToSelect=innerHOT.getSelected()[0]+1;}else if(!innerHOT.flipped){selectedRow=innerHOT.getSelected()[0];var lastRow=innerHOT.countRows()-1;rowToSelect=Math.min(lastRow,selectedRow+1);}}}else if(event.keyCode==_unicode.KEY_CODES.ARROW_UP){if(!innerHOT.getSelected()&&innerHOT.flipped){rowToSelect=innerHOT.countRows()-1;}else if(innerHOT.getSelected()){if(innerHOT.flipped){selectedRow=innerHOT.getSelected()[0];rowToSelect=Math.max(0,selectedRow-1);}else{selectedRow=innerHOT.getSelected()[0];rowToSelect=selectedRow-1;}}}
if(rowToSelect!==void 0){if(rowToSelect<0||innerHOT.flipped&&rowToSelect>innerHOT.countRows()-1){innerHOT.deselectCell();}else{innerHOT.selectCell(rowToSelect,0);}
if(innerHOT.getData().length){event.preventDefault();(0,_event.stopImmediatePropagation)(event);editor.instance.listen();editor.TEXTAREA.focus();}}};HandsontableEditor.prototype.open=function(){this.instance.addHook('beforeKeyDown',onBeforeKeyDown);_textEditor2.default.prototype.open.apply(this,arguments);if(this.htEditor){this.htEditor.destroy();}
this.htEditor=new this.instance.constructor(this.htContainer,this.htOptions);this.htEditor.init();if(this.cellProperties.strict){this.htEditor.selectCell(0,0);this.TEXTAREA.style.visibility='hidden';}else{this.htEditor.deselectCell();this.TEXTAREA.style.visibility='visible';}
(0,_element.setCaretPosition)(this.TEXTAREA,0,this.TEXTAREA.value.length);};HandsontableEditor.prototype.close=function(){this.instance.removeHook('beforeKeyDown',onBeforeKeyDown);this.instance.listen();_textEditor2.default.prototype.close.apply(this,arguments);};HandsontableEditor.prototype.focus=function(){this.instance.listen();_textEditor2.default.prototype.focus.apply(this,arguments);};HandsontableEditor.prototype.beginEditing=function(initialValue){var onBeginEditing=this.instance.getSettings().onBeginEditing;if(onBeginEditing&&onBeginEditing()===false){return;}
_textEditor2.default.prototype.beginEditing.apply(this,arguments);};HandsontableEditor.prototype.finishEditing=function(isCancelled,ctrlDown){if(this.htEditor&&this.htEditor.isListening()){this.instance.listen();}
if(this.htEditor&&this.htEditor.getSelected()){var value=this.htEditor.getInstance().getValue();if(value!==void 0){this.setValue(value);}}
return _textEditor2.default.prototype.finishEditing.apply(this,arguments);};HandsontableEditor.prototype.assignHooks=function(){var _this=this;this.instance.addHook('afterDestroy',function(){if(_this.htEditor){_this.htEditor.destroy();}});};exports.default=HandsontableEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _array=__webpack_require__(2);var _object=__webpack_require__(1);var _number=__webpack_require__(6);var MIXIN_NAME='arrayMapper';var arrayMapper={_arrayMap:[],getValueByIndex:function getValueByIndex(index){var value=void 0;return(value=this._arrayMap[index])===void 0?null:value;},getIndexByValue:function getIndexByValue(value){var index=void 0;return(index=this._arrayMap.indexOf(value))===-1?null:index;},insertItems:function insertItems(index){var _this=this;var amount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var newIndex=(0,_array.arrayMax)(this._arrayMap)+1;var addedItems=[];(0,_number.rangeEach)(amount-1,function(count){addedItems.push(_this._arrayMap.splice(index+count,0,newIndex+count));});return addedItems;},removeItems:function removeItems(index){var _this2=this;var amount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var removedItems=[];if(Array.isArray(index)){var mapCopy=[].concat(this._arrayMap);index.sort(function(a,b){return b-a;});removedItems=(0,_array.arrayReduce)(index,function(acc,item){_this2._arrayMap.splice(item,1);return acc.concat(mapCopy.slice(item,item+1));},[]);}else{removedItems=this._arrayMap.splice(index,amount);}
return removedItems;},unshiftItems:function unshiftItems(index){var amount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var removedItems=this.removeItems(index,amount);function countRowShift(logicalRow){return(0,_array.arrayReduce)(removedItems,function(count,removedLogicalRow){if(logicalRow>removedLogicalRow){count++;}
return count;},0);}
this._arrayMap=(0,_array.arrayMap)(this._arrayMap,function(logicalRow,physicalRow){var rowShift=countRowShift(logicalRow);if(rowShift){logicalRow-=rowShift;}
return logicalRow;});},shiftItems:function shiftItems(index){var _this3=this;var amount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this._arrayMap=(0,_array.arrayMap)(this._arrayMap,function(row){if(row>=index){row+=amount;}
return row;});(0,_number.rangeEach)(amount-1,function(count){_this3._arrayMap.splice(index+count,0,index+count);});},clearMap:function clearMap(){this._arrayMap.length=0;}};(0,_object.defineGetter)(arrayMapper,'MIXIN_NAME',MIXIN_NAME,{writable:false,enumerable:false});exports.default=arrayMapper;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _number=__webpack_require__(6);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var STATE_INITIALIZED=0;var STATE_BUILT=1;var STATE_APPENDED=2;var UNIT='px';var BaseUI=function(){function BaseUI(hotInstance){_classCallCheck(this,BaseUI);this.hot=hotInstance;this._element=null;this.state=STATE_INITIALIZED;}
_createClass(BaseUI,[{key:'appendTo',value:function appendTo(wrapper){wrapper.appendChild(this._element);this.state=STATE_APPENDED;}},{key:'build',value:function build(){this._element=document.createElement('div');this.state=STATE_BUILT;}},{key:'destroy',value:function destroy(){if(this.isAppended()){this._element.parentElement.removeChild(this._element);}
this._element=null;this.state=STATE_INITIALIZED;}},{key:'isAppended',value:function isAppended(){return this.state===STATE_APPENDED;}},{key:'isBuilt',value:function isBuilt(){return this.state>=STATE_BUILT;}},{key:'setPosition',value:function setPosition(top,left){if((0,_number.isNumeric)(top)){this._element.style.top=top+UNIT;}
if((0,_number.isNumeric)(left)){this._element.style.left=left+UNIT;}}},{key:'getPosition',value:function getPosition(){return{top:this._element.style.top?parseInt(this._element.style.top,10):0,left:this._element.style.left?parseInt(this._element.style.left,10):0};}},{key:'setSize',value:function setSize(width,height){if((0,_number.isNumeric)(width)){this._element.style.width=width+UNIT;}
if((0,_number.isNumeric)(height)){this._element.style.height=height+UNIT;}}},{key:'getSize',value:function getSize(){return{width:this._element.style.width?parseInt(this._element.style.width,10):0,height:this._element.style.height?parseInt(this._element.style.height,10):0};}},{key:'setOffset',value:function setOffset(top,left){if((0,_number.isNumeric)(top)){this._element.style.marginTop=top+UNIT;}
if((0,_number.isNumeric)(left)){this._element.style.marginLeft=left+UNIT;}}},{key:'getOffset',value:function getOffset(){return{top:this._element.style.marginTop?parseInt(this._element.style.marginTop,10):0,left:this._element.style.marginLeft?parseInt(this._element.style.marginLeft,10):0};}}]);return BaseUI;}();exports.default=BaseUI;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var STATE_INITIALIZED=0;var STATE_BUILT=1;var STATE_APPENDED=2;var UNIT='px';var BaseUI=function(){function BaseUI(hotInstance){_classCallCheck(this,BaseUI);this.hot=hotInstance;this._element=null;this.state=STATE_INITIALIZED;}
_createClass(BaseUI,[{key:'appendTo',value:function appendTo(wrapper){wrapper.appendChild(this._element);this.state=STATE_APPENDED;}},{key:'build',value:function build(){this._element=document.createElement('div');this.state=STATE_BUILT;}},{key:'destroy',value:function destroy(){if(this.isAppended()){this._element.parentElement.removeChild(this._element);}
this._element=null;this.state=STATE_INITIALIZED;}},{key:'isAppended',value:function isAppended(){return this.state===STATE_APPENDED;}},{key:'isBuilt',value:function isBuilt(){return this.state>=STATE_BUILT;}},{key:'setPosition',value:function setPosition(top,left){if(top){this._element.style.top=top+UNIT;}
if(left){this._element.style.left=left+UNIT;}}},{key:'getPosition',value:function getPosition(){return{top:this._element.style.top?parseInt(this._element.style.top,10):0,left:this._element.style.left?parseInt(this._element.style.left,10):0};}},{key:'setSize',value:function setSize(width,height){if(width){this._element.style.width=width+UNIT;}
if(height){this._element.style.height=height+UNIT;}}},{key:'getSize',value:function getSize(){return{width:this._element.style.width?parseInt(this._element.style.width,10):0,height:this._element.style.height?parseInt(this._element.style.height,10):0};}},{key:'setOffset',value:function setOffset(top,left){if(top){this._element.style.marginTop=top+UNIT;}
if(left){this._element.style.marginLeft=left+UNIT;}}},{key:'getOffset',value:function getOffset(){return{top:this._element.style.marginTop?parseInt(this._element.style.marginTop,10):0,left:this._element.style.marginLeft?parseInt(this._element.style.marginLeft,10):0};}}]);return BaseUI;}();exports.default=BaseUI;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.RecordTranslator=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();exports.registerIdentity=registerIdentity;exports.getTranslator=getTranslator;var _core=__webpack_require__(63);var _core2=_interopRequireDefault(_core);var _object=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var RecordTranslator=function(){function RecordTranslator(hot){_classCallCheck(this,RecordTranslator);this.hot=hot;}
_createClass(RecordTranslator,[{key:'toVisualRow',value:function toVisualRow(row){return this.hot.runHooks('unmodifyRow',row);}},{key:'toVisualColumn',value:function toVisualColumn(column){return this.hot.runHooks('unmodifyCol',column);}},{key:'toVisual',value:function toVisual(row,column){var result=void 0;if((0,_object.isObject)(row)){result={row:this.toVisualRow(row.row),column:this.toVisualColumn(row.column)};}else{result=[this.toVisualRow(row),this.toVisualColumn(column)];}
return result;}},{key:'toPhysicalRow',value:function toPhysicalRow(row){return this.hot.runHooks('modifyRow',row);}},{key:'toPhysicalColumn',value:function toPhysicalColumn(column){return this.hot.runHooks('modifyCol',column);}},{key:'toPhysical',value:function toPhysical(row,column){var result=void 0;if((0,_object.isObject)(row)){result={row:this.toPhysicalRow(row.row),column:this.toPhysicalColumn(row.column)};}else{result=[this.toPhysicalRow(row),this.toPhysicalColumn(column)];}
return result;}}]);return RecordTranslator;}();exports.RecordTranslator=RecordTranslator;var identities=new WeakMap();var translatorSingletons=new WeakMap();function registerIdentity(identity,hot){identities.set(identity,hot);}
function getTranslator(identity){var singleton=void 0;if(!(identity instanceof _core2.default)){if(!identities.has(identity)){throw Error('Record translator was not registered for this object identity');}
identity=identities.get(identity);}
if(translatorSingletons.has(identity)){singleton=translatorSingletons.get(identity);}else{singleton=new RecordTranslator(identity);translatorSingletons.set(identity,singleton);}
return singleton;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _object=__webpack_require__(1);var _number=__webpack_require__(6);var _mixed=__webpack_require__(20);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var SamplesGenerator=function(){_createClass(SamplesGenerator,null,[{key:'SAMPLE_COUNT',get:function get(){return 3;}}]);function SamplesGenerator(dataFactory){_classCallCheck(this,SamplesGenerator);this.samples=null;this.dataFactory=dataFactory;this.customSampleCount=null;this.allowDuplicates=false;}
_createClass(SamplesGenerator,[{key:'getSampleCount',value:function getSampleCount(){if(this.customSampleCount){return this.customSampleCount;}
return SamplesGenerator.SAMPLE_COUNT;}},{key:'setSampleCount',value:function setSampleCount(sampleCount){this.customSampleCount=sampleCount;}},{key:'setAllowDuplicates',value:function setAllowDuplicates(allowDuplicates){this.allowDuplicates=allowDuplicates;}},{key:'generateRowSamples',value:function generateRowSamples(rowRange,colRange){return this.generateSamples('row',colRange,rowRange);}},{key:'generateColumnSamples',value:function generateColumnSamples(colRange,rowRange){return this.generateSamples('col',rowRange,colRange);}},{key:'generateSamples',value:function generateSamples(type,range,specifierRange){var _this=this;var samples=new Map();if(typeof specifierRange==='number'){specifierRange={from:specifierRange,to:specifierRange};}
(0,_number.rangeEach)(specifierRange.from,specifierRange.to,function(index){var sample=_this.generateSample(type,range,index);samples.set(index,sample);});return samples;}},{key:'generateSample',value:function generateSample(type,range,specifierValue){var _this2=this;var samples=new Map();var sampledValues=[];var length=void 0;(0,_number.rangeEach)(range.from,range.to,function(index){var value=void 0;if(type==='row'){value=_this2.dataFactory(specifierValue,index);}else if(type==='col'){value=_this2.dataFactory(index,specifierValue);}else{throw new Error('Unsupported sample type');}
if((0,_object.isObject)(value)){length=Object.keys(value).length;}else if(Array.isArray(value)){length=value.length;}else{length=(0,_mixed.stringify)(value).length;}
if(!samples.has(length)){samples.set(length,{needed:_this2.getSampleCount(),strings:[]});}
var sample=samples.get(length);if(sample.needed){var duplicate=sampledValues.indexOf(value)>-1;if(!duplicate||_this2.allowDuplicates){var computedKey=type==='row'?'col':'row';sample.strings.push(_defineProperty({value:value},computedKey,index));sampledValues.push(value);sample.needed--;}}});return samples;}}]);return SamplesGenerator;}();exports.default=SamplesGenerator;}),(function(module,exports,__webpack_require__){var toIObject=__webpack_require__(23),toLength=__webpack_require__(24),toIndex=__webpack_require__(59);module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIObject($this),length=toLength(O.length),index=toIndex(fromIndex,length),value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true;}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index||0;}return!IS_INCLUDES&&-1;};};}),(function(module,exports,__webpack_require__){var cof=__webpack_require__(38),TAG=__webpack_require__(10)('toStringTag'),ARG=cof(function(){return arguments;}())=='Arguments';var tryGet=function(it,key){try{return it[key];}catch(e){}};module.exports=function(it){var O,T,B;return it===undefined?'Undefined':it===null?'Null':typeof(T=tryGet(O=Object(it),TAG))=='string'?T:ARG?cof(O):(B=cof(O))=='Object'&&typeof O.callee=='function'?'Arguments':B;};}),(function(module,exports,__webpack_require__){"use strict";var dP=__webpack_require__(19).f,create=__webpack_require__(79),redefineAll=__webpack_require__(58),ctx=__webpack_require__(29),anInstance=__webpack_require__(51),defined=__webpack_require__(30),forOf=__webpack_require__(55),$iterDefine=__webpack_require__(166),step=__webpack_require__(167),setSpecies=__webpack_require__(172),DESCRIPTORS=__webpack_require__(21),fastKey=__webpack_require__(46).fastKey,SIZE=DESCRIPTORS?'_s':'size';var getEntry=function(that,key){var index=fastKey(key),entry;if(index!=='F')return that._i[index];for(entry=that._f;entry;entry=entry.n){if(entry.k==key)return entry;}};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,'_i');that._i=create(null);that._f=undefined;that._l=undefined;that[SIZE]=0;if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that);});redefineAll(C.prototype,{clear:function clear(){for(var that=this,data=that._i,entry=that._f;entry;entry=entry.n){entry.r=true;if(entry.p)entry.p=entry.p.n=undefined;delete data[entry.i];}
that._f=that._l=undefined;that[SIZE]=0;},'delete':function(key){var that=this,entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that._i[entry.i];entry.r=true;if(prev)prev.n=next;if(next)next.p=prev;if(that._f==entry)that._f=next;if(that._l==entry)that._l=prev;that[SIZE]--;}return!!entry;},forEach:function forEach(callbackfn){anInstance(this,C,'forEach');var f=ctx(callbackfn,arguments.length>1?arguments[1]:undefined,3),entry;while(entry=entry?entry.n:this._f){f(entry.v,entry.k,this);while(entry&&entry.r)entry=entry.p;}},has:function has(key){return!!getEntry(this,key);}});if(DESCRIPTORS)dP(C.prototype,'size',{get:function(){return defined(this[SIZE]);}});return C;},def:function(that,key,value){var entry=getEntry(that,key),prev,index;if(entry){entry.v=value;}else{that._l=entry={i:index=fastKey(key,true),k:key,v:value,p:prev=that._l,n:undefined,r:false};if(!that._f)that._f=entry;if(prev)prev.n=entry;that[SIZE]++;if(index!=='F')that._i[index]=entry;}return that;},getEntry:getEntry,setStrong:function(C,NAME,IS_MAP){$iterDefine(C,NAME,function(iterated,kind){this._t=iterated;this._k=kind;this._l=undefined;},function(){var that=this,kind=that._k,entry=that._l;while(entry&&entry.r)entry=entry.p;if(!that._t||!(that._l=entry=entry?entry.n:that._t._f)){that._t=undefined;return step(1);}
if(kind=='keys')return step(0,entry.k);if(kind=='values')return step(0,entry.v);return step(0,[entry.k,entry.v]);},IS_MAP?'entries':'values',!IS_MAP,true);setSpecies(NAME);}};}),(function(module,exports,__webpack_require__){"use strict";var redefineAll=__webpack_require__(58),getWeak=__webpack_require__(46).getWeak,anObject=__webpack_require__(18),isObject=__webpack_require__(15),anInstance=__webpack_require__(51),forOf=__webpack_require__(55),createArrayMethod=__webpack_require__(52),$has=__webpack_require__(22),arrayFind=createArrayMethod(5),arrayFindIndex=createArrayMethod(6),id=0;var uncaughtFrozenStore=function(that){return that._l||(that._l=new UncaughtFrozenStore);};var UncaughtFrozenStore=function(){this.a=[];};var findUncaughtFrozen=function(store,key){return arrayFind(store.a,function(it){return it[0]===key;});};UncaughtFrozenStore.prototype={get:function(key){var entry=findUncaughtFrozen(this,key);if(entry)return entry[1];},has:function(key){return!!findUncaughtFrozen(this,key);},set:function(key,value){var entry=findUncaughtFrozen(this,key);if(entry)entry[1]=value;else this.a.push([key,value]);},'delete':function(key){var index=arrayFindIndex(this.a,function(it){return it[0]===key;});if(~index)this.a.splice(index,1);return!!~index;}};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,'_i');that._i=id++;that._l=undefined;if(iterable!=undefined)forOf(iterable,IS_MAP,that[ADDER],that);});redefineAll(C.prototype,{'delete':function(key){if(!isObject(key))return false;var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this)['delete'](key);return data&&$has(data,this._i)&&delete data[this._i];},has:function has(key){if(!isObject(key))return false;var data=getWeak(key);if(data===true)return uncaughtFrozenStore(this).has(key);return data&&$has(data,this._i);}});return C;},def:function(that,key,value){var data=getWeak(anObject(key),true);if(data===true)uncaughtFrozenStore(that).set(key,value);else data[that._i]=value;return that;},ufstore:uncaughtFrozenStore};}),(function(module,exports,__webpack_require__){module.exports=__webpack_require__(13).document&&document.documentElement;}),(function(module,exports,__webpack_require__){module.exports=!__webpack_require__(21)&&!__webpack_require__(31)(function(){return Object.defineProperty(__webpack_require__(74)('div'),'a',{get:function(){return 7;}}).a!=7;});}),(function(module,exports,__webpack_require__){var Iterators=__webpack_require__(45),ITERATOR=__webpack_require__(10)('iterator'),ArrayProto=Array.prototype;module.exports=function(it){return it!==undefined&&(Iterators.Array===it||ArrayProto[ITERATOR]===it);};}),(function(module,exports,__webpack_require__){var cof=__webpack_require__(38);module.exports=Array.isArray||function isArray(arg){return cof(arg)=='Array';};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15),floor=Math.floor;module.exports=function isInteger(it){return!isObject(it)&&isFinite(it)&&floor(it)===it;};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15),cof=__webpack_require__(38),MATCH=__webpack_require__(10)('match');module.exports=function(it){var isRegExp;return isObject(it)&&((isRegExp=it[MATCH])!==undefined?!!isRegExp:cof(it)=='RegExp');};}),(function(module,exports,__webpack_require__){var anObject=__webpack_require__(18);module.exports=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value);}catch(e){var ret=iterator['return'];if(ret!==undefined)anObject(ret.call(iterator));throw e;}};}),(function(module,exports,__webpack_require__){"use strict";var LIBRARY=__webpack_require__(56),$export=__webpack_require__(3),redefine=__webpack_require__(33),hide=__webpack_require__(32),has=__webpack_require__(22),Iterators=__webpack_require__(45),$iterCreate=__webpack_require__(285),setToStringTag=__webpack_require__(48),getPrototypeOf=__webpack_require__(290),ITERATOR=__webpack_require__(10)('iterator'),BUGGY=!([].keys&&'next'in[].keys()),FF_ITERATOR='@@iterator',KEYS='keys',VALUES='values';var returnThis=function(){return this;};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function keys(){return new Constructor(this,kind);};case VALUES:return function values(){return new Constructor(this,kind);};}return function entries(){return new Constructor(this,kind);};};var TAG=NAME+' Iterator',DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=false,proto=Base.prototype,$native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?!DEF_VALUES?$default:getMethod('entries'):undefined,$anyNative=NAME=='Array'?proto.entries||$native:$native,methods,key,IteratorPrototype;if($anyNative){IteratorPrototype=getPrototypeOf($anyNative.call(new Base));if(IteratorPrototype!==Object.prototype){setToStringTag(IteratorPrototype,TAG,true);if(!LIBRARY&&!has(IteratorPrototype,ITERATOR))hide(IteratorPrototype,ITERATOR,returnThis);}}
if(DEF_VALUES&&$native&&$native.name!==VALUES){VALUES_BUG=true;$default=function values(){return $native.call(this);};}
if((!LIBRARY||FORCED)&&(BUGGY||VALUES_BUG||!proto[ITERATOR])){hide(proto,ITERATOR,$default);}
Iterators[NAME]=$default;Iterators[TAG]=returnThis;if(DEFAULT){methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries};if(FORCED)for(key in methods){if(!(key in proto))redefine(proto,key,methods[key]);}else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods);}
return methods;};}),(function(module,exports){module.exports=function(done,value){return{value:value,done:!!done};};}),(function(module,exports,__webpack_require__){"use strict";var getKeys=__webpack_require__(39),gOPS=__webpack_require__(57),pIE=__webpack_require__(47),toObject=__webpack_require__(41),IObject=__webpack_require__(77),$assign=Object.assign;module.exports=!$assign||__webpack_require__(31)(function(){var A={},B={},S=Symbol(),K='abcdefghijklmnopqrst';A[S]=7;K.split('').forEach(function(k){B[k]=k;});return $assign({},A)[S]!=7||Object.keys($assign({},B)).join('')!=K;})?function assign(target,source){var T=toObject(target),aLen=arguments.length,index=1,getSymbols=gOPS.f,isEnum=pIE.f;while(aLen>index){var S=IObject(arguments[index++]),keys=getSymbols?getKeys(S).concat(getSymbols(S)):getKeys(S),length=keys.length,j=0,key;while(length>j)if(isEnum.call(S,key=keys[j++]))T[key]=S[key];}return T;}:$assign;}),(function(module,exports,__webpack_require__){var has=__webpack_require__(22),toIObject=__webpack_require__(23),arrayIndexOf=__webpack_require__(155)(false),IE_PROTO=__webpack_require__(82)('IE_PROTO');module.exports=function(object,names){var O=toIObject(object),i=0,result=[],key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(names.length>i)if(has(O,key=names[i++])){~arrayIndexOf(result,key)||result.push(key);}
return result;};}),(function(module,exports,__webpack_require__){var getKeys=__webpack_require__(39),toIObject=__webpack_require__(23),isEnum=__webpack_require__(47).f;module.exports=function(isEntries){return function(it){var O=toIObject(it),keys=getKeys(O),length=keys.length,i=0,result=[],key;while(length>i)if(isEnum.call(O,key=keys[i++])){result.push(isEntries?[key,O[key]]:O[key]);}return result;};};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15),anObject=__webpack_require__(18);var check=function(O,proto){anObject(O);if(!isObject(proto)&&proto!==null)throw TypeError(proto+": can't set as prototype!");};module.exports={set:Object.setPrototypeOf||('__proto__'in{}?function(test,buggy,set){try{set=__webpack_require__(29)(Function.call,__webpack_require__(80).f(Object.prototype,'__proto__').set,2);set(test,[]);buggy=!(test instanceof Array);}catch(e){buggy=true;}
return function setPrototypeOf(O,proto){check(O,proto);if(buggy)O.__proto__=proto;else set(O,proto);return O;};}({},false):undefined),check:check};}),(function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(13),dP=__webpack_require__(19),DESCRIPTORS=__webpack_require__(21),SPECIES=__webpack_require__(10)('species');module.exports=function(KEY){var C=global[KEY];if(DESCRIPTORS&&C&&!C[SPECIES])dP.f(C,SPECIES,{configurable:true,get:function(){return this;}});};}),(function(module,exports,__webpack_require__){var toLength=__webpack_require__(24),repeat=__webpack_require__(174),defined=__webpack_require__(30);module.exports=function(that,maxLength,fillString,left){var S=String(defined(that)),stringLength=S.length,fillStr=fillString===undefined?' ':String(fillString),intMaxLength=toLength(maxLength);if(intMaxLength<=stringLength||fillStr=='')return S;var fillLen=intMaxLength-stringLength,stringFiller=repeat.call(fillStr,Math.ceil(fillLen/fillStr.length));if(stringFiller.length>fillLen)stringFiller=stringFiller.slice(0,fillLen);return left?stringFiller+S:S+stringFiller;};}),(function(module,exports,__webpack_require__){"use strict";var toInteger=__webpack_require__(60),defined=__webpack_require__(30);module.exports=function repeat(count){var str=String(defined(this)),res='',n=toInteger(count);if(n<0||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))if(n&1)res+=str;return res;};}),(function(module,exports,__webpack_require__){exports.f=__webpack_require__(10);}),(function(module,exports,__webpack_require__){var classof=__webpack_require__(156),ITERATOR=__webpack_require__(10)('iterator'),Iterators=__webpack_require__(45);module.exports=__webpack_require__(44).getIteratorMethod=function(it){if(it!=undefined)return it[ITERATOR]||it['@@iterator']||Iterators[classof(it)];};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=jQueryWrapper;function jQueryWrapper(Handsontable){var jQuery=typeof window==='undefined'?false:window.jQuery;if(!jQuery){return;}
jQuery.fn.handsontable=function(action){var $this=this.first();var instance=$this.data('handsontable');if(typeof action!=='string'){var userSettings=action||{};if(instance){instance.updateSettings(userSettings);}else{instance=new Handsontable.Core($this[0],userSettings);$this.data('handsontable',instance);instance.init();}
return $this;}
var args=[];var output=void 0;if(arguments.length>1){for(var i=1,ilen=arguments.length;i<ilen;i++){args.push(arguments[i]);}}
if(instance){if(typeof instance[action]!=='undefined'){output=instance[action].apply(instance,args);if(action==='destroy'){$this.removeData();}}else{throw new Error('Handsontable do not provide action: '+action);}}
return output;};};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.Base=exports.UndoRedo=exports.TouchScroll=exports.Search=exports.PersistentState=exports.ObserveChanges=exports.MultipleSelectionHandles=exports.MergeCells=exports.ManualRowResize=exports.ManualRowMove=exports.ManualColumnResize=exports.ManualColumnMove=exports.ManualColumnFreeze=exports.DragToScroll=exports.CustomBorders=exports.CopyPaste=exports.ContextMenu=exports.Comments=exports.ColumnSorting=exports.AutoRowSize=exports.AutoFill=exports.AutoColumnSize=undefined;var _autoColumnSize=__webpack_require__(210);var _autoColumnSize2=_interopRequireDefault(_autoColumnSize);var _autofill=__webpack_require__(212);var _autofill2=_interopRequireDefault(_autofill);var _autoRowSize=__webpack_require__(211);var _autoRowSize2=_interopRequireDefault(_autoRowSize);var _columnSorting=__webpack_require__(214);var _columnSorting2=_interopRequireDefault(_columnSorting);var _comments=__webpack_require__(216);var _comments2=_interopRequireDefault(_comments);var _contextMenu=__webpack_require__(219);var _contextMenu2=_interopRequireDefault(_contextMenu);var _copyPaste=__webpack_require__(236);var _copyPaste2=_interopRequireDefault(_copyPaste);var _customBorders=__webpack_require__(238);var _customBorders2=_interopRequireDefault(_customBorders);var _dragToScroll=__webpack_require__(239);var _dragToScroll2=_interopRequireDefault(_dragToScroll);var _manualColumnFreeze=__webpack_require__(242);var _manualColumnFreeze2=_interopRequireDefault(_manualColumnFreeze);var _manualColumnMove=__webpack_require__(244);var _manualColumnMove2=_interopRequireDefault(_manualColumnMove);var _manualColumnResize=__webpack_require__(247);var _manualColumnResize2=_interopRequireDefault(_manualColumnResize);var _manualRowMove=__webpack_require__(248);var _manualRowMove2=_interopRequireDefault(_manualRowMove);var _manualRowResize=__webpack_require__(252);var _manualRowResize2=_interopRequireDefault(_manualRowResize);var _mergeCells=__webpack_require__(253);var _mergeCells2=_interopRequireDefault(_mergeCells);var _multipleSelectionHandles=__webpack_require__(254);var _multipleSelectionHandles2=_interopRequireDefault(_multipleSelectionHandles);var _observeChanges=__webpack_require__(256);var _observeChanges2=_interopRequireDefault(_observeChanges);var _persistentState=__webpack_require__(258);var _persistentState2=_interopRequireDefault(_persistentState);var _search=__webpack_require__(259);var _search2=_interopRequireDefault(_search);var _touchScroll=__webpack_require__(260);var _touchScroll2=_interopRequireDefault(_touchScroll);var _undoRedo=__webpack_require__(261);var _undoRedo2=_interopRequireDefault(_undoRedo);var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
exports.AutoColumnSize=_autoColumnSize2.default;exports.AutoFill=_autofill2.default;exports.AutoRowSize=_autoRowSize2.default;exports.ColumnSorting=_columnSorting2.default;exports.Comments=_comments2.default;exports.ContextMenu=_contextMenu2.default;exports.CopyPaste=_copyPaste2.default;exports.CustomBorders=_customBorders2.default;exports.DragToScroll=_dragToScroll2.default;exports.ManualColumnFreeze=_manualColumnFreeze2.default;exports.ManualColumnMove=_manualColumnMove2.default;exports.ManualColumnResize=_manualColumnResize2.default;exports.ManualRowMove=_manualRowMove2.default;exports.ManualRowResize=_manualRowResize2.default;exports.MergeCells=_mergeCells2.default;exports.MultipleSelectionHandles=_multipleSelectionHandles2.default;exports.ObserveChanges=_observeChanges2.default;exports.PersistentState=_persistentState2.default;exports.Search=_search2.default;exports.TouchScroll=_touchScroll2.default;exports.UndoRedo=_undoRedo2.default;exports.Base=_base2.default;}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){}),(function(module,exports,__webpack_require__){"use strict";function autoResize(){var defaults={minHeight:200,maxHeight:300,minWidth:100,maxWidth:300},el,body=document.body,text=document.createTextNode(''),span=document.createElement('SPAN'),observe=function observe(element,event,handler){if(element.attachEvent){element.attachEvent('on'+event,handler);}else{element.addEventListener(event,handler,false);}},_unObserve=function _unObserve(element,event,handler){if(element.removeEventListener){element.removeEventListener(event,handler,false);}else{element.detachEvent('on'+event,handler);}},resize=function resize(newChar){var width,scrollHeight;if(!newChar){newChar="";}else if(!/^[a-zA-Z \.,\\\/\|0-9]$/.test(newChar)){newChar=".";}
if(text.textContent!==void 0){text.textContent=el.value+newChar;}else{text.data=el.value+newChar;}
span.style.fontSize=getComputedStyle(el).fontSize;span.style.fontFamily=getComputedStyle(el).fontFamily;span.style.whiteSpace="pre";body.appendChild(span);width=span.clientWidth+2;body.removeChild(span);el.style.height=defaults.minHeight+'px';if(defaults.minWidth>width){el.style.width=defaults.minWidth+'px';}else if(width>defaults.maxWidth){el.style.width=defaults.maxWidth+'px';}else{el.style.width=width+'px';}
scrollHeight=el.scrollHeight?el.scrollHeight-1:0;if(defaults.minHeight>scrollHeight){el.style.height=defaults.minHeight+'px';}else if(defaults.maxHeight<scrollHeight){el.style.height=defaults.maxHeight+'px';el.style.overflowY='visible';}else{el.style.height=scrollHeight+'px';}},delayedResize=function delayedResize(){window.setTimeout(resize,0);},extendDefaults=function extendDefaults(config){if(config&&config.minHeight){if(config.minHeight=='inherit'){defaults.minHeight=el.clientHeight;}else{var minHeight=parseInt(config.minHeight);if(!isNaN(minHeight)){defaults.minHeight=minHeight;}}}
if(config&&config.maxHeight){if(config.maxHeight=='inherit'){defaults.maxHeight=el.clientHeight;}else{var maxHeight=parseInt(config.maxHeight);if(!isNaN(maxHeight)){defaults.maxHeight=maxHeight;}}}
if(config&&config.minWidth){if(config.minWidth=='inherit'){defaults.minWidth=el.clientWidth;}else{var minWidth=parseInt(config.minWidth);if(!isNaN(minWidth)){defaults.minWidth=minWidth;}}}
if(config&&config.maxWidth){if(config.maxWidth=='inherit'){defaults.maxWidth=el.clientWidth;}else{var maxWidth=parseInt(config.maxWidth);if(!isNaN(maxWidth)){defaults.maxWidth=maxWidth;}}}
if(!span.firstChild){span.className="autoResize";span.style.display='inline-block';span.appendChild(text);}},_init=function _init(el_,config,doObserve){el=el_;extendDefaults(config);if(el.nodeName=='TEXTAREA'){el.style.resize='none';el.style.overflowY='';el.style.height=defaults.minHeight+'px';el.style.minWidth=defaults.minWidth+'px';el.style.maxWidth=defaults.maxWidth+'px';el.style.overflowY='hidden';}
if(doObserve){observe(el,'change',resize);observe(el,'cut',delayedResize);observe(el,'paste',delayedResize);observe(el,'drop',delayedResize);observe(el,'keydown',delayedResize);observe(el,'focus',resize);}
resize();};function getComputedStyle(element){return element.currentStyle||document.defaultView.getComputedStyle(element);}
return{init:function init(el_,config,doObserve){_init(el_,config,doObserve);},unObserve:function unObserve(){_unObserve(el,'change',resize);_unObserve(el,'cut',delayedResize);_unObserve(el,'paste',delayedResize);_unObserve(el,'drop',delayedResize);_unObserve(el,'keydown',delayedResize);_unObserve(el,'focus',resize);},resize:resize};}
if(true){module.exports=autoResize;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var DebugOverlay=function(_Overlay){_inherits(DebugOverlay,_Overlay);function DebugOverlay(wotInstance){_classCallCheck(this,DebugOverlay);var _this=_possibleConstructorReturn(this,(DebugOverlay.__proto__||Object.getPrototypeOf(DebugOverlay)).call(this,wotInstance));_this.clone=_this.makeClone(_base2.default.CLONE_DEBUG);_this.clone.wtTable.holder.style.opacity=0.4;_this.clone.wtTable.holder.style.textShadow='0 0 2px #ff0000';(0,_element.addClass)(_this.clone.wtTable.holder.parentNode,'wtDebugVisible');return _this;}
return DebugOverlay;}(_base2.default);_base2.default.registerOverlay(_base2.default.CLONE_DEBUG,DebugOverlay);exports.default=DebugOverlay;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var LeftOverlay=function(_Overlay){_inherits(LeftOverlay,_Overlay);function LeftOverlay(wotInstance){_classCallCheck(this,LeftOverlay);var _this=_possibleConstructorReturn(this,(LeftOverlay.__proto__||Object.getPrototypeOf(LeftOverlay)).call(this,wotInstance));_this.clone=_this.makeClone(_base2.default.CLONE_LEFT);return _this;}
_createClass(LeftOverlay,[{key:'shouldBeRendered',value:function shouldBeRendered(){return!!(this.wot.getSetting('fixedColumnsLeft')||this.wot.getSetting('rowHeaders').length);}},{key:'resetFixedPosition',value:function resetFixedPosition(){if(!this.needFullRender||!this.wot.wtTable.holder.parentNode){return;}
var overlayRoot=this.clone.wtTable.holder.parentNode;var headerPosition=0;var preventOverflow=this.wot.getSetting('preventOverflow');if(this.trimmingContainer===window&&(!preventOverflow||preventOverflow!=='horizontal')){var box=this.wot.wtTable.hider.getBoundingClientRect();var left=Math.ceil(box.left);var right=Math.ceil(box.right);var finalLeft=void 0;var finalTop=void 0;finalTop=this.wot.wtTable.hider.style.top;finalTop=finalTop===''?0:finalTop;if(left<0&&right-overlayRoot.offsetWidth>0){finalLeft=-left;}else{finalLeft=0;}
headerPosition=finalLeft;finalLeft+='px';(0,_element.setOverlayPosition)(overlayRoot,finalLeft,finalTop);}else{headerPosition=this.getScrollPosition();(0,_element.resetCssTransform)(overlayRoot);}
this.adjustHeaderBordersPosition(headerPosition);this.adjustElementsSize();}},{key:'setScrollPosition',value:function setScrollPosition(pos){if(this.mainTableScrollableElement===window){window.scrollTo(pos,(0,_element.getWindowScrollTop)());}else{this.mainTableScrollableElement.scrollLeft=pos;}}},{key:'onScroll',value:function onScroll(){this.wot.getSetting('onScrollVertically');}},{key:'sumCellSizes',value:function sumCellSizes(from,to){var sum=0;var defaultColumnWidth=this.wot.wtSettings.defaultColumnWidth;while(from<to){sum+=this.wot.wtTable.getStretchedColumnWidth(from)||defaultColumnWidth;from++;}
return sum;}},{key:'adjustElementsSize',value:function adjustElementsSize(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.updateTrimmingContainer();if(this.needFullRender||force){this.adjustRootElementSize();this.adjustRootChildrenSize();if(!force){this.areElementSizesAdjusted=true;}}}},{key:'adjustRootElementSize',value:function adjustRootElementSize(){var masterHolder=this.wot.wtTable.holder;var scrollbarHeight=masterHolder.clientHeight===masterHolder.offsetHeight?0:(0,_element.getScrollbarWidth)();var overlayRoot=this.clone.wtTable.holder.parentNode;var overlayRootStyle=overlayRoot.style;var preventOverflow=this.wot.getSetting('preventOverflow');var tableWidth=void 0;if(this.trimmingContainer!==window||preventOverflow==='vertical'){var height=this.wot.wtViewport.getWorkspaceHeight()-scrollbarHeight;height=Math.min(height,(0,_element.innerHeight)(this.wot.wtTable.wtRootElement));overlayRootStyle.height=height+'px';}else{overlayRootStyle.height='';}
this.clone.wtTable.holder.style.height=overlayRootStyle.height;tableWidth=(0,_element.outerWidth)(this.clone.wtTable.TABLE);overlayRootStyle.width=(tableWidth===0?tableWidth:tableWidth+4)+'px';}},{key:'adjustRootChildrenSize',value:function adjustRootChildrenSize(){var scrollbarWidth=(0,_element.getScrollbarWidth)();this.clone.wtTable.hider.style.height=this.hider.style.height;this.clone.wtTable.holder.style.height=this.clone.wtTable.holder.parentNode.style.height;if(scrollbarWidth===0){scrollbarWidth=30;}
this.clone.wtTable.holder.style.width=parseInt(this.clone.wtTable.holder.parentNode.style.width,10)+scrollbarWidth+'px';}},{key:'applyToDOM',value:function applyToDOM(){var total=this.wot.getSetting('totalColumns');if(!this.areElementSizesAdjusted){this.adjustElementsSize();}
if(typeof this.wot.wtViewport.columnsRenderCalculator.startPosition==='number'){this.spreader.style.left=this.wot.wtViewport.columnsRenderCalculator.startPosition+'px';}else if(total===0){this.spreader.style.left='0';}else{throw new Error('Incorrect value of the columnsRenderCalculator');}
this.spreader.style.right='';if(this.needFullRender){this.syncOverlayOffset();}}},{key:'syncOverlayOffset',value:function syncOverlayOffset(){if(typeof this.wot.wtViewport.rowsRenderCalculator.startPosition==='number'){this.clone.wtTable.spreader.style.top=this.wot.wtViewport.rowsRenderCalculator.startPosition+'px';}else{this.clone.wtTable.spreader.style.top='';}}},{key:'scrollTo',value:function scrollTo(sourceCol,beyondRendered){var newX=this.getTableParentOffset();var sourceInstance=this.wot.cloneSource?this.wot.cloneSource:this.wot;var mainHolder=sourceInstance.wtTable.holder;var scrollbarCompensation=0;if(beyondRendered&&mainHolder.offsetWidth!==mainHolder.clientWidth){scrollbarCompensation=(0,_element.getScrollbarWidth)();}
if(beyondRendered){newX+=this.sumCellSizes(0,sourceCol+1);newX-=this.wot.wtViewport.getViewportWidth();}else{newX+=this.sumCellSizes(this.wot.getSetting('fixedColumnsLeft'),sourceCol);}
newX+=scrollbarCompensation;this.setScrollPosition(newX);}},{key:'getTableParentOffset',value:function getTableParentOffset(){var preventOverflow=this.wot.getSetting('preventOverflow');var offset=0;if(!preventOverflow&&this.trimmingContainer===window){offset=this.wot.wtTable.holderOffset.left;}
return offset;}},{key:'getScrollPosition',value:function getScrollPosition(){return(0,_element.getScrollLeft)(this.mainTableScrollableElement);}},{key:'adjustHeaderBordersPosition',value:function adjustHeaderBordersPosition(position){var masterParent=this.wot.wtTable.holder.parentNode;var rowHeaders=this.wot.getSetting('rowHeaders');var fixedColumnsLeft=this.wot.getSetting('fixedColumnsLeft');var totalRows=this.wot.getSetting('totalRows');if(totalRows){(0,_element.removeClass)(masterParent,'emptyRows');}else{(0,_element.addClass)(masterParent,'emptyRows');}
if(fixedColumnsLeft&&!rowHeaders.length){(0,_element.addClass)(masterParent,'innerBorderLeft');}else if(!fixedColumnsLeft&&rowHeaders.length){var previousState=(0,_element.hasClass)(masterParent,'innerBorderLeft');if(position){(0,_element.addClass)(masterParent,'innerBorderLeft');}else{(0,_element.removeClass)(masterParent,'innerBorderLeft');}
if(!previousState&&position||previousState&&!position){this.wot.wtOverlays.adjustElementsSize();}}}}]);return LeftOverlay;}(_base2.default);_base2.default.registerOverlay(_base2.default.CLONE_LEFT,LeftOverlay);exports.default=LeftOverlay;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var TopOverlay=function(_Overlay){_inherits(TopOverlay,_Overlay);function TopOverlay(wotInstance){_classCallCheck(this,TopOverlay);var _this=_possibleConstructorReturn(this,(TopOverlay.__proto__||Object.getPrototypeOf(TopOverlay)).call(this,wotInstance));_this.clone=_this.makeClone(_base2.default.CLONE_TOP);return _this;}
_createClass(TopOverlay,[{key:'shouldBeRendered',value:function shouldBeRendered(){return!!(this.wot.getSetting('fixedRowsTop')||this.wot.getSetting('columnHeaders').length);}},{key:'resetFixedPosition',value:function resetFixedPosition(){if(!this.needFullRender||!this.wot.wtTable.holder.parentNode){return;}
var overlayRoot=this.clone.wtTable.holder.parentNode;var headerPosition=0;var preventOverflow=this.wot.getSetting('preventOverflow');if(this.trimmingContainer===window&&(!preventOverflow||preventOverflow!=='vertical')){var box=this.wot.wtTable.hider.getBoundingClientRect();var top=Math.ceil(box.top);var bottom=Math.ceil(box.bottom);var finalLeft=void 0;var finalTop=void 0;finalLeft=this.wot.wtTable.hider.style.left;finalLeft=finalLeft===''?0:finalLeft;if(top<0&&bottom-overlayRoot.offsetHeight>0){finalTop=-top;}else{finalTop=0;}
headerPosition=finalTop;finalTop+='px';(0,_element.setOverlayPosition)(overlayRoot,finalLeft,finalTop);}else{headerPosition=this.getScrollPosition();(0,_element.resetCssTransform)(overlayRoot);}
this.adjustHeaderBordersPosition(headerPosition);this.adjustElementsSize();}},{key:'setScrollPosition',value:function setScrollPosition(pos){if(this.mainTableScrollableElement===window){window.scrollTo((0,_element.getWindowScrollLeft)(),pos);}else{this.mainTableScrollableElement.scrollTop=pos;}}},{key:'onScroll',value:function onScroll(){this.wot.getSetting('onScrollHorizontally');}},{key:'sumCellSizes',value:function sumCellSizes(from,to){var sum=0;var defaultRowHeight=this.wot.wtSettings.settings.defaultRowHeight;while(from<to){var height=this.wot.wtTable.getRowHeight(from);sum+=height===void 0?defaultRowHeight:height;from++;}
return sum;}},{key:'adjustElementsSize',value:function adjustElementsSize(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.updateTrimmingContainer();if(this.needFullRender||force){this.adjustRootElementSize();this.adjustRootChildrenSize();if(!force){this.areElementSizesAdjusted=true;}}}},{key:'adjustRootElementSize',value:function adjustRootElementSize(){var masterHolder=this.wot.wtTable.holder;var scrollbarWidth=masterHolder.clientWidth===masterHolder.offsetWidth?0:(0,_element.getScrollbarWidth)();var overlayRoot=this.clone.wtTable.holder.parentNode;var overlayRootStyle=overlayRoot.style;var preventOverflow=this.wot.getSetting('preventOverflow');var tableHeight=void 0;if(this.trimmingContainer!==window||preventOverflow==='horizontal'){var width=this.wot.wtViewport.getWorkspaceWidth()-scrollbarWidth;width=Math.min(width,(0,_element.innerWidth)(this.wot.wtTable.wtRootElement));overlayRootStyle.width=width+'px';}else{overlayRootStyle.width='';}
this.clone.wtTable.holder.style.width=overlayRootStyle.width;tableHeight=(0,_element.outerHeight)(this.clone.wtTable.TABLE);overlayRootStyle.height=(tableHeight===0?tableHeight:tableHeight+4)+'px';}},{key:'adjustRootChildrenSize',value:function adjustRootChildrenSize(){var scrollbarWidth=(0,_element.getScrollbarWidth)();this.clone.wtTable.hider.style.width=this.hider.style.width;this.clone.wtTable.holder.style.width=this.clone.wtTable.holder.parentNode.style.width;if(scrollbarWidth===0){scrollbarWidth=30;}
this.clone.wtTable.holder.style.height=parseInt(this.clone.wtTable.holder.parentNode.style.height,10)+scrollbarWidth+'px';}},{key:'applyToDOM',value:function applyToDOM(){var total=this.wot.getSetting('totalRows');if(!this.areElementSizesAdjusted){this.adjustElementsSize();}
if(typeof this.wot.wtViewport.rowsRenderCalculator.startPosition==='number'){this.spreader.style.top=this.wot.wtViewport.rowsRenderCalculator.startPosition+'px';}else if(total===0){this.spreader.style.top='0';}else{throw new Error('Incorrect value of the rowsRenderCalculator');}
this.spreader.style.bottom='';if(this.needFullRender){this.syncOverlayOffset();}}},{key:'syncOverlayOffset',value:function syncOverlayOffset(){if(typeof this.wot.wtViewport.columnsRenderCalculator.startPosition==='number'){this.clone.wtTable.spreader.style.left=this.wot.wtViewport.columnsRenderCalculator.startPosition+'px';}else{this.clone.wtTable.spreader.style.left='';}}},{key:'scrollTo',value:function scrollTo(sourceRow,bottomEdge){var newY=this.getTableParentOffset();var sourceInstance=this.wot.cloneSource?this.wot.cloneSource:this.wot;var mainHolder=sourceInstance.wtTable.holder;var scrollbarCompensation=0;if(bottomEdge&&mainHolder.offsetHeight!==mainHolder.clientHeight){scrollbarCompensation=(0,_element.getScrollbarWidth)();}
if(bottomEdge){var fixedRowsBottom=this.wot.getSetting('fixedRowsBottom');var fixedRowsTop=this.wot.getSetting('fixedRowsTop');var totalRows=this.wot.getSetting('totalRows');newY+=this.sumCellSizes(0,sourceRow+1);newY-=this.wot.wtViewport.getViewportHeight()-this.sumCellSizes(totalRows-fixedRowsBottom,totalRows);newY+=1;}else{newY+=this.sumCellSizes(this.wot.getSetting('fixedRowsTop'),sourceRow);}
newY+=scrollbarCompensation;this.setScrollPosition(newY);}},{key:'getTableParentOffset',value:function getTableParentOffset(){if(this.mainTableScrollableElement===window){return this.wot.wtTable.holderOffset.top;}
return 0;}},{key:'getScrollPosition',value:function getScrollPosition(){return(0,_element.getScrollTop)(this.mainTableScrollableElement);}},{key:'redrawSelectionBorders',value:function redrawSelectionBorders(selection){if(selection&&selection.cellRange){var border=selection.getBorder(this.wot);if(border){var corners=selection.getCorners();border.disappear();border.appear(corners);}}}},{key:'redrawAllSelectionsBorders',value:function redrawAllSelectionsBorders(){var selections=this.wot.selections;this.redrawSelectionBorders(selections.current);this.redrawSelectionBorders(selections.area);this.redrawSelectionBorders(selections.fill);this.wot.wtTable.wot.wtOverlays.leftOverlay.refresh();}},{key:'adjustHeaderBordersPosition',value:function adjustHeaderBordersPosition(position){var masterParent=this.wot.wtTable.holder.parentNode;var totalColumns=this.wot.getSetting('totalColumns');if(totalColumns){(0,_element.removeClass)(masterParent,'emptyColumns');}else{(0,_element.addClass)(masterParent,'emptyColumns');}
if(this.wot.getSetting('fixedRowsTop')===0&&this.wot.getSetting('columnHeaders').length>0){var previousState=(0,_element.hasClass)(masterParent,'innerBorderTop');if(position||this.wot.getSetting('totalRows')===0){(0,_element.addClass)(masterParent,'innerBorderTop');}else{(0,_element.removeClass)(masterParent,'innerBorderTop');}
if(!previousState&&position||previousState&&!position){this.wot.wtOverlays.adjustElementsSize();this.redrawAllSelectionsBorders();}}
if(this.wot.getSetting('rowHeaders').length===0){var secondHeaderCell=this.clone.wtTable.THEAD.querySelectorAll('th:nth-of-type(2)');if(secondHeaderCell){for(var i=0;i<secondHeaderCell.length;i++){secondHeaderCell[i].style['border-left-width']=0;}}}}}]);return TopOverlay;}(_base2.default);_base2.default.registerOverlay(_base2.default.CLONE_TOP,TopOverlay);exports.default=TopOverlay;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _base=__webpack_require__(28);var _base2=_interopRequireDefault(_base);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var TopLeftCornerOverlay=function(_Overlay){_inherits(TopLeftCornerOverlay,_Overlay);function TopLeftCornerOverlay(wotInstance){_classCallCheck(this,TopLeftCornerOverlay);var _this=_possibleConstructorReturn(this,(TopLeftCornerOverlay.__proto__||Object.getPrototypeOf(TopLeftCornerOverlay)).call(this,wotInstance));_this.clone=_this.makeClone(_base2.default.CLONE_TOP_LEFT_CORNER);return _this;}
_createClass(TopLeftCornerOverlay,[{key:'shouldBeRendered',value:function shouldBeRendered(){return!!((this.wot.getSetting('fixedRowsTop')||this.wot.getSetting('columnHeaders').length)&&(this.wot.getSetting('fixedColumnsLeft')||this.wot.getSetting('rowHeaders').length));}},{key:'resetFixedPosition',value:function resetFixedPosition(){this.updateTrimmingContainer();if(!this.wot.wtTable.holder.parentNode){return;}
var overlayRoot=this.clone.wtTable.holder.parentNode;var tableHeight=(0,_element.outerHeight)(this.clone.wtTable.TABLE);var tableWidth=(0,_element.outerWidth)(this.clone.wtTable.TABLE);var preventOverflow=this.wot.getSetting('preventOverflow');if(this.trimmingContainer===window){var box=this.wot.wtTable.hider.getBoundingClientRect();var top=Math.ceil(box.top);var left=Math.ceil(box.left);var bottom=Math.ceil(box.bottom);var right=Math.ceil(box.right);var finalLeft='0';var finalTop='0';if(!preventOverflow||preventOverflow==='vertical'){if(left<0&&right-overlayRoot.offsetWidth>0){finalLeft=-left+'px';}}
if(!preventOverflow||preventOverflow==='horizontal'){if(top<0&&bottom-overlayRoot.offsetHeight>0){finalTop=-top+'px';}}
(0,_element.setOverlayPosition)(overlayRoot,finalLeft,finalTop);}else{(0,_element.resetCssTransform)(overlayRoot);}
overlayRoot.style.height=(tableHeight===0?tableHeight:tableHeight+4)+'px';overlayRoot.style.width=(tableWidth===0?tableWidth:tableWidth+4)+'px';}}]);return TopLeftCornerOverlay;}(_base2.default);_base2.default.registerOverlay(_base2.default.CLONE_TOP_LEFT_CORNER,TopLeftCornerOverlay);exports.default=TopLeftCornerOverlay;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _border2=__webpack_require__(135);var _border3=_interopRequireDefault(_border2);var _coords=__webpack_require__(42);var _coords2=_interopRequireDefault(_coords);var _range=__webpack_require__(68);var _range2=_interopRequireDefault(_range);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Selection=function(){function Selection(settings,cellRange){_classCallCheck(this,Selection);this.settings=settings;this.cellRange=cellRange||null;this.instanceBorders={};}
_createClass(Selection,[{key:'getBorder',value:function getBorder(wotInstance){if(this.instanceBorders[wotInstance.guid]){return this.instanceBorders[wotInstance.guid];}
this.instanceBorders[wotInstance.guid]=new _border3.default(wotInstance,this.settings);}},{key:'isEmpty',value:function isEmpty(){return this.cellRange===null;}},{key:'add',value:function add(coords){if(this.isEmpty()){this.cellRange=new _range2.default(coords,coords,coords);}else{this.cellRange.expand(coords);}}},{key:'replace',value:function replace(oldCoords,newCoords){if(!this.isEmpty()){if(this.cellRange.from.isEqual(oldCoords)){this.cellRange.from=newCoords;return true;}
if(this.cellRange.to.isEqual(oldCoords)){this.cellRange.to=newCoords;return true;}}
return false;}},{key:'clear',value:function clear(){this.cellRange=null;}},{key:'getCorners',value:function getCorners(){var topLeft=this.cellRange.getTopLeftCorner();var bottomRight=this.cellRange.getBottomRightCorner();return[topLeft.row,topLeft.col,bottomRight.row,bottomRight.col];}},{key:'addClassAtCoords',value:function addClassAtCoords(wotInstance,sourceRow,sourceColumn,className){var TD=wotInstance.wtTable.getCell(new _coords2.default(sourceRow,sourceColumn));if((typeof TD==='undefined'?'undefined':_typeof(TD))==='object'){(0,_element.addClass)(TD,className);}}},{key:'draw',value:function draw(wotInstance){if(this.isEmpty()){if(this.settings.border){var border=this.getBorder(wotInstance);if(border){border.disappear();}}
return;}
var renderedRows=wotInstance.wtTable.getRenderedRowsCount();var renderedColumns=wotInstance.wtTable.getRenderedColumnsCount();var corners=this.getCorners();var sourceRow=void 0,sourceCol=void 0,TH=void 0;for(var column=0;column<renderedColumns;column++){sourceCol=wotInstance.wtTable.columnFilter.renderedToSource(column);if(sourceCol>=corners[1]&&sourceCol<=corners[3]){TH=wotInstance.wtTable.getColumnHeader(sourceCol);if(TH){var newClasses=[];if(this.settings.highlightHeaderClassName){newClasses.push(this.settings.highlightHeaderClassName);}
if(this.settings.highlightColumnClassName){newClasses.push(this.settings.highlightColumnClassName);}
(0,_element.addClass)(TH,newClasses);}}}
for(var row=0;row<renderedRows;row++){sourceRow=wotInstance.wtTable.rowFilter.renderedToSource(row);if(sourceRow>=corners[0]&&sourceRow<=corners[2]){TH=wotInstance.wtTable.getRowHeader(sourceRow);if(TH){var _newClasses=[];if(this.settings.highlightHeaderClassName){_newClasses.push(this.settings.highlightHeaderClassName);}
if(this.settings.highlightRowClassName){_newClasses.push(this.settings.highlightRowClassName);}
(0,_element.addClass)(TH,_newClasses);}}
for(var _column=0;_column<renderedColumns;_column++){sourceCol=wotInstance.wtTable.columnFilter.renderedToSource(_column);if(sourceRow>=corners[0]&&sourceRow<=corners[2]&&sourceCol>=corners[1]&&sourceCol<=corners[3]){if(this.settings.className){this.addClassAtCoords(wotInstance,sourceRow,sourceCol,this.settings.className);}}else if(sourceRow>=corners[0]&&sourceRow<=corners[2]){if(this.settings.highlightRowClassName){this.addClassAtCoords(wotInstance,sourceRow,sourceCol,this.settings.highlightRowClassName);}}else if(sourceCol>=corners[1]&&sourceCol<=corners[3]){if(this.settings.highlightColumnClassName){this.addClassAtCoords(wotInstance,sourceRow,sourceCol,this.settings.highlightColumnClassName);}}}}
wotInstance.getSetting('onBeforeDrawBorders',corners,this.settings.className);if(this.settings.border){var _border=this.getBorder(wotInstance);if(_border){_border.appear(corners);}}}}]);return Selection;}();exports.default=Selection;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var CELL_TYPE='autocomplete';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)(CELL_TYPE),validator:(0,_validators.getValidator)(CELL_TYPE)};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var CELL_TYPE='checkbox';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)(CELL_TYPE)};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var CELL_TYPE='date';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)('autocomplete'),validator:(0,_validators.getValidator)(CELL_TYPE)};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var CELL_TYPE='dropdown';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)('autocomplete'),validator:(0,_validators.getValidator)('autocomplete')};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var CELL_TYPE='handsontable';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)('autocomplete')};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var CELL_TYPE='numeric';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)(CELL_TYPE),validator:(0,_validators.getValidator)(CELL_TYPE),dataType:'number'};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var CELL_TYPE='password';exports.default={editor:(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)(CELL_TYPE),copyable:false};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _browser=__webpack_require__(25);var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var CELL_TYPE='text';exports.default={editor:(0,_browser.isMobileBrowser)()?(0,_editors.getEditor)('mobile'):(0,_editors.getEditor)(CELL_TYPE),renderer:(0,_renderers.getRenderer)(CELL_TYPE)};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var CELL_TYPE='time';exports.default={editor:(0,_editors.getEditor)('text'),renderer:(0,_renderers.getRenderer)('text'),validator:(0,_validators.getValidator)(CELL_TYPE)};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _SheetClip=__webpack_require__(133);var _SheetClip2=_interopRequireDefault(_SheetClip);var _data=__webpack_require__(64);var _setting=__webpack_require__(65);var _object=__webpack_require__(1);var _array=__webpack_require__(2);var _interval=__webpack_require__(271);var _interval2=_interopRequireDefault(_interval);var _number=__webpack_require__(6);var _multiMap=__webpack_require__(209);var _multiMap2=_interopRequireDefault(_multiMap);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function DataMap(instance,priv,GridSettings){var _this=this;this.instance=instance;this.priv=priv;this.GridSettings=GridSettings;this.dataSource=this.instance.getSettings().data;this.cachedLength=null;this.skipCache=false;this.latestSourceRowsCount=0;if(this.dataSource&&this.dataSource[0]){this.duckSchema=this.recursiveDuckSchema(this.dataSource[0]);}else{this.duckSchema={};}
this.createMap();this.interval=_interval2.default.create(function(){return _this.clearLengthCache();},'15fps');this.instance.addHook('skipLengthCache',function(delay){return _this.onSkipLengthCache(delay);});this.onSkipLengthCache(500);}
DataMap.prototype.DESTINATION_RENDERER=1;DataMap.prototype.DESTINATION_CLIPBOARD_GENERATOR=2;DataMap.prototype.recursiveDuckSchema=function(object){return(0,_object.duckSchema)(object);};DataMap.prototype.recursiveDuckColumns=function(schema,lastCol,parent){var prop,i;if(typeof lastCol==='undefined'){lastCol=0;parent='';}
if((typeof schema==='undefined'?'undefined':_typeof(schema))==='object'&&!Array.isArray(schema)){for(i in schema){if((0,_object.hasOwnProperty)(schema,i)){if(schema[i]===null){prop=parent+i;this.colToPropCache.push(prop);this.propToColCache.set(prop,lastCol);lastCol++;}else{lastCol=this.recursiveDuckColumns(schema[i],lastCol,i+'.');}}}}
return lastCol;};DataMap.prototype.createMap=function(){var i=void 0;var schema=this.getSchema();if(typeof schema==='undefined'){throw new Error('trying to create `columns` definition but you didn\'t provide `schema` nor `data`');}
this.colToPropCache=[];this.propToColCache=new _multiMap2.default();var columns=this.instance.getSettings().columns;if(columns){var maxCols=this.instance.getSettings().maxCols;var columnsLen=Math.min(maxCols,columns.length);var filteredIndex=0;var columnsAsFunc=false;var schemaLen=(0,_object.deepObjectSize)(schema);if(typeof columns==='function'){columnsLen=schemaLen>0?schemaLen:this.instance.countSourceCols();columnsAsFunc=true;}
for(i=0;i<columnsLen;i++){var column=columnsAsFunc?columns(i):columns[i];if((0,_object.isObject)(column)){if(typeof column.data!=='undefined'){var index=columnsAsFunc?filteredIndex:i;this.colToPropCache[index]=column.data;this.propToColCache.set(column.data,index);}
filteredIndex++;}}}else{this.recursiveDuckColumns(schema);}};DataMap.prototype.colToProp=function(col){col=this.instance.runHooks('modifyCol',col);if(!isNaN(col)&&this.colToPropCache&&typeof this.colToPropCache[col]!=='undefined'){return this.colToPropCache[col];}
return col;};DataMap.prototype.propToCol=function(prop){var col;if(typeof this.propToColCache.get(prop)==='undefined'){col=prop;}else{col=this.propToColCache.get(prop);}
col=this.instance.runHooks('unmodifyCol',col);return col;};DataMap.prototype.getSchema=function(){var schema=this.instance.getSettings().dataSchema;if(schema){if(typeof schema==='function'){return schema();}
return schema;}
return this.duckSchema;};DataMap.prototype.createRow=function(index,amount,source){var row,colCount=this.instance.countCols(),numberOfCreatedRows=0,currentIndex;if(!amount){amount=1;}
if(typeof index!=='number'||index>=this.instance.countSourceRows()){index=this.instance.countSourceRows();}
this.instance.runHooks('beforeCreateRow',index,amount,source);currentIndex=index;var maxRows=this.instance.getSettings().maxRows;while(numberOfCreatedRows<amount&&this.instance.countSourceRows()<maxRows){if(this.instance.dataType==='array'){if(this.instance.getSettings().dataSchema){row=(0,_object.deepClone)(this.getSchema());}else{row=[];(0,_number.rangeEach)(colCount-1,function(){return row.push(null);});}}else if(this.instance.dataType==='function'){row=this.instance.getSettings().dataSchema(index);}else{row={};(0,_object.deepExtend)(row,this.getSchema());}
if(index===this.instance.countSourceRows()){this.dataSource.push(row);}else{this.spliceData(index,0,row);}
numberOfCreatedRows++;currentIndex++;}
this.instance.runHooks('afterCreateRow',index,numberOfCreatedRows,source);this.instance.forceFullRender=true;return numberOfCreatedRows;};DataMap.prototype.createCol=function(index,amount,source){if(!this.instance.isColumnModificationAllowed()){throw new Error('Cannot create new column. When data source in an object, '+'you can only have as much columns as defined in first data row, data schema or in the \'columns\' setting.'+'If you want to be able to add new columns, you have to use array datasource.');}
var rlen=this.instance.countSourceRows(),data=this.dataSource,constructor,numberOfCreatedCols=0,currentIndex;if(!amount){amount=1;}
if(typeof index!=='number'||index>=this.instance.countCols()){index=this.instance.countCols();}
this.instance.runHooks('beforeCreateCol',index,amount,source);currentIndex=index;var maxCols=this.instance.getSettings().maxCols;while(numberOfCreatedCols<amount&&this.instance.countCols()<maxCols){constructor=(0,_setting.columnFactory)(this.GridSettings,this.priv.columnsSettingConflicts);if(typeof index!=='number'||index>=this.instance.countCols()){if(rlen>0){for(var r=0;r<rlen;r++){if(typeof data[r]==='undefined'){data[r]=[];}
data[r].push(null);}}else{data.push([null]);}
this.priv.columnSettings.push(constructor);}else{for(var _r=0;_r<rlen;_r++){data[_r].splice(currentIndex,0,null);}
this.priv.columnSettings.splice(currentIndex,0,constructor);}
numberOfCreatedCols++;currentIndex++;}
this.instance.runHooks('afterCreateCol',index,numberOfCreatedCols,source);this.instance.forceFullRender=true;return numberOfCreatedCols;};DataMap.prototype.removeRow=function(index,amount,source){if(!amount){amount=1;}
if(typeof index!=='number'){index=-amount;}
amount=this.instance.runHooks('modifyRemovedAmount',amount,index);index=(this.instance.countSourceRows()+index)%this.instance.countSourceRows();var logicRows=this.visualRowsToPhysical(index,amount);var actionWasNotCancelled=this.instance.runHooks('beforeRemoveRow',index,amount,logicRows,source);if(actionWasNotCancelled===false){return;}
var data=this.dataSource;var newData=void 0;newData=this.filterData(index,amount);if(newData){data.length=0;Array.prototype.push.apply(data,newData);}
this.instance.runHooks('afterRemoveRow',index,amount,logicRows,source);this.instance.forceFullRender=true;};DataMap.prototype.removeCol=function(index,amount,source){if(this.instance.dataType==='object'||this.instance.getSettings().columns){throw new Error('cannot remove column with object data source or columns option specified');}
if(!amount){amount=1;}
if(typeof index!=='number'){index=-amount;}
index=(this.instance.countCols()+index)%this.instance.countCols();var logicColumns=this.visualColumnsToPhysical(index,amount);var descendingLogicColumns=logicColumns.slice(0).sort(function(a,b){return b-a;});var actionWasNotCancelled=this.instance.runHooks('beforeRemoveCol',index,amount,logicColumns,source);if(actionWasNotCancelled===false){return;}
var isTableUniform=true;var removedColumnsCount=descendingLogicColumns.length;var data=this.dataSource;for(var c=0;c<removedColumnsCount;c++){if(isTableUniform&&logicColumns[0]!==logicColumns[c]-c){isTableUniform=false;}}
if(isTableUniform){for(var r=0,rlen=this.instance.countSourceRows();r<rlen;r++){data[r].splice(logicColumns[0],amount);}}else{for(var _r2=0,_rlen=this.instance.countSourceRows();_r2<_rlen;_r2++){for(var _c=0;_c<removedColumnsCount;_c++){data[_r2].splice(descendingLogicColumns[_c],1);}}
for(var _c2=0;_c2<removedColumnsCount;_c2++){this.priv.columnSettings.splice(logicColumns[_c2],1);}}
this.instance.runHooks('afterRemoveCol',index,amount,logicColumns,source);this.instance.forceFullRender=true;};DataMap.prototype.spliceCol=function(col,index,amount){var elements=arguments.length>=4?[].slice.call(arguments,3):[];var colData=this.instance.getDataAtCol(col);var removed=colData.slice(index,index+amount);var after=colData.slice(index+amount);(0,_array.extendArray)(elements,after);var i=0;while(i<amount){elements.push(null);i++;}
(0,_array.to2dArray)(elements);this.instance.populateFromArray(index,col,elements,null,null,'spliceCol');return removed;};DataMap.prototype.spliceRow=function(row,index,amount){var elements=arguments.length>=4?[].slice.call(arguments,3):[];var rowData=this.instance.getSourceDataAtRow(row);var removed=rowData.slice(index,index+amount);var after=rowData.slice(index+amount);(0,_array.extendArray)(elements,after);var i=0;while(i<amount){elements.push(null);i++;}
this.instance.populateFromArray(row,index,[elements],null,null,'spliceRow');return removed;};DataMap.prototype.spliceData=function(index,amount,element){var continueSplicing=this.instance.runHooks('beforeDataSplice',index,amount,element);if(continueSplicing!==false){this.dataSource.splice(index,amount,element);}};DataMap.prototype.filterData=function(index,amount){var physicalRows=this.visualRowsToPhysical(index,amount);var continueSplicing=this.instance.runHooks('beforeDataFilter',index,amount,physicalRows);if(continueSplicing!==false){var newData=this.dataSource.filter(function(row,index){return physicalRows.indexOf(index)==-1;});return newData;}};DataMap.prototype.get=function(row,prop){row=this.instance.runHooks('modifyRow',row);var dataRow=this.dataSource[row];var modifiedRowData=this.instance.runHooks('modifyRowData',row);dataRow=isNaN(modifiedRowData)?modifiedRowData:dataRow;var value=null;if(dataRow&&dataRow.hasOwnProperty&&(0,_object.hasOwnProperty)(dataRow,prop)){value=dataRow[prop];}else if(typeof prop==='string'&&prop.indexOf('.')>-1){var sliced=prop.split('.');var out=dataRow;if(!out){return null;}
for(var i=0,ilen=sliced.length;i<ilen;i++){out=out[sliced[i]];if(typeof out==='undefined'){return null;}}
value=out;}else if(typeof prop==='function'){value=prop(this.dataSource.slice(row,row+1)[0]);}
if(this.instance.hasHook('modifyData')){var valueHolder=(0,_object.createObjectPropListener)(value);this.instance.runHooks('modifyData',row,this.propToCol(prop),valueHolder,'get');if(valueHolder.isTouched()){value=valueHolder.value;}}
return value;};var copyableLookup=(0,_data.cellMethodLookupFactory)('copyable',false);DataMap.prototype.getCopyable=function(row,prop){if(copyableLookup.call(this.instance,row,this.propToCol(prop))){return this.get(row,prop);}
return'';};DataMap.prototype.set=function(row,prop,value,source){row=this.instance.runHooks('modifyRow',row,source||'datamapGet');var dataRow=this.dataSource[row];var modifiedRowData=this.instance.runHooks('modifyRowData',row);dataRow=isNaN(modifiedRowData)?modifiedRowData:dataRow;if(this.instance.hasHook('modifyData')){var valueHolder=(0,_object.createObjectPropListener)(value);this.instance.runHooks('modifyData',row,this.propToCol(prop),valueHolder,'set');if(valueHolder.isTouched()){value=valueHolder.value;}}
if(dataRow&&dataRow.hasOwnProperty&&(0,_object.hasOwnProperty)(dataRow,prop)){dataRow[prop]=value;}else if(typeof prop==='string'&&prop.indexOf('.')>-1){var sliced=prop.split('.');var out=dataRow;var i=0;var ilen=void 0;for(i=0,ilen=sliced.length-1;i<ilen;i++){if(typeof out[sliced[i]]==='undefined'){out[sliced[i]]={};}
out=out[sliced[i]];}
out[sliced[i]]=value;}else if(typeof prop==='function'){prop(this.dataSource.slice(row,row+1)[0],value);}else{dataRow[prop]=value;}};DataMap.prototype.visualRowsToPhysical=function(index,amount){var totalRows=this.instance.countSourceRows();var physicRow=(totalRows+index)%totalRows;var logicRows=[];var rowsToRemove=amount;var row;while(physicRow<totalRows&&rowsToRemove){row=this.instance.runHooks('modifyRow',physicRow);logicRows.push(row);rowsToRemove--;physicRow++;}
return logicRows;};DataMap.prototype.visualColumnsToPhysical=function(index,amount){var totalCols=this.instance.countCols();var physicalCol=(totalCols+index)%totalCols;var visualCols=[];var colsToRemove=amount;while(physicalCol<totalCols&&colsToRemove){var col=this.instance.runHooks('modifyCol',physicalCol);visualCols.push(col);colsToRemove--;physicalCol++;}
return visualCols;};DataMap.prototype.clear=function(){for(var r=0;r<this.instance.countSourceRows();r++){for(var c=0;c<this.instance.countCols();c++){this.set(r,this.colToProp(c),'');}}};DataMap.prototype.clearLengthCache=function(){this.cachedLength=null;};DataMap.prototype.getLength=function(){var _this2=this;var maxRows=void 0,maxRowsFromSettings=this.instance.getSettings().maxRows;if(maxRowsFromSettings<0||maxRowsFromSettings===0){maxRows=0;}else{maxRows=maxRowsFromSettings||Infinity;}
var length=this.instance.countSourceRows();if(this.instance.hasHook('modifyRow')){var reValidate=this.skipCache;this.interval.start();if(length!==this.latestSourceRowsCount){reValidate=true;}
this.latestSourceRowsCount=length;if(this.cachedLength===null||reValidate){(0,_number.rangeEach)(length-1,function(row){row=_this2.instance.runHooks('modifyRow',row);if(row===null){--length;}});this.cachedLength=length;}else{length=this.cachedLength;}}else{this.interval.stop();}
return Math.min(length,maxRows);};DataMap.prototype.getAll=function(){var start={row:0,col:0};var end={row:Math.max(this.instance.countSourceRows()-1,0),col:Math.max(this.instance.countCols()-1,0)};if(start.row-end.row===0&&!this.instance.countSourceRows()){return[];}
return this.getRange(start,end,DataMap.prototype.DESTINATION_RENDERER);};DataMap.prototype.getRange=function(start,end,destination){var r,rlen,c,clen,output=[],row;var maxRows=this.instance.getSettings().maxRows;var maxCols=this.instance.getSettings().maxCols;if(maxRows===0||maxCols===0){return[];}
var getFn=destination===this.DESTINATION_CLIPBOARD_GENERATOR?this.getCopyable:this.get;rlen=Math.min(Math.max(maxRows-1,0),Math.max(start.row,end.row));clen=Math.min(Math.max(maxCols-1,0),Math.max(start.col,end.col));for(r=Math.min(start.row,end.row);r<=rlen;r++){row=[];var physicalRow=this.instance.runHooks('modifyRow',r);for(c=Math.min(start.col,end.col);c<=clen;c++){if(physicalRow===null){break;}
row.push(getFn.call(this,r,this.colToProp(c)));}
if(physicalRow!==null){output.push(row);}}
return output;};DataMap.prototype.getText=function(start,end){return _SheetClip2.default.stringify(this.getRange(start,end,this.DESTINATION_RENDERER));};DataMap.prototype.getCopyableText=function(start,end){return _SheetClip2.default.stringify(this.getRange(start,end,this.DESTINATION_CLIPBOARD_GENERATOR));};DataMap.prototype.onSkipLengthCache=function(delay){var _this3=this;this.skipCache=true;setTimeout(function(){_this3.skipCache=false;},delay);};DataMap.prototype.destroy=function(){this.interval.stop();this.interval=null;this.instance=null;this.priv=null;this.GridSettings=null;this.dataSource=null;this.cachedLength=null;this.duckSchema=null;};exports.default=DataMap;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _object=__webpack_require__(1);var _array=__webpack_require__(2);var _number=__webpack_require__(6);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var DataSource=function(){function DataSource(hotInstance){var dataSource=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_classCallCheck(this,DataSource);this.hot=hotInstance;this.data=dataSource;this.dataType='array';this.colToProp=function(){};this.propToCol=function(){};}
_createClass(DataSource,[{key:'getData',value:function getData(){var toArray=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var result=this.data;if(toArray){result=this.getByRange({row:0,col:0},{row:Math.max(this.countRows()-1,0),col:Math.max(this.countColumns()-1,0)},true);}
return result;}},{key:'setData',value:function setData(data){this.data=data;}},{key:'getAtColumn',value:function getAtColumn(column){var _this=this;var result=[];(0,_array.arrayEach)(this.data,function(row){var property=_this.colToProp(column);if(typeof property==='string'){row=(0,_object.getProperty)(row,property);}else{row=row[property];}
result.push(row);});return result;}},{key:'getAtRow',value:function getAtRow(row){return this.data[row];}},{key:'getAtCell',value:function getAtCell(row,column){var result=null;var modifyRowData=this.hot.runHooks('modifyRowData',row);var dataRow=isNaN(modifyRowData)?modifyRowData:this.data[row];if(dataRow){var prop=this.colToProp(column);if(typeof prop==='string'){result=(0,_object.getProperty)(dataRow,prop);}else if(typeof prop==='function'){result=prop(this.data.slice(row,row+1)[0]);}else{result=dataRow[prop];}}
return result;}},{key:'getByRange',value:function getByRange(start,end){var _this2=this;var toArray=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var startRow=Math.min(start.row,end.row);var startCol=Math.min(start.col,end.col);var endRow=Math.max(start.row,end.row);var endCol=Math.max(start.col,end.col);var result=[];(0,_number.rangeEach)(startRow,endRow,function(currentRow){var row=_this2.getAtRow(currentRow);var newRow=void 0;if(_this2.dataType==='array'){newRow=row.slice(startCol,endCol+1);}else if(_this2.dataType==='object'){newRow=toArray?[]:{};(0,_number.rangeEach)(startCol,endCol,function(column){var prop=_this2.colToProp(column);if(toArray){newRow.push(row[prop]);}else{newRow[prop]=row[prop];}});}
result.push(newRow);});return result;}},{key:'countRows',value:function countRows(){return Array.isArray(this.data)?this.data.length:0;}},{key:'countColumns',value:function countColumns(){var result=0;if(Array.isArray(this.data)){if(this.dataType==='array'){result=this.data[0].length;}else if(this.dataType==='object'){result=Object.keys(this.data[0]).length;}}
return result;}},{key:'destroy',value:function destroy(){this.data=null;this.hot=null;}}]);return DataSource;}();exports.default=DataSource;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _src=__webpack_require__(11);var _unicode=__webpack_require__(16);var _event=__webpack_require__(7);var _editors=__webpack_require__(14);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _baseEditor=__webpack_require__(36);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function EditorManager(instance,priv,selection){var _this=this,destroyed=false,eventManager,activeEditor;eventManager=new _eventManager2.default(instance);function moveSelectionAfterEnter(shiftKey){selection.setSelectedHeaders(false,false,false);var enterMoves=typeof priv.settings.enterMoves==='function'?priv.settings.enterMoves(event):priv.settings.enterMoves;if(shiftKey){selection.transformStart(-enterMoves.row,-enterMoves.col);}else{selection.transformStart(enterMoves.row,enterMoves.col,true);}}
function moveSelectionUp(shiftKey){if(shiftKey){if(selection.selectedHeader.cols){selection.setSelectedHeaders(selection.selectedHeader.rows,false,false);}
selection.transformEnd(-1,0);}else{selection.setSelectedHeaders(false,false,false);selection.transformStart(-1,0);}}
function moveSelectionDown(shiftKey){if(shiftKey){selection.transformEnd(1,0);}else{selection.setSelectedHeaders(false,false,false);selection.transformStart(1,0);}}
function moveSelectionRight(shiftKey){if(shiftKey){selection.transformEnd(0,1);}else{selection.setSelectedHeaders(false,false,false);selection.transformStart(0,1);}}
function moveSelectionLeft(shiftKey){if(shiftKey){if(selection.selectedHeader.rows){selection.setSelectedHeaders(false,selection.selectedHeader.cols,false);}
selection.transformEnd(0,-1);}else{selection.setSelectedHeaders(false,false,false);selection.transformStart(0,-1);}}
function onKeyDown(event){var ctrlDown,rangeModifier;if(!instance.isListening()){return;}
instance.runHooks('beforeKeyDown',event);if(destroyed){return;}
if((0,_event.isImmediatePropagationStopped)(event)){return;}
priv.lastKeyCode=event.keyCode;if(!selection.isSelected()){return;}
ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(activeEditor&&!activeEditor.isWaiting()){if(!(0,_unicode.isMetaKey)(event.keyCode)&&!(0,_unicode.isCtrlKey)(event.keyCode)&&!ctrlDown&&!_this.isEditorOpened()){_this.openEditor('',event);return;}}
rangeModifier=event.shiftKey?selection.setRangeEnd:selection.setRangeStart;switch(event.keyCode){case _unicode.KEY_CODES.A:if(!_this.isEditorOpened()&&ctrlDown){selection.selectAll();event.preventDefault();(0,_event.stopPropagation)(event);}
break;case _unicode.KEY_CODES.ARROW_UP:if(_this.isEditorOpened()&&!activeEditor.isWaiting()){_this.closeEditorAndSaveChanges(ctrlDown);}
moveSelectionUp(event.shiftKey);event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.ARROW_DOWN:if(_this.isEditorOpened()&&!activeEditor.isWaiting()){_this.closeEditorAndSaveChanges(ctrlDown);}
moveSelectionDown(event.shiftKey);event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.ARROW_RIGHT:if(_this.isEditorOpened()&&!activeEditor.isWaiting()){_this.closeEditorAndSaveChanges(ctrlDown);}
moveSelectionRight(event.shiftKey);event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.ARROW_LEFT:if(_this.isEditorOpened()&&!activeEditor.isWaiting()){_this.closeEditorAndSaveChanges(ctrlDown);}
moveSelectionLeft(event.shiftKey);event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.TAB:selection.setSelectedHeaders(false,false,false);var tabMoves=typeof priv.settings.tabMoves==='function'?priv.settings.tabMoves(event):priv.settings.tabMoves;if(event.shiftKey){selection.transformStart(-tabMoves.row,-tabMoves.col);}else{selection.transformStart(tabMoves.row,tabMoves.col,true);}
event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.BACKSPACE:case _unicode.KEY_CODES.DELETE:selection.empty(event);_this.prepareEditor();event.preventDefault();break;case _unicode.KEY_CODES.F2:_this.openEditor(null,event);if(activeEditor){activeEditor.enableFullEditMode();}
event.preventDefault();break;case _unicode.KEY_CODES.ENTER:if(_this.isEditorOpened()){if(activeEditor&&activeEditor.state!==_baseEditor.EditorState.WAITING){_this.closeEditorAndSaveChanges(ctrlDown);}
moveSelectionAfterEnter(event.shiftKey);}else if(instance.getSettings().enterBeginsEditing){_this.openEditor(null,event);if(activeEditor){activeEditor.enableFullEditMode();}}else{moveSelectionAfterEnter(event.shiftKey);}
event.preventDefault();(0,_event.stopImmediatePropagation)(event);break;case _unicode.KEY_CODES.ESCAPE:if(_this.isEditorOpened()){_this.closeEditorAndRestoreOriginalValue(ctrlDown);}
event.preventDefault();break;case _unicode.KEY_CODES.HOME:selection.setSelectedHeaders(false,false,false);if(event.ctrlKey||event.metaKey){rangeModifier(new _src.CellCoords(0,priv.selRange.from.col));}else{rangeModifier(new _src.CellCoords(priv.selRange.from.row,0));}
event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.END:selection.setSelectedHeaders(false,false,false);if(event.ctrlKey||event.metaKey){rangeModifier(new _src.CellCoords(instance.countRows()-1,priv.selRange.from.col));}else{rangeModifier(new _src.CellCoords(priv.selRange.from.row,instance.countCols()-1));}
event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.PAGE_UP:selection.setSelectedHeaders(false,false,false);selection.transformStart(-instance.countVisibleRows(),0);event.preventDefault();(0,_event.stopPropagation)(event);break;case _unicode.KEY_CODES.PAGE_DOWN:selection.setSelectedHeaders(false,false,false);selection.transformStart(instance.countVisibleRows(),0);event.preventDefault();(0,_event.stopPropagation)(event);break;default:break;}}
function init(){instance.addHook('afterDocumentKeyDown',onKeyDown);eventManager.addEventListener(document.documentElement,'keydown',function(event){if(!destroyed){instance.runHooks('afterDocumentKeyDown',event);}});function onDblClick(event,coords,elem){if(elem.nodeName=='TD'){_this.openEditor();if(activeEditor){activeEditor.enableFullEditMode();}}}
instance.view.wt.update('onCellDblClick',onDblClick);instance.addHook('afterDestroy',function(){destroyed=true;});}
this.destroyEditor=function(revertOriginal){this.closeEditor(revertOriginal);};this.getActiveEditor=function(){return activeEditor;};this.prepareEditor=function(){var row,col,prop,td,originalValue,cellProperties,editorClass;if(activeEditor&&activeEditor.isWaiting()){this.closeEditor(false,false,function(dataSaved){if(dataSaved){_this.prepareEditor();}});return;}
row=priv.selRange.highlight.row;col=priv.selRange.highlight.col;prop=instance.colToProp(col);td=instance.getCell(row,col);originalValue=instance.getSourceDataAtCell(instance.runHooks('modifyRow',row),col);cellProperties=instance.getCellMeta(row,col);editorClass=instance.getCellEditor(cellProperties);if(editorClass){activeEditor=(0,_editors.getEditorInstance)(editorClass,instance);activeEditor.prepare(row,col,prop,td,originalValue,cellProperties);}else{activeEditor=void 0;}};this.isEditorOpened=function(){return activeEditor&&activeEditor.isOpened();};this.openEditor=function(initialValue,event){if(activeEditor&&!activeEditor.cellProperties.readOnly){activeEditor.beginEditing(initialValue,event);}else if(activeEditor&&activeEditor.cellProperties.readOnly){if(event&&event.keyCode===_unicode.KEY_CODES.ENTER){moveSelectionAfterEnter();}}};this.closeEditor=function(restoreOriginalValue,ctrlDown,callback){if(activeEditor){activeEditor.finishEditing(restoreOriginalValue,ctrlDown,callback);}else if(callback){callback(false);}};this.closeEditorAndSaveChanges=function(ctrlDown){return this.closeEditor(false,ctrlDown);};this.closeEditorAndRestoreOriginalValue=function(ctrlDown){return this.closeEditor(true,ctrlDown);};init();}
exports.default=EditorManager;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _baseEditor=__webpack_require__(36);var _baseEditor2=_interopRequireDefault(_baseEditor);var _element=__webpack_require__(0);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var CheckboxEditor=function(_BaseEditor){_inherits(CheckboxEditor,_BaseEditor);function CheckboxEditor(){_classCallCheck(this,CheckboxEditor);return _possibleConstructorReturn(this,(CheckboxEditor.__proto__||Object.getPrototypeOf(CheckboxEditor)).apply(this,arguments));}
_createClass(CheckboxEditor,[{key:'beginEditing',value:function beginEditing(initialValue,event){if(event===void 0){var checkbox=this.TD.querySelector('input[type="checkbox"]');if(!(0,_element.hasClass)(checkbox,'htBadValue')){checkbox.click();}}}},{key:'finishEditing',value:function finishEditing(){}},{key:'init',value:function init(){}},{key:'open',value:function open(){}},{key:'close',value:function close(){}},{key:'getValue',value:function getValue(){}},{key:'setValue',value:function setValue(){}},{key:'focus',value:function focus(){}}]);return CheckboxEditor;}(_baseEditor2.default);exports.default=CheckboxEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _moment=__webpack_require__(61);var _moment2=_interopRequireDefault(_moment);var _pikaday=__webpack_require__(302);var _pikaday2=_interopRequireDefault(_pikaday);__webpack_require__(182);var _element=__webpack_require__(0);var _object=__webpack_require__(1);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _unicode=__webpack_require__(16);var _event=__webpack_require__(7);var _textEditor=__webpack_require__(43);var _textEditor2=_interopRequireDefault(_textEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var DateEditor=function(_TextEditor){_inherits(DateEditor,_TextEditor);function DateEditor(hotInstance){_classCallCheck(this,DateEditor);var _this=_possibleConstructorReturn(this,(DateEditor.__proto__||Object.getPrototypeOf(DateEditor)).call(this,hotInstance));_this.defaultDateFormat='DD/MM/YYYY';_this.isCellEdited=false;_this.parentDestroyed=false;return _this;}
_createClass(DateEditor,[{key:'init',value:function init(){var _this2=this;if(typeof _moment2.default!=='function'){throw new Error('You need to include moment.js to your project.');}
if(typeof _pikaday2.default!=='function'){throw new Error('You need to include Pikaday to your project.');}
_get(DateEditor.prototype.__proto__||Object.getPrototypeOf(DateEditor.prototype),'init',this).call(this);this.instance.addHook('afterDestroy',function(){_this2.parentDestroyed=true;_this2.destroyElements();});}},{key:'createElements',value:function createElements(){_get(DateEditor.prototype.__proto__||Object.getPrototypeOf(DateEditor.prototype),'createElements',this).call(this);this.datePicker=document.createElement('DIV');this.datePickerStyle=this.datePicker.style;this.datePickerStyle.position='absolute';this.datePickerStyle.top=0;this.datePickerStyle.left=0;this.datePickerStyle.zIndex=9999;(0,_element.addClass)(this.datePicker,'htDatepickerHolder');document.body.appendChild(this.datePicker);this.$datePicker=new _pikaday2.default(this.getDatePickerConfig());var eventManager=new _eventManager2.default(this);eventManager.addEventListener(this.datePicker,'mousedown',function(event){return(0,_event.stopPropagation)(event);});this.hideDatepicker();}},{key:'destroyElements',value:function destroyElements(){this.$datePicker.destroy();}},{key:'prepare',value:function prepare(row,col,prop,td,originalValue,cellProperties){this._opened=false;_get(DateEditor.prototype.__proto__||Object.getPrototypeOf(DateEditor.prototype),'prepare',this).call(this,row,col,prop,td,originalValue,cellProperties);}},{key:'open',value:function open(){var event=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_get(DateEditor.prototype.__proto__||Object.getPrototypeOf(DateEditor.prototype),'open',this).call(this);this.showDatepicker(event);}},{key:'close',value:function close(){var _this3=this;this._opened=false;this.instance._registerTimeout(setTimeout(function(){_this3.instance.selection.refreshBorders();},0));_get(DateEditor.prototype.__proto__||Object.getPrototypeOf(DateEditor.prototype),'close',this).call(this);}},{key:'finishEditing',value:function finishEditing(){var isCancelled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var ctrlDown=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(isCancelled){var value=this.originalValue;if(value!==void 0){this.setValue(value);}}
this.hideDatepicker();_get(DateEditor.prototype.__proto__||Object.getPrototypeOf(DateEditor.prototype),'finishEditing',this).call(this,isCancelled,ctrlDown);}},{key:'showDatepicker',value:function showDatepicker(event){this.$datePicker.config(this.getDatePickerConfig());var offset=this.TD.getBoundingClientRect();var dateFormat=this.cellProperties.dateFormat||this.defaultDateFormat;var datePickerConfig=this.$datePicker.config();var dateStr=void 0;var isMouseDown=this.instance.view.isMouseDown();var isMeta=event?(0,_unicode.isMetaKey)(event.keyCode):false;this.datePickerStyle.top=window.pageYOffset+offset.top+(0,_element.outerHeight)(this.TD)+'px';this.datePickerStyle.left=window.pageXOffset+offset.left+'px';this.$datePicker._onInputFocus=function(){};datePickerConfig.format=dateFormat;if(this.originalValue){dateStr=this.originalValue;if((0,_moment2.default)(dateStr,dateFormat,true).isValid()){this.$datePicker.setMoment((0,_moment2.default)(dateStr,dateFormat),true);}
if(this.getValue()!==this.originalValue){this.setValue(this.originalValue);}
if(!isMeta&&!isMouseDown){this.setValue('');}}else if(this.cellProperties.defaultDate){dateStr=this.cellProperties.defaultDate;datePickerConfig.defaultDate=dateStr;if((0,_moment2.default)(dateStr,dateFormat,true).isValid()){this.$datePicker.setMoment((0,_moment2.default)(dateStr,dateFormat),true);}
if(!isMeta&&!isMouseDown){this.setValue('');}}else{this.$datePicker.gotoToday();}
this.datePickerStyle.display='block';this.$datePicker.show();}},{key:'hideDatepicker',value:function hideDatepicker(){this.datePickerStyle.display='none';this.$datePicker.hide();}},{key:'getDatePickerConfig',value:function getDatePickerConfig(){var _this4=this;var htInput=this.TEXTAREA;var options={};if(this.cellProperties&&this.cellProperties.datePickerConfig){(0,_object.deepExtend)(options,this.cellProperties.datePickerConfig);}
var origOnSelect=options.onSelect;var origOnClose=options.onClose;options.field=htInput;options.trigger=htInput;options.container=this.datePicker;options.bound=false;options.format=options.format||this.defaultDateFormat;options.reposition=options.reposition||false;options.onSelect=function(dateStr){if(!isNaN(dateStr.getTime())){dateStr=(0,_moment2.default)(dateStr).format(_this4.cellProperties.dateFormat||_this4.defaultDateFormat);}
_this4.setValue(dateStr);_this4.hideDatepicker();if(origOnSelect){origOnSelect();}};options.onClose=function(){if(!_this4.parentDestroyed){_this4.finishEditing(false);}
if(origOnClose){origOnClose();}};return options;}}]);return DateEditor;}(_textEditor2.default);exports.default=DateEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _autocompleteEditor=__webpack_require__(148);var _autocompleteEditor2=_interopRequireDefault(_autocompleteEditor);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var DropdownEditor=function(_AutocompleteEditor){_inherits(DropdownEditor,_AutocompleteEditor);function DropdownEditor(){_classCallCheck(this,DropdownEditor);return _possibleConstructorReturn(this,(DropdownEditor.__proto__||Object.getPrototypeOf(DropdownEditor)).apply(this,arguments));}
_createClass(DropdownEditor,[{key:'prepare',value:function prepare(row,col,prop,td,originalValue,cellProperties){_get(DropdownEditor.prototype.__proto__||Object.getPrototypeOf(DropdownEditor.prototype),'prepare',this).call(this,row,col,prop,td,originalValue,cellProperties);this.cellProperties.filter=false;this.cellProperties.strict=true;}}]);return DropdownEditor;}(_autocompleteEditor2.default);_pluginHooks2.default.getSingleton().add('beforeValidate',function(value,row,col,source){var cellMeta=this.getCellMeta(row,this.propToCol(col));if(cellMeta.editor===DropdownEditor){if(cellMeta.strict===void 0){cellMeta.filter=false;cellMeta.strict=true;}}});exports.default=DropdownEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _unicode=__webpack_require__(16);var _event=__webpack_require__(7);var _element=__webpack_require__(0);var _baseEditor=__webpack_require__(36);var _baseEditor2=_interopRequireDefault(_baseEditor);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var MobileTextEditor=_baseEditor2.default.prototype.extend();var domDimensionsCache={};var createControls=function createControls(){this.controls={};this.controls.leftButton=document.createElement('DIV');this.controls.leftButton.className='leftButton';this.controls.rightButton=document.createElement('DIV');this.controls.rightButton.className='rightButton';this.controls.upButton=document.createElement('DIV');this.controls.upButton.className='upButton';this.controls.downButton=document.createElement('DIV');this.controls.downButton.className='downButton';for(var button in this.controls){if(Object.prototype.hasOwnProperty.call(this.controls,button)){this.positionControls.appendChild(this.controls[button]);}}};MobileTextEditor.prototype.valueChanged=function(){return this.initValue!=this.getValue();};MobileTextEditor.prototype.init=function(){var that=this;this.eventManager=new _eventManager2.default(this.instance);this.createElements();this.bindEvents();this.instance.addHook('afterDestroy',function(){that.destroy();});};MobileTextEditor.prototype.getValue=function(){return this.TEXTAREA.value;};MobileTextEditor.prototype.setValue=function(newValue){this.initValue=newValue;this.TEXTAREA.value=newValue;};MobileTextEditor.prototype.createElements=function(){this.editorContainer=document.createElement('DIV');this.editorContainer.className='htMobileEditorContainer';this.cellPointer=document.createElement('DIV');this.cellPointer.className='cellPointer';this.moveHandle=document.createElement('DIV');this.moveHandle.className='moveHandle';this.inputPane=document.createElement('DIV');this.inputPane.className='inputs';this.positionControls=document.createElement('DIV');this.positionControls.className='positionControls';this.TEXTAREA=document.createElement('TEXTAREA');(0,_element.addClass)(this.TEXTAREA,'handsontableInput');this.inputPane.appendChild(this.TEXTAREA);this.editorContainer.appendChild(this.cellPointer);this.editorContainer.appendChild(this.moveHandle);this.editorContainer.appendChild(this.inputPane);this.editorContainer.appendChild(this.positionControls);createControls.call(this);document.body.appendChild(this.editorContainer);};MobileTextEditor.prototype.onBeforeKeyDown=function(event){var instance=this;var that=instance.getActiveEditor();if(event.target!==that.TEXTAREA||(0,_event.isImmediatePropagationStopped)(event)){return;}
switch(event.keyCode){case _unicode.KEY_CODES.ENTER:that.close();event.preventDefault();break;case _unicode.KEY_CODES.BACKSPACE:(0,_event.stopImmediatePropagation)(event);break;default:break;}};MobileTextEditor.prototype.open=function(){this.instance.addHook('beforeKeyDown',this.onBeforeKeyDown);(0,_element.addClass)(this.editorContainer,'active');(0,_element.removeClass)(this.cellPointer,'hidden');this.updateEditorPosition();};MobileTextEditor.prototype.focus=function(){this.TEXTAREA.focus();(0,_element.setCaretPosition)(this.TEXTAREA,this.TEXTAREA.value.length);};MobileTextEditor.prototype.close=function(){this.TEXTAREA.blur();this.instance.removeHook('beforeKeyDown',this.onBeforeKeyDown);(0,_element.removeClass)(this.editorContainer,'active');};MobileTextEditor.prototype.scrollToView=function(){var coords=this.instance.getSelectedRange().highlight;this.instance.view.scrollViewport(coords);};MobileTextEditor.prototype.hideCellPointer=function(){if(!(0,_element.hasClass)(this.cellPointer,'hidden')){(0,_element.addClass)(this.cellPointer,'hidden');}};MobileTextEditor.prototype.updateEditorPosition=function(x,y){if(x&&y){x=parseInt(x,10);y=parseInt(y,10);this.editorContainer.style.top=y+'px';this.editorContainer.style.left=x+'px';}else{var selection=this.instance.getSelected(),selectedCell=this.instance.getCell(selection[0],selection[1]);if(!domDimensionsCache.cellPointer){domDimensionsCache.cellPointer={height:(0,_element.outerHeight)(this.cellPointer),width:(0,_element.outerWidth)(this.cellPointer)};}
if(!domDimensionsCache.editorContainer){domDimensionsCache.editorContainer={width:(0,_element.outerWidth)(this.editorContainer)};}
if(selectedCell!==undefined){var scrollLeft=this.instance.view.wt.wtOverlays.leftOverlay.trimmingContainer==window?0:(0,_element.getScrollLeft)(this.instance.view.wt.wtOverlays.leftOverlay.holder);var scrollTop=this.instance.view.wt.wtOverlays.topOverlay.trimmingContainer==window?0:(0,_element.getScrollTop)(this.instance.view.wt.wtOverlays.topOverlay.holder);var selectedCellOffset=(0,_element.offset)(selectedCell),selectedCellWidth=(0,_element.outerWidth)(selectedCell),currentScrollPosition={x:scrollLeft,y:scrollTop};this.editorContainer.style.top=parseInt(selectedCellOffset.top+(0,_element.outerHeight)(selectedCell)-currentScrollPosition.y+domDimensionsCache.cellPointer.height,10)+'px';this.editorContainer.style.left=parseInt(window.innerWidth/2-domDimensionsCache.editorContainer.width/2,10)+'px';if(selectedCellOffset.left+selectedCellWidth/2>parseInt(this.editorContainer.style.left,10)+domDimensionsCache.editorContainer.width){this.editorContainer.style.left=window.innerWidth-domDimensionsCache.editorContainer.width+'px';}else if(selectedCellOffset.left+selectedCellWidth/2<parseInt(this.editorContainer.style.left,10)+20){this.editorContainer.style.left=0+'px';}
this.cellPointer.style.left=parseInt(selectedCellOffset.left-domDimensionsCache.cellPointer.width/2-(0,_element.offset)(this.editorContainer).left+selectedCellWidth/2-currentScrollPosition.x,10)+'px';}}};MobileTextEditor.prototype.updateEditorData=function(){var selected=this.instance.getSelected(),selectedValue=this.instance.getDataAtCell(selected[0],selected[1]);this.row=selected[0];this.col=selected[1];this.setValue(selectedValue);this.updateEditorPosition();};MobileTextEditor.prototype.prepareAndSave=function(){var val;if(!this.valueChanged()){return;}
if(this.instance.getSettings().trimWhitespace){val=[[String.prototype.trim.call(this.getValue())]];}else{val=[[this.getValue()]];}
this.saveValue(val);};MobileTextEditor.prototype.bindEvents=function(){var that=this;this.eventManager.addEventListener(this.controls.leftButton,'touchend',function(event){that.prepareAndSave();that.instance.selection.transformStart(0,-1,null,true);that.updateEditorData();event.preventDefault();});this.eventManager.addEventListener(this.controls.rightButton,'touchend',function(event){that.prepareAndSave();that.instance.selection.transformStart(0,1,null,true);that.updateEditorData();event.preventDefault();});this.eventManager.addEventListener(this.controls.upButton,'touchend',function(event){that.prepareAndSave();that.instance.selection.transformStart(-1,0,null,true);that.updateEditorData();event.preventDefault();});this.eventManager.addEventListener(this.controls.downButton,'touchend',function(event){that.prepareAndSave();that.instance.selection.transformStart(1,0,null,true);that.updateEditorData();event.preventDefault();});this.eventManager.addEventListener(this.moveHandle,'touchstart',function(event){if(event.touches.length==1){var touch=event.touches[0];var onTouchPosition={x:that.editorContainer.offsetLeft,y:that.editorContainer.offsetTop};var onTouchOffset={x:touch.pageX-onTouchPosition.x,y:touch.pageY-onTouchPosition.y};that.eventManager.addEventListener(this,'touchmove',function(event){var touch=event.touches[0];that.updateEditorPosition(touch.pageX-onTouchOffset.x,touch.pageY-onTouchOffset.y);that.hideCellPointer();event.preventDefault();});}});this.eventManager.addEventListener(document.body,'touchend',function(event){if(!(0,_element.isChildOf)(event.target,that.editorContainer)&&!(0,_element.isChildOf)(event.target,that.instance.rootElement)){that.close();}});this.eventManager.addEventListener(this.instance.view.wt.wtOverlays.leftOverlay.holder,'scroll',function(event){if(that.instance.view.wt.wtOverlays.leftOverlay.trimmingContainer!=window){that.hideCellPointer();}});this.eventManager.addEventListener(this.instance.view.wt.wtOverlays.topOverlay.holder,'scroll',function(event){if(that.instance.view.wt.wtOverlays.topOverlay.trimmingContainer!=window){that.hideCellPointer();}});};MobileTextEditor.prototype.destroy=function(){this.eventManager.clear();this.editorContainer.parentNode.removeChild(this.editorContainer);};exports.default=MobileTextEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _numbro=__webpack_require__(87);var _numbro2=_interopRequireDefault(_numbro);var _textEditor=__webpack_require__(43);var _textEditor2=_interopRequireDefault(_textEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var NumericEditor=function(_TextEditor){_inherits(NumericEditor,_TextEditor);function NumericEditor(){_classCallCheck(this,NumericEditor);return _possibleConstructorReturn(this,(NumericEditor.__proto__||Object.getPrototypeOf(NumericEditor)).apply(this,arguments));}
_createClass(NumericEditor,[{key:'beginEditing',value:function beginEditing(initialValue){if(typeof initialValue==='undefined'&&this.originalValue){if(typeof this.cellProperties.language!=='undefined'){_numbro2.default.culture(this.cellProperties.language);}
var decimalDelimiter=_numbro2.default.cultureData().delimiters.decimal;initialValue=(''+this.originalValue).replace('.',decimalDelimiter);}
_get(NumericEditor.prototype.__proto__||Object.getPrototypeOf(NumericEditor.prototype),'beginEditing',this).call(this,initialValue);}}]);return NumericEditor;}(_textEditor2.default);exports.default=NumericEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _element=__webpack_require__(0);var _textEditor=__webpack_require__(43);var _textEditor2=_interopRequireDefault(_textEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var PasswordEditor=function(_TextEditor){_inherits(PasswordEditor,_TextEditor);function PasswordEditor(){_classCallCheck(this,PasswordEditor);return _possibleConstructorReturn(this,(PasswordEditor.__proto__||Object.getPrototypeOf(PasswordEditor)).apply(this,arguments));}
_createClass(PasswordEditor,[{key:'createElements',value:function createElements(){_get(PasswordEditor.prototype.__proto__||Object.getPrototypeOf(PasswordEditor.prototype),'createElements',this).call(this);this.TEXTAREA=document.createElement('input');this.TEXTAREA.setAttribute('type','password');this.TEXTAREA.className='handsontableInput';this.textareaStyle=this.TEXTAREA.style;this.textareaStyle.width=0;this.textareaStyle.height=0;(0,_element.empty)(this.TEXTAREA_PARENT);this.TEXTAREA_PARENT.appendChild(this.TEXTAREA);}}]);return PasswordEditor;}(_textEditor2.default);exports.default=PasswordEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _element=__webpack_require__(0);var _event=__webpack_require__(7);var _unicode=__webpack_require__(16);var _baseEditor=__webpack_require__(36);var _baseEditor2=_interopRequireDefault(_baseEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var SelectEditor=_baseEditor2.default.prototype.extend();SelectEditor.prototype.init=function(){this.select=document.createElement('SELECT');(0,_element.addClass)(this.select,'htSelectEditor');this.select.style.display='none';this.instance.rootElement.appendChild(this.select);this.registerHooks();};SelectEditor.prototype.registerHooks=function(){var _this=this;this.instance.addHook('afterScrollHorizontally',function(){return _this.refreshDimensions();});this.instance.addHook('afterScrollVertically',function(){return _this.refreshDimensions();});this.instance.addHook('afterColumnResize',function(){return _this.refreshDimensions();});this.instance.addHook('afterRowResize',function(){return _this.refreshDimensions();});};SelectEditor.prototype.prepare=function(){_baseEditor2.default.prototype.prepare.apply(this,arguments);var selectOptions=this.cellProperties.selectOptions;var options;if(typeof selectOptions=='function'){options=this.prepareOptions(selectOptions(this.row,this.col,this.prop));}else{options=this.prepareOptions(selectOptions);}
(0,_element.empty)(this.select);for(var option in options){if(Object.prototype.hasOwnProperty.call(options,option)){var optionElement=document.createElement('OPTION');optionElement.value=option;(0,_element.fastInnerHTML)(optionElement,options[option]);this.select.appendChild(optionElement);}}};SelectEditor.prototype.prepareOptions=function(optionsToPrepare){var preparedOptions={};if(Array.isArray(optionsToPrepare)){for(var i=0,len=optionsToPrepare.length;i<len;i++){preparedOptions[optionsToPrepare[i]]=optionsToPrepare[i];}}else if((typeof optionsToPrepare==='undefined'?'undefined':_typeof(optionsToPrepare))=='object'){preparedOptions=optionsToPrepare;}
return preparedOptions;};SelectEditor.prototype.getValue=function(){return this.select.value;};SelectEditor.prototype.setValue=function(value){this.select.value=value;};var onBeforeKeyDown=function onBeforeKeyDown(event){var instance=this;var editor=instance.getActiveEditor();switch(event.keyCode){case _unicode.KEY_CODES.ARROW_UP:var previousOptionIndex=editor.select.selectedIndex-1;if(previousOptionIndex>=0){editor.select[previousOptionIndex].selected=true;}
(0,_event.stopImmediatePropagation)(event);event.preventDefault();break;case _unicode.KEY_CODES.ARROW_DOWN:var nextOptionIndex=editor.select.selectedIndex+1;if(nextOptionIndex<=editor.select.length-1){editor.select[nextOptionIndex].selected=true;}
(0,_event.stopImmediatePropagation)(event);event.preventDefault();break;default:break;}};SelectEditor.prototype.open=function(){this._opened=true;this.refreshDimensions();this.select.style.display='';this.instance.addHook('beforeKeyDown',onBeforeKeyDown);};SelectEditor.prototype.close=function(){this._opened=false;this.select.style.display='none';this.instance.removeHook('beforeKeyDown',onBeforeKeyDown);};SelectEditor.prototype.focus=function(){this.select.focus();};SelectEditor.prototype.refreshValue=function(){var sourceData=this.instance.getSourceDataAtCell(this.row,this.prop);this.originalValue=sourceData;this.setValue(sourceData);this.refreshDimensions();};SelectEditor.prototype.refreshDimensions=function(){if(this.state!==_baseEditor.EditorState.EDITING){return;}
this.TD=this.getEditedCell();if(!this.TD){this.close();return;}
var width=(0,_element.outerWidth)(this.TD)+1,height=(0,_element.outerHeight)(this.TD)+1,currentOffset=(0,_element.offset)(this.TD),containerOffset=(0,_element.offset)(this.instance.rootElement),scrollableContainer=(0,_element.getScrollableElement)(this.TD),editTop=currentOffset.top-containerOffset.top-1-(scrollableContainer.scrollTop||0),editLeft=currentOffset.left-containerOffset.left-1-(scrollableContainer.scrollLeft||0),editorSection=this.checkEditorSection(),cssTransformOffset;var settings=this.instance.getSettings();var rowHeadersCount=settings.rowHeaders?1:0;var colHeadersCount=settings.colHeaders?1:0;switch(editorSection){case'top':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.holder.parentNode);break;case'left':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.holder.parentNode);break;case'top-left-corner':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case'bottom-left-corner':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case'bottom':cssTransformOffset=(0,_element.getCssTransform)(this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.holder.parentNode);break;default:break;}
if(this.instance.getSelected()[0]===0){editTop+=1;}
if(this.instance.getSelected()[1]===0){editLeft+=1;}
var selectStyle=this.select.style;if(cssTransformOffset&&cssTransformOffset!=-1){selectStyle[cssTransformOffset[0]]=cssTransformOffset[1];}else{(0,_element.resetCssTransform)(this.select);}
var cellComputedStyle=(0,_element.getComputedStyle)(this.TD);if(parseInt(cellComputedStyle.borderTopWidth,10)>0){height-=1;}
if(parseInt(cellComputedStyle.borderLeftWidth,10)>0){width-=1;}
selectStyle.height=height+'px';selectStyle.minWidth=width+'px';selectStyle.top=editTop+'px';selectStyle.left=editLeft+'px';selectStyle.margin='0px';};SelectEditor.prototype.getEditedCell=function(){var editorSection=this.checkEditorSection(),editedCell;switch(editorSection){case'top':editedCell=this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.select.style.zIndex=101;break;case'corner':editedCell=this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.select.style.zIndex=103;break;case'left':editedCell=this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.getCell({row:this.row,col:this.col});this.select.style.zIndex=102;break;default:editedCell=this.instance.getCell(this.row,this.col);this.select.style.zIndex='';break;}
return editedCell!=-1&&editedCell!=-2?editedCell:void 0;};exports.default=SelectEditor;}),(function(module,exports,__webpack_require__){"use strict";__webpack_require__(97);__webpack_require__(114);__webpack_require__(123);__webpack_require__(124);__webpack_require__(108);__webpack_require__(122);__webpack_require__(105);__webpack_require__(106);__webpack_require__(107);__webpack_require__(96);__webpack_require__(119);__webpack_require__(117);__webpack_require__(115);__webpack_require__(120);__webpack_require__(121);__webpack_require__(116);__webpack_require__(118);__webpack_require__(109);__webpack_require__(110);__webpack_require__(111);__webpack_require__(113);__webpack_require__(112);__webpack_require__(94);__webpack_require__(95);__webpack_require__(90);__webpack_require__(93);__webpack_require__(92);__webpack_require__(91);__webpack_require__(67);__webpack_require__(99);__webpack_require__(100);__webpack_require__(102);__webpack_require__(101);__webpack_require__(98);__webpack_require__(104);__webpack_require__(103);__webpack_require__(125);__webpack_require__(128);__webpack_require__(126);__webpack_require__(127);__webpack_require__(130);__webpack_require__(129);__webpack_require__(132);__webpack_require__(131);__webpack_require__(179);__webpack_require__(180);__webpack_require__(181);var _editors=__webpack_require__(14);var _renderers=__webpack_require__(9);var _validators=__webpack_require__(26);var _cellTypes=__webpack_require__(62);var _core=__webpack_require__(63);var _core2=_interopRequireDefault(_core);var _jquery=__webpack_require__(177);var _jquery2=_interopRequireDefault(_jquery);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _ghostTable=__webpack_require__(66);var _ghostTable2=_interopRequireDefault(_ghostTable);var _array=__webpack_require__(2);var arrayHelpers=_interopRequireWildcard(_array);var _browser=__webpack_require__(25);var browserHelpers=_interopRequireWildcard(_browser);var _data=__webpack_require__(64);var dataHelpers=_interopRequireWildcard(_data);var _date=__webpack_require__(89);var dateHelpers=_interopRequireWildcard(_date);var _feature=__webpack_require__(34);var featureHelpers=_interopRequireWildcard(_feature);var _function=__webpack_require__(35);var functionHelpers=_interopRequireWildcard(_function);var _mixed=__webpack_require__(20);var mixedHelpers=_interopRequireWildcard(_mixed);var _number=__webpack_require__(6);var numberHelpers=_interopRequireWildcard(_number);var _object=__webpack_require__(1);var objectHelpers=_interopRequireWildcard(_object);var _setting=__webpack_require__(65);var settingHelpers=_interopRequireWildcard(_setting);var _string=__webpack_require__(27);var stringHelpers=_interopRequireWildcard(_string);var _unicode=__webpack_require__(16);var unicodeHelpers=_interopRequireWildcard(_unicode);var _element=__webpack_require__(0);var domHelpers=_interopRequireWildcard(_element);var _event=__webpack_require__(7);var domEventHelpers=_interopRequireWildcard(_event);var _index=__webpack_require__(178);var plugins=_interopRequireWildcard(_index);var _plugins=__webpack_require__(5);var _defaultSettings=__webpack_require__(88);var _defaultSettings2=_interopRequireDefault(_defaultSettings);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}
function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function Handsontable(rootElement,userSettings){var instance=new _core2.default(rootElement,userSettings||{});instance.init();return instance;}
(0,_jquery2.default)(Handsontable);Handsontable.Core=_core2.default;Handsontable.DefaultSettings=_defaultSettings2.default;Handsontable.EventManager=_eventManager2.default;Handsontable._getListenersCounter=_eventManager.getListenersCounter;Handsontable.buildDate="2017-07-27T11:34:25.509Z";Handsontable.packageName="handsontable";Handsontable.version="0.34.0";var baseVersion=undefined;if(baseVersion){Handsontable.baseVersion=baseVersion;}
Handsontable.hooks=_pluginHooks2.default.getSingleton();Handsontable.__GhostTable=_ghostTable2.default;var HELPERS=[arrayHelpers,browserHelpers,dataHelpers,dateHelpers,featureHelpers,functionHelpers,mixedHelpers,numberHelpers,objectHelpers,settingHelpers,stringHelpers,unicodeHelpers];var DOM=[domHelpers,domEventHelpers];Handsontable.helper={};Handsontable.dom={};arrayHelpers.arrayEach(HELPERS,function(helper){arrayHelpers.arrayEach(Object.getOwnPropertyNames(helper),function(key){if(key.charAt(0)!=='_'){Handsontable.helper[key]=helper[key];}});});arrayHelpers.arrayEach(DOM,function(helper){arrayHelpers.arrayEach(Object.getOwnPropertyNames(helper),function(key){if(key.charAt(0)!=='_'){Handsontable.dom[key]=helper[key];}});});Handsontable.cellTypes={};arrayHelpers.arrayEach((0,_cellTypes.getRegisteredCellTypeNames)(),function(cellTypeName){Handsontable.cellTypes[cellTypeName]=(0,_cellTypes.getCellType)(cellTypeName);});Handsontable.cellTypes.registerCellType=_cellTypes.registerCellType;Handsontable.cellTypes.getCellType=_cellTypes.getCellType;Handsontable.editors={};arrayHelpers.arrayEach((0,_editors.getRegisteredEditorNames)(),function(editorName){Handsontable.editors[stringHelpers.toUpperCaseFirst(editorName)+'Editor']=(0,_editors.getEditor)(editorName);});Handsontable.editors.registerEditor=_editors.registerEditor;Handsontable.editors.getEditor=_editors.getEditor;Handsontable.renderers={};arrayHelpers.arrayEach((0,_renderers.getRegisteredRendererNames)(),function(rendererName){var renderer=(0,_renderers.getRenderer)(rendererName);if(rendererName==='base'){Handsontable.renderers.cellDecorator=renderer;}
Handsontable.renderers[stringHelpers.toUpperCaseFirst(rendererName)+'Renderer']=renderer;});Handsontable.renderers.registerRenderer=_renderers.registerRenderer;Handsontable.renderers.getRenderer=_renderers.getRenderer;Handsontable.validators={};arrayHelpers.arrayEach((0,_validators.getRegisteredValidatorNames)(),function(validatorName){Handsontable.validators[stringHelpers.toUpperCaseFirst(validatorName)+'Validator']=(0,_validators.getValidator)(validatorName);});Handsontable.validators.registerValidator=_validators.registerValidator;Handsontable.validators.getValidator=_validators.getValidator;Handsontable.plugins={};arrayHelpers.arrayEach(Object.getOwnPropertyNames(plugins),function(pluginName){var plugin=plugins[pluginName];if(pluginName==='Base'){Handsontable.plugins[pluginName+'Plugin']=plugin;}else{Handsontable.plugins[pluginName]=plugin;}});Handsontable.plugins.registerPlugin=_plugins.registerPlugin;module.exports=Handsontable;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};function MultiMap(){var map={arrayMap:[],weakMap:new WeakMap()};return{get:function get(key){if(canBeAnArrayMapKey(key)){return map.arrayMap[key];}else if(canBeAWeakMapKey(key)){return map.weakMap.get(key);}},set:function set(key,value){if(canBeAnArrayMapKey(key)){map.arrayMap[key]=value;}else if(canBeAWeakMapKey(key)){map.weakMap.set(key,value);}else{throw new Error('Invalid key type');}},delete:function _delete(key){if(canBeAnArrayMapKey(key)){delete map.arrayMap[key];}else if(canBeAWeakMapKey(key)){map.weakMap.delete(key);}}};function canBeAnArrayMapKey(obj){return obj!==null&&!isNaNSymbol(obj)&&(typeof obj=='string'||typeof obj=='number');}
function canBeAWeakMapKey(obj){return obj!==null&&((typeof obj==='undefined'?'undefined':_typeof(obj))=='object'||typeof obj=='function');}
function isNaNSymbol(obj){return obj!==obj;}}
exports.default=MultiMap;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _array=__webpack_require__(2);var _feature=__webpack_require__(34);var _element=__webpack_require__(0);var _ghostTable=__webpack_require__(66);var _ghostTable2=_interopRequireDefault(_ghostTable);var _object=__webpack_require__(1);var _number=__webpack_require__(6);var _plugins=__webpack_require__(5);var _samplesGenerator=__webpack_require__(154);var _samplesGenerator2=_interopRequireDefault(_samplesGenerator);var _string=__webpack_require__(27);var _src=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var privatePool=new WeakMap();var AutoColumnSize=function(_BasePlugin){_inherits(AutoColumnSize,_BasePlugin);_createClass(AutoColumnSize,null,[{key:'CALCULATION_STEP',get:function get(){return 50;}},{key:'SYNC_CALCULATION_LIMIT',get:function get(){return 50;}}]);function AutoColumnSize(hotInstance){_classCallCheck(this,AutoColumnSize);var _this=_possibleConstructorReturn(this,(AutoColumnSize.__proto__||Object.getPrototypeOf(AutoColumnSize)).call(this,hotInstance));privatePool.set(_this,{cachedColumnHeaders:[]});_this.widths=[];_this.ghostTable=new _ghostTable2.default(_this.hot);_this.samplesGenerator=new _samplesGenerator2.default(function(row,col){return _this.hot.getDataAtCell(row,col);});_this.firstCalculation=true;_this.inProgress=false;_this.addHook('beforeColumnResize',function(col,size,isDblClick){return _this.onBeforeColumnResize(col,size,isDblClick);});return _this;}
_createClass(AutoColumnSize,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().autoColumnSize!==false&&!this.hot.getSettings().colWidths;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
var setting=this.hot.getSettings().autoColumnSize;if(setting&&setting.useHeaders!=null){this.ghostTable.setSetting('useHeaders',setting.useHeaders);}
this.addHook('afterLoadData',function(){return _this2.onAfterLoadData();});this.addHook('beforeChange',function(changes){return _this2.onBeforeChange(changes);});this.addHook('beforeRender',function(force){return _this2.onBeforeRender(force);});this.addHook('modifyColWidth',function(width,col){return _this2.getColumnWidth(col,width);});this.addHook('afterInit',function(){return _this2.onAfterInit();});_get(AutoColumnSize.prototype.__proto__||Object.getPrototypeOf(AutoColumnSize.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){var changedColumns=this.findColumnsWhereHeaderWasChanged();if(changedColumns.length){this.clearCache(changedColumns);}
_get(AutoColumnSize.prototype.__proto__||Object.getPrototypeOf(AutoColumnSize.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){_get(AutoColumnSize.prototype.__proto__||Object.getPrototypeOf(AutoColumnSize.prototype),'disablePlugin',this).call(this);}},{key:'calculateColumnsWidth',value:function calculateColumnsWidth(){var colRange=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{from:0,to:this.hot.countCols()-1};var _this3=this;var rowRange=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{from:0,to:this.hot.countRows()-1};var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(typeof colRange==='number'){colRange={from:colRange,to:colRange};}
if(typeof rowRange==='number'){rowRange={from:rowRange,to:rowRange};}
(0,_number.rangeEach)(colRange.from,colRange.to,function(col){if(force||_this3.widths[col]===void 0&&!_this3.hot._getColWidthFromSettings(col)){var samples=_this3.samplesGenerator.generateColumnSamples(col,rowRange);samples.forEach(function(sample,col){return _this3.ghostTable.addColumn(col,sample);});}});if(this.ghostTable.columns.length){this.ghostTable.getWidths(function(col,width){_this3.widths[col]=width;});this.ghostTable.clean();}}},{key:'calculateAllColumnsWidth',value:function calculateAllColumnsWidth(){var _this4=this;var rowRange=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{from:0,to:this.hot.countRows()-1};var current=0;var length=this.hot.countCols()-1;var timer=null;this.inProgress=true;var loop=function loop(){if(!_this4.hot){(0,_feature.cancelAnimationFrame)(timer);_this4.inProgress=false;return;}
_this4.calculateColumnsWidth({from:current,to:Math.min(current+AutoColumnSize.CALCULATION_STEP,length)},rowRange);current=current+AutoColumnSize.CALCULATION_STEP+1;if(current<length){timer=(0,_feature.requestAnimationFrame)(loop);}else{(0,_feature.cancelAnimationFrame)(timer);_this4.inProgress=false;_this4.hot.view.wt.wtOverlays.adjustElementsSize(true);if(_this4.hot.view.wt.wtOverlays.leftOverlay.needFullRender){_this4.hot.view.wt.wtOverlays.leftOverlay.clone.draw();}}};if(this.firstCalculation&&this.getSyncCalculationLimit()){this.calculateColumnsWidth({from:0,to:this.getSyncCalculationLimit()},rowRange);this.firstCalculation=false;current=this.getSyncCalculationLimit()+1;}
if(current<length){loop();}else{this.inProgress=false;}}},{key:'setSamplingOptions',value:function setSamplingOptions(){var setting=this.hot.getSettings().autoColumnSize;var samplingRatio=setting&&(0,_object.hasOwnProperty)(setting,'samplingRatio')?this.hot.getSettings().autoColumnSize.samplingRatio:void 0;var allowSampleDuplicates=setting&&(0,_object.hasOwnProperty)(setting,'allowSampleDuplicates')?this.hot.getSettings().autoColumnSize.allowSampleDuplicates:void 0;if(samplingRatio&&!isNaN(samplingRatio)){this.samplesGenerator.setSampleCount(parseInt(samplingRatio,10));}
if(allowSampleDuplicates){this.samplesGenerator.setAllowDuplicates(allowSampleDuplicates);}}},{key:'recalculateAllColumnsWidth',value:function recalculateAllColumnsWidth(){if(this.hot.view&&(0,_element.isVisible)(this.hot.view.wt.wtTable.TABLE)){this.clearCache();this.calculateAllColumnsWidth();}}},{key:'getSyncCalculationLimit',value:function getSyncCalculationLimit(){var limit=AutoColumnSize.SYNC_CALCULATION_LIMIT;var colsLimit=this.hot.countCols()-1;if((0,_object.isObject)(this.hot.getSettings().autoColumnSize)){limit=this.hot.getSettings().autoColumnSize.syncLimit;if((0,_string.isPercentValue)(limit)){limit=(0,_number.valueAccordingPercent)(colsLimit,limit);}else{limit>>=0;}}
return Math.min(limit,colsLimit);}},{key:'getColumnWidth',value:function getColumnWidth(col){var defaultWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:void 0;var keepMinimum=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var width=defaultWidth;if(width===void 0){width=this.widths[col];if(keepMinimum&&typeof width==='number'){width=Math.max(width,_src.ViewportColumnsCalculator.DEFAULT_WIDTH);}}
return width;}},{key:'getFirstVisibleColumn',value:function getFirstVisibleColumn(){var wot=this.hot.view.wt;if(wot.wtViewport.columnsVisibleCalculator){return wot.wtTable.getFirstVisibleColumn();}
if(wot.wtViewport.columnsRenderCalculator){return wot.wtTable.getFirstRenderedColumn();}
return-1;}},{key:'getLastVisibleColumn',value:function getLastVisibleColumn(){var wot=this.hot.view.wt;if(wot.wtViewport.columnsVisibleCalculator){return wot.wtTable.getLastVisibleColumn();}
if(wot.wtViewport.columnsRenderCalculator){return wot.wtTable.getLastRenderedColumn();}
return-1;}},{key:'findColumnsWhereHeaderWasChanged',value:function findColumnsWhereHeaderWasChanged(){var columnHeaders=this.hot.getColHeader();var _privatePool$get=privatePool.get(this),cachedColumnHeaders=_privatePool$get.cachedColumnHeaders;var changedColumns=(0,_array.arrayReduce)(columnHeaders,function(acc,columnTitle,physicalColumn){var cachedColumnsLength=cachedColumnHeaders.length;if(cachedColumnsLength-1<physicalColumn||cachedColumnHeaders[physicalColumn]!==columnTitle){acc.push(physicalColumn);}
if(cachedColumnsLength-1<physicalColumn){cachedColumnHeaders.push(columnTitle);}else{cachedColumnHeaders[physicalColumn]=columnTitle;}
return acc;},[]);return changedColumns;}},{key:'clearCache',value:function clearCache(){var _this5=this;var columns=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(columns.length){(0,_array.arrayEach)(columns,function(physicalIndex){_this5.widths[physicalIndex]=void 0;});}else{this.widths.length=0;}}},{key:'isNeedRecalculate',value:function isNeedRecalculate(){return!!(0,_array.arrayFilter)(this.widths,function(item){return item===void 0;}).length;}},{key:'onBeforeRender',value:function onBeforeRender(){var force=this.hot.renderCall;var rowsCount=this.hot.countRows();if(!rowsCount){return;}
this.calculateColumnsWidth({from:this.getFirstVisibleColumn(),to:this.getLastVisibleColumn()},void 0,force);if(this.isNeedRecalculate()&&!this.inProgress){this.calculateAllColumnsWidth();}}},{key:'onAfterLoadData',value:function onAfterLoadData(){var _this6=this;if(this.hot.view){this.recalculateAllColumnsWidth();}else{setTimeout(function(){if(_this6.hot){_this6.recalculateAllColumnsWidth();}},0);}}},{key:'onBeforeChange',value:function onBeforeChange(changes){var _this7=this;var changedColumns=(0,_array.arrayMap)(changes,function(_ref){var _ref2=_slicedToArray(_ref,2),row=_ref2[0],column=_ref2[1];return _this7.hot.propToCol(column);});this.clearCache(changedColumns);}},{key:'onBeforeColumnResize',value:function onBeforeColumnResize(col,size,isDblClick){if(isDblClick){this.calculateColumnsWidth(col,void 0,true);size=this.getColumnWidth(col,void 0,false);}
return size;}},{key:'onAfterInit',value:function onAfterInit(){privatePool.get(this).cachedColumnHeaders=this.hot.getColHeader();}},{key:'destroy',value:function destroy(){this.ghostTable.clean();_get(AutoColumnSize.prototype.__proto__||Object.getPrototypeOf(AutoColumnSize.prototype),'destroy',this).call(this);}}]);return AutoColumnSize;}(_base2.default);(0,_plugins.registerPlugin)('autoColumnSize',AutoColumnSize);exports.default=AutoColumnSize;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _array=__webpack_require__(2);var _feature=__webpack_require__(34);var _element=__webpack_require__(0);var _ghostTable=__webpack_require__(66);var _ghostTable2=_interopRequireDefault(_ghostTable);var _object=__webpack_require__(1);var _number=__webpack_require__(6);var _plugins=__webpack_require__(5);var _samplesGenerator=__webpack_require__(154);var _samplesGenerator2=_interopRequireDefault(_samplesGenerator);var _string=__webpack_require__(27);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var AutoRowSize=function(_BasePlugin){_inherits(AutoRowSize,_BasePlugin);_createClass(AutoRowSize,null,[{key:'CALCULATION_STEP',get:function get(){return 50;}},{key:'SYNC_CALCULATION_LIMIT',get:function get(){return 500;}}]);function AutoRowSize(hotInstance){_classCallCheck(this,AutoRowSize);var _this=_possibleConstructorReturn(this,(AutoRowSize.__proto__||Object.getPrototypeOf(AutoRowSize)).call(this,hotInstance));_this.heights=[];_this.ghostTable=new _ghostTable2.default(_this.hot);_this.samplesGenerator=new _samplesGenerator2.default(function(row,col){if(row>=0){return _this.hot.getDataAtCell(row,col);}else if(row===-1){return _this.hot.getColHeader(col);}
return null;});_this.firstCalculation=true;_this.inProgress=false;_this.addHook('beforeRowResize',function(row,size,isDblClick){return _this.onBeforeRowResize(row,size,isDblClick);});return _this;}
_createClass(AutoRowSize,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().autoRowSize===true||(0,_object.isObject)(this.hot.getSettings().autoRowSize);}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.setSamplingOptions();this.addHook('afterLoadData',function(){return _this2.onAfterLoadData();});this.addHook('beforeChange',function(changes){return _this2.onBeforeChange(changes);});this.addHook('beforeColumnMove',function(){return _this2.recalculateAllRowsHeight();});this.addHook('beforeColumnResize',function(){return _this2.recalculateAllRowsHeight();});this.addHook('beforeColumnSort',function(){return _this2.clearCache();});this.addHook('beforeRender',function(force){return _this2.onBeforeRender(force);});this.addHook('beforeRowMove',function(rowStart,rowEnd){return _this2.onBeforeRowMove(rowStart,rowEnd);});this.addHook('modifyRowHeight',function(height,row){return _this2.getRowHeight(row,height);});this.addHook('modifyColumnHeaderHeight',function(){return _this2.getColumnHeaderHeight();});_get(AutoRowSize.prototype.__proto__||Object.getPrototypeOf(AutoRowSize.prototype),'enablePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){_get(AutoRowSize.prototype.__proto__||Object.getPrototypeOf(AutoRowSize.prototype),'disablePlugin',this).call(this);}},{key:'calculateRowsHeight',value:function calculateRowsHeight(){var rowRange=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{from:0,to:this.hot.countRows()-1};var _this3=this;var colRange=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{from:0,to:this.hot.countCols()-1};var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(typeof rowRange==='number'){rowRange={from:rowRange,to:rowRange};}
if(typeof colRange==='number'){colRange={from:colRange,to:colRange};}
if(this.hot.getColHeader(0)!==null){var samples=this.samplesGenerator.generateRowSamples(-1,colRange);this.ghostTable.addColumnHeadersRow(samples.get(-1));}
(0,_number.rangeEach)(rowRange.from,rowRange.to,function(row){if(force||_this3.heights[row]===void 0){var _samples=_this3.samplesGenerator.generateRowSamples(row,colRange);_samples.forEach(function(sample,row){_this3.ghostTable.addRow(row,sample);});}});if(this.ghostTable.rows.length){this.ghostTable.getHeights(function(row,height){_this3.heights[row]=height;});this.ghostTable.clean();}}},{key:'calculateAllRowsHeight',value:function calculateAllRowsHeight(){var _this4=this;var colRange=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{from:0,to:this.hot.countCols()-1};var current=0;var length=this.hot.countRows()-1;var timer=null;this.inProgress=true;var loop=function loop(){if(!_this4.hot){(0,_feature.cancelAnimationFrame)(timer);_this4.inProgress=false;return;}
_this4.calculateRowsHeight({from:current,to:Math.min(current+AutoRowSize.CALCULATION_STEP,length)},colRange);current=current+AutoRowSize.CALCULATION_STEP+1;if(current<length){timer=(0,_feature.requestAnimationFrame)(loop);}else{(0,_feature.cancelAnimationFrame)(timer);_this4.inProgress=false;_this4.hot.view.wt.wtOverlays.adjustElementsSize(true);if(_this4.hot.view.wt.wtOverlays.leftOverlay.needFullRender){_this4.hot.view.wt.wtOverlays.leftOverlay.clone.draw();}}};if(this.firstCalculation&&this.getSyncCalculationLimit()){this.calculateRowsHeight({from:0,to:this.getSyncCalculationLimit()},colRange);this.firstCalculation=false;current=this.getSyncCalculationLimit()+1;}
if(current<length){loop();}else{this.inProgress=false;this.hot.view.wt.wtOverlays.adjustElementsSize(false);}}},{key:'setSamplingOptions',value:function setSamplingOptions(){var setting=this.hot.getSettings().autoRowSize;var samplingRatio=setting&&(0,_object.hasOwnProperty)(setting,'samplingRatio')?this.hot.getSettings().autoRowSize.samplingRatio:void 0;var allowSampleDuplicates=setting&&(0,_object.hasOwnProperty)(setting,'allowSampleDuplicates')?this.hot.getSettings().autoRowSize.allowSampleDuplicates:void 0;if(samplingRatio&&!isNaN(samplingRatio)){this.samplesGenerator.setSampleCount(parseInt(samplingRatio,10));}
if(allowSampleDuplicates){this.samplesGenerator.setAllowDuplicates(allowSampleDuplicates);}}},{key:'recalculateAllRowsHeight',value:function recalculateAllRowsHeight(){if((0,_element.isVisible)(this.hot.view.wt.wtTable.TABLE)){this.clearCache();this.calculateAllRowsHeight();}}},{key:'getSyncCalculationLimit',value:function getSyncCalculationLimit(){var limit=AutoRowSize.SYNC_CALCULATION_LIMIT;var rowsLimit=this.hot.countRows()-1;if((0,_object.isObject)(this.hot.getSettings().autoRowSize)){limit=this.hot.getSettings().autoRowSize.syncLimit;if((0,_string.isPercentValue)(limit)){limit=(0,_number.valueAccordingPercent)(rowsLimit,limit);}else{limit>>=0;}}
return Math.min(limit,rowsLimit);}},{key:'getRowHeight',value:function getRowHeight(row){var defaultHeight=arguments.length>1&&arguments[1]!==undefined?arguments[1]:void 0;var height=defaultHeight;if(this.heights[row]!==void 0&&this.heights[row]>(defaultHeight||0)){height=this.heights[row];}
return height;}},{key:'getColumnHeaderHeight',value:function getColumnHeaderHeight(){return this.heights[-1];}},{key:'getFirstVisibleRow',value:function getFirstVisibleRow(){var wot=this.hot.view.wt;if(wot.wtViewport.rowsVisibleCalculator){return wot.wtTable.getFirstVisibleRow();}
if(wot.wtViewport.rowsRenderCalculator){return wot.wtTable.getFirstRenderedRow();}
return-1;}},{key:'getLastVisibleRow',value:function getLastVisibleRow(){var wot=this.hot.view.wt;if(wot.wtViewport.rowsVisibleCalculator){return wot.wtTable.getLastVisibleRow();}
if(wot.wtViewport.rowsRenderCalculator){return wot.wtTable.getLastRenderedRow();}
return-1;}},{key:'clearCache',value:function clearCache(){this.heights.length=0;this.heights[-1]=void 0;}},{key:'clearCacheByRange',value:function clearCacheByRange(range){var _this5=this;if(typeof range==='number'){range={from:range,to:range};}
(0,_number.rangeEach)(Math.min(range.from,range.to),Math.max(range.from,range.to),function(row){_this5.heights[row]=void 0;});}},{key:'isNeedRecalculate',value:function isNeedRecalculate(){return!!(0,_array.arrayFilter)(this.heights,function(item){return item===void 0;}).length;}},{key:'onBeforeRender',value:function onBeforeRender(){var force=this.hot.renderCall;this.calculateRowsHeight({from:this.getFirstVisibleRow(),to:this.getLastVisibleRow()},void 0,force);var fixedRowsBottom=this.hot.getSettings().fixedRowsBottom;if(fixedRowsBottom){var totalRows=this.hot.countRows()-1;this.calculateRowsHeight({from:totalRows-fixedRowsBottom,to:totalRows});}
if(this.isNeedRecalculate()&&!this.inProgress){this.calculateAllRowsHeight();}}},{key:'onBeforeRowMove',value:function onBeforeRowMove(from,to){this.clearCacheByRange({from:from,to:to});this.calculateAllRowsHeight();}},{key:'onBeforeRowResize',value:function onBeforeRowResize(row,size,isDblClick){if(isDblClick){this.calculateRowsHeight(row,void 0,true);size=this.getRowHeight(row);}
return size;}},{key:'onAfterLoadData',value:function onAfterLoadData(){var _this6=this;if(this.hot.view){this.recalculateAllRowsHeight();}else{setTimeout(function(){if(_this6.hot){_this6.recalculateAllRowsHeight();}},0);}}},{key:'onBeforeChange',value:function onBeforeChange(changes){var range=null;if(changes.length===1){range=changes[0][0];}else if(changes.length>1){range={from:changes[0][0],to:changes[changes.length-1][0]};}
if(range!==null){this.clearCacheByRange(range);}}},{key:'destroy',value:function destroy(){this.ghostTable.clean();_get(AutoRowSize.prototype.__proto__||Object.getPrototypeOf(AutoRowSize.prototype),'destroy',this).call(this);}}]);return AutoRowSize;}(_base2.default);(0,_plugins.registerPlugin)('autoRowSize',AutoRowSize);exports.default=AutoRowSize;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _element=__webpack_require__(0);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _plugins=__webpack_require__(5);var _src=__webpack_require__(11);var _utils=__webpack_require__(213);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
_pluginHooks2.default.getSingleton().register('modifyAutofillRange');_pluginHooks2.default.getSingleton().register('beforeAutofill');var INSERT_ROW_ALTER_ACTION_NAME='insert_row';var INTERVAL_FOR_ADDING_ROW=200;var Autofill=function(_BasePlugin){_inherits(Autofill,_BasePlugin);function Autofill(hotInstance){_classCallCheck(this,Autofill);var _this=_possibleConstructorReturn(this,(Autofill.__proto__||Object.getPrototypeOf(Autofill)).call(this,hotInstance));_this.eventManager=new _eventManager2.default(_this);_this.addingStarted=false;_this.mouseDownOnCellCorner=false;_this.mouseDragOutside=false;_this.handleDraggedCells=0;_this.directions=[];_this.autoInsertRow=false;return _this;}
_createClass(Autofill,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().fillHandle;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.mapSettings();this.registerEvents();this.addHook('afterOnCellCornerMouseDown',function(event){return _this2.onAfterCellCornerMouseDown(event);});this.addHook('afterOnCellCornerDblClick',function(event){return _this2.onCellCornerDblClick(event);});this.addHook('beforeOnCellMouseOver',function(event,coords,TD){return _this2.onBeforeCellMouseOver(coords);});_get(Autofill.prototype.__proto__||Object.getPrototypeOf(Autofill.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();_get(Autofill.prototype.__proto__||Object.getPrototypeOf(Autofill.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){this.clearMappedSettings();_get(Autofill.prototype.__proto__||Object.getPrototypeOf(Autofill.prototype),'disablePlugin',this).call(this);}},{key:'getSelectionData',value:function getSelectionData(){var selRange={from:this.hot.getSelectedRange().from,to:this.hot.getSelectedRange().to};return this.hot.getData(selRange.from.row,selRange.from.col,selRange.to.row,selRange.to.col);}},{key:'fillIn',value:function fillIn(){if(this.hot.view.wt.selections.fill.isEmpty()){return false;}
var cornersOfSelectionAndDragAreas=this.hot.view.wt.selections.fill.getCorners();this.resetSelectionOfDraggedArea();var cornersOfSelectedCells=this.getCornersOfSelectedCells();var _getDragDirectionAndR=(0,_utils.getDragDirectionAndRange)(cornersOfSelectedCells,cornersOfSelectionAndDragAreas),directionOfDrag=_getDragDirectionAndR.directionOfDrag,startOfDragCoords=_getDragDirectionAndR.startOfDragCoords,endOfDragCoords=_getDragDirectionAndR.endOfDragCoords;this.hot.runHooks('modifyAutofillRange',cornersOfSelectedCells,cornersOfSelectionAndDragAreas);if(startOfDragCoords&&startOfDragCoords.row>-1&&startOfDragCoords.col>-1){var selectionData=this.getSelectionData();var deltas=(0,_utils.getDeltas)(startOfDragCoords,endOfDragCoords,selectionData,directionOfDrag);var fillData=selectionData;this.hot.runHooks('beforeAutofill',startOfDragCoords,endOfDragCoords,selectionData);if(['up','left'].indexOf(directionOfDrag)>-1){fillData=[];var dragLength=null;var fillOffset=null;if(directionOfDrag==='up'){dragLength=endOfDragCoords.row-startOfDragCoords.row+1;fillOffset=dragLength%selectionData.length;for(var i=0;i<dragLength;i++){fillData.push(selectionData[(i+(selectionData.length-fillOffset))%selectionData.length]);}}else{dragLength=endOfDragCoords.col-startOfDragCoords.col+1;fillOffset=dragLength%selectionData[0].length;for(var _i=0;_i<selectionData.length;_i++){fillData.push([]);for(var j=0;j<dragLength;j++){fillData[_i].push(selectionData[_i][(j+(selectionData[_i].length-fillOffset))%selectionData[_i].length]);}}}}
this.hot.populateFromArray(startOfDragCoords.row,startOfDragCoords.col,fillData,endOfDragCoords.row,endOfDragCoords.col,this.pluginName+'.fill',null,directionOfDrag,deltas);this.setSelection(cornersOfSelectionAndDragAreas);}else{this.hot.selection.refreshBorders();}
return true;}},{key:'reduceSelectionAreaIfNeeded',value:function reduceSelectionAreaIfNeeded(coords){if(coords.row<0){coords.row=0;}
if(coords.col<0){coords.col=0;}
return coords;}},{key:'getCoordsOfDragAndDropBorders',value:function getCoordsOfDragAndDropBorders(coordsOfSelection){var topLeftCorner=this.hot.getSelectedRange().getTopLeftCorner();var bottomRightCorner=this.hot.getSelectedRange().getBottomRightCorner();var coords=void 0;if(this.directions.includes(_utils.DIRECTIONS.vertical)&&(bottomRightCorner.row<coordsOfSelection.row||topLeftCorner.row>coordsOfSelection.row)){coords=new _src.CellCoords(coordsOfSelection.row,bottomRightCorner.col);}else if(this.directions.includes(_utils.DIRECTIONS.horizontal)){coords=new _src.CellCoords(bottomRightCorner.row,coordsOfSelection.col);}else{return;}
return this.reduceSelectionAreaIfNeeded(coords);}},{key:'showBorder',value:function showBorder(coordsOfSelection){var coordsOfDragAndDropBorders=this.getCoordsOfDragAndDropBorders(coordsOfSelection);if(coordsOfDragAndDropBorders){this.redrawBorders(coordsOfDragAndDropBorders);}}},{key:'addRow',value:function addRow(){var _this3=this;this.hot._registerTimeout(setTimeout(function(){_this3.hot.alter(INSERT_ROW_ALTER_ACTION_NAME,void 0,1,_this3.pluginName+'.fill');_this3.addingStarted=false;},INTERVAL_FOR_ADDING_ROW));}},{key:'addNewRowIfNeeded',value:function addNewRowIfNeeded(){if(this.hot.view.wt.selections.fill.cellRange&&this.addingStarted===false&&this.autoInsertRow){var cornersOfSelectedCells=this.hot.getSelected();var cornersOfSelectedDragArea=this.hot.view.wt.selections.fill.getCorners();var nrOfTableRows=this.hot.countRows();if(cornersOfSelectedCells[2]<nrOfTableRows-1&&cornersOfSelectedDragArea[2]===nrOfTableRows-1){this.addingStarted=true;this.addRow();}}}},{key:'getCornersOfSelectedCells',value:function getCornersOfSelectedCells(){if(this.hot.selection.isMultiple()){return this.hot.view.wt.selections.area.getCorners();}
return this.hot.view.wt.selections.current.getCorners();}},{key:'getIndexOfLastAdjacentFilledInRow',value:function getIndexOfLastAdjacentFilledInRow(cornersOfSelectedCells){var data=this.hot.getData();var nrOfTableRows=this.hot.countRows();var lastFilledInRowIndex=void 0;for(var rowIndex=cornersOfSelectedCells[2]+1;rowIndex<nrOfTableRows;rowIndex++){for(var columnIndex=cornersOfSelectedCells[1];columnIndex<=cornersOfSelectedCells[3];columnIndex++){var dataInCell=data[rowIndex][columnIndex];if(dataInCell){return-1;}}
var dataInNextLeftCell=data[rowIndex][cornersOfSelectedCells[1]-1];var dataInNextRightCell=data[rowIndex][cornersOfSelectedCells[3]+1];if(!!dataInNextLeftCell||!!dataInNextRightCell){lastFilledInRowIndex=rowIndex;}}
return lastFilledInRowIndex;}},{key:'addSelectionFromStartAreaToSpecificRowIndex',value:function addSelectionFromStartAreaToSpecificRowIndex(selectStartArea,rowIndex){this.hot.view.wt.selections.fill.clear();this.hot.view.wt.selections.fill.add(new _src.CellCoords(selectStartArea[0],selectStartArea[1]));this.hot.view.wt.selections.fill.add(new _src.CellCoords(rowIndex,selectStartArea[3]));}},{key:'setSelection',value:function setSelection(cornersOfArea){this.hot.selection.setRangeStart(new _src.CellCoords(cornersOfArea[0],cornersOfArea[1]));this.hot.selection.setRangeEnd(new _src.CellCoords(cornersOfArea[2],cornersOfArea[3]));}},{key:'selectAdjacent',value:function selectAdjacent(){var cornersOfSelectedCells=this.getCornersOfSelectedCells();var lastFilledInRowIndex=this.getIndexOfLastAdjacentFilledInRow(cornersOfSelectedCells);if(lastFilledInRowIndex===-1){return false;}
this.addSelectionFromStartAreaToSpecificRowIndex(cornersOfSelectedCells,lastFilledInRowIndex);return true;}},{key:'resetSelectionOfDraggedArea',value:function resetSelectionOfDraggedArea(){this.handleDraggedCells=0;this.hot.view.wt.selections.fill.clear();}},{key:'redrawBorders',value:function redrawBorders(coords){this.hot.view.wt.selections.fill.clear();this.hot.view.wt.selections.fill.add(this.hot.getSelectedRange().from);this.hot.view.wt.selections.fill.add(this.hot.getSelectedRange().to);this.hot.view.wt.selections.fill.add(coords);this.hot.view.render();}},{key:'getIfMouseWasDraggedOutside',value:function getIfMouseWasDraggedOutside(event){var tableBottom=(0,_element.offset)(this.hot.table).top-(window.pageYOffset||document.documentElement.scrollTop)+(0,_element.outerHeight)(this.hot.table);var tableRight=(0,_element.offset)(this.hot.table).left-(window.pageXOffset||document.documentElement.scrollLeft)+(0,_element.outerWidth)(this.hot.table);return event.clientY>tableBottom&&event.clientX<=tableRight;}},{key:'registerEvents',value:function registerEvents(){var _this4=this;this.eventManager.addEventListener(document.documentElement,'mouseup',function(){return _this4.onMouseUp();});this.eventManager.addEventListener(document.documentElement,'mousemove',function(event){return _this4.onMouseMove(event);});}},{key:'onCellCornerDblClick',value:function onCellCornerDblClick(){var selectionApplied=this.selectAdjacent();if(selectionApplied){this.fillIn();}}},{key:'onAfterCellCornerMouseDown',value:function onAfterCellCornerMouseDown(){this.handleDraggedCells=1;this.mouseDownOnCellCorner=true;}},{key:'onBeforeCellMouseOver',value:function onBeforeCellMouseOver(coords){if(this.mouseDownOnCellCorner&&!this.hot.view.isMouseDown()&&this.handleDraggedCells){this.handleDraggedCells++;this.showBorder(coords);this.addNewRowIfNeeded();}}},{key:'onMouseUp',value:function onMouseUp(){if(this.handleDraggedCells){if(this.handleDraggedCells>1){this.fillIn();}
this.handleDraggedCells=0;this.mouseDownOnCellCorner=false;}}},{key:'onMouseMove',value:function onMouseMove(event){var mouseWasDraggedOutside=this.getIfMouseWasDraggedOutside(event);if(this.addingStarted===false&&this.handleDraggedCells>0&&mouseWasDraggedOutside){this.mouseDragOutside=true;this.addingStarted=true;}else{this.mouseDragOutside=false;}
if(this.mouseDragOutside&&this.autoInsertRow){this.addRow();}}},{key:'clearMappedSettings',value:function clearMappedSettings(){this.directions.length=0;this.autoInsertRow=false;}},{key:'mapSettings',value:function mapSettings(){var mappedSettings=(0,_utils.getMappedFillHandleSetting)(this.hot.getSettings().fillHandle);this.directions=mappedSettings.directions;this.autoInsertRow=mappedSettings.autoInsertRow;}},{key:'destroy',value:function destroy(){_get(Autofill.prototype.__proto__||Object.getPrototypeOf(Autofill.prototype),'destroy',this).call(this);}}]);return Autofill;}(_base2.default);(0,_plugins.registerPlugin)('autofill',Autofill);exports.default=Autofill;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.DIRECTIONS=undefined;exports.getDeltas=getDeltas;exports.getDragDirectionAndRange=getDragDirectionAndRange;exports.getMappedFillHandleSetting=getMappedFillHandleSetting;var _object=__webpack_require__(1);var _mixed=__webpack_require__(20);var _src=__webpack_require__(11);var DIRECTIONS=exports.DIRECTIONS={horizontal:'horizontal',vertical:'vertical'};function getDeltas(start,end,data,direction){var rowsLength=data.length;var columnsLength=data?data[0].length:0;var deltas=[];var diffRow=end.row-start.row;var diffCol=end.col-start.col;if(['down','up'].indexOf(direction)!==-1){var arr=[];for(var col=0;col<=diffCol;col++){var startValue=parseInt(data[0][col],10);var endValue=parseInt(data[rowsLength-1][col],10);var delta=(direction==='down'?endValue-startValue:startValue-endValue)/(rowsLength-1)||0;arr.push(delta);}
deltas.push(arr);}
if(['right','left'].indexOf(direction)!==-1){for(var row=0;row<=diffRow;row++){var _startValue=parseInt(data[row][0],10);var _endValue=parseInt(data[row][columnsLength-1],10);var _delta=(direction==='right'?_endValue-_startValue:_startValue-_endValue)/(columnsLength-1)||0;deltas.push([_delta]);}}
return deltas;}
function getDragDirectionAndRange(startSelection,endSelection){var startOfDragCoords=void 0,endOfDragCoords=void 0,directionOfDrag=void 0;if(endSelection[0]===startSelection[0]&&endSelection[1]<startSelection[1]){directionOfDrag='left';startOfDragCoords=new _src.CellCoords(endSelection[0],endSelection[1]);endOfDragCoords=new _src.CellCoords(endSelection[2],startSelection[1]-1);}else if(endSelection[0]===startSelection[0]&&endSelection[3]>startSelection[3]){directionOfDrag='right';startOfDragCoords=new _src.CellCoords(endSelection[0],startSelection[3]+1);endOfDragCoords=new _src.CellCoords(endSelection[2],endSelection[3]);}else if(endSelection[0]<startSelection[0]&&endSelection[1]===startSelection[1]){directionOfDrag='up';startOfDragCoords=new _src.CellCoords(endSelection[0],endSelection[1]);endOfDragCoords=new _src.CellCoords(startSelection[0]-1,endSelection[3]);}else if(endSelection[2]>startSelection[2]&&endSelection[1]===startSelection[1]){directionOfDrag='down';startOfDragCoords=new _src.CellCoords(startSelection[2]+1,endSelection[1]);endOfDragCoords=new _src.CellCoords(endSelection[2],endSelection[3]);}
return{directionOfDrag:directionOfDrag,startOfDragCoords:startOfDragCoords,endOfDragCoords:endOfDragCoords};}
function getMappedFillHandleSetting(fillHandle){var mappedSettings={};if(fillHandle===true){mappedSettings.directions=Object.keys(DIRECTIONS);mappedSettings.autoInsertRow=true;}else if((0,_object.isObject)(fillHandle)){if((0,_mixed.isDefined)(fillHandle.autoInsertRow)){if(fillHandle.direction===DIRECTIONS.horizontal){mappedSettings.autoInsertRow=false;}else{mappedSettings.autoInsertRow=fillHandle.autoInsertRow;}}else{mappedSettings.autoInsertRow=false;}
if((0,_mixed.isDefined)(fillHandle.direction)){mappedSettings.directions=[fillHandle.direction];}else{mappedSettings.directions=Object.keys(DIRECTIONS);}}else if(typeof fillHandle==='string'){mappedSettings.directions=[fillHandle];mappedSettings.autoInsertRow=true;}else{mappedSettings.directions=[];mappedSettings.autoInsertRow=false;}
return mappedSettings;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _moment=__webpack_require__(61);var _moment2=_interopRequireDefault(_moment);var _element=__webpack_require__(0);var _array=__webpack_require__(2);var _mixed=__webpack_require__(20);var _object=__webpack_require__(1);var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _plugins=__webpack_require__(5);var _mergeSort=__webpack_require__(272);var _mergeSort2=_interopRequireDefault(_mergeSort);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
_pluginHooks2.default.getSingleton().register('beforeColumnSort');_pluginHooks2.default.getSingleton().register('afterColumnSort');var ColumnSorting=function(_BasePlugin){_inherits(ColumnSorting,_BasePlugin);function ColumnSorting(hotInstance){_classCallCheck(this,ColumnSorting);var _this2=_possibleConstructorReturn(this,(ColumnSorting.__proto__||Object.getPrototypeOf(ColumnSorting)).call(this,hotInstance));_this2.sortIndicators=[];_this2.lastSortedColumn=null;_this2.sortEmptyCells=false;return _this2;}
_createClass(ColumnSorting,[{key:'isEnabled',value:function isEnabled(){return!!this.hot.getSettings().columnSorting;}},{key:'enablePlugin',value:function enablePlugin(){var _this3=this;if(this.enabled){return;}
this.setPluginOptions();var _this=this;this.hot.sortIndex=[];this.hot.sort=function(){var args=Array.prototype.slice.call(arguments);return _this.sortByColumn.apply(_this,_toConsumableArray(args));};if(typeof this.hot.getSettings().observeChanges==='undefined'){this.enableObserveChangesPlugin();}
this.addHook('afterTrimRow',function(row){return _this3.sort();});this.addHook('afterUntrimRow',function(row){return _this3.sort();});this.addHook('modifyRow',function(row){return _this3.translateRow(row);});this.addHook('unmodifyRow',function(row){return _this3.untranslateRow(row);});this.addHook('afterUpdateSettings',function(){return _this3.onAfterUpdateSettings();});this.addHook('afterGetColHeader',function(col,TH){return _this3.getColHeader(col,TH);});this.addHook('afterOnCellMouseDown',function(event,target){return _this3.onAfterOnCellMouseDown(event,target);});this.addHook('afterCreateRow',function(){_this.afterCreateRow.apply(_this,arguments);});this.addHook('afterRemoveRow',function(){_this.afterRemoveRow.apply(_this,arguments);});this.addHook('afterInit',function(){return _this3.sortBySettings();});this.addHook('afterLoadData',function(){_this3.hot.sortIndex=[];if(_this3.hot.view){_this3.sortBySettings();}});if(this.hot.view){this.sortBySettings();}
_get(ColumnSorting.prototype.__proto__||Object.getPrototypeOf(ColumnSorting.prototype),'enablePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){this.hot.sort=void 0;_get(ColumnSorting.prototype.__proto__||Object.getPrototypeOf(ColumnSorting.prototype),'disablePlugin',this).call(this);}},{key:'onAfterUpdateSettings',value:function onAfterUpdateSettings(){this.sortBySettings();}},{key:'sortBySettings',value:function sortBySettings(){var sortingSettings=this.hot.getSettings().columnSorting;var loadedSortingState=this.loadSortingState();var sortingColumn=void 0;var sortingOrder=void 0;if(typeof loadedSortingState==='undefined'){sortingColumn=sortingSettings.column;sortingOrder=sortingSettings.sortOrder;}else{sortingColumn=loadedSortingState.sortColumn;sortingOrder=loadedSortingState.sortOrder;}
if(typeof sortingColumn==='number'){this.lastSortedColumn=sortingColumn;this.sortByColumn(sortingColumn,sortingOrder);}}},{key:'setSortingColumn',value:function setSortingColumn(col,order){if(typeof col=='undefined'){this.hot.sortColumn=void 0;this.hot.sortOrder=void 0;return;}else if(this.hot.sortColumn===col&&typeof order=='undefined'){if(this.hot.sortOrder===false){this.hot.sortOrder=void 0;}else{this.hot.sortOrder=!this.hot.sortOrder;}}else{this.hot.sortOrder=typeof order==='undefined'?true:order;}
this.hot.sortColumn=col;}},{key:'sortByColumn',value:function sortByColumn(col,order){this.setSortingColumn(col,order);if(typeof this.hot.sortColumn=='undefined'){return;}
var allowSorting=this.hot.runHooks('beforeColumnSort',this.hot.sortColumn,this.hot.sortOrder);if(allowSorting!==false){this.sort();}
this.updateOrderClass();this.updateSortIndicator();this.hot.runHooks('afterColumnSort',this.hot.sortColumn,this.hot.sortOrder);this.hot.render();this.saveSortingState();}},{key:'saveSortingState',value:function saveSortingState(){var sortingState={};if(typeof this.hot.sortColumn!='undefined'){sortingState.sortColumn=this.hot.sortColumn;}
if(typeof this.hot.sortOrder!='undefined'){sortingState.sortOrder=this.hot.sortOrder;}
if((0,_object.hasOwnProperty)(sortingState,'sortColumn')||(0,_object.hasOwnProperty)(sortingState,'sortOrder')){this.hot.runHooks('persistentStateSave','columnSorting',sortingState);}}},{key:'loadSortingState',value:function loadSortingState(){var storedState={};this.hot.runHooks('persistentStateLoad','columnSorting',storedState);return storedState.value;}},{key:'updateOrderClass',value:function updateOrderClass(){var orderClass=void 0;if(this.hot.sortOrder===true){orderClass='ascending';}else if(this.hot.sortOrder===false){orderClass='descending';}
this.sortOrderClass=orderClass;}},{key:'enableObserveChangesPlugin',value:function enableObserveChangesPlugin(){var _this=this;this.hot._registerTimeout(setTimeout(function(){_this.hot.updateSettings({observeChanges:true});},0));}},{key:'defaultSort',value:function defaultSort(sortOrder,columnMeta){return function(a,b){if(typeof a[1]=='string'){a[1]=a[1].toLowerCase();}
if(typeof b[1]=='string'){b[1]=b[1].toLowerCase();}
if(a[1]===b[1]){return 0;}
if((0,_mixed.isEmpty)(a[1])){if((0,_mixed.isEmpty)(b[1])){return 0;}
if(columnMeta.columnSorting.sortEmptyCells){return sortOrder?-1:1;}
return 1;}
if((0,_mixed.isEmpty)(b[1])){if((0,_mixed.isEmpty)(a[1])){return 0;}
if(columnMeta.columnSorting.sortEmptyCells){return sortOrder?1:-1;}
return-1;}
if(isNaN(a[1])&&!isNaN(b[1])){return sortOrder?1:-1;}else if(!isNaN(a[1])&&isNaN(b[1])){return sortOrder?-1:1;}else if(!(isNaN(a[1])||isNaN(b[1]))){a[1]=parseFloat(a[1]);b[1]=parseFloat(b[1]);}
if(a[1]<b[1]){return sortOrder?-1:1;}
if(a[1]>b[1]){return sortOrder?1:-1;}
return 0;};}},{key:'dateSort',value:function dateSort(sortOrder,columnMeta){return function(a,b){if(a[1]===b[1]){return 0;}
if((0,_mixed.isEmpty)(a[1])){if((0,_mixed.isEmpty)(b[1])){return 0;}
if(columnMeta.columnSorting.sortEmptyCells){return sortOrder?-1:1;}
return 1;}
if((0,_mixed.isEmpty)(b[1])){if((0,_mixed.isEmpty)(a[1])){return 0;}
if(columnMeta.columnSorting.sortEmptyCells){return sortOrder?1:-1;}
return-1;}
var aDate=(0,_moment2.default)(a[1],columnMeta.dateFormat);var bDate=(0,_moment2.default)(b[1],columnMeta.dateFormat);if(!aDate.isValid()){return 1;}
if(!bDate.isValid()){return-1;}
if(bDate.isAfter(aDate)){return sortOrder?-1:1;}
if(bDate.isBefore(aDate)){return sortOrder?1:-1;}
return 0;};}},{key:'numericSort',value:function numericSort(sortOrder,columnMeta){return function(a,b){var parsedA=parseFloat(a[1]);var parsedB=parseFloat(b[1]);if(parsedA===parsedB||isNaN(parsedA)&&isNaN(parsedB)){return 0;}
if(columnMeta.columnSorting.sortEmptyCells){if((0,_mixed.isEmpty)(a[1])){return sortOrder?-1:1;}
if((0,_mixed.isEmpty)(b[1])){return sortOrder?1:-1;}}
if(isNaN(parsedA)){return 1;}
if(isNaN(parsedB)){return-1;}
if(parsedA<parsedB){return sortOrder?-1:1;}else if(parsedA>parsedB){return sortOrder?1:-1;}
return 0;};}},{key:'sort',value:function sort(){if(typeof this.hot.sortOrder=='undefined'){this.hot.sortIndex.length=0;return;}
var colMeta=this.hot.getCellMeta(0,this.hot.sortColumn);var emptyRows=this.hot.countEmptyRows();var sortFunction=void 0;var nrOfRows=void 0;this.hot.sortingEnabled=false;this.hot.sortIndex.length=0;if(typeof colMeta.columnSorting.sortEmptyCells==='undefined'){colMeta.columnSorting={sortEmptyCells:this.sortEmptyCells};}
if(this.hot.getSettings().maxRows===Number.POSITIVE_INFINITY){nrOfRows=this.hot.countRows()-this.hot.getSettings().minSpareRows;}else{nrOfRows=this.hot.countRows()-emptyRows;}
for(var i=0,ilen=nrOfRows;i<ilen;i++){this.hot.sortIndex.push([i,this.hot.getDataAtCell(i,this.hot.sortColumn)]);}
if(colMeta.sortFunction){sortFunction=colMeta.sortFunction;}else{switch(colMeta.type){case'date':sortFunction=this.dateSort;break;case'numeric':sortFunction=this.numericSort;break;default:sortFunction=this.defaultSort;}}
(0,_mergeSort2.default)(this.hot.sortIndex,sortFunction(this.hot.sortOrder,colMeta));for(var _i=this.hot.sortIndex.length;_i<this.hot.countRows();_i++){this.hot.sortIndex.push([_i,this.hot.getDataAtCell(_i,this.hot.sortColumn)]);}
this.hot.sortingEnabled=true;}},{key:'updateSortIndicator',value:function updateSortIndicator(){if(typeof this.hot.sortOrder=='undefined'){return;}
var colMeta=this.hot.getCellMeta(0,this.hot.sortColumn);this.sortIndicators[this.hot.sortColumn]=colMeta.sortIndicator;}},{key:'translateRow',value:function translateRow(row){if(this.hot.sortingEnabled&&typeof this.hot.sortOrder!=='undefined'&&this.hot.sortIndex&&this.hot.sortIndex.length&&this.hot.sortIndex[row]){return this.hot.sortIndex[row][0];}
return row;}},{key:'untranslateRow',value:function untranslateRow(row){if(this.hot.sortingEnabled&&this.hot.sortIndex&&this.hot.sortIndex.length){for(var i=0;i<this.hot.sortIndex.length;i++){if(this.hot.sortIndex[i][0]==row){return i;}}}}},{key:'getColHeader',value:function getColHeader(col,TH){if(col<0||!TH.parentNode){return false;}
var headerLink=TH.querySelector('.colHeader');var colspan=TH.getAttribute('colspan');var TRs=TH.parentNode.parentNode.childNodes;var headerLevel=Array.prototype.indexOf.call(TRs,TH.parentNode);headerLevel-=TRs.length;if(!headerLink){return;}
if(this.hot.getSettings().columnSorting&&col>=0&&headerLevel===-1){(0,_element.addClass)(headerLink,'columnSorting');}
(0,_element.removeClass)(headerLink,'descending');(0,_element.removeClass)(headerLink,'ascending');if(this.sortIndicators[col]){if(col===this.hot.sortColumn){if(this.sortOrderClass==='ascending'){(0,_element.addClass)(headerLink,'ascending');}else if(this.sortOrderClass==='descending'){(0,_element.addClass)(headerLink,'descending');}}}}},{key:'isSorted',value:function isSorted(){return typeof this.hot.sortColumn!='undefined';}},{key:'afterCreateRow',value:function afterCreateRow(index,amount){if(!this.isSorted()){return;}
for(var i=0;i<this.hot.sortIndex.length;i++){if(this.hot.sortIndex[i][0]>=index){this.hot.sortIndex[i][0]+=amount;}}
for(var _i2=0;_i2<amount;_i2++){this.hot.sortIndex.splice(index+_i2,0,[index+_i2,this.hot.getSourceData()[index+_i2][this.hot.sortColumn+this.hot.colOffset()]]);}
this.saveSortingState();}},{key:'afterRemoveRow',value:function afterRemoveRow(index,amount){if(!this.isSorted()){return;}
var removedRows=this.hot.sortIndex.splice(index,amount);removedRows=(0,_array.arrayMap)(removedRows,function(row){return row[0];});function countRowShift(logicalRow){return(0,_array.arrayReduce)(removedRows,function(count,removedLogicalRow){if(logicalRow>removedLogicalRow){count++;}
return count;},0);}
this.hot.sortIndex=(0,_array.arrayMap)(this.hot.sortIndex,function(logicalRow,physicalRow){var rowShift=countRowShift(logicalRow[0]);if(rowShift){logicalRow[0]-=rowShift;}
return logicalRow;});this.saveSortingState();}},{key:'setPluginOptions',value:function setPluginOptions(){var columnSorting=this.hot.getSettings().columnSorting;if((typeof columnSorting==='undefined'?'undefined':_typeof(columnSorting))==='object'){this.sortEmptyCells=columnSorting.sortEmptyCells||false;}else{this.sortEmptyCells=false;}}},{key:'onAfterOnCellMouseDown',value:function onAfterOnCellMouseDown(event,coords){if(coords.row>-1){return;}
if((0,_element.hasClass)(event.realTarget,'columnSorting')){if(coords.col!==this.lastSortedColumn){this.hot.sortOrder=true;}
this.lastSortedColumn=coords.col;this.sortByColumn(coords.col);}}}]);return ColumnSorting;}(_base2.default);(0,_plugins.registerPlugin)('columnSorting',ColumnSorting);exports.default=ColumnSorting;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var CommentEditor=function(){_createClass(CommentEditor,null,[{key:'CLASS_EDITOR_CONTAINER',get:function get(){return'htCommentsContainer';}},{key:'CLASS_EDITOR',get:function get(){return'htComments';}},{key:'CLASS_INPUT',get:function get(){return'htCommentTextArea';}},{key:'CLASS_CELL',get:function get(){return'htCommentCell';}}]);function CommentEditor(){_classCallCheck(this,CommentEditor);this.editor=this.createEditor();this.editorStyle=this.editor.style;this.hidden=true;this.hide();}
_createClass(CommentEditor,[{key:'setPosition',value:function setPosition(x,y){this.editorStyle.left=x+'px';this.editorStyle.top=y+'px';}},{key:'setSize',value:function setSize(width,height){if(width&&height){var input=this.getInputElement();input.style.width=width+'px';input.style.height=height+'px';}}},{key:'resetSize',value:function resetSize(){var input=this.getInputElement();input.style.width='';input.style.height='';}},{key:'setReadOnlyState',value:function setReadOnlyState(state){var input=this.getInputElement();input.readOnly=state;}},{key:'show',value:function show(){this.editorStyle.display='block';this.hidden=false;}},{key:'hide',value:function hide(){this.editorStyle.display='none';this.hidden=true;}},{key:'isVisible',value:function isVisible(){return this.editorStyle.display==='block';}},{key:'setValue',value:function setValue(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';value=value||'';this.getInputElement().value=value;}},{key:'getValue',value:function getValue(){return this.getInputElement().value;}},{key:'isFocused',value:function isFocused(){return document.activeElement===this.getInputElement();}},{key:'focus',value:function focus(){this.getInputElement().focus();}},{key:'createEditor',value:function createEditor(){var container=document.querySelector('.'+CommentEditor.CLASS_EDITOR_CONTAINER);var editor=void 0;var textArea=void 0;if(!container){container=document.createElement('div');(0,_element.addClass)(container,CommentEditor.CLASS_EDITOR_CONTAINER);document.body.appendChild(container);}
editor=document.createElement('div');(0,_element.addClass)(editor,CommentEditor.CLASS_EDITOR);textArea=document.createElement('textarea');(0,_element.addClass)(textArea,CommentEditor.CLASS_INPUT);editor.appendChild(textArea);container.appendChild(editor);return editor;}},{key:'getInputElement',value:function getInputElement(){return this.editor.querySelector('.'+CommentEditor.CLASS_INPUT);}},{key:'destroy',value:function destroy(){this.editor.parentNode.removeChild(this.editor);this.editor=null;this.editorStyle=null;}}]);return CommentEditor;}();exports.default=CommentEditor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _element=__webpack_require__(0);var _object=__webpack_require__(1);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _src=__webpack_require__(11);var _plugins=__webpack_require__(5);var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _commentEditor=__webpack_require__(215);var _commentEditor2=_interopRequireDefault(_commentEditor);var _utils=__webpack_require__(17);var _displaySwitch=__webpack_require__(217);var _displaySwitch2=_interopRequireDefault(_displaySwitch);__webpack_require__(296);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var privatePool=new WeakMap();var META_COMMENT='comment';var META_COMMENT_VALUE='value';var META_STYLE='style';var META_READONLY='readOnly';var Comments=function(_BasePlugin){_inherits(Comments,_BasePlugin);function Comments(hotInstance){_classCallCheck(this,Comments);var _this=_possibleConstructorReturn(this,(Comments.__proto__||Object.getPrototypeOf(Comments)).call(this,hotInstance));_this.editor=null;_this.displaySwitch=null;_this.eventManager=null;_this.range={};_this.mouseDown=false;_this.contextMenuEvent=false;_this.timer=null;privatePool.set(_this,{tempEditorDimensions:{},cellBelowCursor:null});return _this;}
_createClass(Comments,[{key:'isEnabled',value:function isEnabled(){return!!this.hot.getSettings().comments;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
if(!this.editor){this.editor=new _commentEditor2.default();}
if(!this.eventManager){this.eventManager=new _eventManager2.default(this);}
if(!this.displaySwitch){this.displaySwitch=new _displaySwitch2.default(this.getDisplayDelaySetting());}
this.addHook('afterContextMenuDefaultOptions',function(options){return _this2.addToContextMenu(options);});this.addHook('afterRenderer',function(TD,row,col,prop,value,cellProperties){return _this2.onAfterRenderer(TD,cellProperties);});this.addHook('afterScrollHorizontally',function(){return _this2.hide();});this.addHook('afterScrollVertically',function(){return _this2.hide();});this.addHook('afterBeginEditing',function(args){return _this2.onAfterBeginEditing(args);});this.displaySwitch.addLocalHook('hide',function(){return _this2.hide();});this.displaySwitch.addLocalHook('show',function(row,col){return _this2.showAtCell(row,col);});this.registerListeners();_get(Comments.prototype.__proto__||Object.getPrototypeOf(Comments.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();_get(Comments.prototype.__proto__||Object.getPrototypeOf(Comments.prototype),'updatePlugin',this).call(this);this.displaySwitch.updateDelay(this.getDisplayDelaySetting());}},{key:'disablePlugin',value:function disablePlugin(){_get(Comments.prototype.__proto__||Object.getPrototypeOf(Comments.prototype),'disablePlugin',this).call(this);}},{key:'registerListeners',value:function registerListeners(){var _this3=this;this.eventManager.addEventListener(document,'mouseover',function(event){return _this3.onMouseOver(event);});this.eventManager.addEventListener(document,'mousedown',function(event){return _this3.onMouseDown(event);});this.eventManager.addEventListener(document,'mouseup',function(event){return _this3.onMouseUp(event);});this.eventManager.addEventListener(this.editor.getInputElement(),'blur',function(event){return _this3.onEditorBlur(event);});this.eventManager.addEventListener(this.editor.getInputElement(),'mousedown',function(event){return _this3.onEditorMouseDown(event);});this.eventManager.addEventListener(this.editor.getInputElement(),'mouseup',function(event){return _this3.onEditorMouseUp(event);});}},{key:'setRange',value:function setRange(range){this.range=range;}},{key:'clearRange',value:function clearRange(){this.range={};}},{key:'targetIsCellWithComment',value:function targetIsCellWithComment(event){var closestCell=(0,_element.closest)(event.target,'TD','TBODY');return!!(closestCell&&(0,_element.hasClass)(closestCell,'htCommentCell')&&(0,_element.closest)(closestCell,[this.hot.rootElement]));}},{key:'targetIsCommentTextArea',value:function targetIsCommentTextArea(event){return this.editor.getInputElement()===event.target;}},{key:'setComment',value:function setComment(value){if(!this.range.from){throw new Error('Before using this method, first set cell range (hot.getPlugin("comment").setRange())');}
var editorValue=this.editor.getValue();var comment='';if(value!=null){comment=value;}else if(editorValue!=null){comment=editorValue;}
var row=this.range.from.row;var col=this.range.from.col;this.updateCommentMeta(row,col,_defineProperty({},META_COMMENT_VALUE,comment));this.hot.render();}},{key:'setCommentAtCell',value:function setCommentAtCell(row,col,value){this.setRange({from:new _src.CellCoords(row,col)});this.setComment(value);}},{key:'removeComment',value:function removeComment(){var forceRender=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!this.range.from){throw new Error('Before using this method, first set cell range (hot.getPlugin("comment").setRange())');}
this.hot.setCellMeta(this.range.from.row,this.range.from.col,META_COMMENT,void 0);if(forceRender){this.hot.render();}
this.hide();}},{key:'removeCommentAtCell',value:function removeCommentAtCell(row,col){var forceRender=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.setRange({from:new _src.CellCoords(row,col)});this.removeComment(forceRender);}},{key:'getComment',value:function getComment(){var row=this.range.from.row;var column=this.range.from.col;return this.getCommentMeta(row,column,META_COMMENT_VALUE);}},{key:'getCommentAtCell',value:function getCommentAtCell(row,column){return this.getCommentMeta(row,column,META_COMMENT_VALUE);}},{key:'show',value:function show(){if(!this.range.from){throw new Error('Before using this method, first set cell range (hot.getPlugin("comment").setRange())');}
var meta=this.hot.getCellMeta(this.range.from.row,this.range.from.col);this.refreshEditor(true);this.editor.setValue(meta[META_COMMENT]?meta[META_COMMENT][META_COMMENT_VALUE]:null||'');if(this.editor.hidden){this.editor.show();}
return true;}},{key:'showAtCell',value:function showAtCell(row,col){this.setRange({from:new _src.CellCoords(row,col)});return this.show();}},{key:'hide',value:function hide(){if(!this.editor.hidden){this.editor.hide();}}},{key:'refreshEditor',value:function refreshEditor(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!force&&(!this.range.from||!this.editor.isVisible())){return;}
var scrollableElement=(0,_element.getScrollableElement)(this.hot.view.wt.wtTable.TABLE);var TD=this.hot.view.wt.wtTable.getCell(this.range.from);var row=this.range.from.row;var column=this.range.from.col;var cellOffset=(0,_element.offset)(TD);var lastColWidth=this.hot.view.wt.wtTable.getStretchedColumnWidth(column);var cellTopOffset=cellOffset.top<0?0:cellOffset.top;var cellLeftOffset=cellOffset.left;if(this.hot.view.wt.wtViewport.hasVerticalScroll()&&scrollableElement!==window){cellTopOffset-=this.hot.view.wt.wtOverlays.topOverlay.getScrollPosition();}
if(this.hot.view.wt.wtViewport.hasHorizontalScroll()&&scrollableElement!==window){cellLeftOffset-=this.hot.view.wt.wtOverlays.leftOverlay.getScrollPosition();}
var x=cellLeftOffset+lastColWidth;var y=cellTopOffset;var commentStyle=this.getCommentMeta(row,column,META_STYLE);var readOnly=this.getCommentMeta(row,column,META_READONLY);if(commentStyle){this.editor.setSize(commentStyle.width,commentStyle.height);}else{this.editor.resetSize();}
this.editor.setReadOnlyState(readOnly);this.editor.setPosition(x,y);}},{key:'checkSelectionCommentsConsistency',value:function checkSelectionCommentsConsistency(){var selected=this.hot.getSelectedRange();if(!selected){return false;}
var hasComment=false;var cell=selected.from;if(this.getCommentMeta(cell.row,cell.col,META_COMMENT_VALUE)){hasComment=true;}
return hasComment;}},{key:'updateCommentMeta',value:function updateCommentMeta(row,column,metaObject){var oldComment=this.hot.getCellMeta(row,column)[META_COMMENT];var newComment=void 0;if(oldComment){newComment=(0,_object.deepClone)(oldComment);(0,_object.deepExtend)(newComment,metaObject);}else{newComment=metaObject;}
this.hot.setCellMeta(row,column,META_COMMENT,newComment);}},{key:'getCommentMeta',value:function getCommentMeta(row,column,property){var cellMeta=this.hot.getCellMeta(row,column);if(!cellMeta[META_COMMENT]){return void 0;}
return cellMeta[META_COMMENT][property];}},{key:'onMouseDown',value:function onMouseDown(event){this.mouseDown=true;if(!this.hot.view||!this.hot.view.wt){return;}
if(!this.contextMenuEvent&&!this.targetIsCommentTextArea(event)){var eventCell=(0,_element.closest)(event.target,'TD','TBODY');var coordinates=null;if(eventCell){coordinates=this.hot.view.wt.wtTable.getCoords(eventCell);}
if(!eventCell||this.range.from&&coordinates&&(this.range.from.row!==coordinates.row||this.range.from.col!==coordinates.col)){this.hide();}}
this.contextMenuEvent=false;}},{key:'onMouseOver',value:function onMouseOver(event){var priv=privatePool.get(this);priv.cellBelowCursor=document.elementFromPoint(event.clientX,event.clientY);if(this.mouseDown||this.editor.isFocused()||(0,_element.hasClass)(event.target,'wtBorder')||priv.cellBelowCursor!==event.target||!this.editor){return;}
if(this.targetIsCellWithComment(event)){var coordinates=this.hot.view.wt.wtTable.getCoords(event.target);var range={from:new _src.CellCoords(coordinates.row,coordinates.col)};this.displaySwitch.show(range);}else if((0,_element.isChildOf)(event.target,document)&&!this.targetIsCommentTextArea(event)){this.displaySwitch.hide();}}},{key:'onMouseUp',value:function onMouseUp(event){this.mouseDown=false;}},{key:'onAfterRenderer',value:function onAfterRenderer(TD,cellProperties){if(cellProperties[META_COMMENT]&&cellProperties[META_COMMENT][META_COMMENT_VALUE]){(0,_element.addClass)(TD,cellProperties.commentedCellClassName);}}},{key:'onEditorBlur',value:function onEditorBlur(event){this.setComment();}},{key:'onEditorMouseDown',value:function onEditorMouseDown(event){var priv=privatePool.get(this);priv.tempEditorDimensions={width:(0,_element.outerWidth)(event.target),height:(0,_element.outerHeight)(event.target)};}},{key:'onEditorMouseUp',value:function onEditorMouseUp(event){var priv=privatePool.get(this);var currentWidth=(0,_element.outerWidth)(event.target);var currentHeight=(0,_element.outerHeight)(event.target);if(currentWidth!==priv.tempEditorDimensions.width+1||currentHeight!==priv.tempEditorDimensions.height+2){this.updateCommentMeta(this.range.from.row,this.range.from.col,_defineProperty({},META_STYLE,{width:currentWidth,height:currentHeight}));}}},{key:'onContextMenuAddComment',value:function onContextMenuAddComment(){var _this4=this;this.displaySwitch.cancelHiding();var coords=this.hot.getSelectedRange();this.contextMenuEvent=true;this.setRange({from:coords.from});this.show();setTimeout(function(){if(_this4.hot){_this4.hot.deselectCell();_this4.editor.focus();}},10);}},{key:'onContextMenuRemoveComment',value:function onContextMenuRemoveComment(selection){this.contextMenuEvent=true;for(var i=selection.start.row;i<=selection.end.row;i++){for(var j=selection.start.col;j<=selection.end.col;j++){this.removeCommentAtCell(i,j,false);}}
this.hot.render();}},{key:'onContextMenuMakeReadOnly',value:function onContextMenuMakeReadOnly(selection){this.contextMenuEvent=true;for(var i=selection.start.row;i<=selection.end.row;i++){for(var j=selection.start.col;j<=selection.end.col;j++){var currentState=!!this.getCommentMeta(i,j,META_READONLY);this.updateCommentMeta(i,j,_defineProperty({},META_READONLY,!currentState));}}}},{key:'addToContextMenu',value:function addToContextMenu(defaultOptions){var _this5=this;defaultOptions.items.push({name:'---------'},{key:'commentsAddEdit',name:function name(){return _this5.checkSelectionCommentsConsistency()?'Edit comment':'Add comment';},callback:function callback(){return _this5.onContextMenuAddComment();},disabled:function disabled(){return!(this.getSelected()&&!this.selection.selectedHeader.corner);}},{key:'commentsRemove',name:function name(){return'Delete comment';},callback:function callback(key,selection){return _this5.onContextMenuRemoveComment(selection);},disabled:function disabled(){return _this5.hot.selection.selectedHeader.corner;}},{key:'commentsReadOnly',name:function name(){var _this6=this;var label='Read only comment';var hasProperty=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var readOnlyProperty=_this6.getCellMeta(row,col)[META_COMMENT];if(readOnlyProperty){readOnlyProperty=readOnlyProperty[META_READONLY];}
if(readOnlyProperty){return true;}});if(hasProperty){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(key,selection){return _this5.onContextMenuMakeReadOnly(selection);},disabled:function disabled(){return _this5.hot.selection.selectedHeader.corner||!_this5.checkSelectionCommentsConsistency();}});}},{key:'getDisplayDelaySetting',value:function getDisplayDelaySetting(){var commentSetting=this.hot.getSettings().comments;if((0,_object.isObject)(commentSetting)){return commentSetting.displayDelay;}
return void 0;}},{key:'onAfterBeginEditing',value:function onAfterBeginEditing(row,column){this.hide();}},{key:'destroy',value:function destroy(){if(this.editor){this.editor.destroy();}
if(this.displaySwitch){this.displaySwitch.destroy();}
_get(Comments.prototype.__proto__||Object.getPrototypeOf(Comments.prototype),'destroy',this).call(this);}}]);return Comments;}(_base2.default);(0,_plugins.registerPlugin)('comments',Comments);exports.default=Comments;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _function=__webpack_require__(35);var _object=__webpack_require__(1);var _localHooks=__webpack_require__(69);var _localHooks2=_interopRequireDefault(_localHooks);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var DEFAULT_DISPLAY_DELAY=250;var DEFAULT_HIDE_DELAY=250;var DisplaySwitch=function(){function DisplaySwitch(displayDelay){_classCallCheck(this,DisplaySwitch);this.wasLastActionShow=true;this.showDebounced=null;this.hidingTimer=null;this.updateDelay(displayDelay);}
_createClass(DisplaySwitch,[{key:'hide',value:function hide(){var _this=this;this.wasLastActionShow=false;this.hidingTimer=setTimeout(function(){if(_this.wasLastActionShow===false){_this.runLocalHooks('hide');}},DEFAULT_HIDE_DELAY);}},{key:'show',value:function show(range){this.wasLastActionShow=true;this.showDebounced(range);}},{key:'cancelHiding',value:function cancelHiding(){this.wasLastActionShow=true;clearTimeout(this.hidingTimer);this.hidingTimer=null;}},{key:'updateDelay',value:function updateDelay(){var _this2=this;var displayDelay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_DISPLAY_DELAY;this.showDebounced=(0,_function.debounce)(function(range){if(_this2.wasLastActionShow){_this2.runLocalHooks('show',range.from.row,range.from.col);}},displayDelay);}},{key:'destroy',value:function destroy(){this.clearLocalHooks();}}]);return DisplaySwitch;}();(0,_object.mixin)(DisplaySwitch,_localHooks2.default);exports.default=DisplaySwitch;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _array=__webpack_require__(2);var _object=__webpack_require__(1);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var CommandExecutor=function(){function CommandExecutor(hotInstance){_classCallCheck(this,CommandExecutor);this.hot=hotInstance;this.commands={};this.commonCallback=null;}
_createClass(CommandExecutor,[{key:'registerCommand',value:function registerCommand(name,commandDescriptor){this.commands[name]=commandDescriptor;}},{key:'setCommonCallback',value:function setCommonCallback(callback){this.commonCallback=callback;}},{key:'execute',value:function execute(commandName){var _this=this;for(var _len=arguments.length,params=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){params[_key-1]=arguments[_key];}
var commandSplit=commandName.split(':');commandName=commandSplit[0];var subCommandName=commandSplit.length===2?commandSplit[1]:null;var command=this.commands[commandName];if(!command){throw new Error('Menu command \''+commandName+'\' not exists.');}
if(subCommandName&&command.submenu){command=findSubCommand(subCommandName,command.submenu.items);}
if(command.disabled===true){return;}
if(typeof command.disabled=='function'&&command.disabled.call(this.hot)===true){return;}
if((0,_object.hasOwnProperty)(command,'submenu')){return;}
var callbacks=[];if(typeof command.callback==='function'){callbacks.push(command.callback);}
if(typeof this.commonCallback==='function'){callbacks.push(this.commonCallback);}
params.unshift(commandSplit.join(':'));(0,_array.arrayEach)(callbacks,function(callback){return callback.apply(_this.hot,params);});}}]);return CommandExecutor;}();function findSubCommand(subCommandName,subCommands){var command=void 0;(0,_array.arrayEach)(subCommands,function(cmd){var cmds=cmd.key?cmd.key.split(':'):null;if(Array.isArray(cmds)&&cmds[1]===subCommandName){command=cmd;return false;}});return command;}
exports.default=CommandExecutor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _array=__webpack_require__(2);var _commandExecutor=__webpack_require__(218);var _commandExecutor2=_interopRequireDefault(_commandExecutor);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _itemsFactory=__webpack_require__(221);var _itemsFactory2=_interopRequireDefault(_itemsFactory);var _menu=__webpack_require__(222);var _menu2=_interopRequireDefault(_menu);var _plugins=__webpack_require__(5);var _event=__webpack_require__(7);var _element=__webpack_require__(0);var _predefinedItems=__webpack_require__(70);__webpack_require__(297);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
_pluginHooks2.default.getSingleton().register('afterContextMenuDefaultOptions');_pluginHooks2.default.getSingleton().register('afterContextMenuShow');_pluginHooks2.default.getSingleton().register('afterContextMenuHide');_pluginHooks2.default.getSingleton().register('afterContextMenuExecute');var ContextMenu=function(_BasePlugin){_inherits(ContextMenu,_BasePlugin);_createClass(ContextMenu,null,[{key:'DEFAULT_ITEMS',get:function get(){return[_predefinedItems.ROW_ABOVE,_predefinedItems.ROW_BELOW,_predefinedItems.SEPARATOR,_predefinedItems.COLUMN_LEFT,_predefinedItems.COLUMN_RIGHT,_predefinedItems.SEPARATOR,_predefinedItems.REMOVE_ROW,_predefinedItems.REMOVE_COLUMN,_predefinedItems.SEPARATOR,_predefinedItems.UNDO,_predefinedItems.REDO,_predefinedItems.SEPARATOR,_predefinedItems.READ_ONLY,_predefinedItems.SEPARATOR,_predefinedItems.ALIGNMENT];}}]);function ContextMenu(hotInstance){_classCallCheck(this,ContextMenu);var _this=_possibleConstructorReturn(this,(ContextMenu.__proto__||Object.getPrototypeOf(ContextMenu)).call(this,hotInstance));_this.eventManager=new _eventManager2.default(_this);_this.commandExecutor=new _commandExecutor2.default(_this.hot);_this.itemsFactory=null;_this.menu=null;return _this;}
_createClass(ContextMenu,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().contextMenu;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.itemsFactory=new _itemsFactory2.default(this.hot,ContextMenu.DEFAULT_ITEMS);var settings=this.hot.getSettings().contextMenu;var predefinedItems={items:this.itemsFactory.getItems(settings)};this.registerEvents();if(typeof settings.callback==='function'){this.commandExecutor.setCommonCallback(settings.callback);}
_get(ContextMenu.prototype.__proto__||Object.getPrototypeOf(ContextMenu.prototype),'enablePlugin',this).call(this);this.callOnPluginsReady(function(){_this2.hot.runHooks('afterContextMenuDefaultOptions',predefinedItems);_this2.itemsFactory.setPredefinedItems(predefinedItems.items);var menuItems=_this2.itemsFactory.getItems(settings);_this2.menu=new _menu2.default(_this2.hot,{className:'htContextMenu',keepInViewport:true});_this2.hot.runHooks('beforeContextMenuSetItems',menuItems);_this2.menu.setMenuItems(menuItems);_this2.menu.addLocalHook('afterOpen',function(){return _this2.onMenuAfterOpen();});_this2.menu.addLocalHook('afterClose',function(){return _this2.onMenuAfterClose();});_this2.menu.addLocalHook('executeCommand',function(){for(var _len=arguments.length,params=Array(_len),_key=0;_key<_len;_key++){params[_key]=arguments[_key];}
return _this2.executeCommand.apply(_this2,params);});(0,_array.arrayEach)(menuItems,function(command){return _this2.commandExecutor.registerCommand(command.key,command);});});}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();_get(ContextMenu.prototype.__proto__||Object.getPrototypeOf(ContextMenu.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){this.close();if(this.menu){this.menu.destroy();this.menu=null;}
_get(ContextMenu.prototype.__proto__||Object.getPrototypeOf(ContextMenu.prototype),'disablePlugin',this).call(this);}},{key:'registerEvents',value:function registerEvents(){var _this3=this;this.eventManager.addEventListener(this.hot.rootElement,'contextmenu',function(event){return _this3.onContextMenu(event);});}},{key:'open',value:function open(event){if(!this.menu){return;}
this.menu.open();this.menu.setPosition({top:parseInt((0,_event.pageY)(event),10)-(0,_element.getWindowScrollTop)(),left:parseInt((0,_event.pageX)(event),10)-(0,_element.getWindowScrollLeft)()});this.menu.hotMenu.isHotTableEnv=this.hot.isHotTableEnv;}},{key:'close',value:function close(){if(!this.menu){return;}
this.menu.close();}},{key:'executeCommand',value:function executeCommand(){for(var _len2=arguments.length,params=Array(_len2),_key2=0;_key2<_len2;_key2++){params[_key2]=arguments[_key2];}
this.commandExecutor.execute.apply(this.commandExecutor,params);}},{key:'onContextMenu',value:function onContextMenu(event){var settings=this.hot.getSettings();var showRowHeaders=settings.rowHeaders;var showColHeaders=settings.colHeaders;function isValidElement(element){return element.nodeName==='TD'||element.parentNode.nodeName==='TD';}
var element=event.realTarget;this.close();if((0,_element.hasClass)(element,'handsontableInput')){return;}
event.preventDefault();(0,_event.stopPropagation)(event);if(!(showRowHeaders||showColHeaders)){if(!isValidElement(element)&&!((0,_element.hasClass)(element,'current')&&(0,_element.hasClass)(element,'wtBorder'))){return;}}
this.open(event);}},{key:'onMenuAfterOpen',value:function onMenuAfterOpen(){this.hot.runHooks('afterContextMenuShow',this);}},{key:'onMenuAfterClose',value:function onMenuAfterClose(){this.hot.listen();this.hot.runHooks('afterContextMenuHide',this);}},{key:'destroy',value:function destroy(){this.close();if(this.menu){this.menu.destroy();}
_get(ContextMenu.prototype.__proto__||Object.getPrototypeOf(ContextMenu.prototype),'destroy',this).call(this);}}]);return ContextMenu;}(_base2.default);ContextMenu.SEPARATOR={name:_predefinedItems.SEPARATOR};(0,_plugins.registerPlugin)('contextMenu',ContextMenu);exports.default=ContextMenu;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _element=__webpack_require__(0);var _event=__webpack_require__(7);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Cursor=function(){function Cursor(object){_classCallCheck(this,Cursor);var windowScrollTop=(0,_element.getWindowScrollTop)();var windowScrollLeft=(0,_element.getWindowScrollLeft)();var top=void 0,topRelative=void 0;var left=void 0,leftRelative=void 0;var cellHeight=void 0,cellWidth=void 0;this.type=this.getSourceType(object);if(this.type==='literal'){top=parseInt(object.top,10);left=parseInt(object.left,10);cellHeight=object.height||0;cellWidth=object.width||0;topRelative=top;leftRelative=left;top+=windowScrollTop;left+=windowScrollLeft;}else if(this.type==='event'){top=parseInt((0,_event.pageY)(object),10);left=parseInt((0,_event.pageX)(object),10);cellHeight=object.target.clientHeight;cellWidth=object.target.clientWidth;topRelative=top-windowScrollTop;leftRelative=left-windowScrollLeft;}
this.top=top;this.topRelative=topRelative;this.left=left;this.leftRelative=leftRelative;this.scrollTop=windowScrollTop;this.scrollLeft=windowScrollLeft;this.cellHeight=cellHeight;this.cellWidth=cellWidth;}
_createClass(Cursor,[{key:'getSourceType',value:function getSourceType(object){var type='literal';if(object instanceof Event){type='event';}
return type;}},{key:'fitsAbove',value:function fitsAbove(element){return this.topRelative>=element.offsetHeight;}},{key:'fitsBelow',value:function fitsBelow(element){var viewportHeight=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.innerHeight;return this.topRelative+element.offsetHeight<=viewportHeight;}},{key:'fitsOnRight',value:function fitsOnRight(element){var viewportWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.innerWidth;return this.leftRelative+this.cellWidth+element.offsetWidth<=viewportWidth;}},{key:'fitsOnLeft',value:function fitsOnLeft(element){return this.leftRelative>=element.offsetWidth;}}]);return Cursor;}();exports.default=Cursor;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _object=__webpack_require__(1);var _array=__webpack_require__(2);var _predefinedItems=__webpack_require__(70);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var ItemsFactory=function(){function ItemsFactory(hotInstance){var orderPattern=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,ItemsFactory);this.hot=hotInstance;this.predefinedItems=(0,_predefinedItems.predefinedItems)();this.defaultOrderPattern=orderPattern;}
_createClass(ItemsFactory,[{key:'setPredefinedItems',value:function setPredefinedItems(predefinedItems){var _this=this;var items={};this.defaultOrderPattern.length=0;(0,_object.objectEach)(predefinedItems,function(value,key){var menuItemKey='';if(value.name===_predefinedItems.SEPARATOR){items[_predefinedItems.SEPARATOR]=value;menuItemKey=_predefinedItems.SEPARATOR;}else if(isNaN(parseInt(key,10))){value.key=value.key===void 0?key:value.key;items[key]=value;menuItemKey=value.key;}else{items[value.key]=value;menuItemKey=value.key;}
_this.defaultOrderPattern.push(menuItemKey);});this.predefinedItems=items;}},{key:'getItems',value:function getItems(){var pattern=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return _getItems(pattern,this.defaultOrderPattern,this.predefinedItems);}}]);return ItemsFactory;}();function _getItems(){var pattern=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var defaultPattern=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var items=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var result=[];if(pattern&&pattern.items){pattern=pattern.items;}else if(!Array.isArray(pattern)){pattern=defaultPattern;}
if((0,_object.isObject)(pattern)){(0,_object.objectEach)(pattern,function(value,key){var item=items[typeof value==='string'?value:key];if(!item){item=value;}
if((0,_object.isObject)(value)){(0,_object.extend)(item,value);}else if(typeof item==='string'){item={name:item};}
if(item.key===void 0){item.key=key;}
result.push(item);});}else{(0,_array.arrayEach)(pattern,function(name,key){var item=items[name];if(!item&&_predefinedItems.ITEMS.indexOf(name)>=0){return;}
if(!item){item={name:name,key:''+key};}
if((0,_object.isObject)(name)){(0,_object.extend)(item,name);}
if(item.key===void 0){item.key=key;}
result.push(item);});}
return result;}
exports.default=ItemsFactory;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _core=__webpack_require__(63);var _core2=_interopRequireDefault(_core);var _element=__webpack_require__(0);var _array=__webpack_require__(2);var _cursor=__webpack_require__(220);var _cursor2=_interopRequireDefault(_cursor);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _object=__webpack_require__(1);var _function=__webpack_require__(35);var _utils=__webpack_require__(17);var _unicode=__webpack_require__(16);var _localHooks=__webpack_require__(69);var _localHooks2=_interopRequireDefault(_localHooks);var _predefinedItems=__webpack_require__(70);var _event=__webpack_require__(7);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Menu=function(){function Menu(hotInstance,options){_classCallCheck(this,Menu);this.hot=hotInstance;this.options=options||{parent:null,name:null,className:'',keepInViewport:true,standalone:false};this.eventManager=new _eventManager2.default(this);this.container=this.createContainer(this.options.name);this.hotMenu=null;this.hotSubMenus={};this.parentMenu=this.options.parent||null;this.menuItems=null;this.origOutsideClickDeselects=null;this.keyEvent=false;this.offset={above:0,below:0,left:0,right:0};this._afterScrollCallback=null;this.registerEvents();}
_createClass(Menu,[{key:'registerEvents',value:function registerEvents(){var _this=this;this.eventManager.addEventListener(document.documentElement,'mousedown',function(event){return _this.onDocumentMouseDown(event);});}},{key:'setMenuItems',value:function setMenuItems(menuItems){this.menuItems=menuItems;}},{key:'setOffset',value:function setOffset(area){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.offset[area]=offset;}},{key:'isSubMenu',value:function isSubMenu(){return this.parentMenu!==null;}},{key:'open',value:function open(){var _this2=this;this.container.removeAttribute('style');this.container.style.display='block';var delayedOpenSubMenu=(0,_function.debounce)(function(row){return _this2.openSubMenu(row);},300);var filteredItems=(0,_array.arrayFilter)(this.menuItems,function(item){return(0,_utils.isItemHidden)(item,_this2.hot);});filteredItems=(0,_utils.filterSeparators)(filteredItems,_predefinedItems.SEPARATOR);var settings={data:filteredItems,colHeaders:false,colWidths:[200],autoRowSize:false,readOnly:true,copyPaste:false,columns:[{data:'name',renderer:function renderer(hot,TD,row,col,prop,value){return _this2.menuItemRenderer(hot,TD,row,col,prop,value);}}],renderAllRows:true,fragmentSelection:'cell',disableVisualSelection:'area',beforeKeyDown:function beforeKeyDown(event){return _this2.onBeforeKeyDown(event);},afterOnCellMouseOver:function afterOnCellMouseOver(event,coords,TD){if(_this2.isAllSubMenusClosed()){delayedOpenSubMenu(coords.row);}else{_this2.openSubMenu(coords.row);}},rowHeights:function rowHeights(row){return filteredItems[row].name===_predefinedItems.SEPARATOR?1:23;}};this.origOutsideClickDeselects=this.hot.getSettings().outsideClickDeselects;this.hot.getSettings().outsideClickDeselects=false;this.hotMenu=new _core2.default(this.container,settings);this.hotMenu.addHook('afterInit',function(){return _this2.onAfterInit();});this.hotMenu.addHook('afterSelection',function(r,c,r2,c2,preventScrolling){return _this2.onAfterSelection(r,c,r2,c2,preventScrolling);});this.hotMenu.init();this.hotMenu.listen();this.blockMainTableCallbacks();this.runLocalHooks('afterOpen');}},{key:'close',value:function close(){var closeParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.isOpened()){return;}
if(closeParent&&this.parentMenu){this.parentMenu.close();}else{this.closeAllSubMenus();this.container.style.display='none';this.releaseMainTableCallbacks();this.hotMenu.destroy();this.hotMenu=null;this.hot.getSettings().outsideClickDeselects=this.origOutsideClickDeselects;this.runLocalHooks('afterClose');if(this.parentMenu){this.parentMenu.hotMenu.listen();}}}},{key:'openSubMenu',value:function openSubMenu(row){if(!this.hotMenu){return false;}
var cell=this.hotMenu.getCell(row,0);this.closeAllSubMenus();if(!cell||!(0,_utils.hasSubMenu)(cell)){return false;}
var dataItem=this.hotMenu.getSourceDataAtRow(row);var subMenu=new Menu(this.hot,{parent:this,name:dataItem.name,className:this.options.className,keepInViewport:true});subMenu.setMenuItems(dataItem.submenu.items);subMenu.open();subMenu.setPosition(cell.getBoundingClientRect());this.hotSubMenus[dataItem.key]=subMenu;return subMenu;}},{key:'closeSubMenu',value:function closeSubMenu(row){var dataItem=this.hotMenu.getSourceDataAtRow(row);var menus=this.hotSubMenus[dataItem.key];if(menus){menus.destroy();delete this.hotSubMenus[dataItem.key];}}},{key:'closeAllSubMenus',value:function closeAllSubMenus(){var _this3=this;(0,_array.arrayEach)(this.hotMenu.getData(),function(value,row){return _this3.closeSubMenu(row);});}},{key:'isAllSubMenusClosed',value:function isAllSubMenusClosed(){return Object.keys(this.hotSubMenus).length===0;}},{key:'destroy',value:function destroy(){this.clearLocalHooks();this.close();this.parentMenu=null;this.eventManager.destroy();}},{key:'isOpened',value:function isOpened(){return this.hotMenu!==null;}},{key:'executeCommand',value:function executeCommand(event){if(!this.isOpened()||!this.hotMenu.getSelected()){return;}
var selectedItem=this.hotMenu.getSourceDataAtRow(this.hotMenu.getSelected()[0]);this.runLocalHooks('select',selectedItem,event);if(selectedItem.isCommand===false||selectedItem.name===_predefinedItems.SEPARATOR){return;}
var selRange=this.hot.getSelectedRange();var normalizedSelection=selRange?(0,_utils.normalizeSelection)(selRange):{};var autoClose=true;if(selectedItem.disabled===true||typeof selectedItem.disabled==='function'&&selectedItem.disabled.call(this.hot)===true||selectedItem.submenu){autoClose=false;}
this.runLocalHooks('executeCommand',selectedItem.key,normalizedSelection,event);if(this.isSubMenu()){this.parentMenu.runLocalHooks('executeCommand',selectedItem.key,normalizedSelection,event);}
if(autoClose){this.close(true);}}},{key:'setPosition',value:function setPosition(coords){var cursor=new _cursor2.default(coords);if(this.options.keepInViewport){if(cursor.fitsBelow(this.container)){this.setPositionBelowCursor(cursor);}else if(cursor.fitsAbove(this.container)){this.setPositionAboveCursor(cursor);}else{this.setPositionBelowCursor(cursor);}
if(cursor.fitsOnRight(this.container)){this.setPositionOnRightOfCursor(cursor);}else{this.setPositionOnLeftOfCursor(cursor);}}else{this.setPositionBelowCursor(cursor);this.setPositionOnRightOfCursor(cursor);}}},{key:'setPositionAboveCursor',value:function setPositionAboveCursor(cursor){var top=this.offset.above+cursor.top-this.container.offsetHeight;if(this.isSubMenu()){top=cursor.top+cursor.cellHeight-this.container.offsetHeight+3;}
this.container.style.top=top+'px';}},{key:'setPositionBelowCursor',value:function setPositionBelowCursor(cursor){var top=this.offset.below+cursor.top;if(this.isSubMenu()){top=cursor.top-1;}
this.container.style.top=top+'px';}},{key:'setPositionOnRightOfCursor',value:function setPositionOnRightOfCursor(cursor){var left=void 0;if(this.isSubMenu()){left=1+cursor.left+cursor.cellWidth;}else{left=this.offset.right+1+cursor.left;}
this.container.style.left=left+'px';}},{key:'setPositionOnLeftOfCursor',value:function setPositionOnLeftOfCursor(cursor){var left=this.offset.left+cursor.left-this.container.offsetWidth+(0,_element.getScrollbarWidth)()+4;this.container.style.left=left+'px';}},{key:'selectFirstCell',value:function selectFirstCell(){var cell=this.hotMenu.getCell(0,0);if((0,_utils.isSeparator)(cell)||(0,_utils.isDisabled)(cell)||(0,_utils.isSelectionDisabled)(cell)){this.selectNextCell(0,0);}else{this.hotMenu.selectCell(0,0);}}},{key:'selectLastCell',value:function selectLastCell(){var lastRow=this.hotMenu.countRows()-1;var cell=this.hotMenu.getCell(lastRow,0);if((0,_utils.isSeparator)(cell)||(0,_utils.isDisabled)(cell)||(0,_utils.isSelectionDisabled)(cell)){this.selectPrevCell(lastRow,0);}else{this.hotMenu.selectCell(lastRow,0);}}},{key:'selectNextCell',value:function selectNextCell(row,col){var nextRow=row+1;var cell=nextRow<this.hotMenu.countRows()?this.hotMenu.getCell(nextRow,col):null;if(!cell){return;}
if((0,_utils.isSeparator)(cell)||(0,_utils.isDisabled)(cell)||(0,_utils.isSelectionDisabled)(cell)){this.selectNextCell(nextRow,col);}else{this.hotMenu.selectCell(nextRow,col);}}},{key:'selectPrevCell',value:function selectPrevCell(row,col){var prevRow=row-1;var cell=prevRow>=0?this.hotMenu.getCell(prevRow,col):null;if(!cell){return;}
if((0,_utils.isSeparator)(cell)||(0,_utils.isDisabled)(cell)||(0,_utils.isSelectionDisabled)(cell)){this.selectPrevCell(prevRow,col);}else{this.hotMenu.selectCell(prevRow,col);}}},{key:'menuItemRenderer',value:function menuItemRenderer(hot,TD,row,col,prop,value){var _this4=this;var item=hot.getSourceDataAtRow(row);var wrapper=document.createElement('div');var isSubMenu=function isSubMenu(item){return(0,_object.hasOwnProperty)(item,'submenu');};var itemIsSeparator=function itemIsSeparator(item){return new RegExp(_predefinedItems.SEPARATOR,'i').test(item.name);};var itemIsDisabled=function itemIsDisabled(item){return item.disabled===true||typeof item.disabled=='function'&&item.disabled.call(_this4.hot)===true;};var itemIsSelectionDisabled=function itemIsSelectionDisabled(item){return item.disableSelection;};if(typeof value==='function'){value=value.call(this.hot);}
(0,_element.empty)(TD);(0,_element.addClass)(wrapper,'htItemWrapper');TD.appendChild(wrapper);if(itemIsSeparator(item)){(0,_element.addClass)(TD,'htSeparator');}else if(typeof item.renderer==='function'){(0,_element.addClass)(TD,'htCustomMenuRenderer');TD.appendChild(item.renderer(hot,wrapper,row,col,prop,value));}else{(0,_element.fastInnerHTML)(wrapper,value);}
if(itemIsDisabled(item)){(0,_element.addClass)(TD,'htDisabled');this.eventManager.addEventListener(TD,'mouseenter',function(){return hot.deselectCell();});}else if(itemIsSelectionDisabled(item)){(0,_element.addClass)(TD,'htSelectionDisabled');this.eventManager.addEventListener(TD,'mouseenter',function(){return hot.deselectCell();});}else if(isSubMenu(item)){(0,_element.addClass)(TD,'htSubmenu');if(itemIsSelectionDisabled(item)){this.eventManager.addEventListener(TD,'mouseenter',function(){return hot.deselectCell();});}else{this.eventManager.addEventListener(TD,'mouseenter',function(){return hot.selectCell(row,col,void 0,void 0,false,false);});}}else{(0,_element.removeClass)(TD,'htSubmenu');(0,_element.removeClass)(TD,'htDisabled');if(itemIsSelectionDisabled(item)){this.eventManager.addEventListener(TD,'mouseenter',function(){return hot.deselectCell();});}else{this.eventManager.addEventListener(TD,'mouseenter',function(){return hot.selectCell(row,col,void 0,void 0,false,false);});}}}},{key:'createContainer',value:function createContainer(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(name){name=name.replace(/[^A-z0-9]/g,'_');name=this.options.className+'Sub_'+name;}
var container=void 0;if(name){container=document.querySelector('.'+this.options.className+'.'+name);}else{container=document.querySelector('.'+this.options.className);}
if(!container){container=document.createElement('div');(0,_element.addClass)(container,'htMenu '+this.options.className);if(name){(0,_element.addClass)(container,name);}
document.getElementsByTagName('body')[0].appendChild(container);}
return container;}},{key:'blockMainTableCallbacks',value:function blockMainTableCallbacks(){this._afterScrollCallback=function(){};this.hot.addHook('afterScrollVertically',this._afterScrollCallback);this.hot.addHook('afterScrollHorizontally',this._afterScrollCallback);}},{key:'releaseMainTableCallbacks',value:function releaseMainTableCallbacks(){if(this._afterScrollCallback){this.hot.removeHook('afterScrollVertically',this._afterScrollCallback);this.hot.removeHook('afterScrollHorizontally',this._afterScrollCallback);this._afterScrollCallback=null;}}},{key:'onBeforeKeyDown',value:function onBeforeKeyDown(event){var selection=this.hotMenu.getSelected();var stopEvent=false;this.keyEvent=true;switch(event.keyCode){case _unicode.KEY_CODES.ESCAPE:this.close();stopEvent=true;break;case _unicode.KEY_CODES.ENTER:if(selection){if(this.hotMenu.getSourceDataAtRow(selection[0]).submenu){stopEvent=true;}else{this.executeCommand(event);this.close(true);}}
break;case _unicode.KEY_CODES.ARROW_DOWN:if(selection){this.selectNextCell(selection[0],selection[1]);}else{this.selectFirstCell();}
stopEvent=true;break;case _unicode.KEY_CODES.ARROW_UP:if(selection){this.selectPrevCell(selection[0],selection[1]);}else{this.selectLastCell();}
stopEvent=true;break;case _unicode.KEY_CODES.ARROW_RIGHT:if(selection){var menu=this.openSubMenu(selection[0]);if(menu){menu.selectFirstCell();}}
stopEvent=true;break;case _unicode.KEY_CODES.ARROW_LEFT:if(selection&&this.isSubMenu()){this.close();if(this.parentMenu){this.parentMenu.hotMenu.listen();}
stopEvent=true;}
break;default:break;}
if(stopEvent){event.preventDefault();(0,_event.stopImmediatePropagation)(event);}
this.keyEvent=false;}},{key:'onAfterInit',value:function onAfterInit(){var data=this.hotMenu.getSettings().data;var hiderStyle=this.hotMenu.view.wt.wtTable.hider.style;var holderStyle=this.hotMenu.view.wt.wtTable.holder.style;var currentHiderWidth=parseInt(hiderStyle.width,10);var realHeight=(0,_array.arrayReduce)(data,function(accumulator,value){return accumulator+(value.name===_predefinedItems.SEPARATOR?1:26);},0);holderStyle.width=currentHiderWidth+22+'px';holderStyle.height=realHeight+4+'px';hiderStyle.height=holderStyle.height;}},{key:'onAfterSelection',value:function onAfterSelection(r,c,r2,c2,preventScrolling){if(this.keyEvent===false){preventScrolling.value=true;}}},{key:'onDocumentMouseDown',value:function onDocumentMouseDown(event){if(!this.isOpened()){return;}
if(this.container&&(0,_element.isChildOf)(event.target,this.container)){this.executeCommand(event);}
if(this.options.standalone&&this.hotMenu&&!(0,_element.isChildOf)(event.target,this.hotMenu.rootElement)){this.close(true);}else if((this.isAllSubMenusClosed()||this.isSubMenu())&&!(0,_element.isChildOf)(event.target,'.htMenu')&&(0,_element.isChildOf)(event.target,document)){this.close(true);}}}]);return Menu;}();(0,_object.mixin)(Menu,_localHooks2.default);exports.default=Menu;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=alignmentItem;var _utils=__webpack_require__(17);var _separator=__webpack_require__(71);var KEY=exports.KEY='alignment';function alignmentItem(){return{key:KEY,name:'Alignment',disabled:function disabled(){return!(this.getSelectedRange()&&!this.selection.selectedHeader.corner);},submenu:{items:[{key:KEY+':left',name:function name(){var _this=this;var label='Left';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this.getCellMeta(row,col).className;if(className&&className.indexOf('htLeft')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this2=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this2.getCellMeta(row,col).className;});var type='horizontal';var alignment='htLeft';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this2.getCellMeta(row,col);},function(row,col,key,value){return _this2.setCellMeta(row,col,key,value);});this.render();},disabled:false},{key:KEY+':center',name:function name(){var _this3=this;var label='Center';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this3.getCellMeta(row,col).className;if(className&&className.indexOf('htCenter')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this4=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this4.getCellMeta(row,col).className;});var type='horizontal';var alignment='htCenter';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this4.getCellMeta(row,col);},function(row,col,key,value){return _this4.setCellMeta(row,col,key,value);});this.render();},disabled:false},{key:KEY+':right',name:function name(){var _this5=this;var label='Right';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this5.getCellMeta(row,col).className;if(className&&className.indexOf('htRight')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this6=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this6.getCellMeta(row,col).className;});var type='horizontal';var alignment='htRight';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this6.getCellMeta(row,col);},function(row,col,key,value){return _this6.setCellMeta(row,col,key,value);});this.render();},disabled:false},{key:KEY+':justify',name:function name(){var _this7=this;var label='Justify';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this7.getCellMeta(row,col).className;if(className&&className.indexOf('htJustify')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this8=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this8.getCellMeta(row,col).className;});var type='horizontal';var alignment='htJustify';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this8.getCellMeta(row,col);},function(row,col,key,value){return _this8.setCellMeta(row,col,key,value);});this.render();},disabled:false},{name:_separator.KEY},{key:KEY+':top',name:function name(){var _this9=this;var label='Top';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this9.getCellMeta(row,col).className;if(className&&className.indexOf('htTop')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this10=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this10.getCellMeta(row,col).className;});var type='vertical';var alignment='htTop';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this10.getCellMeta(row,col);},function(row,col,key,value){return _this10.setCellMeta(row,col,key,value);});this.render();},disabled:false},{key:KEY+':middle',name:function name(){var _this11=this;var label='Middle';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this11.getCellMeta(row,col).className;if(className&&className.indexOf('htMiddle')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this12=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this12.getCellMeta(row,col).className;});var type='vertical';var alignment='htMiddle';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this12.getCellMeta(row,col);},function(row,col,key,value){return _this12.setCellMeta(row,col,key,value);});this.render();},disabled:false},{key:KEY+':bottom',name:function name(){var _this13=this;var label='Bottom';var hasClass=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){var className=_this13.getCellMeta(row,col).className;if(className&&className.indexOf('htBottom')!==-1){return true;}});if(hasClass){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this14=this;var range=this.getSelectedRange();var stateBefore=(0,_utils.getAlignmentClasses)(range,function(row,col){return _this14.getCellMeta(row,col).className;});var type='vertical';var alignment='htBottom';this.runHooks('beforeCellAlignment',stateBefore,range,type,alignment);(0,_utils.align)(range,type,alignment,function(row,col){return _this14.getCellMeta(row,col);},function(row,col,key,value){return _this14.setCellMeta(row,col,key,value);});this.render();},disabled:false}]}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=clearColumnItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='clear_column';function clearColumnItem(){return{key:KEY,name:'Clear column',callback:function callback(key,selection){var column=selection.start.col;if(this.countRows()){this.populateFromArray(0,column,[[null]],Math.max(selection.start.row,selection.end.row),column,'ContextMenu.clearColumn');}},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);if(!selected){return true;}
var entireRowSelection=[selected[0],0,selected[0],this.countCols()-1];var rowSelected=entireRowSelection.join(',')==selected.join(',');return selected[1]<0||this.countCols()>=this.getSettings().maxCols||rowSelected;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=columnLeftItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='col_left';function columnLeftItem(){return{key:KEY,name:'Insert column on the left',callback:function callback(key,selection){this.alter('insert_col',selection.start.col,1,'ContextMenu.columnLeft');},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);if(!selected){return true;}
if(!this.isColumnModificationAllowed()){return true;}
var entireRowSelection=[selected[0],0,selected[0],this.countCols()-1];var rowSelected=entireRowSelection.join(',')==selected.join(',');var onlyOneColumn=this.countCols()===1;return selected[1]<0||this.countCols()>=this.getSettings().maxCols||!onlyOneColumn&&rowSelected;},hidden:function hidden(){return!this.getSettings().allowInsertColumn;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=columnRightItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='col_right';function columnRightItem(){return{key:KEY,name:'Insert column on the right',callback:function callback(key,selection){this.alter('insert_col',selection.end.col+1,1,'ContextMenu.columnRight');},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);if(!selected){return true;}
if(!this.isColumnModificationAllowed()){return true;}
var entireRowSelection=[selected[0],0,selected[0],this.countCols()-1];var rowSelected=entireRowSelection.join(',')==selected.join(',');var onlyOneColumn=this.countCols()===1;return selected[1]<0||this.countCols()>=this.getSettings().maxCols||!onlyOneColumn&&rowSelected;},hidden:function hidden(){return!this.getSettings().allowInsertColumn;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=readOnlyItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='make_read_only';function readOnlyItem(){return{key:KEY,name:function name(){var _this=this;var label='Read only';var atLeastOneReadOnly=(0,_utils.checkSelectionConsistency)(this.getSelectedRange(),function(row,col){return _this.getCellMeta(row,col).readOnly;});if(atLeastOneReadOnly){label=(0,_utils.markLabelAsSelected)(label);}
return label;},callback:function callback(){var _this2=this;var range=this.getSelectedRange();var atLeastOneReadOnly=(0,_utils.checkSelectionConsistency)(range,function(row,col){return _this2.getCellMeta(row,col).readOnly;});range.forAll(function(row,col){_this2.setCellMeta(row,col,'readOnly',!atLeastOneReadOnly);});this.render();},disabled:function disabled(){return!(this.getSelectedRange()&&!this.selection.selectedHeader.corner);}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=redoItem;var KEY=exports.KEY='redo';function redoItem(){return{key:KEY,name:'Redo',callback:function callback(){this.redo();},disabled:function disabled(){return this.undoRedo&&!this.undoRedo.isRedoAvailable();}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=removeColumnItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='remove_col';function removeColumnItem(){return{key:KEY,name:'Remove column',callback:function callback(key,selection){var amount=selection.end.col-selection.start.col+1;this.alter('remove_col',selection.start.col,amount,'ContextMenu.removeColumn');},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);var totalColumns=this.countCols();return!selected||this.selection.selectedHeader.rows||this.selection.selectedHeader.corner||!this.isColumnModificationAllowed()||!totalColumns;},hidden:function hidden(){return!this.getSettings().allowRemoveColumn;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=removeRowItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='remove_row';function removeRowItem(){return{key:KEY,name:'Remove row',callback:function callback(key,selection){var amount=selection.end.row-selection.start.row+1;this.alter('remove_row',selection.start.row,amount,'ContextMenu.removeRow');},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);var totalRows=this.countRows();return!selected||this.selection.selectedHeader.cols||this.selection.selectedHeader.corner||!totalRows;},hidden:function hidden(){return!this.getSettings().allowRemoveRow;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=rowAboveItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='row_above';function rowAboveItem(){return{key:KEY,name:'Insert row above',callback:function callback(key,selection){this.alter('insert_row',selection.start.row,1,'ContextMenu.rowAbove');},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);return!selected||this.selection.selectedHeader.cols||this.countRows()>=this.getSettings().maxRows;},hidden:function hidden(){return!this.getSettings().allowInsertRow;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.KEY=undefined;exports.default=rowBelowItem;var _utils=__webpack_require__(17);var KEY=exports.KEY='row_below';function rowBelowItem(){return{key:KEY,name:'Insert row below',callback:function callback(key,selection){this.alter('insert_row',selection.end.row+1,1,'ContextMenu.rowBelow');},disabled:function disabled(){var selected=(0,_utils.getValidSelection)(this);return!selected||this.selection.selectedHeader.cols||this.countRows()>=this.getSettings().maxRows;},hidden:function hidden(){return!this.getSettings().allowInsertRow;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=undoItem;var KEY=exports.KEY='undo';function undoItem(){return{key:KEY,name:'Undo',callback:function callback(){this.undo();},disabled:function disabled(){return this.undoRedo&&!this.undoRedo.isUndoAvailable();}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=copyItem;function copyItem(copyPastePlugin){return{key:'copy',name:'Copy',callback:function callback(){copyPastePlugin.setCopyableText();copyPastePlugin.copy(true);},disabled:function disabled(){return!copyPastePlugin.hot.getSelected();},hidden:false};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=cutItem;function cutItem(copyPastePlugin){return{key:'cut',name:'Cut',callback:function callback(){copyPastePlugin.setCopyableText();copyPastePlugin.cut(true);},disabled:function disabled(){return!copyPastePlugin.hot.getSelected();},hidden:false};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _SheetClip=__webpack_require__(133);var _SheetClip2=_interopRequireDefault(_SheetClip);var _src=__webpack_require__(11);var _unicode=__webpack_require__(16);var _element=__webpack_require__(0);var _array=__webpack_require__(2);var _number=__webpack_require__(6);var _event=__webpack_require__(7);var _plugins=__webpack_require__(5);var _textarea=__webpack_require__(237);var _textarea2=_interopRequireDefault(_textarea);var _copy=__webpack_require__(234);var _copy2=_interopRequireDefault(_copy);var _cut=__webpack_require__(235);var _cut2=_interopRequireDefault(_cut);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);__webpack_require__(298);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
_pluginHooks2.default.getSingleton().register('afterCopyLimit');_pluginHooks2.default.getSingleton().register('modifyCopyableRange');_pluginHooks2.default.getSingleton().register('beforeCut');_pluginHooks2.default.getSingleton().register('afterCut');_pluginHooks2.default.getSingleton().register('beforePaste');_pluginHooks2.default.getSingleton().register('afterPaste');_pluginHooks2.default.getSingleton().register('beforeCopy');_pluginHooks2.default.getSingleton().register('afterCopy');var ROWS_LIMIT=1000;var COLUMNS_LIMIT=1000;var privatePool=new WeakMap();var CopyPaste=function(_BasePlugin){_inherits(CopyPaste,_BasePlugin);function CopyPaste(hotInstance){_classCallCheck(this,CopyPaste);var _this=_possibleConstructorReturn(this,(CopyPaste.__proto__||Object.getPrototypeOf(CopyPaste)).call(this,hotInstance));_this.eventManager=new _eventManager2.default(_this);_this.columnsLimit=COLUMNS_LIMIT;_this.copyableRanges=[];_this.pasteMode='overwrite';_this.rowsLimit=ROWS_LIMIT;_this.textarea=void 0;privatePool.set(_this,{isTriggeredByPaste:false});return _this;}
_createClass(CopyPaste,[{key:'isEnabled',value:function isEnabled(){return!!this.hot.getSettings().copyPaste;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
var settings=this.hot.getSettings();this.textarea=_textarea2.default.getSingleton();if(_typeof(settings.copyPaste)==='object'){this.pasteMode=settings.copyPaste.pasteMode||this.pasteMode;this.rowsLimit=settings.copyPaste.rowsLimit||this.rowsLimit;this.columnsLimit=settings.copyPaste.columnsLimit||this.columnsLimit;}
this.addHook('afterContextMenuDefaultOptions',function(options){return _this2.onAfterContextMenuDefaultOptions(options);});this.addHook('beforeKeyDown',function(event){return _this2.onBeforeKeyDown(event);});this.registerEvents();_get(CopyPaste.prototype.__proto__||Object.getPrototypeOf(CopyPaste.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();_get(CopyPaste.prototype.__proto__||Object.getPrototypeOf(CopyPaste.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){if(this.textarea){this.textarea.destroy();}
_get(CopyPaste.prototype.__proto__||Object.getPrototypeOf(CopyPaste.prototype),'disablePlugin',this).call(this);}},{key:'setCopyableText',value:function setCopyableText(){var selRange=this.hot.getSelectedRange();if(!selRange){return;}
var topLeft=selRange.getTopLeftCorner();var bottomRight=selRange.getBottomRightCorner();var startRow=topLeft.row;var startCol=topLeft.col;var endRow=bottomRight.row;var endCol=bottomRight.col;var finalEndRow=Math.min(endRow,startRow+this.rowsLimit-1);var finalEndCol=Math.min(endCol,startCol+this.columnsLimit-1);this.copyableRanges.length=0;this.copyableRanges.push({startRow:startRow,startCol:startCol,endRow:finalEndRow,endCol:finalEndCol});this.copyableRanges=this.hot.runHooks('modifyCopyableRange',this.copyableRanges);var copyableData=this.getRangedCopyableData(this.copyableRanges);this.textarea.setValue(copyableData);if(endRow!==finalEndRow||endCol!==finalEndCol){this.hot.runHooks('afterCopyLimit',endRow-startRow+1,endCol-startCol+1,this.rowsLimit,this.columnsLimit);}}},{key:'getRangedCopyableData',value:function getRangedCopyableData(ranges){var _this3=this;var dataSet=[];var copyableRows=[];var copyableColumns=[];(0,_array.arrayEach)(ranges,function(range){(0,_number.rangeEach)(range.startRow,range.endRow,function(row){if(copyableRows.indexOf(row)===-1){copyableRows.push(row);}});(0,_number.rangeEach)(range.startCol,range.endCol,function(column){if(copyableColumns.indexOf(column)===-1){copyableColumns.push(column);}});});(0,_array.arrayEach)(copyableRows,function(row){var rowSet=[];(0,_array.arrayEach)(copyableColumns,function(column){rowSet.push(_this3.hot.getCopyableData(row,column));});dataSet.push(rowSet);});return _SheetClip2.default.stringify(dataSet);}},{key:'getRangedData',value:function getRangedData(ranges){var _this4=this;var dataSet=[];var copyableRows=[];var copyableColumns=[];(0,_array.arrayEach)(ranges,function(range){(0,_number.rangeEach)(range.startRow,range.endRow,function(row){if(copyableRows.indexOf(row)===-1){copyableRows.push(row);}});(0,_number.rangeEach)(range.startCol,range.endCol,function(column){if(copyableColumns.indexOf(column)===-1){copyableColumns.push(column);}});});(0,_array.arrayEach)(copyableRows,function(row){var rowSet=[];(0,_array.arrayEach)(copyableColumns,function(column){rowSet.push(_this4.hot.getCopyableData(row,column));});dataSet.push(rowSet);});return dataSet;}},{key:'copy',value:function copy(isTriggeredByClick){var rangedData=this.getRangedData(this.copyableRanges);var allowCopying=!!this.hot.runHooks('beforeCopy',rangedData,this.copyableRanges);if(allowCopying){this.textarea.setValue(_SheetClip2.default.stringify(rangedData));this.textarea.select();if(isTriggeredByClick){document.execCommand('copy');}
this.hot.runHooks('afterCopy',rangedData,this.copyableRanges);}else{this.textarea.setValue('');}}},{key:'cut',value:function cut(isTriggeredByClick){var rangedData=this.getRangedData(this.copyableRanges);var allowCuttingOut=!!this.hot.runHooks('beforeCut',rangedData,this.copyableRanges);if(allowCuttingOut){this.textarea.setValue(_SheetClip2.default.stringify(rangedData));this.hot.selection.empty();this.textarea.select();if(isTriggeredByClick){document.execCommand('cut');}
this.hot.runHooks('afterCut',rangedData,this.copyableRanges);}else{this.textarea.setValue('');}}},{key:'paste',value:function paste(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';this.textarea.setValue(value);this.onPaste();this.onInput();}},{key:'registerEvents',value:function registerEvents(){var _this5=this;this.eventManager.addEventListener(this.textarea.element,'paste',function(event){return _this5.onPaste(event);});this.eventManager.addEventListener(this.textarea.element,'input',function(event){return _this5.onInput(event);});}},{key:'triggerPaste',value:function triggerPaste(){this.textarea.select();this.onPaste();}},{key:'onPaste',value:function onPaste(){var priv=privatePool.get(this);priv.isTriggeredByPaste=true;}},{key:'onInput',value:function onInput(){var _this6=this;var priv=privatePool.get(this);if(!this.hot.isListening()||!priv.isTriggeredByPaste){return;}
priv.isTriggeredByPaste=false;var input=void 0,inputArray=void 0,selected=void 0,coordsFrom=void 0,coordsTo=void 0,cellRange=void 0,topLeftCorner=void 0,bottomRightCorner=void 0,areaStart=void 0,areaEnd=void 0;input=this.textarea.getValue();inputArray=_SheetClip2.default.parse(input);var allowPasting=!!this.hot.runHooks('beforePaste',inputArray,this.copyableRanges);if(!allowPasting){return;}
selected=this.hot.getSelected();coordsFrom=new _src.CellCoords(selected[0],selected[1]);coordsTo=new _src.CellCoords(selected[2],selected[3]);cellRange=new _src.CellRange(coordsFrom,coordsFrom,coordsTo);topLeftCorner=cellRange.getTopLeftCorner();bottomRightCorner=cellRange.getBottomRightCorner();areaStart=topLeftCorner;areaEnd=new _src.CellCoords(Math.max(bottomRightCorner.row,inputArray.length-1+topLeftCorner.row),Math.max(bottomRightCorner.col,inputArray[0].length-1+topLeftCorner.col));var isSelRowAreaCoverInputValue=coordsTo.row-coordsFrom.row>=inputArray.length-1;var isSelColAreaCoverInputValue=coordsTo.col-coordsFrom.col>=inputArray[0].length-1;this.hot.addHookOnce('afterChange',function(changes,source){var changesLength=changes?changes.length:0;if(changesLength){var offset={row:0,col:0};var highestColumnIndex=-1;(0,_array.arrayEach)(changes,function(change,index){var nextChange=changesLength>index+1?changes[index+1]:null;if(nextChange){if(!isSelRowAreaCoverInputValue){offset.row+=Math.max(nextChange[0]-change[0]-1,0);}
if(!isSelColAreaCoverInputValue&&change[1]>highestColumnIndex){highestColumnIndex=change[1];offset.col+=Math.max(nextChange[1]-change[1]-1,0);}}});_this6.hot.selectCell(areaStart.row,areaStart.col,areaEnd.row+offset.row,areaEnd.col+offset.col);}});this.hot.populateFromArray(areaStart.row,areaStart.col,inputArray,areaEnd.row,areaEnd.col,'CopyPaste.paste',this.pasteMode);this.hot.runHooks('afterPaste',inputArray,this.copyableRanges);}},{key:'onAfterContextMenuDefaultOptions',value:function onAfterContextMenuDefaultOptions(options){options.items.push({name:'---------'},(0,_copy2.default)(this),(0,_cut2.default)(this));}},{key:'onBeforeKeyDown',value:function onBeforeKeyDown(event){var _this7=this;if(!this.hot.getSelected()){return;}
if(this.hot.getActiveEditor()&&this.hot.getActiveEditor().isOpened()){return;}
if((0,_event.isImmediatePropagationStopped)(event)){return;}
if(!this.textarea.isActive()&&(0,_element.getSelectionText)()){return;}
if((0,_unicode.isCtrlKey)(event.keyCode)){if(this.hot.getSettings().fragmentSelection&&(0,_element.getSelectionText)()){return;}
this.setCopyableText();(0,_event.stopImmediatePropagation)(event);return;}
var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(ctrlDown){if(event.keyCode==_unicode.KEY_CODES.A){setTimeout(function(){_this7.setCopyableText();},0);}
if(event.keyCode==_unicode.KEY_CODES.X){this.cut();}
if(event.keyCode==_unicode.KEY_CODES.C){this.copy();}
if(event.keyCode==_unicode.KEY_CODES.V){this.triggerPaste();}}}},{key:'destroy',value:function destroy(){if(this.textarea){this.textarea.destroy();}
_get(CopyPaste.prototype.__proto__||Object.getPrototypeOf(CopyPaste.prototype),'destroy',this).call(this);}}]);return CopyPaste;}(_base2.default);(0,_plugins.registerPlugin)('CopyPaste',CopyPaste);exports.default=CopyPaste;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Textarea=function(){_createClass(Textarea,null,[{key:'getSingleton',value:function getSingleton(){globalSingleton.append();return globalSingleton;}}]);function Textarea(){_classCallCheck(this,Textarea);this.element=void 0;this.isAppended=false;this.refCounter=0;}
_createClass(Textarea,[{key:'append',value:function append(){if(this.hasBeenDestroyed()){this.create();}
this.refCounter++;if(!this.isAppended&&document.body){if(document.body){this.isAppended=true;document.body.appendChild(this.element);}}}},{key:'create',value:function create(){this.element=document.createElement('textarea');this.element.id='HandsontableCopyPaste';this.element.className='copyPaste';this.element.tabIndex=-1;this.element.autocomplete='off';this.element.wrap='off';}},{key:'deselect',value:function deselect(){if(this.element===document.activeElement){document.activeElement.blur();}}},{key:'destroy',value:function destroy(){this.refCounter--;this.refCounter=this.refCounter<0?0:this.refCounter;if(this.hasBeenDestroyed()&&this.element&&this.element.parentNode){this.element.parentNode.removeChild(this.element);this.element=null;this.isAppended=false;}}},{key:'getValue',value:function getValue(){return this.element.value;}},{key:'hasBeenDestroyed',value:function hasBeenDestroyed(){return this.refCounter<1;}},{key:'isActive',value:function isActive(){return this.element===document.activeElement;}},{key:'select',value:function select(){this.element.focus();this.element.select();}},{key:'setValue',value:function setValue(data){this.element.value=data;}}]);return Textarea;}();var globalSingleton=new Textarea();exports.default=Textarea;}),(function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _plugins=__webpack_require__(5);var _object=__webpack_require__(1);var _src=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function CustomBorders(){}
var instance;var checkEnable=function checkEnable(customBorders){if(typeof customBorders==='boolean'){if(customBorders===true){return true;}}
if((typeof customBorders==='undefined'?'undefined':_typeof(customBorders))==='object'){if(customBorders.length>0){return true;}}
return false;};var init=function init(){if(checkEnable(this.getSettings().customBorders)){if(!this.customBorders){instance=this;this.customBorders=new CustomBorders();}}};var getSettingIndex=function getSettingIndex(className){for(var i=0;i<instance.view.wt.selections.length;i++){if(instance.view.wt.selections[i].settings.className==className){return i;}}
return-1;};var insertBorderIntoSettings=function insertBorderIntoSettings(border){var coordinates={row:border.row,col:border.col};var selection=new _src.Selection(border,new _src.CellRange(coordinates,coordinates,coordinates));var index=getSettingIndex(border.className);if(index>=0){instance.view.wt.selections[index]=selection;}else{instance.view.wt.selections.push(selection);}};var prepareBorderFromCustomAdded=function prepareBorderFromCustomAdded(row,col,borderObj){var border=createEmptyBorders(row,col);border=extendDefaultBorder(border,borderObj);this.setCellMeta(row,col,'borders',border);insertBorderIntoSettings(border);};var prepareBorderFromCustomAddedRange=function prepareBorderFromCustomAddedRange(rowObj){var range=rowObj.range;for(var row=range.from.row;row<=range.to.row;row++){for(var col=range.from.col;col<=range.to.col;col++){var border=createEmptyBorders(row,col);var add=0;if(row==range.from.row){add++;if((0,_object.hasOwnProperty)(rowObj,'top')){border.top=rowObj.top;}}
if(row==range.to.row){add++;if((0,_object.hasOwnProperty)(rowObj,'bottom')){border.bottom=rowObj.bottom;}}
if(col==range.from.col){add++;if((0,_object.hasOwnProperty)(rowObj,'left')){border.left=rowObj.left;}}
if(col==range.to.col){add++;if((0,_object.hasOwnProperty)(rowObj,'right')){border.right=rowObj.right;}}
if(add>0){this.setCellMeta(row,col,'borders',border);insertBorderIntoSettings(border);}}}};var createClassName=function createClassName(row,col){return'border_row'+row+'col'+col;};var createDefaultCustomBorder=function createDefaultCustomBorder(){return{width:1,color:'#000'};};var createSingleEmptyBorder=function createSingleEmptyBorder(){return{hide:true};};var createDefaultHtBorder=function createDefaultHtBorder(){return{width:1,color:'#000',cornerVisible:false};};var createEmptyBorders=function createEmptyBorders(row,col){return{className:createClassName(row,col),border:createDefaultHtBorder(),row:row,col:col,top:createSingleEmptyBorder(),right:createSingleEmptyBorder(),bottom:createSingleEmptyBorder(),left:createSingleEmptyBorder()};};var extendDefaultBorder=function extendDefaultBorder(defaultBorder,customBorder){if((0,_object.hasOwnProperty)(customBorder,'border')){defaultBorder.border=customBorder.border;}
if((0,_object.hasOwnProperty)(customBorder,'top')){defaultBorder.top=customBorder.top;}
if((0,_object.hasOwnProperty)(customBorder,'right')){defaultBorder.right=customBorder.right;}
if((0,_object.hasOwnProperty)(customBorder,'bottom')){defaultBorder.bottom=customBorder.bottom;}
if((0,_object.hasOwnProperty)(customBorder,'left')){defaultBorder.left=customBorder.left;}
return defaultBorder;};var removeBordersFromDom=function removeBordersFromDom(borderClassName){var borders=document.querySelectorAll('.'+borderClassName);for(var i=0;i<borders.length;i++){if(borders[i]){if(borders[i].nodeName!='TD'){var parent=borders[i].parentNode;if(parent.parentNode){parent.parentNode.removeChild(parent);}}}}};var removeAllBorders=function removeAllBorders(row,col){var borderClassName=createClassName(row,col);removeBordersFromDom(borderClassName);this.removeCellMeta(row,col,'borders');};var setBorder=function setBorder(row,col,place,remove){var bordersMeta=this.getCellMeta(row,col).borders;if(!bordersMeta||bordersMeta.border==undefined){bordersMeta=createEmptyBorders(row,col);}
if(remove){bordersMeta[place]=createSingleEmptyBorder();}else{bordersMeta[place]=createDefaultCustomBorder();}
this.setCellMeta(row,col,'borders',bordersMeta);var borderClassName=createClassName(row,col);removeBordersFromDom(borderClassName);insertBorderIntoSettings(bordersMeta);this.render();};var prepareBorder=function prepareBorder(range,place,remove){if(range.from.row==range.to.row&&range.from.col==range.to.col){if(place=='noBorders'){removeAllBorders.call(this,range.from.row,range.from.col);}else{setBorder.call(this,range.from.row,range.from.col,place,remove);}}else{switch(place){case'noBorders':for(var column=range.from.col;column<=range.to.col;column++){for(var row=range.from.row;row<=range.to.row;row++){removeAllBorders.call(this,row,column);}}
break;case'top':for(var topCol=range.from.col;topCol<=range.to.col;topCol++){setBorder.call(this,range.from.row,topCol,place,remove);}
break;case'right':for(var rowRight=range.from.row;rowRight<=range.to.row;rowRight++){setBorder.call(this,rowRight,range.to.col,place);}
break;case'bottom':for(var bottomCol=range.from.col;bottomCol<=range.to.col;bottomCol++){setBorder.call(this,range.to.row,bottomCol,place);}
break;case'left':for(var rowLeft=range.from.row;rowLeft<=range.to.row;rowLeft++){setBorder.call(this,rowLeft,range.from.col,place);}
break;default:break;}}};var checkSelectionBorders=function checkSelectionBorders(hot,direction){var atLeastOneHasBorder=false;hot.getSelectedRange().forAll(function(r,c){var metaBorders=hot.getCellMeta(r,c).borders;if(metaBorders){if(direction){if(!(0,_object.hasOwnProperty)(metaBorders[direction],'hide')){atLeastOneHasBorder=true;return false;}}else{atLeastOneHasBorder=true;return false;}}});return atLeastOneHasBorder;};var markSelected=function markSelected(label){return'<span class="selected">'+String.fromCharCode(10003)+'</span>'+label;};var addBordersOptionsToContextMenu=function addBordersOptionsToContextMenu(defaultOptions){if(!this.getSettings().customBorders){return;}
defaultOptions.items.push({name:'---------'});defaultOptions.items.push({key:'borders',name:'Borders',disabled:function disabled(){return this.selection.selectedHeader.corner;},submenu:{items:[{key:'borders:top',name:function name(){var label='Top';var hasBorder=checkSelectionBorders(this,'top');if(hasBorder){label=markSelected(label);}
return label;},callback:function callback(){var hasBorder=checkSelectionBorders(this,'top');prepareBorder.call(this,this.getSelectedRange(),'top',hasBorder);}},{key:'borders:right',name:function name(){var label='Right';var hasBorder=checkSelectionBorders(this,'right');if(hasBorder){label=markSelected(label);}
return label;},callback:function callback(){var hasBorder=checkSelectionBorders(this,'right');prepareBorder.call(this,this.getSelectedRange(),'right',hasBorder);}},{key:'borders:bottom',name:function name(){var label='Bottom';var hasBorder=checkSelectionBorders(this,'bottom');if(hasBorder){label=markSelected(label);}
return label;},callback:function callback(){var hasBorder=checkSelectionBorders(this,'bottom');prepareBorder.call(this,this.getSelectedRange(),'bottom',hasBorder);}},{key:'borders:left',name:function name(){var label='Left';var hasBorder=checkSelectionBorders(this,'left');if(hasBorder){label=markSelected(label);}
return label;},callback:function callback(){var hasBorder=checkSelectionBorders(this,'left');prepareBorder.call(this,this.getSelectedRange(),'left',hasBorder);}},{key:'borders:no_borders',name:'Remove border(s)',callback:function callback(){prepareBorder.call(this,this.getSelectedRange(),'noBorders');},disabled:function disabled(){return!checkSelectionBorders(this);}}]}});};_pluginHooks2.default.getSingleton().add('beforeInit',init);_pluginHooks2.default.getSingleton().add('afterContextMenuDefaultOptions',addBordersOptionsToContextMenu);_pluginHooks2.default.getSingleton().add('afterInit',function(){var customBorders=this.getSettings().customBorders;if(customBorders){for(var i=0;i<customBorders.length;i++){if(customBorders[i].range){prepareBorderFromCustomAddedRange.call(this,customBorders[i]);}else{prepareBorderFromCustomAdded.call(this,customBorders[i].row,customBorders[i].col,customBorders[i]);}}
this.render();this.view.wt.draw(true);}});}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _plugins=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function DragToScroll(){this.boundaries=null;this.callback=null;}
DragToScroll.prototype.setBoundaries=function(boundaries){this.boundaries=boundaries;};DragToScroll.prototype.setCallback=function(callback){this.callback=callback;};DragToScroll.prototype.check=function(x,y){var diffX=0;var diffY=0;if(y<this.boundaries.top){diffY=y-this.boundaries.top;}else if(y>this.boundaries.bottom){diffY=y-this.boundaries.bottom;}
if(x<this.boundaries.left){diffX=x-this.boundaries.left;}else if(x>this.boundaries.right){diffX=x-this.boundaries.right;}
this.callback(diffX,diffY);};var dragToScroll;var instance;var setupListening=function setupListening(instance){instance.dragToScrollListening=false;var scrollHandler=instance.view.wt.wtTable.holder;dragToScroll=new DragToScroll();if(scrollHandler===window){return;}
dragToScroll.setBoundaries(scrollHandler.getBoundingClientRect());dragToScroll.setCallback(function(scrollX,scrollY){if(scrollX<0){scrollHandler.scrollLeft-=50;}else if(scrollX>0){scrollHandler.scrollLeft+=50;}
if(scrollY<0){scrollHandler.scrollTop-=20;}else if(scrollY>0){scrollHandler.scrollTop+=20;}});instance.dragToScrollListening=true;};_pluginHooks2.default.getSingleton().add('afterInit',function(){var instance=this;var eventManager=new _eventManager2.default(this);eventManager.addEventListener(document,'mouseup',function(){instance.dragToScrollListening=false;});eventManager.addEventListener(document,'mousemove',function(event){if(instance.dragToScrollListening){dragToScroll.check(event.clientX,event.clientY);}});});_pluginHooks2.default.getSingleton().add('afterDestroy',function(){new _eventManager2.default(this).clear();});_pluginHooks2.default.getSingleton().add('afterOnCellMouseDown',function(){setupListening(this);});_pluginHooks2.default.getSingleton().add('afterOnCellCornerMouseDown',function(){setupListening(this);});exports.default=DragToScroll;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=freezeColumnItem;function freezeColumnItem(manualColumnFreezePlugin){return{key:'freeze_column',name:'Freeze this column',callback:function callback(){var selectedColumn=this.getSelectedRange().from.col;manualColumnFreezePlugin.freezeColumn(selectedColumn);this.render();this.view.wt.wtOverlays.adjustElementsSize(true);},hidden:function hidden(){var selection=this.getSelectedRange();var hide=false;if(selection===void 0){hide=true;}else if(selection.from.col!==selection.to.col||selection.from.col<=this.getSettings().fixedColumnsLeft-1){hide=true;}
return hide;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=unfreezeColumnItem;function unfreezeColumnItem(manualColumnFreezePlugin){return{key:'unfreeze_column',name:'Unfreeze this column',callback:function callback(){var selectedColumn=this.getSelectedRange().from.col;manualColumnFreezePlugin.unfreezeColumn(selectedColumn);this.render();this.view.wt.wtOverlays.adjustElementsSize(true);},hidden:function hidden(){var selection=this.getSelectedRange();var hide=false;if(selection===void 0){hide=true;}else if(selection.from.col!==selection.to.col||selection.from.col>=this.getSettings().fixedColumnsLeft){hide=true;}
return hide;}};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _plugins=__webpack_require__(5);var _array=__webpack_require__(2);var _freezeColumn=__webpack_require__(240);var _freezeColumn2=_interopRequireDefault(_freezeColumn);var _unfreezeColumn=__webpack_require__(241);var _unfreezeColumn2=_interopRequireDefault(_unfreezeColumn);__webpack_require__(299);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var privatePool=new WeakMap();var ManualColumnFreeze=function(_BasePlugin){_inherits(ManualColumnFreeze,_BasePlugin);function ManualColumnFreeze(hotInstance){_classCallCheck(this,ManualColumnFreeze);var _this=_possibleConstructorReturn(this,(ManualColumnFreeze.__proto__||Object.getPrototypeOf(ManualColumnFreeze)).call(this,hotInstance));privatePool.set(_this,{moveByFreeze:false,afterFirstUse:false});_this.frozenColumnsBasePositions=[];_this.manualColumnMovePlugin=void 0;return _this;}
_createClass(ManualColumnFreeze,[{key:'isEnabled',value:function isEnabled(){return!!this.hot.getSettings().manualColumnFreeze;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.addHook('afterContextMenuDefaultOptions',function(options){return _this2.addContextMenuEntry(options);});this.addHook('afterInit',function(){return _this2.onAfterInit();});this.addHook('beforeColumnMove',function(rows,target){return _this2.onBeforeColumnMove(rows,target);});_get(ManualColumnFreeze.prototype.__proto__||Object.getPrototypeOf(ManualColumnFreeze.prototype),'enablePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){var priv=privatePool.get(this);priv.afterFirstUse=false;priv.moveByFreeze=false;_get(ManualColumnFreeze.prototype.__proto__||Object.getPrototypeOf(ManualColumnFreeze.prototype),'disablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();_get(ManualColumnFreeze.prototype.__proto__||Object.getPrototypeOf(ManualColumnFreeze.prototype),'updatePlugin',this).call(this);}},{key:'freezeColumn',value:function freezeColumn(column){var priv=privatePool.get(this);var settings=this.hot.getSettings();if(!priv.afterFirstUse){priv.afterFirstUse=true;}
if(settings.fixedColumnsLeft===this.hot.countCols()||column<=settings.fixedColumnsLeft-1){return;}
priv.moveByFreeze=true;if(column!==this.getMovePlugin().columnsMapper.getValueByIndex(column)){this.frozenColumnsBasePositions[settings.fixedColumnsLeft]=column;}
this.getMovePlugin().moveColumn(column,settings.fixedColumnsLeft++);}},{key:'unfreezeColumn',value:function unfreezeColumn(column){var priv=privatePool.get(this);var settings=this.hot.getSettings();if(!priv.afterFirstUse){priv.afterFirstUse=true;}
if(settings.fixedColumnsLeft<=0||column>settings.fixedColumnsLeft-1){return;}
var returnCol=this.getBestColumnReturnPosition(column);priv.moveByFreeze=true;settings.fixedColumnsLeft--;this.getMovePlugin().moveColumn(column,returnCol+1);}},{key:'getMovePlugin',value:function getMovePlugin(){if(!this.manualColumnMovePlugin){this.manualColumnMovePlugin=this.hot.getPlugin('manualColumnMove');}
return this.manualColumnMovePlugin;}},{key:'getBestColumnReturnPosition',value:function getBestColumnReturnPosition(column){var movePlugin=this.getMovePlugin();var settings=this.hot.getSettings();var i=settings.fixedColumnsLeft;var j=movePlugin.columnsMapper.getValueByIndex(i);var initialCol=void 0;if(this.frozenColumnsBasePositions[column]==null){initialCol=movePlugin.columnsMapper.getValueByIndex(column);while(j<initialCol){i++;j=movePlugin.columnsMapper.getValueByIndex(i);}}else{initialCol=this.frozenColumnsBasePositions[column];this.frozenColumnsBasePositions[column]=void 0;while(j<=initialCol){i++;j=movePlugin.columnsMapper.getValueByIndex(i);}
i=j;}
return i-1;}},{key:'addContextMenuEntry',value:function addContextMenuEntry(options){options.items.push({name:'---------'},(0,_freezeColumn2.default)(this),(0,_unfreezeColumn2.default)(this));}},{key:'onAfterInit',value:function onAfterInit(){if(!this.getMovePlugin().isEnabled()){this.getMovePlugin().enablePlugin();}}},{key:'onBeforeColumnMove',value:function onBeforeColumnMove(rows,target){var priv=privatePool.get(this);if(priv.afterFirstUse&&!priv.moveByFreeze){var frozenLen=this.hot.getSettings().fixedColumnsLeft;var disallowMoving=target<frozenLen;if(!disallowMoving){(0,_array.arrayEach)(rows,function(value,index,array){if(value<frozenLen){disallowMoving=true;return false;}});}
if(disallowMoving){return false;}}
if(priv.moveByFreeze){priv.moveByFreeze=false;}}},{key:'destroy',value:function destroy(){_get(ManualColumnFreeze.prototype.__proto__||Object.getPrototypeOf(ManualColumnFreeze.prototype),'destroy',this).call(this);}}]);return ManualColumnFreeze;}(_base2.default);(0,_plugins.registerPlugin)('manualColumnFreeze',ManualColumnFreeze);exports.default=ManualColumnFreeze;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _arrayMapper=__webpack_require__(150);var _arrayMapper2=_interopRequireDefault(_arrayMapper);var _array=__webpack_require__(2);var _object=__webpack_require__(1);var _number=__webpack_require__(6);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var ColumnsMapper=function(){function ColumnsMapper(manualColumnMove){_classCallCheck(this,ColumnsMapper);this.manualColumnMove=manualColumnMove;}
_createClass(ColumnsMapper,[{key:'createMap',value:function createMap(length){var _this=this;var originLength=length===void 0?this._arrayMap.length:length;this._arrayMap.length=0;(0,_number.rangeEach)(originLength-1,function(itemIndex){_this._arrayMap[itemIndex]=itemIndex;});}},{key:'destroy',value:function destroy(){this._arrayMap=null;}},{key:'moveColumn',value:function moveColumn(from,to){var indexToMove=this._arrayMap[from];this._arrayMap[from]=null;this._arrayMap.splice(to,0,indexToMove);}},{key:'clearNull',value:function clearNull(){this._arrayMap=(0,_array.arrayFilter)(this._arrayMap,function(i){return i!==null;});}}]);return ColumnsMapper;}();(0,_object.mixin)(ColumnsMapper,_arrayMapper2.default);exports.default=ColumnsMapper;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _array=__webpack_require__(2);var _element=__webpack_require__(0);var _number=__webpack_require__(6);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _plugins=__webpack_require__(5);var _columnsMapper=__webpack_require__(243);var _columnsMapper2=_interopRequireDefault(_columnsMapper);var _backlight=__webpack_require__(245);var _backlight2=_interopRequireDefault(_backlight);var _guideline=__webpack_require__(246);var _guideline2=_interopRequireDefault(_guideline);var _src=__webpack_require__(11);__webpack_require__(300);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
_pluginHooks2.default.getSingleton().register('beforeColumnMove');_pluginHooks2.default.getSingleton().register('afterColumnMove');_pluginHooks2.default.getSingleton().register('unmodifyCol');var privatePool=new WeakMap();var CSS_PLUGIN='ht__manualColumnMove';var CSS_SHOW_UI='show-ui';var CSS_ON_MOVING='on-moving--columns';var CSS_AFTER_SELECTION='after-selection--columns';var ManualColumnMove=function(_BasePlugin){_inherits(ManualColumnMove,_BasePlugin);function ManualColumnMove(hotInstance){_classCallCheck(this,ManualColumnMove);var _this=_possibleConstructorReturn(this,(ManualColumnMove.__proto__||Object.getPrototypeOf(ManualColumnMove)).call(this,hotInstance));privatePool.set(_this,{columnsToMove:[],countCols:0,fixedColumns:0,pressed:void 0,disallowMoving:void 0,target:{eventPageX:void 0,coords:void 0,TD:void 0,col:void 0}});_this.removedColumns=[];_this.columnsMapper=new _columnsMapper2.default(_this);_this.eventManager=new _eventManager2.default(_this);_this.backlight=new _backlight2.default(hotInstance);_this.guideline=new _guideline2.default(hotInstance);return _this;}
_createClass(ManualColumnMove,[{key:'isEnabled',value:function isEnabled(){return!!this.hot.getSettings().manualColumnMove;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.addHook('beforeOnCellMouseDown',function(event,coords,TD,blockCalculations){return _this2.onBeforeOnCellMouseDown(event,coords,TD,blockCalculations);});this.addHook('beforeOnCellMouseOver',function(event,coords,TD,blockCalculations){return _this2.onBeforeOnCellMouseOver(event,coords,TD,blockCalculations);});this.addHook('afterScrollVertically',function(){return _this2.onAfterScrollVertically();});this.addHook('modifyCol',function(row,source){return _this2.onModifyCol(row,source);});this.addHook('beforeRemoveCol',function(index,amount){return _this2.onBeforeRemoveCol(index,amount);});this.addHook('afterRemoveCol',function(index,amount){return _this2.onAfterRemoveCol(index,amount);});this.addHook('afterCreateCol',function(index,amount){return _this2.onAfterCreateCol(index,amount);});this.addHook('afterLoadData',function(firstTime){return _this2.onAfterLoadData(firstTime);});this.addHook('unmodifyCol',function(column){return _this2.onUnmodifyCol(column);});this.registerEvents();(0,_element.addClass)(this.hot.rootElement,CSS_PLUGIN);_get(ManualColumnMove.prototype.__proto__||Object.getPrototypeOf(ManualColumnMove.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();this.onAfterPluginsInitialized();_get(ManualColumnMove.prototype.__proto__||Object.getPrototypeOf(ManualColumnMove.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){var pluginSettings=this.hot.getSettings().manualColumnMove;if(Array.isArray(pluginSettings)){this.columnsMapper.clearMap();}
(0,_element.removeClass)(this.hot.rootElement,CSS_PLUGIN);this.unregisterEvents();this.backlight.destroy();this.guideline.destroy();_get(ManualColumnMove.prototype.__proto__||Object.getPrototypeOf(ManualColumnMove.prototype),'disablePlugin',this).call(this);}},{key:'moveColumn',value:function moveColumn(column,target){this.moveColumns([column],target);}},{key:'moveColumns',value:function moveColumns(columns,target){var _this3=this;var priv=privatePool.get(this);var beforeColumnHook=this.hot.runHooks('beforeColumnMove',columns,target);priv.disallowMoving=!beforeColumnHook;if(beforeColumnHook!==false){(0,_array.arrayEach)(columns,function(column,index,array){array[index]=_this3.columnsMapper.getValueByIndex(column);});(0,_array.arrayEach)(columns,function(column,index){var actualPosition=_this3.columnsMapper.getIndexByValue(column);if(actualPosition!==target){_this3.columnsMapper.moveColumn(actualPosition,target+index);}});this.columnsMapper.clearNull();}
this.hot.runHooks('afterColumnMove',columns,target);}},{key:'changeSelection',value:function changeSelection(startColumn,endColumn){var selection=this.hot.selection;var lastRowIndex=this.hot.countRows()-1;selection.setRangeStartOnly(new _src.CellCoords(0,startColumn));selection.setRangeEnd(new _src.CellCoords(lastRowIndex,endColumn),false);}},{key:'getColumnsWidth',value:function getColumnsWidth(from,to){var width=0;for(var i=from;i<to;i++){var columnWidth=0;if(i<0){columnWidth=this.hot.view.wt.wtTable.getColumnWidth(i)||0;}else{columnWidth=this.hot.view.wt.wtTable.getStretchedColumnWidth(i)||0;}
width+=columnWidth;}
return width;}},{key:'initialSettings',value:function initialSettings(){var pluginSettings=this.hot.getSettings().manualColumnMove;if(Array.isArray(pluginSettings)){this.moveColumns(pluginSettings,0);}else if(pluginSettings!==void 0){this.persistentStateLoad();}}},{key:'isFixedColumnsLeft',value:function isFixedColumnsLeft(column){return column<this.hot.getSettings().fixedColumnsLeft;}},{key:'persistentStateSave',value:function persistentStateSave(){this.hot.runHooks('persistentStateSave','manualColumnMove',this.columnsMapper._arrayMap);}},{key:'persistentStateLoad',value:function persistentStateLoad(){var storedState={};this.hot.runHooks('persistentStateLoad','manualColumnMove',storedState);if(storedState.value){this.columnsMapper._arrayMap=storedState.value;}}},{key:'prepareColumnsToMoving',value:function prepareColumnsToMoving(start,end){var selectedColumns=[];(0,_number.rangeEach)(start,end,function(i){selectedColumns.push(i);});return selectedColumns;}},{key:'refreshPositions',value:function refreshPositions(){var priv=privatePool.get(this);var firstVisible=this.hot.view.wt.wtTable.getFirstVisibleColumn();var lastVisible=this.hot.view.wt.wtTable.getLastVisibleColumn();var wtTable=this.hot.view.wt.wtTable;var scrollableElement=this.hot.view.wt.wtOverlays.scrollableElement;var scrollLeft=typeof scrollableElement.scrollX==='number'?scrollableElement.scrollX:scrollableElement.scrollLeft;var tdOffsetLeft=this.hot.view.THEAD.offsetLeft+this.getColumnsWidth(0,priv.coordsColumn);var mouseOffsetLeft=priv.target.eventPageX-(priv.rootElementOffset-(scrollableElement.scrollX===void 0?scrollLeft:0));var hiderWidth=wtTable.hider.offsetWidth;var tbodyOffsetLeft=wtTable.TBODY.offsetLeft;var backlightElemMarginLeft=this.backlight.getOffset().left;var backlightElemWidth=this.backlight.getSize().width;var rowHeaderWidth=0;if(priv.rootElementOffset+wtTable.holder.offsetWidth+scrollLeft<priv.target.eventPageX){if(priv.coordsColumn<priv.countCols){priv.coordsColumn++;}}
if(priv.hasRowHeaders){rowHeaderWidth=this.hot.view.wt.wtOverlays.leftOverlay.clone.wtTable.getColumnHeader(-1).offsetWidth;}
if(this.isFixedColumnsLeft(priv.coordsColumn)){tdOffsetLeft+=scrollLeft;}
tdOffsetLeft+=rowHeaderWidth;if(priv.coordsColumn<0){if(priv.fixedColumns>0){priv.target.col=0;}else{priv.target.col=firstVisible>0?firstVisible-1:firstVisible;}}else if(priv.target.TD.offsetWidth/2+tdOffsetLeft<=mouseOffsetLeft){var newCoordsCol=priv.coordsColumn>=priv.countCols?priv.countCols-1:priv.coordsColumn;priv.target.col=newCoordsCol+1;tdOffsetLeft+=priv.target.TD.offsetWidth;if(priv.target.col>lastVisible){this.hot.scrollViewportTo(void 0,lastVisible+1,void 0,true);}}else{priv.target.col=priv.coordsColumn;if(priv.target.col<=firstVisible&&priv.target.col>=priv.fixedColumns){this.hot.scrollViewportTo(void 0,firstVisible-1);}}
if(priv.target.col<=firstVisible&&priv.target.col>=priv.fixedColumns){this.hot.scrollViewportTo(void 0,firstVisible-1);}
var backlightLeft=mouseOffsetLeft;var guidelineLeft=tdOffsetLeft;if(mouseOffsetLeft+backlightElemWidth+backlightElemMarginLeft>=hiderWidth){backlightLeft=hiderWidth-backlightElemWidth-backlightElemMarginLeft;}else if(mouseOffsetLeft+backlightElemMarginLeft<tbodyOffsetLeft+rowHeaderWidth){backlightLeft=tbodyOffsetLeft+rowHeaderWidth+Math.abs(backlightElemMarginLeft);}
if(tdOffsetLeft>=hiderWidth-1){guidelineLeft=hiderWidth-1;}else if(guidelineLeft===0){guidelineLeft=1;}else if(scrollableElement.scrollX!==void 0&&priv.coordsColumn<priv.fixedColumns){guidelineLeft-=priv.rootElementOffset<=scrollableElement.scrollX?priv.rootElementOffset:0;}
this.backlight.setPosition(null,backlightLeft);this.guideline.setPosition(null,guidelineLeft);}},{key:'updateColumnsMapper',value:function updateColumnsMapper(){var countCols=this.hot.countSourceCols();var columnsMapperLen=this.columnsMapper._arrayMap.length;if(columnsMapperLen===0){this.columnsMapper.createMap(countCols||this.hot.getSettings().startCols);}else if(columnsMapperLen<countCols){var diff=countCols-columnsMapperLen;this.columnsMapper.insertItems(columnsMapperLen,diff);}else if(columnsMapperLen>countCols){var maxIndex=countCols-1;var columnsToRemove=[];(0,_array.arrayEach)(this.columnsMapper._arrayMap,function(value,index,array){if(value>maxIndex){columnsToRemove.push(index);}});this.columnsMapper.removeItems(columnsToRemove);}}},{key:'registerEvents',value:function registerEvents(){var _this4=this;this.eventManager.addEventListener(document.documentElement,'mousemove',function(event){return _this4.onMouseMove(event);});this.eventManager.addEventListener(document.documentElement,'mouseup',function(){return _this4.onMouseUp();});}},{key:'unregisterEvents',value:function unregisterEvents(){this.eventManager.clear();}},{key:'onBeforeOnCellMouseDown',value:function onBeforeOnCellMouseDown(event,coords,TD,blockCalculations){var wtTable=this.hot.view.wt.wtTable;var isHeaderSelection=this.hot.selection.selectedHeader.cols;var selection=this.hot.getSelectedRange();var priv=privatePool.get(this);var isSortingElement=event.realTarget.className.indexOf('columnSorting')>-1;if(!selection||!isHeaderSelection||priv.pressed||event.button!==0||isSortingElement){priv.pressed=false;priv.columnsToMove.length=0;(0,_element.removeClass)(this.hot.rootElement,[CSS_ON_MOVING,CSS_SHOW_UI]);return;}
var guidelineIsNotReady=this.guideline.isBuilt()&&!this.guideline.isAppended();var backlightIsNotReady=this.backlight.isBuilt()&&!this.backlight.isAppended();if(guidelineIsNotReady&&backlightIsNotReady){this.guideline.appendTo(wtTable.hider);this.backlight.appendTo(wtTable.hider);}
var from=selection.from,to=selection.to;var start=Math.min(from.col,to.col);var end=Math.max(from.col,to.col);if(coords.row<0&&coords.col>=start&&coords.col<=end){blockCalculations.column=true;priv.pressed=true;priv.target.eventPageX=event.pageX;priv.coordsColumn=coords.col;priv.target.TD=TD;priv.target.col=coords.col;priv.columnsToMove=this.prepareColumnsToMoving(start,end);priv.hasRowHeaders=!!this.hot.getSettings().rowHeaders;priv.countCols=this.hot.countCols();priv.fixedColumns=this.hot.getSettings().fixedColumnsLeft;priv.rootElementOffset=(0,_element.offset)(this.hot.rootElement).left;var countColumnsFrom=priv.hasRowHeaders?-1:0;var topPos=wtTable.holder.scrollTop+wtTable.getColumnHeaderHeight(0)+1;var fixedColumns=coords.col<priv.fixedColumns;var scrollableElement=this.hot.view.wt.wtOverlays.scrollableElement;var wrapperIsWindow=scrollableElement.scrollX?scrollableElement.scrollX-priv.rootElementOffset:0;var mouseOffset=event.layerX-(fixedColumns?wrapperIsWindow:0);var leftOffset=Math.abs(this.getColumnsWidth(start,coords.col)+mouseOffset);this.backlight.setPosition(topPos,this.getColumnsWidth(countColumnsFrom,start)+leftOffset);this.backlight.setSize(this.getColumnsWidth(start,end+1),wtTable.hider.offsetHeight-topPos);this.backlight.setOffset(null,leftOffset*-1);(0,_element.addClass)(this.hot.rootElement,CSS_ON_MOVING);}else{(0,_element.removeClass)(this.hot.rootElement,CSS_AFTER_SELECTION);priv.pressed=false;priv.columnsToMove.length=0;}}},{key:'onMouseMove',value:function onMouseMove(event){var priv=privatePool.get(this);if(!priv.pressed){return;}
if(event.realTarget===this.backlight.element){var width=this.backlight.getSize().width;this.backlight.setSize(0);setTimeout(function(){this.backlight.setPosition(width);});}
priv.target.eventPageX=event.pageX;this.refreshPositions();}},{key:'onBeforeOnCellMouseOver',value:function onBeforeOnCellMouseOver(event,coords,TD,blockCalculations){var selectedRange=this.hot.getSelectedRange();var priv=privatePool.get(this);if(!selectedRange||!priv.pressed){return;}
if(priv.columnsToMove.indexOf(coords.col)>-1){(0,_element.removeClass)(this.hot.rootElement,CSS_SHOW_UI);}else{(0,_element.addClass)(this.hot.rootElement,CSS_SHOW_UI);}
blockCalculations.row=true;blockCalculations.column=true;blockCalculations.cell=true;priv.coordsColumn=coords.col;priv.target.TD=TD;}},{key:'onMouseUp',value:function onMouseUp(){var priv=privatePool.get(this);priv.coordsColumn=void 0;priv.pressed=false;priv.backlightWidth=0;(0,_element.removeClass)(this.hot.rootElement,[CSS_ON_MOVING,CSS_SHOW_UI,CSS_AFTER_SELECTION]);if(this.hot.selection.selectedHeader.cols){(0,_element.addClass)(this.hot.rootElement,CSS_AFTER_SELECTION);}
if(priv.columnsToMove.length<1||priv.target.col===void 0||priv.columnsToMove.indexOf(priv.target.col)>-1){return;}
this.moveColumns(priv.columnsToMove,priv.target.col);this.persistentStateSave();this.hot.render();this.hot.view.wt.wtOverlays.adjustElementsSize(true);if(!priv.disallowMoving){var selectionStart=this.columnsMapper.getIndexByValue(priv.columnsToMove[0]);var selectionEnd=this.columnsMapper.getIndexByValue(priv.columnsToMove[priv.columnsToMove.length-1]);this.changeSelection(selectionStart,selectionEnd);}
priv.columnsToMove.length=0;}},{key:'onAfterScrollVertically',value:function onAfterScrollVertically(){var wtTable=this.hot.view.wt.wtTable;var headerHeight=wtTable.getColumnHeaderHeight(0)+1;var scrollTop=wtTable.holder.scrollTop;var posTop=headerHeight+scrollTop;this.backlight.setPosition(posTop);this.backlight.setSize(null,wtTable.hider.offsetHeight-posTop);}},{key:'onAfterCreateCol',value:function onAfterCreateCol(index,amount){this.columnsMapper.shiftItems(index,amount);}},{key:'onBeforeRemoveCol',value:function onBeforeRemoveCol(index,amount){var _this5=this;this.removedColumns.length=0;if(index!==false){(0,_number.rangeEach)(index,index+amount-1,function(removedIndex){_this5.removedColumns.push(_this5.hot.runHooks('modifyCol',removedIndex,_this5.pluginName));});}}},{key:'onAfterRemoveCol',value:function onAfterRemoveCol(index,amount){this.columnsMapper.unshiftItems(this.removedColumns);}},{key:'onAfterLoadData',value:function onAfterLoadData(firstTime){this.updateColumnsMapper();}},{key:'onModifyCol',value:function onModifyCol(column,source){if(source!==this.pluginName){var columnInMapper=this.columnsMapper.getValueByIndex(column);column=columnInMapper===null?column:columnInMapper;}
return column;}},{key:'onUnmodifyCol',value:function onUnmodifyCol(column){var indexInMapper=this.columnsMapper.getIndexByValue(column);return indexInMapper===null?column:indexInMapper;}},{key:'onAfterPluginsInitialized',value:function onAfterPluginsInitialized(){this.updateColumnsMapper();this.initialSettings();this.backlight.build();this.guideline.build();}},{key:'destroy',value:function destroy(){this.backlight.destroy();this.guideline.destroy();_get(ManualColumnMove.prototype.__proto__||Object.getPrototypeOf(ManualColumnMove.prototype),'destroy',this).call(this);}}]);return ManualColumnMove;}(_base2.default);(0,_plugins.registerPlugin)('ManualColumnMove',ManualColumnMove);exports.default=ManualColumnMove;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(151);var _base2=_interopRequireDefault(_base);var _element=__webpack_require__(0);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var CSS_CLASSNAME='ht__manualColumnMove--backlight';var BacklightUI=function(_BaseUI){_inherits(BacklightUI,_BaseUI);function BacklightUI(){_classCallCheck(this,BacklightUI);return _possibleConstructorReturn(this,(BacklightUI.__proto__||Object.getPrototypeOf(BacklightUI)).apply(this,arguments));}
_createClass(BacklightUI,[{key:'build',value:function build(){_get(BacklightUI.prototype.__proto__||Object.getPrototypeOf(BacklightUI.prototype),'build',this).call(this);(0,_element.addClass)(this._element,CSS_CLASSNAME);}}]);return BacklightUI;}(_base2.default);exports.default=BacklightUI;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(151);var _base2=_interopRequireDefault(_base);var _element=__webpack_require__(0);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var CSS_CLASSNAME='ht__manualColumnMove--guideline';var GuidelineUI=function(_BaseUI){_inherits(GuidelineUI,_BaseUI);function GuidelineUI(){_classCallCheck(this,GuidelineUI);return _possibleConstructorReturn(this,(GuidelineUI.__proto__||Object.getPrototypeOf(GuidelineUI)).apply(this,arguments));}
_createClass(GuidelineUI,[{key:'build',value:function build(){_get(GuidelineUI.prototype.__proto__||Object.getPrototypeOf(GuidelineUI.prototype),'build',this).call(this);(0,_element.addClass)(this._element,CSS_CLASSNAME);}}]);return GuidelineUI;}(_base2.default);exports.default=GuidelineUI;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _element=__webpack_require__(0);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _event=__webpack_require__(7);var _array=__webpack_require__(2);var _number=__webpack_require__(6);var _plugins=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var ManualColumnResize=function(_BasePlugin){_inherits(ManualColumnResize,_BasePlugin);function ManualColumnResize(hotInstance){_classCallCheck(this,ManualColumnResize);var _this=_possibleConstructorReturn(this,(ManualColumnResize.__proto__||Object.getPrototypeOf(ManualColumnResize)).call(this,hotInstance));_this.currentTH=null;_this.currentCol=null;_this.selectedCols=[];_this.currentWidth=null;_this.newSize=null;_this.startY=null;_this.startWidth=null;_this.startOffset=null;_this.handle=document.createElement('DIV');_this.guide=document.createElement('DIV');_this.eventManager=new _eventManager2.default(_this);_this.pressed=null;_this.dblclick=0;_this.autoresizeTimeout=null;_this.manualColumnWidths=[];(0,_element.addClass)(_this.handle,'manualColumnResizer');(0,_element.addClass)(_this.guide,'manualColumnResizerGuide');return _this;}
_createClass(ManualColumnResize,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().manualColumnResize;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.manualColumnWidths=[];var initialColumnWidth=this.hot.getSettings().manualColumnResize;var loadedManualColumnWidths=this.loadManualColumnWidths();this.addHook('modifyColWidth',function(width,col){return _this2.onModifyColWidth(width,col);});this.addHook('beforeStretchingColumnWidth',function(stretchedWidth,column){return _this2.onBeforeStretchingColumnWidth(stretchedWidth,column);});this.addHook('beforeColumnResize',function(currentColumn,newSize,isDoubleClick){return _this2.onBeforeColumnResize(currentColumn,newSize,isDoubleClick);});if(typeof loadedManualColumnWidths!='undefined'){this.manualColumnWidths=loadedManualColumnWidths;}else if(Array.isArray(initialColumnWidth)){this.manualColumnWidths=initialColumnWidth;}else{this.manualColumnWidths=[];}
this.bindEvents();_get(ManualColumnResize.prototype.__proto__||Object.getPrototypeOf(ManualColumnResize.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){var initialColumnWidth=this.hot.getSettings().manualColumnResize;if(Array.isArray(initialColumnWidth)){this.manualColumnWidths=initialColumnWidth;}else if(!initialColumnWidth){this.manualColumnWidths=[];}}},{key:'disablePlugin',value:function disablePlugin(){_get(ManualColumnResize.prototype.__proto__||Object.getPrototypeOf(ManualColumnResize.prototype),'disablePlugin',this).call(this);}},{key:'saveManualColumnWidths',value:function saveManualColumnWidths(){this.hot.runHooks('persistentStateSave','manualColumnWidths',this.manualColumnWidths);}},{key:'loadManualColumnWidths',value:function loadManualColumnWidths(){var storedState={};this.hot.runHooks('persistentStateLoad','manualColumnWidths',storedState);return storedState.value;}},{key:'setupHandlePosition',value:function setupHandlePosition(TH){var _this3=this;if(!TH.parentNode){return false;}
this.currentTH=TH;var col=this.hot.view.wt.wtTable.getCoords(TH).col;var headerHeight=(0,_element.outerHeight)(this.currentTH);if(col>=0){var box=this.currentTH.getBoundingClientRect();this.currentCol=col;this.selectedCols=[];if(this.hot.selection.isSelected()&&this.hot.selection.selectedHeader.cols){var _hot$getSelectedRange=this.hot.getSelectedRange(),from=_hot$getSelectedRange.from,to=_hot$getSelectedRange.to;var start=from.col;var end=to.col;if(start>=end){start=to.col;end=from.col;}
if(this.currentCol>=start&&this.currentCol<=end){(0,_number.rangeEach)(start,end,function(i){return _this3.selectedCols.push(i);});}else{this.selectedCols.push(this.currentCol);}}else{this.selectedCols.push(this.currentCol);}
this.startOffset=box.left-6;this.startWidth=parseInt(box.width,10);this.handle.style.top=box.top+'px';this.handle.style.left=this.startOffset+this.startWidth+'px';this.handle.style.height=headerHeight+'px';this.hot.rootElement.appendChild(this.handle);}}},{key:'refreshHandlePosition',value:function refreshHandlePosition(){this.handle.style.left=this.startOffset+this.currentWidth+'px';}},{key:'setupGuidePosition',value:function setupGuidePosition(){var handleHeight=parseInt((0,_element.outerHeight)(this.handle),10);var handleBottomPosition=parseInt(this.handle.style.top,10)+handleHeight;var maximumVisibleElementHeight=parseInt(this.hot.view.maximumVisibleElementHeight(0),10);(0,_element.addClass)(this.handle,'active');(0,_element.addClass)(this.guide,'active');this.guide.style.top=handleBottomPosition+'px';this.guide.style.left=this.handle.style.left;this.guide.style.height=maximumVisibleElementHeight-handleHeight+'px';this.hot.rootElement.appendChild(this.guide);}},{key:'refreshGuidePosition',value:function refreshGuidePosition(){this.guide.style.left=this.handle.style.left;}},{key:'hideHandleAndGuide',value:function hideHandleAndGuide(){(0,_element.removeClass)(this.handle,'active');(0,_element.removeClass)(this.guide,'active');}},{key:'checkIfColumnHeader',value:function checkIfColumnHeader(element){if(element!=this.hot.rootElement){var parent=element.parentNode;if(parent.tagName==='THEAD'){return true;}
return this.checkIfColumnHeader(parent);}
return false;}},{key:'getTHFromTargetElement',value:function getTHFromTargetElement(element){if(element.tagName!='TABLE'){if(element.tagName=='TH'){return element;}
return this.getTHFromTargetElement(element.parentNode);}
return null;}},{key:'onMouseOver',value:function onMouseOver(event){if(this.checkIfColumnHeader(event.target)){var th=this.getTHFromTargetElement(event.target);if(!th){return;}
var colspan=th.getAttribute('colspan');if(th&&(colspan===null||colspan===1)){if(!this.pressed){this.setupHandlePosition(th);}}}}},{key:'afterMouseDownTimeout',value:function afterMouseDownTimeout(){var _this4=this;var render=function render(){_this4.hot.forceFullRender=true;_this4.hot.view.render();_this4.hot.view.wt.wtOverlays.adjustElementsSize(true);};var resize=function resize(selectedCol,forceRender){var hookNewSize=_this4.hot.runHooks('beforeColumnResize',selectedCol,_this4.newSize,true);if(hookNewSize!==void 0){_this4.newSize=hookNewSize;}
if(_this4.hot.getSettings().stretchH==='all'){_this4.clearManualSize(selectedCol);}else{_this4.setManualSize(selectedCol,_this4.newSize);}
if(forceRender){render();}
_this4.saveManualColumnWidths();_this4.hot.runHooks('afterColumnResize',selectedCol,_this4.newSize,true);};if(this.dblclick>=2){var selectedColsLength=this.selectedCols.length;if(selectedColsLength>1){(0,_array.arrayEach)(this.selectedCols,function(selectedCol){resize(selectedCol);});render();}else{(0,_array.arrayEach)(this.selectedCols,function(selectedCol){resize(selectedCol,true);});}}
this.dblclick=0;this.autoresizeTimeout=null;}},{key:'onMouseDown',value:function onMouseDown(event){var _this5=this;if((0,_element.hasClass)(event.target,'manualColumnResizer')){this.setupGuidePosition();this.pressed=this.hot;if(this.autoresizeTimeout===null){this.autoresizeTimeout=setTimeout(function(){return _this5.afterMouseDownTimeout();},500);this.hot._registerTimeout(this.autoresizeTimeout);}
this.dblclick++;this.startX=(0,_event.pageX)(event);this.newSize=this.startWidth;}}},{key:'onMouseMove',value:function onMouseMove(event){var _this6=this;if(this.pressed){this.currentWidth=this.startWidth+((0,_event.pageX)(event)-this.startX);(0,_array.arrayEach)(this.selectedCols,function(selectedCol){_this6.newSize=_this6.setManualSize(selectedCol,_this6.currentWidth);});this.refreshHandlePosition();this.refreshGuidePosition();}}},{key:'onMouseUp',value:function onMouseUp(event){var _this7=this;var render=function render(){_this7.hot.forceFullRender=true;_this7.hot.view.render();_this7.hot.view.wt.wtOverlays.adjustElementsSize(true);};var resize=function resize(selectedCol,forceRender){_this7.hot.runHooks('beforeColumnResize',selectedCol,_this7.newSize);if(forceRender){render();}
_this7.saveManualColumnWidths();_this7.hot.runHooks('afterColumnResize',selectedCol,_this7.newSize);};if(this.pressed){this.hideHandleAndGuide();this.pressed=false;if(this.newSize!=this.startWidth){var selectedColsLength=this.selectedCols.length;if(selectedColsLength>1){(0,_array.arrayEach)(this.selectedCols,function(selectedCol){resize(selectedCol);});render();}else{(0,_array.arrayEach)(this.selectedCols,function(selectedCol){resize(selectedCol,true);});}}
this.setupHandlePosition(this.currentTH);}}},{key:'bindEvents',value:function bindEvents(){var _this8=this;this.eventManager.addEventListener(this.hot.rootElement,'mouseover',function(e){return _this8.onMouseOver(e);});this.eventManager.addEventListener(this.hot.rootElement,'mousedown',function(e){return _this8.onMouseDown(e);});this.eventManager.addEventListener(window,'mousemove',function(e){return _this8.onMouseMove(e);});this.eventManager.addEventListener(window,'mouseup',function(e){return _this8.onMouseUp(e);});}},{key:'setManualSize',value:function setManualSize(column,width){width=Math.max(width,20);column=this.hot.runHooks('modifyCol',column);this.manualColumnWidths[column]=width;return width;}},{key:'clearManualSize',value:function clearManualSize(column){column=this.hot.runHooks('modifyCol',column);this.manualColumnWidths[column]=void 0;}},{key:'onModifyColWidth',value:function onModifyColWidth(width,column){if(this.enabled){column=this.hot.runHooks('modifyCol',column);if(this.hot.getSettings().manualColumnResize&&this.manualColumnWidths[column]){return this.manualColumnWidths[column];}}
return width;}},{key:'onBeforeStretchingColumnWidth',value:function onBeforeStretchingColumnWidth(stretchedWidth,column){var width=this.manualColumnWidths[column];if(width===void 0){width=stretchedWidth;}
return width;}},{key:'onBeforeColumnResize',value:function onBeforeColumnResize(){this.hot.view.wt.wtViewport.hasOversizedColumnHeadersMarked={};}}]);return ManualColumnResize;}(_base2.default);(0,_plugins.registerPlugin)('manualColumnResize',ManualColumnResize);exports.default=ManualColumnResize;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _array=__webpack_require__(2);var _element=__webpack_require__(0);var _number=__webpack_require__(6);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _plugins=__webpack_require__(5);var _rowsMapper=__webpack_require__(249);var _rowsMapper2=_interopRequireDefault(_rowsMapper);var _backlight=__webpack_require__(250);var _backlight2=_interopRequireDefault(_backlight);var _guideline=__webpack_require__(251);var _guideline2=_interopRequireDefault(_guideline);var _src=__webpack_require__(11);__webpack_require__(301);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
_pluginHooks2.default.getSingleton().register('beforeRowMove');_pluginHooks2.default.getSingleton().register('afterRowMove');_pluginHooks2.default.getSingleton().register('unmodifyRow');var privatePool=new WeakMap();var CSS_PLUGIN='ht__manualRowMove';var CSS_SHOW_UI='show-ui';var CSS_ON_MOVING='on-moving--rows';var CSS_AFTER_SELECTION='after-selection--rows';var ManualRowMove=function(_BasePlugin){_inherits(ManualRowMove,_BasePlugin);function ManualRowMove(hotInstance){_classCallCheck(this,ManualRowMove);var _this=_possibleConstructorReturn(this,(ManualRowMove.__proto__||Object.getPrototypeOf(ManualRowMove)).call(this,hotInstance));privatePool.set(_this,{rowsToMove:[],pressed:void 0,disallowMoving:void 0,target:{eventPageY:void 0,coords:void 0,TD:void 0,row:void 0}});_this.removedRows=[];_this.rowsMapper=new _rowsMapper2.default(_this);_this.eventManager=new _eventManager2.default(_this);_this.backlight=new _backlight2.default(hotInstance);_this.guideline=new _guideline2.default(hotInstance);return _this;}
_createClass(ManualRowMove,[{key:'isEnabled',value:function isEnabled(){return!!this.hot.getSettings().manualRowMove;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.addHook('beforeOnCellMouseDown',function(event,coords,TD,blockCalculations){return _this2.onBeforeOnCellMouseDown(event,coords,TD,blockCalculations);});this.addHook('beforeOnCellMouseOver',function(event,coords,TD,blockCalculations){return _this2.onBeforeOnCellMouseOver(event,coords,TD,blockCalculations);});this.addHook('afterScrollHorizontally',function(){return _this2.onAfterScrollHorizontally();});this.addHook('modifyRow',function(row,source){return _this2.onModifyRow(row,source);});this.addHook('beforeRemoveRow',function(index,amount){return _this2.onBeforeRemoveRow(index,amount);});this.addHook('afterRemoveRow',function(index,amount){return _this2.onAfterRemoveRow(index,amount);});this.addHook('afterCreateRow',function(index,amount){return _this2.onAfterCreateRow(index,amount);});this.addHook('afterLoadData',function(firstTime){return _this2.onAfterLoadData(firstTime);});this.addHook('beforeColumnSort',function(column,order){return _this2.onBeforeColumnSort(column,order);});this.addHook('unmodifyRow',function(row){return _this2.onUnmodifyRow(row);});this.registerEvents();(0,_element.addClass)(this.hot.rootElement,CSS_PLUGIN);_get(ManualRowMove.prototype.__proto__||Object.getPrototypeOf(ManualRowMove.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.disablePlugin();this.enablePlugin();this.onAfterPluginsInitialized();_get(ManualRowMove.prototype.__proto__||Object.getPrototypeOf(ManualRowMove.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){var pluginSettings=this.hot.getSettings().manualRowMove;if(Array.isArray(pluginSettings)){this.rowsMapper.clearMap();}
(0,_element.removeClass)(this.hot.rootElement,CSS_PLUGIN);this.unregisterEvents();this.backlight.destroy();this.guideline.destroy();_get(ManualRowMove.prototype.__proto__||Object.getPrototypeOf(ManualRowMove.prototype),'disablePlugin',this).call(this);}},{key:'moveRow',value:function moveRow(row,target){this.moveRows([row],target);}},{key:'moveRows',value:function moveRows(rows,target){var _this3=this;var priv=privatePool.get(this);var beforeMoveHook=this.hot.runHooks('beforeRowMove',rows,target);priv.disallowMoving=beforeMoveHook===false;if(!priv.disallowMoving){(0,_array.arrayEach)(rows,function(row,index,array){array[index]=_this3.rowsMapper.getValueByIndex(row);});(0,_array.arrayEach)(rows,function(row,index){var actualPosition=_this3.rowsMapper.getIndexByValue(row);if(actualPosition!==target){_this3.rowsMapper.moveRow(actualPosition,target+index);}});this.rowsMapper.clearNull();}
this.hot.runHooks('afterRowMove',rows,target);}},{key:'changeSelection',value:function changeSelection(startRow,endRow){var selection=this.hot.selection;var lastColIndex=this.hot.countCols()-1;selection.setRangeStartOnly(new _src.CellCoords(startRow,0));selection.setRangeEnd(new _src.CellCoords(endRow,lastColIndex),false);}},{key:'getRowsHeight',value:function getRowsHeight(from,to){var height=0;for(var i=from;i<to;i++){var rowHeight=this.hot.view.wt.wtTable.getRowHeight(i)||23;height+=rowHeight;}
return height;}},{key:'initialSettings',value:function initialSettings(){var pluginSettings=this.hot.getSettings().manualRowMove;if(Array.isArray(pluginSettings)){this.moveRows(pluginSettings,0);}else if(pluginSettings!==void 0){var persistentState=this.persistentStateLoad();if(persistentState.length){this.moveRows(persistentState,0);}}}},{key:'isFixedRowTop',value:function isFixedRowTop(row){return row<this.hot.getSettings().fixedRowsTop;}},{key:'isFixedRowBottom',value:function isFixedRowBottom(row){return row>this.hot.getSettings().fixedRowsBottom;}},{key:'persistentStateSave',value:function persistentStateSave(){this.hot.runHooks('persistentStateSave','manualRowMove',this.rowsMapper._arrayMap);}},{key:'persistentStateLoad',value:function persistentStateLoad(){var storedState={};this.hot.runHooks('persistentStateLoad','manualRowMove',storedState);return storedState.value?storedState.value:[];}},{key:'prepareRowsToMoving',value:function prepareRowsToMoving(){var selection=this.hot.getSelectedRange();var selectedRows=[];if(!selection){return selectedRows;}
var from=selection.from,to=selection.to;var start=Math.min(from.row,to.row);var end=Math.max(from.row,to.row);(0,_number.rangeEach)(start,end,function(i){selectedRows.push(i);});return selectedRows;}},{key:'refreshPositions',value:function refreshPositions(){var priv=privatePool.get(this);var coords=priv.target.coords;var firstVisible=this.hot.view.wt.wtTable.getFirstVisibleRow();var lastVisible=this.hot.view.wt.wtTable.getLastVisibleRow();var fixedRows=this.hot.getSettings().fixedRowsTop;var countRows=this.hot.countRows();if(coords.row<fixedRows&&firstVisible>0){this.hot.scrollViewportTo(firstVisible-1);}
if(coords.row>=lastVisible&&lastVisible<countRows){this.hot.scrollViewportTo(lastVisible+1,undefined,true);}
var wtTable=this.hot.view.wt.wtTable;var TD=priv.target.TD;var rootElementOffset=(0,_element.offset)(this.hot.rootElement);var tdOffsetTop=this.hot.view.THEAD.offsetHeight+this.getRowsHeight(0,coords.row);var mouseOffsetTop=priv.target.eventPageY-rootElementOffset.top+wtTable.holder.scrollTop;var hiderHeight=wtTable.hider.offsetHeight;var tbodyOffsetTop=wtTable.TBODY.offsetTop;var backlightElemMarginTop=this.backlight.getOffset().top;var backlightElemHeight=this.backlight.getSize().height;if(rootElementOffset.top+wtTable.holder.offsetHeight<priv.target.eventPageY){priv.target.coords.row++;}
if(this.isFixedRowTop(coords.row)){tdOffsetTop+=wtTable.holder.scrollTop;}
if(coords.row<0){priv.target.row=firstVisible>0?firstVisible-1:firstVisible;}else if(TD.offsetHeight/2+tdOffsetTop<=mouseOffsetTop){priv.target.row=coords.row+1;tdOffsetTop+=coords.row===0?TD.offsetHeight-1:TD.offsetHeight;}else{priv.target.row=coords.row;}
var backlightTop=mouseOffsetTop;var guidelineTop=tdOffsetTop;if(mouseOffsetTop+backlightElemHeight+backlightElemMarginTop>=hiderHeight){backlightTop=hiderHeight-backlightElemHeight-backlightElemMarginTop;}else if(mouseOffsetTop+backlightElemMarginTop<tbodyOffsetTop){backlightTop=tbodyOffsetTop+Math.abs(backlightElemMarginTop);}
if(tdOffsetTop>=hiderHeight-1){guidelineTop=hiderHeight-1;}
var topOverlayHeight=0;if(this.hot.view.wt.wtOverlays.topOverlay){topOverlayHeight=this.hot.view.wt.wtOverlays.topOverlay.clone.wtTable.TABLE.offsetHeight;}
if(coords.row>=fixedRows&&guidelineTop-wtTable.holder.scrollTop<topOverlayHeight){this.hot.scrollViewportTo(coords.row);}
this.backlight.setPosition(backlightTop);this.guideline.setPosition(guidelineTop);}},{key:'updateRowsMapper',value:function updateRowsMapper(){var countRows=this.hot.countSourceRows();var rowsMapperLen=this.rowsMapper._arrayMap.length;if(rowsMapperLen===0){this.rowsMapper.createMap(countRows||this.hot.getSettings().startRows);}else if(rowsMapperLen<countRows){var diff=countRows-rowsMapperLen;this.rowsMapper.insertItems(rowsMapperLen,diff);}else if(rowsMapperLen>countRows){var maxIndex=countRows-1;var rowsToRemove=[];(0,_array.arrayEach)(this.rowsMapper._arrayMap,function(value,index,array){if(value>maxIndex){rowsToRemove.push(index);}});this.rowsMapper.removeItems(rowsToRemove);}}},{key:'registerEvents',value:function registerEvents(){var _this4=this;this.eventManager.addEventListener(document.documentElement,'mousemove',function(event){return _this4.onMouseMove(event);});this.eventManager.addEventListener(document.documentElement,'mouseup',function(){return _this4.onMouseUp();});}},{key:'unregisterEvents',value:function unregisterEvents(){this.eventManager.clear();}},{key:'onBeforeColumnSort',value:function onBeforeColumnSort(column,order){var priv=privatePool.get(this);priv.disallowMoving=order!==void 0;}},{key:'onBeforeOnCellMouseDown',value:function onBeforeOnCellMouseDown(event,coords,TD,blockCalculations){var wtTable=this.hot.view.wt.wtTable;var isHeaderSelection=this.hot.selection.selectedHeader.rows;var selection=this.hot.getSelectedRange();var priv=privatePool.get(this);if(!selection||!isHeaderSelection||priv.pressed||event.button!==0){priv.pressed=false;priv.rowsToMove.length=0;(0,_element.removeClass)(this.hot.rootElement,[CSS_ON_MOVING,CSS_SHOW_UI]);return;}
var guidelineIsNotReady=this.guideline.isBuilt()&&!this.guideline.isAppended();var backlightIsNotReady=this.backlight.isBuilt()&&!this.backlight.isAppended();if(guidelineIsNotReady&&backlightIsNotReady){this.guideline.appendTo(wtTable.hider);this.backlight.appendTo(wtTable.hider);}
var from=selection.from,to=selection.to;var start=Math.min(from.row,to.row);var end=Math.max(from.row,to.row);if(coords.col<0&&coords.row>=start&&coords.row<=end){blockCalculations.row=true;priv.pressed=true;priv.target.eventPageY=event.pageY;priv.target.coords=coords;priv.target.TD=TD;priv.rowsToMove=this.prepareRowsToMoving();var leftPos=wtTable.holder.scrollLeft+wtTable.getColumnWidth(-1);this.backlight.setPosition(null,leftPos);this.backlight.setSize(wtTable.hider.offsetWidth-leftPos,this.getRowsHeight(start,end+1));this.backlight.setOffset((this.getRowsHeight(start,coords.row)+event.layerY)*-1,null);(0,_element.addClass)(this.hot.rootElement,CSS_ON_MOVING);this.refreshPositions();}else{(0,_element.removeClass)(this.hot.rootElement,CSS_AFTER_SELECTION);priv.pressed=false;priv.rowsToMove.length=0;}}},{key:'onMouseMove',value:function onMouseMove(event){var priv=privatePool.get(this);if(!priv.pressed){return;}
if(event.realTarget===this.backlight.element){var height=this.backlight.getSize().height;this.backlight.setSize(null,0);setTimeout(function(){this.backlight.setPosition(null,height);});}
priv.target.eventPageY=event.pageY;this.refreshPositions();}},{key:'onBeforeOnCellMouseOver',value:function onBeforeOnCellMouseOver(event,coords,TD,blockCalculations){var selectedRange=this.hot.getSelectedRange();var priv=privatePool.get(this);if(!selectedRange||!priv.pressed){return;}
if(priv.rowsToMove.indexOf(coords.row)>-1){(0,_element.removeClass)(this.hot.rootElement,CSS_SHOW_UI);}else{(0,_element.addClass)(this.hot.rootElement,CSS_SHOW_UI);}
blockCalculations.row=true;blockCalculations.column=true;blockCalculations.cell=true;priv.target.coords=coords;priv.target.TD=TD;}},{key:'onMouseUp',value:function onMouseUp(){var priv=privatePool.get(this);var target=priv.target.row;var rowsLen=priv.rowsToMove.length;priv.pressed=false;priv.backlightHeight=0;(0,_element.removeClass)(this.hot.rootElement,[CSS_ON_MOVING,CSS_SHOW_UI,CSS_AFTER_SELECTION]);if(this.hot.selection.selectedHeader.rows){(0,_element.addClass)(this.hot.rootElement,CSS_AFTER_SELECTION);}
if(rowsLen<1||target===void 0||priv.rowsToMove.indexOf(target)>-1||priv.rowsToMove[rowsLen-1]===target-1){return;}
this.moveRows(priv.rowsToMove,target);this.persistentStateSave();this.hot.render();if(!priv.disallowMoving){var selectionStart=this.rowsMapper.getIndexByValue(priv.rowsToMove[0]);var selectionEnd=this.rowsMapper.getIndexByValue(priv.rowsToMove[rowsLen-1]);this.changeSelection(selectionStart,selectionEnd);}
priv.rowsToMove.length=0;}},{key:'onAfterScrollHorizontally',value:function onAfterScrollHorizontally(){var wtTable=this.hot.view.wt.wtTable;var headerWidth=wtTable.getColumnWidth(-1);var scrollLeft=wtTable.holder.scrollLeft;var posLeft=headerWidth+scrollLeft;this.backlight.setPosition(null,posLeft);this.backlight.setSize(wtTable.hider.offsetWidth-posLeft);}},{key:'onAfterCreateRow',value:function onAfterCreateRow(index,amount){this.rowsMapper.shiftItems(index,amount);}},{key:'onBeforeRemoveRow',value:function onBeforeRemoveRow(index,amount){var _this5=this;this.removedRows.length=0;if(index!==false){(0,_number.rangeEach)(index,index+amount-1,function(removedIndex){_this5.removedRows.push(_this5.hot.runHooks('modifyRow',removedIndex,_this5.pluginName));});}}},{key:'onAfterRemoveRow',value:function onAfterRemoveRow(index,amount){this.rowsMapper.unshiftItems(this.removedRows);}},{key:'onAfterLoadData',value:function onAfterLoadData(firstTime){this.updateRowsMapper();}},{key:'onModifyRow',value:function onModifyRow(row,source){if(source!==this.pluginName){var rowInMapper=this.rowsMapper.getValueByIndex(row);row=rowInMapper===null?row:rowInMapper;}
return row;}},{key:'onUnmodifyRow',value:function onUnmodifyRow(row){var indexInMapper=this.rowsMapper.getIndexByValue(row);return indexInMapper===null?row:indexInMapper;}},{key:'onAfterPluginsInitialized',value:function onAfterPluginsInitialized(){this.updateRowsMapper();this.initialSettings();this.backlight.build();this.guideline.build();}},{key:'destroy',value:function destroy(){this.backlight.destroy();this.guideline.destroy();_get(ManualRowMove.prototype.__proto__||Object.getPrototypeOf(ManualRowMove.prototype),'destroy',this).call(this);}}]);return ManualRowMove;}(_base2.default);(0,_plugins.registerPlugin)('ManualRowMove',ManualRowMove);exports.default=ManualRowMove;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _arrayMapper=__webpack_require__(150);var _arrayMapper2=_interopRequireDefault(_arrayMapper);var _array=__webpack_require__(2);var _object=__webpack_require__(1);var _number=__webpack_require__(6);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var RowsMapper=function(){function RowsMapper(manualRowMove){_classCallCheck(this,RowsMapper);this.manualRowMove=manualRowMove;}
_createClass(RowsMapper,[{key:'createMap',value:function createMap(length){var _this=this;var originLength=length===void 0?this._arrayMap.length:length;this._arrayMap.length=0;(0,_number.rangeEach)(originLength-1,function(itemIndex){_this._arrayMap[itemIndex]=itemIndex;});}},{key:'destroy',value:function destroy(){this._arrayMap=null;}},{key:'moveRow',value:function moveRow(from,to){var indexToMove=this._arrayMap[from];this._arrayMap[from]=null;this._arrayMap.splice(to,0,indexToMove);}},{key:'clearNull',value:function clearNull(){this._arrayMap=(0,_array.arrayFilter)(this._arrayMap,function(i){return i!==null;});}}]);return RowsMapper;}();(0,_object.mixin)(RowsMapper,_arrayMapper2.default);exports.default=RowsMapper;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(152);var _base2=_interopRequireDefault(_base);var _element=__webpack_require__(0);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var CSS_CLASSNAME='ht__manualRowMove--backlight';var BacklightUI=function(_BaseUI){_inherits(BacklightUI,_BaseUI);function BacklightUI(){_classCallCheck(this,BacklightUI);return _possibleConstructorReturn(this,(BacklightUI.__proto__||Object.getPrototypeOf(BacklightUI)).apply(this,arguments));}
_createClass(BacklightUI,[{key:'build',value:function build(){_get(BacklightUI.prototype.__proto__||Object.getPrototypeOf(BacklightUI.prototype),'build',this).call(this);(0,_element.addClass)(this._element,CSS_CLASSNAME);}}]);return BacklightUI;}(_base2.default);exports.default=BacklightUI;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(152);var _base2=_interopRequireDefault(_base);var _element=__webpack_require__(0);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var CSS_CLASSNAME='ht__manualRowMove--guideline';var GuidelineUI=function(_BaseUI){_inherits(GuidelineUI,_BaseUI);function GuidelineUI(){_classCallCheck(this,GuidelineUI);return _possibleConstructorReturn(this,(GuidelineUI.__proto__||Object.getPrototypeOf(GuidelineUI)).apply(this,arguments));}
_createClass(GuidelineUI,[{key:'build',value:function build(){_get(GuidelineUI.prototype.__proto__||Object.getPrototypeOf(GuidelineUI.prototype),'build',this).call(this);(0,_element.addClass)(this._element,CSS_CLASSNAME);}}]);return GuidelineUI;}(_base2.default);exports.default=GuidelineUI;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _element=__webpack_require__(0);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _event=__webpack_require__(7);var _array=__webpack_require__(2);var _number=__webpack_require__(6);var _plugins=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var ManualRowResize=function(_BasePlugin){_inherits(ManualRowResize,_BasePlugin);function ManualRowResize(hotInstance){_classCallCheck(this,ManualRowResize);var _this=_possibleConstructorReturn(this,(ManualRowResize.__proto__||Object.getPrototypeOf(ManualRowResize)).call(this,hotInstance));_this.currentTH=null;_this.currentRow=null;_this.selectedRows=[];_this.currentHeight=null;_this.newSize=null;_this.startY=null;_this.startHeight=null;_this.startOffset=null;_this.handle=document.createElement('DIV');_this.guide=document.createElement('DIV');_this.eventManager=new _eventManager2.default(_this);_this.pressed=null;_this.dblclick=0;_this.autoresizeTimeout=null;_this.manualRowHeights=[];(0,_element.addClass)(_this.handle,'manualRowResizer');(0,_element.addClass)(_this.guide,'manualRowResizerGuide');return _this;}
_createClass(ManualRowResize,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().manualRowResize;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.manualRowHeights=[];var initialRowHeights=this.hot.getSettings().manualRowResize;var loadedManualRowHeights=this.loadManualRowHeights();if(typeof loadedManualRowHeights!='undefined'){this.manualRowHeights=loadedManualRowHeights;}else if(Array.isArray(initialRowHeights)){this.manualRowHeights=initialRowHeights;}else{this.manualRowHeights=[];}
this.addHook('modifyRowHeight',function(height,row){return _this2.onModifyRowHeight(height,row);});this.bindEvents();_get(ManualRowResize.prototype.__proto__||Object.getPrototypeOf(ManualRowResize.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){var initialRowHeights=this.hot.getSettings().manualRowResize;if(Array.isArray(initialRowHeights)){this.manualRowHeights=initialRowHeights;}else if(!initialRowHeights){this.manualRowHeights=[];}}},{key:'disablePlugin',value:function disablePlugin(){_get(ManualRowResize.prototype.__proto__||Object.getPrototypeOf(ManualRowResize.prototype),'disablePlugin',this).call(this);}},{key:'saveManualRowHeights',value:function saveManualRowHeights(){this.hot.runHooks('persistentStateSave','manualRowHeights',this.manualRowHeights);}},{key:'loadManualRowHeights',value:function loadManualRowHeights(){var storedState={};this.hot.runHooks('persistentStateLoad','manualRowHeights',storedState);return storedState.value;}},{key:'setupHandlePosition',value:function setupHandlePosition(TH){var _this3=this;this.currentTH=TH;var row=this.hot.view.wt.wtTable.getCoords(TH).row;var headerWidth=(0,_element.outerWidth)(this.currentTH);if(row>=0){var box=this.currentTH.getBoundingClientRect();this.currentRow=row;this.selectedRows=[];if(this.hot.selection.isSelected()&&this.hot.selection.selectedHeader.rows){var _hot$getSelectedRange=this.hot.getSelectedRange(),from=_hot$getSelectedRange.from,to=_hot$getSelectedRange.to;var start=from.row;var end=to.row;if(start>=end){start=to.row;end=from.row;}
if(this.currentRow>=start&&this.currentRow<=end){(0,_number.rangeEach)(start,end,function(i){return _this3.selectedRows.push(i);});}else{this.selectedRows.push(this.currentRow);}}else{this.selectedRows.push(this.currentRow);}
this.startOffset=box.top-6;this.startHeight=parseInt(box.height,10);this.handle.style.left=box.left+'px';this.handle.style.top=this.startOffset+this.startHeight+'px';this.handle.style.width=headerWidth+'px';this.hot.rootElement.appendChild(this.handle);}}},{key:'refreshHandlePosition',value:function refreshHandlePosition(){this.handle.style.top=this.startOffset+this.currentHeight+'px';}},{key:'setupGuidePosition',value:function setupGuidePosition(){var handleWidth=parseInt((0,_element.outerWidth)(this.handle),10);var handleRightPosition=parseInt(this.handle.style.left,10)+handleWidth;var maximumVisibleElementWidth=parseInt(this.hot.view.maximumVisibleElementWidth(0),10);(0,_element.addClass)(this.handle,'active');(0,_element.addClass)(this.guide,'active');this.guide.style.top=this.handle.style.top;this.guide.style.left=handleRightPosition+'px';this.guide.style.width=maximumVisibleElementWidth-handleWidth+'px';this.hot.rootElement.appendChild(this.guide);}},{key:'refreshGuidePosition',value:function refreshGuidePosition(){this.guide.style.top=this.handle.style.top;}},{key:'hideHandleAndGuide',value:function hideHandleAndGuide(){(0,_element.removeClass)(this.handle,'active');(0,_element.removeClass)(this.guide,'active');}},{key:'checkIfRowHeader',value:function checkIfRowHeader(element){if(element!=this.hot.rootElement){var parent=element.parentNode;if(parent.tagName==='TBODY'){return true;}
return this.checkIfRowHeader(parent);}
return false;}},{key:'getTHFromTargetElement',value:function getTHFromTargetElement(element){if(element.tagName!='TABLE'){if(element.tagName=='TH'){return element;}
return this.getTHFromTargetElement(element.parentNode);}
return null;}},{key:'onMouseOver',value:function onMouseOver(event){if(this.checkIfRowHeader(event.target)){var th=this.getTHFromTargetElement(event.target);if(th){if(!this.pressed){this.setupHandlePosition(th);}}}}},{key:'afterMouseDownTimeout',value:function afterMouseDownTimeout(){var _this4=this;var render=function render(){_this4.hot.forceFullRender=true;_this4.hot.view.render();_this4.hot.view.wt.wtOverlays.adjustElementsSize(true);};var resize=function resize(selectedRow,forceRender){var hookNewSize=_this4.hot.runHooks('beforeRowResize',selectedRow,_this4.newSize,true);if(hookNewSize!==void 0){_this4.newSize=hookNewSize;}
_this4.setManualSize(selectedRow,_this4.newSize);if(forceRender){render();}
_this4.hot.runHooks('afterRowResize',selectedRow,_this4.newSize,true);};if(this.dblclick>=2){var selectedRowsLength=this.selectedRows.length;if(selectedRowsLength>1){(0,_array.arrayEach)(this.selectedRows,function(selectedRow){resize(selectedRow);});render();}else{(0,_array.arrayEach)(this.selectedRows,function(selectedRow){resize(selectedRow,true);});}}
this.dblclick=0;this.autoresizeTimeout=null;}},{key:'onMouseDown',value:function onMouseDown(event){var _this5=this;if((0,_element.hasClass)(event.target,'manualRowResizer')){this.setupGuidePosition();this.pressed=this.hot;if(this.autoresizeTimeout==null){this.autoresizeTimeout=setTimeout(function(){return _this5.afterMouseDownTimeout();},500);this.hot._registerTimeout(this.autoresizeTimeout);}
this.dblclick++;this.startY=(0,_event.pageY)(event);this.newSize=this.startHeight;}}},{key:'onMouseMove',value:function onMouseMove(event){var _this6=this;if(this.pressed){this.currentHeight=this.startHeight+((0,_event.pageY)(event)-this.startY);(0,_array.arrayEach)(this.selectedRows,function(selectedRow){_this6.newSize=_this6.setManualSize(selectedRow,_this6.currentHeight);});this.refreshHandlePosition();this.refreshGuidePosition();}}},{key:'onMouseUp',value:function onMouseUp(event){var _this7=this;var render=function render(){_this7.hot.forceFullRender=true;_this7.hot.view.render();_this7.hot.view.wt.wtOverlays.adjustElementsSize(true);};var runHooks=function runHooks(selectedRow,forceRender){_this7.hot.runHooks('beforeRowResize',selectedRow,_this7.newSize);if(forceRender){render();}
_this7.saveManualRowHeights();_this7.hot.runHooks('afterRowResize',selectedRow,_this7.newSize);};if(this.pressed){this.hideHandleAndGuide();this.pressed=false;if(this.newSize!=this.startHeight){var selectedRowsLength=this.selectedRows.length;if(selectedRowsLength>1){(0,_array.arrayEach)(this.selectedRows,function(selectedRow){runHooks(selectedRow);});render();}else{(0,_array.arrayEach)(this.selectedRows,function(selectedRow){runHooks(selectedRow,true);});}}
this.setupHandlePosition(this.currentTH);}}},{key:'bindEvents',value:function bindEvents(){var _this8=this;this.eventManager.addEventListener(this.hot.rootElement,'mouseover',function(e){return _this8.onMouseOver(e);});this.eventManager.addEventListener(this.hot.rootElement,'mousedown',function(e){return _this8.onMouseDown(e);});this.eventManager.addEventListener(window,'mousemove',function(e){return _this8.onMouseMove(e);});this.eventManager.addEventListener(window,'mouseup',function(e){return _this8.onMouseUp(e);});}},{key:'setManualSize',value:function setManualSize(row,height){row=this.hot.runHooks('modifyRow',row);this.manualRowHeights[row]=height;return height;}},{key:'onModifyRowHeight',value:function onModifyRowHeight(height,row){if(this.enabled){var autoRowSizePlugin=this.hot.getPlugin('autoRowSize');var autoRowHeightResult=autoRowSizePlugin?autoRowSizePlugin.heights[row]:null;row=this.hot.runHooks('modifyRow',row);var manualRowHeight=this.manualRowHeights[row];if(manualRowHeight!==void 0&&(manualRowHeight===autoRowHeightResult||manualRowHeight>(height||0))){return manualRowHeight;}}
return height;}}]);return ManualRowResize;}(_base2.default);(0,_plugins.registerPlugin)('manualRowResize',ManualRowResize);exports.default=ManualRowResize;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _plugins=__webpack_require__(5);var _event=__webpack_require__(7);var _src=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function CellInfoCollection(){var collection=[];collection.getInfo=function(row,col){for(var i=0,ilen=this.length;i<ilen;i++){if(this[i].row<=row&&this[i].row+this[i].rowspan-1>=row&&this[i].col<=col&&this[i].col+this[i].colspan-1>=col){return this[i];}}};collection.setInfo=function(info){for(var i=0,ilen=this.length;i<ilen;i++){if(this[i].row===info.row&&this[i].col===info.col){this[i]=info;return;}}
this.push(info);};collection.removeInfo=function(row,col){for(var i=0,ilen=this.length;i<ilen;i++){if(this[i].row===row&&this[i].col===col){this.splice(i,1);break;}}};return collection;}
function MergeCells(mergeCellsSetting){this.mergedCellInfoCollection=new CellInfoCollection();if(Array.isArray(mergeCellsSetting)){for(var i=0,ilen=mergeCellsSetting.length;i<ilen;i++){this.mergedCellInfoCollection.setInfo(mergeCellsSetting[i]);}}}
MergeCells.prototype.canMergeRange=function(cellRange){return!cellRange.isSingle();};MergeCells.prototype.mergeRange=function(cellRange){if(!this.canMergeRange(cellRange)){return;}
var topLeft=cellRange.getTopLeftCorner();var bottomRight=cellRange.getBottomRightCorner();var mergeParent={};mergeParent.row=topLeft.row;mergeParent.col=topLeft.col;mergeParent.rowspan=bottomRight.row-topLeft.row+1;mergeParent.colspan=bottomRight.col-topLeft.col+1;this.mergedCellInfoCollection.setInfo(mergeParent);};MergeCells.prototype.mergeOrUnmergeSelection=function(cellRange){var info=this.mergedCellInfoCollection.getInfo(cellRange.from.row,cellRange.from.col);if(info){this.unmergeSelection(cellRange.from);}else{this.mergeSelection(cellRange);}};MergeCells.prototype.mergeSelection=function(cellRange){this.mergeRange(cellRange);};MergeCells.prototype.unmergeSelection=function(cellRange){var info=this.mergedCellInfoCollection.getInfo(cellRange.row,cellRange.col);this.mergedCellInfoCollection.removeInfo(info.row,info.col);};MergeCells.prototype.applySpanProperties=function(TD,row,col){var info=this.mergedCellInfoCollection.getInfo(row,col);if(info){if(info.row===row&&info.col===col){TD.setAttribute('rowspan',info.rowspan);TD.setAttribute('colspan',info.colspan);}else{TD.removeAttribute('rowspan');TD.removeAttribute('colspan');TD.style.display='none';}}else{TD.removeAttribute('rowspan');TD.removeAttribute('colspan');}};MergeCells.prototype.modifyTransform=function(hook,currentSelectedRange,delta){var sameRowspan=function sameRowspan(merged,coords){if(coords.row>=merged.row&&coords.row<=merged.row+merged.rowspan-1){return true;}
return false;},sameColspan=function sameColspan(merged,coords){if(coords.col>=merged.col&&coords.col<=merged.col+merged.colspan-1){return true;}
return false;},getNextPosition=function getNextPosition(newDelta){return new _src.CellCoords(currentSelectedRange.to.row+newDelta.row,currentSelectedRange.to.col+newDelta.col);};var newDelta={row:delta.row,col:delta.col};if(hook=='modifyTransformStart'){var nextPosition;if(!this.lastDesiredCoords){this.lastDesiredCoords=new _src.CellCoords(null,null);}
var currentPosition=new _src.CellCoords(currentSelectedRange.highlight.row,currentSelectedRange.highlight.col),mergedParent=this.mergedCellInfoCollection.getInfo(currentPosition.row,currentPosition.col),currentRangeContainsMerge;for(var i=0,mergesLength=this.mergedCellInfoCollection.length;i<mergesLength;i++){var range=this.mergedCellInfoCollection[i];range=new _src.CellCoords(range.row+range.rowspan-1,range.col+range.colspan-1);if(currentSelectedRange.includes(range)){currentRangeContainsMerge=true;break;}}
if(mergedParent){var mergeTopLeft=new _src.CellCoords(mergedParent.row,mergedParent.col);var mergeBottomRight=new _src.CellCoords(mergedParent.row+mergedParent.rowspan-1,mergedParent.col+mergedParent.colspan-1);var mergeRange=new _src.CellRange(mergeTopLeft,mergeTopLeft,mergeBottomRight);if(!mergeRange.includes(this.lastDesiredCoords)){this.lastDesiredCoords=new _src.CellCoords(null,null);}
newDelta.row=this.lastDesiredCoords.row?this.lastDesiredCoords.row-currentPosition.row:newDelta.row;newDelta.col=this.lastDesiredCoords.col?this.lastDesiredCoords.col-currentPosition.col:newDelta.col;if(delta.row>0){newDelta.row=mergedParent.row+mergedParent.rowspan-1-currentPosition.row+delta.row;}else if(delta.row<0){newDelta.row=currentPosition.row-mergedParent.row+delta.row;}
if(delta.col>0){newDelta.col=mergedParent.col+mergedParent.colspan-1-currentPosition.col+delta.col;}else if(delta.col<0){newDelta.col=currentPosition.col-mergedParent.col+delta.col;}}
nextPosition=new _src.CellCoords(currentSelectedRange.highlight.row+newDelta.row,currentSelectedRange.highlight.col+newDelta.col);var nextParentIsMerged=this.mergedCellInfoCollection.getInfo(nextPosition.row,nextPosition.col);if(nextParentIsMerged){this.lastDesiredCoords=nextPosition;newDelta={row:nextParentIsMerged.row-currentPosition.row,col:nextParentIsMerged.col-currentPosition.col};}}else if(hook=='modifyTransformEnd'){for(var _i=0,_mergesLength=this.mergedCellInfoCollection.length;_i<_mergesLength;_i++){var currentMerge=this.mergedCellInfoCollection[_i];var _mergeTopLeft=new _src.CellCoords(currentMerge.row,currentMerge.col);var _mergeBottomRight=new _src.CellCoords(currentMerge.row+currentMerge.rowspan-1,currentMerge.col+currentMerge.colspan-1);var mergedRange=new _src.CellRange(_mergeTopLeft,_mergeTopLeft,_mergeBottomRight);var sharedBorders=currentSelectedRange.getBordersSharedWith(mergedRange);if(mergedRange.isEqual(currentSelectedRange)){currentSelectedRange.setDirection('NW-SE');}else if(sharedBorders.length>0){var mergeHighlighted=currentSelectedRange.highlight.isEqual(mergedRange.from);if(sharedBorders.indexOf('top')>-1){if(currentSelectedRange.to.isSouthEastOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection('NW-SE');}else if(currentSelectedRange.to.isSouthWestOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection('NE-SW');}}else if(sharedBorders.indexOf('bottom')>-1){if(currentSelectedRange.to.isNorthEastOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection('SW-NE');}else if(currentSelectedRange.to.isNorthWestOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection('SE-NW');}}}
nextPosition=getNextPosition(newDelta);var withinRowspan=sameRowspan(currentMerge,nextPosition),withinColspan=sameColspan(currentMerge,nextPosition);if(currentSelectedRange.includesRange(mergedRange)&&(mergedRange.includes(nextPosition)||withinRowspan||withinColspan)){if(withinRowspan){if(newDelta.row<0){newDelta.row-=currentMerge.rowspan-1;}else if(newDelta.row>0){newDelta.row+=currentMerge.rowspan-1;}}
if(withinColspan){if(newDelta.col<0){newDelta.col-=currentMerge.colspan-1;}else if(newDelta.col>0){newDelta.col+=currentMerge.colspan-1;}}}}}
if(newDelta.row!==0){delta.row=newDelta.row;}
if(newDelta.col!==0){delta.col=newDelta.col;}};MergeCells.prototype.shiftCollection=function(direction,index,count){var shiftVector=[0,0];switch(direction){case'right':shiftVector[0]+=1;break;case'left':shiftVector[0]-=1;break;case'down':shiftVector[1]+=1;break;case'up':shiftVector[1]-=1;break;default:break;}
for(var i=0;i<this.mergedCellInfoCollection.length;i++){var currentMerge=this.mergedCellInfoCollection[i];if(direction==='right'||direction==='left'){if(index<=currentMerge.col){currentMerge.col+=shiftVector[0];}}else if(index<=currentMerge.row){currentMerge.row+=shiftVector[1];}}};var beforeInit=function beforeInit(){var instance=this;var mergeCellsSetting=instance.getSettings().mergeCells;if(mergeCellsSetting){if(!instance.mergeCells){instance.mergeCells=new MergeCells(mergeCellsSetting);}}};var afterInit=function afterInit(){var instance=this;if(instance.mergeCells){instance.view.wt.wtTable.getCell=function(coords){if(instance.getSettings().mergeCells){var mergeParent=instance.mergeCells.mergedCellInfoCollection.getInfo(coords.row,coords.col);if(mergeParent){coords=mergeParent;}}
return _src.Table.prototype.getCell.call(this,coords);};}};var afterUpdateSettings=function afterUpdateSettings(){var instance=this;var mergeCellsSetting=instance.getSettings().mergeCells;if(mergeCellsSetting){if(instance.mergeCells){instance.mergeCells.mergedCellInfoCollection=new CellInfoCollection();if(Array.isArray(mergeCellsSetting)){for(var i=0,ilen=mergeCellsSetting.length;i<ilen;i++){instance.mergeCells.mergedCellInfoCollection.setInfo(mergeCellsSetting[i]);}}}else{instance.mergeCells=new MergeCells(mergeCellsSetting);}}else if(instance.mergeCells){instance.mergeCells.mergedCellInfoCollection=new CellInfoCollection();}};var onBeforeKeyDown=function onBeforeKeyDown(event){if(!this.mergeCells){return;}
var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(ctrlDown){if(event.keyCode===77){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange());this.render();(0,_event.stopImmediatePropagation)(event);}}};var addMergeActionsToContextMenu=function addMergeActionsToContextMenu(defaultOptions){if(!this.getSettings().mergeCells){return;}
defaultOptions.items.push({name:'---------'});defaultOptions.items.push({key:'mergeCells',name:function name(){var sel=this.getSelected();var info=this.mergeCells.mergedCellInfoCollection.getInfo(sel[0],sel[1]);if(info){return'Unmerge cells';}
return'Merge cells';},callback:function callback(){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange());this.render();},disabled:function disabled(){return this.selection.selectedHeader.corner;}});};var afterRenderer=function afterRenderer(TD,row,col,prop,value,cellProperties){if(this.mergeCells){this.mergeCells.applySpanProperties(TD,row,col);}};var modifyTransformFactory=function modifyTransformFactory(hook){return function(delta){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var currentSelectedRange=this.getSelectedRange();this.mergeCells.modifyTransform(hook,currentSelectedRange,delta);if(hook==='modifyTransformEnd'){var totalRows=this.countRows();var totalCols=this.countCols();if(currentSelectedRange.from.row<0){currentSelectedRange.from.row=0;}else if(currentSelectedRange.from.row>0&&currentSelectedRange.from.row>=totalRows){currentSelectedRange.from.row=currentSelectedRange.from-1;}
if(currentSelectedRange.from.col<0){currentSelectedRange.from.col=0;}else if(currentSelectedRange.from.col>0&&currentSelectedRange.from.col>=totalCols){currentSelectedRange.from.col=totalCols-1;}}}};};var beforeSetRangeEnd=function beforeSetRangeEnd(coords){this.lastDesiredCoords=null;var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var selRange=this.getSelectedRange();selRange.highlight=new _src.CellCoords(selRange.highlight.row,selRange.highlight.col);selRange.to=coords;var rangeExpanded=false;do{rangeExpanded=false;for(var i=0,ilen=this.mergeCells.mergedCellInfoCollection.length;i<ilen;i++){var cellInfo=this.mergeCells.mergedCellInfoCollection[i];var mergedCellTopLeft=new _src.CellCoords(cellInfo.row,cellInfo.col);var mergedCellBottomRight=new _src.CellCoords(cellInfo.row+cellInfo.rowspan-1,cellInfo.col+cellInfo.colspan-1);var mergedCellRange=new _src.CellRange(mergedCellTopLeft,mergedCellTopLeft,mergedCellBottomRight);if(selRange.expandByRange(mergedCellRange)){coords.row=selRange.to.row;coords.col=selRange.to.col;rangeExpanded=true;}}}while(rangeExpanded);}};var beforeDrawAreaBorders=function beforeDrawAreaBorders(corners,className){if(className&&className=='area'){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var selRange=this.getSelectedRange();var startRange=new _src.CellRange(selRange.from,selRange.from,selRange.from);var stopRange=new _src.CellRange(selRange.to,selRange.to,selRange.to);for(var i=0,ilen=this.mergeCells.mergedCellInfoCollection.length;i<ilen;i++){var cellInfo=this.mergeCells.mergedCellInfoCollection[i];var mergedCellTopLeft=new _src.CellCoords(cellInfo.row,cellInfo.col);var mergedCellBottomRight=new _src.CellCoords(cellInfo.row+cellInfo.rowspan-1,cellInfo.col+cellInfo.colspan-1);var mergedCellRange=new _src.CellRange(mergedCellTopLeft,mergedCellTopLeft,mergedCellBottomRight);if(startRange.expandByRange(mergedCellRange)){corners[0]=startRange.from.row;corners[1]=startRange.from.col;}
if(stopRange.expandByRange(mergedCellRange)){corners[2]=stopRange.from.row;corners[3]=stopRange.from.col;}}}}};var afterGetCellMeta=function afterGetCellMeta(row,col,cellProperties){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(row,col);if(mergeParent&&(mergeParent.row!=row||mergeParent.col!=col)){cellProperties.copyable=false;}}};var afterViewportRowCalculatorOverride=function afterViewportRowCalculatorOverride(calc){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var colCount=this.countCols();var mergeParent;for(var c=0;c<colCount;c++){mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(calc.startRow,c);if(mergeParent){if(mergeParent.row<calc.startRow){calc.startRow=mergeParent.row;return afterViewportRowCalculatorOverride.call(this,calc);}}
mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(calc.endRow,c);if(mergeParent){var mergeEnd=mergeParent.row+mergeParent.rowspan-1;if(mergeEnd>calc.endRow){calc.endRow=mergeEnd;return afterViewportRowCalculatorOverride.call(this,calc);}}}}};var afterViewportColumnCalculatorOverride=function afterViewportColumnCalculatorOverride(calc){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var rowCount=this.countRows();var mergeParent;for(var r=0;r<rowCount;r++){mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(r,calc.startColumn);if(mergeParent){if(mergeParent.col<calc.startColumn){calc.startColumn=mergeParent.col;return afterViewportColumnCalculatorOverride.call(this,calc);}}
mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(r,calc.endColumn);if(mergeParent){var mergeEnd=mergeParent.col+mergeParent.colspan-1;if(mergeEnd>calc.endColumn){calc.endColumn=mergeEnd;return afterViewportColumnCalculatorOverride.call(this,calc);}}}}};var isMultipleSelection=function isMultipleSelection(isMultiple){if(isMultiple&&this.mergeCells){var mergedCells=this.mergeCells.mergedCellInfoCollection,selectionRange=this.getSelectedRange();for(var group in mergedCells){if(selectionRange.highlight.row==mergedCells[group].row&&selectionRange.highlight.col==mergedCells[group].col&&selectionRange.to.row==mergedCells[group].row+mergedCells[group].rowspan-1&&selectionRange.to.col==mergedCells[group].col+mergedCells[group].colspan-1){return false;}}}
return isMultiple;};function modifyAutofillRange(select,drag){var mergeCellsSetting=this.getSettings().mergeCells;if(!mergeCellsSetting||this.selection.isMultiple()){return;}
var info=this.mergeCells.mergedCellInfoCollection.getInfo(select[0],select[1]);if(info){select[0]=info.row;select[1]=info.col;select[2]=info.row+info.rowspan-1;select[3]=info.col+info.colspan-1;}}
function onAfterCreateCol(col,count){if(this.mergeCells){this.mergeCells.shiftCollection('right',col,count);}}
function onAfterRemoveCol(col,count){if(this.mergeCells){this.mergeCells.shiftCollection('left',col,count);}}
function onAfterCreateRow(row,count){if(this.mergeCells){this.mergeCells.shiftCollection('down',row,count);}}
function onAfterRemoveRow(row,count){if(this.mergeCells){this.mergeCells.shiftCollection('up',row,count);}}
var hook=_pluginHooks2.default.getSingleton();hook.add('beforeInit',beforeInit);hook.add('afterInit',afterInit);hook.add('afterUpdateSettings',afterUpdateSettings);hook.add('beforeKeyDown',onBeforeKeyDown);hook.add('modifyTransformStart',modifyTransformFactory('modifyTransformStart'));hook.add('modifyTransformEnd',modifyTransformFactory('modifyTransformEnd'));hook.add('beforeSetRangeEnd',beforeSetRangeEnd);hook.add('beforeDrawBorders',beforeDrawAreaBorders);hook.add('afterIsMultipleSelection',isMultipleSelection);hook.add('afterRenderer',afterRenderer);hook.add('afterContextMenuDefaultOptions',addMergeActionsToContextMenu);hook.add('afterGetCellMeta',afterGetCellMeta);hook.add('afterViewportRowCalculatorOverride',afterViewportRowCalculatorOverride);hook.add('afterViewportColumnCalculatorOverride',afterViewportColumnCalculatorOverride);hook.add('modifyAutofillRange',modifyAutofillRange);hook.add('afterCreateCol',onAfterCreateCol);hook.add('afterRemoveCol',onAfterRemoveCol);hook.add('afterCreateRow',onAfterCreateRow);hook.add('afterRemoveRow',onAfterRemoveRow);exports.default=MergeCells;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _element=__webpack_require__(0);var _browser=__webpack_require__(25);var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _plugins=__webpack_require__(5);var _src=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var MultipleSelectionHandles=function(_BasePlugin){_inherits(MultipleSelectionHandles,_BasePlugin);function MultipleSelectionHandles(hotInstance){_classCallCheck(this,MultipleSelectionHandles);var _this2=_possibleConstructorReturn(this,(MultipleSelectionHandles.__proto__||Object.getPrototypeOf(MultipleSelectionHandles)).call(this,hotInstance));_this2.dragged=[];_this2.eventManager=null;_this2.lastSetCell=null;return _this2;}
_createClass(MultipleSelectionHandles,[{key:'isEnabled',value:function isEnabled(){return(0,_browser.isMobileBrowser)();}},{key:'enablePlugin',value:function enablePlugin(){if(this.enabled){return;}
if(!this.eventManager){this.eventManager=new _eventManager2.default(this);}
this.registerListeners();_get(MultipleSelectionHandles.prototype.__proto__||Object.getPrototypeOf(MultipleSelectionHandles.prototype),'enablePlugin',this).call(this);}},{key:'registerListeners',value:function registerListeners(){var _this=this;function removeFromDragged(query){if(_this.dragged.length===1){_this.dragged.splice(0,_this.dragged.length);return true;}
var entryPosition=_this.dragged.indexOf(query);if(entryPosition==-1){return false;}else if(entryPosition===0){_this.dragged=_this.dragged.slice(0,1);}else if(entryPosition==1){_this.dragged=_this.dragged.slice(-1);}}
this.eventManager.addEventListener(this.hot.rootElement,'touchstart',function(event){var selectedRange=void 0;if((0,_element.hasClass)(event.target,'topLeftSelectionHandle-HitArea')){selectedRange=_this.hot.getSelectedRange();_this.dragged.push('topLeft');_this.touchStartRange={width:selectedRange.getWidth(),height:selectedRange.getHeight(),direction:selectedRange.getDirection()};event.preventDefault();return false;}else if((0,_element.hasClass)(event.target,'bottomRightSelectionHandle-HitArea')){selectedRange=_this.hot.getSelectedRange();_this.dragged.push('bottomRight');_this.touchStartRange={width:selectedRange.getWidth(),height:selectedRange.getHeight(),direction:selectedRange.getDirection()};event.preventDefault();return false;}});this.eventManager.addEventListener(this.hot.rootElement,'touchend',function(event){if((0,_element.hasClass)(event.target,'topLeftSelectionHandle-HitArea')){removeFromDragged.call(_this,'topLeft');_this.touchStartRange=void 0;event.preventDefault();return false;}else if((0,_element.hasClass)(event.target,'bottomRightSelectionHandle-HitArea')){removeFromDragged.call(_this,'bottomRight');_this.touchStartRange=void 0;event.preventDefault();return false;}});this.eventManager.addEventListener(this.hot.rootElement,'touchmove',function(event){var scrollTop=(0,_element.getWindowScrollTop)(),scrollLeft=(0,_element.getWindowScrollLeft)(),endTarget=void 0,targetCoords=void 0,selectedRange=void 0,rangeWidth=void 0,rangeHeight=void 0,rangeDirection=void 0,newRangeCoords=void 0;if(_this.dragged.length===0){return;}
endTarget=document.elementFromPoint(event.touches[0].screenX-scrollLeft,event.touches[0].screenY-scrollTop);if(!endTarget||endTarget===_this.lastSetCell){return;}
if(endTarget.nodeName=='TD'||endTarget.nodeName=='TH'){targetCoords=_this.hot.getCoords(endTarget);if(targetCoords.col==-1){targetCoords.col=0;}
selectedRange=_this.hot.getSelectedRange();rangeWidth=selectedRange.getWidth();rangeHeight=selectedRange.getHeight();rangeDirection=selectedRange.getDirection();if(rangeWidth==1&&rangeHeight==1){_this.hot.selection.setRangeEnd(targetCoords);}
newRangeCoords=_this.getCurrentRangeCoords(selectedRange,targetCoords,_this.touchStartRange.direction,rangeDirection,_this.dragged[0]);if(newRangeCoords.start!==null){_this.hot.selection.setRangeStart(newRangeCoords.start);}
_this.hot.selection.setRangeEnd(newRangeCoords.end);_this.lastSetCell=endTarget;}
event.preventDefault();});}},{key:'getCurrentRangeCoords',value:function getCurrentRangeCoords(selectedRange,currentTouch,touchStartDirection,currentDirection,draggedHandle){var topLeftCorner=selectedRange.getTopLeftCorner(),bottomRightCorner=selectedRange.getBottomRightCorner(),bottomLeftCorner=selectedRange.getBottomLeftCorner(),topRightCorner=selectedRange.getTopRightCorner();var newCoords={start:null,end:null};switch(touchStartDirection){case'NE-SW':switch(currentDirection){case'NE-SW':case'NW-SE':if(draggedHandle=='topLeft'){newCoords={start:new _src.CellCoords(currentTouch.row,selectedRange.highlight.col),end:new _src.CellCoords(bottomLeftCorner.row,currentTouch.col)};}else{newCoords={start:new _src.CellCoords(selectedRange.highlight.row,currentTouch.col),end:new _src.CellCoords(currentTouch.row,topLeftCorner.col)};}
break;case'SE-NW':if(draggedHandle=='bottomRight'){newCoords={start:new _src.CellCoords(bottomRightCorner.row,currentTouch.col),end:new _src.CellCoords(currentTouch.row,topLeftCorner.col)};}
break;default:break;}
break;case'NW-SE':switch(currentDirection){case'NE-SW':if(draggedHandle=='topLeft'){newCoords={start:currentTouch,end:bottomLeftCorner};}else{newCoords.end=currentTouch;}
break;case'NW-SE':if(draggedHandle=='topLeft'){newCoords={start:currentTouch,end:bottomRightCorner};}else{newCoords.end=currentTouch;}
break;case'SE-NW':if(draggedHandle=='topLeft'){newCoords={start:currentTouch,end:topLeftCorner};}else{newCoords.end=currentTouch;}
break;case'SW-NE':if(draggedHandle=='topLeft'){newCoords={start:currentTouch,end:topRightCorner};}else{newCoords.end=currentTouch;}
break;default:break;}
break;case'SW-NE':switch(currentDirection){case'NW-SE':if(draggedHandle=='bottomRight'){newCoords={start:new _src.CellCoords(currentTouch.row,topLeftCorner.col),end:new _src.CellCoords(bottomLeftCorner.row,currentTouch.col)};}else{newCoords={start:new _src.CellCoords(topLeftCorner.row,currentTouch.col),end:new _src.CellCoords(currentTouch.row,bottomRightCorner.col)};}
break;case'SW-NE':if(draggedHandle=='topLeft'){newCoords={start:new _src.CellCoords(selectedRange.highlight.row,currentTouch.col),end:new _src.CellCoords(currentTouch.row,bottomRightCorner.col)};}else{newCoords={start:new _src.CellCoords(currentTouch.row,topLeftCorner.col),end:new _src.CellCoords(topLeftCorner.row,currentTouch.col)};}
break;case'SE-NW':if(draggedHandle=='bottomRight'){newCoords={start:new _src.CellCoords(currentTouch.row,topRightCorner.col),end:new _src.CellCoords(topLeftCorner.row,currentTouch.col)};}else if(draggedHandle=='topLeft'){newCoords={start:bottomLeftCorner,end:currentTouch};}
break;default:break;}
break;case'SE-NW':switch(currentDirection){case'NW-SE':case'NE-SW':case'SW-NE':if(draggedHandle=='topLeft'){newCoords.end=currentTouch;}
break;case'SE-NW':if(draggedHandle=='topLeft'){newCoords.end=currentTouch;}else{newCoords={start:currentTouch,end:topLeftCorner};}
break;default:break;}
break;default:break;}
return newCoords;}},{key:'isDragged',value:function isDragged(){return this.dragged.length>0;}}]);return MultipleSelectionHandles;}(_base2.default);(0,_plugins.registerPlugin)('multipleSelectionHandles',MultipleSelectionHandles);exports.default=MultipleSelectionHandles;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _jsonPatchDuplex=__webpack_require__(134);var _jsonPatchDuplex2=_interopRequireDefault(_jsonPatchDuplex);var _localHooks=__webpack_require__(69);var _localHooks2=_interopRequireDefault(_localHooks);var _object=__webpack_require__(1);var _utils=__webpack_require__(257);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var DataObserver=function(){function DataObserver(observedData){_classCallCheck(this,DataObserver);this.observedData=null;this.observer=null;this.paused=false;this.setObservedData(observedData);}
_createClass(DataObserver,[{key:'setObservedData',value:function setObservedData(observedData){var _this=this;if(this.observer){_jsonPatchDuplex2.default.unobserve(this.observedData,this.observer);}
this.observedData=observedData;this.observer=_jsonPatchDuplex2.default.observe(this.observedData,function(patches){return _this.onChange(patches);});}},{key:'isPaused',value:function isPaused(){return this.paused;}},{key:'pause',value:function pause(){this.paused=true;}},{key:'resume',value:function resume(){this.paused=false;}},{key:'onChange',value:function onChange(patches){this.runLocalHooks('change',(0,_utils.cleanPatches)(patches));}},{key:'destroy',value:function destroy(){_jsonPatchDuplex2.default.unobserve(this.observedData,this.observer);this.observedData=null;this.observer=null;}}]);return DataObserver;}();(0,_object.mixin)(DataObserver,_localHooks2.default);exports.default=DataObserver;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _jsonPatchDuplex=__webpack_require__(134);var _jsonPatchDuplex2=_interopRequireDefault(_jsonPatchDuplex);var _dataObserver=__webpack_require__(255);var _dataObserver2=_interopRequireDefault(_dataObserver);var _array=__webpack_require__(2);var _plugins=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var ObserveChanges=function(_BasePlugin){_inherits(ObserveChanges,_BasePlugin);function ObserveChanges(hotInstance){_classCallCheck(this,ObserveChanges);var _this=_possibleConstructorReturn(this,(ObserveChanges.__proto__||Object.getPrototypeOf(ObserveChanges)).call(this,hotInstance));_this.observer=null;return _this;}
_createClass(ObserveChanges,[{key:'isEnabled',value:function isEnabled(){return this.hot.getSettings().observeChanges;}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
if(!this.observer){this.observer=new _dataObserver2.default(this.hot.getSourceData());this._exposePublicApi();}
this.observer.addLocalHook('change',function(patches){return _this2.onDataChange(patches);});this.addHook('afterCreateRow',function(){return _this2.onAfterTableAlter();});this.addHook('afterRemoveRow',function(){return _this2.onAfterTableAlter();});this.addHook('afterCreateCol',function(){return _this2.onAfterTableAlter();});this.addHook('afterRemoveCol',function(){return _this2.onAfterTableAlter();});this.addHook('afterChange',function(changes,source){return _this2.onAfterTableAlter(source);});this.addHook('afterLoadData',function(firstRun){return _this2.onAfterLoadData(firstRun);});_get(ObserveChanges.prototype.__proto__||Object.getPrototypeOf(ObserveChanges.prototype),'enablePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){if(this.observer){this.observer.destroy();this.observer=null;this._deletePublicApi();}
_get(ObserveChanges.prototype.__proto__||Object.getPrototypeOf(ObserveChanges.prototype),'disablePlugin',this).call(this);}},{key:'onDataChange',value:function onDataChange(patches){var _this3=this;if(!this.observer.isPaused()){var sourceName=this.pluginName+'.change';var actions={add:function add(patch){if(isNaN(patch.col)){_this3.hot.runHooks('afterCreateRow',patch.row,1,sourceName);}else{_this3.hot.runHooks('afterCreateCol',patch.col,1,sourceName);}},remove:function remove(patch){if(isNaN(patch.col)){_this3.hot.runHooks('afterRemoveRow',patch.row,1,sourceName);}else{_this3.hot.runHooks('afterRemoveCol',patch.col,1,sourceName);}},replace:function replace(patch){_this3.hot.runHooks('afterChange',[patch.row,patch.col,null,patch.value],sourceName);}};(0,_array.arrayEach)(patches,function(patch){if(actions[patch.op]){actions[patch.op](patch);}});this.hot.render();}
this.hot.runHooks('afterChangesObserved');}},{key:'onAfterTableAlter',value:function onAfterTableAlter(source){var _this4=this;if(source!=='loadData'){this.observer.pause();this.hot.addHookOnce('afterChangesObserved',function(){return _this4.observer.resume();});}}},{key:'onAfterLoadData',value:function onAfterLoadData(firstRun){if(!firstRun){this.observer.setObservedData(this.hot.getSourceData());}}},{key:'destroy',value:function destroy(){if(this.observer){this.observer.destroy();this._deletePublicApi();}
_get(ObserveChanges.prototype.__proto__||Object.getPrototypeOf(ObserveChanges.prototype),'destroy',this).call(this);}},{key:'_exposePublicApi',value:function _exposePublicApi(){var _this5=this;var hot=this.hot;hot.pauseObservingChanges=function(){return _this5.observer.pause();};hot.resumeObservingChanges=function(){return _this5.observer.resume();};hot.isPausedObservingChanges=function(){return _this5.observer.isPaused();};}},{key:'_deletePublicApi',value:function _deletePublicApi(){var hot=this.hot;delete hot.pauseObservingChanges;delete hot.resumeObservingChanges;delete hot.isPausedObservingChanges;}}]);return ObserveChanges;}(_base2.default);exports.default=ObserveChanges;(0,_plugins.registerPlugin)('observeChanges',ObserveChanges);}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();exports.cleanPatches=cleanPatches;exports.parsePath=parsePath;var _array=__webpack_require__(2);function cleanPatches(patches){var newOrRemovedColumns=[];patches=(0,_array.arrayFilter)(patches,function(patch){if(/[/]length/ig.test(patch.path)){return false;}
if(!parsePath(patch.path)){return false;}
return true;});patches=(0,_array.arrayMap)(patches,function(patch){var coords=parsePath(patch.path);patch.row=coords.row;patch.col=coords.col;return patch;});patches=(0,_array.arrayFilter)(patches,function(patch){if(['add','remove'].indexOf(patch.op)!==-1&&!isNaN(patch.col)){if(newOrRemovedColumns.indexOf(patch.col)!==-1){return false;}
newOrRemovedColumns.push(patch.col);}
return true;});newOrRemovedColumns.length=0;return patches;}
function parsePath(path){var match=path.match(/^\/(\d+)\/?(.*)?$/);if(!match){return null;}
var _match=_slicedToArray(match,3),row=_match[1],column=_match[2];return{row:parseInt(row,10),col:/^\d*$/.test(column)?parseInt(column,10):column};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _plugins=__webpack_require__(5);var _object=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function Storage(prefix){var savedKeys;var saveSavedKeys=function saveSavedKeys(){window.localStorage[prefix+'__persistentStateKeys']=JSON.stringify(savedKeys);};var loadSavedKeys=function loadSavedKeys(){var keysJSON=window.localStorage[prefix+'__persistentStateKeys'];var keys=typeof keysJSON=='string'?JSON.parse(keysJSON):void 0;savedKeys=keys?keys:[];};var clearSavedKeys=function clearSavedKeys(){savedKeys=[];saveSavedKeys();};loadSavedKeys();this.saveValue=function(key,value){window.localStorage[prefix+'_'+key]=JSON.stringify(value);if(savedKeys.indexOf(key)==-1){savedKeys.push(key);saveSavedKeys();}};this.loadValue=function(key,defaultValue){key=typeof key==='undefined'?defaultValue:key;var value=window.localStorage[prefix+'_'+key];return typeof value=='undefined'?void 0:JSON.parse(value);};this.reset=function(key){window.localStorage.removeItem(prefix+'_'+key);};this.resetAll=function(){for(var index=0;index<savedKeys.length;index++){window.localStorage.removeItem(prefix+'_'+savedKeys[index]);}
clearSavedKeys();};}
function HandsontablePersistentState(){var plugin=this;this.init=function(){var instance=this,pluginSettings=instance.getSettings().persistentState;plugin.enabled=!!pluginSettings;if(!plugin.enabled){removeHooks.call(instance);return;}
if(!instance.storage){instance.storage=new Storage(instance.rootElement.id);}
instance.resetState=plugin.resetValue;addHooks.call(instance);};this.saveValue=function(key,value){var instance=this;instance.storage.saveValue(key,value);};this.loadValue=function(key,saveTo){var instance=this;saveTo.value=instance.storage.loadValue(key);};this.resetValue=function(key){var instance=this;if(typeof key==='undefined'){instance.storage.resetAll();}else{instance.storage.reset(key);}};var hooks={persistentStateSave:plugin.saveValue,persistentStateLoad:plugin.loadValue,persistentStateReset:plugin.resetValue};for(var hookName in hooks){if((0,_object.hasOwnProperty)(hooks,hookName)){_pluginHooks2.default.getSingleton().register(hookName);}}
function addHooks(){var instance=this;for(var hookName in hooks){if((0,_object.hasOwnProperty)(hooks,hookName)){instance.addHook(hookName,hooks[hookName]);}}}
function removeHooks(){var instance=this;for(var hookName in hooks){if((0,_object.hasOwnProperty)(hooks,hookName)){instance.removeHook(hookName,hooks[hookName]);}}}}
var htPersistentState=new HandsontablePersistentState();_pluginHooks2.default.getSingleton().add('beforeInit',htPersistentState.init);_pluginHooks2.default.getSingleton().add('afterUpdateSettings',htPersistentState.init);exports.default=HandsontablePersistentState;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _element=__webpack_require__(0);var _renderers=__webpack_require__(9);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function Search(instance){this.query=function(queryStr,callback,queryMethod){var rowCount=instance.countRows();var colCount=instance.countCols();var queryResult=[];if(!callback){callback=Search.global.getDefaultCallback();}
if(!queryMethod){queryMethod=Search.global.getDefaultQueryMethod();}
for(var rowIndex=0;rowIndex<rowCount;rowIndex++){for(var colIndex=0;colIndex<colCount;colIndex++){var cellData=instance.getDataAtCell(rowIndex,colIndex);var cellProperties=instance.getCellMeta(rowIndex,colIndex);var cellCallback=cellProperties.search.callback||callback;var cellQueryMethod=cellProperties.search.queryMethod||queryMethod;var testResult=cellQueryMethod(queryStr,cellData);if(testResult){var singleResult={row:rowIndex,col:colIndex,data:cellData};queryResult.push(singleResult);}
if(cellCallback){cellCallback(instance,rowIndex,colIndex,cellData,testResult);}}}
return queryResult;};};Search.DEFAULT_CALLBACK=function(instance,row,col,data,testResult){instance.getCellMeta(row,col).isSearchResult=testResult;};Search.DEFAULT_QUERY_METHOD=function(query,value){if(typeof query=='undefined'||query==null||!query.toLowerCase||query.length===0){return false;}
if(typeof value=='undefined'||value==null){return false;}
return value.toString().toLowerCase().indexOf(query.toLowerCase())!=-1;};Search.DEFAULT_SEARCH_RESULT_CLASS='htSearchResult';Search.global=function(){var defaultCallback=Search.DEFAULT_CALLBACK;var defaultQueryMethod=Search.DEFAULT_QUERY_METHOD;var defaultSearchResultClass=Search.DEFAULT_SEARCH_RESULT_CLASS;return{getDefaultCallback:function getDefaultCallback(){return defaultCallback;},setDefaultCallback:function setDefaultCallback(newDefaultCallback){defaultCallback=newDefaultCallback;},getDefaultQueryMethod:function getDefaultQueryMethod(){return defaultQueryMethod;},setDefaultQueryMethod:function setDefaultQueryMethod(newDefaultQueryMethod){defaultQueryMethod=newDefaultQueryMethod;},getDefaultSearchResultClass:function getDefaultSearchResultClass(){return defaultSearchResultClass;},setDefaultSearchResultClass:function setDefaultSearchResultClass(newSearchResultClass){defaultSearchResultClass=newSearchResultClass;}};}();function SearchCellDecorator(instance,TD,row,col,prop,value,cellProperties){var searchResultClass=cellProperties.search!==null&&_typeof(cellProperties.search)=='object'&&cellProperties.search.searchResultClass||Search.global.getDefaultSearchResultClass();if(cellProperties.isSearchResult){(0,_element.addClass)(TD,searchResultClass);}else{(0,_element.removeClass)(TD,searchResultClass);}};var originalBaseRenderer=(0,_renderers.getRenderer)('base');(0,_renderers.registerRenderer)('base',function(instance,TD,row,col,prop,value,cellProperties){originalBaseRenderer.apply(this,arguments);SearchCellDecorator.apply(this,arguments);});function init(){var instance=this;var pluginEnabled=!!instance.getSettings().search;if(pluginEnabled){instance.search=new Search(instance);}else{delete instance.search;}}
_pluginHooks2.default.getSingleton().add('afterInit',init);_pluginHooks2.default.getSingleton().add('afterUpdateSettings',init);exports.default=Search;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _element=__webpack_require__(0);var _array=__webpack_require__(2);var _base=__webpack_require__(12);var _base2=_interopRequireDefault(_base);var _plugins=__webpack_require__(5);var _feature=__webpack_require__(34);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}
function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var TouchScroll=function(_BasePlugin){_inherits(TouchScroll,_BasePlugin);function TouchScroll(hotInstance){_classCallCheck(this,TouchScroll);var _this=_possibleConstructorReturn(this,(TouchScroll.__proto__||Object.getPrototypeOf(TouchScroll)).call(this,hotInstance));_this.scrollbars=[];_this.clones=[];_this.lockedCollection=false;_this.freezeOverlays=false;return _this;}
_createClass(TouchScroll,[{key:'isEnabled',value:function isEnabled(){return(0,_feature.isTouchSupported)();}},{key:'enablePlugin',value:function enablePlugin(){var _this2=this;if(this.enabled){return;}
this.addHook('afterRender',function(){return _this2.onAfterRender();});this.registerEvents();_get(TouchScroll.prototype.__proto__||Object.getPrototypeOf(TouchScroll.prototype),'enablePlugin',this).call(this);}},{key:'updatePlugin',value:function updatePlugin(){this.lockedCollection=false;_get(TouchScroll.prototype.__proto__||Object.getPrototypeOf(TouchScroll.prototype),'updatePlugin',this).call(this);}},{key:'disablePlugin',value:function disablePlugin(){_get(TouchScroll.prototype.__proto__||Object.getPrototypeOf(TouchScroll.prototype),'disablePlugin',this).call(this);}},{key:'registerEvents',value:function registerEvents(){var _this3=this;this.addHook('beforeTouchScroll',function(){return _this3.onBeforeTouchScroll();});this.addHook('afterMomentumScroll',function(){return _this3.onAfterMomentumScroll();});}},{key:'onAfterRender',value:function onAfterRender(){if(this.lockedCollection){return;}
var _hot$view$wt$wtOverla=this.hot.view.wt.wtOverlays,topOverlay=_hot$view$wt$wtOverla.topOverlay,bottomOverlay=_hot$view$wt$wtOverla.bottomOverlay,leftOverlay=_hot$view$wt$wtOverla.leftOverlay,topLeftCornerOverlay=_hot$view$wt$wtOverla.topLeftCornerOverlay,bottomLeftCornerOverlay=_hot$view$wt$wtOverla.bottomLeftCornerOverlay;this.lockedCollection=true;this.scrollbars.length=0;this.scrollbars.push(topOverlay);if(bottomOverlay.clone){this.scrollbars.push(bottomOverlay);}
this.scrollbars.push(leftOverlay);if(topLeftCornerOverlay){this.scrollbars.push(topLeftCornerOverlay);}
if(bottomLeftCornerOverlay&&bottomLeftCornerOverlay.clone){this.scrollbars.push(bottomLeftCornerOverlay);}
this.clones.length=0;if(topOverlay.needFullRender){this.clones.push(topOverlay.clone.wtTable.holder.parentNode);}
if(bottomOverlay.needFullRender){this.clones.push(bottomOverlay.clone.wtTable.holder.parentNode);}
if(leftOverlay.needFullRender){this.clones.push(leftOverlay.clone.wtTable.holder.parentNode);}
if(topLeftCornerOverlay){this.clones.push(topLeftCornerOverlay.clone.wtTable.holder.parentNode);}
if(bottomLeftCornerOverlay&&bottomLeftCornerOverlay.clone){this.clones.push(bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);}}},{key:'onBeforeTouchScroll',value:function onBeforeTouchScroll(){this.freezeOverlays=true;(0,_array.arrayEach)(this.clones,function(clone){(0,_element.addClass)(clone,'hide-tween');});}},{key:'onAfterMomentumScroll',value:function onAfterMomentumScroll(){var _this4=this;this.freezeOverlays=false;(0,_array.arrayEach)(this.clones,function(clone){(0,_element.removeClass)(clone,'hide-tween');(0,_element.addClass)(clone,'show-tween');});setTimeout(function(){(0,_array.arrayEach)(_this4.clones,function(clone){(0,_element.removeClass)(clone,'show-tween');});},400);(0,_array.arrayEach)(this.scrollbars,function(scrollbar){scrollbar.refresh();scrollbar.resetFixedPosition();});this.hot.view.wt.wtOverlays.syncScrollWithMaster();}}]);return TouchScroll;}(_base2.default);(0,_plugins.registerPlugin)('touchScroll',TouchScroll);exports.default=TouchScroll;}),(function(module,exports,__webpack_require__){"use strict";var _pluginHooks=__webpack_require__(8);var _pluginHooks2=_interopRequireDefault(_pluginHooks);var _array=__webpack_require__(2);var _number=__webpack_require__(6);var _object=__webpack_require__(1);var _event=__webpack_require__(7);var _src=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function UndoRedo(instance){var plugin=this;this.instance=instance;this.doneActions=[];this.undoneActions=[];this.ignoreNewActions=false;instance.addHook('afterChange',function(changes,source){if(changes&&source!=='UndoRedo.undo'&&source!=='UndoRedo.redo'){plugin.done(new UndoRedo.ChangeAction(changes));}});instance.addHook('afterCreateRow',function(index,amount,source){if(source==='UndoRedo.undo'||source==='UndoRedo.undo'||source==='auto'){return;}
var action=new UndoRedo.CreateRowAction(index,amount);plugin.done(action);});instance.addHook('beforeRemoveRow',function(index,amount,logicRows,source){if(source==='UndoRedo.undo'||source==='UndoRedo.redo'||source==='auto'){return;}
var originalData=plugin.instance.getSourceDataArray();index=(originalData.length+index)%originalData.length;var removedData=(0,_object.deepClone)(originalData.slice(index,index+amount));plugin.done(new UndoRedo.RemoveRowAction(index,removedData));});instance.addHook('afterCreateCol',function(index,amount,source){if(source==='UndoRedo.undo'||source==='UndoRedo.redo'||source==='auto'){return;}
plugin.done(new UndoRedo.CreateColumnAction(index,amount));});instance.addHook('beforeRemoveCol',function(index,amount,logicColumns,source){if(source==='UndoRedo.undo'||source==='UndoRedo.redo'||source==='auto'){return;}
var originalData=plugin.instance.getSourceDataArray();index=(plugin.instance.countCols()+index)%plugin.instance.countCols();var removedData=[];var headers=[];var indexes=[];(0,_number.rangeEach)(originalData.length-1,function(i){var column=[];var origRow=originalData[i];(0,_number.rangeEach)(index,index+(amount-1),function(j){column.push(origRow[instance.runHooks('modifyCol',j)]);});removedData.push(column);});(0,_number.rangeEach)(amount-1,function(i){indexes.push(instance.runHooks('modifyCol',index+i));});if(Array.isArray(instance.getSettings().colHeaders)){(0,_number.rangeEach)(amount-1,function(i){headers.push(instance.getSettings().colHeaders[instance.runHooks('modifyCol',index+i)]||null);});}
var manualColumnMovePlugin=plugin.instance.getPlugin('manualColumnMove');var columnsMap=manualColumnMovePlugin.isEnabled()?manualColumnMovePlugin.columnsMapper.__arrayMap:[];var action=new UndoRedo.RemoveColumnAction(index,indexes,removedData,headers,columnsMap);plugin.done(action);});instance.addHook('beforeCellAlignment',function(stateBefore,range,type,alignment){var action=new UndoRedo.CellAlignmentAction(stateBefore,range,type,alignment);plugin.done(action);});instance.addHook('beforeFilter',function(conditionsStack){plugin.done(new UndoRedo.FiltersAction(conditionsStack));});instance.addHook('beforeRowMove',function(movedRows,target){if(movedRows===false){return;}
plugin.done(new UndoRedo.RowMoveAction(movedRows,target));});};UndoRedo.prototype.done=function(action){if(!this.ignoreNewActions){this.doneActions.push(action);this.undoneActions.length=0;}};UndoRedo.prototype.undo=function(){if(this.isUndoAvailable()){var action=this.doneActions.pop();var actionClone=(0,_object.deepClone)(action);var instance=this.instance;var continueAction=instance.runHooks('beforeUndo',actionClone);if(continueAction===false){return;}
this.ignoreNewActions=true;var that=this;action.undo(this.instance,function(){that.ignoreNewActions=false;that.undoneActions.push(action);});instance.runHooks('afterUndo',actionClone);}};UndoRedo.prototype.redo=function(){if(this.isRedoAvailable()){var action=this.undoneActions.pop();var actionClone=(0,_object.deepClone)(action);var instance=this.instance;var continueAction=instance.runHooks('beforeRedo',actionClone);if(continueAction===false){return;}
this.ignoreNewActions=true;var that=this;action.redo(this.instance,function(){that.ignoreNewActions=false;that.doneActions.push(action);});instance.runHooks('afterRedo',actionClone);}};UndoRedo.prototype.isUndoAvailable=function(){return this.doneActions.length>0;};UndoRedo.prototype.isRedoAvailable=function(){return this.undoneActions.length>0;};UndoRedo.prototype.clear=function(){this.doneActions.length=0;this.undoneActions.length=0;};UndoRedo.Action=function(){};UndoRedo.Action.prototype.undo=function(){};UndoRedo.Action.prototype.redo=function(){};UndoRedo.ChangeAction=function(changes){this.changes=changes;this.actionType='change';};(0,_object.inherit)(UndoRedo.ChangeAction,UndoRedo.Action);UndoRedo.ChangeAction.prototype.undo=function(instance,undoneCallback){var data=(0,_object.deepClone)(this.changes),emptyRowsAtTheEnd=instance.countEmptyRows(true),emptyColsAtTheEnd=instance.countEmptyCols(true);for(var i=0,len=data.length;i<len;i++){data[i].splice(3,1);}
instance.addHookOnce('afterChange',undoneCallback);instance.setDataAtRowProp(data,null,null,'UndoRedo.undo');for(var _i=0,_len=data.length;_i<_len;_i++){if(instance.getSettings().minSpareRows&&data[_i][0]+1+instance.getSettings().minSpareRows===instance.countRows()&&emptyRowsAtTheEnd==instance.getSettings().minSpareRows){instance.alter('remove_row',parseInt(data[_i][0]+1,10),instance.getSettings().minSpareRows);instance.undoRedo.doneActions.pop();}
if(instance.getSettings().minSpareCols&&data[_i][1]+1+instance.getSettings().minSpareCols===instance.countCols()&&emptyColsAtTheEnd==instance.getSettings().minSpareCols){instance.alter('remove_col',parseInt(data[_i][1]+1,10),instance.getSettings().minSpareCols);instance.undoRedo.doneActions.pop();}}};UndoRedo.ChangeAction.prototype.redo=function(instance,onFinishCallback){var data=(0,_object.deepClone)(this.changes);for(var i=0,len=data.length;i<len;i++){data[i].splice(2,1);}
instance.addHookOnce('afterChange',onFinishCallback);instance.setDataAtRowProp(data,null,null,'UndoRedo.redo');};UndoRedo.CreateRowAction=function(index,amount){this.index=index;this.amount=amount;this.actionType='insert_row';};(0,_object.inherit)(UndoRedo.CreateRowAction,UndoRedo.Action);UndoRedo.CreateRowAction.prototype.undo=function(instance,undoneCallback){var rowCount=instance.countRows(),minSpareRows=instance.getSettings().minSpareRows;if(this.index>=rowCount&&this.index-minSpareRows<rowCount){this.index-=minSpareRows;}
instance.addHookOnce('afterRemoveRow',undoneCallback);instance.alter('remove_row',this.index,this.amount,'UndoRedo.undo');};UndoRedo.CreateRowAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce('afterCreateRow',redoneCallback);instance.alter('insert_row',this.index,this.amount,'UndoRedo.redo');};UndoRedo.RemoveRowAction=function(index,data){this.index=index;this.data=data;this.actionType='remove_row';};(0,_object.inherit)(UndoRedo.RemoveRowAction,UndoRedo.Action);UndoRedo.RemoveRowAction.prototype.undo=function(instance,undoneCallback){instance.alter('insert_row',this.index,this.data.length,'UndoRedo.undo');instance.addHookOnce('afterRender',undoneCallback);instance.populateFromArray(this.index,0,this.data,void 0,void 0,'UndoRedo.undo');};UndoRedo.RemoveRowAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce('afterRemoveRow',redoneCallback);instance.alter('remove_row',this.index,this.data.length,'UndoRedo.redo');};UndoRedo.CreateColumnAction=function(index,amount){this.index=index;this.amount=amount;this.actionType='insert_col';};(0,_object.inherit)(UndoRedo.CreateColumnAction,UndoRedo.Action);UndoRedo.CreateColumnAction.prototype.undo=function(instance,undoneCallback){instance.addHookOnce('afterRemoveCol',undoneCallback);instance.alter('remove_col',this.index,this.amount,'UndoRedo.undo');};UndoRedo.CreateColumnAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce('afterCreateCol',redoneCallback);instance.alter('insert_col',this.index,this.amount,'UndoRedo.redo');};UndoRedo.RemoveColumnAction=function(index,indexes,data,headers,columnPositions){this.index=index;this.indexes=indexes;this.data=data;this.amount=this.data[0].length;this.headers=headers;this.columnPositions=columnPositions.slice(0);this.actionType='remove_col';};(0,_object.inherit)(UndoRedo.RemoveColumnAction,UndoRedo.Action);UndoRedo.RemoveColumnAction.prototype.undo=function(instance,undoneCallback){var _this=this;var row=void 0;var ascendingIndexes=this.indexes.slice(0).sort();var sortByIndexes=function sortByIndexes(elem,j,arr){return arr[_this.indexes.indexOf(ascendingIndexes[j])];};var sortedData=[];(0,_number.rangeEach)(this.data.length-1,function(i){sortedData[i]=(0,_array.arrayMap)(_this.data[i],sortByIndexes);});var sortedHeaders=[];sortedHeaders=(0,_array.arrayMap)(this.headers,sortByIndexes);var changes=[];instance.runHooks('beforeCreateCol',this.indexes[0],this.indexes[this.indexes.length-1],'UndoRedo.undo');(0,_number.rangeEach)(this.data.length-1,function(i){row=instance.getSourceDataAtRow(i);(0,_number.rangeEach)(ascendingIndexes.length-1,function(j){row.splice(ascendingIndexes[j],0,sortedData[i][j]);changes.push([i,ascendingIndexes[j],null,sortedData[i][j]]);});});if(instance.getPlugin('formulas')){instance.getPlugin('formulas').onAfterSetDataAtCell(changes);}
if(typeof this.headers!=='undefined'){(0,_number.rangeEach)(sortedHeaders.length-1,function(j){instance.getSettings().colHeaders.splice(ascendingIndexes[j],0,sortedHeaders[j]);});}
if(instance.getPlugin('manualColumnMove')){instance.getPlugin('manualColumnMove').columnsMapper.__arrayMap=this.columnPositions;}
instance.addHookOnce('afterRender',undoneCallback);instance.runHooks('afterCreateCol',this.indexes[0],this.indexes[this.indexes.length-1],'UndoRedo.undo');if(instance.getPlugin('formulas')){instance.getPlugin('formulas').recalculateFull();}
instance.render();};UndoRedo.RemoveColumnAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce('afterRemoveCol',redoneCallback);instance.alter('remove_col',this.index,this.amount,'UndoRedo.redo');};UndoRedo.CellAlignmentAction=function(stateBefore,range,type,alignment){this.stateBefore=stateBefore;this.range=range;this.type=type;this.alignment=alignment;};UndoRedo.CellAlignmentAction.prototype.undo=function(instance,undoneCallback){if(!instance.getPlugin('contextMenu').isEnabled()){return;}
for(var row=this.range.from.row;row<=this.range.to.row;row++){for(var col=this.range.from.col;col<=this.range.to.col;col++){instance.setCellMeta(row,col,'className',this.stateBefore[row][col]||' htLeft');}}
instance.addHookOnce('afterRender',undoneCallback);instance.render();};UndoRedo.CellAlignmentAction.prototype.redo=function(instance,undoneCallback){if(!instance.getPlugin('contextMenu').isEnabled()){return;}
instance.selectCell(this.range.from.row,this.range.from.col,this.range.to.row,this.range.to.col);instance.getPlugin('contextMenu').executeCommand('alignment:'+this.alignment.replace('ht','').toLowerCase());instance.addHookOnce('afterRender',undoneCallback);instance.render();};UndoRedo.FiltersAction=function(conditionsStack){this.conditionsStack=conditionsStack;this.actionType='filter';};(0,_object.inherit)(UndoRedo.FiltersAction,UndoRedo.Action);UndoRedo.FiltersAction.prototype.undo=function(instance,undoneCallback){var filters=instance.getPlugin('filters');instance.addHookOnce('afterRender',undoneCallback);filters.conditionCollection.importAllConditions(this.conditionsStack.slice(0,this.conditionsStack.length-1));filters.filter();};UndoRedo.FiltersAction.prototype.redo=function(instance,redoneCallback){var filters=instance.getPlugin('filters');instance.addHookOnce('afterRender',redoneCallback);filters.conditionCollection.importAllConditions(this.conditionsStack);filters.filter();};UndoRedo.RowMoveAction=function(movedRows,target){this.rows=movedRows.slice();this.target=target;};(0,_object.inherit)(UndoRedo.RowMoveAction,UndoRedo.Action);UndoRedo.RowMoveAction.prototype.undo=function(instance,undoneCallback){var manualRowMove=instance.getPlugin('manualRowMove');instance.addHookOnce('afterRender',undoneCallback);var mod=this.rows[0]<this.target?-1*this.rows.length:0;var newTarget=this.rows[0]>this.target?this.rows[0]+this.rows.length:this.rows[0];var newRows=[];var rowsLen=this.rows.length+mod;for(var i=mod;i<rowsLen;i++){newRows.push(this.target+i);}
manualRowMove.moveRows(newRows.slice(),newTarget);instance.render();instance.selection.setRangeStartOnly(new _src.CellCoords(this.rows[0],0));instance.selection.setRangeEnd(new _src.CellCoords(this.rows[this.rows.length-1],instance.countCols()-1));};UndoRedo.RowMoveAction.prototype.redo=function(instance,redoneCallback){var manualRowMove=instance.getPlugin('manualRowMove');instance.addHookOnce('afterRender',redoneCallback);manualRowMove.moveRows(this.rows.slice(),this.target);instance.render();var startSelection=this.rows[0]<this.target?this.target-this.rows.length:this.target;instance.selection.setRangeStartOnly(new _src.CellCoords(startSelection,0));instance.selection.setRangeEnd(new _src.CellCoords(startSelection+this.rows.length-1,instance.countCols()-1));};function init(){var instance=this;var pluginEnabled=typeof instance.getSettings().undo=='undefined'||instance.getSettings().undo;if(pluginEnabled){if(!instance.undoRedo){instance.undoRedo=new UndoRedo(instance);exposeUndoRedoMethods(instance);instance.addHook('beforeKeyDown',onBeforeKeyDown);instance.addHook('afterChange',onAfterChange);}}else if(instance.undoRedo){delete instance.undoRedo;removeExposedUndoRedoMethods(instance);instance.removeHook('beforeKeyDown',onBeforeKeyDown);instance.removeHook('afterChange',onAfterChange);}}
function onBeforeKeyDown(event){var instance=this;var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(ctrlDown){if(event.keyCode===89||event.shiftKey&&event.keyCode===90){instance.undoRedo.redo();(0,_event.stopImmediatePropagation)(event);}else if(event.keyCode===90){instance.undoRedo.undo();(0,_event.stopImmediatePropagation)(event);}}}
function onAfterChange(changes,source){var instance=this;if(source==='loadData'){return instance.undoRedo.clear();}}
function exposeUndoRedoMethods(instance){instance.undo=function(){return instance.undoRedo.undo();};instance.redo=function(){return instance.undoRedo.redo();};instance.isUndoAvailable=function(){return instance.undoRedo.isUndoAvailable();};instance.isRedoAvailable=function(){return instance.undoRedo.isRedoAvailable();};instance.clearUndo=function(){return instance.undoRedo.clear();};}
function removeExposedUndoRedoMethods(instance){delete instance.undo;delete instance.redo;delete instance.isUndoAvailable;delete instance.isRedoAvailable;delete instance.clearUndo;}
var hook=_pluginHooks2.default.getSingleton();hook.add('afterInit',init);hook.add('afterUpdateSettings',init);hook.register('beforeUndo');hook.register('afterUndo');hook.register('beforeRedo');hook.register('afterRedo');}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);function cellDecorator(instance,TD,row,col,prop,value,cellProperties){if(cellProperties.className){if(TD.className){TD.className=TD.className+' '+cellProperties.className;}else{TD.className=cellProperties.className;}}
if(cellProperties.readOnly){(0,_element.addClass)(TD,cellProperties.readOnlyCellClassName);}
if(cellProperties.valid===false&&cellProperties.invalidCellClassName){(0,_element.addClass)(TD,cellProperties.invalidCellClassName);}else{(0,_element.removeClass)(TD,cellProperties.invalidCellClassName);}
if(cellProperties.wordWrap===false&&cellProperties.noWordWrapClassName){(0,_element.addClass)(TD,cellProperties.noWordWrapClassName);}
if(!value&&cellProperties.placeholder){(0,_element.addClass)(TD,cellProperties.placeholderCellClassName);}}
exports.default=cellDecorator;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _src=__webpack_require__(11);var _index=__webpack_require__(9);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var clonableWRAPPER=document.createElement('DIV');clonableWRAPPER.className='htAutocompleteWrapper';var clonableARROW=document.createElement('DIV');clonableARROW.className='htAutocompleteArrow';clonableARROW.appendChild(document.createTextNode(String.fromCharCode(9660)));var wrapTdContentWithWrapper=function wrapTdContentWithWrapper(TD,WRAPPER){WRAPPER.innerHTML=TD.innerHTML;(0,_element.empty)(TD);TD.appendChild(WRAPPER);};function autocompleteRenderer(instance,TD,row,col,prop,value,cellProperties){var WRAPPER=clonableWRAPPER.cloneNode(true);var ARROW=clonableARROW.cloneNode(true);if(cellProperties.allowHtml){(0,_index.getRenderer)('html').apply(this,arguments);}else{(0,_index.getRenderer)('text').apply(this,arguments);}
TD.appendChild(ARROW);(0,_element.addClass)(TD,'htAutocomplete');if(!TD.firstChild){TD.appendChild(document.createTextNode(String.fromCharCode(160)));}
if(!instance.acArrowListener){var eventManager=new _eventManager2.default(instance);instance.acArrowListener=function(event){if((0,_element.hasClass)(event.target,'htAutocompleteArrow')){instance.view.wt.getSetting('onCellDblClick',null,new _src.CellCoords(row,col),TD);}};eventManager.addEventListener(instance.rootElement,'mousedown',instance.acArrowListener);instance.addHookOnce('afterDestroy',function(){eventManager.destroy();});}}
exports.default=autocompleteRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _string=__webpack_require__(27);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _unicode=__webpack_require__(16);var _function=__webpack_require__(35);var _event=__webpack_require__(7);var _index=__webpack_require__(9);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var isListeningKeyDownEvent=new WeakMap();var isCheckboxListenerAdded=new WeakMap();var BAD_VALUE_CLASS='htBadValue';function checkboxRenderer(instance,TD,row,col,prop,value,cellProperties){(0,_index.getRenderer)('base').apply(this,arguments);var eventManager=registerEvents(instance);var input=createInput();var labelOptions=cellProperties.label;var badValue=false;if(typeof cellProperties.checkedTemplate==='undefined'){cellProperties.checkedTemplate=true;}
if(typeof cellProperties.uncheckedTemplate==='undefined'){cellProperties.uncheckedTemplate=false;}
(0,_element.empty)(TD);if(value===cellProperties.checkedTemplate||(0,_string.equalsIgnoreCase)(value,cellProperties.checkedTemplate)){input.checked=true;}else if(value===cellProperties.uncheckedTemplate||(0,_string.equalsIgnoreCase)(value,cellProperties.uncheckedTemplate)){input.checked=false;}else if(value===null){(0,_element.addClass)(input,'noValue');}else{input.style.display='none';(0,_element.addClass)(input,BAD_VALUE_CLASS);badValue=true;}
input.setAttribute('data-row',row);input.setAttribute('data-col',col);if(!badValue&&labelOptions){var labelText='';if(labelOptions.value){labelText=typeof labelOptions.value==='function'?labelOptions.value.call(this,row,col,prop,value):labelOptions.value;}else if(labelOptions.property){labelText=instance.getDataAtRowProp(row,labelOptions.property);}
var label=createLabel(labelText);if(labelOptions.position==='before'){label.appendChild(input);}else{label.insertBefore(input,label.firstChild);}
input=label;}
TD.appendChild(input);if(badValue){TD.appendChild(document.createTextNode('#bad-value#'));}
if(!isListeningKeyDownEvent.has(instance)){isListeningKeyDownEvent.set(instance,true);instance.addHook('beforeKeyDown',onBeforeKeyDown);}
function onBeforeKeyDown(event){var toggleKeys='SPACE|ENTER';var switchOffKeys='DELETE|BACKSPACE';var isKeyCode=(0,_function.partial)(_unicode.isKey,event.keyCode);if(isKeyCode(toggleKeys+'|'+switchOffKeys)&&!(0,_event.isImmediatePropagationStopped)(event)){eachSelectedCheckboxCell(function(){(0,_event.stopImmediatePropagation)(event);event.preventDefault();});}
if(isKeyCode(toggleKeys)){changeSelectedCheckboxesState();}
if(isKeyCode(switchOffKeys)){changeSelectedCheckboxesState(true);}}
function changeSelectedCheckboxesState(){var uncheckCheckbox=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var selRange=instance.getSelectedRange();if(!selRange){return;}
var topLeft=selRange.getTopLeftCorner();var bottomRight=selRange.getBottomRightCorner();var changes=[];for(var _row=topLeft.row;_row<=bottomRight.row;_row+=1){for(var _col=topLeft.col;_col<=bottomRight.col;_col+=1){var _cellProperties=instance.getCellMeta(_row,_col);if(_cellProperties.type!=='checkbox'){return;}
if(_cellProperties.readOnly===true){continue;}
if(typeof _cellProperties.checkedTemplate==='undefined'){_cellProperties.checkedTemplate=true;}
if(typeof _cellProperties.uncheckedTemplate==='undefined'){_cellProperties.uncheckedTemplate=false;}
var dataAtCell=instance.getDataAtCell(_row,_col);if(uncheckCheckbox===false){if(dataAtCell===_cellProperties.checkedTemplate){changes.push([_row,_col,_cellProperties.uncheckedTemplate]);}else if([_cellProperties.uncheckedTemplate,null,void 0].indexOf(dataAtCell)!==-1){changes.push([_row,_col,_cellProperties.checkedTemplate]);}}else{changes.push([_row,_col,_cellProperties.uncheckedTemplate]);}}}
if(changes.length>0){instance.setDataAtCell(changes);}}
function eachSelectedCheckboxCell(callback){var selRange=instance.getSelectedRange();if(!selRange){return;}
var topLeft=selRange.getTopLeftCorner();var bottomRight=selRange.getBottomRightCorner();for(var _row2=topLeft.row;_row2<=bottomRight.row;_row2++){for(var _col2=topLeft.col;_col2<=bottomRight.col;_col2++){var _cellProperties2=instance.getCellMeta(_row2,_col2);if(_cellProperties2.type!=='checkbox'){return;}
var cell=instance.getCell(_row2,_col2);if(cell==null){callback(_row2,_col2,_cellProperties2);}else{var checkboxes=cell.querySelectorAll('input[type=checkbox]');if(checkboxes.length>0&&!_cellProperties2.readOnly){callback(checkboxes);}}}}}}
function registerEvents(instance){var eventManager=isCheckboxListenerAdded.get(instance);if(!eventManager){eventManager=new _eventManager2.default(instance);eventManager.addEventListener(instance.rootElement,'click',function(event){return onClick(event,instance);});eventManager.addEventListener(instance.rootElement,'mouseup',function(event){return onMouseUp(event,instance);});eventManager.addEventListener(instance.rootElement,'change',function(event){return onChange(event,instance);});isCheckboxListenerAdded.set(instance,eventManager);}
return eventManager;}
function createInput(){var input=document.createElement('input');input.className='htCheckboxRendererInput';input.type='checkbox';input.setAttribute('autocomplete','off');input.setAttribute('tabindex','-1');return input.cloneNode(false);}
function createLabel(text){var label=document.createElement('label');label.className='htCheckboxRendererLabel';label.appendChild(document.createTextNode(text));return label.cloneNode(true);}
function onMouseUp(event,instance){if(!isCheckboxInput(event.target)){return;}
setTimeout(instance.listen,10);}
function onClick(event,instance){if(!isCheckboxInput(event.target)){return false;}
var row=parseInt(event.target.getAttribute('data-row'),10);var col=parseInt(event.target.getAttribute('data-col'),10);var cellProperties=instance.getCellMeta(row,col);if(cellProperties.readOnly){event.preventDefault();}}
function onChange(event,instance){if(!isCheckboxInput(event.target)){return false;}
var row=parseInt(event.target.getAttribute('data-row'),10);var col=parseInt(event.target.getAttribute('data-col'),10);var cellProperties=instance.getCellMeta(row,col);if(!cellProperties.readOnly){var newCheckboxValue=null;if(event.target.checked){newCheckboxValue=cellProperties.uncheckedTemplate===void 0?true:cellProperties.checkedTemplate;}else{newCheckboxValue=cellProperties.uncheckedTemplate===void 0?false:cellProperties.uncheckedTemplate;}
instance.setDataAtCell(row,col,newCheckboxValue);}}
function isCheckboxInput(element){return element.tagName==='INPUT'&&element.getAttribute('type')==='checkbox';}
exports.default=checkboxRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _index=__webpack_require__(9);function htmlRenderer(instance,TD,row,col,prop,value,cellProperties){(0,_index.getRenderer)('base').apply(this,arguments);if(value===null||value===void 0){value='';}
(0,_element.fastInnerHTML)(TD,value);}
exports.default=htmlRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _numbro=__webpack_require__(87);var _numbro2=_interopRequireDefault(_numbro);var _index=__webpack_require__(9);var _number=__webpack_require__(6);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function numericRenderer(instance,TD,row,col,prop,value,cellProperties){if((0,_number.isNumeric)(value)){if(typeof cellProperties.language!=='undefined'){_numbro2.default.culture(cellProperties.language);}
value=(0,_numbro2.default)(value).format(cellProperties.format||'0');var className=cellProperties.className||'';var classArr=className.length?className.split(' '):[];if(classArr.indexOf('htLeft')<0&&classArr.indexOf('htCenter')<0&&classArr.indexOf('htRight')<0&&classArr.indexOf('htJustify')<0){classArr.push('htRight');}
if(classArr.indexOf('htNumeric')<0){classArr.push('htNumeric');}
cellProperties.className=classArr.join(' ');}
(0,_index.getRenderer)('text')(instance,TD,row,col,prop,value,cellProperties);}
exports.default=numericRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _index=__webpack_require__(9);var _number=__webpack_require__(6);function passwordRenderer(instance,TD,row,col,prop,value,cellProperties){(0,_index.getRenderer)('text').apply(this,arguments);value=TD.innerHTML;var hashLength=cellProperties.hashLength||value.length;var hashSymbol=cellProperties.hashSymbol||'*';var hash='';(0,_number.rangeEach)(hashLength-1,function(){hash+=hashSymbol;});(0,_element.fastInnerHTML)(TD,hash);}
exports.default=passwordRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _element=__webpack_require__(0);var _mixed=__webpack_require__(20);var _index=__webpack_require__(9);function textRenderer(instance,TD,row,col,prop,value,cellProperties){(0,_index.getRenderer)('base').apply(this,arguments);if(!value&&cellProperties.placeholder){value=cellProperties.placeholder;}
var escaped=(0,_mixed.stringify)(value);if(!instance.getSettings().trimWhitespace){escaped=escaped.replace(/ /g,String.fromCharCode(160));}
if(cellProperties.rendererTemplate){(0,_element.empty)(TD);var TEMPLATE=document.createElement('TEMPLATE');TEMPLATE.setAttribute('bind','{{}}');TEMPLATE.innerHTML=cellProperties.rendererTemplate;HTMLTemplateElement.decorate(TEMPLATE);TEMPLATE.model=instance.getSourceDataAtRow(row);TD.appendChild(TEMPLATE);}else{(0,_element.fastInnerText)(TD,escaped);}}
exports.default=textRenderer;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _element=__webpack_require__(0);var _browser=__webpack_require__(25);var _eventManager=__webpack_require__(4);var _eventManager2=_interopRequireDefault(_eventManager);var _event=__webpack_require__(7);var _src=__webpack_require__(11);var _src2=_interopRequireDefault(_src);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function TableView(instance){var _this=this;var that=this;this.eventManager=new _eventManager2.default(instance);this.instance=instance;this.settings=instance.getSettings();this.selectionMouseDown=false;var originalStyle=instance.rootElement.getAttribute('style');if(originalStyle){instance.rootElement.setAttribute('data-originalstyle',originalStyle);}
(0,_element.addClass)(instance.rootElement,'handsontable');var table=document.createElement('TABLE');(0,_element.addClass)(table,'htCore');if(instance.getSettings().tableClassName){(0,_element.addClass)(table,instance.getSettings().tableClassName);}
this.THEAD=document.createElement('THEAD');table.appendChild(this.THEAD);this.TBODY=document.createElement('TBODY');table.appendChild(this.TBODY);instance.table=table;instance.container.insertBefore(table,instance.container.firstChild);this.eventManager.addEventListener(instance.rootElement,'mousedown',function(event){this.selectionMouseDown=true;if(!that.isTextSelectionAllowed(event.target)){clearTextSelection();event.preventDefault();window.focus();}});this.eventManager.addEventListener(instance.rootElement,'mouseup',function(event){this.selectionMouseDown=false;});this.eventManager.addEventListener(instance.rootElement,'mousemove',function(event){if(this.selectionMouseDown&&!that.isTextSelectionAllowed(event.target)){clearTextSelection();event.preventDefault();}});this.eventManager.addEventListener(document.documentElement,'keyup',function(event){if(instance.selection.isInProgress()&&!event.shiftKey){instance.selection.finish();}});var isMouseDown;this.isMouseDown=function(){return isMouseDown;};this.eventManager.addEventListener(document.documentElement,'mouseup',function(event){if(instance.selection.isInProgress()&&event.which===1){instance.selection.finish();}
isMouseDown=false;if((0,_element.isOutsideInput)(document.activeElement)||!instance.selection.isSelected()){instance.unlisten();}});this.eventManager.addEventListener(document.documentElement,'mousedown',function(event){var originalTarget=event.target;var next=event.target;var eventX=event.x||event.clientX;var eventY=event.y||event.clientY;if(isMouseDown||!instance.rootElement){return;}
if(next===instance.view.wt.wtTable.holder){var scrollbarWidth=(0,_element.getScrollbarWidth)();if(document.elementFromPoint(eventX+scrollbarWidth,eventY)!==instance.view.wt.wtTable.holder||document.elementFromPoint(eventX,eventY+scrollbarWidth)!==instance.view.wt.wtTable.holder){return;}}else{while(next!==document.documentElement){if(next===null){if(event.isTargetWebComponent){break;}
return;}
if(next===instance.rootElement){return;}
next=next.parentNode;}}
var outsideClickDeselects=typeof that.settings.outsideClickDeselects==='function'?that.settings.outsideClickDeselects(originalTarget):that.settings.outsideClickDeselects;if(outsideClickDeselects){instance.deselectCell();}else{instance.destroyEditor();}});this.eventManager.addEventListener(table,'selectstart',function(event){if(that.settings.fragmentSelection||(0,_element.isInput)(event.target)){return;}
event.preventDefault();});var clearTextSelection=function clearTextSelection(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty();}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges();}}else if(document.selection){document.selection.empty();}};var selections=[new _src.Selection({className:'current',border:{width:2,color:'#5292F7',cornerVisible:function cornerVisible(){return that.settings.fillHandle&&!that.isCellEdited()&&!instance.selection.isMultiple();},multipleSelectionHandlesVisible:function multipleSelectionHandlesVisible(){return!that.isCellEdited()&&!instance.selection.isMultiple();}}}),new _src.Selection({className:'area',border:{width:1,color:'#89AFF9',cornerVisible:function cornerVisible(){return that.settings.fillHandle&&!that.isCellEdited()&&instance.selection.isMultiple();},multipleSelectionHandlesVisible:function multipleSelectionHandlesVisible(){return!that.isCellEdited()&&instance.selection.isMultiple();}}}),new _src.Selection({className:'highlight',highlightHeaderClassName:that.settings.currentHeaderClassName,highlightRowClassName:that.settings.currentRowClassName,highlightColumnClassName:that.settings.currentColClassName}),new _src.Selection({className:'fill',border:{width:1,color:'red'}})];selections.current=selections[0];selections.area=selections[1];selections.highlight=selections[2];selections.fill=selections[3];var walkontableConfig={debug:function debug(){return that.settings.debug;},externalRowCalculator:this.instance.getPlugin('autoRowSize')&&this.instance.getPlugin('autoRowSize').isEnabled(),table:table,preventOverflow:function preventOverflow(){return _this.settings.preventOverflow;},stretchH:function stretchH(){return that.settings.stretchH;},data:instance.getDataAtCell,totalRows:function totalRows(){return instance.countRows();},totalColumns:function totalColumns(){return instance.countCols();},fixedColumnsLeft:function fixedColumnsLeft(){return that.settings.fixedColumnsLeft;},fixedRowsTop:function fixedRowsTop(){return that.settings.fixedRowsTop;},fixedRowsBottom:function fixedRowsBottom(){return that.settings.fixedRowsBottom;},minSpareRows:function minSpareRows(){return that.settings.minSpareRows;},renderAllRows:that.settings.renderAllRows,rowHeaders:function rowHeaders(){var headerRenderers=[];if(instance.hasRowHeaders()){headerRenderers.push(function(row,TH){that.appendRowHeader(row,TH);});}
instance.runHooks('afterGetRowHeaderRenderers',headerRenderers);return headerRenderers;},columnHeaders:function columnHeaders(){var headerRenderers=[];if(instance.hasColHeaders()){headerRenderers.push(function(column,TH){that.appendColHeader(column,TH);});}
instance.runHooks('afterGetColumnHeaderRenderers',headerRenderers);return headerRenderers;},columnWidth:instance.getColWidth,rowHeight:instance.getRowHeight,cellRenderer:function cellRenderer(row,col,TD){var cellProperties=that.instance.getCellMeta(row,col);var prop=that.instance.colToProp(col);var value=that.instance.getDataAtRowProp(row,prop);if(that.instance.hasHook('beforeValueRender')){value=that.instance.runHooks('beforeValueRender',value);}
that.instance.runHooks('beforeRenderer',TD,row,col,prop,value,cellProperties);that.instance.getCellRenderer(cellProperties)(that.instance,TD,row,col,prop,value,cellProperties);that.instance.runHooks('afterRenderer',TD,row,col,prop,value,cellProperties);},selections:selections,hideBorderOnMouseDownOver:function hideBorderOnMouseDownOver(){return that.settings.fragmentSelection;},onCellMouseDown:function onCellMouseDown(event,coords,TD,wt){var blockCalculations={row:false,column:false,cells:false};instance.listen();that.activeWt=wt;isMouseDown=true;instance.runHooks('beforeOnCellMouseDown',event,coords,TD,blockCalculations);if((0,_event.isImmediatePropagationStopped)(event)){return;}
var actualSelection=instance.getSelectedRange();var selection=instance.selection;var selectedHeader=selection.selectedHeader;if(event.shiftKey&&actualSelection){if(coords.row>=0&&coords.col>=0&&!blockCalculations.cells){selection.setSelectedHeaders(false,false);selection.setRangeEnd(coords);}else if((selectedHeader.cols||selectedHeader.rows)&&coords.row>=0&&coords.col>=0&&!blockCalculations.cells){selection.setSelectedHeaders(false,false);selection.setRangeEnd(new _src.CellCoords(coords.row,coords.col));}else if(selectedHeader.cols&&coords.row<0&&!blockCalculations.column){selection.setRangeEnd(new _src.CellCoords(actualSelection.to.row,coords.col));}else if(selectedHeader.rows&&coords.col<0&&!blockCalculations.row){selection.setRangeEnd(new _src.CellCoords(coords.row,actualSelection.to.col));}else if((!selectedHeader.cols&&!selectedHeader.rows&&coords.col<0||selectedHeader.cols&&coords.col<0)&&!blockCalculations.row){selection.setSelectedHeaders(true,false);selection.setRangeStartOnly(new _src.CellCoords(actualSelection.from.row,0));selection.setRangeEnd(new _src.CellCoords(coords.row,instance.countCols()-1));}else if((!selectedHeader.cols&&!selectedHeader.rows&&coords.row<0||selectedHeader.rows&&coords.row<0)&&!blockCalculations.column){selection.setSelectedHeaders(false,true);selection.setRangeStartOnly(new _src.CellCoords(0,actualSelection.from.col));selection.setRangeEnd(new _src.CellCoords(instance.countRows()-1,coords.col));}}else{var doNewSelection=true;if(actualSelection){var from=actualSelection.from,to=actualSelection.to;var coordsNotInSelection=!selection.inInSelection(coords);if(coords.row<0&&selectedHeader.cols){var start=Math.min(from.col,to.col);var end=Math.max(from.col,to.col);doNewSelection=coords.col<start||coords.col>end;}else if(coords.col<0&&selectedHeader.rows){var _start=Math.min(from.row,to.row);var _end=Math.max(from.row,to.row);doNewSelection=coords.row<_start||coords.row>_end;}else{doNewSelection=coordsNotInSelection;}}
var rightClick=(0,_event.isRightClick)(event);var leftClick=(0,_event.isLeftClick)(event)||event.type==='touchstart';if(coords.row<0&&coords.col>=0&&!blockCalculations.column){selection.setSelectedHeaders(false,true);if(leftClick||rightClick&&doNewSelection){selection.setRangeStartOnly(new _src.CellCoords(0,coords.col));selection.setRangeEnd(new _src.CellCoords(Math.max(instance.countRows()-1,0),coords.col),false);}}else if(coords.col<0&&coords.row>=0&&!blockCalculations.row){selection.setSelectedHeaders(true,false);if(leftClick||rightClick&&doNewSelection){selection.setRangeStartOnly(new _src.CellCoords(coords.row,0));selection.setRangeEnd(new _src.CellCoords(coords.row,Math.max(instance.countCols()-1,0)),false);}}else if(coords.col>=0&&coords.row>=0&&!blockCalculations.cells){if(leftClick||rightClick&&doNewSelection){selection.setSelectedHeaders(false,false);selection.setRangeStart(coords);}}else if(coords.col<0&&coords.row<0){coords.row=0;coords.col=0;selection.setSelectedHeaders(false,false,true);selection.setRangeStart(coords);}}
instance.runHooks('afterOnCellMouseDown',event,coords,TD);that.activeWt=that.wt;},onCellMouseOut:function onCellMouseOut(event,coords,TD,wt){that.activeWt=wt;instance.runHooks('beforeOnCellMouseOut',event,coords,TD);if((0,_event.isImmediatePropagationStopped)(event)){return;}
instance.runHooks('afterOnCellMouseOut',event,coords,TD);that.activeWt=that.wt;},onCellMouseOver:function onCellMouseOver(event,coords,TD,wt){var blockCalculations={row:false,column:false,cell:false};that.activeWt=wt;instance.runHooks('beforeOnCellMouseOver',event,coords,TD,blockCalculations);if((0,_event.isImmediatePropagationStopped)(event)){return;}
if(event.button===0&&isMouseDown){if(coords.row>=0&&coords.col>=0){if(instance.selection.selectedHeader.cols&&!blockCalculations.column){instance.selection.setRangeEnd(new _src.CellCoords(instance.countRows()-1,coords.col),false);}else if(instance.selection.selectedHeader.rows&&!blockCalculations.row){instance.selection.setRangeEnd(new _src.CellCoords(coords.row,instance.countCols()-1),false);}else if(!blockCalculations.cell){instance.selection.setRangeEnd(coords);}}else{if(instance.selection.selectedHeader.cols&&!blockCalculations.column){instance.selection.setRangeEnd(new _src.CellCoords(instance.countRows()-1,coords.col),false);}else if(instance.selection.selectedHeader.rows&&!blockCalculations.row){instance.selection.setRangeEnd(new _src.CellCoords(coords.row,instance.countCols()-1),false);}else if(!blockCalculations.cell){instance.selection.setRangeEnd(coords);}}}
instance.runHooks('afterOnCellMouseOver',event,coords,TD);that.activeWt=that.wt;},onCellMouseUp:function onCellMouseUp(event,coords,TD,wt){that.activeWt=wt;instance.runHooks('beforeOnCellMouseUp',event,coords,TD);instance.runHooks('afterOnCellMouseUp',event,coords,TD);that.activeWt=that.wt;},onCellCornerMouseDown:function onCellCornerMouseDown(event){event.preventDefault();instance.runHooks('afterOnCellCornerMouseDown',event);},onCellCornerDblClick:function onCellCornerDblClick(event){event.preventDefault();instance.runHooks('afterOnCellCornerDblClick',event);},beforeDraw:function beforeDraw(force,skipRender){that.beforeRender(force,skipRender);},onDraw:function onDraw(force){that.onDraw(force);},onScrollVertically:function onScrollVertically(){instance.runHooks('afterScrollVertically');},onScrollHorizontally:function onScrollHorizontally(){instance.runHooks('afterScrollHorizontally');},onBeforeDrawBorders:function onBeforeDrawBorders(corners,borderClassName){instance.runHooks('beforeDrawBorders',corners,borderClassName);},onBeforeTouchScroll:function onBeforeTouchScroll(){instance.runHooks('beforeTouchScroll');},onAfterMomentumScroll:function onAfterMomentumScroll(){instance.runHooks('afterMomentumScroll');},onBeforeStretchingColumnWidth:function onBeforeStretchingColumnWidth(stretchedWidth,column){return instance.runHooks('beforeStretchingColumnWidth',stretchedWidth,column);},onModifyRowHeaderWidth:function onModifyRowHeaderWidth(rowHeaderWidth){return instance.runHooks('modifyRowHeaderWidth',rowHeaderWidth);},viewportRowCalculatorOverride:function viewportRowCalculatorOverride(calc){var rows=instance.countRows();var viewportOffset=that.settings.viewportRowRenderingOffset;if(viewportOffset==='auto'&&that.settings.fixedRowsTop){viewportOffset=10;}
if(typeof viewportOffset==='number'){calc.startRow=Math.max(calc.startRow-viewportOffset,0);calc.endRow=Math.min(calc.endRow+viewportOffset,rows-1);}
if(viewportOffset==='auto'){var center=calc.startRow+calc.endRow-calc.startRow;var offset=Math.ceil(center/rows*12);calc.startRow=Math.max(calc.startRow-offset,0);calc.endRow=Math.min(calc.endRow+offset,rows-1);}
instance.runHooks('afterViewportRowCalculatorOverride',calc);},viewportColumnCalculatorOverride:function viewportColumnCalculatorOverride(calc){var cols=instance.countCols();var viewportOffset=that.settings.viewportColumnRenderingOffset;if(viewportOffset==='auto'&&that.settings.fixedColumnsLeft){viewportOffset=10;}
if(typeof viewportOffset==='number'){calc.startColumn=Math.max(calc.startColumn-viewportOffset,0);calc.endColumn=Math.min(calc.endColumn+viewportOffset,cols-1);}
if(viewportOffset==='auto'){var center=calc.startColumn+calc.endColumn-calc.startColumn;var offset=Math.ceil(center/cols*12);calc.startRow=Math.max(calc.startColumn-offset,0);calc.endColumn=Math.min(calc.endColumn+offset,cols-1);}
instance.runHooks('afterViewportColumnCalculatorOverride',calc);},rowHeaderWidth:function rowHeaderWidth(){return that.settings.rowHeaderWidth;},columnHeaderHeight:function columnHeaderHeight(){var columnHeaderHeight=instance.runHooks('modifyColumnHeaderHeight');return that.settings.columnHeaderHeight||columnHeaderHeight;}};instance.runHooks('beforeInitWalkontable',walkontableConfig);this.wt=new _src2.default(walkontableConfig);this.activeWt=this.wt;if(!(0,_browser.isChrome)()&&!(0,_browser.isSafari)()){this.eventManager.addEventListener(instance.rootElement,'wheel',function(event){event.preventDefault();var lineHeight=parseInt((0,_element.getComputedStyle)(document.body)['font-size'],10);var holder=that.wt.wtOverlays.scrollableElement;var deltaY=event.wheelDeltaY||event.deltaY;var deltaX=event.wheelDeltaX||event.deltaX;switch(event.deltaMode){case 0:holder.scrollLeft+=deltaX;holder.scrollTop+=deltaY;break;case 1:holder.scrollLeft+=deltaX*lineHeight;holder.scrollTop+=deltaY*lineHeight;break;default:break;}});}
this.eventManager.addEventListener(that.wt.wtTable.spreader,'mousedown',function(event){if(event.target===that.wt.wtTable.spreader&&event.which===3){(0,_event.stopPropagation)(event);}});this.eventManager.addEventListener(that.wt.wtTable.spreader,'contextmenu',function(event){if(event.target===that.wt.wtTable.spreader&&event.which===3){(0,_event.stopPropagation)(event);}});this.eventManager.addEventListener(document.documentElement,'click',function(){if(that.settings.observeDOMVisibility){if(that.wt.drawInterrupted){that.instance.forceFullRender=true;that.render();}}});}
TableView.prototype.isTextSelectionAllowed=function(el){if((0,_element.isInput)(el)){return true;}
var isChildOfTableBody=(0,_element.isChildOf)(el,this.instance.view.wt.wtTable.spreader);if(this.settings.fragmentSelection===true&&isChildOfTableBody){return true;}
if(this.settings.fragmentSelection==='cell'&&this.isSelectedOnlyCell()&&isChildOfTableBody){return true;}
if(!this.settings.fragmentSelection&&this.isCellEdited()&&this.isSelectedOnlyCell()){return true;}
return false;};TableView.prototype.isSelectedOnlyCell=function(){var _ref=this.instance.getSelected()||[],_ref2=_slicedToArray(_ref,4),row=_ref2[0],col=_ref2[1],rowEnd=_ref2[2],colEnd=_ref2[3];return row!==void 0&&row===rowEnd&&col===colEnd;};TableView.prototype.isCellEdited=function(){var activeEditor=this.instance.getActiveEditor();return activeEditor&&activeEditor.isOpened();};TableView.prototype.beforeRender=function(force,skipRender){if(force){this.instance.runHooks('beforeRender',this.instance.forceFullRender,skipRender);}};TableView.prototype.onDraw=function(force){if(force){this.instance.runHooks('afterRender',this.instance.forceFullRender);}};TableView.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender);this.instance.forceFullRender=false;this.instance.renderCall=false;};TableView.prototype.getCellAtCoords=function(coords,topmost){var td=this.wt.getCell(coords,topmost);if(td<0){return null;}
return td;};TableView.prototype.scrollViewport=function(coords){this.wt.scrollViewport(coords);};TableView.prototype.appendRowHeader=function(row,TH){if(TH.firstChild){var container=TH.firstChild;if(!(0,_element.hasClass)(container,'relative')){(0,_element.empty)(TH);this.appendRowHeader(row,TH);return;}
this.updateCellHeader(container.querySelector('.rowHeader'),row,this.instance.getRowHeader);}else{var div=document.createElement('div');var span=document.createElement('span');div.className='relative';span.className='rowHeader';this.updateCellHeader(span,row,this.instance.getRowHeader);div.appendChild(span);TH.appendChild(div);}
this.instance.runHooks('afterGetRowHeader',row,TH);};TableView.prototype.appendColHeader=function(col,TH){if(TH.firstChild){var container=TH.firstChild;if((0,_element.hasClass)(container,'relative')){this.updateCellHeader(container.querySelector('.colHeader'),col,this.instance.getColHeader);}else{(0,_element.empty)(TH);this.appendColHeader(col,TH);}}else{var div=document.createElement('div');var span=document.createElement('span');div.className='relative';span.className='colHeader';this.updateCellHeader(span,col,this.instance.getColHeader);div.appendChild(span);TH.appendChild(div);}
this.instance.runHooks('afterGetColHeader',col,TH);};TableView.prototype.updateCellHeader=function(element,index,content){var renderedIndex=index;var parentOverlay=this.wt.wtOverlays.getParentOverlay(element)||this.wt;if(element.parentNode){if((0,_element.hasClass)(element,'colHeader')){renderedIndex=parentOverlay.wtTable.columnFilter.sourceToRendered(index);}else if((0,_element.hasClass)(element,'rowHeader')){renderedIndex=parentOverlay.wtTable.rowFilter.sourceToRendered(index);}}
if(renderedIndex>-1){(0,_element.fastInnerHTML)(element,content(index));}else{(0,_element.fastInnerText)(element,String.fromCharCode(160));(0,_element.addClass)(element,'cornerHeader');}};TableView.prototype.maximumVisibleElementWidth=function(leftOffset){var workspaceWidth=this.wt.wtViewport.getWorkspaceWidth();var maxWidth=workspaceWidth-leftOffset;return maxWidth>0?maxWidth:0;};TableView.prototype.maximumVisibleElementHeight=function(topOffset){var workspaceHeight=this.wt.wtViewport.getWorkspaceHeight();var maxHeight=workspaceHeight-topOffset;return maxHeight>0?maxHeight:0;};TableView.prototype.mainViewIsActive=function(){return this.wt===this.activeWt;};TableView.prototype.destroy=function(){this.wt.destroy();this.eventManager.destroy();};exports.default=TableView;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var NodeStructure=function NodeStructure(data){_classCallCheck(this,NodeStructure);this.data=data;this.next=null;this.prev=null;};var LinkedList=function(){function LinkedList(){_classCallCheck(this,LinkedList);this.first=null;this.last=null;}
_createClass(LinkedList,[{key:"push",value:function push(data){var node=new NodeStructure(data);if(this.first===null){this.first=node;this.last=node;}else{var temp=this.last;this.last=node;node.prev=temp;temp.next=node;}}},{key:"unshift",value:function unshift(data){var node=new NodeStructure(data);if(this.first===null){this.first=node;this.last=node;}else{var temp=this.first;this.first=node;node.next=temp;temp.prev=node;}}},{key:"inorder",value:function inorder(callback){var temp=this.first;while(temp){callback(temp);temp=temp.next;}}},{key:"remove",value:function remove(data){if(this.first===null){return false;}
var temp=this.first;var next=void 0;var prev=void 0;while(temp){if(temp.data===data){next=temp.next;prev=temp.prev;if(next){next.prev=prev;}
if(prev){prev.next=next;}
if(temp===this.first){this.first=next;}
if(temp===this.last){this.last=prev;}
return true;}
temp=temp.next;}
return false;}},{key:"hasCycle",value:function hasCycle(){var fast=this.first;var slow=this.first;while(true){if(fast===null){return false;}
fast=fast.next;if(fast===null){return false;}
fast=fast.next;slow=slow.next;if(fast===slow){return true;}}}},{key:"pop",value:function pop(){if(this.last===null){return null;}
var temp=this.last;this.last=this.last.prev;return temp;}},{key:"shift",value:function shift(){if(this.first===null){return null;}
var temp=this.first;this.first=this.first.next;return temp;}},{key:"recursiveReverse",value:function recursiveReverse(){function inverse(current,next){if(!next){return;}
inverse(next,next.next);next.next=current;}
if(!this.first){return;}
inverse(this.first,this.first.next);this.first.next=null;var temp=this.first;this.first=this.last;this.last=temp;}},{key:"reverse",value:function reverse(){if(!this.first||!this.first.next){return;}
var current=this.first.next;var prev=this.first;var temp=void 0;while(current){temp=current.next;current.next=prev;prev.prev=current;prev=current;current=temp;}
this.first.next=null;this.last.prev=null;temp=this.first;this.first=prev;this.last=temp;}}]);return LinkedList;}();;exports.NodeStructure=NodeStructure;exports.default=LinkedList;}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();exports.parseDelay=parseDelay;var _feature=__webpack_require__(34);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Interval=function(){_createClass(Interval,null,[{key:'create',value:function create(func,delay){return new Interval(func,delay);}}]);function Interval(func,delay){var _this=this;_classCallCheck(this,Interval);this.timer=null;this.func=func;this.delay=parseDelay(delay);this.stopped=true;this._then=null;this._callback=function(){return _this.__callback();};}
_createClass(Interval,[{key:'start',value:function start(){if(this.stopped){this._then=Date.now();this.stopped=false;this.timer=(0,_feature.requestAnimationFrame)(this._callback);}
return this;}},{key:'stop',value:function stop(){if(!this.stopped){this.stopped=true;(0,_feature.cancelAnimationFrame)(this.timer);this.timer=null;}
return this;}},{key:'__callback',value:function __callback(){this.timer=(0,_feature.requestAnimationFrame)(this._callback);if(this.delay){var now=Date.now();var elapsed=now-this._then;if(elapsed>this.delay){this._then=now-elapsed%this.delay;this.func();}}else{this.func();}}}]);return Interval;}();exports.default=Interval;function parseDelay(delay){if(typeof delay==='string'&&/fps$/.test(delay)){delay=1000/parseInt(delay.replace('fps','')||0,10);}
return delay;}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=mergeSort;exports.merge=merge;var _linkedList=__webpack_require__(270);var _linkedList2=_interopRequireDefault(_linkedList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var defaultCompareFunction=function defaultCompareFunction(a,b){var firstValue=a.toString();var secondValue=b.toString();if(firstValue===secondValue){return 0;}else if(firstValue<secondValue){return-1;}
return 1;};function mergeSort(array){var compareFunction=arguments.length>1&&arguments[1]!==undefined?arguments[1]:defaultCompareFunction;var startIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var endIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:array.length;if(Math.abs(endIndex-startIndex)<=1){return[];}
var middleIndex=Math.ceil((startIndex+endIndex)/2);mergeSort(array,compareFunction,startIndex,middleIndex);mergeSort(array,compareFunction,middleIndex,endIndex);return merge(array,compareFunction,startIndex,middleIndex,endIndex);}
function merge(array,compareFunction,startIndex,middleIndex,endIndex){var leftElements=new _linkedList2.default();var rightElements=new _linkedList2.default();var leftSize=middleIndex-startIndex;var rightSize=endIndex-middleIndex;var maxSize=Math.max(leftSize,rightSize);var size=endIndex-startIndex;for(var _i=0;_i<maxSize;_i+=1){if(_i<leftSize){leftElements.push(array[startIndex+_i]);}
if(_i<rightSize){rightElements.push(array[middleIndex+_i]);}}
var i=0;while(i<size){if(leftElements.first&&rightElements.first){if(compareFunction(leftElements.first.data,rightElements.first.data)>0){array[startIndex+i]=rightElements.shift().data;}else{array[startIndex+i]=leftElements.shift().data;}}else if(leftElements.first){array[startIndex+i]=leftElements.shift().data;}else{array[startIndex+i]=rightElements.shift().data;}
i+=1;}
return array;};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=autocompleteValidator;function autocompleteValidator(value,callback){if(value==null){value='';}
if(this.allowEmpty&&value===''){callback(true);return;}
if(this.strict&&this.source){if(typeof this.source==='function'){this.source(value,process(value,callback));}else{process(value,callback)(this.source);}}else{callback(true);}};function process(value,callback){var originalVal=value;return function(source){var found=false;for(var s=0,slen=source.length;s<slen;s++){if(originalVal===source[s]){found=true;break;}}
callback(found);};}}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=dateValidator;exports.correctFormat=correctFormat;var _moment=__webpack_require__(61);var _moment2=_interopRequireDefault(_moment);var _date=__webpack_require__(89);var _editors=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function dateValidator(value,callback){var valid=true;var dateEditor=(0,_editors.getEditorInstance)('date',this.instance);if(value==null){value='';}
var isValidDate=(0,_moment2.default)(new Date(value)).isValid()||(0,_moment2.default)(value,dateEditor.defaultDateFormat).isValid();var isValidFormat=(0,_moment2.default)(value,this.dateFormat||dateEditor.defaultDateFormat,true).isValid();if(this.allowEmpty&&value===''){isValidDate=true;isValidFormat=true;}
if(!isValidDate){valid=false;}
if(!isValidDate&&isValidFormat){valid=true;}
if(isValidDate&&!isValidFormat){if(this.correctFormat===true){var correctedValue=correctFormat(value,this.dateFormat);var row=this.instance.runHooks('unmodifyRow',this.row);var column=this.instance.runHooks('unmodifyCol',this.col);this.instance.setDataAtCell(row,column,correctedValue,'dateValidator');valid=true;}else{valid=false;}}
callback(valid);};function correctFormat(value,dateFormat){var dateFromDate=(0,_moment2.default)((0,_date.getNormalizedDate)(value));var dateFromMoment=(0,_moment2.default)(value,dateFormat);var isAlphanumeric=value.search(/[A-z]/g)>-1;var date=void 0;if(dateFromDate.isValid()&&dateFromDate.format('x')===dateFromMoment.format('x')||!dateFromMoment.isValid()||isAlphanumeric){date=dateFromDate;}else{date=dateFromMoment;}
return date.format(dateFormat);};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=numericValidator;function numericValidator(value,callback){if(value==null){value='';}
if(this.allowEmpty&&value===''){callback(true);}else if(value===''){callback(false);}else{callback(/^-?\d*(\.|,)?\d*$/.test(value));}};}),(function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=timeValidator;var _moment=__webpack_require__(61);var _moment2=_interopRequireDefault(_moment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var STRICT_FORMATS=['YYYY-MM-DDTHH:mm:ss.SSSZ','X','x'];function timeValidator(value,callback){var valid=true;var timeFormat=this.timeFormat||'h:mm:ss a';if(value===null){value='';}
value=/^\d{3,}$/.test(value)?parseInt(value,10):value;var twoDigitValue=/^\d{1,2}$/.test(value);if(twoDigitValue){value+=':00';}
var date=(0,_moment2.default)(value,STRICT_FORMATS,true).isValid()?(0,_moment2.default)(value):(0,_moment2.default)(value,timeFormat);var isValidTime=date.isValid();var isValidFormat=(0,_moment2.default)(value,timeFormat,true).isValid()&&!twoDigitValue;if(this.allowEmpty&&value===''){isValidTime=true;isValidFormat=true;}
if(!isValidTime){valid=false;}
if(!isValidTime&&isValidFormat){valid=true;}
if(isValidTime&&!isValidFormat){if(this.correctFormat===true){var correctedValue=date.format(timeFormat);var row=this.instance.runHooks('unmodifyRow',this.row);var column=this.instance.runHooks('unmodifyCol',this.col);this.instance.setDataAtCell(row,column,correctedValue,'timeValidator');valid=true;}else{valid=false;}}
callback(valid);};}),(function(module,exports,__webpack_require__){"use strict";var toObject=__webpack_require__(41),toIndex=__webpack_require__(59),toLength=__webpack_require__(24);module.exports=[].copyWithin||function copyWithin(target,start){var O=toObject(this),len=toLength(O.length),to=toIndex(target,len),from=toIndex(start,len),end=arguments.length>2?arguments[2]:undefined,count=Math.min((end===undefined?len:toIndex(end,len))-from,len-to),inc=1;if(from<to&&to<from+count){inc=-1;from+=count-1;to+=count-1;}
while(count-->0){if(from in O)O[to]=O[from];else delete O[to];to+=inc;from+=inc;}return O;};}),(function(module,exports,__webpack_require__){"use strict";var toObject=__webpack_require__(41),toIndex=__webpack_require__(59),toLength=__webpack_require__(24);module.exports=function fill(value){var O=toObject(this),length=toLength(O.length),aLen=arguments.length,index=toIndex(aLen>1?arguments[1]:undefined,length),end=aLen>2?arguments[2]:undefined,endPos=end===undefined?length:toIndex(end,length);while(endPos>index)O[index++]=value;return O;};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15),isArray=__webpack_require__(162),SPECIES=__webpack_require__(10)('species');module.exports=function(original){var C;if(isArray(original)){C=original.constructor;if(typeof C=='function'&&(C===Array||isArray(C.prototype)))C=undefined;if(isObject(C)){C=C[SPECIES];if(C===null)C=undefined;}}return C===undefined?Array:C;};}),(function(module,exports,__webpack_require__){var speciesConstructor=__webpack_require__(279);module.exports=function(original,length){return new(speciesConstructor(original))(length);};}),(function(module,exports,__webpack_require__){var getKeys=__webpack_require__(39),gOPS=__webpack_require__(57),pIE=__webpack_require__(47);module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols){var symbols=getSymbols(it),isEnum=pIE.f,i=0,key;while(symbols.length>i)if(isEnum.call(it,key=symbols[i++]))result.push(key);}return result;};}),(function(module,exports,__webpack_require__){"use strict";var anObject=__webpack_require__(18);module.exports=function(){var that=anObject(this),result='';if(that.global)result+='g';if(that.ignoreCase)result+='i';if(that.multiline)result+='m';if(that.unicode)result+='u';if(that.sticky)result+='y';return result;};}),(function(module,exports,__webpack_require__){var isObject=__webpack_require__(15),setPrototypeOf=__webpack_require__(171).set;module.exports=function(that,target,C){var P,S=target.constructor;if(S!==C&&typeof S=='function'&&(P=S.prototype)!==C.prototype&&isObject(P)&&setPrototypeOf){setPrototypeOf(that,P);}return that;};}),(function(module,exports){module.exports=function(fn,args,that){var un=that===undefined;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3]);}return fn.apply(that,args);};}),(function(module,exports,__webpack_require__){"use strict";var create=__webpack_require__(79),descriptor=__webpack_require__(40),setToStringTag=__webpack_require__(48),IteratorPrototype={};__webpack_require__(32)(IteratorPrototype,__webpack_require__(10)('iterator'),function(){return this;});module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+' Iterator');};}),(function(module,exports,__webpack_require__){var getKeys=__webpack_require__(39),toIObject=__webpack_require__(23);module.exports=function(object,el){var O=toIObject(object),keys=getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key;};}),(function(module,exports,__webpack_require__){var global=__webpack_require__(13),macrotask=__webpack_require__(85).set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode=__webpack_require__(38)(process)=='process';module.exports=function(){var head,last,notify;var flush=function(){var parent,fn;if(isNode&&(parent=process.domain))parent.exit();while(head){fn=head.fn;head=head.next;try{fn();}catch(e){if(head)notify();else last=undefined;throw e;}}last=undefined;if(parent)parent.enter();};if(isNode){notify=function(){process.nextTick(flush);};}else if(Observer){var toggle=true,node=document.createTextNode('');new Observer(flush).observe(node,{characterData:true});notify=function(){node.data=toggle=!toggle;};}else if(Promise&&Promise.resolve){var promise=Promise.resolve();notify=function(){promise.then(flush);};}else{notify=function(){macrotask.call(global,flush);};}
return function(fn){var task={fn:fn,next:undefined};if(last)last.next=task;if(!head){head=task;notify();}last=task;};};}),(function(module,exports,__webpack_require__){var dP=__webpack_require__(19),anObject=__webpack_require__(18),getKeys=__webpack_require__(39);module.exports=__webpack_require__(21)?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=getKeys(Properties),length=keys.length,i=0,P;while(length>i)dP.f(O,P=keys[i++],Properties[P]);return O;};}),(function(module,exports,__webpack_require__){var toIObject=__webpack_require__(23),gOPN=__webpack_require__(81).f,toString={}.toString;var windowNames=typeof window=='object'&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return gOPN(it);}catch(e){return windowNames.slice();}};module.exports.f=function getOwnPropertyNames(it){return windowNames&&toString.call(it)=='[object Window]'?getWindowNames(it):gOPN(toIObject(it));};}),(function(module,exports,__webpack_require__){var has=__webpack_require__(22),toObject=__webpack_require__(41),IE_PROTO=__webpack_require__(82)('IE_PROTO'),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){O=toObject(O);if(has(O,IE_PROTO))return O[IE_PROTO];if(typeof O.constructor=='function'&&O instanceof O.constructor){return O.constructor.prototype;}return O instanceof Object?ObjectProto:null;};}),(function(module,exports,__webpack_require__){var gOPN=__webpack_require__(81),gOPS=__webpack_require__(57),anObject=__webpack_require__(18),Reflect=__webpack_require__(13).Reflect;module.exports=Reflect&&Reflect.ownKeys||function ownKeys(it){var keys=gOPN.f(anObject(it)),getSymbols=gOPS.f;return getSymbols?keys.concat(getSymbols(it)):keys;};}),(function(module,exports){module.exports=Object.is||function is(x,y){return x===y?x!==0||1/x===1/y:x!=x&&y!=y;};}),(function(module,exports,__webpack_require__){var anObject=__webpack_require__(18),aFunction=__webpack_require__(72),SPECIES=__webpack_require__(10)('species');module.exports=function(O,D){var C=anObject(O).constructor,S;return C===undefined||(S=anObject(C)[SPECIES])==undefined?D:aFunction(S);};}),(function(module,exports,__webpack_require__){var toInteger=__webpack_require__(60),defined=__webpack_require__(30);module.exports=function(TO_STRING){return function(that,pos){var s=String(defined(that)),i=toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return TO_STRING?'':undefined;a=s.charCodeAt(i);return a<0xd800||a>0xdbff||i+1===l||(b=s.charCodeAt(i+1))<0xdc00||b>0xdfff?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-0xd800<<10)+(b-0xdc00)+0x10000;};};}),(function(module,exports,__webpack_require__){var global=__webpack_require__(13),core=__webpack_require__(44),LIBRARY=__webpack_require__(56),wksExt=__webpack_require__(175),defineProperty=__webpack_require__(19).f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});if(name.charAt(0)!='_'&&!(name in $Symbol))defineProperty($Symbol,name,{value:wksExt.f(name)});};}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){}),(function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_302__;})]);});;

/* /muk_web_preview_msoffice/static/src/js/preview_handler.js defined in bundle 'web.assets_backend' */
odoo.define('muk_preview_msoffice.PreviewHandler',function(require){"use strict";var core=require('web.core');var PreviewHandler=require('muk_preview.PreviewHandler');var QWeb=core.qweb;var _t=core._t;var WordHandler=PreviewHandler.PDFHandler.extend({checkExtension:function(extension){return['.doc','.docx','.docm','doc','docx','docm'].includes(extension);},checkType:function(mimetype){return['application/msword','application/ms-word','application/vnd.ms-word.document.macroEnabled.12','application/vnd.openxmlformats-officedocument.wordprocessingml.document'].includes(mimetype);},createHtml:function(url,mimetype,extension,title){var convertUrlTempalte=_.template('/web/preview/converter/msoffice?url=<%= url %>');return this._super(convertUrlTempalte({url:encodeURIComponent(url)}));},});var PowerPointHandler=PreviewHandler.PDFHandler.extend({checkExtension:function(extension){return['.ppt','.pptx','.pptm','ppt','pptx','pptm'].includes(extension);},checkType:function(mimetype){return['application/vnd.mspowerpoint','application/vnd.ms-powerpoint','application/vnd.openxmlformats-officedocument.presentationml.presentation','application/vnd.ms-powerpoint.presentation.macroEnabled.12'].includes(mimetype);},createHtml:function(url,mimetype,extension,title){var convertUrlTempalte=_.template('/web/preview/converter/msoffice?url=<%= url %>');return this._super(convertUrlTempalte({url:encodeURIComponent(url)}));},});var ExcelHandler=PreviewHandler.BaseHandler.extend({checkExtension:function(extension){return['.xls','.xlsx','.xlsm','.xlsb','xls','xlsx','xlsm','xlsb'].includes(extension);},checkType:function(mimetype){return['application/vnd.ms-excel','application/vnd.msexcel','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','application/vnd.ms-excel.sheet.binary.macroEnabled.12','application/vnd.ms-excel.sheet.macroEnabled.12'].includes(mimetype);},createHtml:function(url,mimetype,extension,title){var result=$.Deferred();var $content=$(QWeb.render('ExcelHTMLContent'));$.ajax(url,{type:"GET",dataType:"binary",responseType:'arraybuffer',processData:false,success:function(arraybuffer){var data=new Uint8Array(arraybuffer);var arr=new Array();for(var i=0;i!=data.length;++i){arr[i]=String.fromCharCode(data[i]);}
var workbook=XLSX.read(arr.join(""),{type:"binary",cellDates:true,cellStyles:true,cellNF:true});var jsonWorkbook={};_.each(workbook.SheetNames,function(sheet,index,list){var jsonData=XLSX.utils.sheet_to_json(workbook.Sheets[sheet],{header:1});if(jsonData.length>0){jsonWorkbook[sheet]=jsonData;}
var worksheet=workbook.Sheets[sheet];});$content.find('.excel-loader').hide();$content.find('.excel-container').show();var index=0;_.each(jsonWorkbook,function(sheet,sheetname,list){var $tab=$('<a/>');$tab.attr('href','#sheet-'+index);$tab.attr('aria-controls','sheet-'+index);$tab.attr('role','tab');$tab.attr('data-toggle','tab');$tab.append('<i class="fa fa-table" aria-hidden="true"></i>');$tab.append($('<span/>').text(sheetname));$content.find('.nav-tabs').append($('<li/>').append($tab));var $pane=$('<div/>');$pane.addClass('tab-pane table-container');$pane.attr('id','sheet-'+index);$pane.handsontable({data:sheet,rowHeaders:true,colHeaders:true,stretchH:'all',readOnly:true,columnSorting:true,autoColumnSize:true,});$content.find('.tab-content').append($pane);index++;});$content.find('.tab-line a:first').tab('show')},error:function(request,status,error){console.error(request.responseText);},});result.resolve($content);return $.when(result);},});return{ExcelHandler:ExcelHandler,WordHandler:WordHandler,PowerPointHandler:PowerPointHandler,}});;

/* /muk_web_preview_msoffice/static/src/js/preview_generator.js defined in bundle 'web.assets_backend' */
odoo.define('muk_preview_msoffice.PreviewGenerator',function(require){"use strict";var core=require('web.core');var PreviewGenerator=require('muk_preview.PreviewGenerator');var PreviewHandler=require('muk_preview_msoffice.PreviewHandler');var QWeb=core.qweb;var _t=core._t;PreviewGenerator.include({init:function(widget,additional_handler){this._super(widget,additional_handler);this.handler=_.extend(this.handler,{"ExcelHandler":new PreviewHandler.ExcelHandler(widget),"WordHandler":new PreviewHandler.WordHandler(widget),"PowerPointHandler":new PreviewHandler.PowerPointHandler(widget),});},});});;

/* /backend_theme_v10/static/src/js/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('backend_theme_v11.Sidebar',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');$(function(){(function($){$.addDebug=function(url){url=url.replace(/(.{4})/,"$1?debug");return url;}
$.addDebugWithAssets=function(url){url=url.replace(/(.{4})/,"$1?debug=assets");return url;}
$.delDebug=function(url){var str=url.match(/web(\S*)#/);url=url.replace("str/g","");return url;}})(jQuery);$("#sidebar a").each(function(){var url=$(this).attr('href');if(session.debug==1)$(this).attr('href',$.addDebug(url));if(session.debug=='assets')$(this).attr('href',$.addDebugWithAssets(url));if(session.debug==false)$(this).attr('href',$.delDebug(url));});});});;

/* /backend_theme_v10/static/src/js/sidebar-toggle.js defined in bundle 'web.assets_backend' */
odoo.define('backend_theme_v10.sidebar-toggle',function(require){"use strict";var session=require('web.session');var Model=require('web.DataModel');var id=session.uid;new Model('res.users').query(['sidebar_visible']).filter([['id','=',id]]).first().then(function(res){var toggle=res["sidebar_visible"];if(toggle===true){$("#app-sidebar").removeClass("toggle-sidebar");}else{$("#app-sidebar").addClass("toggle-sidebar");};});});;

/* /barcodes/static/src/js/barcode_parser.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeParser',function(require){"use strict";var Class=require('web.Class');var Model=require('web.DataModel');var BarcodeParser=Class.extend({init:function(attributes){this.nomenclature_id=attributes.nomenclature_id;this.loaded=this.load();},load:function(){var self=this;return new Model('barcode.nomenclature').query(['name','rule_ids','upc_ean_conv']).filter([['id','=',this.nomenclature_id[0]]]).first().then(function(nomenclature){self.nomenclature=nomenclature;return new Model('barcode.rule').query(['name','sequence','type','encoding','pattern','alias']).filter([['barcode_nomenclature_id','=',self.nomenclature.id]]).all();}).then(function(rules){rules=rules.sort(function(a,b){return a.sequence-b.sequence;});self.nomenclature.rules=rules;});},is_loaded:function(){return this.loaded;},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2===0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},ean8_checksum:function(ean){var code=ean.split('');if(code.length!==8){return-1;}
var sum1=Number(code[1])+Number(code[3])+Number(code[5]);var sum2=Number(code[0])+Number(code[2])+Number(code[4])+Number(code[6]);var total=sum1+3*sum2;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},check_encoding:function(barcode,encoding){var len=barcode.length;var allnum=/^\d+$/.test(barcode);var check=Number(barcode[len-1]);if(encoding==='ean13'){return len===13&&allnum&&this.ean_checksum(barcode)===check;}else if(encoding==='ean8'){return len===8&&allnum&&this.ean8_checksum(barcode)===check;}else if(encoding==='upca'){return len===12&&allnum&&this.ean_checksum('0'+barcode)===check;}else if(encoding==='any'){return true;}else{return false;}},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean='0'+ean;}
return ean.substr(0,12)+this.ean_checksum(ean);},sanitize_upc:function(upc){return this.sanitize_ean('0'+upc).substr(1,12);},match_pattern:function(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match['value']=parseInt(whole_part)+parseFloat(decimal_part);match['base_code']=barcode.substr(0,num_start);var base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match['base_code']+="0";base_pattern+="0";}
match['base_code']+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match['base_code']=match['base_code'].replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('')
if(encoding==='ean13'){base_code[12]=''+this.ean_checksum(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.ean8_checksum(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.ean_checksum('0'+match.base_code);}
match.base_code=base_code.join('')}
if(base_pattern[0]!=='^'){base_pattern="^"+base_pattern;}
match.match=match.base_code.match(base_pattern);return match;},parse_barcode:function(barcode){var parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;},});return BarcodeParser;});;

/* /barcodes/static/src/js/barcode_events.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeEvents',function(require){"use strict";var core=require('web.core');var session=require('web.session');var mixins=core.mixins;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;var BarcodeEvents=core.Class.extend(mixins.PropertiesMixin,{timeout:null,key_pressed:{},buffered_key_events:[],regexp:/(.{3,})[\n\r\t]*/,suffix:/[\n\r\t]+/,max_time_between_keys_in_ms:session.max_time_between_keys_in_ms||55,init:function(){mixins.PropertiesMixin.init.call(this);this.__keydown_handler=_.bind(this.keydown_handler,this);this.__keyup_handler=_.bind(this.keyup_handler,this);this.__handler=_.bind(this.handler,this);$(_.bind(this.start,this,false));},handle_buffered_keys:function(){var str=this.buffered_key_events.reduce(function(memo,e){return memo+String.fromCharCode(e.which)},'');var match=str.match(this.regexp);if(match){var barcode=match[1];core.bus.trigger('barcode_scanned',barcode,this.buffered_key_events[0].target);if(this.buffered_key_events[0].target.getAttribute("barcode_events")==="true")
$(this.buffered_key_events[0].target).trigger('barcode_scanned',barcode);}else{this.resend_buffered_keys();}
this.buffered_key_events=[];},resend_buffered_keys:function(){var old_event,new_event;for(var i=0;i<this.buffered_key_events.length;i++){old_event=this.buffered_key_events[i];if(old_event.which!==13){var params={'bubbles':old_event.bubbles,'cancelable':old_event.cancelable,};try{new_event=new Event("keypress",params);}catch(error){new_event=new CustomEvent("keypress",params);}
new_event.viewArg=old_event.viewArg;new_event.ctrl=old_event.ctrl;new_event.alt=old_event.alt;new_event.shift=old_event.shift;new_event.meta=old_event.meta;new_event.char=old_event.char;new_event.key=old_event.key;new_event.charCode=old_event.charCode;new_event.keyCode=old_event.keyCode||old_event.which;new_event.which=old_event.which;new_event.dispatched_by_barcode_reader=true;old_event.target.dispatchEvent(new_event);}}},element_is_editable:function(element){return $(element).is('input,textarea,[contenteditable="true"]');},is_special_key:function(e){if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Escape"||e.key==="Tab"||e.key==="Backspace"||e.key==="Delete"||/F\d\d?/.test(e.key)){return true;}else{return false;}},keydown_handler:function(e){if(this.key_pressed[e.which]){e.preventDefault();}else{this.key_pressed[e.which]=true;}},keyup_handler:function(e){this.key_pressed[e.which]=false;},handler:function(e){if(e.dispatched_by_barcode_reader)
return;if(this.is_special_key(e))
return;if(e.ctrlKey||e.metaKey||e.altKey)
return;if(e.which===13&&this.buffered_key_events.length===0)
return;if(this.element_is_editable(e.target)&&e.target.getAttribute("barcode_events")!=="true")
return;this.buffered_key_events.push(e);e.preventDefault();e.stopImmediatePropagation();clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this.handle_buffered_keys();}else{this.timeout=setTimeout(_.bind(this.handle_buffered_keys,this),this.max_time_between_keys_in_ms);}},start:function(prevent_key_repeat){document.body.addEventListener('keypress',this.__handler,true);if(prevent_key_repeat===true){document.body.addEventListener('keydown',this.__keydown_handler,true);document.body.addEventListener('keyup',this.__keyup_handler,true);}},stop:function(){document.body.removeEventListener('keypress',this.__handler,true);document.body.removeEventListener('keydown',this.__keydown_handler,true);document.body.removeEventListener('keyup',this.__keyup_handler,true);},});return{BarcodeEvents:new BarcodeEvents(),ReservedBarcodePrefixes:['O-CMD'],};});;

/* /barcodes/static/src/js/barcode_handler_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeHandlerMixin',function(require){"use strict";var core=require('web.core');var View=require('web.View');return{init:function(){var self=this;this._super.apply(this,arguments);this.__on_barcode_scanned=function(barcode,target){if($.contains(target,self.el)){self.on_barcode_scanned.call(self,barcode);}};this.start_listening();var view=this.findAncestor(function(ancestor){return ancestor instanceof View});if(view){view.on('attached',this,this.start_listening);view.on('detached',this,this.stop_listening);}},start_listening:function(){if(!this.is_listening){core.bus.on('barcode_scanned',this,this.__on_barcode_scanned);this.is_listening=true;}},stop_listening:function(){if(this.is_listening){core.bus.off('barcode_scanned',this,this.__on_barcode_scanned);this.is_listening=false;}},on_barcode_scanned:function(barcode){console.error('A class implementing BarcodeHandlerMixin must redefine method on_barcode_scanned.');},};});;

/* /barcodes/static/src/js/form_view_barcode_handler.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FormViewBarcodeHandler',function(require){"use strict";var core=require('web.core');var utils=require('web.utils');var common=require('web.form_common');var BarcodeEvents=require('barcodes.BarcodeEvents');var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var KanbanRecord=require('web_kanban.Record');var Dialog=require('web.Dialog');var _t=core._t;KanbanRecord.include({get:function(key){return this.values[key]&&this.values[key].value;},});var FormViewBarcodeHandler=common.AbstractField.extend(BarcodeHandlerMixin,{init:function(parent,context){this.__quantity_listener=_.bind(this._set_quantity_listener,this);BarcodeHandlerMixin.init.apply(this,arguments);this.process_barcode_mutex=new utils.Mutex();return this._super.apply(this,arguments);},start:function(){this._super();this.form_view=this.field_manager;this.map_barcode_method={'O-CMD.NEW':_.bind(this.form_view.on_button_new,this.form_view),'O-CMD.EDIT':_.bind(this.form_view.on_button_edit,this.form_view),'O-CMD.CANCEL':_.bind(this.form_view.on_button_cancel,this.form_view),'O-CMD.SAVE':_.bind(this.form_view.on_button_save,this.form_view,{target:$('.o_cp_buttons .o_form_button_save')}),};if(this.form_view.execute_pager_action){this.map_barcode_method['O-CMD.PAGER-PREV']=_.bind(this.form_view.execute_pager_action,this.form_view,'previous');this.map_barcode_method['O-CMD.PAGER-NEXT']=_.bind(this.form_view.execute_pager_action,this.form_view,'next');}else if(this.form_view.pager){this.map_barcode_method['O-CMD.PAGER-PREV']=_.bind(this.form_view.pager.previous,this.form_view.pager);this.map_barcode_method['O-CMD.PAGER-NEXT']=_.bind(this.form_view.pager.next,this.form_view.pager);}},destroy:function(){this.stop_listening();this._super.apply(this,arguments);},_display_no_edit_mode_warning:function(){this.do_warn(_t('Error : Document not editable'),_t('To modify this document, please first start edition.'));},_display_no_last_scanned_warning:function(){this.do_warn(_t('Error : No last scanned barcode'),_t('To set the quantity please scan a barcode first.'));},_set_quantity_listener:function(event){var self=this;var character=String.fromCharCode(event.which);if($(event.target).is('body')&&/[0-9]/.test(character)){if(this.form_view.get('actual_mode')==='view'){this._display_no_edit_mode_warning();}else{var field=this.form_view.fields[this.m2x_field];var view=field.viewmanager.active_view;var $content=$('<div>').append($('<input>',{type:'text',class:'o_set_qty_input'}));if(this.last_scanned_barcode){this.dialog=new Dialog(this,{title:_t('Set quantity'),buttons:[{text:_t('Select'),classes:'btn-primary',close:true,click:function(){var new_qty=this.$content.find('.o_set_qty_input').val();var record=_.find(self._get_records(field),function(record){return record.get('product_barcode')===self.last_scanned_barcode;});if(record){var values={};values[self.quantity_field]=parseFloat(new_qty);field.data_update(record.get('id'),values).then(function(){view.controller.reload_record(record);});}else{self._display_no_last_scanned_warning();}}},{text:_t('Discard'),close:true}],$content:$content,}).open();this.dialog.$content.find('.o_set_qty_input').focus().val(character);var $selectBtn=this.dialog.$footer.find('.btn-primary');core.bus.on('keypress',this.dialog,function(event){if(event.which===13){event.preventDefault();$selectBtn.click();}});}else{this._display_no_last_scanned_warning();}}}},start_listening:function(){if(this.quantity_field&&!this.is_listening){core.bus.on('keypress',this,this.__quantity_listener);}
BarcodeHandlerMixin.start_listening.call(this);},stop_listening:function(){if(this.quantity_field&&this.is_listening){core.bus.off('keypress',this,this.__quantity_listener);delete this.last_scanned_barcode;}
BarcodeHandlerMixin.stop_listening.call(this);},pre_onchange_hook:function(barcode){return $.Deferred().resolve(true);},on_barcode_scanned:function(barcode){var self=this;self.last_scanned_barcode=barcode;var action=this.map_barcode_method[barcode];if(typeof action==="function")
return $.when(action());if(_.any(BarcodeEvents.ReservedBarcodePrefixes,function(prefix){return barcode.indexOf(prefix)===0}))
return;else if(this.form_view.get('actual_mode')==='view')
this._display_no_edit_mode_warning();else{var process_barcode=function(){var form_onchanges_mutex=function(){return self.form_view.onchanges_mutex.def;}
var commit_mutex=new utils.Mutex();_.each(self.form_view.fields,function(field){commit_mutex.exec(function(){return field.commit_value();});commit_mutex.exec(form_onchanges_mutex);});return commit_mutex.def.then(function(){return self.pre_onchange_hook(barcode).then(function(proceed){if(proceed){self.set_value(barcode);return form_onchanges_mutex();}});});};this.process_barcode_mutex.exec(process_barcode);}},_get_records:function(field){var active_view=field.viewmanager.active_view;if(active_view.type==="kanban"){return active_view.controller.widgets;}else{return active_view.controller.records.records;}},});core.form_widget_registry.add('barcode_handler',FormViewBarcodeHandler);return FormViewBarcodeHandler;});;

/* /barcodes/static/src/js/inherited_form_widget_button.js defined in bundle 'web.assets_backend' */
odoo.define('barcode.InheritedFormWidgetButton',function(require){"use strict";var widgets=require('web.form_widgets');var BarcodeEvents=require('barcodes.BarcodeEvents');var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var ButtonBarcodeHandlerMixin=_.extend({},BarcodeHandlerMixin,{init:function(field_manager,node){if(node.attrs.barcode_trigger){BarcodeHandlerMixin.init.call(this,field_manager,node);var self=this;this.on_barcode_scanned=function(barcode){var match=barcode.match(/O-BTN\.(.+)/);if(match&&match[1]===self.node.attrs.barcode_trigger&&(self.$el.is(':visible')||self.$el.parent('.dropdown-menu').length)){self.on_click();}};}else{this._super(field_manager,node);}},});BarcodeEvents.ReservedBarcodePrefixes.push('O-BTN');widgets.WidgetButton.include(ButtonBarcodeHandlerMixin);});;

/* /barcodes/static/src/js/field_float_scannable.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FieldFloatScannable',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var form_widgets=require('web.form_widgets');var FieldFloatScannable=form_widgets.FieldFloat.extend({events:{'keypress':'simulateKeypress',},parse_value:function(val,def){return formats.parse_value(val,{type:"float"},def);},simulateKeypress:function(e){if(e.originalEvent.dispatched_by_barcode_reader!==true){return;}
var character=String.fromCharCode(e.which);var current_str=e.target.value;var str_before_carret=current_str.substring(0,e.target.selectionStart);var str_after_carret=current_str.substring(e.target.selectionEnd);e.target.value=str_before_carret+character+str_after_carret;var new_carret_index=str_before_carret.length+character.length;e.target.setSelectionRange(new_carret_index,new_carret_index);this.store_dom_value();},});core.form_widget_registry.add('field_float_scannable',FieldFloatScannable);return{FieldFloatScannable:FieldFloatScannable,};});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/base_import.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var time=require('web.time');var ListView=require('web.ListView');var KanbanView=require('web_kanban.KanbanView');var Model=require('web.DataModel');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
function execute_import_action(){var self=this;this.do_action({type:'ir.actions.client',tag:'import',params:{model:this.dataset.model,context:this.getParent().action.context,}},{on_reverse_breadcrumb:function(){return self.reload();},});return false;}
ListView.prototype.defaults.import_enabled=true;ListView.include({render_buttons:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button){this.$buttons.on('click','.o_button_import',execute_import_action.bind(this));}}});KanbanView.include({render_buttons:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button&&this.$buttons){this.$buttons.on('click','.o_button_import',execute_import_action.bind(this));}},set_default_options:function(options){this._super(_.defaults(options||{},{import_enabled:true,}));},});var DataImport=Widget.extend(ControlPanelMixin,{template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:'utf-8'},{name:'separator',label:_lt("Separator:"),value:','},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],parse_opts:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','click .oe_import_file_reload':'loaded_file','change input.oe_import_has_header, .js_import_options input':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click a.oe_import_toggle':function(e){e.preventDefault();this.$('.oe_import_options').toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.Import=new Model('base_import.import');this.session=session;action.display_name=_t('Import a File');this.do_not_change_match=false;},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();return $.when(this._super(),self.create_model().done(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.render_buttons();var status={breadcrumbs:self.action_manager.get_breadcrumbs(),cp_content:{$buttons:self.$buttons},};self.update_control_panel(status);}));},create_model:function(){return this.Import.call('create',[{'res_model':this.res_model}]);},render_buttons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',query:function(q){var make=function(term){return{id:term,text:term};};var suggestions=_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 '+'gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),make);if(q.term){suggestions.unshift(make(q.term));}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:'utf-8',text:'utf-8'});}}).select2('val','utf-8');},setup_separator_picker:function(){this.$('input.oe_import_separator').select2({width:'160px',query:function(q){var suggestions=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});},setup_float_format_picker:function(){var sug_query=function(q){var suggestions=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});};this.$('input.oe_import_float_thousand_separator').select2({width:'160px',query:sug_query,initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});this.$('input.oe_import_float_decimal_separator').select2({width:'160px',query:sug_query,initSelection:function(e,c){return c({id:',',text:_t("Dot")});},});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts).each(function(opt){if(opt.name==='date_format'||opt.name==='datetime_format'){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());}
else{options[opt.name]=self.$('input.oe_import_'+opt.name).val();}});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;return options;},onfile_loaded:function(){var file=this.$('.oe_import_file')[0].files[0];this.$('.oe_import_file_show').val(file!==undefined&&file.name||'');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').val('');this.$('.oe_import_datetime_format').val('');this.$el.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];if((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv")){import_toggle=true;}
this.$el.find('.oe_import_toggle').toggle(import_toggle);jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',true);this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this.Import.call('parse_preview',[this.id,this.import_options()]).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$('.oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview_error oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.o_import_import').removeClass('btn-primary');this.$buttons.filter('.o_import_validate').addClass('btn-primary');this.$buttons.filter('.o_import_button').add(this.$('.oe_import_file_reload')).prop('disabled',false);this.$el.addClass('oe_import_preview');this.$('input.oe_import_advanced_mode').prop('checked',result.advanced_mode);this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]);}
this.$('.oe_import_date_format').val(time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));this.$('.oe_import_float_thousand_separator').val(result.options.float_thousand_separator).change();this.$('.oe_import_float_decimal_separator').val(result.options.float_decimal_separator).change();if(result.debug===false){this.$('.oe_import_tracking').hide();}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var filtered_data=self.generate_fields_completion(result,k);$(v).select2({allowClear:true,minimumInputLength:0,data:filtered_data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
callback(item_finder(default_value));},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'});});},generate_fields_completion:function(root,index){var basic=[];var regulars=[];var o2m=[];var headers_type=root.headers_type;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(type===undefined||(type!==undefined&&(type.indexOf('all')!==-1||type.indexOf(field['type'])!==-1))){if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required});}
if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,headers_type[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){basic=basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}
else if(!_.isEmpty(regulars)){basic=basic.concat(regulars);}
else if(!_.isEmpty(o2m)){basic=basic.concat(o2m);}
return basic;},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked')
delete kwargs.tracking_disable
kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable});return this.Import.call('do',[this.id,fields,this.import_options()],kwargs).then(undefined,function(error,event){if(event){event.preventDefault();}
return $.when([{type:'error',record:false,message:error.data.arguments&&error.data.arguments[1]||error.message,}]);});},onvalidate:function(){return this.call_import({dryrun:true,tracking_disable:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(message){if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded']();return;}
self['import_failed'](message);});},onimported:function(){this.exit();},exit:function(){this.do_action({type:'ir.actions.client',tag:'history_back'});},onresults:function(event,from,to,message){var no_messages=_.isEmpty(message);this.$buttons.filter('.o_import_import').toggleClass('btn-primary',no_messages);this.$buttons.filter('.o_import_import').toggleClass('btn-default',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-primary',!no_messages);this.$buttons.filter('.o_import_validate').toggleClass('btn-default',no_messages);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('');},}));},});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}]});return{DataImport:DataImport,}});;

/* /calendar/static/src/js/base_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('base_calendar.base_calendar',function(require){"use strict";var bus=require('bus.bus').bus;var core=require('web.core');var CalendarView=require('web_calendar.CalendarView');var data=require('web.data');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Model=require('web.DataModel');var Notification=require('web.notification').Notification;var session=require('web.session');var WebClient=require('web.WebClient');var widgets=require('web_calendar.widgets');var FieldMany2ManyTags=core.form_widget_registry.get('many2many_tags');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;CalendarView.include({extraSideBar:function(){var result=this._super();if(this.useContacts){return result.then(this.sidebar.filter.initialize_favorites.bind(this.sidebar.filter));}
return result;},get_all_filters_ordered:function(){var filters=this._super();if(this.useContacts){var filter_me=_.first(_.values(this.all_filters));var filter_all=this.all_filters[-1];filters=[].concat(filter_me,_.difference(filters,[filter_me,filter_all]),filter_all);}
return filters;}});var FieldMany2One=core.form_widget_registry.get('many2one');var SidebarFilterM2O=FieldMany2One.extend({get_search_blacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids);},set_filter_ids:function(filter_ids){this.filter_ids=filter_ids;},});widgets.SidebarFilter.include({events:_.extend(widgets.SidebarFilter.prototype.events,{'click .o_remove_contact':'on_remove_filter',}),init:function(){this._super.apply(this,arguments);this.ds_contacts=new data.DataSet(this,'calendar.contacts',session.context);},initialize_favorites:function(){return this.load_favorite_list().then(this.initialize_m2o.bind(this));},initialize_m2o:function(){this.dfm=new form_common.DefaultFieldManager(this);if(!this.view.useContacts){return;}
this.dfm.extend_field_desc({partner_id:{relation:"res.partner",},});this.m2o=new SidebarFilterM2O(this.dfm,{attrs:{class:'o_add_favorite_calendar',name:"partner_id",type:"many2one",options:'{"no_open": True}',placeholder:_t("Add Favorite Calendar"),},});this.m2o.set_filter_ids(_.pluck(this.view.all_filters,'value'));this.m2o.appendTo(this.$el);var self=this;this.m2o.on('change:value',this,function(){if(self.m2o.get_value()){self.on_add_filter();}});},load_favorite_list:function(){var self=this;var active_partner=(this.view.dataset.context.active_model==='res.partner');return session.is_bound.then(function(){self.view.all_filters={};self.view.now_filter_ids=[];self._add_filter(session.partner_id,session.name+_lt(" [Me]"),!active_partner);self._add_filter(-1,_lt("Everybody's calendars"),false,false);return new Model("calendar.contacts").query(["partner_id"]).filter([["user_id","=",session.uid]]).all().then(function(result){_.each(result,function(item){self._add_filter(item.partner_id[0],item.partner_id[1],!active_partner,true);});self.view.now_filter_ids=_.pluck(self.view.all_filters,'value');self.render();});});},reload:function(){this.trigger_up('reload_events');this.render();this.m2o.set_filter_ids(_.pluck(this.view.all_filters,'value'));this.m2o.set_value(false);},_add_filter:function(value,label,is_checked,can_be_removed){this.view.all_filters[value]={value:value,label:label,color:this.view.get_color(value),avatar_model:this.view.avatar_model,is_checked:is_checked||false,can_be_removed:can_be_removed||false,};if(is_checked){this.view.now_filter_ids.push(value);}},_remove_filter:function(value){delete this.view.all_filters[value];var index=this.view.now_filter_ids.indexOf(value);if(index>=0){this.view.now_filter_ids.splice(index,1);}},on_add_filter:function(){var self=this;var defs=[];_.each(this.m2o.display_value,function(element,index){if(session.partner_id!==index){defs.push(self.ds_contacts.call("create",[{'partner_id':index}]).then(function(){self._add_filter(parseInt(index),element,true,true);self.reload();}));}});return $.when.apply(null,defs).then(this.reload.bind(this));},on_remove_filter:function(e){var self=this;var id=$(e.currentTarget).data('id');Dialog.confirm(this,_t("Do you really want to delete this filter from favorites ?"),{confirm_callback:function(){self.ds_contacts.call('unlink_from_partner_id',[id]).then(function(){self._remove_filter(id);self.reload();});},});},});var CalendarNotification=Notification.extend({template:"CalendarNotification",init:function(parent,title,text,eid){this._super(parent,title,text,true);this.eid=eid;this.events=_.extend(this.events||{},{'click .link2event':function(){var self=this;this.rpc("/web/action/load",{action_id:"calendar.action_calendar_event_notify",}).then(function(r){r.res_id=self.eid;return self.do_action(r);});},'click .link2recall':function(){this.destroy(true);},'click .link2showed':function(){this.destroy(true);this.rpc("/calendar/notify_ack");},});},});WebClient.include({display_calendar_notif:function(notifications){var self=this;var last_notif_timer=0;clearTimeout(this.get_next_calendar_notif_timeout);_.each(this.calendar_notif_timeouts,clearTimeout);_.each(this.calendar_notif,function(notif){if(!notif.isDestroyed()){notif.destroy();}});this.calendar_notif_timeouts={};this.calendar_notif={};_.each(notifications,function(notif){self.calendar_notif_timeouts[notif.event_id]=setTimeout(function(){var notification=new CalendarNotification(self.notification_manager,notif.title,notif.message,notif.event_id);self.notification_manager.display(notification);self.calendar_notif[notif.event_id]=notification;},notif.timer*1000);last_notif_timer=Math.max(last_notif_timer,notif.timer);});if(last_notif_timer>0){this.get_next_calendar_notif_timeout=setTimeout(this.get_next_calendar_notif.bind(this),last_notif_timer*1000);}},get_next_calendar_notif:function(){this.rpc("/calendar/notify",{},{shadow:true}).done(this.display_calendar_notif.bind(this)).fail(function(err,ev){if(err.code===-32098){ev.preventDefault();}});},show_application:function(){this.calendar_notif_timeouts={};this.calendar_notif={};bus.on('notification',this,function(notifications){_.each(notifications,(function(notification){if(notification[0][1]==='calendar.alarm'){this.display_calendar_notif(notification[1]);}}).bind(this));});return this._super.apply(this,arguments).then(this.get_next_calendar_notif.bind(this));},});var Many2ManyAttendee=FieldMany2ManyTags.extend({tag_template:"Many2ManyAttendeeTag",get_render_data:function(ids){return this.dataset.call('get_attendee_detail',[ids,this.getParent().datarecord.id||false]).then(process_data);function process_data(data){return _.map(data,function(d){return _.object(['id','display_name','status','color'],d);});}},});core.form_widget_registry.add('many2manyattendee',Many2ManyAttendee);});;

/* /hr_attendance/static/src/js/employee_kanban_view_handler.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.employee_kanban_view_handler',function(require){"use strict";var KanbanRecord=require('web_kanban.Record');KanbanRecord.include({on_card_clicked:function(){if(this.model==='hr.employee'&&this.$el.parents('.o_hr_employee_attendance_kanban').length){var action={type:'ir.actions.client',name:'Confirm',tag:'hr_attendance_kiosk_confirm',employee_id:this.record.id.raw_value,employee_name:this.record.name.raw_value,employee_state:this.record.attendance_state.raw_value,};this.do_action(action);}else{this._super.apply(this,arguments);}}});});;

/* /hr_attendance/static/src/js/presence_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.presence_widgets',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var kanban_widgets=require('web_kanban.widgets');var QWeb=core.qweb;var _t=core._t;var FormPresenceIndicator=form_common.AbstractField.extend({init:function(){this._super.apply(this,arguments);},start:function(){this.display_field();this.$el.tooltip({title:_t("employee presence<br/>green: checked in<br/>red: checked out"),trigger:'hover'});return this._super();},render_value:function(){this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_green",this.get_value()=='checked_in');this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_red",this.get_value()=='checked_out');},display_field:function(){this.$el.html(QWeb.render("PresenceIndicator"));},});var KanbanPresenceIndicator=kanban_widgets.AbstractField.extend({init:function(){this._super.apply(this,arguments);},start:function(){this.display_field();this.render_value();this.$el.tooltip({title:_t("employee presence<br/>green: checked in<br/>red: checked out"),trigger:'hover'});return this._super();},render_value:function(){this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_green",this.field.raw_value=='checked_in');this.$('.oe_hr_attendance_status').toggleClass("oe_hr_attendance_status_red",this.field.raw_value=='checked_out');},display_field:function(){this.$el.html(QWeb.render("PresenceIndicator"));},});core.form_widget_registry.add('hr_attendance_form_presence_indicator',FormPresenceIndicator);kanban_widgets.registry.add('hr_attendance_kanban_presence_indicator',KanbanPresenceIndicator);});;

/* /hr_attendance/static/src/js/greeting_message.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.greeting_message',function(require){"use strict";var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var _t=core._t;var GreetingMessage=Widget.extend(BarcodeHandlerMixin,{template:'HrAttendanceGreetingMessage',events:{"click .o_hr_attendance_button_dismiss":function(){this.do_action(this.next_action,{clear_breadcrumbs:true});},},init:function(parent,action){var self=this;this._super.apply(this,arguments);BarcodeHandlerMixin.init.apply(this,arguments);if(!action.attendance){this.stop_listening();this.session.user_has_group('hr_attendance.group_hr_attendance_user').then(function(has_group){if(has_group){self.next_action='hr_attendance.hr_attendance_action_kiosk_mode';}else{self.next_action='hr_attendance.hr_attendance_action_my_attendances';}});return;}
this.next_action=action.next_action||'hr_attendance.hr_attendance_action_my_attendances';if(this.next_action!='hr_attendance.hr_attendance_action_kiosk_mode'&&this.next_action.tag!='hr_attendance_kiosk_mode'){this.stop_listening();}
this.attendance=action.attendance;this.attendance.check_in_time=(new Date((new Date(this.attendance.check_in)).valueOf()-(new Date()).getTimezoneOffset()*60*1000)).toTimeString().slice(0,8);this.attendance.check_out_time=this.attendance.check_out&&(new Date((new Date(this.attendance.check_out)).valueOf()-(new Date()).getTimezoneOffset()*60*1000)).toTimeString().slice(0,8);this.previous_attendance_change_date=action.previous_attendance_change_date;this.employee_name=action.employee_name;},start:function(){if(this.attendance){this.attendance.check_out?this.farewell_message():this.welcome_message();}},welcome_message:function(){var self=this;var now=new Date((new Date(this.attendance.check_in)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);this.return_to_main_menu=setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);if(now.getHours()<5){this.$('.o_hr_attendance_message_message').append(_t("Good night"));}else if(now.getHours()<12){if(now.getHours()<8&&Math.random()<0.3){if(Math.random()<0.75){this.$('.o_hr_attendance_message_message').append(_t("The early bird catches the worm"));}else{this.$('.o_hr_attendance_message_message').append(_t("First come, first served"));}}else{this.$('.o_hr_attendance_message_message').append(_t("Good morning"));}}else if(now.getHours()<17){this.$('.o_hr_attendance_message_message').append(_t("Good afternoon"));}else if(now.getHours()<23){this.$('.o_hr_attendance_message_message').append(_t("Good evening"));}else{this.$('.o_hr_attendance_message_message').append(_t("Good night"));}
if(this.previous_attendance_change_date){var last_check_out_date=new Date((new Date(this.previous_attendance_change_date)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);if(now.valueOf()-last_check_out_date.valueOf()>1000*60*60*24*7){this.$('.o_hr_attendance_random_message').html(_t("Glad to have you back, it's been a while!"));}else{if(Math.random()<0.02){this.$('.o_hr_attendance_random_message').html(_t("If a job is worth doing, it is worth doing well!"));}}}},farewell_message:function(){var self=this;var now=new Date((new Date(this.attendance.check_out)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);this.return_to_main_menu=setTimeout(function(){self.do_action(self.next_action,{clear_breadcrumbs:true});},5000);if(this.previous_attendance_change_date){var last_check_in_date=new Date((new Date(this.previous_attendance_change_date)).valueOf()-(new Date()).getTimezoneOffset()*60*1000);if(now.valueOf()-last_check_in_date.valueOf()>1000*60*60*12){this.$('.o_hr_attendance_warning_message').append(_t("Warning! Last check in was over 12 hours ago.<br/>If this isn't right, please contact Human Resources."));clearTimeout(this.return_to_main_menu);this.stop_listening();}else if(now.valueOf()-last_check_in_date.valueOf()>1000*60*60*8){this.$('.o_hr_attendance_random_message').html(_t("Another good day's work! See you soon!"));}}
if(now.getHours()<12){this.$('.o_hr_attendance_message_message').append(_t("Have a good day!"));}else if(now.getHours()<14){this.$('.o_hr_attendance_message_message').append(_t("Have a nice lunch!"));if(Math.random()<0.05){this.$('.o_hr_attendance_random_message').html(_t("Eat breakfast as a king, lunch as a merchant and supper as a beggar"));}else if(Math.random()<0.06){this.$('.o_hr_attendance_random_message').html(_t("An apple a day keeps the doctor away"));}}else if(now.getHours()<17){this.$('.o_hr_attendance_message_message').append(_t("Have a good afternoon"));}else{if(now.getHours()<18&&Math.random()<0.2){this.$('.o_hr_attendance_message_message').append(_t("Early to bed and early to rise, makes a man healthy, wealthy and wise"));}else{this.$('.o_hr_attendance_message_message').append(_t("Have a good evening"));}}},on_barcode_scanned:function(barcode){var self=this;if(this.return_to_main_menu){clearTimeout(this.return_to_main_menu);}
var hr_employee=new Model('hr.employee');hr_employee.call('attendance_scan',[barcode,]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},destroy:function(){clearTimeout(this.return_to_main_menu);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_greeting_message',GreetingMessage);return GreetingMessage;});;

/* /hr_attendance/static/src/js/kiosk_mode.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.kiosk_mode',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var Session=require('web.session');var BarcodeHandlerMixin=require('barcodes.BarcodeHandlerMixin');var QWeb=core.qweb;var _t=core._t;var KioskMode=Widget.extend(BarcodeHandlerMixin,{events:{"click .o_hr_attendance_button_employees":function(){this.do_action('hr_attendance.hr_employee_attendance_action_kanban');},},init:function(parent,action){this._super;BarcodeHandlerMixin.init.apply(this,arguments);},start:function(){var self=this;self.session=Session;var res_company=new Model('res.company');res_company.query(['name']).filter([['id','=',self.session.company_id]]).all().then(function(companies){self.company_name=companies[0].name;self.company_image_url=self.session.url('/web/image',{model:'res.company',id:self.session.company_id,field:'logo',})
self.$el.html(QWeb.render("HrAttendanceKioskMode",{widget:self}));self.start_clock();});return self._super.apply(this,arguments);},on_barcode_scanned:function(barcode){var self=this;var hr_employee=new Model('hr.employee');hr_employee.call('attendance_scan',[barcode,]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},start_clock:function(){this.clock_start=setInterval(function(){this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},500);this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},destroy:function(){clearInterval(this.clock_start);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_kiosk_mode',KioskMode);return KioskMode;});;

/* /hr_attendance/static/src/js/kiosk_confirm.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.kiosk_confirm',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var KioskConfirm=Widget.extend({events:{"click .o_hr_attendance_back_button":function(){this.do_action(this.next_action,{clear_breadcrumbs:true});},"click .o_hr_attendance_sign_in_out_icon":function(){var self=this;this.$('.o_hr_attendance_sign_in_out_icon').attr("disabled","disabled");var hr_employee=new Model('hr.employee');hr_employee.call('attendance_manual',[[this.employee_id],this.next_action]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);self.$('.o_hr_attendance_sign_in_out_icon').removeAttr("disabled");}});},'click .o_hr_attendance_pin_pad_button_0':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+0);},'click .o_hr_attendance_pin_pad_button_1':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+1);},'click .o_hr_attendance_pin_pad_button_2':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+2);},'click .o_hr_attendance_pin_pad_button_3':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+3);},'click .o_hr_attendance_pin_pad_button_4':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+4);},'click .o_hr_attendance_pin_pad_button_5':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+5);},'click .o_hr_attendance_pin_pad_button_6':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+6);},'click .o_hr_attendance_pin_pad_button_7':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+7);},'click .o_hr_attendance_pin_pad_button_8':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+8);},'click .o_hr_attendance_pin_pad_button_9':function(){this.$('.o_hr_attendance_PINbox').val(this.$('.o_hr_attendance_PINbox').val()+9);},'click .o_hr_attendance_pin_pad_button_C':function(){this.$('.o_hr_attendance_PINbox').val('');},'click .o_hr_attendance_pin_pad_button_ok':function(){var self=this;this.$('.o_hr_attendance_pin_pad_button_ok').attr("disabled","disabled");var hr_employee=new Model('hr.employee');hr_employee.call('attendance_manual',[[this.employee_id],this.next_action,this.$('.o_hr_attendance_PINbox').val()]).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);setTimeout(function(){self.$('.o_hr_attendance_pin_pad_button_ok').removeAttr("disabled");},500);}});},},init:function(parent,action){this._super.apply(this,arguments);this.next_action='hr_attendance.hr_attendance_action_kiosk_mode';this.employee_id=action.employee_id;this.employee_name=action.employee_name;this.employee_state=action.employee_state;var self=this;},start:function(){var self=this;self.session.user_has_group('hr_attendance.group_hr_attendance_use_pin').then(function(has_group){self.use_pin=has_group;self.$el.html(QWeb.render("HrAttendanceKioskConfirm",{widget:self}));self.start_clock();});return self._super.apply(this,arguments);},start_clock:function(){this.clock_start=setInterval(function(){this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},500);this.$(".o_hr_attendance_clock").text(new Date().toLocaleTimeString(navigator.language,{hour:'2-digit',minute:'2-digit'}));},destroy:function(){clearInterval(this.clock_start);this._super.apply(this,arguments);},});core.action_registry.add('hr_attendance_kiosk_confirm',KioskConfirm);return KioskConfirm;});;

/* /hr_attendance/static/src/js/my_attendances.js defined in bundle 'web.assets_backend' */
odoo.define('hr_attendance.my_attendances',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var MyAttendances=Widget.extend({events:{"click .o_hr_attendance_sign_in_out_icon":function(){this.$('.o_hr_attendance_sign_in_out_icon').attr("disabled","disabled");this.update_attendance();},},start:function(){var self=this;var hr_employee=new Model('hr.employee');hr_employee.query(['attendance_state','name']).filter([['user_id','=',self.session.uid]]).all().then(function(res){if(_.isEmpty(res)){self.$('.o_hr_attendance_employee').append(_t("Error : Could not find employee linked to user"));return;}
self.employee=res[0];self.$el.html(QWeb.render("HrAttendanceMyMainMenu",{widget:self}));});return this._super.apply(this,arguments);},update_attendance:function(){var self=this;var hr_employee=new Model('hr.employee');hr_employee.call('attendance_manual',[[self.employee.id],'hr_attendance.hr_attendance_action_my_attendances']).then(function(result){if(result.action){self.do_action(result.action);}else if(result.warning){self.do_warn(result.warning);}});},});core.action_registry.add('hr_attendance_my_attendances',MyAttendances);return MyAttendances;});;

/* /bus/static/src/js/bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.bus',function(require){"use strict";var local_storage=require('web.local_storage');var session=require('web.session');var Widget=require('web.Widget');var bus={};var PARTNERS_PRESENCE_CHECK_PERIOD=30000;var TAB_HEARTBEAT_PERIOD=10000;var MASTER_TAB_HEARTBEAT_PERIOD=1500;bus.ERROR_DELAY=10000;bus.Bus=Widget.extend({init:function(){var self=this;this._super();this.options={};this.activated=false;this.bus_id=_.uniqueId('bus');this.channels=[];this.last=0;this.stop=false;this.is_master=true;this.last_presence=new Date().getTime();this.last_partners_presence_check=this.last_presence;this.set("window_focus",true);this.on("change:window_focus",this,function(){if(this.get("window_focus")){this.trigger('window_focus',this.is_master);}});$(window).on("focus."+this.bus_id,_.bind(this.focus_change,this,true));$(window).on("blur."+this.bus_id,_.bind(this.focus_change,this,false));$(window).on("unload."+this.bus_id,_.bind(this.focus_change,this,false));_.each('click,keydown,keyup'.split(','),function(evtype){$(window).on(evtype+"."+self.bus_id,function(){self.last_presence=new Date().getTime();});});},destroy:function(){var self=this;$(window).off("focus."+this.bus_id);$(window).off("blur."+this.bus_id);$(window).off("unload."+this.bus_id);_.each('click,keydown,keyup'.split(','),function(evtype){$(window).off(evtype+"."+self.bus_id);});},start_polling:function(){if(!this.activated){this.poll();this.stop=false;}},stop_polling:function(){this.activated=false;this.stop=true;this.channels=[];},poll:function(){var self=this;self.activated=true;var now=new Date().getTime();var options=_.extend({},this.options,{bus_inactivity:now-this.get_last_presence(),});if(this.last_partners_presence_check+PARTNERS_PRESENCE_CHECK_PERIOD>now){options=_.omit(options,'bus_presence_partner_ids');}else{this.last_partners_presence_check=now;}
var data={channels:self.channels,last:self.last,options:options};session.rpc('/longpolling/poll',data,{shadow:true,timeout:60000}).then(function(result){self.on_notification(result);if(!self.stop){self.poll();}},function(unused,e){e.preventDefault();setTimeout(_.bind(self.poll,self),bus.ERROR_DELAY+(Math.floor((Math.random()*20)+1)*1000));});},on_notification:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self.last){self.last=notif.id;}
return[notif.channel,notif.message];});this.trigger("notification",notifs);},add_channel:function(channel){this.channels.push(channel);this.channels=_.uniq(this.channels);},delete_channel:function(channel){this.channels=_.without(this.channels,channel);},focus_change:function(focus){this.set("window_focus",focus);},is_odoo_focused:function(){return this.get("window_focus");},get_last_presence:function(){return this.last_presence;},update_option:function(key,value){this.options[key]=value;},delete_option:function(key){if(_.contains(_.keys(this.options),key)){delete this.options[key];}},});var CrossTabBus=bus.Bus.extend({init:function(){this._super.apply(this,arguments);this.is_master=false;this.is_registered=false;if(parseInt(getItem('bus.last_ts',0))+50000<new Date().getTime()){setItem('bus.last',-1);}
on("storage",this.on_storage.bind(this));},start_polling:function(){var self=this;if(!this.is_registered){this.is_registered=true;tab_manager.register_tab(function(){self.is_master=true;self.start_polling();},function(){self.is_master=false;self.stop_polling();},function(){var hb_period=this.is_master?MASTER_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD;if(self.last_presence+hb_period>new Date().getTime()){setItem('bus.last_presence',self.last_presence);}});if(this.is_master){setItem('bus.channels',this.channels);setItem('bus.options',this.options);}else{this.channels=getItem('bus.channels',this.channels);this.options=getItem('bus.options',this.options);}
return;}
if(this.is_master){this._super.apply(this,arguments);}},on_notification:function(notifications){if(this.is_master){var last=getItem('bus.last',-1);var max_id=Math.max(last,0);var new_notifications=_.filter(notifications,function(notif){max_id=Math.max(max_id,notif.id);return notif.id<0||notif.id>last;});this.last=max_id;if(new_notifications.length){setItem('bus.last',max_id);setItem('bus.last_ts',new Date().getTime());setItem('bus.notification',new_notifications);this._super(new_notifications);}}else{this._super.apply(this,arguments);}},on_storage:function(e){var value=e.newValue;if(e.key==='bus.notification'){var notifs=JSON.parse(value);this.on_notification(notifs);}
if(e.key==='bus.channels'){this.channels=JSON.parse(value);}
if(e.key==='bus.options'){this.options=JSON.parse(value);}
if(e.key==='bus.focus'){this.set('window_focus',JSON.parse(value));}},add_channel:function(){this._super.apply(this,arguments);setItem('bus.channels',this.channels);},delete_channel:function(){this._super.apply(this,arguments);setItem('bus.channels',this.channels);},get_last_presence:function(){return getItem('bus.last_presence')||new Date().getTime();},update_option:function(){this._super.apply(this,arguments);setItem('bus.options',this.options);},delete_option:function(){this._super.apply(this,arguments);setItem('bus.options',this.options);},focus_change:function(focus){this._super.apply(this,arguments);setItem('bus.focus',focus);},});function on(type,listener){if(window.addEventListener){window.addEventListener(type,listener);}else{window.attachEvent('on'+type,listener);}}
function getItem(key,defaultValue){var val=local_storage.getItem(key);return val?JSON.parse(val):defaultValue;}
function setItem(key,value){local_storage.setItem(key,JSON.stringify(value));}
var tab_manager={peersKey:'bus.peers',masterKey:'bus.master',heartbeatKey:'bus.heartbeat',isMaster:false,id:new Date().getTime()+':'+(Math.random()*1000000000|0),register_tab:function(is_master_callback,is_no_longer_master,on_heartbeat_callback){this.is_master_callback=is_master_callback;this.is_no_longer_master=is_no_longer_master||function(){};this.on_heartbeat_callback=on_heartbeat_callback||function(){};var peers=getItem(tab_manager.peersKey,{});peers[tab_manager.id]=new Date().getTime();setItem(tab_manager.peersKey,peers);on('unload',function(){var peers=getItem(tab_manager.peersKey,{});delete peers[tab_manager.id];setItem(tab_manager.peersKey,peers);if(tab_manager.isMaster){local_storage.removeItem(tab_manager.masterKey);}});if(!local_storage.getItem(tab_manager.masterKey)){tab_manager.start_election();}
on('storage',function(e){if(!e){e=window.event;}
if(e.key!==tab_manager.masterKey){return;}
if(e.newValue===null){tab_manager.start_election();}});tab_manager.heartbeat();},heartbeat:function(){var current=new Date().getTime();var heartbeatValue=local_storage.getItem(tab_manager.heartbeatKey)||0;var peers=getItem(tab_manager.peersKey,{});if((parseInt(heartbeatValue)+5000)<current){tab_manager.start_election();}
if(tab_manager.isMaster){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+15000>current){cleanedPeers[peerName]=peers[peerName];}}
if(!tab_manager.is_last_heartbeat_mine()){tab_manager.isMaster=false;tab_manager.last_heartbeat=0;peers[tab_manager.id]=current;setItem(tab_manager.peersKey,peers);tab_manager.is_no_longer_master();}else{tab_manager.last_heartbeat=current;local_storage.setItem(tab_manager.heartbeatKey,current);setItem(tab_manager.peersKey,cleanedPeers);}}else{peers[tab_manager.id]=current;setItem(tab_manager.peersKey,peers);}
this.on_heartbeat_callback();setTimeout(function(){tab_manager.heartbeat();},tab_manager.isMaster?MASTER_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD);},is_last_heartbeat_mine:function(){var heartbeatValue=local_storage.getItem(tab_manager.heartbeatKey)||0;return(parseInt(heartbeatValue)===tab_manager.last_heartbeat);},start_election:function(){if(tab_manager.isMaster){return;}
var peers=getItem(tab_manager.peersKey,{});var now=new Date().getTime();var newMaster;for(var peerName in peers){if(peers[peerName]+15000<now){continue;}
newMaster=peerName;break;}
if(newMaster===tab_manager.id){setItem(tab_manager.masterKey,tab_manager.id);tab_manager.last_heartbeat=new Date().getTime();setItem(tab_manager.heartbeatKey,tab_manager.last_heartbeat);tab_manager.isMaster=true;tab_manager.is_master_callback();delete peers[newMaster];setItem(tab_manager.peersKey,peers);}},};if(typeof Storage!=="undefined"){bus.bus=new CrossTabBus();}else{bus.bus=new bus.Bus();}
return bus;});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
odoo.define('mail.many2manytags',function(require){"use strict";var core=require('web.core');var form_common=require('web.form_common');var form_relational=require('web.form_relational');var Model=require('web.DataModel');var utils=require('web.utils');var _t=core._t;var FieldMany2ManyTagsEmail=form_relational.FieldMany2ManyTags.extend({start:function(){this.mutex=new utils.Mutex();this.last_processed_value=[];this.on("change:value",this,this.on_change_value_check);this._super.apply(this,arguments);},on_change_value_check:function(){var self=this;var values=this.get('value').slice(0);var effective_change=_.difference(values,self.last_processed_value).length;if(values.length&&effective_change){this.mutex.exec(function(){return self._check_email_popup(values);});}},_check_email_popup:function(ids){var self=this;var valid_partners;return new Model('res.partner').call("search",[[["id","in",ids],["email","=",false],["notify_email","=",'always']]],{context:this.build_context()}).then(function(record_ids){var popups_deferreds=[];self.valid_partners=_.difference(ids,record_ids);_.each(record_ids,function(id){var popup_def=$.Deferred();popups_deferreds.push(popup_def);var pop=new form_common.FormViewDialog(self,{res_model:'res.partner',res_id:id,context:self.build_context(),title:_t("Please complete partner's informations and Email"),}).open();pop.on('write_completed',self,function(){self.valid_partners.push(id);});pop.on('closed',self,function(){popup_def.resolve();});});return $.when.apply($,popups_deferreds).then(function(){var filtered_value=_.uniq(self.valid_partners);self.last_processed_value=filtered_value;self.set({'value':filtered_value});});});},get_render_data:function(ids){this.dataset.cancel_read();return this.dataset.name_get(ids).then(function(names){return _.map(names,function(name){return{id:name[0],display_name:name[1]};});});},});core.form_widget_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);});;

/* /mail/static/src/js/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_client_action',function(require){"use strict";var chat_manager=require('mail.chat_manager');var composer=require('mail.composer');var ChatThread=require('mail.ChatThread');var utils=require('mail.utils');var config=require('web.config');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var framework=require('web.framework');var Model=require('web.Model');var pyeval=require('web.pyeval');var SearchView=require('web.SearchView');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var PartnerInviteDialog=Dialog.extend({dialog_title:_t('Invite people'),template:"mail.PartnerInviteDialog",init:function(parent,title,channel_id){this.channel_id=channel_id;this._super(parent,{title:title,size:"medium",buttons:[{text:_t("Invite"),close:true,classes:"btn-primary",click:_.bind(this.on_click_add,this),}],});},start:function(){this.$input=this.$('.o_mail_chat_partner_invite_input');this.$input.select2({width:'100%',allowClear:true,multiple:true,formatResult:function(item){var status=QWeb.render('mail.chat.UserStatus',{status:item.im_status});return $('<span>').text(item.text).prepend(status);},query:function(query){chat_manager.search_partner(query.term,20).then(function(partners){query.callback({results:_.map(partners,function(partner){return _.extend(partner,{text:partner.label});}),});});}});return this._super.apply(this,arguments);},on_click_add:function(){var self=this;var data=this.$input.select2('data');if(data.length>=1){var ChannelModel=new Model('mail.channel');return ChannelModel.call('channel_invite',[this.channel_id],{partner_ids:_.pluck(data,'id')}).then(function(){var names=_.escape(_.pluck(data,'text').join(', '));var notification=_.str.sprintf(_t('You added <b>%s</b> to the conversation.'),names);self.do_notify(_t('New people'),notification);});}},});var ChatAction=Widget.extend(ControlPanelMixin,{template:'mail.client_action',events:{"click .o_mail_chat_channel_item":function(event){event.preventDefault();var channel_id=this.$(event.currentTarget).data('channel-id');this.set_channel(chat_manager.get_channel(channel_id));},"click .o_mail_sidebar_title .o_add":function(event){event.preventDefault();var type=$(event.target).data("type");this.$('.o_mail_add_channel[data-type='+type+']').show().find("input").focus();},"blur .o_mail_add_channel input":function(){this.$('.o_mail_add_channel').hide();},"click .o_mail_partner_unpin":function(event){event.stopPropagation();var channel_id=$(event.target).data("channel-id");chat_manager.unsubscribe(chat_manager.get_channel(channel_id));},"click .o_snackbar_undo":function(event){event.preventDefault();var channel=this.channel;this.$snackbar.remove();this.clear_needactions_def.then(function(msgs_ids){chat_manager.undo_mark_as_read(msgs_ids,channel);});},"click .o_mail_annoying_notification_bar .fa-close":function(){this.$(".o_mail_annoying_notification_bar").slideUp();},"click .o_mail_request_permission":function(event){event.preventDefault();this.$(".o_mail_annoying_notification_bar").slideUp();var def=window.Notification&&window.Notification.requestPermission();if(def){def.then(function(value){if(value==='granted'){utils.send_notification(_t('Permission granted'),_t('Odoo has now the permission to send you native notifications on this device.'));}else{utils.send_notification(_t('Permission denied'),_t('Odoo will not have the permission to send native notifications on this device.'));}});}},"keydown":function(event){if(event.which===$.ui.keyCode.ESCAPE&&this.selected_message){this.unselect_message();}},"click .o_mail_open_channels":function(){this.do_action({name:_t('Public Channels'),type:'ir.actions.act_window',res_model:"mail.channel",views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']],},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},},on_attach_callback:function(){chat_manager.bus.trigger('client_action_open',true);if(this.channel){this.thread.scroll_to({offset:this.channels_scrolltop[this.channel.id]});}},on_detach_callback:function(){chat_manager.bus.trigger('client_action_open',false);this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();},init:function(parent,action,options){this._super.apply(this,arguments);this.action_manager=parent;this.dataset=new data.DataSetSearch(this,'mail.message');this.domain=[];this.action=action;this.options=options||{};this.channels_scrolltop={};this.throttled_render_sidebar=_.throttle(this.render_sidebar.bind(this),100,{leading:false});this.notification_bar=(window.Notification&&window.Notification.permission==="default");this.selected_message=null;},willStart:function(){var self=this;var view_id=this.action&&this.action.search_view_id&&this.action.search_view_id[0];var def=data_manager.load_fields_view(this.dataset,view_id,'search',false).then(function(fields_view){self.fields_view=fields_view;});return $.when(this._super(),chat_manager.is_ready,def);},start:function(){var self=this;var options={$buttons:$("<div>"),action:this.action,disable_groupby:true,};var default_channel_id=this.options.active_id||this.action.context.active_id||this.action.params.default_active_id||'channel_inbox';var default_channel=chat_manager.get_channel(default_channel_id)||chat_manager.get_channel('channel_inbox');this.searchview=new SearchView(this,this.dataset,this.fields_view,options);this.searchview.on('search_data',this,this.on_search);this.basic_composer=new composer.BasicComposer(this,{mention_partners_restricted:true});this.extended_composer=new composer.ExtendedComposer(this,{mention_partners_restricted:true});this.thread=new ChatThread(this,{display_help:true,});this.$buttons=$(QWeb.render("mail.chat.ControlButtons",{}));this.$buttons.find('button').css({display:"inline-block"});this.$buttons.on('click','.o_mail_chat_button_invite',this.on_click_button_invite);this.$buttons.on('click','.o_mail_chat_button_unsubscribe',this.on_click_button_unsubscribe);this.$buttons.on('click','.o_mail_chat_button_settings',this.on_click_button_settings);this.$buttons.on('click','.o_mail_toggle_channels',function(){self.$('.o_mail_chat_sidebar').slideToggle(200);});this.$buttons.on('click','.o_mail_chat_button_mark_read',function(){chat_manager.mark_all_as_read(self.channel,self.domain);});this.$buttons.on('click','.o_mail_chat_button_unstar_all',chat_manager.unstar_all);this.thread.on('redirect',this,function(res_model,res_id){chat_manager.redirect(res_model,res_id,this.set_channel.bind(this));});this.thread.on('redirect_to_channel',this,function(channel_id){chat_manager.join_channel(channel_id).then(this.set_channel.bind(this));});this.thread.on('load_more_messages',this,this.load_more_messages);this.thread.on('mark_as_read',this,function(message_id){chat_manager.mark_as_read([message_id]);});this.thread.on('toggle_star_status',this,function(message_id){chat_manager.toggle_star_status(message_id);});this.thread.on('select_message',this,this.select_message);this.thread.on('unselect_message',this,this.unselect_message);this.basic_composer.on('post_message',this,this.on_post_message);this.basic_composer.on('input_focused',this,this.on_composer_input_focused);this.extended_composer.on('post_message',this,this.on_post_message);this.extended_composer.on('input_focused',this,this.on_composer_input_focused);var def1=this.thread.appendTo(this.$('.o_mail_chat_content'));var def2=this.basic_composer.appendTo(this.$('.o_mail_chat_content'));var def3=this.extended_composer.appendTo(this.$('.o_mail_chat_content'));var def4=this.searchview.appendTo($("<div>")).then(function(){self.$searchview_buttons=self.searchview.$buttons.contents();self.searchview.do_search();});this.render_sidebar();return $.when(def1,def2,def3,def4).then(this.set_channel.bind(this,default_channel)).then(function(){chat_manager.bus.on('open_channel',self,self.set_channel);chat_manager.bus.on('new_message',self,self.on_new_message);chat_manager.bus.on('update_message',self,self.on_update_message);chat_manager.bus.on('new_channel',self,self.on_new_channel);chat_manager.bus.on('anyone_listening',self,function(channel,query){query.is_displayed=query.is_displayed||(channel.id===self.channel.id&&self.thread.is_at_bottom());});chat_manager.bus.on('unsubscribe_from_channel',self,self.on_channel_unsubscribed);chat_manager.bus.on('update_needaction',self,self.throttled_render_sidebar);chat_manager.bus.on('update_starred',self,self.throttled_render_sidebar);chat_manager.bus.on('update_channel_unread_counter',self,self.throttled_render_sidebar);chat_manager.bus.on('update_dm_presence',self,self.throttled_render_sidebar);self.thread.$el.on("scroll",null,_.debounce(function(){if(self.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(self.channel);}},100));});},select_message:function(message_id){this.$el.addClass('o_mail_selection_mode');var message=chat_manager.get_message(message_id);this.selected_message=message;var subject="Re: "+message.record_name;this.extended_composer.set_subject(subject);if(this.channel.type!=='static'){this.basic_composer.toggle(false);}
this.extended_composer.toggle(true);this.thread.scroll_to({id:message_id,duration:200,only_if_necessary:true});this.extended_composer.focus('body');},unselect_message:function(){this.basic_composer.toggle(this.channel.type!=='static'&&!this.channel.mass_mailing);this.extended_composer.toggle(this.channel.type!=='static'&&this.channel.mass_mailing);if(!config.device.touch){var composer=this.channel.mass_mailing?this.extended_composer:this.basic_composer;composer.focus();}
this.$el.removeClass('o_mail_selection_mode');this.thread.unselect();this.selected_message=null;},render_sidebar:function(){var self=this;var $sidebar=this._render_sidebar({active_channel_id:this.channel?this.channel.id:undefined,channels:chat_manager.get_channels(),needaction_counter:chat_manager.get_needaction_counter(),starred_counter:chat_manager.get_starred_counter(),});this.$(".o_mail_chat_sidebar").html($sidebar.contents());this.$('.o_mail_add_channel[data-type=public]').find("input").autocomplete({source:function(request,response){self.last_search_val=_.escape(request.term);self.do_search_channel(self.last_search_val).done(function(result){result.push({'label':_.str.sprintf('<strong>'+_t("Create %s")+'</strong>','<em>"#'+self.last_search_val+'"</em>'),'value':'_create',});response(result);});},select:function(event,ui){if(self.last_search_val){if(ui.item.value==='_create'){chat_manager.create_channel(self.last_search_val,"public");}else{chat_manager.join_channel(ui.item.id);}}},focus:function(event){event.preventDefault();},html:true,});this.$('.o_mail_add_channel[data-type=dm]').find("input").autocomplete({source:function(request,response){self.last_search_val=_.escape(request.term);chat_manager.search_partner(self.last_search_val,10).done(response);},select:function(event,ui){var partner_id=ui.item.id;var dm=chat_manager.get_dm_from_partner_id(partner_id);if(dm){self.set_channel(dm);}else{chat_manager.create_channel(partner_id,"dm");}
$(this).val('');return false;},focus:function(event){event.preventDefault();},});this.$('.o_mail_add_channel[data-type=private]').find("input").on('keyup',this,function(event){var name=_.escape($(event.target).val());if(event.which===$.ui.keyCode.ENTER&&name){chat_manager.create_channel(name,"private");}});},_render_sidebar:function(options){return $(QWeb.render("mail.chat.Sidebar",options));},render_snackbar:function(template,context,timeout){if(this.$snackbar){this.$snackbar.remove();}
timeout=timeout||20000;this.$snackbar=$(QWeb.render(template,context));this.$('.o_mail_chat_content').append(this.$snackbar);var $snackbar=this.$snackbar;setTimeout(function(){$snackbar.fadeOut();},timeout);},do_search_channel:function(search_val){var Channel=new Model("mail.channel");return Channel.call('channel_search_to_join',[search_val]).then(function(result){var values=[];_.each(result,function(channel){var escaped_name=_.escape(channel.name);values.push(_.extend(channel,{'value':escaped_name,'label':escaped_name,}));});return values;});},set_channel:function(channel){var self=this;if(this.channel){this.channels_scrolltop[this.channel.id]=this.thread.get_scrolltop();}
var new_channel_scrolltop=this.channels_scrolltop[channel.id];this.channel=channel;this.messages_separator_position=undefined;this.unread_counter=this.channel.unread_counter;this.last_seen_message_id=this.channel.last_seen_message_id;this.clear_needactions_def=$.Deferred();if(this.$snackbar){this.$snackbar.remove();}
this.action.context.active_id=channel.id;this.action.context.active_ids=[channel.id];return this.fetch_and_render_thread().then(function(){if(channel.type!=='static'){if(channel.needaction_counter>0){self.render_snackbar('mail.chat.UndoSnackbar',{nb_needactions:channel.needaction_counter,});}
chat_manager.mark_channel_as_seen(channel);self.clear_needactions_def=chat_manager.mark_all_as_read(channel);}
self.set("title",'#'+channel.name);self.$buttons.find('.o_mail_chat_button_invite, .o_mail_chat_button_unsubscribe, .o_mail_chat_button_settings').toggle(channel.type!=="dm"&&channel.type!=='static');self.$buttons.find('.o_mail_chat_button_mark_read').toggle(channel.id==="channel_inbox");self.$buttons.find('.o_mail_chat_button_unstar_all').toggle(channel.id==="channel_starred");self.$('.o_mail_chat_channel_item').removeClass('o_active').filter('[data-channel-id='+channel.id+']').removeClass('o_unread_message').addClass('o_active');var $new_messages_separator=self.$('.o_thread_new_messages_separator');if($new_messages_separator.length){self.thread.$el.scrollTo($new_messages_separator);}else{self.thread.scroll_to({offset:new_channel_scrolltop});}
self.update_cp();if(config.device.size_class===config.device.SIZES.XS){self.$('.o_mail_chat_sidebar').hide();}
self.unselect_message();self.action_manager.do_push_state({action:self.action.id,active_id:self.channel.id,});});},get_thread_rendering_options:function(messages){if(_.isUndefined(this.messages_separator_position)){if(!this.unread_counter){this.messages_separator_position=false;}else{var msg=chat_manager.get_last_seen_message(this.channel);this.messages_separator_position=msg?msg.id:'top';}}
return{channel_id:this.channel.id,display_load_more:!chat_manager.all_history_loaded(this.channel,this.domain),display_needactions:this.channel.display_needactions,messages_separator_position:this.messages_separator_position,squash_close_messages:this.channel.type!=='static'&&!this.channel.mass_mailing,display_empty_channel:!messages.length&&!this.domain.length,display_no_match:!messages.length&&this.domain.length,display_subject:this.channel.mass_mailing||this.channel.id==="channel_inbox",display_email_icon:false,display_reply_icon:true,};},fetch_and_render_thread:function(){var self=this;return chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain}).then(function(result){self.thread.render(result,self.get_thread_rendering_options(result));self.update_button_status(result.length===0);});},update_button_status:function(disabled){if(this.channel.id==="channel_inbox"){this.$buttons.find('.o_mail_chat_button_mark_read').toggleClass('disabled',disabled);}
if(this.channel.id==="channel_starred"){this.$buttons.find('.o_mail_chat_button_unstar_all').toggleClass('disabled',disabled);}},load_more_messages:function(){var self=this;var oldest_msg_id=this.$('.o_thread_message').first().data('messageId');var oldest_msg_selector='.o_thread_message[data-message-id="'+oldest_msg_id+'"]';var offset=-framework.getPosition(document.querySelector(oldest_msg_selector)).top;return chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain,load_more:true}).then(function(result){if(self.messages_separator_position==='top'){self.messages_separator_position=undefined;}
self.thread.render(result,self.get_thread_rendering_options(result));offset+=framework.getPosition(document.querySelector(oldest_msg_selector)).top;self.thread.scroll_to({offset:offset});});},update_cp:function(){this.update_control_panel({breadcrumbs:this.action_manager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons,$searchview:this.searchview.$el,$searchview_buttons:this.$searchview_buttons,},searchview:this.searchview,});},do_show:function(){this._super.apply(this,arguments);this.update_cp();this.action_manager.do_push_state({action:this.action.id,active_id:this.channel.id,});},on_search:function(domains){var result=pyeval.sync_eval_domains_and_contexts({domains:domains});this.domain=result.domain;if(this.channel){this.fetch_and_render_thread();}},on_post_message:function(message){var self=this;var options=this.selected_message?{}:{channel_id:this.channel.id};if(this.selected_message){message.subtype=this.selected_message.is_note?'mail.mt_note':'mail.mt_comment';message.subtype_id=false;message.message_type='comment';message.content_subtype='html';options.model=this.selected_message.model;options.res_id=this.selected_message.res_id;}
chat_manager.post_message(message,options).then(function(){if(self.selected_message){self.render_snackbar('mail.chat.MessageSentSnackbar',{record_name:self.selected_message.record_name},5000);self.unselect_message();}else{self.thread.scroll_to();}}).fail(function(){});},on_new_message:function(message){var self=this;if(_.contains(message.channel_ids,this.channel.id)){if(this.channel.type!=='static'&&this.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(this.channel);}
var should_scroll=this.thread.is_at_bottom();this.fetch_and_render_thread().then(function(){if(should_scroll){self.thread.scroll_to({id:message.id});}});}
this.render_sidebar();this.channels_scrolltop=_.omit(this.channels_scrolltop,message.channel_ids);},on_update_message:function(message){var self=this;var current_channel_id=this.channel.id;if((current_channel_id==="channel_starred"&&!message.is_starred)||(current_channel_id==="channel_inbox"&&!message.is_needaction)){chat_manager.get_messages({channel_id:this.channel.id,domain:this.domain}).then(function(messages){var options=self.get_thread_rendering_options(messages);self.thread.remove_message_and_render(message.id,messages,options).then(function(){self.update_button_status(messages.length===0);});});}else if(_.contains(message.channel_ids,current_channel_id)){this.fetch_and_render_thread();}},on_new_channel:function(channel){this.render_sidebar();if(channel.autoswitch){this.set_channel(channel);}},on_channel_unsubscribed:function(channel_id){if(this.channel.id===channel_id){this.set_channel(chat_manager.get_channel("channel_inbox"));}
this.render_sidebar();delete this.channels_scrolltop[channel_id];},on_composer_input_focused:function(){var composer=this.channel.mass_mailing?this.extended_composer:this.basic_composer;var commands=chat_manager.get_commands(this.channel);var partners=chat_manager.get_mention_partner_suggestions(this.channel);composer.mention_set_enabled_commands(commands);composer.mention_set_prefetched_partners(partners);},on_click_button_invite:function(){var title=_.str.sprintf(_t('Invite people to #%s'),this.channel.name);new PartnerInviteDialog(this,title,this.channel.id).open();},on_click_button_unsubscribe:function(){chat_manager.unsubscribe(this.channel);},on_click_button_settings:function(){this.do_action({type:'ir.actions.act_window',res_model:"mail.channel",res_id:this.channel.id,views:[[false,'form']],target:'current'});},destroy:function(){if(this.$buttons){this.$buttons.off().destroy();}
this._super.apply(this,arguments);},});core.action_registry.add('mail.chat.instant_messaging',ChatAction);});;

/* /mail/static/src/js/chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatWindow',function(require){"use strict";var ChatThread=require('mail.ChatThread');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var HEIGHT_OPEN='400px';var HEIGHT_FOLDED='28px';return Widget.extend({template:"mail.ChatWindow",events:{"click .o_chat_composer":"focus_input","keydown .o_chat_composer":"on_keydown","keypress .o_chat_composer":"on_keypress","click .o_chat_window_close":"on_click_close","click .o_chat_title":"on_click_fold",},init:function(parent,channel_id,title,is_folded,unread_msgs,options){this._super(parent);this.title=title;this.channel_id=channel_id;this.folded=is_folded;this.options=_.defaults(options||{},{autofocus:true,display_stars:true,display_reply_icon:false,display_email_icon:false,placeholder:_t("Say something"),input_less:false,});this.status=this.options.status;this.unread_msgs=unread_msgs||0;this.is_hidden=false;},start:function(){this.$input=this.$('.o_composer_text_field');this.$header=this.$('.o_chat_header');this.thread=new ChatThread(this,{channel_id:this.channel_id,display_needactions:false,display_stars:this.options.display_stars,});this.thread.on('toggle_star_status',null,this.trigger.bind(this,'toggle_star_status'));this.thread.on('redirect_to_channel',null,this.trigger.bind(this,'redirect_to_channel'));this.thread.on('redirect',null,this.trigger.bind(this,'redirect'));if(this.folded){this.$el.css('height',HEIGHT_FOLDED);}else if(this.options.autofocus){this.focus_input();}
var def=this.thread.replace(this.$('.o_chat_content'));return $.when(this._super(),def);},render:function(messages){this.update_unread(this.unread_msgs);this.thread.render(messages,{display_load_more:false});},update_unread:function(counter){this.unread_msgs=counter;this.render_header();},update_status:function(status){this.status=status;this.render_header();},render_header:function(){this.$header.html(QWeb.render('mail.ChatWindowHeaderContent',{status:this.status,title:this.title,unread_counter:this.unread_msgs,}));},fold:function(){this.$el.animate({height:this.folded?HEIGHT_FOLDED:HEIGHT_OPEN});},toggle_fold:function(fold){this.folded=_.isBoolean(fold)?fold:!this.folded;if(!this.folded){this.thread.scroll_to();this.focus_input();}
this.fold();},focus_input:function(){if(!config.device.touch){this.$input.focus();}},do_show:function(){this.is_hidden=false;this._super.apply(this,arguments);},do_hide:function(){this.is_hidden=true;this._super.apply(this,arguments);},do_toggle:function(display){this.is_hidden=_.isBoolean(display)?!display:!this.is_hidden;this._super.apply(this,arguments);},on_keypress:function(event){event.stopPropagation();},on_keydown:function(event){event.stopPropagation();if(event.which===13){var content=_.str.trim(this.$input.val());var message={content:content,attachment_ids:[],partner_ids:[],};this.$input.val('');if(content){this.trigger('post_message',message,this.channel_id);}}},on_click_close:function(event){event.stopPropagation();event.preventDefault();this.trigger("close_chat_session");},on_click_fold:function(){if(config.device.size_class!==config.device.SIZES.XS){this.toggle_fold();this.trigger("fold_channel",this.channel_id,this.folded);}},});});;

/* /mail/static/src/js/extended_chat_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ExtendedChatWindow',function(require){"use strict";var chat_manager=require('mail.chat_manager');var ChatWindow=require('mail.ChatWindow');var composer=require('mail.composer');return ChatWindow.extend({template:"mail.ExtendedChatWindow",start:function(){var self=this;var def;if(self.options.thread_less){this.$el.addClass('o_thread_less');this.$('.o_chat_search_input input').autocomplete({source:function(request,response){chat_manager.search_partner(request.term,10).done(response);},select:function(event,ui){self.trigger('open_dm_session',ui.item.id);},}).focus();}else if(!self.options.input_less){var basic_composer=new composer.BasicComposer(self,{mention_partners_restricted:true});basic_composer.on('post_message',self,function(message){this.trigger('post_message',message,this.channel_id);});basic_composer.once('input_focused',self,function(){var channel=chat_manager.get_channel(this.channel_id);var commands=chat_manager.get_commands(channel);var partners=chat_manager.get_mention_partner_suggestions(channel);basic_composer.mention_set_enabled_commands(commands);basic_composer.mention_set_prefetched_partners(partners);});def=basic_composer.replace(self.$('.o_chat_composer'));}
return $.when(this._super(),def);},on_keydown:function(event){event.stopPropagation();},});});;

/* /mail/static/src/js/composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer',function(require){"use strict";var chat_manager=require('mail.chat_manager');var utils=require('mail.utils');var core=require('web.core');var data=require('web.data');var dom_utils=require('web.dom_utils');var Model=require('web.Model');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var NON_BREAKING_SPACE='\u00a0';var MENTION_PARTNER_DELIMITER='@';var MENTION_CHANNEL_DELIMITER='#';var MENTION_CANNED_RESPONSE_DELIMITER=':';var MENTION_COMMAND_DELIMITER='/';var MentionManager=Widget.extend({className:'dropup o_composer_mention_dropdown',events:{"mouseover .o_mention_proposition":"on_hover_mention_proposition","click .o_mention_proposition":"on_click_mention_item",},init:function(parent,options){this._super.apply(this,arguments);this.composer=parent;this.options=_.extend({},options,{min_length:0,});this.open=false;this.listeners=[];this.set('mention_suggestions',[]);this.on('change:mention_suggestions',this,this._render_suggestions);},on_hover_mention_proposition:function(event){var $elem=$(event.currentTarget);this.$('.o_mention_proposition').removeClass('active');$elem.addClass('active');},on_click_mention_item:function(event){event.preventDefault();var text_input=this.composer.$input.val();var id=$(event.currentTarget).data('id');var selected_suggestion=_.find(_.flatten(this.get('mention_suggestions')),function(s){return s.id===id;});var substitution=selected_suggestion.substitution;if(!substitution){selected_suggestion.name=selected_suggestion.name.replace(/ /g,NON_BREAKING_SPACE);substitution=this.active_listener.delimiter+selected_suggestion.name;}
var get_mention_index=function(matches,cursor_position){for(var i=0;i<matches.length;i++){if(cursor_position<=matches[i].index){return i;}}
return i;};if(this.active_listener.selection.length){var matches=this._get_match(text_input,this.active_listener);var index=get_mention_index(matches,this._get_selection_positions().start);this.active_listener.selection.splice(index,0,selected_suggestion);}else{this.active_listener.selection.push(selected_suggestion);}
var cursor_position=this._get_selection_positions().start;var text_left=text_input.substring(0,cursor_position-(this.mention_word.length+1));var text_right=text_input.substring(cursor_position,text_input.length);var text_input_new=text_left+substitution+' '+text_right;this.composer.$input.val(text_input_new);this._set_cursor_position(text_left.length+substitution.length+2);this.set('mention_suggestions',[]);this.composer.focus();},register:function(listener){this.listeners.push(_.defaults(listener,{model:'',redirect_classname:'',selection:[],}));},is_open:function(){return this.open;},get_listener_selection:function(delimiter){var listener=_.findWhere(this.listeners,{delimiter:delimiter});if(listener){var input_mentions=this.composer.$input.val().match(new RegExp(delimiter+'[^ ]+(?= |&nbsp;)','g'));return this._validate_selection(listener.selection,input_mentions);}
return[];},get_listener_selections:function(){var selections={};_.each(this.listeners,function(listener){selections[listener.delimiter]=listener.selection;});return selections;},proposition_navigation:function(keycode){var $active=this.$('.o_mention_proposition.active');if(keycode===$.ui.keyCode.ENTER){$active.click();}else{var $to;if(keycode===$.ui.keyCode.DOWN){$to=$active.nextAll('.o_mention_proposition').first();}else{$to=$active.prevAll('.o_mention_proposition').first();}
if($to.length){$active.removeClass('active');$to.addClass('active');}}},detect_delimiter:function(){var self=this;var text_val=this.composer.$input.val();var cursor_position=this._get_selection_positions().start;var left_string=text_val.substring(0,cursor_position);function validate_keyword(delimiter,beginning_only){var delimiter_position=left_string.lastIndexOf(delimiter)-1;if(beginning_only&&delimiter_position>0){return false;}
var search_str=text_val.substring(delimiter_position,cursor_position);var pattern="(^"+delimiter+"|(^\\s"+delimiter+"))";var regex_start=new RegExp(pattern,"g");search_str=search_str.replace(/^\s\s*|^[\n\r]/g,'');if(regex_start.test(search_str)&&search_str.length>self.options.min_length){search_str=search_str.replace(pattern,'');return search_str.indexOf(' ')<0&&!/[\r\n]/.test(search_str)?search_str.replace(delimiter,''):false;}
return false;}
this.active_listener=undefined;for(var i=0;i<this.listeners.length;i++){var listener=this.listeners[i];this.mention_word=validate_keyword(listener.delimiter,listener.beginning_only);if(this.mention_word!==false){this.active_listener=listener;break;}}
if(this.active_listener){var mention_word=this.mention_word;$.when(this.active_listener.fetch_callback(mention_word)).then(function(suggestions){if(mention_word===self.mention_word){self.set('mention_suggestions',suggestions);}});}else{this.set('mention_suggestions',[]);}},generate_links:function(s){var self=this;var base_href=session.url("/web");var mention_link="<a href='%s' class='%s' data-oe-id='%s' data-oe-model='%s' target='_blank'>%s%s</a>";_.each(this.listeners,function(listener){if(!listener.generate_links){return;}
var selection=listener.selection;if(selection.length){var matches=self._get_match(s,listener);var substrings=[];var start_index=0;for(var i=0;i<matches.length;i++){var match=matches[i];var end_index=match.index+match[0].length;var selection_id=self.get_selection_id(match,selection);var match_name=match[0].substring(1).replace(new RegExp(NON_BREAKING_SPACE,'g'),' ');var href=base_href+_.str.sprintf("#model=%s&id=%s",listener.model,selection_id);var processed_text=_.str.sprintf(mention_link,href,listener.redirect_classname,selection_id,listener.model,listener.delimiter,match_name);var subtext=s.substring(start_index,end_index).replace(match[0],processed_text);substrings.push(subtext);start_index=end_index;}
substrings.push(s.substring(start_index,s.length));s=substrings.join('');}});return s;},get_selection_id:function(match,selection){return _.findWhere(selection,{'name':match[0].slice(1)}).id;},reset_suggestions:function(){this.set('mention_suggestions',[]);},reset_selections:function(){_.each(this.listeners,function(listener){listener.selection=[];});},_get_match:function(input_text,listener){var names=_.pluck(listener.selection,'name');var escaped_names=_.map(names,function(str){return"("+_.str.escapeRegExp(listener.delimiter+str)+")(?= |&nbsp;)";});var regex_str=escaped_names.join('|');var result=[];if(regex_str.length){var myRegexp=new RegExp(regex_str,'g');var match=myRegexp.exec(input_text);while(match!==null){result.push(match);match=myRegexp.exec(input_text);}}
return result;},_render_suggestions:function(){var suggestions=[];if(_.find(this.get('mention_suggestions'),_.isArray)){var insert_divider=false;_.each(this.get('mention_suggestions'),function(suggestion_group){if(suggestion_group.length>0){if(insert_divider){suggestions.push({divider:true});}
suggestions=suggestions.concat(suggestion_group);insert_divider=true;}});}else{suggestions=this.get('mention_suggestions');}
if(suggestions.length){this.$el.html(QWeb.render(this.active_listener.suggestion_template,{suggestions:suggestions,}));this.$el.addClass('open').find('ul').css("max-width",this.composer.$input.width()).find('.o_mention_proposition').first().addClass('active');this.open=true;}else{this.$el.removeClass('open');this.$el.empty();this.open=false;}},_validate_selection:function(selection,input_mentions){var validated_selection=[];_.each(input_mentions,function(mention){var validated_mention=_.findWhere(selection,{name:mention.slice(1)});if(validated_mention){validated_selection.push(validated_mention);}});return validated_selection;},_get_selection_positions:function(){var el=this.composer.$input.get(0);return el?{start:el.selectionStart,end:el.selectionEnd}:{start:0,end:0};},_set_cursor_position:function(pos){this.composer.$input.each(function(index,elem){if(elem.setSelectionRange){elem.setSelectionRange(pos,pos);}
else if(elem.createTextRange){elem.createTextRange().collapse(true).moveEnd('character',pos).moveStart('character',pos).select();}});},});var BasicComposer=Widget.extend({template:"mail.ChatComposer",events:{"keydown .o_composer_input textarea":"on_keydown","keyup .o_composer_input":"on_keyup","change input.o_form_input_file":"on_attachment_change","click .o_composer_button_send":"send_message","click .o_composer_button_add_attachment":"on_click_add_attachment","click .o_attachment_delete":"on_attachment_delete",},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{commands_enabled:true,context:{},input_baseline:18,input_max_height:150,input_min_height:28,mention_fetch_limit:8,mention_partners_restricted:false,send_text:_t('Send'),default_body:'',default_mention_selections:{},});this.context=this.options.context;this.AttachmentDataSet=new data.DataSetSearch(this,'ir.attachment',this.context);this.fileupload_id=_.uniqueId('o_chat_fileupload');this.set('attachment_ids',[]);this.mention_manager=new MentionManager(this);this.mention_manager.register({delimiter:MENTION_PARTNER_DELIMITER,fetch_callback:this.mention_fetch_partners.bind(this),generate_links:true,model:'res.partner',redirect_classname:'o_mail_redirect',selection:this.options.default_mention_selections[MENTION_PARTNER_DELIMITER],suggestion_template:'mail.MentionPartnerSuggestions',});this.mention_manager.register({delimiter:MENTION_CHANNEL_DELIMITER,fetch_callback:this.mention_fetch_channels.bind(this),generate_links:true,model:'mail.channel',redirect_classname:'o_channel_redirect',selection:this.options.default_mention_selections[MENTION_CHANNEL_DELIMITER],suggestion_template:'mail.MentionChannelSuggestions',});this.mention_manager.register({delimiter:MENTION_CANNED_RESPONSE_DELIMITER,fetch_callback:this.mention_get_canned_responses.bind(this),selection:this.options.default_mention_selections[MENTION_CANNED_RESPONSE_DELIMITER],suggestion_template:'mail.MentionCannedResponseSuggestions',});if(this.options.commands_enabled){this.mention_manager.register({beginning_only:true,delimiter:MENTION_COMMAND_DELIMITER,fetch_callback:this.mention_get_commands.bind(this),selection:this.options.default_mention_selections[MENTION_COMMAND_DELIMITER],suggestion_template:'mail.MentionCommandSuggestions',});}
this.emoji_container_classname='o_composer_emoji';this.PartnerModel=new Model('res.partner');this.ChannelModel=new Model('mail.channel');},start:function(){var self=this;this.$attachment_button=this.$(".o_composer_button_add_attachment");this.$attachments_list=this.$('.o_composer_attachments_list');this.$input=this.$('.o_composer_input textarea');this.$input.focus(function(){self.trigger('input_focused');});this.$input.val(this.options.default_body);dom_utils.autoresize(this.$input,{parent:this,min_height:this.options.input_min_height});$(window).on(this.fileupload_id,this.on_attachment_loaded);this.on("change:attachment_ids",this,this.render_attachments);this.$('.o_composer_button_emoji').popover({placement:'top',content:function(){if(!self.$emojis){self.$emojis=$(QWeb.render('mail.ChatComposer.emojis',{emojis:chat_manager.get_emojis(),}));self.$emojis.filter('.o_mail_emoji').on('click',self,self.on_click_emoji_img);}
return self.$emojis;},html:true,container:'.'+self.emoji_container_classname,trigger:'focus',});this.mention_manager.prependTo(this.$('.o_composer'));return this._super();},destroy:function(){$(window).off(this.fileupload_id);return this._super.apply(this,arguments);},toggle:function(state){this.$el.toggle(state);},preprocess_message:function(){var value=_.escape(this.$input.val()).replace(/\n|\r/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');var commands=this.options.commands_enabled?this.mention_manager.get_listener_selection('/'):[];return $.when({content:this.mention_manager.generate_links(value),attachment_ids:_.pluck(this.get('attachment_ids'),'id'),partner_ids:_.uniq(_.pluck(this.mention_manager.get_listener_selection('@'),'id')),command:commands.length>0?commands[0].name:undefined,});},send_message:function(){if(this.is_empty()||!this.do_check_attachment_upload()){return;}
var self=this;this.preprocess_message().then(function(message){self.trigger('post_message',message);self.$input.val('');self.mention_manager.reset_selections();self.set('attachment_ids',[]);self.$input.focus();});},on_click_add_attachment:function(){this.$('input.o_form_input_file').click();this.$input.focus();},on_click_emoji_img:function(event){this.$input.val(this.$input.val()+" "+$(event.currentTarget).data('emoji')+" ");this.$input.focus();},should_send:function(event){return!event.shiftKey;},on_keydown:function(event){switch(event.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(this.mention_manager.is_open()){event.preventDefault();}
break;case $.ui.keyCode.ENTER:if(this.mention_manager.is_open()){event.preventDefault();}else{var send_message=event.ctrlKey||this.should_send(event);if(send_message){event.preventDefault();this.send_message();}}
break;}},on_keyup:function(event){switch(event.which){case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:break;case $.ui.keyCode.ESCAPE:event.stopPropagation();this.mention_manager.reset_suggestions();break;case $.ui.keyCode.ENTER:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(this.mention_manager.is_open()){this.mention_manager.proposition_navigation(event.which);}
break;default:this.mention_manager.detect_delimiter();}},on_attachment_change:function(event){var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');var attachments=[];for(var i in this.get('attachment_ids')){if((this.get('attachment_ids')[i].filename||this.get('attachment_ids')[i].name)===filename){if(this.get('attachment_ids')[i].upload){return false;}
this.AttachmentDataSet.unlink([this.get('attachment_ids')[i].id]);}else{attachments.push(this.get('attachment_ids')[i]);}}
this.$('form.o_form_binary_form').submit();this.$attachment_button.prop('disabled',true);attachments.push({'id':0,'name':filename,'filename':filename,'url':'','upload':true,'mimetype':'',});this.set('attachment_ids',attachments);}},on_attachment_loaded:function(event,result){var attachment_ids=[];if(result.error||!result.id){this.do_warn(result.error);attachment_ids=_.filter(this.get('attachment_ids'),function(val){return!val.upload;});}else{_.each(this.get('attachment_ids'),function(a){if(a.filename===result.filename&&a.upload){attachment_ids.push({'id':result.id,'name':result.name||result.filename,'filename':result.filename,'mimetype':result.mimetype,'url':session.url('/web/content',{'id':result.id,download:true}),});}else{attachment_ids.push(a);}});}
this.set('attachment_ids',attachment_ids);this.$attachment_button.prop('disabled',false);},on_attachment_delete:function(event){event.stopPropagation();var self=this;var attachment_id=$(event.target).data("id");if(attachment_id){var attachments=[];_.each(this.get('attachment_ids'),function(attachment){if(attachment_id!==attachment.id){attachments.push(attachment);}else{self.AttachmentDataSet.unlink([attachment_id]);}});this.set('attachment_ids',attachments);}},do_check_attachment_upload:function(){if(_.find(this.get('attachment_ids'),function(file){return file.upload;})){this.do_warn(_t("Uploading error"),_t("Please, wait while the file is uploading."));return false;}
return true;},render_attachments:function(){this.$attachments_list.html(QWeb.render('mail.ChatComposer.Attachments',{attachments:this.get('attachment_ids'),}));},mention_fetch_throttled:function(model,method,kwargs){var def=$.Deferred();clearTimeout(this.mention_fetch_timer);this.mention_fetch_timer=setTimeout(function(){return model.call(method,kwargs).then(function(results){def.resolve(results);});},200);return def;},mention_fetch_channels:function(search){return this.mention_fetch_throttled(this.ChannelModel,'get_mention_suggestions',{limit:this.options.mention_fetch_limit,search:search,}).then(function(suggestions){return _.partition(suggestions,function(suggestion){return _.contains(['public','groups'],suggestion.public);});});},mention_fetch_partners:function(search){var self=this;return $.when(this.mention_prefetched_partners).then(function(prefetched_partners){var suggestions=[];var limit=self.options.mention_fetch_limit;var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');_.each(prefetched_partners,function(partners){if(limit>0){var filtered_partners=_.filter(partners,function(partner){return partner.email&&search_regexp.test(partner.email)||partner.name&&search_regexp.test(utils.unaccent(partner.name));});if(filtered_partners.length){suggestions.push(filtered_partners.slice(0,limit));limit-=filtered_partners.length;}}});if(!suggestions.length&&!self.options.mention_partners_restricted){suggestions=self.mention_fetch_throttled(self.PartnerModel,'get_mention_suggestions',{limit:limit,search:search,});}
return suggestions;});},mention_get_canned_responses:function(search){var canned_responses=chat_manager.get_canned_responses();var matches=fuzzy.filter(utils.unaccent(search),_.pluck(canned_responses,'source'));var indexes=_.pluck(matches.slice(0,this.options.mention_fetch_limit),'index');return _.map(indexes,function(i){return canned_responses[i];});},mention_get_commands:function(search){var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search)),'i');return _.filter(this.mention_commands,function(command){return search_regexp.test(command.name);}).slice(0,this.options.mention_fetch_limit);},mention_set_prefetched_partners:function(prefetched_partners){this.mention_prefetched_partners=prefetched_partners;},mention_set_enabled_commands:function(commands){this.mention_commands=commands;},mention_get_listener_selections:function(){return this.mention_manager.get_listener_selections();},is_empty:function(){return!this.$input.val().trim()&&!this.$('.o_attachments').children().length;},focus:function(){this.$input.focus();},});var ExtendedComposer=BasicComposer.extend({init:function(parent,options){options=_.defaults(options||{},{input_min_height:120,});this._super(parent,options);this.extended=true;this.emoji_container_classname='o_extended_composer_emoji';},start:function(){this.$subject_input=this.$(".o_composer_subject input");return this._super.apply(this,arguments);},preprocess_message:function(){var self=this;return this._super().then(function(message){var subject=self.$subject_input.val();self.$subject_input.val("");message.subject=subject;return message;});},should_send:function(){return false;},focus:function(target){if(target==='body'){this.$input.focus();}else{this.$subject_input.focus();}},set_subject:function(subject){this.$('.o_composer_subject input').val(subject);},});return{BasicComposer:BasicComposer,ExtendedComposer:ExtendedComposer,};});;

/* /mail/static/src/js/chat_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.chat_manager',function(require){"use strict";var bus=require('bus.bus').bus;var utils=require('mail.utils');var config=require('web.config');var Bus=require('web.Bus');var core=require('web.core');var data=require('web.data');var Model=require('web.Model');var session=require('web.session');var time=require('web.time');var web_client=require('web.web_client');var _t=core._t;var _lt=core._lt;var LIMIT=25;var preview_msg_max_size=350;var ODOOBOT_ID="ODOOBOT";var MessageModel=new Model('mail.message',session.user_context);var ChannelModel=new Model('mail.channel',session.user_context);var UserModel=new Model('res.users',session.user_context);var PartnerModel=new Model('res.partner',session.user_context);var messages=[];var channels=[];var channels_preview_def;var channel_defs={};var chat_unread_counter=0;var unread_conversation_counter=0;var emojis=[];var emoji_substitutions={};var needaction_counter=0;var starred_counter=0;var mention_partner_suggestions=[];var canned_responses=[];var commands=[];var discuss_menu_id;var global_unread_counter=0;var pinned_dm_partners=[];var client_action_open=false;bus.on("window_focus",null,function(){global_unread_counter=0;web_client.set_title_part("_chat");});function notify_incoming_message(msg,options){if(bus.is_odoo_focused()&&options.is_displayed){return;}
var title=_t('New message');if(msg.author_id[1]){title=_.escape(msg.author_id[1]);}
var content=utils.parse_and_transform(msg.body,utils.strip_html).substr(0,preview_msg_max_size);if(!bus.is_odoo_focused()){global_unread_counter++;var tab_title=_.str.sprintf(_t("%d Messages"),global_unread_counter);web_client.set_title_part("_chat",tab_title);}
utils.send_notification(title,content);}
function add_message(data,options){options=options||{};var msg=_.findWhere(messages,{id:data.id});if(!msg){msg=chat_manager.make_message(data);messages.splice(_.sortedIndex(messages,msg,'id'),0,msg);_.each(msg.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){add_to_cache(msg,[]);if(options.domain&&options.domain!==[]){add_to_cache(msg,options.domain);}
if(channel.hidden){channel.hidden=false;chat_manager.bus.trigger('new_channel',channel);}
if(channel.type!=='static'&&!msg.is_author&&!msg.is_system_notification){if(options.increment_unread){update_channel_unread_counter(channel,channel.unread_counter+1);}
if(channel.is_chat&&options.show_notification){if(!client_action_open&&config.device.size_class!==config.device.SIZES.XS){chat_manager.bus.trigger('open_chat',channel,{passively:true});}
var query={is_displayed:false};chat_manager.bus.trigger('anyone_listening',channel,query);notify_incoming_message(msg,query);}}}});if(!options.silent){chat_manager.bus.trigger('new_message',msg);}}else if(options.domain&&options.domain!==[]){add_to_cache(msg,options.domain);}
return msg;}
function make_message(data){var msg={id:data.id,author_id:data.author_id,body:data.body||"",date:moment(time.str_to_datetime(data.date)),message_type:data.message_type,subtype_description:data.subtype_description,is_author:data.author_id&&data.author_id[0]===session.partner_id,is_note:data.is_note,is_system_notification:(data.message_type==='notification'&&data.model==='mail.channel')||data.info==='transient_message',attachment_ids:data.attachment_ids||[],subject:data.subject,email_from:data.email_from,customer_email_status:data.customer_email_status,customer_email_data:data.customer_email_data,record_name:data.record_name,tracking_value_ids:data.tracking_value_ids,channel_ids:data.channel_ids,model:data.model,res_id:data.res_id,url:session.url("/mail/view?message_id="+data.id),};_.each(_.keys(emoji_substitutions),function(key){var escaped_key=String(key).replace(/([.*+?=^!:${}()|[\]\/\\])/g,'\\$1');var regexp=new RegExp("(?:^|\\s|<[a-z]*>)("+escaped_key+")(?=\\s|$|</[a-z]*>)","g");msg.body=msg.body.replace(regexp,' <span class="o_mail_emoji">'+emoji_substitutions[key]+'</span> ');});function property_descr(channel){return{enumerable:true,get:function(){return _.contains(msg.channel_ids,channel);},set:function(bool){if(bool){add_channel_to_message(msg,channel);}else{msg.channel_ids=_.without(msg.channel_ids,channel);}}};}
Object.defineProperties(msg,{is_starred:property_descr("channel_starred"),is_needaction:property_descr("channel_inbox"),});if(_.contains(data.needaction_partner_ids,session.partner_id)){msg.is_needaction=true;}
if(_.contains(data.starred_partner_ids,session.partner_id)){msg.is_starred=true;}
if(msg.model==='mail.channel'){var real_channels=_.without(msg.channel_ids,'channel_inbox','channel_starred');var origin=real_channels.length===1?real_channels[0]:undefined;var channel=origin&&chat_manager.get_channel(origin);if(channel){msg.origin_id=origin;msg.origin_name=channel.name;}}
if((!msg.author_id||!msg.author_id[0])&&msg.email_from){msg.mailto=msg.email_from;}else{msg.displayed_author=(msg.author_id===ODOOBOT_ID)&&"OdooBot"||msg.author_id&&msg.author_id[1]||msg.email_from||_t('Anonymous');}
msg.author_redirect=!msg.is_author&&msg.author_id!==ODOOBOT_ID;if(msg.author_id===ODOOBOT_ID){msg.avatar_src="/mail/static/src/img/odoo_o.png";}else if(msg.author_id&&msg.author_id[0]){msg.avatar_src="/web/image/res.partner/"+msg.author_id[0]+"/image_small";}else if(msg.message_type==='email'){msg.avatar_src="/mail/static/src/img/email_icon.png";}else{msg.avatar_src="/mail/static/src/img/smiley/avatar.jpg";}
msg.body=utils.parse_and_transform(msg.body,utils.add_link);_.each(msg.attachment_ids,function(a){a.url='/web/content/'+a.id+'?download=true';});if(msg.tracking_value_ids&&msg.tracking_value_ids.length){_.each(msg.tracking_value_ids,function(f){if(f.field_type==='datetime'){var format='LLL';if(f.old_value){f.old_value=moment.utc(f.old_value).local().format(format);}
if(f.new_value){f.new_value=moment.utc(f.new_value).local().format(format);}}else if(f.field_type==='date'){var format='LL';if(f.old_value){f.old_value=moment(f.old_value).local().format(format);}
if(f.new_value){f.new_value=moment(f.new_value).local().format(format);}}});}
return msg;}
function add_channel_to_message(message,channel_id){message.channel_ids.push(channel_id);message.channel_ids=_.uniq(message.channel_ids);}
function add_channel(data,options){options=typeof options==="object"?options:{};var channel=chat_manager.get_channel(data.id);if(channel){if(channel.is_folded!==(data.state==="folded")){channel.is_folded=(data.state==="folded");chat_manager.bus.trigger("channel_toggle_fold",channel);}}else{channel=chat_manager.make_channel(data,options);channels.push(channel);channels=_.sortBy(channels,function(channel){return _.isString(channel.name)?channel.name.toLowerCase():''});if(!options.silent){chat_manager.bus.trigger("new_channel",channel);}
if(channel.is_detached){chat_manager.bus.trigger("open_chat",channel);}}
return channel;}
function make_channel(data,options){var channel={id:data.id,name:data.name,server_type:data.channel_type,type:data.type||data.channel_type,all_history_loaded:false,uuid:data.uuid,is_detached:data.is_minimized,is_folded:data.state==="folded",autoswitch:'autoswitch'in options?options.autoswitch:true,hidden:options.hidden,display_needactions:options.display_needactions,mass_mailing:data.mass_mailing,needaction_counter:data.message_needaction_counter||0,unread_counter:0,last_seen_message_id:data.seen_message_id,cache:{'[]':{all_history_loaded:false,loaded:false,messages:[],}},};if(channel.type==="channel"){channel.type=data.public!=="private"?"public":"private";}
if(_.size(data.direct_partner)>0){channel.type="dm";channel.name=data.direct_partner[0].name;channel.direct_partner_id=data.direct_partner[0].id;channel.status=data.direct_partner[0].im_status;pinned_dm_partners.push(channel.direct_partner_id);bus.update_option('bus_presence_partner_ids',pinned_dm_partners);}else if('anonymous_name'in data){channel.name=data.anonymous_name;}
if(data.last_message_date){channel.last_message_date=moment(time.str_to_datetime(data.last_message_date));}
channel.is_chat=!channel.type.match(/^(public|private|static)$/);if(data.message_unread_counter){update_channel_unread_counter(channel,data.message_unread_counter);}
return channel;}
function remove_channel(channel){if(!channel){return;}
if(channel.type==='dm'){var index=pinned_dm_partners.indexOf(channel.direct_partner_id);if(index>-1){pinned_dm_partners.splice(index,1);bus.update_option('bus_presence_partner_ids',pinned_dm_partners);}}
channels=_.without(channels,channel);delete channel_defs[channel.id];}
function get_channel_cache(channel,domain){var stringified_domain=JSON.stringify(domain||[]);if(!channel.cache[stringified_domain]){channel.cache[stringified_domain]={all_history_loaded:false,loaded:false,messages:[],};}
return channel.cache[stringified_domain];}
function invalidate_caches(channel_ids){_.each(channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.cache={'[]':channel.cache['[]']};}});}
function add_to_cache(message,domain){_.each(message.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){var channel_cache=get_channel_cache(channel,domain);var index=_.sortedIndex(channel_cache.messages,message,'id');if(channel_cache.messages[index]!==message){channel_cache.messages.splice(index,0,message);}}});}
function remove_message_from_channel(channel_id,message){message.channel_ids=_.without(message.channel_ids,channel_id);var channel=_.findWhere(channels,{id:channel_id});_.each(channel.cache,function(cache){cache.messages=_.without(cache.messages,message);});}
function fetch_from_channel(channel,options){options=options||{};var domain=(channel.id==="channel_inbox")?[['needaction','=',true]]:(channel.id==="channel_starred")?[['starred','=',true]]:[['channel_ids','in',channel.id]];var cache=get_channel_cache(channel,options.domain);if(options.domain){domain=new data.CompoundDomain(domain,options.domain||[]);}
if(options.load_more){var min_message_id=cache.messages[0].id;domain=new data.CompoundDomain([['id','<',min_message_id]],domain);}
return MessageModel.call('message_fetch',[domain],{limit:LIMIT,context:session.user_context}).then(function(msgs){if(!cache.all_history_loaded){cache.all_history_loaded=msgs.length<LIMIT;}
cache.loaded=true;_.each(msgs,function(msg){add_message(msg,{channel_id:channel.id,silent:true,domain:options.domain});});var channel_cache=get_channel_cache(channel,options.domain||[]);return channel_cache.messages;});}
function fetch_document_messages(ids,options){var loaded_msgs=_.filter(messages,function(message){return _.contains(ids,message.id);});var loaded_msg_ids=_.pluck(loaded_msgs,'id');options=options||{};if(options.force_fetch||_.difference(ids.slice(0,LIMIT),loaded_msg_ids).length){var ids_to_load=_.difference(ids,loaded_msg_ids).slice(0,LIMIT);return MessageModel.call('message_format',[ids_to_load],{context:session.user_context}).then(function(msgs){var processed_msgs=[];_.each(msgs,function(msg){processed_msgs.push(add_message(msg,{silent:true}));});return _.sortBy(loaded_msgs.concat(processed_msgs),function(msg){return msg.id;});});}else{return $.when(loaded_msgs);}}
function update_channel_unread_counter(channel,counter){if(channel.unread_counter>0&&counter===0){unread_conversation_counter=Math.max(0,unread_conversation_counter-1);}else if(channel.unread_counter===0&&counter>0){unread_conversation_counter++;}
if(channel.is_chat){chat_unread_counter=Math.max(0,chat_unread_counter-channel.unread_counter+counter);}
channel.unread_counter=counter;chat_manager.bus.trigger("update_channel_unread_counter",channel);}
var channel_seen=_.throttle(function(channel){return ChannelModel.call('channel_seen',[[channel.id]],{},{shadow:true});},3000);function on_notification(notifications){var unsubscribed_notif=_.find(notifications,function(notif){return notif[1].info==="unsubscribe";});if(unsubscribed_notif){notifications=_.reject(notifications,function(notif){return notif[0][1]==="mail.channel"&&notif[0][2]===unsubscribed_notif[1].id;});}
_.each(notifications,function(notification){var model=notification[0][1];if(model==='ir.needaction'){on_needaction_notification(notification[1]);}else if(model==='mail.channel'){on_channel_notification(notification[1]);}else if(model==='res.partner'){on_partner_notification(notification[1]);}else if(model==='bus.presence'){on_presence_notification(notification[1]);}});}
function on_needaction_notification(message){message=add_message(message,{channel_id:'channel_inbox',show_notification:true,increment_unread:true,});invalidate_caches(message.channel_ids);if(message.channel_ids.length!==0){needaction_counter++;}
_.each(message.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter++;}});chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_channel_notification(message){var def;var channel_already_in_cache=true;if(message.channel_ids.length===1){channel_already_in_cache=!!chat_manager.get_channel(message.channel_ids[0]);def=chat_manager.join_channel(message.channel_ids[0],{autoswitch:false});}else{def=$.when();}
def.then(function(){add_message(message,{show_notification:true,increment_unread:channel_already_in_cache});invalidate_caches(message.channel_ids);});}
function on_partner_notification(data){if(data.info==="unsubscribe"){var channel=chat_manager.get_channel(data.id);if(channel){var msg;if(_.contains(['public','private'],channel.type)){msg=_.str.sprintf(_t('You unsubscribed from <b>%s</b>.'),channel.name);}else{msg=_.str.sprintf(_t('You unpinned your conversation with <b>%s</b>.'),channel.name);}
remove_channel(channel);chat_manager.bus.trigger("unsubscribe_from_channel",data.id);web_client.do_notify(_("Unsubscribed"),msg);}}else if(data.type==='toggle_star'){on_toggle_star_notification(data);}else if(data.type==='mark_as_read'){on_mark_as_read_notification(data);}else if(data.type==='mark_as_unread'){on_mark_as_unread_notification(data);}else if(data.info==='channel_seen'){on_channel_seen_notification(data);}else if(data.info==='transient_message'){on_transient_message_notification(data);}else{on_chat_session_notification(data);}}
function on_toggle_star_notification(data){_.each(data.message_ids,function(msg_id){var message=_.findWhere(messages,{id:msg_id});if(message){invalidate_caches(message.channel_ids);message.is_starred=data.starred;if(!message.is_starred){remove_message_from_channel("channel_starred",message);starred_counter--;}else{add_to_cache(message,[]);var channel_starred=chat_manager.get_channel('channel_starred');channel_starred.cache=_.pick(channel_starred.cache,"[]");starred_counter++;}
chat_manager.bus.trigger('update_message',message);}});chat_manager.bus.trigger('update_starred',starred_counter);}
function on_mark_as_read_notification(data){_.each(data.message_ids,function(msg_id){var message=_.findWhere(messages,{id:msg_id});if(message){invalidate_caches(message.channel_ids);remove_message_from_channel("channel_inbox",message);chat_manager.bus.trigger('update_message',message);}});if(data.channel_ids){_.each(data.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter=Math.max(channel.needaction_counter-data.message_ids.length,0);}});}else{_.each(channels,function(channel){channel.needaction_counter=0;});}
needaction_counter=Math.max(needaction_counter-data.message_ids.length,0);chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_mark_as_unread_notification(data){_.each(data.message_ids,function(message_id){var message=_.findWhere(messages,{id:message_id});if(message){invalidate_caches(message.channel_ids);add_channel_to_message(message,'channel_inbox');add_to_cache(message,[]);}});var channel_inbox=chat_manager.get_channel('channel_inbox');channel_inbox.cache=_.pick(channel_inbox.cache,"[]");_.each(data.channel_ids,function(channel_id){var channel=chat_manager.get_channel(channel_id);if(channel){channel.needaction_counter+=data.message_ids.length;}});needaction_counter+=data.message_ids.length;chat_manager.bus.trigger('update_needaction',needaction_counter);}
function on_channel_seen_notification(data){var channel=chat_manager.get_channel(data.id);if(channel){channel.last_seen_message_id=data.last_message_id;if(channel.unread_counter){update_channel_unread_counter(channel,0);}}}
function on_chat_session_notification(chat_session){var channel;if((chat_session.channel_type==="channel")&&(chat_session.state==="open")){add_channel(chat_session,{autoswitch:false});if(!chat_session.is_minimized&&chat_session.info!=='creation'){web_client.do_notify(_t("Invitation"),_t("You have been invited to: ")+chat_session.name);}}
if((chat_session.state==="open")||(chat_session.state==="folded")){channel=chat_session.is_minimized&&chat_manager.get_channel(chat_session.id);if(channel){channel.is_detached=true;channel.is_folded=(chat_session.state==="folded");chat_manager.bus.trigger("open_chat",channel);}}else if(chat_session.state==="closed"){channel=chat_manager.get_channel(chat_session.id);if(channel){channel.is_detached=false;chat_manager.bus.trigger("close_chat",channel,{keep_open_if_unread:true});}}}
function on_presence_notification(data){var dm=chat_manager.get_dm_from_partner_id(data.id);if(dm){dm.status=data.im_status;chat_manager.bus.trigger('update_dm_presence',dm);}}
function on_transient_message_notification(data){var last_message=_.last(messages);data.id=(last_message?last_message.id:0)+0.01;data.author_id=data.author_id||ODOOBOT_ID;add_message(data);}
var chat_manager={make_message:make_message,make_channel:make_channel,post_message:function(data,options){options=options||{};var body=utils.parse_and_transform(_.str.trim(data.content),utils.add_link);var msg={partner_ids:data.partner_ids,body:body,attachment_ids:data.attachment_ids,};if('subject'in data){msg.subject=data.subject;}
if('channel_id'in options){return ChannelModel.call(data.command?'execute_command':'message_post',[options.channel_id],_.extend(msg,{message_type:'comment',content_subtype:'html',subtype:'mail.mt_comment',command:data.command,}));}
if('model'in options&&'res_id'in options){_.extend(msg,{content_subtype:data.content_subtype,context:data.context,message_type:data.message_type,subtype:data.subtype,subtype_id:data.subtype_id,});var model=new Model(options.model);return model.call('message_post',[options.res_id],msg).then(function(msg_id){return MessageModel.call('message_format',[msg_id]).then(function(msgs){msgs[0].model=options.model;msgs[0].res_id=options.res_id;add_message(msgs[0]);});});}},get_message:function(id){return _.findWhere(messages,{id:id});},get_messages:function(options){var channel;if('channel_id'in options&&options.load_more){channel=this.get_channel(options.channel_id);return fetch_from_channel(channel,{domain:options.domain||{},load_more:true});}
if('channel_id'in options){channel=this.get_channel(options.channel_id);var channel_cache=get_channel_cache(channel,options.domain);if(channel_cache.loaded){return $.when(channel_cache.messages);}else{return fetch_from_channel(channel,{domain:options.domain});}}
if('ids'in options){return fetch_document_messages(options.ids,options).then(function(result){chat_manager.mark_as_read(options.ids);return result;});}
if('model'in options&&'res_id'in options){var domain=[['model','=',options.model],['res_id','=',options.res_id]];MessageModel.call('message_fetch',[domain],{limit:30}).then(function(msgs){return _.map(msgs,add_message);});}},toggle_star_status:function(message_id){return MessageModel.call('toggle_message_starred',[[message_id]]);},unstar_all:function(){return MessageModel.call('unstar_all',[[]],{});},mark_as_read:function(message_ids){var ids=_.filter(message_ids,function(id){var message=_.findWhere(messages,{id:id});return!message||message.is_needaction;});if(ids.length){return MessageModel.call('set_message_done',[ids]);}else{return $.when();}},mark_all_as_read:function(channel,domain){if((channel.id==="channel_inbox"&&needaction_counter)||(channel&&channel.needaction_counter)){return MessageModel.call('mark_all_as_read',[],{channel_ids:channel.id!=="channel_inbox"?[channel.id]:[],domain:domain});}
return $.when();},undo_mark_as_read:function(message_ids,channel){return MessageModel.call('mark_as_unread',[message_ids,[channel.id]]);},mark_channel_as_seen:function(channel){if(channel.unread_counter>0&&channel.type!=='static'){update_channel_unread_counter(channel,0);channel_seen(channel);}},get_channels:function(){return _.clone(channels);},get_channel:function(id){return _.findWhere(channels,{id:id});},get_dm_from_partner_id:function(partner_id){return _.findWhere(channels,{direct_partner_id:partner_id});},all_history_loaded:function(channel,domain){return get_channel_cache(channel,domain).all_history_loaded;},get_mention_partner_suggestions:function(channel){if(!channel){return mention_partner_suggestions;}
if(!channel.members_deferred){channel.members_deferred=ChannelModel.call("channel_fetch_listeners",[channel.uuid],{},{shadow:true}).then(function(members){var suggestions=[];_.each(mention_partner_suggestions,function(partners){suggestions.push(_.filter(partners,function(partner){return!_.findWhere(members,{id:partner.id});}));});return[members];});}
return channel.members_deferred;},get_commands:function(channel){return _.filter(commands,function(command){return!command.channel_types||_.contains(command.channel_types,channel.server_type);});},get_canned_responses:function(){return canned_responses;},get_emojis:function(){return emojis;},get_needaction_counter:function(){return needaction_counter;},get_starred_counter:function(){return starred_counter;},get_chat_unread_counter:function(){return chat_unread_counter;},get_unread_conversation_counter:function(){return unread_conversation_counter;},get_last_seen_message:function(channel){if(channel.last_seen_message_id){var messages=channel.cache['[]'].messages;var msg=_.findWhere(messages,{id:channel.last_seen_message_id});if(msg){var i=_.sortedIndex(messages,msg,'id')+1;while(i<messages.length&&(messages[i].is_author||messages[i].is_system_notification)){msg=messages[i];i++;}
return msg;}}},get_discuss_menu_id:function(){return discuss_menu_id;},detach_channel:function(channel){return ChannelModel.call("channel_minimize",[channel.uuid,true],{},{shadow:true});},remove_chatter_messages:function(model){messages=_.reject(messages,function(message){return message.channel_ids.length===0&&message.model===model;});},bus:new Bus(),create_channel:function(name,type){var method=type==="dm"?"channel_get":"channel_create";var args=type==="dm"?[[name]]:[name,type];return ChannelModel.call(method,args).then(add_channel);},join_channel:function(channel_id,options){if(channel_id in channel_defs){return channel_defs[channel_id];}
var channel=this.get_channel(channel_id);if(channel){channel_defs[channel_id]=$.when(channel);}else{channel_defs[channel_id]=ChannelModel.call('channel_join_and_get_info',[[channel_id]]).then(function(result){return add_channel(result,options);});}
return channel_defs[channel_id];},open_and_detach_dm:function(partner_id){return ChannelModel.call('channel_get_and_minimize',[[partner_id]]).then(add_channel);},open_channel:function(channel){chat_manager.bus.trigger(client_action_open?'open_channel':'detach_channel',channel);},unsubscribe:function(channel){if(_.contains(['public','private'],channel.type)){return ChannelModel.call('action_unfollow',[[channel.id]]);}else{return ChannelModel.call('channel_pin',[channel.uuid,false]);}},close_chat_session:function(channel_id){var channel=this.get_channel(channel_id);ChannelModel.call("channel_fold",[],{uuid:channel.uuid,state:"closed"},{shadow:true});},fold_channel:function(channel_id,folded){var args={uuid:this.get_channel(channel_id).uuid,};if(_.isBoolean(folded)){args.state=folded?'folded':'open';}
return ChannelModel.call("channel_fold",[],args,{shadow:true});},redirect:function(res_model,res_id,dm_redirection_callback){var self=this;var redirect_to_document=function(res_model,res_id,view_id){web_client.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:res_model,views:[[view_id||false,'form']],res_id:res_id,});};if(res_model==="res.partner"){var domain=[["partner_id","=",res_id]];UserModel.call("search",[domain]).then(function(user_ids){if(user_ids.length&&user_ids[0]!==session.uid&&dm_redirection_callback){self.create_channel(res_id,'dm').then(dm_redirection_callback);}else{redirect_to_document(res_model,res_id);}});}else{new Model(res_model).call('get_formview_id',[[res_id],session.user_context]).then(function(view_id){redirect_to_document(res_model,res_id,view_id);});}},get_channels_preview:function(channels){var channels_preview=_.map(channels,function(channel){var info=_.pick(channel,'id','is_chat','name','status','unread_counter');info.last_message=_.last(channel.cache['[]'].messages);if(!info.is_chat){info.image_src='/web/image/mail.channel/'+channel.id+'/image_small';}else if(channel.direct_partner_id){info.image_src='/web/image/res.partner/'+channel.direct_partner_id+'/image_small';}else{info.image_src='/mail/static/src/img/smiley/avatar.jpg';}
return info;});var missing_channels=_.where(channels_preview,{last_message:undefined});if(!channels_preview_def){if(missing_channels.length){var missing_channel_ids=_.pluck(missing_channels,'id');channels_preview_def=ChannelModel.call('channel_fetch_preview',[missing_channel_ids],{},{shadow:true});}else{channels_preview_def=$.when();}}
return channels_preview_def.then(function(channels){_.each(missing_channels,function(channel_preview){var channel=_.findWhere(channels,{id:channel_preview.id});if(channel){channel_preview.last_message=add_message(channel.last_message);}});return _.filter(channels_preview,function(channel){return channel.last_message;});});},get_message_body_preview:function(message_body){return utils.parse_and_transform(message_body,utils.inline);},search_partner:function(search_val,limit){var def=$.Deferred();var values=[];var search_regexp=new RegExp(_.str.escapeRegExp(utils.unaccent(search_val)),'i');_.each(mention_partner_suggestions,function(partners){if(values.length<limit){values=values.concat(_.filter(partners,function(partner){return session.partner_id!==partner.id&&search_regexp.test(partner.name);})).splice(0,limit);}});if(!values.length){def=PartnerModel.call('im_search',[search_val,limit||20],{},{shadow:true});}else{def=$.when(values);}
return def.then(function(values){var autocomplete_data=_.map(values,function(value){return{id:value.id,value:value.name,label:value.name};});return _.sortBy(autocomplete_data,'label');});},};chat_manager.bus.on('client_action_open',null,function(open){client_action_open=open;});function init(){add_channel({id:"channel_inbox",name:_lt("Inbox"),type:"static",},{display_needactions:true});add_channel({id:"channel_starred",name:_lt("Starred"),type:"static"});bus.on('notification',null,on_notification);return session.is_bound.then(function(){return session.rpc('/mail/client_action');}).then(function(result){_.each(result.channel_slots,function(channels){_.each(channels,add_channel);});needaction_counter=result.needaction_inbox_counter;starred_counter=result.starred_counter;commands=_.map(result.commands,function(command){return _.extend({id:command.name},command);});mention_partner_suggestions=result.mention_partner_suggestions;discuss_menu_id=result.menu_id;_.each(result.shortcodes,function(s){if(s.shortcode_type==='text'){canned_responses.push(_.pick(s,['id','source','substitution']));}else{emojis.push(_.pick(s,['id','source','substitution','description']));emoji_substitutions[_.escape(s.source)]=s.substitution;}});bus.start_polling();});}
chat_manager.is_ready=init();return chat_manager;});;

/* /mail/static/src/js/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Chatter',function(require){"use strict";var chat_manager=require('mail.chat_manager');var composer=require('mail.composer');var ChatThread=require('mail.ChatThread');var utils=require('mail.utils');var config=require('web.config');var core=require('web.core');var form_common=require('web.form_common');var framework=require('web.framework');var pyeval=require('web.pyeval');var web_utils=require('web.utils');var _t=core._t;var QWeb=core.qweb;var ChatterComposer=composer.BasicComposer.extend({template:'mail.chatter.ChatComposer',init:function(parent,dataset,options){this._super(parent,options);this.thread_dataset=dataset;this.suggested_partners=[];this.options=_.defaults(this.options,{display_mode:'textarea',record_name:false,is_log:false,});if(this.options.is_log){this.options.send_text=_t('Log');}
this.events=_.extend(this.events,{'click .o_composer_button_full_composer':'on_open_full_composer',});},willStart:function(){if(this.options.is_log){return this._super.apply(this,arguments);}
return $.when(this._super.apply(this,arguments),this.message_get_suggested_recipients());},should_send:function(){return false;},preprocess_message:function(){var self=this;var def=$.Deferred();this._super().then(function(message){message=_.extend(message,{subtype:'mail.mt_comment',message_type:'comment',content_subtype:'html',context:self.context,});if(self.options.is_log){message.subtype='mail.mt_note';}
if(!self.options.is_log){var checked_suggested_partners=self.get_checked_suggested_partners();self.check_suggested_partners(checked_suggested_partners).done(function(partner_ids){message.partner_ids=(message.partner_ids||[]).concat(partner_ids);message.context=_.defaults({},message.context,{mail_post_autofollow:true,});def.resolve(message);});}else{def.resolve(message);}});return def;},prevent_send:function(event){return!event.shiftKey;},message_get_suggested_recipients:function(){var self=this;var email_addresses=_.pluck(this.suggested_partners,'email_address');return this.thread_dataset.call('message_get_suggested_recipients',[[this.context.default_res_id],this.context]).done(function(suggested_recipients){var thread_recipients=suggested_recipients[self.context.default_res_id];_.each(thread_recipients,function(recipient){var parsed_email=utils.parse_email(recipient[1]);if(_.indexOf(email_addresses,parsed_email[1])===-1){self.suggested_partners.push({checked:true,partner_id:recipient[0],full_name:recipient[1],name:parsed_email[0],email_address:parsed_email[1],reason:recipient[2],});}});});},get_checked_suggested_partners:function(){var self=this;var checked_partners=[];this.$('.o_composer_suggested_partners input:checked').each(function(){var full_name=$(this).data('fullname');checked_partners=checked_partners.concat(_.filter(self.suggested_partners,function(item){return full_name===item.full_name;}));});return checked_partners;},check_suggested_partners:function(checked_suggested_partners){var self=this;var check_done=$.Deferred();var recipients=_.filter(checked_suggested_partners,function(recipient){return recipient.checked;});var recipients_to_find=_.filter(recipients,function(recipient){return(!recipient.partner_id);});var names_to_find=_.pluck(recipients_to_find,'full_name');var recipients_to_check=_.filter(recipients,function(recipient){return(recipient.partner_id&&!recipient.email_address);});var recipient_ids=_.pluck(_.filter(recipients,function(recipient){return recipient.partner_id&&recipient.email_address;}),'partner_id');var names_to_remove=[];var recipient_ids_to_remove=[];var find_done=$.Deferred();if(names_to_find.length>0){find_done=self.thread_dataset.call('message_partner_info_from_emails',[[this.context.default_res_id],names_to_find]);}else{find_done.resolve([]);}
$.when(find_done).pipe(function(result){var emails_deferred=[];var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){var deferred=$.Deferred();emails_deferred.push(deferred);var partner_name=partner_info.full_name;var partner_id=partner_info.partner_id;var parsed_email=utils.parse_email(partner_name);var dialog=new form_common.FormViewDialog(self,{res_model:'res.partner',res_id:partner_id,context:{force_email:true,ref:"compound_context",default_name:parsed_email[0],default_email:parsed_email[1],},title:_t("Please complete partner's informations"),disable_multiple_selection:true,}).open();dialog.on('closed',self,function(){deferred.resolve();});dialog.opened().then(function(){dialog.view_form.on('on_button_cancel',self,function(){names_to_remove.push(partner_name);if(partner_id){recipient_ids_to_remove.push(partner_id);}});});});$.when.apply($,emails_deferred).then(function(){var new_names_to_find=_.difference(names_to_find,names_to_remove);find_done=$.Deferred();if(new_names_to_find.length>0){find_done=self.thread_dataset.call('message_partner_info_from_emails',[[self.context.default_res_id],new_names_to_find,true]);}else{find_done.resolve([]);}
$.when(find_done).pipe(function(result){var recipient_popups=result.concat(recipients_to_check);_.each(recipient_popups,function(partner_info){if(partner_info.partner_id&&_.indexOf(partner_info.partner_id,recipient_ids_to_remove)===-1){recipient_ids.push(partner_info.partner_id);}});}).pipe(function(){check_done.resolve(recipient_ids);});});});return check_done;},on_open_full_composer:function(){if(!this.do_check_attachment_upload()){return false;}
var self=this;var recipient_done=$.Deferred();if(this.options.is_log){recipient_done.resolve([]);}else{var checked_suggested_partners=this.get_checked_suggested_partners();recipient_done=this.check_suggested_partners(checked_suggested_partners);}
recipient_done.then(function(partner_ids){var context={default_parent_id:self.id,default_body:utils.get_text2html(self.$input.val()),default_attachment_ids:_.pluck(self.get('attachment_ids'),'id'),default_partner_ids:partner_ids,default_is_log:self.options.is_log,mail_post_autofollow:true,};if(self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
self.do_action({type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:context,},{on_close:function(){self.trigger('need_refresh');var parent=self.getParent();chat_manager.get_messages({model:parent.model,res_id:parent.res_id});},}).then(self.trigger.bind(self,'close_composer'));});}});var Chatter=form_common.AbstractField.extend({template:'mail.Chatter',events:{"click .o_chatter_button_new_message":"on_open_composer_new_message","click .o_chatter_button_log_note":"on_open_composer_log_note",},init:function(){this._super.apply(this,arguments);this.model=this.view.dataset.model;this.res_id=undefined;this.context=this.options.context||{};this.dp=new web_utils.DropPrevious();},willStart:function(){return chat_manager.is_ready;},start:function(){var self=this;this.view.on("change:actual_mode",this,this.check_visibility);this.check_visibility();var $container=this.$el.parent();if($container.hasClass('oe_chatter')){this.$el.addClass($container.attr("class")).unwrap();}
this.followers=this.field_manager.fields.message_follower_ids;if(this.followers){this.$('.o_chatter_topbar').append(this.followers.$el);this.followers.on('redirect',chat_manager,chat_manager.redirect);this.followers.on('followers_update',this,this.on_followers_update);}
this.thread=new ChatThread(this,{display_order:ChatThread.ORDER.DESC,display_document_link:false,display_needactions:false,squash_close_messages:false,});this.thread.on('load_more_messages',this,this.load_more_messages);this.thread.on('toggle_star_status',this,function(message_id){chat_manager.toggle_star_status(message_id);});this.thread.on('redirect',chat_manager,chat_manager.redirect);this.thread.on('redirect_to_channel',this,this.on_channel_redirect);this.ready=$.Deferred();var def1=this._super.apply(this,arguments);var def2=this.thread.appendTo(this.$el);return $.when(def1,def2).then(function(){chat_manager.bus.on('new_message',self,self.on_new_message);chat_manager.bus.on('update_message',self,self.on_update_message);self.ready.resolve();});},check_visibility:function(){this.set({"force_invisible":this.view.get("actual_mode")==="create"});},fetch_and_render_thread:function(ids,options){var self=this;options=options||{};options.ids=ids;var fetch_def=this.dp.add(chat_manager.get_messages(options));this.thread.$el.empty();web_utils.reject_after(web_utils.delay(1000),fetch_def).then(function(){self.thread.$el.append(QWeb.render('Spinner'));});return fetch_def.then(function(raw_messages){self.thread.render(raw_messages,{display_load_more:raw_messages.length<ids.length});});},on_post_message:function(message){var self=this;var options={model:this.model,res_id:this.res_id};chat_manager.post_message(message,options).then(function(){self.close_composer();if(message.partner_ids.length){self.refresh_followers();}}).fail(function(){});},on_new_message:function(message){if(message.model===this.model&&message.res_id===this.res_id){this.msg_ids.unshift(message.id);this.fetch_and_render_thread(this.msg_ids);}},on_update_message:function(message){if(message.model===this.model&&message.res_id===this.res_id){this.fetch_and_render_thread(this.msg_ids);}},on_channel_redirect:function(channel_id){var self=this;var def=chat_manager.join_channel(channel_id);$.when(def).then(function(){self.do_action('mail.mail_channel_action_client_chat',{active_id:channel_id});});},on_followers_update:function(followers){this.mention_suggestions=[];var self=this;var prefetched_partners=chat_manager.get_mention_partner_suggestions();var follower_suggestions=[];_.each(followers,function(follower){if(follower.res_model==='res.partner'){follower_suggestions.push({id:follower.res_id,name:follower.name,email:follower.email,});}});if(follower_suggestions.length){this.mention_suggestions.push(follower_suggestions);}
_.each(prefetched_partners,function(partners){self.mention_suggestions.push(_.filter(partners,function(partner){return!_.findWhere(follower_suggestions,{id:partner.id});}));});},load_more_messages:function(){var self=this;var top_msg_id=this.$('.o_thread_message').first().data('messageId');var top_msg_selector='.o_thread_message[data-message-id="'+top_msg_id+'"]';var offset=-framework.getPosition(document.querySelector(top_msg_selector)).top;this.fetch_and_render_thread(this.msg_ids,{force_fetch:true}).then(function(){offset+=framework.getPosition(document.querySelector(top_msg_selector)).top;self.thread.scroll_to({offset:offset});});},render_value:function(){return this.ready.then(this._render_value.bind(this));},_render_value:function(){var context=_.extend(this.options.context||{},pyeval.eval('contexts',this.build_context()));this.context=_.extend({default_res_id:parseInt(this.view.datarecord.id,10)||false,default_model:this.view.model||false,},context);this.thread_dataset=this.view.dataset;this.res_id=this.context.default_res_id;this.record_name=this.view.datarecord.display_name;this.msg_ids=this.get_value()||[];if(this.composer){this.composer.destroy();this.composer=undefined;this.mute_new_message_button(false);}
return this.fetch_and_render_thread(this.msg_ids);},refresh_followers:function(){if(this.followers){this.followers.read_value();}},on_open_composer_new_message:function(){this.open_composer();},on_open_composer_log_note:function(){this.open_composer({is_log:true});},open_composer:function(options){var self=this;var old_composer=this.composer;this.composer=new ChatterComposer(this,this.thread_dataset,{commands_enabled:false,context:this.context,input_min_height:50,input_max_height:Number.MAX_VALUE,input_baseline:14,is_log:options&&options.is_log,record_name:this.record_name,default_body:old_composer&&old_composer.$input&&old_composer.$input.val(),default_mention_selections:old_composer&&old_composer.mention_get_listener_selections(),});this.composer.on('input_focused',this,function(){this.composer.mention_set_prefetched_partners(this.mention_suggestions||[]);});this.composer.insertBefore(this.$('.o_mail_thread')).then(function(){if(old_composer){old_composer.destroy();}
if(!config.device.touch){self.composer.focus();}
self.composer.on('post_message',self,self.on_post_message);self.composer.on('need_refresh',self,self.refresh_followers);self.composer.on('close_composer',null,self.close_composer.bind(self,true));});this.mute_new_message_button(true);},close_composer:function(force){if(this.composer&&(this.composer.is_empty()||force)){this.composer.do_hide();this.composer.$input.val('');this.mute_new_message_button(false);}},mute_new_message_button:function(mute){if(mute){this.$('.o_chatter_button_new_message').removeClass('btn-primary').addClass('btn-default');}else if(!mute){this.$('.o_chatter_button_new_message').removeClass('btn-default').addClass('btn-primary');}},destroy:function(){chat_manager.remove_chatter_messages(this.model);this._super.apply(this,arguments);},});core.form_widget_registry.add('mail_thread',Chatter);return Chatter;});;

/* /mail/static/src/js/followers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Followers',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var session=require('web.session');var _t=core._t;var qweb=core.qweb;var Followers=form_common.AbstractField.extend({template:'mail.Followers',init:function(){this._super.apply(this,arguments);this.image=this.node.attrs.image||'image_small';this.comment=this.node.attrs.help||false;this.ds_model=new data.DataSetSearch(this,this.view.model);this.value=[];this.followers=[];this.followers_fetched=$.Deferred();this.data_subtype={};this.view_is_editable=this.__parentedParent.is_action_enabled('edit');},start:function(){this.view.on("change:actual_mode",this,this.on_check_visibility_mode);this.on_check_visibility_mode();this.reinit();this.bind_events();return this._super();},on_check_visibility_mode:function(){this.set({"force_invisible":this.view.get("actual_mode")==="create"});},set_value:function(_value){this.value=_value;this._super(_value);},reinit:function(){this.data_subtype={};this.message_is_follower=undefined;this.display_buttons();},bind_events:function(){var self=this;this.$el.on('click','.o_followers_follow_button',function(){if($(this).hasClass('o_followers_notfollow')){self.do_follow();}else{self.do_unfollow({user_ids:[session.uid]});}});this.$el.on('click','.o_subtypes_list input',function(event){event.stopPropagation();self.do_update_subscription(event);var $list=self.$('.o_subtypes_list');if(!$list.hasClass('open')){$list.addClass('open');}
if(self.$('.o_subtypes_list ul')[0].children.length<1){$list.removeClass('open');}});this.$el.on('click','.o_add_follower',function(event){event.preventDefault();self.on_invite_follower(false);});this.$el.on('click','.o_add_follower_channel',function(event){event.preventDefault();self.on_invite_follower(true);});this.$el.on('click','.o_edit_subtype',self.on_edit_subtype);this.$el.on('click','.o_remove_follower',self.on_remove_follower);this.$el.on('click','.o_mail_redirect',self.on_click_redirect);},on_edit_subtype:function(event){var self=this;var $currentTarget=$(event.currentTarget);var follower_id=$currentTarget.data('follower-id');var res_id=$currentTarget.data('oe-id');var is_channel=$currentTarget.data('oe-model')==='mail.channel';self.dialog=new Dialog(this,{size:'medium',title:_t('Edit Subscription of ')+$currentTarget.siblings('a').text(),buttons:[{text:_t("Apply"),classes:'btn-primary',click:function(){self.do_update_subscription(event,res_id,is_channel);},close:true},{text:_t("Cancel"),close:true,},],}).open();return self.fetch_subtypes(follower_id).then(function(data){self.display_subtypes(data,true,is_channel);});},on_invite_follower:function(channel_only){var self=this;var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',view_type:'form',views:[[false,'form']],name:_t('Invite Follower'),target:'new',context:{'default_res_model':this.view.dataset.model,'default_res_id':this.view.datarecord.id,'mail_invite_follower_channel_only':channel_only,},};this.do_action(action,{on_close:function(){self.read_value();},});},on_remove_follower:function(event){var res_model=$(event.target).parent().find('a').data('oe-model');var res_id=$(event.target).parent().find('a').data('oe-id');if(res_model==='res.partner'){return this.do_unfollow({partner_ids:[res_id]});}else{return this.do_unfollow({channel_ids:[res_id]});}},on_click_redirect:function(event){event.preventDefault();var res_id=$(event.target).data('oe-id');var res_model=$(event.target).data('oe-model');this.trigger('redirect',res_model,res_id);},read_value:function(){var self=this;return this.ds_model.read_ids([this.view.datarecord.id],['message_follower_ids']).then(function(results){self.value=results[0].message_follower_ids;self.render_value();});},render_value:function(){var self=this;this.reinit();this.value=this.value||[];return this.fetch_followers().then(function(results){self.display_followers(results.followers);if(results.subtypes){self.display_subtypes(results.subtypes);}
self.display_buttons();}).fail(this.display_generic.bind(this));},fetch_followers:function(){return ajax.jsonRpc('/mail/read_followers','call',{follower_ids:this.value,res_model:this.view.model,});},fetch_subtypes:function(follower_id){return ajax.jsonRpc('/mail/read_subscription_data','call',{res_model:this.view.model,follower_id:follower_id,});},_format_followers:function(count){var str='';if(count<=0){str=_t('No follower');}else if(count===1){str=_t('One follower');}else{str=''+count+' '+_t('followers');}
return str;},display_generic:function(){this.$('.o_followers_actions').hide();this.$('.o_followers_list').hide();this.$('.o_followers_title_box > button').prop('disabled',true);this.$('.o_followers_count').html(this.value.length).parent().attr("title",this._format_followers(this.value.length));},display_followers:function(records){var self=this;this.followers=records||this.followers;this.trigger('followers_update',this.followers);var $followers_list=this.$('.o_followers_list').empty();this.$('.o_followers_count').html(this.value.length).parent().attr("title",this._format_followers(this.value.length));var user_follower=_.filter(this.followers,function(rec){return rec.is_uid;});this.message_is_follower=user_follower.length>=1;this.follower_id=this.message_is_follower?user_follower[0].id:undefined;$(qweb.render('mail.Followers.add_more',{'widget':self})).appendTo($followers_list);var $follower_li;_(this.followers).each(function(record){$follower_li=$(qweb.render('mail.Followers.partner',{'record':_.extend(record,{'avatar_url':'/web/image/'+record.res_model+'/'+record.res_id+'/image_small'}),'widget':self}));$follower_li.appendTo($followers_list);if(record.is_editable){$follower_li.on('mouseenter mouseleave',function(e){$(e.currentTarget).find('.o_edit_subtype').toggleClass('hide',e.type==='mouseleave');});}});},display_buttons:function(){if(this.message_is_follower){this.$('button.o_followers_follow_button').removeClass('o_followers_notfollow').addClass('o_followers_following');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.$('.o_followers_actions .dropdown-toggle').addClass('o_followers_following')}else{this.$('button.o_followers_follow_button').removeClass('o_followers_following').addClass('o_followers_notfollow');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);this.$('.o_followers_actions .dropdown-toggle').removeClass('o_followers_following')}},display_subtypes:function(data,dialog,display_warning){var old_parent_model;var $list;if(dialog){$list=$('<ul>').appendTo(this.dialog.$el);}else{$list=this.$('.o_subtypes_list ul');}
$list.empty();this.data_subtype=data;_.each(data,function(record){if(old_parent_model!==record.parent_model&&old_parent_model!==undefined){$list.append($('<li>').addClass('divider'));}
old_parent_model=record.parent_model;record.followed=record.followed||undefined;$(qweb.render('mail.Followers.subtype',{'record':record,'dialog':dialog,'display_warning':display_warning&&record.internal})).appendTo($list);});if(display_warning){$(qweb.render('mail.Followers.subtypes.warning')).appendTo(this.dialog.$el);}},do_follow:function(){var context=new data.CompoundContext(this.build_context(),{});this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.ds_model.call('message_subscribe_users',[[this.view.datarecord.id],[session.uid],undefined,context]).then(this.proxy('read_value'));_.each(this.$('.o_subtypes_list input'),function(record){$(record).attr('checked','checked');});},do_unfollow:function(ids){if(confirm(_t("Warning! \n If you remove a follower, he won't be notified of any email or discussion on this document. Do you really want to remove this follower ?"))){_(this.$('.o_subtype_checkbox')).each(function(record){$(record).attr('checked',false);});this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);var context=new data.CompoundContext(this.build_context(),{});if(ids.partner_ids||ids.channel_ids){return this.ds_model.call('message_unsubscribe',[[this.view.datarecord.id],ids.partner_ids,ids.channel_ids,context]).then(this.proxy('read_value'));}else{return this.ds_model.call('message_unsubscribe_users',[[this.view.datarecord.id],ids.user_ids,context]).then(this.proxy('read_value'));}}
return false;},do_update_subscription:function(event,follower_id,is_channel){var self=this;var kwargs={};var ids={};var action_subscribe;var subtypes;this.data_subtype={};if(follower_id!==undefined){action_subscribe='message_subscribe';subtypes=this.dialog.$('input[type="checkbox"]');if(is_channel){ids.channel_ids=[follower_id];}else{ids.partner_ids=[follower_id];}}else{action_subscribe='message_subscribe_users';subtypes=this.$('.o_followers_actions input[type="checkbox"]');ids.user_ids=[session.uid];}
kwargs=_.extend(kwargs,ids);var checklist=[];_(subtypes).each(function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});kwargs.subtype_ids=checklist;if(!checklist.length){if(!this.do_unfollow(ids)){$(event.target).prop("checked",true);}else{self.$('.o_subtypes_list ul').empty();}}else{kwargs.context=new data.CompoundContext(this.build_context(),{});return this.ds_model._model.call(action_subscribe,[[this.view.datarecord.id]],kwargs).then(this.proxy('read_value'));}},});core.form_widget_registry.add('mail_followers',Followers);});;

/* /mail/static/src/js/thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ChatThread',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ORDER={ASC:1,DESC:-1,};var read_more=_t('read more');var read_less=_t('read less');function time_from_now(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
var Thread=Widget.extend({className:'o_mail_thread',events:{"click a":"on_click_redirect","click img":"on_click_redirect","click strong":"on_click_redirect","click .o_thread_show_more":"on_click_show_more","click .o_thread_message_needaction":function(event){var message_id=$(event.currentTarget).data('message-id');this.trigger("mark_as_read",message_id);},"click .o_thread_message_star":function(event){var message_id=$(event.currentTarget).data('message-id');this.trigger("toggle_star_status",message_id);},"click .o_thread_message_reply":function(event){this.selected_id=$(event.currentTarget).data('message-id');this.$('.o_thread_message').removeClass('o_thread_selected_message');this.$('.o_thread_message[data-message-id="'+this.selected_id+'"]').addClass('o_thread_selected_message');this.trigger('select_message',this.selected_id);event.stopPropagation();},"click .oe_mail_expand":function(event){event.preventDefault();var $message=$(event.currentTarget).parents('.o_thread_message');$message.addClass('o_message_expanded');this.expanded_msg_ids.push($message.data('message-id'));},"click .o_thread_message":function(event){$(event.currentTarget).toggleClass('o_thread_selected_message');},"click":function(){if(this.selected_id){this.unselect();this.trigger('unselect_message');}},},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{display_order:ORDER.ASC,display_needactions:true,display_stars:true,display_document_link:true,display_avatar:true,squash_close_messages:true,display_email_icon:true,display_reply_icon:false,});this.expanded_msg_ids=[];this.selected_id=null;},render:function(messages,options){var self=this;var msgs=_.map(messages,this._preprocess_message.bind(this));if(this.options.display_order===ORDER.DESC){msgs.reverse();}
options=_.extend({},this.options,options);var prev_msg;_.each(msgs,function(msg){if(!prev_msg||(Math.abs(msg.date.diff(prev_msg.date))>60000)||prev_msg.message_type!=='comment'||msg.message_type!=='comment'||(prev_msg.author_id[0]!==msg.author_id[0])||prev_msg.model!==msg.model||prev_msg.res_id!==msg.res_id){msg.display_author=true;}else{msg.display_author=!options.squash_close_messages;}
prev_msg=msg;});this.$el.html(QWeb.render('mail.ChatThread',{messages:msgs,options:options,ORDER:ORDER,}));_.each(msgs,function(msg){var $msg=self.$('.o_thread_message[data-message-id="'+msg.id+'"]');$msg.find('.o_mail_timestamp').data('date',msg.date);self.insert_read_more($msg);});if(!this.update_timestamps_interval){this.update_timestamps_interval=setInterval(function(){self.update_timestamps();},1000*60);}},insert_read_more:function($element){var self=this;var groups=[];var read_more_nodes;var $children=$element.contents().filter(function(){return this.nodeType===1||this.nodeType===3&&this.nodeValue.trim();});_.each($children,function(child){var $child=$(child);if(child.nodeType===3&&$child.prevAll("[id*='stopSpelling']").length>0){var $child=$('<span>',{text:child.textContent,"data-o-mail-quote":"1",});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev("[data-o-mail-quote='1']").length>0)){if(!read_more_nodes){read_more_nodes=[];groups.push(read_more_nodes);}
$child.hide();read_more_nodes.push($child);}else{read_more_nodes=undefined;self.insert_read_more($child);}});_.each(groups,function(group){var $read_more=$('<a>',{class:"o_mail_read_more",href:"#",text:read_more,}).insertBefore(group[0]);var is_read_more=true;$read_more.click(function(e){e.preventDefault();is_read_more=!is_read_more;_.each(group,function($child){$child.hide();$child.toggle(!is_read_more);});$read_more.text(is_read_more?read_more:read_less);});});},update_timestamps:function(){this.$('.o_mail_timestamp').each(function(){var date=$(this).data('date');$(this).html(time_from_now(date));});},on_click_redirect:function(event){if($(event.target).data('oe-field')!==undefined){return;}
var id=$(event.target).data('oe-id');if(id){event.preventDefault();var model=$(event.target).data('oe-model');var options=model&&(model!=='mail.channel')?{model:model,id:id}:{channel_id:id};this._redirect(options);}},_redirect:_.debounce(function(options){if('channel_id'in options){this.trigger('redirect_to_channel',options.channel_id);}else{this.trigger('redirect',options.model,options.id);}},200,true),on_click_show_more:function(){this.trigger('load_more_messages');},_preprocess_message:function(message){var msg=_.extend({},message);msg.date=moment.min(msg.date,moment());msg.hour=time_from_now(msg.date);var date=msg.date.format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){msg.day=_t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){msg.day=_t("Yesterday");}else{msg.day=msg.date.format('LL');}
if(_.contains(this.expanded_msg_ids,message.id)){msg.expanded=true;}
msg.display_subject=message.subject&&message.message_type!=='notification'&&!(message.model&&(message.model!=='mail.channel'));msg.is_selected=msg.id===this.selected_id;return msg;},remove_message_and_render:function(message_id,messages,options){var self=this;var done=$.Deferred();this.$('.o_thread_message[data-message-id="'+message_id+'"]').fadeOut({done:function(){self.render(messages,options);done.resolve();},duration:200,});return done;},scroll_to:function(options){options=options||{};if(options.id!==undefined){var $target=this.$('.o_thread_message[data-message-id="'+options.id+'"]');if(options.only_if_necessary){var delta=$target.parent().height()-$target.height();var offset=delta<0?0:delta-($target.offset().top-$target.offsetParent().offset().top);offset=-Math.min(offset,0);this.$el.scrollTo("+="+offset+"px",options);}else if($target.length){this.$el.scrollTo($target);}}else if(options.offset!==undefined){this.$el.scrollTop(options.offset);}else{this.$el.scrollTop(this.el.scrollHeight);}},get_scrolltop:function(){return this.$el.scrollTop();},is_at_bottom:function(){return this.el.scrollHeight-this.$el.scrollTop()-this.$el.outerHeight()<5;},unselect:function(){this.$('.o_thread_message').removeClass('o_thread_selected_message');this.selected_id=null;},destroy:function(){clearInterval(this.update_timestamps_interval);},});Thread.ORDER=ORDER;return Thread;});;

/* /mail/static/src/js/systray.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray',function(require){"use strict";var core=require('web.core');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var chat_manager=require('mail.chat_manager');var QWeb=core.qweb;var InboxItem=Widget.extend({template:'mail.chat.InboxItem',events:{"click":"on_click",},start:function(){this.$needaction_counter=this.$('.o_notification_counter');chat_manager.bus.on("update_needaction",this,this.update_counter);chat_manager.is_ready.then(this.update_counter.bind(this));return this._super();},update_counter:function(){var counter=chat_manager.get_needaction_counter();this.$needaction_counter.text(counter);this.$el.toggleClass('o_no_notification',!counter);},on_click:function(event){event.preventDefault();chat_manager.is_ready.then(this.discuss_redirect.bind(this));},discuss_redirect:_.debounce(function(){var self=this;this.do_action('mail.mail_channel_action_client_chat',{clear_breadcrumbs:true}).then(function(){self.trigger_up('hide_app_switcher');core.bus.trigger('change_menu_section',chat_manager.get_discuss_menu_id());});},1000,true),});var MessagingMenu=Widget.extend({template:'mail.chat.MessagingMenu',events:{"click":"on_click","click .o_filter_button":"on_click_filter_button","click .o_new_message":"on_click_new_message","click .o_mail_channel_preview":"on_click_channel",},start:function(){this.$filter_buttons=this.$('.o_filter_button');this.$channels_preview=this.$('.o_mail_navbar_dropdown_channels');this.filter=false;chat_manager.bus.on("update_channel_unread_counter",this,this.update_counter);chat_manager.is_ready.then(this.update_counter.bind(this));return this._super();},is_open:function(){return this.$el.hasClass('open');},update_counter:function(){var counter=chat_manager.get_unread_conversation_counter();this.$('.o_notification_counter').text(counter);this.$el.toggleClass('o_no_notification',!counter);this.$el.toggleClass('o_unread_chat',!!chat_manager.get_chat_unread_counter());if(this.is_open()){this.update_channels_preview();}},update_channels_preview:function(){var self=this;this.$channels_preview.html(QWeb.render('Spinner'));chat_manager.is_ready.then(function(){var channels=_.filter(chat_manager.get_channels(),function(channel){if(self.filter==='chat'){return channel.is_chat;}else if(self.filter==='channels'){return!channel.is_chat&&channel.type!=='static';}else{return channel.type!=='static';}});chat_manager.get_channels_preview(channels).then(self._render_channels_preview.bind(self));});},_render_channels_preview:function(channels_preview){channels_preview.sort(function(c1,c2){return Math.min(1,c2.unread_counter)-Math.min(1,c1.unread_counter)||c2.is_chat-c1.is_chat||c2.last_message.date.diff(c1.last_message.date);});_.each(channels_preview,function(channel){channel.last_message_preview=chat_manager.get_message_body_preview(channel.last_message.body);if(channel.last_message.date.isSame(new Date(),'d')){channel.last_message_date=channel.last_message.date.format('LT');}else{channel.last_message_date=channel.last_message.date.format('lll');}});this.$channels_preview.html(QWeb.render('mail.chat.ChannelsPreview',{channels:channels_preview,}));},on_click:function(){if(!this.is_open()){this.update_channels_preview();}},on_click_filter_button:function(event){event.stopPropagation();this.$filter_buttons.removeClass('o_selected');var $target=$(event.currentTarget);$target.addClass('o_selected');this.filter=$target.data('filter');this.update_channels_preview();},on_click_new_message:function(){chat_manager.bus.trigger('open_chat');},on_click_channel:function(event){var channel_id=$(event.currentTarget).data('channel_id');var channel=chat_manager.get_channel(channel_id);if(channel){chat_manager.open_channel(channel);}},});SystrayMenu.Items.push(MessagingMenu);SystrayMenu.Items.push(InboxItem);});;

/* /mail/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('mail.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('mail_tour',[{trigger:'.o_mail_chat .o_mail_chat_sidebar .o_add[data-type="public"]',content:_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>"),position:'bottom',},{trigger:'.o_mail_chat .o_composer_text_field',content:_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>\'@\'</i> or link another channel with <i>\'#\'</i>. Start your message with <i>\'/\'</i> to get the list of possible commands.</p>"),position:"top",width:350,},{trigger:".o_mail_chat .o_mail_thread .o_thread_message_star",content:_t("Messages can be <b>starred</b> to remind you to check back later."),position:"right",},{trigger:'.o_mail_chat .o_mail_chat_channel_item[data-channel-id="channel_starred"]',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_mail_chat .o_mail_chat_sidebar .o_add[data-type="dm"]',content:_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>"),position:'bottom',}]);});;

/* /mail/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('mail.utils',function(require){"use strict";var bus=require('bus.bus').bus;var session=require('web.session');var web_client=require('web.web_client');function send_notification(title,content){if(window.Notification&&Notification.permission==="granted"){if(bus.is_master){_send_native_notification(title,content);}}else{web_client.do_notify(title,content);if(bus.is_master){_beep();}}}
function _send_native_notification(title,content){var notification=new Notification(title,{body:content,icon:"/mail/static/src/img/odoo_o.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}};}
var _beep=(function(){if(typeof(Audio)==="undefined"){return function(){};}
var audio;return function(){if(!audio){audio=new Audio();var ext=audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";audio.src=session.url("/mail/static/src/audio/ting"+ext);}
audio.play();};})();function parse_and_transform(html_string,transform_function){var open_token="OPEN"+Date.now();var string=html_string.replace(/&lt;/g,open_token);var children=$('<div>').html(string).contents();return _parse_and_transform(children,transform_function).replace(new RegExp(open_token,"g"),"&lt;");}
function _parse_and_transform(nodes,transform_function){return _.map(nodes,function(node){return transform_function(node,function(){return _parse_and_transform(node.childNodes,transform_function);});}).join("");}
var url_regexp=/\b(?:https?:\/\/|(www\.))[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,13}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(url_regexp,function(url){var href=(!/^(f|ht)tps?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function add_link(node,transform_children){if(node.nodeType===3){return linkify(node.data);}
if(node.tagName==="A")return node.outerHTML;node.innerHTML=transform_children();return node.outerHTML;}
function strip_html(node,transform_children){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transform_children();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parse_email(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}
function get_text2html(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
var accented_letters_mapping={'a':'[àáâãäå]','ae':'æ','c':'ç','e':'[èéêë]','i':'[ìíîï]','n':'ñ','o':'[òóôõö]','oe':'œ','u':'[ùúûűü]','y':'[ýÿ]',};function unaccent(str){_.each(accented_letters_mapping,function(value,key){str=str.replace(new RegExp(value,'g'),key);});return str;}
return{send_notification:send_notification,parse_and_transform:parse_and_transform,add_link:add_link,linkify:linkify,strip_html:strip_html,inline:inline,parse_email:parse_email,get_text2html:get_text2html,unaccent:unaccent,};});;

/* /mail/static/src/js/window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.window_manager',function(require){"use strict";var chat_manager=require('mail.chat_manager');var ExtendedChatWindow=require('mail.ExtendedChatWindow');var config=require('web.config');var core=require('web.core');var utils=require('web.utils');var web_client=require('web.web_client');var _t=core._t;var QWeb=core.qweb;var CHAT_WINDOW_WIDTH=300+5;var chat_sessions=[];var new_chat_session;var display_state={chat_windows_hidden:false,hidden_sessions:[],hidden_unread_counter:0,nb_slots:0,space_left:0,windows_dropdown_is_open:false,};function add_chat_session(chat_session){compute_available_slots(chat_sessions.length+1);chat_sessions.splice(display_state.nb_slots-1,0,chat_session);}
function open_chat(session,options){if(!session){open_chat_without_session();return;}
options=options||{};var chat_session=_.findWhere(chat_sessions,{id:session.id});if(!chat_session){var prefix=!session.is_chat?"#":"";var window_options={autofocus:!options.passively,input_less:session.mass_mailing,status:session.status,};chat_session={id:session.id,uuid:session.uuid,name:session.name,keep_unread:options.passively,window:new ExtendedChatWindow(web_client,session.id,prefix+session.name,session.is_folded,session.unread_counter,window_options),};chat_session.window.on("close_chat_session",null,function(){close_chat(chat_session);chat_manager.close_chat_session(chat_session.id);});chat_session.window.on("toggle_star_status",null,function(message_id){chat_manager.toggle_star_status(message_id);});chat_session.window.on("fold_channel",null,function(channel_id,folded){chat_manager.fold_channel(channel_id,folded);});chat_session.window.on("post_message",null,function(message,channel_id){chat_manager.post_message(message,{channel_id:channel_id}).then(function(){chat_session.window.thread.scroll_to();});});chat_session.window.on("redirect",null,function(res_model,res_id){chat_manager.redirect(res_model,res_id,open_chat);});chat_session.window.on("redirect_to_channel",null,function(channel_id){var session=_.findWhere(chat_sessions,{id:channel_id});if(!session){chat_manager.join_channel(channel_id).then(function(channel){chat_manager.detach_channel(channel);});}else{session.window.toggle_fold(false);}});var remove_new_chat=false;if(options.passively){chat_sessions.push(chat_session);}else if(new_chat_session&&new_chat_session.partner_id&&new_chat_session.partner_id===session.direct_partner_id){chat_sessions[_.indexOf(chat_sessions,new_chat_session)]=chat_session;remove_new_chat=true;}else{add_chat_session(chat_session);}
chat_session.window.appendTo($('body')).then(function(){reposition_windows({remove_new_chat:remove_new_chat});return chat_manager.get_messages({channel_id:chat_session.id});}).then(function(messages){chat_session.window.render(messages);chat_session.window.thread.scroll_to();setTimeout(function(){chat_session.window.thread.$el.on("scroll",null,_.debounce(function(){if(!chat_session.keep_unread&&chat_session.window.thread.is_at_bottom()){chat_manager.mark_channel_as_seen(session);}},100));},0);if(options.passively){chat_session.window.$('.o_mail_thread, .o_chat_composer').one('click',function(){chat_manager.mark_channel_as_seen(session);});}else if(!display_state.chat_windows_hidden&&!session.is_folded){chat_manager.mark_channel_as_seen(session);}});}else if(!options.passively){if(chat_session.window.is_hidden){make_session_visible(chat_session);}else if(session.is_folded!==chat_session.window.folded){chat_session.window.toggle_fold(session.is_folded);}}}
function open_chat_without_session(){if(!new_chat_session){new_chat_session={id:'_open',window:new ExtendedChatWindow(web_client,undefined,_t('New message'),false,0,{thread_less:true}),};new_chat_session.window.on("close_chat_session",null,close_new_chat);new_chat_session.window.on('open_dm_session',null,function(partner_id){new_chat_session.partner_id=partner_id;var dm=chat_manager.get_dm_from_partner_id(partner_id);if(!dm){chat_manager.open_and_detach_dm(partner_id);}else{var dm_session=_.findWhere(chat_sessions,{id:dm.id});if(!dm_session){chat_manager.detach_channel(dm);}else{close_chat(dm_session);dm.is_folded=false;open_chat(dm);}}});add_chat_session(new_chat_session);new_chat_session.window.appendTo($('body')).then(reposition_windows);}else{if(new_chat_session.window.is_hidden){make_session_visible(new_chat_session);}else if(new_chat_session.window.folded){new_chat_session.window.toggle_fold(false);}}}
function close_chat(chat_session,options){if(options&&options.keep_open_if_unread&&chat_session.keep_unread){return;}
chat_sessions=_.without(chat_sessions,chat_session);chat_session.window.destroy();reposition_windows();}
function close_new_chat(){chat_sessions=_.without(chat_sessions,new_chat_session);reposition_windows({remove_new_chat:true});}
function destroy_new_chat(){new_chat_session.window.destroy();new_chat_session=undefined;}
function toggle_fold_chat(channel){var session=_.find(chat_sessions,{id:channel.id});if(session){session.window.toggle_fold(channel.is_folded);}}
function compute_available_slots(nb_windows){if(config.device.size_class===config.device.SIZES.XS){display_state.nb_slots=1;return;}
var width=window.innerWidth;var nb_slots=Math.floor(width/CHAT_WINDOW_WIDTH);var space_left=width-(Math.min(nb_slots,nb_windows)*CHAT_WINDOW_WIDTH);if(nb_slots<nb_windows&&space_left<50){nb_slots--;space_left+=CHAT_WINDOW_WIDTH;}
display_state.nb_slots=nb_slots;display_state.space_left=space_left;}
var reposition_windows=function(options){if(options&&options.remove_new_chat){destroy_new_chat();}
if(display_state.chat_windows_hidden){return;}
compute_available_slots(chat_sessions.length);var hidden_sessions=[];var hidden_unread_counter=0;var nb_slots=display_state.nb_slots;_.each(chat_sessions,function(session,index){if(index<nb_slots){session.window.$el.css({right:CHAT_WINDOW_WIDTH*index,bottom:0});session.window.do_show();}else{hidden_sessions.push(session);hidden_unread_counter+=session.window.unread_msgs;session.window.do_hide();}});display_state.hidden_sessions=hidden_sessions;display_state.hidden_unread_counter=hidden_unread_counter;if(display_state.$hidden_windows_dropdown){display_state.$hidden_windows_dropdown.remove();}
if(hidden_sessions.length){display_state.$hidden_windows_dropdown=render_hidden_sessions_dropdown();var $hidden_windows_dropdown=display_state.$hidden_windows_dropdown;$hidden_windows_dropdown.css({right:CHAT_WINDOW_WIDTH*nb_slots,bottom:0}).appendTo($('body'));reposition_hidden_sessions_dropdown();display_state.windows_dropdown_is_open=false;$hidden_windows_dropdown.on('click','.o_chat_header',function(event){var session_id=$(event.currentTarget).data('session-id');var session=_.findWhere(hidden_sessions,{id:session_id});if(session){make_session_visible(session);}});$hidden_windows_dropdown.on('click','.o_chat_window_close',function(event){var session_id=$(event.currentTarget).closest('.o_chat_header').data('session-id');var session=_.findWhere(hidden_sessions,{id:session_id});if(session){session.window.on_click_close(event);display_state.windows_dropdown_is_open=true;}});}};function make_session_visible(session){utils.swap(chat_sessions,session,chat_sessions[display_state.nb_slots-1]);reposition_windows();session.window.toggle_fold(false);}
function render_hidden_sessions_dropdown(){var $dropdown=$(QWeb.render("mail.ChatWindowsDropdown",{sessions:display_state.hidden_sessions,open:display_state.windows_dropdown_is_open,unread_counter:display_state.hidden_unread_counter,}));return $dropdown;}
function reposition_hidden_sessions_dropdown(){var $dropdown_ul=display_state.$hidden_windows_dropdown.children('ul');if(display_state.space_left>$dropdown_ul.width()+10){$dropdown_ul.addClass('dropdown-menu-right');}}
function update_sessions(message,scrollBottom){_.each(chat_sessions,function(session){if(_.contains(message.channel_ids,session.id)){var message_visible=!display_state.chat_windows_hidden&&!session.window.folded&&!session.window.is_hidden&&session.window.thread.is_at_bottom();if(message_visible&&!session.keep_unread){chat_manager.mark_channel_as_seen(chat_manager.get_channel(session.id));}
chat_manager.get_messages({channel_id:session.id}).then(function(messages){session.window.render(messages);if(scrollBottom&&message_visible){session.window.thread.scroll_to();}});}});}
core.bus.on('web_client_ready',null,function(){chat_manager.bus.on('open_chat',null,open_chat);chat_manager.bus.on('close_chat',null,function(channel,options){var session=_.find(chat_sessions,{id:channel.id});if(session){close_chat(session,options);}});chat_manager.bus.on('channel_toggle_fold',null,toggle_fold_chat);chat_manager.bus.on('new_message',null,function(message){update_sessions(message,true);});chat_manager.bus.on('update_message',null,function(message){update_sessions(message,false);});chat_manager.bus.on('anyone_listening',null,function(channel,query){_.each(chat_sessions,function(session){if(channel.id===session.id&&session.window.thread.is_at_bottom()&&!session.window.is_hidden){query.is_displayed=true;}});});chat_manager.bus.on('unsubscribe_from_channel',null,function(channel_id){_.each(chat_sessions,function(session){if(channel_id===session.id){close_chat(session);}});});chat_manager.bus.on('update_channel_unread_counter',null,function(channel){display_state.hidden_unread_counter=0;_.each(chat_sessions,function(session){if(channel.id===session.id){session.window.update_unread(channel.unread_counter);if(channel.unread_counter===0){session.keep_unread=false;}}
if(session.window.is_hidden){display_state.hidden_unread_counter+=session.window.unread_msgs;}});if(display_state.$hidden_windows_dropdown){display_state.$hidden_windows_dropdown.html(render_hidden_sessions_dropdown().html());reposition_hidden_sessions_dropdown();}});chat_manager.bus.on('update_dm_presence',null,function(channel){_.each(chat_sessions,function(session){if(channel.id===session.id){session.window.update_status(channel.status);}});});chat_manager.is_ready.then(function(){_.each(chat_manager.get_channels(),function(channel){if(channel.is_detached){open_chat(channel);}});});chat_manager.bus.on('detach_channel',null,function(channel){var chat_session=_.findWhere(chat_sessions,{id:channel.id});if(!chat_session||chat_session.window.folded){chat_manager.detach_channel(channel);}else if(chat_session.window.is_hidden){make_session_visible(chat_session);}else{chat_session.window.focus_input();}});chat_manager.bus.on('client_action_open',null,function(open){display_state.chat_windows_hidden=open;if(open){$('body').addClass('o_no_chat_window');}else{$('body').removeClass('o_no_chat_window');reposition_windows();}});core.bus.on('resize',null,_.debounce(reposition_windows,100));});});;

/* /mrp/static/src/js/mrp.js defined in bundle 'web.assets_backend' */
odoo.define('mrp.mrp_state',function(require){"use strict";var core=require('web.core');var common=require('web.form_common');var Model=require('web.Model');var time=require('web.time');var utils=require('web.utils');var FieldBinaryFile=core.form_widget_registry.get('binary');var _t=core._t;var SetBulletStatus=common.AbstractField.extend(common.ReinitializeFieldMixin,{init:function(field_manager,node){this._super(field_manager,node);this.classes=this.options&&this.options.classes||{};},render_value:function(){this._super.apply(this,arguments);if(this.get("effective_readonly")){var bullet_class=this.classes[this.get('value')]||'default';if(this.get('value')){var title=this.get('value')=='waiting'?_t('Waiting Materials'):_t('Ready to produce');this.$el.attr({'title':title,'style':'display:inline'});this.$el.removeClass('text-success text-danger text-default');this.$el.html($('<span>'+title+'</span>').addClass('label label-'+bullet_class));}}},});var TimeCounter=common.AbstractField.extend(common.ReinitializeFieldMixin,{start:function(){this._super();var self=this;this.field_manager.on("view_content_has_changed",this,function(){self.render_value();});},start_time_counter:function(){var self=this;clearTimeout(this.timer);if(this.field_manager.datarecord.is_user_working){this.duration+=1000;this.timer=setTimeout(function(){self.start_time_counter();},1000);}else{clearTimeout(this.timer);}
this.$el.html($('<span>'+moment.utc(this.duration).format("HH:mm:ss")+'</span>'));},render_value:function(){this._super.apply(this,arguments);var self=this;this.duration;var productivity_domain=[['workorder_id','=',this.field_manager.datarecord.id],['user_id','=',self.session.uid]];new Model('mrp.workcenter.productivity').call('search_read',[productivity_domain,[]]).then(function(result){if(self.get("effective_readonly")){self.$el.removeClass('o_form_field_empty');var current_date=new Date();self.duration=0;_.each(result,function(data){self.duration+=data.date_end?self.get_date_difference(data.date_start,data.date_end):self.get_date_difference(time.auto_str_to_date(data.date_start),current_date);});self.start_time_counter();}});},get_date_difference:function(date_start,date_end){var difference=moment(date_end).diff(moment(date_start));return moment.duration(difference);},});var FieldPdfViewer=FieldBinaryFile.extend({template:'FieldPdfViewer',init:function(){this._super.apply(this,arguments);this.PDFViewerApplication=false;},get_uri:function(){var query_obj={model:this.view.dataset.model,field:this.name,id:this.view.datarecord.id};var query_string=$.param(query_obj);var url=encodeURIComponent('/web/image?'+query_string);var viewer_url='/web/static/lib/pdfjs/web/viewer.html?file=';return viewer_url+url;},on_file_change:function(ev){this._super.apply(this,arguments);if(this.PDFViewerApplication){var files=ev.target.files;if(!files||files.length===0){return;}
var file=files[0];this.PDFViewerApplication.open(URL.createObjectURL(file),0);}},render_value:function(){var $pdf_viewer=this.$('.o_form_pdf_controls').children().add(this.$('.o_pdfview_iframe')),$select_upload_el=this.$('.o_select_file_button').first(),$iFrame=this.$('.o_pdfview_iframe'),value=this.get('value'),self=this;var bin_size=utils.is_bin_size(value);$iFrame.on('load',function(){self.PDFViewerApplication=this.contentWindow.window.PDFViewerApplication;self.disable_buttons(this);});if(this.get("effective_readonly")){if(value){this.$el.off('click');$iFrame.attr('src',this.get_uri());}}else{if(value){$pdf_viewer.removeClass('o_hidden');$select_upload_el.addClass('o_hidden');if(bin_size){$iFrame.attr('src',this.get_uri());}}else{$pdf_viewer.addClass('o_hidden');$select_upload_el.removeClass('o_hidden');}}},disable_buttons:function(iframe){if(this.get("effective_readonly")){$(iframe).contents().find('button#download').hide();}
$(iframe).contents().find('button#openFile').hide();}});core.form_widget_registry.add('bullet_state',SetBulletStatus).add('mrp_time_counter',TimeCounter).add('pdf_viewer',FieldPdfViewer);});;

/* /web_responsive/static/lib/js/bililiteRange.2.6.js defined in bundle 'web.assets_backend' */
(function(){var focusEvent='onfocusin'in document.createElement('input')?'focusin':'focus';var n=document.createElement('div');n.appendChild(document.createTextNode('x-'));n.appendChild(document.createTextNode('x'));n.normalize();var canNormalize=n.firstChild.length==3;bililiteRange=function(el,debug){var ret;if(debug){ret=new NothingRange();}else if(window.getSelection&&el.setSelectionRange){try{el.selectionStart;ret=new InputRange();}catch(e){ret=new NothingRange();}}else if(window.getSelection){ret=new W3CRange();}else if(document.selection){ret=new IERange();}else{ret=new NothingRange();}
ret._el=el;ret._doc=el.ownerDocument;ret._win='defaultView'in ret._doc?ret._doc.defaultView:ret._doc.parentWindow;ret._textProp=textProp(el);ret._bounds=[0,ret.length()];if(!('bililiteRangeMouseDown'in ret._doc)){var _doc={_el:ret._doc};ret._doc.bililiteRangeMouseDown=false;bililiteRange.fn.listen.call(_doc,'mousedown',function(){ret._doc.bililiteRangeMouseDown=true;});bililiteRange.fn.listen.call(_doc,'mouseup',function(){ret._doc.bililiteRangeMouseDown=false;});}
if(!('bililiteRangeSelection'in el)){function trackSelection(evt){if(evt&&evt.which==9){ret._nativeSelect(ret._nativeRange(el.bililiteRangeSelection));}else{el.bililiteRangeSelection=ret._nativeSelection();}}
trackSelection();if('onbeforedeactivate'in el){ret.listen('beforedeactivate',trackSelection);}else{ret.listen('mouseup',trackSelection).listen('keyup',trackSelection);}
ret.listen(focusEvent,function(){if(!ret._doc.bililiteRangeMouseDown){ret._nativeSelect(ret._nativeRange(el.bililiteRangeSelection));}});}
if(!('oninput'in el)){var inputhack=function(){ret.dispatch({type:'input',bubbles:true})};ret.listen('keyup',inputhack);ret.listen('cut',inputhack);ret.listen('paste',inputhack);ret.listen('drop',inputhack);el.oninput='patched';}
return ret;}
function textProp(el){if(typeof el.value==='string')return'value';if(typeof el.text!='undefined')return'text';if(typeof el.textContent!='undefined')return'textContent';return'innerText';}
function Range(){}
Range.prototype={length:function(){return this._el[this._textProp].replace(/\r/g,'').length;},bounds:function(s){if(bililiteRange.bounds[s]){this._bounds=bililiteRange.bounds[s].apply(this);}else if(s){this._bounds=s;}else{var b=[Math.max(0,Math.min(this.length(),this._bounds[0])),Math.max(0,Math.min(this.length(),this._bounds[1]))];b[1]=Math.max(b[0],b[1]);return b;}
return this;},select:function(){var b=this._el.bililiteRangeSelection=this.bounds();if(this._el===this._doc.activeElement){this._nativeSelect(this._nativeRange(b));}
this.dispatch({type:'select',bubbles:true});return this;},text:function(text,select){if(arguments.length){var bounds=this.bounds(),el=this._el;this.dispatch({type:'beforeinput',bubbles:true,data:text,bounds:bounds});this._nativeSetText(text,this._nativeRange(bounds));if(select=='start'){this.bounds([bounds[0],bounds[0]]);}else if(select=='end'){this.bounds([bounds[0]+text.length,bounds[0]+text.length]);}else if(select=='all'){this.bounds([bounds[0],bounds[0]+text.length]);}
this.dispatch({type:'input',bubbles:true,data:text,bounds:bounds});return this;}else{return this._nativeGetText(this._nativeRange(this.bounds())).replace(/\r/g,'');}},insertEOL:function(){this._nativeEOL();this._bounds=[this._bounds[0]+1,this._bounds[0]+1];return this;},sendkeys:function(text){var self=this;this.data().sendkeysOriginalText=this.text();this.data().sendkeysBounds=undefined;function simplechar(rng,c){if(/^{[^}]*}$/.test(c))c=c.slice(1,-1);for(var i=0;i<c.length;++i){var x=c.charCodeAt(i);rng.dispatch({type:'keypress',bubbles:true,keyCode:x,which:x,charCode:x});}
rng.text(c,'end');}
text.replace(/{[^}]*}|[^{]+|{/g,function(part){(bililiteRange.sendkeys[part]||simplechar)(self,part,simplechar);});this.bounds(this.data().sendkeysBounds);this.dispatch({type:'sendkeys',which:text});return this;},top:function(){return this._nativeTop(this._nativeRange(this.bounds()));},scrollIntoView:function(scroller){var top=this.top();if(this._el.scrollTop>top||this._el.scrollTop+this._el.clientHeight<top){if(scroller){scroller.call(this._el,top);}else{this._el.scrollTop=top;}}
return this;},wrap:function(n){this._nativeWrap(n,this._nativeRange(this.bounds()));return this;},selection:function(text){if(arguments.length){return this.bounds('selection').text(text,'end').select();}else{return this.bounds('selection').text();}},clone:function(){return bililiteRange(this._el).bounds(this.bounds());},all:function(text){if(arguments.length){this.dispatch({type:'beforeinput',bubbles:true,data:text});this._el[this._textProp]=text;this.dispatch({type:'input',bubbles:true,data:text});return this;}else{return this._el[this._textProp].replace(/\r/g,'');}},element:function(){return this._el},dispatch:function(opts){opts=opts||{};var event=document.createEvent?document.createEvent('CustomEvent'):this._doc.createEventObject();event.initCustomEvent&&event.initCustomEvent(opts.type,!!opts.bubbles,!!opts.cancelable,opts.detail);for(var key in opts)event[key]=opts[key];var el=this._el;setTimeout(function(){try{el.dispatchEvent?el.dispatchEvent(event):el.fireEvent("on"+opts.type,document.createEventObject());}catch(e){var listeners=el['listen'+opts.type];if(listeners)for(var i=0;i<listeners.length;++i){listeners[i].call(el,event);}}},0);return this;},listen:function(type,func){var el=this._el;if(el.addEventListener){el.addEventListener(type,func);}else{el.attachEvent("on"+type,func);var listeners=el['listen'+type]=el['listen'+type]||[];listeners.push(func);}
return this;},dontlisten:function(type,func){var el=this._el;if(el.removeEventListener){el.removeEventListener(type,func);}else try{el.detachEvent("on"+type,func);}catch(e){var listeners=el['listen'+type];if(listeners)for(var i=0;i<listeners.length;++i){if(listeners[i]===func)listeners[i]=function(){};}}
return this;}};bililiteRange.fn=Range.prototype;bililiteRange.extend=function(fns){for(fn in fns)Range.prototype[fn]=fns[fn];};bililiteRange.bounds={all:function(){return[0,this.length()]},start:function(){return[0,0]},end:function(){return[this.length(),this.length()]},selection:function(){if(this._el===this._doc.activeElement){this.bounds('all');return this._nativeSelection();}else{return this._el.bililiteRangeSelection;}}};bililiteRange.sendkeys={'{enter}':function(rng){rng.dispatch({type:'keypress',bubbles:true,keyCode:'\n',which:'\n',charCode:'\n'});rng.insertEOL();},'{tab}':function(rng,c,simplechar){simplechar(rng,'\t');},'{newline}':function(rng,c,simplechar){simplechar(rng,'\n');},'{backspace}':function(rng){var b=rng.bounds();if(b[0]==b[1])rng.bounds([b[0]-1,b[0]]);rng.text('','end');},'{del}':function(rng){var b=rng.bounds();if(b[0]==b[1])rng.bounds([b[0],b[0]+1]);rng.text('','end');},'{rightarrow}':function(rng){var b=rng.bounds();if(b[0]==b[1])++b[1];rng.bounds([b[1],b[1]]);},'{leftarrow}':function(rng){var b=rng.bounds();if(b[0]==b[1])--b[0];rng.bounds([b[0],b[0]]);},'{selectall}':function(rng){rng.bounds('all');},'{selection}':function(rng){var s=rng.data().sendkeysOriginalText;for(var i=0;i<s.length;++i){var x=s.charCodeAt(i);rng.dispatch({type:'keypress',bubbles:true,keyCode:x,which:x,charCode:x});}
rng.text(s,'end');},'{mark}':function(rng){rng.data().sendkeysBounds=rng.bounds();}};bililiteRange.sendkeys['{Enter}']=bililiteRange.sendkeys['{enter}'];bililiteRange.sendkeys['{Backspace}']=bililiteRange.sendkeys['{backspace}'];bililiteRange.sendkeys['{Delete}']=bililiteRange.sendkeys['{del}'];bililiteRange.sendkeys['{ArrowRight}']=bililiteRange.sendkeys['{rightarrow}'];bililiteRange.sendkeys['{ArrowLeft}']=bililiteRange.sendkeys['{leftarrow}'];function IERange(){}
IERange.prototype=new Range();IERange.prototype._nativeRange=function(bounds){var rng;if(this._el.tagName=='INPUT'){rng=this._el.createTextRange();}else{rng=this._doc.body.createTextRange();rng.moveToElementText(this._el);}
if(bounds){if(bounds[1]<0)bounds[1]=0;if(bounds[0]>this.length())bounds[0]=this.length();if(bounds[1]<rng.text.replace(/\r/g,'').length){rng.moveEnd('character',-1);rng.moveEnd('character',bounds[1]-rng.text.replace(/\r/g,'').length);}
if(bounds[0]>0)rng.moveStart('character',bounds[0]);}
return rng;};IERange.prototype._nativeSelect=function(rng){rng.select();};IERange.prototype._nativeSelection=function(){var rng=this._nativeRange();var len=this.length();var sel=this._doc.selection.createRange();try{return[iestart(sel,rng),ieend(sel,rng)];}catch(e){return(sel.parentElement().sourceIndex<this._el.sourceIndex)?[0,0]:[len,len];}};IERange.prototype._nativeGetText=function(rng){return rng.text;};IERange.prototype._nativeSetText=function(text,rng){rng.text=text;};IERange.prototype._nativeEOL=function(){if('value'in this._el){this.text('\n');}else{this._nativeRange(this.bounds()).pasteHTML('\n<br/>');}};IERange.prototype._nativeTop=function(rng){var startrng=this._nativeRange([0,0]);return rng.boundingTop-startrng.boundingTop;}
IERange.prototype._nativeWrap=function(n,rng){var div=document.createElement('div');div.appendChild(n);var html=div.innerHTML.replace('><','>'+rng.htmlText+'<');rng.pasteHTML(html);};function iestart(rng,constraint){var len=constraint.text.replace(/\r/g,'').length;if(rng.compareEndPoints('StartToStart',constraint)<=0)return 0;if(rng.compareEndPoints('StartToEnd',constraint)>=0)return len;for(var i=0;rng.compareEndPoints('StartToStart',constraint)>0;++i,rng.moveStart('character',-1));return i;}
function ieend(rng,constraint){var len=constraint.text.replace(/\r/g,'').length;if(rng.compareEndPoints('EndToEnd',constraint)>=0)return len;if(rng.compareEndPoints('EndToStart',constraint)<=0)return 0;for(var i=0;rng.compareEndPoints('EndToStart',constraint)>0;++i,rng.moveEnd('character',-1));return i;}
function InputRange(){}
InputRange.prototype=new Range();InputRange.prototype._nativeRange=function(bounds){return bounds||[0,this.length()];};InputRange.prototype._nativeSelect=function(rng){this._el.setSelectionRange(rng[0],rng[1]);};InputRange.prototype._nativeSelection=function(){return[this._el.selectionStart,this._el.selectionEnd];};InputRange.prototype._nativeGetText=function(rng){return this._el.value.substring(rng[0],rng[1]);};InputRange.prototype._nativeSetText=function(text,rng){var val=this._el.value;this._el.value=val.substring(0,rng[0])+text+val.substring(rng[1]);};InputRange.prototype._nativeEOL=function(){this.text('\n');};InputRange.prototype._nativeTop=function(rng){var clone=this._el.cloneNode(true);clone.style.visibility='hidden';clone.style.position='absolute';this._el.parentNode.insertBefore(clone,this._el);clone.style.height='1px';clone.value=this._el.value.slice(0,rng[0]);var top=clone.scrollHeight;clone.value='X';top-=clone.scrollHeight;clone.parentNode.removeChild(clone);return top;}
InputRange.prototype._nativeWrap=function(){throw new Error("Cannot wrap in a text element")};function W3CRange(){}
W3CRange.prototype=new Range();W3CRange.prototype._nativeRange=function(bounds){var rng=this._doc.createRange();rng.selectNodeContents(this._el);if(bounds){w3cmoveBoundary(rng,bounds[0],true,this._el);rng.collapse(true);w3cmoveBoundary(rng,bounds[1]-bounds[0],false,this._el);}
return rng;};W3CRange.prototype._nativeSelect=function(rng){this._win.getSelection().removeAllRanges();this._win.getSelection().addRange(rng);};W3CRange.prototype._nativeSelection=function(){var rng=this._nativeRange();if(this._win.getSelection().rangeCount==0)return[this.length(),this.length()];var sel=this._win.getSelection().getRangeAt(0);return[w3cstart(sel,rng),w3cend(sel,rng)];}
W3CRange.prototype._nativeGetText=function(rng){return String.prototype.slice.apply(this._el.textContent,this.bounds());};W3CRange.prototype._nativeSetText=function(text,rng){rng.deleteContents();rng.insertNode(this._doc.createTextNode(text));if(canNormalize)this._el.normalize();};W3CRange.prototype._nativeEOL=function(){var rng=this._nativeRange(this.bounds());rng.deleteContents();var br=this._doc.createElement('br');br.setAttribute('_moz_dirty','');rng.insertNode(br);rng.insertNode(this._doc.createTextNode('\n'));rng.collapse(false);};W3CRange.prototype._nativeTop=function(rng){if(this.length==0)return 0;if(rng.toString()==''){var textnode=this._doc.createTextNode('X');rng.insertNode(textnode);}
var startrng=this._nativeRange([0,1]);var top=rng.getBoundingClientRect().top-startrng.getBoundingClientRect().top;if(textnode)textnode.parentNode.removeChild(textnode);return top;}
W3CRange.prototype._nativeWrap=function(n,rng){rng.surroundContents(n);};function nextnode(node,root){if(node.firstChild)return node.firstChild;if(node.nextSibling)return node.nextSibling;if(node===root)return null;while(node.parentNode){node=node.parentNode;if(node==root)return null;if(node.nextSibling)return node.nextSibling;}
return null;}
function w3cmoveBoundary(rng,n,bStart,el){if(n<=0)return;var node=rng[bStart?'startContainer':'endContainer'];if(node.nodeType==3){n+=rng[bStart?'startOffset':'endOffset'];}
while(node){if(node.nodeType==3){var length=node.nodeValue.length;if(n<=length){rng[bStart?'setStart':'setEnd'](node,n);if(n==length){for(var next=nextnode(node,el);next&&next.nodeType==3&&next.nodeValue.length==0;next=nextnode(next,el)){rng[bStart?'setStartAfter':'setEndAfter'](next);}
if(next&&next.nodeType==1&&next.nodeName=="BR")rng[bStart?'setStartAfter':'setEndAfter'](next);}
return;}else{rng[bStart?'setStartAfter':'setEndAfter'](node);n-=length;}}
node=nextnode(node,el);}}
var START_TO_START=0;var START_TO_END=1;var END_TO_END=2;var END_TO_START=3;function w3cstart(rng,constraint){if(rng.compareBoundaryPoints(START_TO_START,constraint)<=0)return 0;if(rng.compareBoundaryPoints(END_TO_START,constraint)>=0)return constraint.toString().length;rng=rng.cloneRange();rng.setEnd(constraint.endContainer,constraint.endOffset);return constraint.toString().replace(/\r/g,'').length-rng.toString().replace(/\r/g,'').length;}
function w3cend(rng,constraint){if(rng.compareBoundaryPoints(END_TO_END,constraint)>=0)return constraint.toString().length;if(rng.compareBoundaryPoints(START_TO_END,constraint)<=0)return 0;rng=rng.cloneRange();rng.setStart(constraint.startContainer,constraint.startOffset);return rng.toString().replace(/\r/g,'').length;}
function NothingRange(){}
NothingRange.prototype=new Range();NothingRange.prototype._nativeRange=function(bounds){return bounds||[0,this.length()];};NothingRange.prototype._nativeSelect=function(rng){};NothingRange.prototype._nativeSelection=function(){return[0,0];};NothingRange.prototype._nativeGetText=function(rng){return this._el[this._textProp].substring(rng[0],rng[1]);};NothingRange.prototype._nativeSetText=function(text,rng){var val=this._el[this._textProp];this._el[this._textProp]=val.substring(0,rng[0])+text+val.substring(rng[1]);};NothingRange.prototype._nativeEOL=function(){this.text('\n');};NothingRange.prototype._nativeTop=function(){return 0;};NothingRange.prototype._nativeWrap=function(){throw new Error("Wrapping not implemented")};var data=[];bililiteRange.fn.data=function(){var index=this.element().bililiteRangeData;if(index==undefined){index=this.element().bililiteRangeData=data.length;data[index]=new Data(this);}
return data[index];}
try{Object.defineProperty({},'foo',{});var Data=function(rng){Object.defineProperty(this,'values',{value:{}});Object.defineProperty(this,'sourceRange',{value:rng});Object.defineProperty(this,'toJSON',{value:function(){var ret={};for(var i in Data.prototype)if(i in this.values)ret[i]=this.values[i];return ret;}});Object.defineProperty(this,'all',{get:function(){var ret={};for(var i in Data.prototype)ret[i]=this[i];return ret;}});}
Data.prototype={};Object.defineProperty(Data.prototype,'values',{value:{}});Object.defineProperty(Data.prototype,'monitored',{value:{}});bililiteRange.data=function(name,newdesc){newdesc=newdesc||{};var desc=Object.getOwnPropertyDescriptor(Data.prototype,name)||{};if('enumerable'in newdesc)desc.enumerable=!!newdesc.enumerable;if(!('enumerable'in desc))desc.enumerable=true;if('value'in newdesc)Data.prototype.values[name]=newdesc.value;if('monitored'in newdesc)Data.prototype.monitored[name]=newdesc.monitored;desc.configurable=true;desc.get=function(){if(name in this.values)return this.values[name];return Data.prototype.values[name];};desc.set=function(value){this.values[name]=value;if(Data.prototype.monitored[name])this.sourceRange.dispatch({type:'bililiteRangeData',bubbles:true,detail:{name:name,value:value}});}
Object.defineProperty(Data.prototype,name,desc);}}catch(err){Data=function(rng){this.sourceRange=rng};Data.prototype={};bililiteRange.data=function(name,newdesc){if('value'in newdesc)Data.prototype[name]=newdesc.value;}}})();if(!Array.prototype.forEach)
{Array.prototype.forEach=function(fun)
{"use strict";if(this===void 0||this===null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function")
throw new TypeError();var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++)
{if(i in t)
fun.call(thisArg,t[i],i,t);}};};

/* /web_responsive/static/lib/js/jquery.sendkeys.4.js defined in bundle 'web.assets_backend' */
(function($){$.fn.sendkeys=function(x){x=x.replace(/([^{])\n/g,'$1{enter}');return this.each(function(){bililiteRange(this).bounds('selection').sendkeys(x).select();this.focus();});};$.event.special.keydown=$.event.special.keydown||{};$.event.special.keydown._default=function(evt){if(evt.isTrusted)return false;if(evt.ctrlKey||evt.altKey||evt.metaKey)return false;if(evt.key==null)return false;var target=evt.target;if(target.isContentEditable||target.nodeName=='INPUT'||target.nodeName=='TEXTAREA'){var key=evt.key;if(key.length>1&&key.charAt(0)!='{')key='{'+key+'}';$(target).sendkeys(key);return true;}
return false;}})(jQuery);

/* /web_responsive/static/lib/js/iscroll-probe.5.2.0.js defined in bundle 'web.assets_backend' */
(function(window,document,Math){var rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};var utils=(function(){var me={};var _elementStyle=document.createElement('div').style;var _vendor=(function(){var vendors=['t','webkitT','MozT','msT','OT'],transform,i=0,l=vendors.length;for(;i<l;i++){transform=vendors[i]+'ransform';if(transform in _elementStyle)return vendors[i].substr(0,vendors[i].length-1);}
return false;})();function _prefixStyle(style){if(_vendor===false)return false;if(_vendor==='')return style;return _vendor+style.charAt(0).toUpperCase()+style.substr(1);}
me.getTime=Date.now||function getTime(){return new Date().getTime();};me.extend=function(target,obj){for(var i in obj){target[i]=obj[i];}};me.addEvent=function(el,type,fn,capture){el.addEventListener(type,fn,!!capture);};me.removeEvent=function(el,type,fn,capture){el.removeEventListener(type,fn,!!capture);};me.prefixPointerEvent=function(pointerEvent){return window.MSPointerEvent?'MSPointer'+pointerEvent.charAt(7).toUpperCase()+pointerEvent.substr(8):pointerEvent;};me.momentum=function(current,start,time,lowerMargin,wrapperSize,deceleration){var distance=current-start,speed=Math.abs(distance)/time,destination,duration;deceleration=deceleration===undefined?0.0006:deceleration;destination=current+(speed*speed)/(2*deceleration)*(distance<0?-1:1);duration=speed/deceleration;if(destination<lowerMargin){destination=wrapperSize?lowerMargin-(wrapperSize/2.5*(speed/8)):lowerMargin;distance=Math.abs(destination-current);duration=distance/speed;}else if(destination>0){destination=wrapperSize?wrapperSize/2.5*(speed/8):0;distance=Math.abs(current)+destination;duration=distance/speed;}
return{destination:Math.round(destination),duration:duration};};var _transform=_prefixStyle('transform');me.extend(me,{hasTransform:_transform!==false,hasPerspective:_prefixStyle('perspective')in _elementStyle,hasTouch:'ontouchstart'in window,hasPointer:!!(window.PointerEvent||window.MSPointerEvent),hasTransition:_prefixStyle('transition')in _elementStyle});me.isBadAndroid=(function(){var appVersion=window.navigator.appVersion;if(/Android/.test(appVersion)&&!(/Chrome\/\d/.test(appVersion))){var safariVersion=appVersion.match(/Safari\/(\d+.\d)/);if(safariVersion&&typeof safariVersion==="object"&&safariVersion.length>=2){return parseFloat(safariVersion[1])<535.19;}else{return true;}}else{return false;}})();me.extend(me.style={},{transform:_transform,transitionTimingFunction:_prefixStyle('transitionTimingFunction'),transitionDuration:_prefixStyle('transitionDuration'),transitionDelay:_prefixStyle('transitionDelay'),transformOrigin:_prefixStyle('transformOrigin'),touchAction:_prefixStyle('touchAction')});me.hasClass=function(e,c){var re=new RegExp("(^|\\s)"+c+"(\\s|$)");return re.test(e.className);};me.addClass=function(e,c){if(me.hasClass(e,c)){return;}
var newclass=e.className.split(' ');newclass.push(c);e.className=newclass.join(' ');};me.removeClass=function(e,c){if(!me.hasClass(e,c)){return;}
var re=new RegExp("(^|\\s)"+c+"(\\s|$)",'g');e.className=e.className.replace(re,' ');};me.offset=function(el){var left=-el.offsetLeft,top=-el.offsetTop;while(el=el.offsetParent){left-=el.offsetLeft;top-=el.offsetTop;}
return{left:left,top:top};};me.preventDefaultException=function(el,exceptions){for(var i in exceptions){if(exceptions[i].test(el[i])){return true;}}
return false;};me.extend(me.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3});me.extend(me.ease={},{quadratic:{style:'cubic-bezier(0.25, 0.46, 0.45, 0.94)',fn:function(k){return k*(2-k);}},circular:{style:'cubic-bezier(0.1, 0.57, 0.1, 1)',fn:function(k){return Math.sqrt(1-(--k*k));}},back:{style:'cubic-bezier(0.175, 0.885, 0.32, 1.275)',fn:function(k){var b=4;return(k=k-1)*k*((b+1)*k+b)+1;}},bounce:{style:'',fn:function(k){if((k/=1)<(1/2.75)){return 7.5625*k*k;}else if(k<(2/2.75)){return 7.5625*(k-=(1.5/2.75))*k+0.75;}else if(k<(2.5/2.75)){return 7.5625*(k-=(2.25/2.75))*k+0.9375;}else{return 7.5625*(k-=(2.625/2.75))*k+0.984375;}}},elastic:{style:'',fn:function(k){var f=0.22,e=0.4;if(k===0){return 0;}
if(k==1){return 1;}
return(e*Math.pow(2,-10*k)*Math.sin((k-f/4)*(2*Math.PI)/f)+1);}}});me.tap=function(e,eventName){var ev=document.createEvent('Event');ev.initEvent(eventName,true,true);ev.pageX=e.pageX;ev.pageY=e.pageY;e.target.dispatchEvent(ev);};me.click=function(e){var target=e.target,ev;if(!(/(SELECT|INPUT|TEXTAREA)/i).test(target.tagName)){ev=document.createEvent(window.MouseEvent?'MouseEvents':'Event');ev.initEvent('click',true,true);ev.view=e.view||window;ev.detail=1;ev.screenX=target.screenX||0;ev.screenY=target.screenY||0;ev.clientX=target.clientX||0;ev.clientY=target.clientY||0;ev.ctrlKey=!!e.ctrlKey;ev.altKey=!!e.altKey;ev.shiftKey=!!e.shiftKey;ev.metaKey=!!e.metaKey;ev.button=0;ev.relatedTarget=null;ev._constructed=true;target.dispatchEvent(ev);}};me.getTouchAction=function(eventPassthrough,addPinch){var touchAction='none';if(eventPassthrough==='vertical'){touchAction='pan-y';}else if(eventPassthrough==='horizontal'){touchAction='pan-x';}
if(addPinch&&touchAction!='none'){touchAction+=' pinch-zoom';}
return touchAction;};me.getRect=function(el){if(el instanceof SVGElement){var rect=el.getBoundingClientRect();return{top:rect.top,left:rect.left,width:rect.width,height:rect.height};}else{return{top:el.offsetTop,left:el.offsetLeft,width:el.offsetWidth,height:el.offsetHeight};}};return me;})();function IScroll(el,options){this.wrapper=typeof el=='string'?document.querySelector(el):el;this.scroller=this.wrapper.children[0];this.scrollerStyle=this.scroller.style;this.options={resizeScrollbars:true,mouseWheelSpeed:20,snapThreshold:0.334,disablePointer:!utils.hasPointer,disableTouch:utils.hasPointer||!utils.hasTouch,disableMouse:utils.hasPointer||utils.hasTouch,startX:0,startY:0,scrollY:true,directionLockThreshold:5,momentum:true,bounce:true,bounceTime:600,bounceEasing:'',preventDefault:true,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:true,useTransition:true,useTransform:true,bindToWrapper:typeof window.onmousedown==="undefined"};for(var i in options){this.options[i]=options[i];}
this.translateZ=this.options.HWCompositing&&utils.hasPerspective?' translateZ(0)':'';this.options.useTransition=utils.hasTransition&&this.options.useTransition;this.options.useTransform=utils.hasTransform&&this.options.useTransform;this.options.eventPassthrough=this.options.eventPassthrough===true?'vertical':this.options.eventPassthrough;this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault;this.options.scrollY=this.options.eventPassthrough=='vertical'?false:this.options.scrollY;this.options.scrollX=this.options.eventPassthrough=='horizontal'?false:this.options.scrollX;this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough;this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold;this.options.bounceEasing=typeof this.options.bounceEasing=='string'?utils.ease[this.options.bounceEasing]||utils.ease.circular:this.options.bounceEasing;this.options.resizePolling=this.options.resizePolling===undefined?60:this.options.resizePolling;if(this.options.tap===true){this.options.tap='tap';}
if(!this.options.useTransition&&!this.options.useTransform){if(!(/relative|absolute/i).test(this.scrollerStyle.position)){this.scrollerStyle.position="relative";}}
if(this.options.shrinkScrollbars=='scale'){this.options.useTransition=false;}
this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1;if(this.options.probeType==3){this.options.useTransition=false;}
this.x=0;this.y=0;this.directionX=0;this.directionY=0;this._events={};this._init();this.refresh();this.scrollTo(this.options.startX,this.options.startY);this.enable();}
IScroll.prototype={version:'5.2.0-snapshot',_init:function(){this._initEvents();if(this.options.scrollbars||this.options.indicators){this._initIndicators();}
if(this.options.mouseWheel){this._initWheel();}
if(this.options.snap){this._initSnap();}
if(this.options.keyBindings){this._initKeys();}},destroy:function(){this._initEvents(true);clearTimeout(this.resizeTimeout);this.resizeTimeout=null;this._execEvent('destroy');},_transitionEnd:function(e){if(e.target!=this.scroller||!this.isInTransition){return;}
this._transitionTime();if(!this.resetPosition(this.options.bounceTime)){this.isInTransition=false;this._execEvent('scrollEnd');}},_start:function(e){if(utils.eventType[e.type]!=1){var button;if(!e.which){button=(e.button<2)?0:((e.button==4)?1:2);}else{button=e.button;}
if(button!==0){return;}}
if(!this.enabled||(this.initiated&&utils.eventType[e.type]!==this.initiated)){return;}
if(this.options.preventDefault&&!utils.isBadAndroid&&!utils.preventDefaultException(e.target,this.options.preventDefaultException)){e.preventDefault();}
var point=e.touches?e.touches[0]:e,pos;this.initiated=utils.eventType[e.type];this.moved=false;this.distX=0;this.distY=0;this.directionX=0;this.directionY=0;this.directionLocked=0;this.startTime=utils.getTime();if(this.options.useTransition&&this.isInTransition){this._transitionTime();this.isInTransition=false;pos=this.getComputedPosition();this._translate(Math.round(pos.x),Math.round(pos.y));this._execEvent('scrollEnd');}else if(!this.options.useTransition&&this.isAnimating){this.isAnimating=false;this._execEvent('scrollEnd');}
this.startX=this.x;this.startY=this.y;this.absStartX=this.x;this.absStartY=this.y;this.pointX=point.pageX;this.pointY=point.pageY;this._execEvent('beforeScrollStart');},_move:function(e){if(!this.enabled||utils.eventType[e.type]!==this.initiated){return;}
if(this.options.preventDefault){e.preventDefault();}
var point=e.touches?e.touches[0]:e,deltaX=point.pageX-this.pointX,deltaY=point.pageY-this.pointY,timestamp=utils.getTime(),newX,newY,absDistX,absDistY;this.pointX=point.pageX;this.pointY=point.pageY;this.distX+=deltaX;this.distY+=deltaY;absDistX=Math.abs(this.distX);absDistY=Math.abs(this.distY);if(timestamp-this.endTime>300&&(absDistX<10&&absDistY<10)){return;}
if(!this.directionLocked&&!this.options.freeScroll){if(absDistX>absDistY+this.options.directionLockThreshold){this.directionLocked='h';}else if(absDistY>=absDistX+this.options.directionLockThreshold){this.directionLocked='v';}else{this.directionLocked='n';}}
if(this.directionLocked=='h'){if(this.options.eventPassthrough=='vertical'){e.preventDefault();}else if(this.options.eventPassthrough=='horizontal'){this.initiated=false;return;}
deltaY=0;}else if(this.directionLocked=='v'){if(this.options.eventPassthrough=='horizontal'){e.preventDefault();}else if(this.options.eventPassthrough=='vertical'){this.initiated=false;return;}
deltaX=0;}
deltaX=this.hasHorizontalScroll?deltaX:0;deltaY=this.hasVerticalScroll?deltaY:0;newX=this.x+deltaX;newY=this.y+deltaY;if(newX>0||newX<this.maxScrollX){newX=this.options.bounce?this.x+deltaX/3:newX>0?0:this.maxScrollX;}
if(newY>0||newY<this.maxScrollY){newY=this.options.bounce?this.y+deltaY/3:newY>0?0:this.maxScrollY;}
this.directionX=deltaX>0?-1:deltaX<0?1:0;this.directionY=deltaY>0?-1:deltaY<0?1:0;if(!this.moved){this._execEvent('scrollStart');}
this.moved=true;this._translate(newX,newY);if(timestamp-this.startTime>300){this.startTime=timestamp;this.startX=this.x;this.startY=this.y;if(this.options.probeType==1){this._execEvent('scroll');}}
if(this.options.probeType>1){this._execEvent('scroll');}},_end:function(e){if(!this.enabled||utils.eventType[e.type]!==this.initiated){return;}
if(this.options.preventDefault&&!utils.preventDefaultException(e.target,this.options.preventDefaultException)){e.preventDefault();}
var point=e.changedTouches?e.changedTouches[0]:e,momentumX,momentumY,duration=utils.getTime()-this.startTime,newX=Math.round(this.x),newY=Math.round(this.y),distanceX=Math.abs(newX-this.startX),distanceY=Math.abs(newY-this.startY),time=0,easing='';this.isInTransition=0;this.initiated=0;this.endTime=utils.getTime();if(this.resetPosition(this.options.bounceTime)){return;}
this.scrollTo(newX,newY);if(!this.moved){if(this.options.tap){utils.tap(e,this.options.tap);}
if(this.options.click){utils.click(e);}
this._execEvent('scrollCancel');return;}
if(this._events.flick&&duration<200&&distanceX<100&&distanceY<100){this._execEvent('flick');return;}
if(this.options.momentum&&duration<300){momentumX=this.hasHorizontalScroll?utils.momentum(this.x,this.startX,duration,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:newX,duration:0};momentumY=this.hasVerticalScroll?utils.momentum(this.y,this.startY,duration,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:newY,duration:0};newX=momentumX.destination;newY=momentumY.destination;time=Math.max(momentumX.duration,momentumY.duration);this.isInTransition=1;}
if(this.options.snap){var snap=this._nearestSnap(newX,newY);this.currentPage=snap;time=this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(newX-snap.x),1000),Math.min(Math.abs(newY-snap.y),1000)),300);newX=snap.x;newY=snap.y;this.directionX=0;this.directionY=0;easing=this.options.bounceEasing;}
if(newX!=this.x||newY!=this.y){if(newX>0||newX<this.maxScrollX||newY>0||newY<this.maxScrollY){easing=utils.ease.quadratic;}
this.scrollTo(newX,newY,time,easing);return;}
this._execEvent('scrollEnd');},_resize:function(){var that=this;clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(function(){that.refresh();},this.options.resizePolling);},resetPosition:function(time){var x=this.x,y=this.y;time=time||0;if(!this.hasHorizontalScroll||this.x>0){x=0;}else if(this.x<this.maxScrollX){x=this.maxScrollX;}
if(!this.hasVerticalScroll||this.y>0){y=0;}else if(this.y<this.maxScrollY){y=this.maxScrollY;}
if(x==this.x&&y==this.y){return false;}
this.scrollTo(x,y,time,this.options.bounceEasing);return true;},disable:function(){this.enabled=false;},enable:function(){this.enabled=true;},refresh:function(){utils.getRect(this.wrapper);this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;var rect=utils.getRect(this.scroller);this.scrollerWidth=rect.width;this.scrollerHeight=rect.height;this.maxScrollX=this.wrapperWidth-this.scrollerWidth;this.maxScrollY=this.wrapperHeight-this.scrollerHeight;this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0;this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0;if(!this.hasHorizontalScroll){this.maxScrollX=0;this.scrollerWidth=this.wrapperWidth;}
if(!this.hasVerticalScroll){this.maxScrollY=0;this.scrollerHeight=this.wrapperHeight;}
this.endTime=0;this.directionX=0;this.directionY=0;if(utils.hasPointer&&!this.options.disablePointer){this.wrapper.style[utils.style.touchAction]=utils.getTouchAction(this.options.eventPassthrough,true);if(!this.wrapper.style[utils.style.touchAction]){this.wrapper.style[utils.style.touchAction]=utils.getTouchAction(this.options.eventPassthrough,false);}}
this.wrapperOffset=utils.offset(this.wrapper);this._execEvent('refresh');this.resetPosition();},on:function(type,fn){if(!this._events[type]){this._events[type]=[];}
this._events[type].push(fn);},off:function(type,fn){if(!this._events[type]){return;}
var index=this._events[type].indexOf(fn);if(index>-1){this._events[type].splice(index,1);}},_execEvent:function(type){if(!this._events[type]){return;}
var i=0,l=this._events[type].length;if(!l){return;}
for(;i<l;i++){this._events[type][i].apply(this,[].slice.call(arguments,1));}},scrollBy:function(x,y,time,easing){x=this.x+x;y=this.y+y;time=time||0;this.scrollTo(x,y,time,easing);},scrollTo:function(x,y,time,easing){easing=easing||utils.ease.circular;this.isInTransition=this.options.useTransition&&time>0;var transitionType=this.options.useTransition&&easing.style;if(!time||transitionType){if(transitionType){this._transitionTimingFunction(easing.style);this._transitionTime(time);}
this._translate(x,y);}else{this._animate(x,y,time,easing.fn);}},scrollToElement:function(el,time,offsetX,offsetY,easing){el=el.nodeType?el:this.scroller.querySelector(el);if(!el){return;}
var pos=utils.offset(el);pos.left-=this.wrapperOffset.left;pos.top-=this.wrapperOffset.top;var elRect=utils.getRect(el);var wrapperRect=utils.getRect(this.wrapper);if(offsetX===true){offsetX=Math.round(elRect.width/2-wrapperRect.width/2);}
if(offsetY===true){offsetY=Math.round(elRect.height/2-wrapperRect.height/2);}
pos.left-=offsetX||0;pos.top-=offsetY||0;pos.left=pos.left>0?0:pos.left<this.maxScrollX?this.maxScrollX:pos.left;pos.top=pos.top>0?0:pos.top<this.maxScrollY?this.maxScrollY:pos.top;time=time===undefined||time===null||time==='auto'?Math.max(Math.abs(this.x-pos.left),Math.abs(this.y-pos.top)):time;this.scrollTo(pos.left,pos.top,time,easing);},_transitionTime:function(time){if(!this.options.useTransition){return;}
time=time||0;var durationProp=utils.style.transitionDuration;if(!durationProp){return;}
this.scrollerStyle[durationProp]=time+'ms';if(!time&&utils.isBadAndroid){this.scrollerStyle[durationProp]='0.0001ms';var self=this;rAF(function(){if(self.scrollerStyle[durationProp]==='0.0001ms'){self.scrollerStyle[durationProp]='0s';}});}
if(this.indicators){for(var i=this.indicators.length;i--;){this.indicators[i].transitionTime(time);}}},_transitionTimingFunction:function(easing){this.scrollerStyle[utils.style.transitionTimingFunction]=easing;if(this.indicators){for(var i=this.indicators.length;i--;){this.indicators[i].transitionTimingFunction(easing);}}},_translate:function(x,y){if(this.options.useTransform){this.scrollerStyle[utils.style.transform]='translate('+x+'px,'+y+'px)'+this.translateZ;}else{x=Math.round(x);y=Math.round(y);this.scrollerStyle.left=x+'px';this.scrollerStyle.top=y+'px';}
this.x=x;this.y=y;if(this.indicators){for(var i=this.indicators.length;i--;){this.indicators[i].updatePosition();}}},_initEvents:function(remove){var eventType=remove?utils.removeEvent:utils.addEvent,target=this.options.bindToWrapper?this.wrapper:window;eventType(window,'orientationchange',this);eventType(window,'resize',this);if(this.options.click){eventType(this.wrapper,'click',this,true);}
if(!this.options.disableMouse){eventType(this.wrapper,'mousedown',this);eventType(target,'mousemove',this);eventType(target,'mousecancel',this);eventType(target,'mouseup',this);}
if(utils.hasPointer&&!this.options.disablePointer){eventType(this.wrapper,utils.prefixPointerEvent('pointerdown'),this);eventType(target,utils.prefixPointerEvent('pointermove'),this);eventType(target,utils.prefixPointerEvent('pointercancel'),this);eventType(target,utils.prefixPointerEvent('pointerup'),this);}
if(utils.hasTouch&&!this.options.disableTouch){eventType(this.wrapper,'touchstart',this);eventType(target,'touchmove',this);eventType(target,'touchcancel',this);eventType(target,'touchend',this);}
eventType(this.scroller,'transitionend',this);eventType(this.scroller,'webkitTransitionEnd',this);eventType(this.scroller,'oTransitionEnd',this);eventType(this.scroller,'MSTransitionEnd',this);},getComputedPosition:function(){var matrix=window.getComputedStyle(this.scroller,null),x,y;if(this.options.useTransform){matrix=matrix[utils.style.transform].split(')')[0].split(', ');x=+(matrix[12]||matrix[4]);y=+(matrix[13]||matrix[5]);}else{x=+matrix.left.replace(/[^-\d.]/g,'');y=+matrix.top.replace(/[^-\d.]/g,'');}
return{x:x,y:y};},_initIndicators:function(){var interactive=this.options.interactiveScrollbars,customStyle=typeof this.options.scrollbars!='string',indicators=[],indicator;var that=this;this.indicators=[];if(this.options.scrollbars){if(this.options.scrollY){indicator={el:createDefaultScrollbar('v',interactive,this.options.scrollbars),interactive:interactive,defaultScrollbars:true,customStyle:customStyle,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:false};this.wrapper.appendChild(indicator.el);indicators.push(indicator);}
if(this.options.scrollX){indicator={el:createDefaultScrollbar('h',interactive,this.options.scrollbars),interactive:interactive,defaultScrollbars:true,customStyle:customStyle,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:false};this.wrapper.appendChild(indicator.el);indicators.push(indicator);}}
if(this.options.indicators){indicators=indicators.concat(this.options.indicators);}
for(var i=indicators.length;i--;){this.indicators.push(new Indicator(this,indicators[i]));}
function _indicatorsMap(fn){if(that.indicators){for(var i=that.indicators.length;i--;){fn.call(that.indicators[i]);}}}
if(this.options.fadeScrollbars){this.on('scrollEnd',function(){_indicatorsMap(function(){this.fade();});});this.on('scrollCancel',function(){_indicatorsMap(function(){this.fade();});});this.on('scrollStart',function(){_indicatorsMap(function(){this.fade(1);});});this.on('beforeScrollStart',function(){_indicatorsMap(function(){this.fade(1,true);});});}
this.on('refresh',function(){_indicatorsMap(function(){this.refresh();});});this.on('destroy',function(){_indicatorsMap(function(){this.destroy();});delete this.indicators;});},_initWheel:function(){utils.addEvent(this.wrapper,'wheel',this);utils.addEvent(this.wrapper,'mousewheel',this);utils.addEvent(this.wrapper,'DOMMouseScroll',this);this.on('destroy',function(){clearTimeout(this.wheelTimeout);this.wheelTimeout=null;utils.removeEvent(this.wrapper,'wheel',this);utils.removeEvent(this.wrapper,'mousewheel',this);utils.removeEvent(this.wrapper,'DOMMouseScroll',this);});},_wheel:function(e){if(!this.enabled){return;}
e.preventDefault();var wheelDeltaX,wheelDeltaY,newX,newY,that=this;if(this.wheelTimeout===undefined){that._execEvent('scrollStart');}
clearTimeout(this.wheelTimeout);this.wheelTimeout=setTimeout(function(){if(!that.options.snap){that._execEvent('scrollEnd');}
that.wheelTimeout=undefined;},400);if('deltaX'in e){if(e.deltaMode===1){wheelDeltaX=-e.deltaX*this.options.mouseWheelSpeed;wheelDeltaY=-e.deltaY*this.options.mouseWheelSpeed;}else{wheelDeltaX=-e.deltaX;wheelDeltaY=-e.deltaY;}}else if('wheelDeltaX'in e){wheelDeltaX=e.wheelDeltaX/120*this.options.mouseWheelSpeed;wheelDeltaY=e.wheelDeltaY/120*this.options.mouseWheelSpeed;}else if('wheelDelta'in e){wheelDeltaX=wheelDeltaY=e.wheelDelta/120*this.options.mouseWheelSpeed;}else if('detail'in e){wheelDeltaX=wheelDeltaY=-e.detail/3*this.options.mouseWheelSpeed;}else{return;}
wheelDeltaX*=this.options.invertWheelDirection;wheelDeltaY*=this.options.invertWheelDirection;if(!this.hasVerticalScroll){wheelDeltaX=wheelDeltaY;wheelDeltaY=0;}
if(this.options.snap){newX=this.currentPage.pageX;newY=this.currentPage.pageY;if(wheelDeltaX>0){newX--;}else if(wheelDeltaX<0){newX++;}
if(wheelDeltaY>0){newY--;}else if(wheelDeltaY<0){newY++;}
this.goToPage(newX,newY);return;}
newX=this.x+Math.round(this.hasHorizontalScroll?wheelDeltaX:0);newY=this.y+Math.round(this.hasVerticalScroll?wheelDeltaY:0);this.directionX=wheelDeltaX>0?-1:wheelDeltaX<0?1:0;this.directionY=wheelDeltaY>0?-1:wheelDeltaY<0?1:0;if(newX>0){newX=0;}else if(newX<this.maxScrollX){newX=this.maxScrollX;}
if(newY>0){newY=0;}else if(newY<this.maxScrollY){newY=this.maxScrollY;}
this.scrollTo(newX,newY,0);if(this.options.probeType>1){this._execEvent('scroll');}},_initSnap:function(){this.currentPage={};if(typeof this.options.snap=='string'){this.options.snap=this.scroller.querySelectorAll(this.options.snap);}
this.on('refresh',function(){var i=0,l,m=0,n,cx,cy,x=0,y,stepX=this.options.snapStepX||this.wrapperWidth,stepY=this.options.snapStepY||this.wrapperHeight,el,rect;this.pages=[];if(!this.wrapperWidth||!this.wrapperHeight||!this.scrollerWidth||!this.scrollerHeight){return;}
if(this.options.snap===true){cx=Math.round(stepX/2);cy=Math.round(stepY/2);while(x>-this.scrollerWidth){this.pages[i]=[];l=0;y=0;while(y>-this.scrollerHeight){this.pages[i][l]={x:Math.max(x,this.maxScrollX),y:Math.max(y,this.maxScrollY),width:stepX,height:stepY,cx:x-cx,cy:y-cy};y-=stepY;l++;}
x-=stepX;i++;}}else{el=this.options.snap;l=el.length;n=-1;for(;i<l;i++){rect=utils.getRect(el[i]);if(i===0||rect.left<=utils.getRect(el[i-1]).left){m=0;n++;}
if(!this.pages[m]){this.pages[m]=[];}
x=Math.max(-rect.left,this.maxScrollX);y=Math.max(-rect.top,this.maxScrollY);cx=x-Math.round(rect.width/2);cy=y-Math.round(rect.height/2);this.pages[m][n]={x:x,y:y,width:rect.width,height:rect.height,cx:cx,cy:cy};if(x>this.maxScrollX){m++;}}}
this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0);if(this.options.snapThreshold%1===0){this.snapThresholdX=this.options.snapThreshold;this.snapThresholdY=this.options.snapThreshold;}else{this.snapThresholdX=Math.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold);this.snapThresholdY=Math.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold);}});this.on('flick',function(){var time=this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(this.x-this.startX),1000),Math.min(Math.abs(this.y-this.startY),1000)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,time);});},_nearestSnap:function(x,y){if(!this.pages.length){return{x:0,y:0,pageX:0,pageY:0};}
var i=0,l=this.pages.length,m=0;if(Math.abs(x-this.absStartX)<this.snapThresholdX&&Math.abs(y-this.absStartY)<this.snapThresholdY){return this.currentPage;}
if(x>0){x=0;}else if(x<this.maxScrollX){x=this.maxScrollX;}
if(y>0){y=0;}else if(y<this.maxScrollY){y=this.maxScrollY;}
for(;i<l;i++){if(x>=this.pages[i][0].cx){x=this.pages[i][0].x;break;}}
l=this.pages[i].length;for(;m<l;m++){if(y>=this.pages[0][m].cy){y=this.pages[0][m].y;break;}}
if(i==this.currentPage.pageX){i+=this.directionX;if(i<0){i=0;}else if(i>=this.pages.length){i=this.pages.length-1;}
x=this.pages[i][0].x;}
if(m==this.currentPage.pageY){m+=this.directionY;if(m<0){m=0;}else if(m>=this.pages[0].length){m=this.pages[0].length-1;}
y=this.pages[0][m].y;}
return{x:x,y:y,pageX:i,pageY:m};},goToPage:function(x,y,time,easing){easing=easing||this.options.bounceEasing;if(x>=this.pages.length){x=this.pages.length-1;}else if(x<0){x=0;}
if(y>=this.pages[x].length){y=this.pages[x].length-1;}else if(y<0){y=0;}
var posX=this.pages[x][y].x,posY=this.pages[x][y].y;time=time===undefined?this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(posX-this.x),1000),Math.min(Math.abs(posY-this.y),1000)),300):time;this.currentPage={x:posX,y:posY,pageX:x,pageY:y};this.scrollTo(posX,posY,time,easing);},next:function(time,easing){var x=this.currentPage.pageX,y=this.currentPage.pageY;x++;if(x>=this.pages.length&&this.hasVerticalScroll){x=0;y++;}
this.goToPage(x,y,time,easing);},prev:function(time,easing){var x=this.currentPage.pageX,y=this.currentPage.pageY;x--;if(x<0&&this.hasVerticalScroll){x=0;y--;}
this.goToPage(x,y,time,easing);},_initKeys:function(e){var keys={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};var i;if(typeof this.options.keyBindings=='object'){for(i in this.options.keyBindings){if(typeof this.options.keyBindings[i]=='string'){this.options.keyBindings[i]=this.options.keyBindings[i].toUpperCase().charCodeAt(0);}}}else{this.options.keyBindings={};}
for(i in keys){this.options.keyBindings[i]=this.options.keyBindings[i]||keys[i];}
utils.addEvent(window,'keydown',this);this.on('destroy',function(){utils.removeEvent(window,'keydown',this);});},_key:function(e){if(!this.enabled){return;}
var snap=this.options.snap,newX=snap?this.currentPage.pageX:this.x,newY=snap?this.currentPage.pageY:this.y,now=utils.getTime(),prevTime=this.keyTime||0,acceleration=0.250,pos;if(this.options.useTransition&&this.isInTransition){pos=this.getComputedPosition();this._translate(Math.round(pos.x),Math.round(pos.y));this.isInTransition=false;}
this.keyAcceleration=now-prevTime<200?Math.min(this.keyAcceleration+acceleration,50):0;switch(e.keyCode){case this.options.keyBindings.pageUp:if(this.hasHorizontalScroll&&!this.hasVerticalScroll){newX+=snap?1:this.wrapperWidth;}else{newY+=snap?1:this.wrapperHeight;}
break;case this.options.keyBindings.pageDown:if(this.hasHorizontalScroll&&!this.hasVerticalScroll){newX-=snap?1:this.wrapperWidth;}else{newY-=snap?1:this.wrapperHeight;}
break;case this.options.keyBindings.end:newX=snap?this.pages.length-1:this.maxScrollX;newY=snap?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:newX=0;newY=0;break;case this.options.keyBindings.left:newX+=snap?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:newY+=snap?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:newX-=snap?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:newY-=snap?1:5+this.keyAcceleration>>0;break;default:return;}
if(snap){this.goToPage(newX,newY);return;}
if(newX>0){newX=0;this.keyAcceleration=0;}else if(newX<this.maxScrollX){newX=this.maxScrollX;this.keyAcceleration=0;}
if(newY>0){newY=0;this.keyAcceleration=0;}else if(newY<this.maxScrollY){newY=this.maxScrollY;this.keyAcceleration=0;}
this.scrollTo(newX,newY,0);this.keyTime=now;},_animate:function(destX,destY,duration,easingFn){var that=this,startX=this.x,startY=this.y,startTime=utils.getTime(),destTime=startTime+duration;function step(){var now=utils.getTime(),newX,newY,easing;if(now>=destTime){that.isAnimating=false;that._translate(destX,destY);if(!that.resetPosition(that.options.bounceTime)){that._execEvent('scrollEnd');}
return;}
now=(now-startTime)/duration;easing=easingFn(now);newX=(destX-startX)*easing+startX;newY=(destY-startY)*easing+startY;that._translate(newX,newY);if(that.isAnimating){rAF(step);}
if(that.options.probeType==3){that._execEvent('scroll');}}
this.isAnimating=true;step();},handleEvent:function(e){switch(e.type){case'touchstart':case'pointerdown':case'MSPointerDown':case'mousedown':this._start(e);break;case'touchmove':case'pointermove':case'MSPointerMove':case'mousemove':this._move(e);break;case'touchend':case'pointerup':case'MSPointerUp':case'mouseup':case'touchcancel':case'pointercancel':case'MSPointerCancel':case'mousecancel':this._end(e);break;case'orientationchange':case'resize':this._resize();break;case'transitionend':case'webkitTransitionEnd':case'oTransitionEnd':case'MSTransitionEnd':this._transitionEnd(e);break;case'wheel':case'DOMMouseScroll':case'mousewheel':this._wheel(e);break;case'keydown':this._key(e);break;case'click':if(this.enabled&&!e._constructed){e.preventDefault();e.stopPropagation();}
break;}}};function createDefaultScrollbar(direction,interactive,type){var scrollbar=document.createElement('div'),indicator=document.createElement('div');if(type===true){scrollbar.style.cssText='position:absolute;z-index:9999';indicator.style.cssText='-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px';}
indicator.className='iScrollIndicator';if(direction=='h'){if(type===true){scrollbar.style.cssText+=';height:7px;left:2px;right:2px;bottom:0';indicator.style.height='100%';}
scrollbar.className='iScrollHorizontalScrollbar';}else{if(type===true){scrollbar.style.cssText+=';width:7px;bottom:2px;top:2px;right:1px';indicator.style.width='100%';}
scrollbar.className='iScrollVerticalScrollbar';}
scrollbar.style.cssText+=';overflow:hidden';if(!interactive){scrollbar.style.pointerEvents='none';}
scrollbar.appendChild(indicator);return scrollbar;}
function Indicator(scroller,options){this.wrapper=typeof options.el=='string'?document.querySelector(options.el):options.el;this.wrapperStyle=this.wrapper.style;this.indicator=this.wrapper.children[0];this.indicatorStyle=this.indicator.style;this.scroller=scroller;this.options={listenX:true,listenY:true,interactive:false,resize:true,defaultScrollbars:false,shrink:false,fade:false,speedRatioX:0,speedRatioY:0};for(var i in options){this.options[i]=options[i];}
this.sizeRatioX=1;this.sizeRatioY=1;this.maxPosX=0;this.maxPosY=0;if(this.options.interactive){if(!this.options.disableTouch){utils.addEvent(this.indicator,'touchstart',this);utils.addEvent(window,'touchend',this);}
if(!this.options.disablePointer){utils.addEvent(this.indicator,utils.prefixPointerEvent('pointerdown'),this);utils.addEvent(window,utils.prefixPointerEvent('pointerup'),this);}
if(!this.options.disableMouse){utils.addEvent(this.indicator,'mousedown',this);utils.addEvent(window,'mouseup',this);}}
if(this.options.fade){this.wrapperStyle[utils.style.transform]=this.scroller.translateZ;var durationProp=utils.style.transitionDuration;if(!durationProp){return;}
this.wrapperStyle[durationProp]=utils.isBadAndroid?'0.0001ms':'0ms';var self=this;if(utils.isBadAndroid){rAF(function(){if(self.wrapperStyle[durationProp]==='0.0001ms'){self.wrapperStyle[durationProp]='0s';}});}
this.wrapperStyle.opacity='0';}}
Indicator.prototype={handleEvent:function(e){switch(e.type){case'touchstart':case'pointerdown':case'MSPointerDown':case'mousedown':this._start(e);break;case'touchmove':case'pointermove':case'MSPointerMove':case'mousemove':this._move(e);break;case'touchend':case'pointerup':case'MSPointerUp':case'mouseup':case'touchcancel':case'pointercancel':case'MSPointerCancel':case'mousecancel':this._end(e);break;}},destroy:function(){if(this.options.fadeScrollbars){clearTimeout(this.fadeTimeout);this.fadeTimeout=null;}
if(this.options.interactive){utils.removeEvent(this.indicator,'touchstart',this);utils.removeEvent(this.indicator,utils.prefixPointerEvent('pointerdown'),this);utils.removeEvent(this.indicator,'mousedown',this);utils.removeEvent(window,'touchmove',this);utils.removeEvent(window,utils.prefixPointerEvent('pointermove'),this);utils.removeEvent(window,'mousemove',this);utils.removeEvent(window,'touchend',this);utils.removeEvent(window,utils.prefixPointerEvent('pointerup'),this);utils.removeEvent(window,'mouseup',this);}
if(this.options.defaultScrollbars&&this.wrapper.parentNode){this.wrapper.parentNode.removeChild(this.wrapper);}},_start:function(e){var point=e.touches?e.touches[0]:e;e.preventDefault();e.stopPropagation();this.transitionTime();this.initiated=true;this.moved=false;this.lastPointX=point.pageX;this.lastPointY=point.pageY;this.startTime=utils.getTime();if(!this.options.disableTouch){utils.addEvent(window,'touchmove',this);}
if(!this.options.disablePointer){utils.addEvent(window,utils.prefixPointerEvent('pointermove'),this);}
if(!this.options.disableMouse){utils.addEvent(window,'mousemove',this);}
this.scroller._execEvent('beforeScrollStart');},_move:function(e){var point=e.touches?e.touches[0]:e,deltaX,deltaY,newX,newY,timestamp=utils.getTime();if(!this.moved){this.scroller._execEvent('scrollStart');}
this.moved=true;deltaX=point.pageX-this.lastPointX;this.lastPointX=point.pageX;deltaY=point.pageY-this.lastPointY;this.lastPointY=point.pageY;newX=this.x+deltaX;newY=this.y+deltaY;this._pos(newX,newY);if(this.scroller.options.probeType==1&&timestamp-this.startTime>300){this.startTime=timestamp;this.scroller._execEvent('scroll');}else if(this.scroller.options.probeType>1){this.scroller._execEvent('scroll');}
e.preventDefault();e.stopPropagation();},_end:function(e){if(!this.initiated){return;}
this.initiated=false;e.preventDefault();e.stopPropagation();utils.removeEvent(window,'touchmove',this);utils.removeEvent(window,utils.prefixPointerEvent('pointermove'),this);utils.removeEvent(window,'mousemove',this);if(this.scroller.options.snap){var snap=this.scroller._nearestSnap(this.scroller.x,this.scroller.y);var time=this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(this.scroller.x-snap.x),1000),Math.min(Math.abs(this.scroller.y-snap.y),1000)),300);if(this.scroller.x!=snap.x||this.scroller.y!=snap.y){this.scroller.directionX=0;this.scroller.directionY=0;this.scroller.currentPage=snap;this.scroller.scrollTo(snap.x,snap.y,time,this.scroller.options.bounceEasing);}}
if(this.moved){this.scroller._execEvent('scrollEnd');}},transitionTime:function(time){time=time||0;var durationProp=utils.style.transitionDuration;if(!durationProp){return;}
this.indicatorStyle[durationProp]=time+'ms';if(!time&&utils.isBadAndroid){this.indicatorStyle[durationProp]='0.0001ms';var self=this;rAF(function(){if(self.indicatorStyle[durationProp]==='0.0001ms'){self.indicatorStyle[durationProp]='0s';}});}},transitionTimingFunction:function(easing){this.indicatorStyle[utils.style.transitionTimingFunction]=easing;},refresh:function(){this.transitionTime();if(this.options.listenX&&!this.options.listenY){this.indicatorStyle.display=this.scroller.hasHorizontalScroll?'block':'none';}else if(this.options.listenY&&!this.options.listenX){this.indicatorStyle.display=this.scroller.hasVerticalScroll?'block':'none';}else{this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?'block':'none';}
if(this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll){utils.addClass(this.wrapper,'iScrollBothScrollbars');utils.removeClass(this.wrapper,'iScrollLoneScrollbar');if(this.options.defaultScrollbars&&this.options.customStyle){if(this.options.listenX){this.wrapper.style.right='8px';}else{this.wrapper.style.bottom='8px';}}}else{utils.removeClass(this.wrapper,'iScrollBothScrollbars');utils.addClass(this.wrapper,'iScrollLoneScrollbar');if(this.options.defaultScrollbars&&this.options.customStyle){if(this.options.listenX){this.wrapper.style.right='2px';}else{this.wrapper.style.bottom='2px';}}}
utils.getRect(this.wrapper);if(this.options.listenX){this.wrapperWidth=this.wrapper.clientWidth;if(this.options.resize){this.indicatorWidth=Math.max(Math.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8);this.indicatorStyle.width=this.indicatorWidth+'px';}else{this.indicatorWidth=this.indicator.clientWidth;}
this.maxPosX=this.wrapperWidth-this.indicatorWidth;if(this.options.shrink=='clip'){this.minBoundaryX=-this.indicatorWidth+8;this.maxBoundaryX=this.wrapperWidth-8;}else{this.minBoundaryX=0;this.maxBoundaryX=this.maxPosX;}
this.sizeRatioX=this.options.speedRatioX||(this.scroller.maxScrollX&&(this.maxPosX/this.scroller.maxScrollX));}
if(this.options.listenY){this.wrapperHeight=this.wrapper.clientHeight;if(this.options.resize){this.indicatorHeight=Math.max(Math.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8);this.indicatorStyle.height=this.indicatorHeight+'px';}else{this.indicatorHeight=this.indicator.clientHeight;}
this.maxPosY=this.wrapperHeight-this.indicatorHeight;if(this.options.shrink=='clip'){this.minBoundaryY=-this.indicatorHeight+8;this.maxBoundaryY=this.wrapperHeight-8;}else{this.minBoundaryY=0;this.maxBoundaryY=this.maxPosY;}
this.maxPosY=this.wrapperHeight-this.indicatorHeight;this.sizeRatioY=this.options.speedRatioY||(this.scroller.maxScrollY&&(this.maxPosY/this.scroller.maxScrollY));}
this.updatePosition();},updatePosition:function(){var x=this.options.listenX&&Math.round(this.sizeRatioX*this.scroller.x)||0,y=this.options.listenY&&Math.round(this.sizeRatioY*this.scroller.y)||0;if(!this.options.ignoreBoundaries){if(x<this.minBoundaryX){if(this.options.shrink=='scale'){this.width=Math.max(this.indicatorWidth+x,8);this.indicatorStyle.width=this.width+'px';}
x=this.minBoundaryX;}else if(x>this.maxBoundaryX){if(this.options.shrink=='scale'){this.width=Math.max(this.indicatorWidth-(x-this.maxPosX),8);this.indicatorStyle.width=this.width+'px';x=this.maxPosX+this.indicatorWidth-this.width;}else{x=this.maxBoundaryX;}}else if(this.options.shrink=='scale'&&this.width!=this.indicatorWidth){this.width=this.indicatorWidth;this.indicatorStyle.width=this.width+'px';}
if(y<this.minBoundaryY){if(this.options.shrink=='scale'){this.height=Math.max(this.indicatorHeight+y*3,8);this.indicatorStyle.height=this.height+'px';}
y=this.minBoundaryY;}else if(y>this.maxBoundaryY){if(this.options.shrink=='scale'){this.height=Math.max(this.indicatorHeight-(y-this.maxPosY)*3,8);this.indicatorStyle.height=this.height+'px';y=this.maxPosY+this.indicatorHeight-this.height;}else{y=this.maxBoundaryY;}}else if(this.options.shrink=='scale'&&this.height!=this.indicatorHeight){this.height=this.indicatorHeight;this.indicatorStyle.height=this.height+'px';}}
this.x=x;this.y=y;if(this.scroller.options.useTransform){this.indicatorStyle[utils.style.transform]='translate('+x+'px,'+y+'px)'+this.scroller.translateZ;}else{this.indicatorStyle.left=x+'px';this.indicatorStyle.top=y+'px';}},_pos:function(x,y){if(x<0){x=0;}else if(x>this.maxPosX){x=this.maxPosX;}
if(y<0){y=0;}else if(y>this.maxPosY){y=this.maxPosY;}
x=this.options.listenX?Math.round(x/this.sizeRatioX):this.scroller.x;y=this.options.listenY?Math.round(y/this.sizeRatioY):this.scroller.y;this.scroller.scrollTo(x,y);},fade:function(val,hold){if(hold&&!this.visible){return;}
clearTimeout(this.fadeTimeout);this.fadeTimeout=null;var time=val?250:500,delay=val?0:300;val=val?'1':'0';this.wrapperStyle[utils.style.transitionDuration]=time+'ms';this.fadeTimeout=setTimeout((function(val){this.wrapperStyle.opacity=val;this.visible=+val;}).bind(this,val),delay);}};IScroll.utils=utils;if(typeof module!='undefined'&&module.exports){module.exports=IScroll;}else if(typeof define=='function'&&define.amd){define(function(){return IScroll;});}else{window.IScroll=IScroll;}})(window,document,Math);;

/* /web_responsive/static/lib/js/drawer.3.2.2.js defined in bundle 'web.assets_backend' */
;(function umd(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'){module.exports=factory(require('jquery'));}else{factory(jQuery);}}(function Drawer($){'use strict';var namespace='drawer';var touches=typeof document.ontouchstart!='undefined';var __={init:function init(options){options=$.extend({iscroll:{mouseWheel:true,preventDefault:false},showOverlay:true},options);__.settings={state:false,events:{opened:'drawer.opened',closed:'drawer.closed'},dropdownEvents:{opened:'shown.bs.dropdown',closed:'hidden.bs.dropdown'}};__.settings.class=$.extend({nav:'drawer-nav',toggle:'drawer-toggle',overlay:'drawer-overlay',open:'drawer-open',close:'drawer-close',dropdown:'drawer-dropdown'},options.class);return this.each(function instantiateDrawer(){var _this=this;var $this=$(this);var data=$this.data(namespace);if(!data){options=$.extend({},options);$this.data(namespace,{options:options});__.refresh.call(_this);if(options.showOverlay){__.addOverlay.call(_this);}
$('.'+__.settings.class.toggle).on('click.'+namespace,function toggle(){__.toggle.call(_this);return _this.iScroll.refresh();});$(window).resize(function close(){__.close.call(_this);return _this.iScroll.refresh();});$('.'+__.settings.class.dropdown).on(__.settings.dropdownEvents.opened+' '+__.settings.dropdownEvents.closed,function onOpenedOrClosed(){return _this.iScroll.refresh();});}});},refresh:function refresh(){this.iScroll=new IScroll('.'+__.settings.class.nav,$(this).data(namespace).options.iscroll);},addOverlay:function addOverlay(){var _this=this;var $this=$(this);var $overlay=$('<div>').addClass(__.settings.class.overlay+' '+__.settings.class.toggle);return $this.append($overlay);},toggle:function toggle(){var _this=this;if(__.settings.state){return __.close.call(_this);}else{return __.open.call(_this);}},open:function open(){var $this=$(this);if(touches){$this.on('touchmove.'+namespace,function disableTouch(event){event.preventDefault();});}
return $this.removeClass(__.settings.class.close).addClass(__.settings.class.open).drawerCallback(function triggerOpenedListeners(){__.settings.state=true;$this.trigger(__.settings.events.opened);});},close:function close(){var $this=$(this);if(touches)$this.off('touchmove.'+namespace);return $this.removeClass(__.settings.class.open).addClass(__.settings.class.close).drawerCallback(function triggerClosedListeners(){__.settings.state=false;$this.trigger(__.settings.events.closed);});},destroy:function destroy(){return this.each(function destroyEach(){var $this=$(this);$(window).off('.'+namespace);$this.removeData(namespace);});}};$.fn.drawerCallback=function drawerCallback(callback){var end='transitionend webkitTransitionEnd';return this.each(function setAnimationEndHandler(){var $this=$(this);$this.on(end,function invokeCallbackOnAnimationEnd(){$this.off(end);return callback.call(this);});});};$.fn.drawer=function drawer(method){if(__[method]){return __[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return __.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.'+namespace);}};}));;

/* /web_responsive/static/src/js/web_responsive.js defined in bundle 'web.assets_backend' */
odoo.define('web_responsive',function(require){'use strict';var Menu=require('web.Menu');var Class=require('web.Class');var DataModel=require('web.DataModel');var SearchView=require('web.SearchView');var core=require('web.core');var config=require('web.config');var FieldOne2Many=core.form_widget_registry.get('one2many');var ViewManager=require('web.ViewManager');Menu.include({reflow:function(){this._super('all_outside');},open_menu:function(id,allowOpen){this._super(id);if(allowOpen)return;var $clicked_menu=this.$secondary_menus.find('a[data-menu='+id+']');$clicked_menu.parents('.oe_secondary_submenu').css('display','');},});SearchView.include({toggle_visibility:function(is_visible){$('div.oe_searchview_input').last().one('focus',$.proxy(this.preventMobileFocus,this));return this._super(is_visible);},preventMobileFocus:function(event){if(this.isMobile()){event.preventDefault();}},isMobile:function(){try{document.createEvent('TouchEvent');return true;}catch(ex){return false;}},});var AppDrawer=Class.extend({LEFT:'left',RIGHT:'right',UP:'up',DOWN:'down',MODIFIERS:['Alt','ArrowDown','ArrowLeft','ArrowRight','ArrowUp','Control','Enter','Escape','Meta','Shift','Tab',],isOpen:false,keyBuffer:'',keyBufferTime:500,keyBufferTimeoutEvent:false,dropdownHeightFactor:0.90,initialized:false,searching:false,init:function(){this.directionCodes={'left':this.LEFT,'right':this.RIGHT,'up':this.UP,'pageup':this.UP,'down':this.DOWN,'pagedown':this.DOWN,'+':this.RIGHT,'-':this.LEFT,};this.$searchAction=$('.app-drawer-search-action');this.$searchAction.hide();this.$searchResultsContainer=$('#appDrawerSearchResults');this.$searchInput=$('#appDrawerSearchInput');this.initDrawer();this.handleWindowResize();var $clickZones=$('.odoo_webclient_container, '+'a.oe_menu_leaf, '+'a.oe_menu_toggler, '+'a.oe_logo, '+'i.oe_logo_edit');$clickZones.click($.proxy(this.handleClickZones,this));this.$searchResultsContainer.click($.proxy(this.searchMenus,this));this.$el.find('.drawer-search-open').click($.proxy(this.searchMenus,this));this.$el.find('.drawer-search-close').hide().click($.proxy(this.closeSearchMenus,this));core.bus.on('resize',this,this.handleWindowResize);core.bus.on('keydown',this,this.handleKeyDown);core.bus.on('keyup',this,this.redirectKeyPresses);core.bus.on('keypress',this,this.redirectKeyPresses);},initDrawer:function(){this.$el=$('.drawer');this.$el.drawer();this.$el.one('drawer.opened',$.proxy(this.onDrawerOpen,this));this.$el.on('drawer.opened',function setIScrollProbes(){var onIScroll=$.proxy(function(){this.iScroll.refresh();},this);this.iScroll.options.probeType=2;this.iScroll.on('scroll',onIScroll);this.iScroll.options.scrollbars=true;this.iScroll.options.fadeScrollbars=true;this.iScroll._initIndicators();});this.initialized=true;},handleClickZones:function(){this.$el.drawer('close');$('.o_sub_menu_content').parent().collapse('hide');$('.navbar-collapse').collapse('hide');},handleWindowResize:function(){$('.dropdown-scrollable').css('max-height',$(window).height()*this.dropdownHeightFactor);},handleKeyDown:function(e){if(!this.isOpen){return;}
var directionCode=$.hotkeys.specialKeys[e.keyCode.toString()];if(Object.keys(this.directionCodes).indexOf(directionCode)!==-1){if(this.searching){var $collection=this.$el.find('#appDrawerMenuSearch a');var $link=this.findAdjacentLink(this.$el.find('#appDrawerMenuSearch a:first, #appDrawerMenuSearch a.web-responsive-focus').last(),this.directionCodes[directionCode],$collection,true);}else{var $link=this.findAdjacentLink(this.$el.find('#appDrawerApps a:first, #appDrawerApps a.web-responsive-focus').last(),this.directionCodes[directionCode]);}
this.selectLink($link);}else if($.hotkeys.specialKeys[e.keyCode.toString()]=='esc'){if(this.searching){this.closeSearchMenus();}else{this.handleClickZones();}}else{this.redirectKeyPresses(e);}},redirectKeyPresses:function(e){if(!this.isOpen){return;}
if(e.key==='Enter'){window.location.href=$('.web-responsive-focus').attr('href');this.handleClickZones();return;}
if(this.MODIFIERS.indexOf(e.key)!==-1){return;}
if(e.target===this.$searchInput[0]){this.searchMenus();return;}
e.preventDefault();this.$searchInput.trigger({type:e.type,key:e.key,keyCode:e.keyCode,which:e.which,});this.searchMenus();},onDrawerClose:function(){this.closeSearchMenus();this.$searchAction.hide();core.bus.trigger('drawer.closed');this.$el.one('drawer.opened',$.proxy(this.onDrawerOpen,this));this.isOpen=false;this.$el.css("overflow","");},onDrawerOpen:function(){this.$appLinks=$('.app-drawer-icon-app').parent();this.selectLink($(this.$appLinks[0]));this.$el.one('drawer.closed',$.proxy(this.onDrawerClose,this));core.bus.trigger('drawer.opened');this.isOpen=true;},selectLink:function($link){$('.web-responsive-focus').removeClass('web-responsive-focus');if($link){$link.addClass('web-responsive-focus');}},searchMenus:function(){this.$searchInput=$('#appDrawerSearchInput').focus();var Menus=new DataModel('ir.ui.menu');Menus.query(['action','display_name','id']).filter([['name','ilike',this.$searchInput.val()],['action','!=',false]]).all().then($.proxy(this.showFoundMenus,this));},showFoundMenus:function(menus){this.searching=true;this.$el.find('#appDrawerApps').hide();this.$searchAction.hide();this.$el.find('.drawer-search-close').show();this.$el.find('.drawer-search-open').hide();this.$searchResultsContainer.html(core.qweb.render('AppDrawerMenuSearchResults',{menus:menus})).closest('#appDrawerMenuSearch').show().find('.menu-search-query').focus();var $menuLinks=this.$searchResultsContainer.find('a');$menuLinks.click($.proxy(this.handleClickZones,this));this.selectLink($menuLinks.first());},closeSearchMenus:function(){this.searching=false;this.$el.find('#appDrawerApps').show();this.$el.find('.drawer-search-close').hide();this.$el.find('.drawer-search-open').show();this.$searchResultsContainer.closest('#appDrawerMenuSearch').hide();this.$searchAction.show();$('#appDrawerSearchInput').val('');},findAdjacentLink:function($link,direction,$objs,restrictHorizontal){if($objs===undefined){$objs=this.$appLinks;}
var obj=[];var $rows=(restrictHorizontal)?$objs:this.getRowObjs($link,this.$appLinks);switch(direction){case this.LEFT:obj=$objs[$objs.index($link)-1];if(!obj){obj=$objs[$objs.length-1];}
break;case this.RIGHT:obj=$objs[$objs.index($link)+1];if(!obj){obj=$objs[0];}
break;case this.UP:obj=$rows[$rows.index($link)-1];if(!obj){obj=$rows[$rows.length-1];}
break;case this.DOWN:obj=$rows[$rows.index($link)+1];if(!obj){obj=$rows[0];}
break;}
if(obj.length){event.preventDefault();}
return $(obj);},getRowObjs:function($obj,$grid){function filterWithin(left,right){return function(){var $this=$(this),thisMiddle=$this.offset().left+($this.width()/2);return thisMiddle>=left&&thisMiddle<=right;};}
var left=$obj.offset().left,right=left+$obj.outerWidth();return $grid.filter(filterWithin(left,right));},});core.bus.on('web_client_ready',null,function(){new AppDrawer();});ViewManager.include({get_default_view:function(){var default_view=this._super()
if(config.device.size_class<=config.device.SIZES.XS&&default_view.type!='kanban'&&this.views['kanban'])
{default_view.type='kanban';};return default_view;},});return{'AppDrawer':AppDrawer,'SearchView':SearchView,'Menu':Menu,'ViewManager':ViewManager,};});;

/* /web_planner/static/src/js/web_planner_backend.js defined in bundle 'web.assets_backend' */
odoo.define('web.planner',function(require){"use strict";var core=require('web.core');var Model=require('web.Model');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var planner=require('web.planner.common');var webclient=require('web.web_client');var PlannerDialog=planner.PlannerDialog;var PlannerLauncher=Widget.extend({sequence:100,template:"PlannerLauncher",init:function(parent){this._super(parent);this.planner_by_menu={};this.need_reflow=false;},start:function(){var self=this;core.bus.on("change_menu_section",self,self.on_menu_clicked);var res=self._super.apply(this,arguments).then(function(){self.$el.on('click',self,self.show_dialog.bind(self));return self.fetch_application_planner();}).then(function(apps){self.$('.progress').tooltip({html:true,placement:'bottom',delay:{'show':500}});self.planner_apps=apps;return apps;});return res;},fetch_application_planner:function(){var self=this;var def=$.Deferred();if(!_.isEmpty(this.planner_by_menu)){def.resolve(self.planner_by_menu);}else{(new Model('web.planner')).query().all().then(function(res){_.each(res,function(planner){self.planner_by_menu[planner.menu_id[0]]=planner;self.planner_by_menu[planner.menu_id[0]].data=$.parseJSON(self.planner_by_menu[planner.menu_id[0]].data)||{};});def.resolve(self.planner_by_menu);}).fail(function(){def.reject();});}
return def;},on_menu_clicked:function(menu_id){if(_.contains(_.keys(this.planner_apps),menu_id.toString())){this.setup(this.planner_apps[menu_id]);this.need_reflow=true;}else{this.$el.hide();this.need_reflow=true;}
if(this.need_reflow){core.bus.trigger('resize');this.need_reflow=false;}
if(this.dialog){this.dialog.$el.modal('hide');this.dialog.$el.detach();}},setup:function(planner){var self=this;this.planner=planner;if(this.dialog){this.dialog.$el.modal('hide');this.dialog.destroy();}
this.dialog=new PlannerDialog(this,planner);this.dialog.appendTo($('<div>'));this.$('.progress').attr('data-original-title',this.planner.tooltip_planner);this.$el.filter('.o_planner_help').find('.o_planner_link').show();this.dialog.on("planner_progress_changed",this,function(percent){self.update_parent_progress_bar(percent);});},update_parent_progress_bar:function(percent){if(percent==100){this.$(".progress").hide();}else{this.$(".progress").show();}
this.$el.show();this.$(".progress-bar").css('width',percent+"%");},show_dialog:function(){this.dialog.$el.appendTo(webclient.$el);this.dialog.$el.modal('show');},});SystrayMenu.Items.push(PlannerLauncher);return{PlannerLauncher:PlannerLauncher,};});;

/* /sale/static/src/js/sale.js defined in bundle 'web.assets_backend' */
odoo.define('sale.sales_team_dashboard',function(require){"use strict";var core=require('web.core');var KanbanRecord=require('web_kanban.Record');var Model=require('web.Model');var _t=core._t;KanbanRecord.include({events:_.defaults({'click .sales_team_target_definition':'on_sales_team_target_click',},KanbanRecord.prototype.events),on_sales_team_target_click:function(ev){ev.preventDefault();this.$target_input=$('<input>');this.$('.o_kanban_primary_bottom').html(this.$target_input);this.$('.o_kanban_primary_bottom').prepend(_t("Set an invoicing target: "));this.$target_input.focus();var self=this;this.$target_input.blur(function(){var value=Number(self.$target_input.val());if(isNaN(value)){self.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{new Model('crm.team').call('write',[[self.id],{'invoiced_target':value}]).done(function(){self.trigger_up('kanban_record_update',{id:self.id});});}});},});});;

/* /sale/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('sale_tour',{url:"/web",},[tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="sales_team.menu_base_partner"], .oe_menu_toggler[data-menu-xmlid="sales_team.menu_base_partner"]',content:_t('Organize your sales activities with the <b>Sales app</b>.'),position:'bottom',},{trigger:".oe_kanban_action_button",extra_trigger:'.o_salesteam_kanban',content:_t("Let\'s have a look at the quotations of this sales team."),position:"bottom",id:"quotation_button_on_dashboard",},{trigger:".o_list_button_add",extra_trigger:".o_sale_order",content:_t("Let's create a new quotation.<br/><i>Note that colored buttons usually points to the next logical actions in any screen.</i>"),position:"right",},{trigger:".o_form_required input",extra_trigger:".o_sale_order",content:_t("Write the name of your customer to create one on the fly, or select an existing one."),position:"top",run:"text Agrolait",},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:".o_form_field_x2many_list_row_add > a",extra_trigger:".o_sale_order",content:_t("Click here to add some lines to your quotations."),position:"bottom",},{trigger:".modal-body .o_form_required input, .o_list_editable .o_form_required input",extra_trigger:".o_sale_order",content:_t("Select a product, or create a new one on the fly. The product will define the default sale price (that you can change), taxes and description automatically."),position:"right",run:"text Ipad",},{trigger:".ui-menu-item > a",auto:true,in_modal:false,run:function(actions){actions.auto();actions.auto(".modal-footer .btn-primary");},id:"quotation_product_selected",},{trigger:".o_form_button_save",extra_trigger:".o_sale_order",content:_t("Once your quotation is ready, you can save, print or send it by email."),position:"right",},{trigger:".o_sale_confirm",extra_trigger:".o_sale_order.o_form_readonly",content:_t("<p><b>Confirm the order</b> if the customer purchases.</p>"),position:"bottom"},{trigger:".breadcrumb li:not(.active):last",extra_trigger:".o_sale_order [data-id='sale'].btn-primary, .o_sale_order [data-id='sale'].oe_active",content:_t("Use the breadcrumbs to <b>go back to preceeding screens</b>."),position:"bottom"},{trigger:'li a[data-menu-xmlid="sales_team.menu_sales"], .oe_secondary_menu_section[data-menu-xmlid="sales_team.menu_sales"]',content:_t("Use this menu to access quotations, sales orders and customers."),edition:"enterprise",position:"bottom"},tour.STEPS.TOGGLE_APPSWITCHER,tour.STEPS.MENU_MORE,{trigger:'.o_app[data-menu-xmlid="base.menu_administration"], .oe_menu_toggler[data-menu-xmlid="base.menu_administration"]',content:_t("Configuration options are available in the Settings app."),position:"bottom"},{trigger:".o_web_settings_dashboard textarea#user_emails",content:_t("<b>Invite salespeople or managers</b> via email.<br/><i>Enter one email per line.</i>"),position:"right"}]);});;

/* /report/static/src/js/qwebactionmanager.js defined in bundle 'web.assets_backend' */
odoo.define('report.report',function(require){'use strict';var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var _lt=core._lt;var wkhtmltopdf_state;var WKHTMLTOPDF_MESSAGES={'install':_lt('Unable to find Wkhtmltopdf on this \nsystem. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">\nwkhtmltopdf.org</a>'),'workers':_lt('You need to start OpenERP with at least two \nworkers to print a pdf version of the reports.'),'upgrade':_lt('You should upgrade your version of\nWkhtmltopdf to at least 0.12.0 in order to get a correct display of headers and footers as well as\nsupport for table-breaking between pages.<br><br><a href="http://wkhtmltopdf.org/" \ntarget="_blank">wkhtmltopdf.org</a>'),'broken':_lt('Your installation of Wkhtmltopdf seems to be broken. The report will be shown in html.<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>')};var trigger_download=function(session,response,c,action,options){session.get_file({url:'/report/download',data:{data:JSON.stringify(response)},complete:framework.unblockUI,error:c.rpc_error.bind(c),success:function(){if(action&&options&&!action.dialog){options.on_close();}},});};var make_report_url=function(action){var report_urls={'qweb-html':'/report/html/'+action.report_name,'qweb-pdf':'/report/pdf/'+action.report_name,'controller':action.report_file,};if(_.isUndefined(action.data)||_.isNull(action.data)||(_.isObject(action.data)&&_.isEmpty(action.data))){if(action.context.active_ids){var active_ids_path='/'+action.context.active_ids.join(',');report_urls=_.mapObject(report_urls,function(value,key){return value+=active_ids_path;});}}else{var serialized_options_path='?options='+encodeURIComponent(JSON.stringify(action.data));serialized_options_path+='&context='+encodeURIComponent(JSON.stringify(action.context));report_urls=_.mapObject(report_urls,function(value,key){return value+=serialized_options_path;});}
return report_urls;};ActionManager.include({ir_actions_report_xml:function(action,options){var self=this;action=_.clone(action);var report_urls=make_report_url(action);if(action.report_type==='qweb-html'){var client_action_options=_.extend({},options,{report_url:report_urls['qweb-html'],report_name:action.report_name,report_file:action.report_file,data:action.data,context:action.context,name:action.name,display_name:action.display_name,});return this.do_action('report.client_action',client_action_options);}else if(action.report_type==='qweb-pdf'){framework.blockUI();(wkhtmltopdf_state=wkhtmltopdf_state||session.rpc('/report/check_wkhtmltopdf')).then(function(state){if(WKHTMLTOPDF_MESSAGES[state]){self.do_notify(_t('Report'),WKHTMLTOPDF_MESSAGES[state],true);}
if(state==='upgrade'||state==='ok'){var response=[report_urls['qweb-pdf'],action.report_type,];var c=crash_manager;return trigger_download(self.session,response,c,action,options);}else{var client_action_options=_.extend({},options,{report_url:report_urls['qweb-html'],report_name:action.report_name,report_file:action.report_file,data:action.data,context:action.context,name:action.name,display_name:action.display_name,});framework.unblockUI();return self.do_action('report.client_action',client_action_options);}});}else if(action.report_type==='controller'){framework.blockUI();var response=[report_urls.controller,action.report_type,];var c=crash_manager;return trigger_download(self.session,response,c,action,options);}else{return self._super(action,options);}}});});;

/* /report/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /report/static/src/js/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var core=require('web.core');var ControlPanelMixin=require('web.ControlPanelMixin');var session=require('web.session');var Widget=require('web.Widget');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report.editor:save_ok','report.editor:discard_ok','report:do_action',];var ReportAction=Widget.extend(ControlPanelMixin,{template:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this.title=options.display_name||options.name;this.edit_mode_available=false;this.in_edit_mode=false;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.set('title',this.title);this.iframe=this.$('iframe')[0];return $.when(this._super.apply(this,arguments),session.is_bound).then(function(){var web_base_url=session['web.base.url'];var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));self.$buttons.on('click','.o_report_edit',self.on_click_edit);self.$buttons.on('click','.o_report_print',self.on_click_print);self.$buttons.on('click','.o_report_save',self.on_click_save);self.$buttons.on('click','.o_report_discard',self.on_click_discard);self._update_control_panel();self.iframe.src=self.report_url;self.iframe.onload=function(){self._on_iframe_loaded();};});},do_show:function(){this._update_control_panel();return this._super.apply(this,arguments);},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);},on_detach_callback:function(){$(window).off('message',this.on_message_received);},_on_iframe_loaded:function(){var editable=$(this.iframe).contents().find('html').data('editable');if(editable===1){this.edit_mode_available=true;this._update_control_panel();}},_update_control_panel:function(){this.update_control_panel({breadcrumbs:this.action_manager.get_breadcrumbs(),cp_content:{$buttons:this.$buttons,},});this._update_control_panel_buttons();},_update_control_panel_buttons:function(){this.$buttons.filter('div.o_report_edit_mode').toggle(this.in_edit_mode);this.$buttons.filter('div.o_report_no_edit_mode').toggle(!this.in_edit_mode);this.$buttons.filter('div.o_edit_mode_available').toggle(core.debug&&this.edit_mode_available&&!this.in_edit_mode);},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report.editor:save_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report.editor:discard_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_edit:function(){if(this.report_url.indexOf('?')===-1){this.iframe.src=this.report_url+'?enable_editor=1';}else{this.iframe.src=this.report_url+'&enable_editor=1';}
this.in_edit_mode=true;this._update_control_panel_buttons();},on_click_discard:function(){this._post_message('report.editor:ask_discard');},on_click_save:function(){this._post_message('report.editor:ask_save');},on_click_print:function(){var action={'type':'ir.actions.report.xml','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /rowno_in_tree/static/src/js/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('rowno_in_tree.ListNumber',function(require){"use strict";var core=require('web.core');var ListView=require('web.ListView');var _t=core._t;ListView.Groups.include({render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();_(datagroups).each(function(group){if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="o_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.fa').removeClass('fa-caret-right').addClass('fa-caret-down');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.fa').removeClass('fa-caret-down').addClass('fa-caret-right');child.close();var selection=self.get_selection();$(self).trigger('selected',[selection.ids,this.records]);}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="o_group_name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_label=_t("Undefined");var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(group_column){try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}}else{group_label=group.value;var grouped_on_field=self.view.fields_get[group.grouped_on];if(grouped_on_field&&grouped_on_field.type==='selection'){group_label=_.find(grouped_on_field.selection,function(selection){return selection[0]===group.value;});}
if(group_label instanceof Array){group_label=group_label[1];}
if(group_label===false){group_label=_t('Undefined');}
group_label=_.str.escapeHTML(group_label);}
$group_column.html(_.str.sprintf("%s (%d)",group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="fa fa-caret-right" style="padding-right: 5px;">');}else{$group_column.prepend('<span class="fa">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe_list_group_pagination">');}});return placeholder;},});ListView.List.include({pad_table_to:function(count){if(this.records.length>=count||_(this.columns).any(function(column){return column.meta;})){return;}
var cells=[];cells.push('<td title="#">&nbsp;</td>');if(this.options.selectable){cells.push('<td class="o_list_record_selector"></td>');}
_(this.columns).each(function(column){if(column.invisible==='1'){return;}
cells.push('<td title="'+column.string+'">&nbsp;</td>');});if(this.options.deletable){cells.push('<td class="o_list_record_delete"></td>');}
cells.unshift('<tr>');cells.push('</tr>');var row=cells.join('');this.$current.children('tr:not([data-id])').remove().end().append(new Array(count-this.records.length+1).join(row));},render_record:function(record){this.options.row_number=this.records.indexOf(record)+1;return this._super(record);}});});;

/* /sales_team/static/src/js/sales_team.js defined in bundle 'web.assets_backend' */
odoo.define('sales_team.update_kanban',function(require){"use strict";var KanbanView=require('web_kanban.KanbanView');var KanbanRecord=require('web_kanban.Record');var data=require('web.data');var session=require('web.session');KanbanView.include({crm_display_members_names:function(){var self=this;var members_ids=[];self.$el.find('img[data-member_id]').each(function(){members_ids.push($(this).data('member_id'));});var dataset=new data.DataSetSearch(self,'res.users',session.context,[['id','in',_.uniq(members_ids)]]);dataset.read_slice(['id','name']).done(function(result){_.each(result,function(v){self.$el.find('img[data-member_id='+v.id+']').attr('title',v.name).tooltip();});});},on_groups_started:function(){var self=this;self._super.apply(self,arguments);if(self.dataset.model==='crm.team'){self.crm_display_members_names();}},});KanbanRecord.include({on_card_clicked:function(){if(this.model==='crm.team'){this.$('.oe_kanban_crm_salesteams_list a').first().click();}else{this._super.apply(this,arguments);}},});});;

/* /sales_team/static/src/js/sales_team_dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('sales_team.dashboard',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var Model=require('web.Model');var session=require('web.session');var KanbanView=require('web_kanban.KanbanView');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var SalesTeamDashboardView=KanbanView.extend({display_name:_lt('Dashboard'),icon:'fa-dashboard',searchview_hidden:true,events:{'click .o_dashboard_action':'on_dashboard_action_clicked','click .o_target_to_set':'on_dashboard_target_clicked',},fetch_data:function(){return $.when();},render:function(){var super_render=this._super;var self=this;return this.fetch_data().then(function(result){self.show_demo=result&&result.nb_opportunities===0;var sales_dashboard=QWeb.render('sales_team.SalesDashboard',{widget:self,show_demo:self.show_demo,values:result,});super_render.call(self);$(sales_dashboard).prependTo(self.$el);});},on_dashboard_action_clicked:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);var action_name=$action.attr('name');var action_extra=$action.data('extra');var additional_context={};if(action_name==='calendar.action_calendar_event'){additional_context.search_default_mymeetings=1;}else if(action_name==='crm.crm_lead_action_activities'){if(action_extra==='today'){additional_context.search_default_today=1;}else if(action_extra==='this_week'){additional_context.search_default_this_week=1;}else if(action_extra==='overdue'){additional_context.search_default_overdue=1;}}else if(action_name==='crm.action_your_pipeline'){if(action_extra==='overdue'){additional_context['search_default_overdue']=1;}else if(action_extra==='overdue_opp'){additional_context['search_default_overdue_opp']=1;}}else if(action_name==='crm.crm_opportunity_report_action_graph'){additional_context.search_default_won=1;}
this.do_action(action_name,{additional_context:additional_context});},on_change_input_target:function(e){var self=this;var $input=$(e.target);var target_name=$input.attr('name');var target_value=$input.val();if(isNaN(target_value)){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{this._updated=new Model('crm.lead').call('modify_target_sales_dashboard',[target_name,parseInt(target_value)]).then(function(){return self.render();});}},on_dashboard_target_clicked:function(ev){if(this.show_demo){return;}
var self=this;var $target=$(ev.currentTarget);var target_name=$target.attr('name');var target_value=$target.attr('value');var $input=$('<input/>',{type:"text"});$input.attr('name',target_name);if(target_value){$input.attr('value',target_value);}
$input.on('keyup input',function(e){if(e.which===$.ui.keyCode.ENTER){self.on_change_input_target(e);}});$input.on('blur',function(e){self.on_change_input_target(e);});$.when(this._updated).then(function(){$input.replaceAll(self.$('.o_target_to_set[name='+target_name+']')).focus().select();});},render_monetary_field:function(value,currency_id){var currency=session.get_currency(currency_id);var digits_precision=currency&&currency.digits;value=formats.format_value(value||0,{type:"float",digits:digits_precision});if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
return value;},});core.view_registry.add('sales_team_dashboard',SalesTeamDashboardView);return SalesTeamDashboardView;});;

/* /table_header_freeze/static/js/widget.js defined in bundle 'web.assets_backend' */
odoo.define('table_header_freeze.freeze_view',function(require){"use strict";document.addEventListener('scroll',stickIt,true);function stickIt(event){var orgElementPos=$('.original').offset();if($('.cloned').length==0){var clone_children=$('.table_header_freeze table.o_list_view thead tr').children();var clone=$('.table_header_freeze table.o_list_view thead tr').addClass('original').clone().insertAfter('.table_header_freeze table.o_list_view thead tr').addClass('cloned').css('position','fixed').css('top','0').css('margin-top','0').css('z-index','1').removeClass('original').hide();var target_children=clone.children();clone.children().width(function(i,val){return clone_children.eq(i).width();});}
if(orgElementPos){var orgElementTop=orgElementPos.top;var offsetHeight_panel=$('.o_control_panel').offset();var offsetHeight_menu=document.getElementById('odooMenuBarNav').offsetHeight;var offsetHeight_footer=$('.table_header_freeze table.o_list_view tfoot').offset();var total_height=offsetHeight_menu+offsetHeight_panel.top+80
if(total_height>=(orgElementTop)){var orgElement=$('.table_header_freeze table.o_list_view thead tr');var coordsOrgElement=orgElement.offset();var leftOrgElement=coordsOrgElement.left;var widthOrgElement=orgElement.css('width');$('.cloned').css('left',leftOrgElement+'px').css('top',total_height).css('width',widthOrgElement).show();$('.table_header_freeze table.o_list_view thead tr.original').css('visibility','hidden');}else{$('.cloned').hide();$('.table_header_freeze table.o_list_view thead tr').css('visibility','visible');}
if(offsetHeight_footer.top<$('.cloned').offset().top){$('.cloned').hide();}}}});;

/* /web_tour/static/src/js/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_tour.DebugManager',function(require){"use strict";var core=require("web.core");var DebugManager=require('web.DebugManager');var Dialog=require("web.Dialog");var Model=require('web.Model');var tour=require('web_tour.tour');function get_active_tours(){return _.difference(_.keys(tour.tours),tour.consumed_tours);}
DebugManager.include({start:function(){this.consume_tours_enabled=get_active_tours().length>0;return this._super.apply(this,arguments);},consume_tours:function(){var active_tours=get_active_tours();if(active_tours.length>0){new Model('web_tour.tour').call('consume',[active_tours]).then(function(){window.location.reload();});}},start_tour:function(){var dialog=new Dialog(this,{title:'Tours',$content:core.qweb.render('WebClient.DebugManager.ToursDialog',{tours:tour.tours}),}).open();dialog.$('.o_start_tour').on('click',function(e){e.preventDefault();tour.run($(e.target).data('name'));});},});});;

/* /web_calendar/static/lib/fullcalendar/js/fullcalendar.js defined in bundle 'web.assets_backend' */
(function($,undefined){;;var defaults={defaultView:'month',aspectRatio:1.35,header:{left:'title',center:'',right:'today prev,next'},weekends:true,weekNumbers:false,weekNumberCalculation:'iso',weekNumberTitle:'W',allDayDefault:true,ignoreTimezone:true,lazyFetching:true,startParam:'start',endParam:'end',titleFormat:{month:'MMMM yyyy',week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:'dddd, MMM d, yyyy'},columnFormat:{month:'ddd',week:'ddd M/d',day:'dddd M/d'},timeFormat:{'':'h(:mm)t'},isRTL:false,firstDay:0,monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],buttonText:{prev:"<span class='fc-text-arrow'>&lsaquo;</span>",next:"<span class='fc-text-arrow'>&rsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&laquo;</span>",nextYear:"<span class='fc-text-arrow'>&raquo;</span>",today:'today',month:'month',week:'week',day:'day'},theme:false,buttonIcons:{prev:'circle-triangle-w',next:'circle-triangle-e'},unselectAuto:true,dropAccept:'*',handleWindowResize:true};var rtlDefaults={header:{left:'next,prev today',center:'',right:'title'},buttonText:{prev:"<span class='fc-text-arrow'>&rsaquo;</span>",next:"<span class='fc-text-arrow'>&lsaquo;</span>",prevYear:"<span class='fc-text-arrow'>&raquo;</span>",nextYear:"<span class='fc-text-arrow'>&laquo;</span>"},buttonIcons:{prev:'circle-triangle-e',next:'circle-triangle-w'}};;;var fc=$.fullCalendar={version:"1.6.4"};var fcViews=fc.views={};$.fn.fullCalendar=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1);var res;this.each(function(){var calendar=$.data(this,'fullCalendar');if(calendar&&$.isFunction(calendar[options])){var r=calendar[options].apply(calendar,args);if(res===undefined){res=r;}
if(options=='destroy'){$.removeData(this,'fullCalendar');}}});if(res!==undefined){return res;}
return this;}
options=options||{};var eventSources=options.eventSources||[];delete options.eventSources;if(options.events){eventSources.push(options.events);delete options.events;}
options=$.extend(true,{},defaults,(options.isRTL||options.isRTL===undefined&&defaults.isRTL)?rtlDefaults:{},options);this.each(function(i,_element){var element=$(_element);var calendar=new Calendar(element,options,eventSources);element.data('fullCalendar',calendar);calendar.render();});return this;};function setDefaults(d){$.extend(true,defaults,d);};;function Calendar(element,options,eventSources){var t=this;t.options=options;t.render=render;t.destroy=destroy;t.refetchEvents=refetchEvents;t.reportEvents=reportEvents;t.reportEventChange=reportEventChange;t.rerenderEvents=rerenderEvents;t.changeView=changeView;t.select=select;t.unselect=unselect;t.prev=prev;t.next=next;t.prevYear=prevYear;t.nextYear=nextYear;t.today=today;t.gotoDate=gotoDate;t.incrementDate=incrementDate;t.formatDate=function(format,date){return formatDate(format,date,options)};t.formatDates=function(format,date1,date2){return formatDates(format,date1,date2,options)};t.getDate=getDate;t.getView=getView;t.option=option;t.trigger=trigger;EventManager.call(t,options,eventSources);var isFetchNeeded=t.isFetchNeeded;var fetchEvents=t.fetchEvents;var _element=element[0];var header;var headerElement;var content;var tm;var currentView;var elementOuterWidth;var suggestedViewHeight;var resizeUID=0;var ignoreWindowResize=0;var date=new Date();var events=[];var _dragElement;setYMD(date,options.year,options.month,options.date);function render(inc){if(!content){initialRender();}
else if(elementVisible()){calcSize();_renderView(inc);}}
function initialRender(){tm=options.theme?'ui':'fc';element.addClass('fc');if(options.isRTL){element.addClass('fc-rtl');}
else{element.addClass('fc-ltr');}
if(options.theme){element.addClass('ui-widget');}
content=$("<div class='fc-content' style='position:relative'/>").prependTo(element);header=new Header(t,options);headerElement=header.render();if(headerElement){element.prepend(headerElement);}
changeView(options.defaultView);if(options.handleWindowResize){$(window).resize(windowResize);}
if(!bodyVisible()){lateRender();}}
function lateRender(){setTimeout(function(){if(!currentView.start&&bodyVisible()){renderView();}},0);}
function destroy(){if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);currentView.triggerEventDestroy();}
$(window).unbind('resize',windowResize);header.destroy();content.remove();element.removeClass('fc fc-rtl ui-widget');}
function elementVisible(){return element.is(':visible');}
function bodyVisible(){return $('body').is(':visible');}
function changeView(newViewName){if(!currentView||newViewName!=currentView.name){_changeView(newViewName);}}
function _changeView(newViewName){ignoreWindowResize++;if(currentView){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();currentView.triggerEventDestroy();freezeContentHeight();currentView.element.remove();header.deactivateButton(currentView.name);}
header.activateButton(newViewName);currentView=new fcViews[newViewName]($("<div class='fc-view fc-view-"+newViewName+"' style='position:relative'/>").appendTo(content),t);renderView();unfreezeContentHeight();ignoreWindowResize--;}
function renderView(inc){if(!currentView.start||inc||date<currentView.start||date>=currentView.end){if(elementVisible()){_renderView(inc);}}}
function _renderView(inc){ignoreWindowResize++;if(currentView.start){trigger('viewDestroy',currentView,currentView,currentView.element);unselect();clearEvents();}
freezeContentHeight();currentView.render(date,inc||0);setSize();unfreezeContentHeight();(currentView.afterRender||noop)();updateTitle();updateTodayButton();trigger('viewRender',currentView,currentView,currentView.element);currentView.trigger('viewDisplay',_element);ignoreWindowResize--;getAndRenderEvents();}
function updateSize(){if(elementVisible()){unselect();clearEvents();calcSize();setSize();renderEvents();}}
function calcSize(){if(options.contentHeight){suggestedViewHeight=options.contentHeight;}
else if(options.height){suggestedViewHeight=options.height-(headerElement?headerElement.height():0)-vsides(content);}
else{suggestedViewHeight=Math.round(content.width()/Math.max(options.aspectRatio,.5));}}
function setSize(){if(suggestedViewHeight===undefined){calcSize();}
ignoreWindowResize++;currentView.setHeight(suggestedViewHeight);currentView.setWidth(content.width());ignoreWindowResize--;elementOuterWidth=element.outerWidth();}
function windowResize(){if(!ignoreWindowResize){if(currentView.start){var uid=++resizeUID;setTimeout(function(){if(uid==resizeUID&&!ignoreWindowResize&&elementVisible()){if(elementOuterWidth!=(elementOuterWidth=element.outerWidth())){ignoreWindowResize++;updateSize();currentView.trigger('windowResize',_element);ignoreWindowResize--;}}},200);}else{lateRender();}}}
function refetchEvents(){clearEvents();fetchAndRenderEvents();}
function rerenderEvents(modifiedEventID){clearEvents();renderEvents(modifiedEventID);}
function renderEvents(modifiedEventID){if(elementVisible()){currentView.setEventData(events);currentView.renderEvents(events,modifiedEventID);currentView.trigger('eventAfterAllRender');}}
function clearEvents(){currentView.triggerEventDestroy();currentView.clearEvents();currentView.clearEventData();}
function getAndRenderEvents(){if(!options.lazyFetching||isFetchNeeded(currentView.visStart,currentView.visEnd)){fetchAndRenderEvents();}
else{renderEvents();}}
function fetchAndRenderEvents(){fetchEvents(currentView.visStart,currentView.visEnd);}
function reportEvents(_events){events=_events;renderEvents();}
function reportEventChange(eventID){rerenderEvents(eventID);}
function updateTitle(){header.updateTitle(currentView.title);}
function updateTodayButton(){var today=new Date();if(today>=currentView.start&&today<currentView.end){header.disableButton('today');}
else{header.enableButton('today');}}
function select(start,end,allDay){currentView.select(start,end,allDay===undefined?true:allDay);}
function unselect(){if(currentView){currentView.unselect();}}
function prev(){renderView(-1);}
function next(){renderView(1);}
function prevYear(){addYears(date,-1);renderView();}
function nextYear(){addYears(date,1);renderView();}
function today(){date=new Date();renderView();}
function gotoDate(year,month,dateOfMonth){if(year instanceof Date){date=cloneDate(year);}else{setYMD(date,year,month,dateOfMonth);}
renderView();}
function incrementDate(years,months,days){if(years!==undefined){addYears(date,years);}
if(months!==undefined){addMonths(date,months);}
if(days!==undefined){addDays(date,days);}
renderView();}
function getDate(){return cloneDate(date);}
function freezeContentHeight(){content.css({width:'100%',height:content.height(),overflow:'hidden'});}
function unfreezeContentHeight(){content.css({width:'',height:'',overflow:''});}
function getView(){return currentView;}
function option(name,value){if(value===undefined){return options[name];}
if(name=='height'||name=='contentHeight'||name=='aspectRatio'){options[name]=value;updateSize();}}
function trigger(name,thisObj){if(options[name]){return options[name].apply(thisObj||_element,Array.prototype.slice.call(arguments,2));}}
if(options.droppable){$(document).bind('dragstart',function(ev,ui){var _e=ev.target;var e=$(_e);if(!e.parents('.fc').length){var accept=options.dropAccept;if($.isFunction(accept)?accept.call(_e,e):e.is(accept)){_dragElement=_e;currentView.dragStart(_dragElement,ev,ui);}}}).bind('dragstop',function(ev,ui){if(_dragElement){currentView.dragStop(_dragElement,ev,ui);_dragElement=null;}});}};;function Header(calendar,options){var t=this;t.render=render;t.destroy=destroy;t.updateTitle=updateTitle;t.activateButton=activateButton;t.deactivateButton=deactivateButton;t.disableButton=disableButton;t.enableButton=enableButton;var element=$([]);var tm;function render(){tm=options.theme?'ui':'fc';var sections=options.header;if(sections){element=$("<table class='fc-header' style='width:100%'/>").append($("<tr/>").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));return element;}}
function destroy(){element.remove();}
function renderSection(position){var e=$("<td class='fc-header-"+position+"'/>");var buttonStr=options.header[position];if(buttonStr){$.each(buttonStr.split(' '),function(i){if(i>0){e.append("<span class='fc-header-space'/>");}
var prevButton;$.each(this.split(','),function(j,buttonName){if(buttonName=='title'){e.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>");if(prevButton){prevButton.addClass(tm+'-corner-right');}
prevButton=null;}else{var buttonClick;if(calendar[buttonName]){buttonClick=calendar[buttonName];}
else if(fcViews[buttonName]){buttonClick=function(){button.removeClass(tm+'-state-hover');calendar.changeView(buttonName);};}
if(buttonClick){var icon=options.theme?smartProperty(options.buttonIcons,buttonName):null;var text=smartProperty(options.buttonText,buttonName);var button=$("<span class='fc-button fc-button-"+buttonName+" "+tm+"-state-default'>"+
(icon?"<span class='fc-icon-wrap'>"+"<span class='ui-icon ui-icon-"+icon+"'/>"+"</span>":text)+"</span>").click(function(){if(!button.hasClass(tm+'-state-disabled')){buttonClick();}}).mousedown(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-down');}).mouseup(function(){button.removeClass(tm+'-state-down');}).hover(function(){button.not('.'+tm+'-state-active').not('.'+tm+'-state-disabled').addClass(tm+'-state-hover');},function(){button.removeClass(tm+'-state-hover').removeClass(tm+'-state-down');}).appendTo(e);disableTextSelection(button);if(!prevButton){button.addClass(tm+'-corner-left');}
prevButton=button;}}});if(prevButton){prevButton.addClass(tm+'-corner-right');}});}
return e;}
function updateTitle(html){element.find('h2').html(html);}
function activateButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-active');}
function deactivateButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-active');}
function disableButton(buttonName){element.find('span.fc-button-'+buttonName).addClass(tm+'-state-disabled');}
function enableButton(buttonName){element.find('span.fc-button-'+buttonName).removeClass(tm+'-state-disabled');}};;fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:'json',cache:false};var eventGUID=1;function EventManager(options,_sources){var t=this;t.isFetchNeeded=isFetchNeeded;t.fetchEvents=fetchEvents;t.addEventSource=addEventSource;t.removeEventSource=removeEventSource;t.updateEvent=updateEvent;t.renderEvent=renderEvent;t.removeEvents=removeEvents;t.clientEvents=clientEvents;t.normalizeEvent=normalizeEvent;var trigger=t.trigger;var getView=t.getView;var reportEvents=t.reportEvents;var stickySource={events:[]};var sources=[stickySource];var rangeStart,rangeEnd;var currentFetchID=0;var pendingSourceCnt=0;var loadingLevel=0;var cache=[];for(var i=0;i<_sources.length;i++){_addEventSource(_sources[i]);}
function isFetchNeeded(start,end){return!rangeStart||start<rangeStart||end>rangeEnd;}
function fetchEvents(start,end){rangeStart=start;rangeEnd=end;cache=[];var fetchID=++currentFetchID;var len=sources.length;pendingSourceCnt=len;for(var i=0;i<len;i++){fetchEventSource(sources[i],fetchID);}}
function fetchEventSource(source,fetchID){_fetchEventSource(source,function(events){if(fetchID==currentFetchID){if(events){if(options.eventDataTransform){events=$.map(events,options.eventDataTransform);}
if(source.eventDataTransform){events=$.map(events,source.eventDataTransform);}
for(var i=0;i<events.length;i++){events[i].source=source;normalizeEvent(events[i]);}
cache=cache.concat(events);}
pendingSourceCnt--;if(!pendingSourceCnt){reportEvents(cache);}}});}
function _fetchEventSource(source,callback){var i;var fetchers=fc.sourceFetchers;var res;for(i=0;i<fetchers.length;i++){res=fetchers[i](source,rangeStart,rangeEnd,callback);if(res===true){return;}
else if(typeof res=='object'){_fetchEventSource(res,callback);return;}}
var events=source.events;if(events){if($.isFunction(events)){pushLoading();events(cloneDate(rangeStart),cloneDate(rangeEnd),function(events){callback(events);popLoading();});}
else if($.isArray(events)){callback(events);}
else{callback();}}else{var url=source.url;if(url){var success=source.success;var error=source.error;var complete=source.complete;var customData;if($.isFunction(source.data)){customData=source.data();}
else{customData=source.data;}
var data=$.extend({},customData||{});var startParam=firstDefined(source.startParam,options.startParam);var endParam=firstDefined(source.endParam,options.endParam);if(startParam){data[startParam]=Math.round(+rangeStart/1000);}
if(endParam){data[endParam]=Math.round(+rangeEnd/1000);}
pushLoading();$.ajax($.extend({},ajaxDefaults,source,{data:data,success:function(events){events=events||[];var res=applyAll(success,this,arguments);if($.isArray(res)){events=res;}
callback(events);},error:function(){applyAll(error,this,arguments);callback();},complete:function(){applyAll(complete,this,arguments);popLoading();}}));}else{callback();}}}
function addEventSource(source){source=_addEventSource(source);if(source){pendingSourceCnt++;fetchEventSource(source,currentFetchID);}}
function _addEventSource(source){if($.isFunction(source)||$.isArray(source)){source={events:source};}
else if(typeof source=='string'){source={url:source};}
if(typeof source=='object'){normalizeSource(source);sources.push(source);return source;}}
function removeEventSource(source){sources=$.grep(sources,function(src){return!isSourcesEqual(src,source);});cache=$.grep(cache,function(e){return!isSourcesEqual(e.source,source);});reportEvents(cache);}
function updateEvent(event){var i,len=cache.length,e,defaultEventEnd=getView().defaultEventEnd,startDelta=event.start-event._start,endDelta=event.end?(event.end-(event._end||defaultEventEnd(event))):0;for(i=0;i<len;i++){e=cache[i];if(e._id==event._id&&e!=event){e.start=new Date(+e.start+startDelta);if(event.end){if(e.end){e.end=new Date(+e.end+endDelta);}else{e.end=new Date(+defaultEventEnd(e)+endDelta);}}else{e.end=null;}
e.title=event.title;e.url=event.url;e.allDay=event.allDay;e.className=event.className;e.editable=event.editable;e.color=event.color;e.backgroundColor=event.backgroundColor;e.borderColor=event.borderColor;e.textColor=event.textColor;normalizeEvent(e);}}
normalizeEvent(event);reportEvents(cache);}
function renderEvent(event,stick){normalizeEvent(event);if(!event.source){if(stick){stickySource.events.push(event);event.source=stickySource;}
cache.push(event);}
reportEvents(cache);}
function removeEvents(filter){if(!filter){cache=[];for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=[];}}}else{if(!$.isFunction(filter)){var id=filter+'';filter=function(e){return e._id==id;};}
cache=$.grep(cache,filter,true);for(var i=0;i<sources.length;i++){if($.isArray(sources[i].events)){sources[i].events=$.grep(sources[i].events,filter,true);}}}
reportEvents(cache);}
function clientEvents(filter){if($.isFunction(filter)){return $.grep(cache,filter);}
else if(filter){filter+='';return $.grep(cache,function(e){return e._id==filter;});}
return cache;}
function pushLoading(){if(!loadingLevel++){trigger('loading',null,true,getView());}}
function popLoading(){if(!--loadingLevel){trigger('loading',null,false,getView());}}
function normalizeEvent(event){var source=event.source||{};var ignoreTimezone=firstDefined(source.ignoreTimezone,options.ignoreTimezone);event._id=event._id||(event.id===undefined?'_fc'+eventGUID++:event.id+'');if(event.date){if(!event.start){event.start=event.date;}
delete event.date;}
event._start=cloneDate(event.start=parseDate(event.start,ignoreTimezone));event.end=parseDate(event.end,ignoreTimezone);if(event.end&&event.end<=event.start){event.end=null;}
event._end=event.end?cloneDate(event.end):null;if(event.allDay===undefined){event.allDay=firstDefined(source.allDayDefault,options.allDayDefault);}
if(event.className){if(typeof event.className=='string'){event.className=event.className.split(/\s+/);}}else{event.className=[];}}
function normalizeSource(source){if(source.className){if(typeof source.className=='string'){source.className=source.className.split(/\s+/);}}else{source.className=[];}
var normalizers=fc.sourceNormalizers;for(var i=0;i<normalizers.length;i++){normalizers[i](source);}}
function isSourcesEqual(source1,source2){return source1&&source2&&getSourcePrimitive(source1)==getSourcePrimitive(source2);}
function getSourcePrimitive(source){return((typeof source=='object')?(source.events||source.url):'')||source;}};;fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.parseISO8601=parseISO8601;fc.parseTime=parseTime;fc.formatDate=formatDate;fc.formatDates=formatDates;var dayIDs=['sun','mon','tue','wed','thu','fri','sat'],DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addYears(d,n,keepTime){d.setFullYear(d.getFullYear()+n);if(!keepTime){clearTime(d);}
return d;}
function addMonths(d,n,keepTime){if(+d){var m=d.getMonth()+n,check=cloneDate(d);check.setDate(1);check.setMonth(m);d.setMonth(m);if(!keepTime){clearTime(d);}
while(d.getMonth()!=check.getMonth()){d.setDate(d.getDate()+(d<check?1:-1));}}
return d;}
function addDays(d,n,keepTime){if(+d){var dd=d.getDate()+n,check=cloneDate(d);check.setHours(9);check.setDate(dd);d.setDate(dd);if(!keepTime){clearTime(d);}
fixDate(d,check);}
return d;}
function fixDate(d,check){if(+d){while(d.getDate()!=check.getDate()){d.setTime(+d+(d<check?1:-1)*HOUR_MS);}}}
function addMinutes(d,n){d.setMinutes(d.getMinutes()+n);return d;}
function clearTime(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d;}
function cloneDate(d,dontKeepTime){if(dontKeepTime){return clearTime(new Date(+d));}
return new Date(+d);}
function zeroDate(){var i=0,d;do{d=new Date(1970,i++,1);}while(d.getHours());return d;}
function dayDiff(d1,d2){return Math.round((cloneDate(d1,true)-cloneDate(d2,true))/DAY_MS);}
function setYMD(date,y,m,d){if(y!==undefined&&y!=date.getFullYear()){date.setDate(1);date.setMonth(0);date.setFullYear(y);}
if(m!==undefined&&m!=date.getMonth()){date.setDate(1);date.setMonth(m);}
if(d!==undefined){date.setDate(d);}}
function parseDate(s,ignoreTimezone){if(typeof s=='object'){return s;}
if(typeof s=='number'){return new Date(s*1000);}
if(typeof s=='string'){if(s.match(/^\d+(\.\d+)?$/)){return new Date(parseFloat(s)*1000);}
if(ignoreTimezone===undefined){ignoreTimezone=true;}
return parseISO8601(s,ignoreTimezone)||(s?new Date(s):null);}
return null;}
function parseISO8601(s,ignoreTimezone){var m=s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);if(!m){return null;}
var date=new Date(m[1],0,1);if(ignoreTimezone||!m[13]){var check=new Date(m[1],0,1,9,0);if(m[3]){date.setMonth(m[3]-1);check.setMonth(m[3]-1);}
if(m[5]){date.setDate(m[5]);check.setDate(m[5]);}
fixDate(date,check);if(m[7]){date.setHours(m[7]);}
if(m[8]){date.setMinutes(m[8]);}
if(m[10]){date.setSeconds(m[10]);}
if(m[12]){date.setMilliseconds(Number("0."+m[12])*1000);}
fixDate(date,check);}else{date.setUTCFullYear(m[1],m[3]?m[3]-1:0,m[5]||1);date.setUTCHours(m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1000:0);if(m[14]){var offset=Number(m[16])*60+(m[18]?Number(m[18]):0);offset*=m[15]=='-'?1:-1;date=new Date(+date+(offset*60*1000));}}
return date;}
function parseTime(s){if(typeof s=='number'){return s*60;}
if(typeof s=='object'){return s.getHours()*60+s.getMinutes();}
var m=s.match(/(\d+)(?::(\d+))?\s*(\w+)?/);if(m){var h=parseInt(m[1],10);if(m[3]){h%=12;if(m[3].toLowerCase().charAt(0)=='p'){h+=12;}}
return h*60+(m[2]?parseInt(m[2],10):0);}}
function formatDate(date,format,options){return formatDates(date,null,format,options);}
function formatDates(date1,date2,format,options){options=options||defaults;var date=date1,otherDate=date2,i,len=format.length,c,i2,formatter,res='';for(i=0;i<len;i++){c=format.charAt(i);if(c=="'"){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)=="'"){if(date){if(i2==i+1){res+="'";}else{res+=format.substring(i+1,i2);}
i=i2;}
break;}}}
else if(c=='('){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==')'){var subres=formatDate(date,format.substring(i+1,i2),options);if(parseInt(subres.replace(/\D/,''),10)){res+=subres;}
i=i2;break;}}}
else if(c=='['){for(i2=i+1;i2<len;i2++){if(format.charAt(i2)==']'){var subformat=format.substring(i+1,i2);var subres=formatDate(date,subformat,options);if(subres!=formatDate(otherDate,subformat,options)){res+=subres;}
i=i2;break;}}}
else if(c=='{'){date=date2;otherDate=date1;}
else if(c=='}'){date=date1;otherDate=date2;}
else{for(i2=len;i2>i;i2--){if(formatter=dateFormatters[format.substring(i,i2)]){if(date){res+=formatter(date,options);}
i=i2-1;break;}}
if(i2==i){if(date){res+=c;}}}}
return res;};var dateFormatters={s:function(d){return d.getSeconds()},ss:function(d){return zeroPad(d.getSeconds())},m:function(d){return d.getMinutes()},mm:function(d){return zeroPad(d.getMinutes())},h:function(d){return d.getHours()%12||12},hh:function(d){return zeroPad(d.getHours()%12||12)},H:function(d){return d.getHours()},HH:function(d){return zeroPad(d.getHours())},d:function(d){return d.getDate()},dd:function(d){return zeroPad(d.getDate())},ddd:function(d,o){return o.dayNamesShort[d.getDay()]},dddd:function(d,o){return o.dayNames[d.getDay()]},M:function(d){return d.getMonth()+1},MM:function(d){return zeroPad(d.getMonth()+1)},MMM:function(d,o){return o.monthNamesShort[d.getMonth()]},MMMM:function(d,o){return o.monthNames[d.getMonth()]},yy:function(d){return(d.getFullYear()+'').substring(2)},yyyy:function(d){return d.getFullYear()},t:function(d){return d.getHours()<12?'a':'p'},tt:function(d){return d.getHours()<12?'am':'pm'},T:function(d){return d.getHours()<12?'A':'P'},TT:function(d){return d.getHours()<12?'AM':'PM'},u:function(d){return formatDate(d,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(d){var date=d.getDate();if(date>10&&date<20){return'th';}
return['st','nd','rd'][date%10-1]||'th';},w:function(d,o){return o.weekNumberCalculation(d);},W:function(d){return iso8601Week(d);}};fc.dateFormatters=dateFormatters;function iso8601Week(date){var time;var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;};;fc.applyAll=applyAll;function exclEndDay(event){if(event.end){return _exclEndDay(event.end,event.allDay);}else{return addDays(cloneDate(event.start),1);}}
function _exclEndDay(end,allDay){end=cloneDate(end);return allDay||end.getHours()||end.getMinutes()?addDays(end,1):clearTime(end);}
function lazySegBind(container,segs,bindHandlers){container.unbind('mouseover').mouseover(function(ev){var parent=ev.target,e,i,seg;while(parent!=this){e=parent;parent=parent.parentNode;}
if((i=e._fci)!==undefined){e._fci=undefined;seg=segs[i];bindHandlers(seg.event,seg.element,seg);$(ev.target).trigger(ev);}
ev.stopPropagation();});}
function setOuterWidth(element,width,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.width(Math.max(0,width-hsides(e,includeMargins)));}}
function setOuterHeight(element,height,includeMargins){for(var i=0,e;i<element.length;i++){e=$(element[i]);e.height(Math.max(0,height-vsides(e,includeMargins)));}}
function hsides(element,includeMargins){return hpadding(element)+hborders(element)+(includeMargins?hmargins(element):0);}
function hpadding(element){return(parseFloat($.css(element[0],'paddingLeft',true))||0)+
(parseFloat($.css(element[0],'paddingRight',true))||0);}
function hmargins(element){return(parseFloat($.css(element[0],'marginLeft',true))||0)+
(parseFloat($.css(element[0],'marginRight',true))||0);}
function hborders(element){return(parseFloat($.css(element[0],'borderLeftWidth',true))||0)+
(parseFloat($.css(element[0],'borderRightWidth',true))||0);}
function vsides(element,includeMargins){return vpadding(element)+vborders(element)+(includeMargins?vmargins(element):0);}
function vpadding(element){return(parseFloat($.css(element[0],'paddingTop',true))||0)+
(parseFloat($.css(element[0],'paddingBottom',true))||0);}
function vmargins(element){return(parseFloat($.css(element[0],'marginTop',true))||0)+
(parseFloat($.css(element[0],'marginBottom',true))||0);}
function vborders(element){return(parseFloat($.css(element[0],'borderTopWidth',true))||0)+
(parseFloat($.css(element[0],'borderBottomWidth',true))||0);}
function noop(){}
function dateCompare(a,b){return a-b;}
function arrayMax(a){return Math.max.apply(Math,a);}
function zeroPad(n){return(n<10?'0':'')+n;}
function smartProperty(obj,name){if(obj[name]!==undefined){return obj[name];}
var parts=name.split(/(?=[A-Z])/),i=parts.length-1,res;for(;i>=0;i--){res=obj[parts[i].toLowerCase()];if(res!==undefined){return res;}}
return obj[''];}
function htmlEscape(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/'/g,'&#039;').replace(/"/g,'&quot;').replace(/\n/g,'<br />');}
function disableTextSelection(element){element.attr('unselectable','on').css('MozUserSelect','none').bind('selectstart.ui',function(){return false;});}
function markFirstLast(e){e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last');}
function setDayID(cell,date){cell.each(function(i,_cell){_cell.className=_cell.className.replace(/^fc-\w*/,'fc-'+dayIDs[date.getDay()]);});}
function getSkinCss(event,opt){var source=event.source||{};var eventColor=event.color;var sourceColor=source.color;var optionColor=opt('eventColor');var backgroundColor=event.backgroundColor||eventColor||source.backgroundColor||sourceColor||opt('eventBackgroundColor')||optionColor;var borderColor=event.borderColor||eventColor||source.borderColor||sourceColor||opt('eventBorderColor')||optionColor;var textColor=event.textColor||source.textColor||opt('eventTextColor');var statements=[];if(backgroundColor){statements.push('background-color:'+backgroundColor);}
if(borderColor){statements.push('border-color:'+borderColor);}
if(textColor){statements.push('color:'+textColor);}
return statements.join(';');}
function applyAll(functions,thisObj,args){if($.isFunction(functions)){functions=[functions];}
if(functions){var i;var ret;for(i=0;i<functions.length;i++){ret=functions[i].apply(thisObj,args)||ret;}
return ret;}}
function firstDefined(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}};;fcViews.month=MonthView;function MonthView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'month');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addMonths(date,delta);date.setDate(1);}
var firstDay=opt('firstDay');var start=cloneDate(date,true);start.setDate(1);var end=addMonths(cloneDate(start),1);var visStart=cloneDate(start);addDays(visStart,-((visStart.getDay()-firstDay+7)%7));skipHiddenDays(visStart);var visEnd=cloneDate(end);addDays(visEnd,(7-visEnd.getDay()+firstDay)%7);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();var rowCnt=Math.round(dayDiff(visEnd,visStart)/7);if(opt('weekMode')=='fixed'){addDays(visEnd,(6-rowCnt)*7);rowCnt=6;}
t.title=formatDate(start,opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderBasic(rowCnt,colCnt,true);}};;fcViews.basicWeek=BasicWeekView;function BasicWeekView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicWeek');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));renderBasic(1,colCnt,false);}};;fcViews.basicDay=BasicDayView;function BasicDayView(element,calendar){var t=this;t.render=render;BasicView.call(t,element,calendar,'basicDay');var opt=t.opt;var renderBasic=t.renderBasic;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderBasic(1,1,false);}};;setDefaults({weekMode:'fixed'});function BasicView(element,calendar,viewName){var t=this;t.renderBasic=renderBasic;t.setHeight=setHeight;t.setWidth=setWidth;t.renderDayOverlay=renderDayOverlay;t.defaultSelectionEnd=defaultSelectionEnd;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;t.defaultEventEnd=defaultEventEnd;t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getIsCellAllDay=function(){return true};t.allDayRow=allDayRow;t.getRowCnt=function(){return rowCnt};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getDaySegmentContainer=function(){return daySegmentContainer};View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);BasicEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var daySelectionMousedown=t.daySelectionMousedown;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var table;var head;var headCells;var body;var bodyRows;var bodyCells;var bodyFirstCells;var firstRowCellInners;var firstRowCellContentInners;var daySegmentContainer;var viewWidth;var viewHeight;var colWidth;var weekNumberWidth;var rowCnt,colCnt;var showNumbers;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var tm;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-grid'));function renderBasic(_rowCnt,_colCnt,_showNumbers){rowCnt=_rowCnt;colCnt=_colCnt;showNumbers=_showNumbers;updateOptions();if(!body){buildEventContainer();}
buildTable();}
function updateOptions(){tm=opt('theme')?'ui':'fc';colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}}
function buildEventContainer(){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(element);}
function buildTable(){var html=buildTableHTML();if(table){table.remove();}
table=$(html).appendTo(element);head=table.find('thead');headCells=head.find('.fc-day-header');body=table.find('tbody');bodyRows=body.find('tr');bodyCells=body.find('.fc-day');bodyFirstCells=bodyRows.find('td:first-child');firstRowCellInners=bodyRows.eq(0).find('.fc-day > div');firstRowCellContentInners=bodyRows.eq(0).find('.fc-day-content > div');markFirstLast(head.add(head.find('tr')));markFirstLast(bodyRows);bodyRows.eq(0).addClass('fc-first');bodyRows.filter(':last').addClass('fc-last');bodyCells.each(function(i,_cell){var date=cellToDate(Math.floor(i/colCnt),i%colCnt);trigger('dayRender',t,date,$(_cell));});dayBind(bodyCells);}
function buildTableHTML(){var html="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+
buildHeadHTML()+
buildBodyHTML()+"</table>";return html;}
function buildHeadHTML(){var headerClass=tm+"-widget-header";var html='';var col;var date;html+="<thead><tr>";if(showWeekNumbers){html+="<th class='fc-week-number "+headerClass+"'>"+
htmlEscape(weekNumberTitle)+"</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-day-header fc-"+dayIDs[date.getDay()]+" "+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="</tr></thead>";return html;}
function buildBodyHTML(){var contentClass=tm+"-widget-content";var html='';var row;var col;var date;html+="<tbody>";for(row=0;row<rowCnt;row++){html+="<tr class='fc-week'>";if(showWeekNumbers){date=cellToDate(row,0);html+="<td class='fc-week-number "+contentClass+"'>"+"<div>"+
htmlEscape(formatDate(date,weekNumberFormat))+"</div>"+"</td>";}
for(col=0;col<colCnt;col++){date=cellToDate(row,col);html+=buildCellHTML(date);}
html+="</tr>";}
html+="</tbody>";return html;}
function buildCellHTML(date){var contentClass=tm+"-widget-content";var month=t.start.getMonth();var today=clearTime(new Date());var html='';var classNames=['fc-day','fc-'+dayIDs[date.getDay()],contentClass];if(date.getMonth()!=month){classNames.push('fc-other-month');}
if(+date==+today){classNames.push('fc-today',tm+'-state-highlight');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
html+="<td"+" class='"+classNames.join(' ')+"'"+" data-date='"+formatDate(date,'yyyy-MM-dd')+"'"+">"+"<div>";if(showNumbers){html+="<div class='fc-day-number'>"+date.getDate()+"</div>";}
html+="<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";return html;}
function setHeight(height){viewHeight=height;var bodyHeight=viewHeight-head.height();var rowHeight;var rowHeightLast;var cell;if(opt('weekMode')=='variable'){rowHeight=rowHeightLast=Math.floor(bodyHeight/(rowCnt==1?2:6));}else{rowHeight=Math.floor(bodyHeight/rowCnt);rowHeightLast=bodyHeight-rowHeight*(rowCnt-1);}
bodyFirstCells.each(function(i,_cell){if(i<rowCnt){cell=$(_cell);cell.find('> div').css('min-height',(i==rowCnt-1?rowHeightLast:rowHeight)-vsides(cell));}});}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();weekNumberWidth=0;if(showWeekNumbers){weekNumberWidth=head.find('th.fc-week-number').outerWidth();}
colWidth=Math.floor((viewWidth-weekNumberWidth)/colCnt);setOuterWidth(headCells.slice(0,-1),colWidth);}
function dayBind(days){days.click(dayClick).mousedown(daySelectionMousedown);}
function dayClick(ev){if(!opt('selectable')){var date=parseISO8601($(this).data('date'));trigger('dayClick',this,date,true,ev);}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,element);return renderOverlay(rect,element);}
function defaultSelectionEnd(startDate,allDay){return cloneDate(startDate);}
function renderSelection(startDate,endDate,allDay){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}
function clearSelection(){clearOverlays();}
function reportDayClick(date,allDay,ev){var cell=dateToCell(date);var _element=bodyCells[cell.row*colCnt+cell.col];trigger('dayClick',_element,date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){var d=cellToDate(cell);trigger('drop',_dragElement,d,true,ev,ui);}}
function defaultEventEnd(event){return cloneDate(event.start);}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;headCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();bodyRows.each(function(i,_e){if(i<rowCnt){e=$(_e);n=e.offset().top;if(i){p[1]=n;}
p=[n];rows[i]=p;}});p[1]=n+e.outerHeight();});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return firstRowCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return firstRowCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colContentRight(col){return colContentPositions.right(col);}
function allDayRow(i){return bodyRows.eq(i);}};;function BasicEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;DayEventRenderer.call(t);function renderEvents(events,modifiedEventId){t.renderDayEvents(events,modifiedEventId);}
function clearEvents(){t.getDaySegmentContainer().empty();}};;fcViews.agendaWeek=AgendaWeekView;function AgendaWeekView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaWeek');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var getCellsPerWeek=t.getCellsPerWeek;var formatDates=calendar.formatDates;function render(date,delta){if(delta){addDays(date,delta*7);}
var start=addDays(cloneDate(date),-((date.getDay()-opt('firstDay')+7)%7));var end=addDays(cloneDate(start),7);var visStart=cloneDate(start);skipHiddenDays(visStart);var visEnd=cloneDate(end);skipHiddenDays(visEnd,-1,true);var colCnt=getCellsPerWeek();t.title=formatDates(visStart,addDays(cloneDate(visEnd),-1),opt('titleFormat'));t.start=start;t.end=end;t.visStart=visStart;t.visEnd=visEnd;renderAgenda(colCnt);}};;fcViews.agendaDay=AgendaDayView;function AgendaDayView(element,calendar){var t=this;t.render=render;AgendaView.call(t,element,calendar,'agendaDay');var opt=t.opt;var renderAgenda=t.renderAgenda;var skipHiddenDays=t.skipHiddenDays;var formatDate=calendar.formatDate;function render(date,delta){if(delta){addDays(date,delta);}
skipHiddenDays(date,delta<0?-1:1);var start=cloneDate(date,true);var end=addDays(cloneDate(start),1);t.title=formatDate(date,opt('titleFormat'));t.start=t.visStart=start;t.end=t.visEnd=end;renderAgenda(1);}};;setDefaults({allDaySlot:true,allDayText:'all-day',firstHour:6,slotMinutes:30,defaultEventMinutes:120,axisFormat:'h(:mm)tt',timeFormat:{agenda:'h:mm{ - h:mm}'},dragOpacity:{agenda:.5},minTime:0,maxTime:24,slotEventOverlap:true});function AgendaView(element,calendar,viewName){var t=this;t.renderAgenda=renderAgenda;t.setWidth=setWidth;t.setHeight=setHeight;t.afterRender=afterRender;t.defaultEventEnd=defaultEventEnd;t.timePosition=timePosition;t.getIsCellAllDay=getIsCellAllDay;t.allDayRow=getAllDayRow;t.getCoordinateGrid=function(){return coordinateGrid};t.getHoverListener=function(){return hoverListener};t.colLeft=colLeft;t.colRight=colRight;t.colContentLeft=colContentLeft;t.colContentRight=colContentRight;t.getDaySegmentContainer=function(){return daySegmentContainer};t.getSlotSegmentContainer=function(){return slotSegmentContainer};t.getMinMinute=function(){return minMinute};t.getMaxMinute=function(){return maxMinute};t.getSlotContainer=function(){return slotContainer};t.getRowCnt=function(){return 1};t.getColCnt=function(){return colCnt};t.getColWidth=function(){return colWidth};t.getSnapHeight=function(){return snapHeight};t.getSnapMinutes=function(){return snapMinutes};t.defaultSelectionEnd=defaultSelectionEnd;t.renderDayOverlay=renderDayOverlay;t.renderSelection=renderSelection;t.clearSelection=clearSelection;t.reportDayClick=reportDayClick;t.dragStart=dragStart;t.dragStop=dragStop;View.call(t,element,calendar,viewName);OverlayManager.call(t);SelectionManager.call(t);AgendaEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var renderOverlay=t.renderOverlay;var clearOverlays=t.clearOverlays;var reportSelection=t.reportSelection;var unselect=t.unselect;var daySelectionMousedown=t.daySelectionMousedown;var slotSegHtml=t.slotSegHtml;var cellToDate=t.cellToDate;var dateToCell=t.dateToCell;var rangeToSegments=t.rangeToSegments;var formatDate=calendar.formatDate;var dayTable;var dayHead;var dayHeadCells;var dayBody;var dayBodyCells;var dayBodyCellInners;var dayBodyCellContentInners;var dayBodyFirstCell;var dayBodyFirstCellStretcher;var slotLayer;var daySegmentContainer;var allDayTable;var allDayRow;var slotScroller;var slotContainer;var slotSegmentContainer;var slotTable;var selectionHelper;var viewWidth;var viewHeight;var axisWidth;var colWidth;var gutterWidth;var slotHeight;var snapMinutes;var snapRatio;var snapHeight;var colCnt;var slotCnt;var coordinateGrid;var hoverListener;var colPositions;var colContentPositions;var slotTopCache={};var tm;var rtl;var minMinute,maxMinute;var colFormat;var showWeekNumbers;var weekNumberTitle;var weekNumberFormat;disableTextSelection(element.addClass('fc-agenda'));function renderAgenda(c){colCnt=c;updateOptions();if(!dayTable){buildSkeleton();}
else{buildDayTable();}}
function updateOptions(){tm=opt('theme')?'ui':'fc';rtl=opt('isRTL')
minMinute=parseTime(opt('minTime'));maxMinute=parseTime(opt('maxTime'));colFormat=opt('columnFormat');showWeekNumbers=opt('weekNumbers');weekNumberTitle=opt('weekNumberTitle');if(opt('weekNumberCalculation')!='iso'){weekNumberFormat="w";}
else{weekNumberFormat="W";}
snapMinutes=opt('snapMinutes')||opt('slotMinutes');}
function buildSkeleton(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var s;var d;var i;var maxd;var minutes;var slotNormal=opt('slotMinutes')%15==0;buildDayTable();slotLayer=$("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(element);if(opt('allDaySlot')){daySegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotLayer);s="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>"+"<tr>"+"<th class='"+headerClass+" fc-agenda-axis'>"+opt('allDayText')+"</th>"+"<td>"+"<div class='fc-day-content'><div style='position:relative'/></div>"+"</td>"+"<th class='"+headerClass+" fc-agenda-gutter'>&nbsp;</th>"+"</tr>"+"</table>";allDayTable=$(s).appendTo(slotLayer);allDayRow=allDayTable.find('tr');dayBind(allDayRow.find('td'));slotLayer.append("<div class='fc-agenda-divider "+headerClass+"'>"+"<div class='fc-agenda-divider-inner'/>"+"</div>");}else{daySegmentContainer=$([]);}
slotScroller=$("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(slotLayer);slotContainer=$("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(slotScroller);slotSegmentContainer=$("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(slotContainer);s="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>"+"<tbody>";d=zeroDate();maxd=addMinutes(cloneDate(d),maxMinute);addMinutes(d,minMinute);slotCnt=0;for(i=0;d<maxd;i++){minutes=d.getMinutes();s+="<tr class='fc-slot"+i+' '+(!minutes?'':'fc-minor')+"'>"+"<th class='fc-agenda-axis "+headerClass+"'>"+
((!slotNormal||!minutes)?formatDate(d,opt('axisFormat')):'&nbsp;')+"</th>"+"<td class='"+contentClass+"'>"+"<div style='position:relative'>&nbsp;</div>"+"</td>"+"</tr>";addMinutes(d,opt('slotMinutes'));slotCnt++;}
s+="</tbody>"+"</table>";slotTable=$(s).appendTo(slotContainer);slotBind(slotTable.find('td'));}
function buildDayTable(){var html=buildDayTableHTML();if(dayTable){dayTable.remove();}
dayTable=$(html).appendTo(element);dayHead=dayTable.find('thead');dayHeadCells=dayHead.find('th').slice(1,-1);dayBody=dayTable.find('tbody');dayBodyCells=dayBody.find('td').slice(0,-1);dayBodyCellInners=dayBodyCells.find('> div');dayBodyCellContentInners=dayBodyCells.find('.fc-day-content > div');dayBodyFirstCell=dayBodyCells.eq(0);dayBodyFirstCellStretcher=dayBodyCellInners.eq(0);markFirstLast(dayHead.add(dayHead.find('tr')));markFirstLast(dayBody.add(dayBody.find('tr')));}
function buildDayTableHTML(){var html="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+
buildDayTableHeadHTML()+
buildDayTableBodyHTML()+"</table>";return html;}
function buildDayTableHeadHTML(){var headerClass=tm+"-widget-header";var date;var html='';var weekText;var col;html+="<thead>"+"<tr>";if(showWeekNumbers){date=cellToDate(0,0);weekText=formatDate(date,weekNumberFormat);if(rtl){weekText+=weekNumberTitle;}
else{weekText=weekNumberTitle+weekText;}
html+="<th class='fc-agenda-axis fc-week-number "+headerClass+"'>"+
htmlEscape(weekText)+"</th>";}
else{html+="<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";}
for(col=0;col<colCnt;col++){date=cellToDate(0,col);html+="<th class='fc-"+dayIDs[date.getDay()]+" fc-col"+col+' '+headerClass+"'>"+
htmlEscape(formatDate(date,colFormat))+"</th>";}
html+="<th class='fc-agenda-gutter "+headerClass+"'>&nbsp;</th>"+"</tr>"+"</thead>";return html;}
function buildDayTableBodyHTML(){var headerClass=tm+"-widget-header";var contentClass=tm+"-widget-content";var date;var today=clearTime(new Date());var col;var cellsHTML;var cellHTML;var classNames;var html='';html+="<tbody>"+"<tr>"+"<th class='fc-agenda-axis "+headerClass+"'>&nbsp;</th>";cellsHTML='';for(col=0;col<colCnt;col++){date=cellToDate(0,col);classNames=['fc-col'+col,'fc-'+dayIDs[date.getDay()],contentClass];if(+date==+today){classNames.push(tm+'-state-highlight','fc-today');}
else if(date<today){classNames.push('fc-past');}
else{classNames.push('fc-future');}
cellHTML="<td class='"+classNames.join(' ')+"'>"+"<div>"+"<div class='fc-day-content'>"+"<div style='position:relative'>&nbsp;</div>"+"</div>"+"</div>"+"</td>";cellsHTML+=cellHTML;}
html+=cellsHTML;html+="<td class='fc-agenda-gutter "+contentClass+"'>&nbsp;</td>"+"</tr>"+"</tbody>";return html;}
function setHeight(height){if(height===undefined){height=viewHeight;}
viewHeight=height;slotTopCache={};var headHeight=dayBody.position().top;var allDayHeight=slotScroller.position().top;var bodyHeight=Math.min(height-headHeight,slotTable.height()+allDayHeight+1);dayBodyFirstCellStretcher.height(bodyHeight-vsides(dayBodyFirstCell));slotLayer.css('top',headHeight);slotScroller.height(bodyHeight-allDayHeight-1);slotHeight=slotTable.find('tr:first').height()+1;snapRatio=opt('slotMinutes')/snapMinutes;snapHeight=slotHeight/snapRatio;}
function setWidth(width){viewWidth=width;colPositions.clear();colContentPositions.clear();var axisFirstCells=dayHead.find('th:first');if(allDayTable){axisFirstCells=axisFirstCells.add(allDayTable.find('th:first'));}
axisFirstCells=axisFirstCells.add(slotTable.find('th:first'));axisWidth=0;setOuterWidth(axisFirstCells.width('').each(function(i,_cell){axisWidth=Math.max(axisWidth,$(_cell).outerWidth());}),axisWidth);var gutterCells=dayTable.find('.fc-agenda-gutter');if(allDayTable){gutterCells=gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));}
var slotTableWidth=slotScroller[0].clientWidth;gutterWidth=slotScroller.width()-slotTableWidth;if(gutterWidth){setOuterWidth(gutterCells,gutterWidth);gutterCells.show().prev().removeClass('fc-last');}else{gutterCells.hide().prev().addClass('fc-last');}
colWidth=Math.floor((slotTableWidth-axisWidth)/colCnt);setOuterWidth(dayHeadCells.slice(0,-1),colWidth);}
function resetScroll(){var d0=zeroDate();var scrollDate=cloneDate(d0);scrollDate.setHours(opt('firstHour'));var top=timePosition(d0,scrollDate)+1;function scroll(){slotScroller.scrollTop(top);}
scroll();setTimeout(scroll,0);}
function afterRender(){resetScroll();}
function dayBind(cells){cells.click(slotClick).mousedown(daySelectionMousedown);}
function slotBind(cells){cells.click(slotClick).mousedown(slotSelectionMousedown);}
function slotClick(ev){if(!opt('selectable')){var col=Math.min(colCnt-1,Math.floor((ev.pageX-dayTable.offset().left-axisWidth)/colWidth));var date=cellToDate(0,col);var rowMatch=this.parentNode.className.match(/fc-slot(\d+)/);if(rowMatch){var mins=parseInt(rowMatch[1])*opt('slotMinutes');var hours=Math.floor(mins/60);date.setHours(hours);date.setMinutes(mins%60+minMinute);trigger('dayClick',dayBodyCells[col],date,false,ev);}else{trigger('dayClick',dayBodyCells[col],date,true,ev);}}}
function renderDayOverlay(overlayStart,overlayEnd,refreshCoordinateGrid){if(refreshCoordinateGrid){coordinateGrid.build();}
var segments=rangeToSegments(overlayStart,overlayEnd);for(var i=0;i<segments.length;i++){var segment=segments[i];dayBind(renderCellOverlay(segment.row,segment.leftCol,segment.row,segment.rightCol));}}
function renderCellOverlay(row0,col0,row1,col1){var rect=coordinateGrid.rect(row0,col0,row1,col1,slotLayer);return renderOverlay(rect,slotLayer);}
function renderSlotOverlay(overlayStart,overlayEnd){for(var i=0;i<colCnt;i++){var dayStart=cellToDate(0,i);var dayEnd=addDays(cloneDate(dayStart),1);var stretchStart=new Date(Math.max(dayStart,overlayStart));var stretchEnd=new Date(Math.min(dayEnd,overlayEnd));if(stretchStart<stretchEnd){var rect=coordinateGrid.rect(0,i,0,i,slotContainer);var top=timePosition(dayStart,stretchStart);var bottom=timePosition(dayStart,stretchEnd);rect.top=top;rect.height=bottom-top;slotBind(renderOverlay(rect,slotContainer));}}}
coordinateGrid=new CoordinateGrid(function(rows,cols){var e,n,p;dayHeadCells.each(function(i,_e){e=$(_e);n=e.offset().left;if(i){p[1]=n;}
p=[n];cols[i]=p;});p[1]=n+e.outerWidth();if(opt('allDaySlot')){e=allDayRow;n=e.offset().top;rows[0]=[n,n+e.outerHeight()];}
var slotTableTop=slotContainer.offset().top;var slotScrollerTop=slotScroller.offset().top;var slotScrollerBottom=slotScrollerTop+slotScroller.outerHeight();function constrain(n){return Math.max(slotScrollerTop,Math.min(slotScrollerBottom,n));}
for(var i=0;i<slotCnt*snapRatio;i++){rows.push([constrain(slotTableTop+snapHeight*i),constrain(slotTableTop+snapHeight*(i+1))]);}});hoverListener=new HoverListener(coordinateGrid);colPositions=new HorizontalPositionCache(function(col){return dayBodyCellInners.eq(col);});colContentPositions=new HorizontalPositionCache(function(col){return dayBodyCellContentInners.eq(col);});function colLeft(col){return colPositions.left(col);}
function colContentLeft(col){return colContentPositions.left(col);}
function colRight(col){return colPositions.right(col);}
function colContentRight(col){return colContentPositions.right(col);}
function getIsCellAllDay(cell){return opt('allDaySlot')&&!cell.row;}
function realCellToDate(cell){var d=cellToDate(0,cell.col);var slotIndex=cell.row;if(opt('allDaySlot')){slotIndex--;}
if(slotIndex>=0){addMinutes(d,minMinute+slotIndex*snapMinutes);}
return d;}
function timePosition(day,time){day=cloneDate(day,true);if(time<addMinutes(cloneDate(day),minMinute)){return 0;}
if(time>=addMinutes(cloneDate(day),maxMinute)){return slotTable.height();}
var slotMinutes=opt('slotMinutes'),minutes=time.getHours()*60+time.getMinutes()-minMinute,slotI=Math.floor(minutes/slotMinutes),slotTop=slotTopCache[slotI];if(slotTop===undefined){slotTop=slotTopCache[slotI]=slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;}
return Math.max(0,Math.round(slotTop-1+slotHeight*((minutes%slotMinutes)/slotMinutes)));}
function getAllDayRow(index){return allDayRow;}
function defaultEventEnd(event){var start=cloneDate(event.start);if(event.allDay){return start;}
return addMinutes(start,opt('defaultEventMinutes'));}
function defaultSelectionEnd(startDate,allDay){if(allDay){return cloneDate(startDate);}
return addMinutes(cloneDate(startDate),opt('slotMinutes'));}
function renderSelection(startDate,endDate,allDay){if(allDay){if(opt('allDaySlot')){renderDayOverlay(startDate,addDays(cloneDate(endDate),1),true);}}else{renderSlotSelection(startDate,endDate);}}
function renderSlotSelection(startDate,endDate){var helperOption=opt('selectHelper');coordinateGrid.build();if(helperOption){var col=dateToCell(startDate).col;if(col>=0&&col<colCnt){var rect=coordinateGrid.rect(0,col,0,col,slotContainer);var top=timePosition(startDate,startDate);var bottom=timePosition(startDate,endDate);if(bottom>top){rect.top=top;rect.height=bottom-top;rect.left+=2;rect.width-=5;if($.isFunction(helperOption)){var helperRes=helperOption(startDate,endDate);if(helperRes){rect.position='absolute';selectionHelper=$(helperRes).css(rect).appendTo(slotContainer);}}else{rect.isStart=true;rect.isEnd=true;selectionHelper=$(slotSegHtml({title:'',start:startDate,end:endDate,className:['fc-select-helper'],editable:false},rect));selectionHelper.css('opacity',opt('dragOpacity'));}
if(selectionHelper){slotBind(selectionHelper);slotContainer.append(selectionHelper);setOuterWidth(selectionHelper,rect.width,true);setOuterHeight(selectionHelper,rect.height,true);}}}}else{renderSlotOverlay(startDate,endDate);}}
function clearSelection(){clearOverlays();if(selectionHelper){selectionHelper.remove();selectionHelper=null;}}
function slotSelectionMousedown(ev){if(ev.which==1&&opt('selectable')){unselect(ev);var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&cell.col==origCell.col&&!getIsCellAllDay(cell)){var d1=realCellToDate(origCell);var d2=realCellToDate(cell);dates=[d1,addMinutes(cloneDate(d1),snapMinutes),d2,addMinutes(cloneDate(d2),snapMinutes)].sort(dateCompare);renderSlotSelection(dates[0],dates[3]);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],false,ev);}
reportSelection(dates[0],dates[3],false,ev);}});}}
function reportDayClick(date,allDay,ev){trigger('dayClick',dayBodyCells[dateToCell(date).col],date,allDay,ev);}
function dragStart(_dragElement,ev,ui){hoverListener.start(function(cell){clearOverlays();if(cell){if(getIsCellAllDay(cell)){renderCellOverlay(cell.row,cell.col,cell.row,cell.col);}else{var d1=realCellToDate(cell);var d2=addMinutes(cloneDate(d1),opt('defaultEventMinutes'));renderSlotOverlay(d1,d2);}}},ev);}
function dragStop(_dragElement,ev,ui){var cell=hoverListener.stop();clearOverlays();if(cell){trigger('drop',_dragElement,realCellToDate(cell),getIsCellAllDay(cell),ev,ui);}}};;function AgendaEventRenderer(){var t=this;t.renderEvents=renderEvents;t.clearEvents=clearEvents;t.slotSegHtml=slotSegHtml;DayEventRenderer.call(t);var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var eventElementHandlers=t.eventElementHandlers;var setHeight=t.setHeight;var getDaySegmentContainer=t.getDaySegmentContainer;var getSlotSegmentContainer=t.getSlotSegmentContainer;var getHoverListener=t.getHoverListener;var getMaxMinute=t.getMaxMinute;var getMinMinute=t.getMinMinute;var timePosition=t.timePosition;var getIsCellAllDay=t.getIsCellAllDay;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var cellToDate=t.cellToDate;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var getSnapHeight=t.getSnapHeight;var getSnapMinutes=t.getSnapMinutes;var getSlotContainer=t.getSlotContainer;var reportEventElement=t.reportEventElement;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var renderDayEvents=t.renderDayEvents;var calendar=t.calendar;var formatDate=calendar.formatDate;var formatDates=calendar.formatDates;t.draggableDayEvent=draggableDayEvent;function renderEvents(events,modifiedEventId){var i,len=events.length,dayEvents=[],slotEvents=[];for(i=0;i<len;i++){if(events[i].allDay){dayEvents.push(events[i]);}else{slotEvents.push(events[i]);}}
if(opt('allDaySlot')){renderDayEvents(dayEvents,modifiedEventId);setHeight();}
renderSlotSegs(compileSlotSegs(slotEvents),modifiedEventId);}
function clearEvents(){getDaySegmentContainer().empty();getSlotSegmentContainer().empty();}
function compileSlotSegs(events){var colCnt=getColCnt(),minMinute=getMinMinute(),maxMinute=getMaxMinute(),d,visEventEnds=$.map(events,slotEventEnd),i,j,seg,colSegs,segs=[];for(i=0;i<colCnt;i++){d=cellToDate(0,i);addMinutes(d,minMinute);colSegs=sliceSegs(events,visEventEnds,d,addMinutes(cloneDate(d),maxMinute-minMinute));colSegs=placeSlotSegs(colSegs);for(j=0;j<colSegs.length;j++){seg=colSegs[j];seg.col=i;segs.push(seg);}}
return segs;}
function sliceSegs(events,visEventEnds,start,end){var segs=[],i,len=events.length,event,eventStart,eventEnd,segStart,segEnd,isStart,isEnd;for(i=0;i<len;i++){event=events[i];eventStart=event.start;eventEnd=visEventEnds[i];if(eventEnd>start&&eventStart<end){if(eventStart<start){segStart=cloneDate(start);isStart=false;}else{segStart=eventStart;isStart=true;}
if(eventEnd>end){segEnd=cloneDate(end);isEnd=false;}else{segEnd=eventEnd;isEnd=true;}
segs.push({event:event,start:segStart,end:segEnd,isStart:isStart,isEnd:isEnd});}}
return segs.sort(compareSlotSegs);}
function slotEventEnd(event){if(event.end){return cloneDate(event.end);}else{return addMinutes(cloneDate(event.start),opt('defaultEventMinutes'));}}
function renderSlotSegs(segs,modifiedEventId){var i,segCnt=segs.length,seg,event,top,bottom,columnLeft,columnRight,columnWidth,width,left,right,html='',eventElements,eventElement,triggerRes,titleElement,height,slotSegmentContainer=getSlotSegmentContainer(),isRTL=opt('isRTL');for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;top=timePosition(seg.start,seg.start);bottom=timePosition(seg.start,seg.end);columnLeft=colContentLeft(seg.col);columnRight=colContentRight(seg.col);columnWidth=columnRight-columnLeft;columnRight-=columnWidth*.025;columnWidth=columnRight-columnLeft;width=columnWidth*(seg.forwardCoord-seg.backwardCoord);if(opt('slotEventOverlap')){width=Math.max((width-(20/2))*2,width);}
if(isRTL){right=columnRight-seg.backwardCoord*columnWidth;left=right-width;}
else{left=columnLeft+seg.backwardCoord*columnWidth;right=left+width;}
left=Math.max(left,columnLeft);right=Math.min(right,columnRight);width=right-left;seg.top=top;seg.left=left;seg.outerWidth=width;seg.outerHeight=bottom-top;html+=slotSegHtml(event,seg);}
slotSegmentContainer[0].innerHTML=html;eventElements=slotSegmentContainer.children();for(i=0;i<segCnt;i++){seg=segs[i];event=seg.event;eventElement=$(eventElements[i]);triggerRes=trigger('eventRender',event,event,eventElement);if(triggerRes===false){eventElement.remove();}else{if(triggerRes&&triggerRes!==true){eventElement.remove();eventElement=$(triggerRes).css({position:'absolute',top:seg.top,left:seg.left}).appendTo(slotSegmentContainer);}
seg.element=eventElement;if(event._id===modifiedEventId){bindSlotSeg(event,eventElement,seg);}else{eventElement[0]._fci=i;}
reportEventElement(event,eventElement);}}
lazySegBind(slotSegmentContainer,segs,bindSlotSeg);for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){seg.vsides=vsides(eventElement,true);seg.hsides=hsides(eventElement,true);titleElement=eventElement.find('.fc-event-title');if(titleElement.length){seg.contentTop=titleElement[0].offsetTop;}}}
for(i=0;i<segCnt;i++){seg=segs[i];if(eventElement=seg.element){eventElement[0].style.width=Math.max(0,seg.outerWidth-seg.hsides)+'px';height=Math.max(0,seg.outerHeight-seg.vsides);eventElement[0].style.height=height+'px';event=seg.event;if(seg.contentTop!==undefined&&height-seg.contentTop<10){eventElement.find('div.fc-event-time').text(formatDate(event.start,opt('timeFormat'))+' - '+event.title);eventElement.find('div.fc-event-title').remove();}
trigger('eventAfterRender',event,event,eventElement);}}}
function slotSegHtml(event,seg){var html="<";var url=event.url;var skinCss=getSkinCss(event,opt);var classes=['fc-event','fc-event-vert'];if(isEventDraggable(event)){classes.push('fc-event-draggable');}
if(seg.isStart){classes.push('fc-event-start');}
if(seg.isEnd){classes.push('fc-event-end');}
classes=classes.concat(event.className);if(event.source){classes=classes.concat(event.source.className||[]);}
if(url){html+="a href='"+htmlEscape(event.url)+"'";}else{html+="div";}
html+=" class='"+classes.join(' ')+"'"+" style="+"'"+"position:absolute;"+"top:"+seg.top+"px;"+"left:"+seg.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>"+"<div class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</div>"+"<div class='fc-event-title'>"+
htmlEscape(event.title||'')+"</div>"+"</div>"+"<div class='fc-event-bg'></div>";if(seg.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-s'>=</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function bindSlotSeg(event,eventElement,seg){var timeElement=eventElement.find('div.fc-event-time');if(isEventDraggable(event)){draggableSlotEvent(event,eventElement,timeElement);}
if(seg.isEnd&&isEventResizable(event)){resizableSlotEvent(event,eventElement,timeElement);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement,seg){var isStart=seg.isStart;var origWidth;var revert;var allDay=true;var dayDelta;var hoverListener=getHoverListener();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var minMinute=getMinMinute();eventElement.draggable({opacity:opt('dragOpacity','month'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);origWidth=eventElement.width();hoverListener.start(function(cell,origCell){clearOverlays();if(cell){revert=false;var origDate=cellToDate(0,origCell.col);var date=cellToDate(0,cell.col);dayDelta=dayDiff(date,origDate);if(!cell.row){renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));resetElement();}else{if(isStart){if(allDay){eventElement.width(colWidth-10);setOuterHeight(eventElement,snapHeight*Math.round((event.end?((event.end-event.start)/MINUTE_MS):opt('defaultEventMinutes'))/snapMinutes));eventElement.draggable('option','grid',[colWidth,1]);allDay=false;}}else{revert=true;}}
revert=revert||(allDay&&!dayDelta);}else{resetElement();revert=true;}
eventElement.draggable('option','revert',revert);},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(revert){resetElement();eventElement.css('filter','');showEvents(event,eventElement);}else{var minuteDelta=0;if(!allDay){minuteDelta=Math.round((eventElement.offset().top-getSlotContainer().offset().top)/snapHeight)*snapMinutes
+minMinute
-(event.start.getHours()*60+event.start.getMinutes());}
eventDrop(this,event,dayDelta,minuteDelta,allDay,ev,ui);}}});function resetElement(){if(!allDay){eventElement.width(origWidth).height('').draggable('option','grid',null);allDay=true;}}}
function draggableSlotEvent(event,eventElement,timeElement){var coordinateGrid=t.getCoordinateGrid();var colCnt=getColCnt();var colWidth=getColWidth();var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();var origPosition;var origCell;var isInBounds,prevIsInBounds;var isAllDay,prevIsAllDay;var colDelta,prevColDelta;var dayDelta;var minuteDelta,prevMinuteDelta;eventElement.draggable({scroll:false,grid:[colWidth,snapHeight],axis:colCnt==1?'y':false,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);coordinateGrid.build();origPosition=eventElement.position();origCell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=prevIsInBounds=true;isAllDay=prevIsAllDay=getIsCellAllDay(origCell);colDelta=prevColDelta=0;dayDelta=0;minuteDelta=prevMinuteDelta=0;},drag:function(ev,ui){var cell=coordinateGrid.cell(ev.pageX,ev.pageY);isInBounds=!!cell;if(isInBounds){isAllDay=getIsCellAllDay(cell);colDelta=Math.round((ui.position.left-origPosition.left)/colWidth);if(colDelta!=prevColDelta){var origDate=cellToDate(0,origCell.col);var col=origCell.col+colDelta;col=Math.max(0,col);col=Math.min(colCnt-1,col);var date=cellToDate(0,col);dayDelta=dayDiff(date,origDate);}
if(!isAllDay){minuteDelta=Math.round((ui.position.top-origPosition.top)/snapHeight)*snapMinutes;}}
if(isInBounds!=prevIsInBounds||isAllDay!=prevIsAllDay||colDelta!=prevColDelta||minuteDelta!=prevMinuteDelta){updateUI();prevIsInBounds=isInBounds;prevIsAllDay=isAllDay;prevColDelta=colDelta;prevMinuteDelta=minuteDelta;}
eventElement.draggable('option','revert',!isInBounds);},stop:function(ev,ui){clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(isInBounds&&(isAllDay||dayDelta||minuteDelta)){eventDrop(this,event,dayDelta,isAllDay?0:minuteDelta,isAllDay,ev,ui);}
else{isInBounds=true;isAllDay=false;colDelta=0;dayDelta=0;minuteDelta=0;updateUI();eventElement.css('filter','');eventElement.css(origPosition);showEvents(event,eventElement);}}});function updateUI(){clearOverlays();if(isInBounds){if(isAllDay){timeElement.hide();eventElement.draggable('option','grid',null);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}
else{updateTimeText(minuteDelta);timeElement.css('display','');eventElement.draggable('option','grid',[colWidth,snapHeight]);}}}
function updateTimeText(minuteDelta){var newStart=addMinutes(cloneDate(event.start),minuteDelta);var newEnd;if(event.end){newEnd=addMinutes(cloneDate(event.end),minuteDelta);}
timeElement.text(formatDates(newStart,newEnd,opt('timeFormat')));}}
function resizableSlotEvent(event,eventElement,timeElement){var snapDelta,prevSnapDelta;var snapHeight=getSnapHeight();var snapMinutes=getSnapMinutes();eventElement.resizable({handles:{s:'.ui-resizable-handle'},grid:snapHeight,start:function(ev,ui){snapDelta=prevSnapDelta=0;hideEvents(event,eventElement);trigger('eventResizeStart',this,event,ev,ui);},resize:function(ev,ui){snapDelta=Math.round((Math.max(snapHeight,eventElement.height())-ui.originalSize.height)/snapHeight);if(snapDelta!=prevSnapDelta){timeElement.text(formatDates(event.start,(!snapDelta&&!event.end)?null:addMinutes(eventEnd(event),snapMinutes*snapDelta),opt('timeFormat')));prevSnapDelta=snapDelta;}},stop:function(ev,ui){trigger('eventResizeStop',this,event,ev,ui);if(snapDelta){eventResize(this,event,0,snapMinutes*snapDelta,ev,ui);}else{showEvents(event,eventElement);}}});}}
function placeSlotSegs(segs){var levels=buildSlotSegLevels(segs);var level0=levels[0];var i;computeForwardSlotSegs(levels);if(level0){for(i=0;i<level0.length;i++){computeSlotSegPressures(level0[i]);}
for(i=0;i<level0.length;i++){computeSlotSegCoords(level0[i],0,0);}}
return flattenSlotSegLevels(levels);}
function buildSlotSegLevels(segs){var levels=[];var i,seg;var j;for(i=0;i<segs.length;i++){seg=segs[i];for(j=0;j<levels.length;j++){if(!computeSlotSegCollisions(seg,levels[j]).length){break;}}
(levels[j]||(levels[j]=[])).push(seg);}
return levels;}
function computeForwardSlotSegs(levels){var i,level;var j,seg;var k;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){seg=level[j];seg.forwardSegs=[];for(k=i+1;k<levels.length;k++){computeSlotSegCollisions(seg,levels[k],seg.forwardSegs);}}}}
function computeSlotSegPressures(seg){var forwardSegs=seg.forwardSegs;var forwardPressure=0;var i,forwardSeg;if(seg.forwardPressure===undefined){for(i=0;i<forwardSegs.length;i++){forwardSeg=forwardSegs[i];computeSlotSegPressures(forwardSeg);forwardPressure=Math.max(forwardPressure,1+forwardSeg.forwardPressure);}
seg.forwardPressure=forwardPressure;}}
function computeSlotSegCoords(seg,seriesBackwardPressure,seriesBackwardCoord){var forwardSegs=seg.forwardSegs;var i;if(seg.forwardCoord===undefined){if(!forwardSegs.length){seg.forwardCoord=1;}
else{forwardSegs.sort(compareForwardSlotSegs);computeSlotSegCoords(forwardSegs[0],seriesBackwardPressure+1,seriesBackwardCoord);seg.forwardCoord=forwardSegs[0].backwardCoord;}
seg.backwardCoord=seg.forwardCoord-
(seg.forwardCoord-seriesBackwardCoord)/(seriesBackwardPressure+1);for(i=0;i<forwardSegs.length;i++){computeSlotSegCoords(forwardSegs[i],0,seg.forwardCoord);}}}
function flattenSlotSegLevels(levels){var segs=[];var i,level;var j;for(i=0;i<levels.length;i++){level=levels[i];for(j=0;j<level.length;j++){segs.push(level[j]);}}
return segs;}
function computeSlotSegCollisions(seg,otherSegs,results){results=results||[];for(var i=0;i<otherSegs.length;i++){if(isSlotSegCollision(seg,otherSegs[i])){results.push(otherSegs[i]);}}
return results;}
function isSlotSegCollision(seg1,seg2){return seg1.end>seg2.start&&seg1.start<seg2.end;}
function compareForwardSlotSegs(seg1,seg2){return seg2.forwardPressure-seg1.forwardPressure||(seg1.backwardCoord||0)-(seg2.backwardCoord||0)||compareSlotSegs(seg1,seg2);}
function compareSlotSegs(seg1,seg2){return seg1.start-seg2.start||(seg2.end-seg2.start)-(seg1.end-seg1.start)||(seg1.event.title||'').localeCompare(seg2.event.title);};;function View(element,calendar,viewName){var t=this;t.element=element;t.calendar=calendar;t.name=viewName;t.opt=opt;t.trigger=trigger;t.isEventDraggable=isEventDraggable;t.isEventResizable=isEventResizable;t.setEventData=setEventData;t.clearEventData=clearEventData;t.eventEnd=eventEnd;t.reportEventElement=reportEventElement;t.triggerEventDestroy=triggerEventDestroy;t.eventElementHandlers=eventElementHandlers;t.showEvents=showEvents;t.hideEvents=hideEvents;t.eventDrop=eventDrop;t.eventResize=eventResize;var defaultEventEnd=t.defaultEventEnd;var normalizeEvent=calendar.normalizeEvent;var reportEventChange=calendar.reportEventChange;var eventsByID={};var eventElementsByID={};var eventElementCouples=[];var options=calendar.options;function opt(name,viewNameOverride){var v=options[name];if($.isPlainObject(v)){return smartProperty(v,viewNameOverride||viewName);}
return v;}
function trigger(name,thisObj){return calendar.trigger.apply(calendar,[name,thisObj||t].concat(Array.prototype.slice.call(arguments,2),[t]));}
function isEventDraggable(event){var source=event.source||{};return firstDefined(event.startEditable,source.startEditable,opt('eventStartEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableDragging');}
function isEventResizable(event){var source=event.source||{};return firstDefined(event.durationEditable,source.durationEditable,opt('eventDurationEditable'),event.editable,source.editable,opt('editable'))&&!opt('disableResizing');}
function setEventData(events){eventsByID={};var i,len=events.length,event;for(i=0;i<len;i++){event=events[i];if(eventsByID[event._id]){eventsByID[event._id].push(event);}else{eventsByID[event._id]=[event];}}}
function clearEventData(){eventsByID={};eventElementsByID={};eventElementCouples=[];}
function eventEnd(event){return event.end?cloneDate(event.end):defaultEventEnd(event);}
function reportEventElement(event,element){eventElementCouples.push({event:event,element:element});if(eventElementsByID[event._id]){eventElementsByID[event._id].push(element);}else{eventElementsByID[event._id]=[element];}}
function triggerEventDestroy(){$.each(eventElementCouples,function(i,couple){t.trigger('eventDestroy',couple.event,couple.event,couple.element);});}
function eventElementHandlers(event,eventElement){eventElement.click(function(ev){if(!eventElement.hasClass('ui-draggable-dragging')&&!eventElement.hasClass('ui-resizable-resizing')){return trigger('eventClick',this,event,ev);}}).hover(function(ev){trigger('eventMouseover',this,event,ev);},function(ev){trigger('eventMouseout',this,event,ev);});}
function showEvents(event,exceptElement){eachEventElement(event,exceptElement,'show');}
function hideEvents(event,exceptElement){eachEventElement(event,exceptElement,'hide');}
function eachEventElement(event,exceptElement,funcName){var elements=eventElementsByID[event._id],i,len=elements.length;for(i=0;i<len;i++){if(!exceptElement||elements[i][0]!=exceptElement[0]){elements[i][funcName]();}}}
function eventDrop(e,event,dayDelta,minuteDelta,allDay,ev,ui){var oldAllDay=event.allDay;var eventId=event._id;moveEvents(eventsByID[eventId],dayDelta,minuteDelta,allDay);trigger('eventDrop',e,event,dayDelta,minuteDelta,allDay,function(){moveEvents(eventsByID[eventId],-dayDelta,-minuteDelta,oldAllDay);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function eventResize(e,event,dayDelta,minuteDelta,ev,ui){var eventId=event._id;elongateEvents(eventsByID[eventId],dayDelta,minuteDelta);trigger('eventResize',e,event,dayDelta,minuteDelta,function(){elongateEvents(eventsByID[eventId],-dayDelta,-minuteDelta);reportEventChange(eventId);},ev,ui);reportEventChange(eventId);}
function moveEvents(events,dayDelta,minuteDelta,allDay){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];if(allDay!==undefined){e.allDay=allDay;}
addMinutes(addDays(e.start,dayDelta,true),minuteDelta);if(e.end){e.end=addMinutes(addDays(e.end,dayDelta,true),minuteDelta);}
normalizeEvent(e,options);}}
function elongateEvents(events,dayDelta,minuteDelta){minuteDelta=minuteDelta||0;for(var e,len=events.length,i=0;i<len;i++){e=events[i];e.end=addMinutes(addDays(eventEnd(e),dayDelta,true),minuteDelta);normalizeEvent(e,options);}}
t.isHiddenDay=isHiddenDay;t.skipHiddenDays=skipHiddenDays;t.getCellsPerWeek=getCellsPerWeek;t.dateToCell=dateToCell;t.dateToDayOffset=dateToDayOffset;t.dayOffsetToCellOffset=dayOffsetToCellOffset;t.cellOffsetToCell=cellOffsetToCell;t.cellToDate=cellToDate;t.cellToCellOffset=cellToCellOffset;t.cellOffsetToDayOffset=cellOffsetToDayOffset;t.dayOffsetToDate=dayOffsetToDate;t.rangeToSegments=rangeToSegments;var hiddenDays=opt('hiddenDays')||[];var isHiddenDayHash=[];var cellsPerWeek;var dayToCellMap=[];var cellToDayMap=[];var isRTL=opt('isRTL');(function(){if(opt('weekends')===false){hiddenDays.push(0,6);}
for(var dayIndex=0,cellIndex=0;dayIndex<7;dayIndex++){dayToCellMap[dayIndex]=cellIndex;isHiddenDayHash[dayIndex]=$.inArray(dayIndex,hiddenDays)!=-1;if(!isHiddenDayHash[dayIndex]){cellToDayMap[cellIndex]=dayIndex;cellIndex++;}}
cellsPerWeek=cellIndex;if(!cellsPerWeek){throw'invalid hiddenDays';}})();function isHiddenDay(day){if(typeof day=='object'){day=day.getDay();}
return isHiddenDayHash[day];}
function getCellsPerWeek(){return cellsPerWeek;}
function skipHiddenDays(date,inc,isExclusive){inc=inc||1;while(isHiddenDayHash[(date.getDay()+(isExclusive?inc:0)+7)%7]){addDays(date,inc);}}
function cellToDate(){var cellOffset=cellToCellOffset.apply(null,arguments);var dayOffset=cellOffsetToDayOffset(cellOffset);var date=dayOffsetToDate(dayOffset);return date;}
function cellToCellOffset(row,col){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;if(typeof row=='object'){col=row.col;row=row.row;}
var cellOffset=row*colCnt+(col*dis+dit);return cellOffset;}
function cellOffsetToDayOffset(cellOffset){var day0=t.visStart.getDay();cellOffset+=dayToCellMap[day0];return Math.floor(cellOffset/cellsPerWeek)*7
+cellToDayMap[(cellOffset%cellsPerWeek+cellsPerWeek)%cellsPerWeek]
-day0;}
function dayOffsetToDate(dayOffset){var date=cloneDate(t.visStart);addDays(date,dayOffset);return date;}
function dateToCell(date){var dayOffset=dateToDayOffset(date);var cellOffset=dayOffsetToCellOffset(dayOffset);var cell=cellOffsetToCell(cellOffset);return cell;}
function dateToDayOffset(date){return dayDiff(date,t.visStart);}
function dayOffsetToCellOffset(dayOffset){var day0=t.visStart.getDay();dayOffset+=day0;return Math.floor(dayOffset/7)*cellsPerWeek
+dayToCellMap[(dayOffset%7+7)%7]
-dayToCellMap[day0];}
function cellOffsetToCell(cellOffset){var colCnt=t.getColCnt();var dis=isRTL?-1:1;var dit=isRTL?colCnt-1:0;var row=Math.floor(cellOffset/colCnt);var col=((cellOffset%colCnt+colCnt)%colCnt)*dis+dit;return{row:row,col:col};}
function rangeToSegments(startDate,endDate){var rowCnt=t.getRowCnt();var colCnt=t.getColCnt();var segments=[];var rangeDayOffsetStart=dateToDayOffset(startDate);var rangeDayOffsetEnd=dateToDayOffset(endDate);var rangeCellOffsetFirst=dayOffsetToCellOffset(rangeDayOffsetStart);var rangeCellOffsetLast=dayOffsetToCellOffset(rangeDayOffsetEnd)-1;for(var row=0;row<rowCnt;row++){var rowCellOffsetFirst=row*colCnt;var rowCellOffsetLast=rowCellOffsetFirst+colCnt-1;var segmentCellOffsetFirst=Math.max(rangeCellOffsetFirst,rowCellOffsetFirst);var segmentCellOffsetLast=Math.min(rangeCellOffsetLast,rowCellOffsetLast);if(segmentCellOffsetFirst<=segmentCellOffsetLast){var segmentCellFirst=cellOffsetToCell(segmentCellOffsetFirst);var segmentCellLast=cellOffsetToCell(segmentCellOffsetLast);var cols=[segmentCellFirst.col,segmentCellLast.col].sort();var isStart=cellOffsetToDayOffset(segmentCellOffsetFirst)==rangeDayOffsetStart;var isEnd=cellOffsetToDayOffset(segmentCellOffsetLast)+1==rangeDayOffsetEnd;segments.push({row:row,leftCol:cols[0],rightCol:cols[1],isStart:isStart,isEnd:isEnd});}}
return segments;}};;function DayEventRenderer(){var t=this;t.renderDayEvents=renderDayEvents;t.draggableDayEvent=draggableDayEvent;t.resizableDayEvent=resizableDayEvent;var opt=t.opt;var trigger=t.trigger;var isEventDraggable=t.isEventDraggable;var isEventResizable=t.isEventResizable;var eventEnd=t.eventEnd;var reportEventElement=t.reportEventElement;var eventElementHandlers=t.eventElementHandlers;var showEvents=t.showEvents;var hideEvents=t.hideEvents;var eventDrop=t.eventDrop;var eventResize=t.eventResize;var getRowCnt=t.getRowCnt;var getColCnt=t.getColCnt;var getColWidth=t.getColWidth;var allDayRow=t.allDayRow;var colLeft=t.colLeft;var colRight=t.colRight;var colContentLeft=t.colContentLeft;var colContentRight=t.colContentRight;var dateToCell=t.dateToCell;var getDaySegmentContainer=t.getDaySegmentContainer;var formatDates=t.calendar.formatDates;var renderDayOverlay=t.renderDayOverlay;var clearOverlays=t.clearOverlays;var clearSelection=t.clearSelection;var getHoverListener=t.getHoverListener;var rangeToSegments=t.rangeToSegments;var cellToDate=t.cellToDate;var cellToCellOffset=t.cellToCellOffset;var cellOffsetToDayOffset=t.cellOffsetToDayOffset;var dateToDayOffset=t.dateToDayOffset;var dayOffsetToCellOffset=t.dayOffsetToCellOffset;function renderDayEvents(events,modifiedEventId){var segments=_renderDayEvents(events,false,true);segmentElementEach(segments,function(segment,element){reportEventElement(segment.event,element);});attachHandlers(segments,modifiedEventId);segmentElementEach(segments,function(segment,element){trigger('eventAfterRender',segment.event,segment.event,element);});}
function renderTempDayEvent(event,adjustRow,adjustTop){var segments=_renderDayEvents([event],true,false);var elements=[];segmentElementEach(segments,function(segment,element){if(segment.row===adjustRow){element.css('top',adjustTop);}
elements.push(element[0]);});return elements;}
function _renderDayEvents(events,doAppend,doRowHeights){var finalContainer=getDaySegmentContainer();var renderContainer=doAppend?$("<div/>"):finalContainer;var segments=buildSegments(events);var html;var elements;calculateHorizontals(segments);html=buildHTML(segments);renderContainer[0].innerHTML=html;elements=renderContainer.children();if(doAppend){finalContainer.append(elements);}
resolveElements(segments,elements);segmentElementEach(segments,function(segment,element){segment.hsides=hsides(element,true);});segmentElementEach(segments,function(segment,element){element.width(Math.max(0,segment.outerWidth-segment.hsides));});segmentElementEach(segments,function(segment,element){segment.outerHeight=element.outerHeight(true);});setVerticals(segments,doRowHeights);return segments;}
function buildSegments(events){var segments=[];for(var i=0;i<events.length;i++){var eventSegments=buildSegmentsForEvent(events[i]);segments.push.apply(segments,eventSegments);}
return segments;}
function buildSegmentsForEvent(event){var startDate=event.start;var endDate=exclEndDay(event);var segments=rangeToSegments(startDate,endDate);for(var i=0;i<segments.length;i++){segments[i].event=event;}
return segments;}
function calculateHorizontals(segments){var isRTL=opt('isRTL');for(var i=0;i<segments.length;i++){var segment=segments[i];var leftFunc=(isRTL?segment.isEnd:segment.isStart)?colContentLeft:colLeft;var rightFunc=(isRTL?segment.isStart:segment.isEnd)?colContentRight:colRight;var left=leftFunc(segment.leftCol);var right=rightFunc(segment.rightCol);segment.left=left;segment.outerWidth=right-left;}}
function buildHTML(segments){var html='';for(var i=0;i<segments.length;i++){html+=buildHTMLForSegment(segments[i]);}
return html;}
function buildHTMLForSegment(segment){var html='';var isRTL=opt('isRTL');var event=segment.event;var url=event.url;var classNames=['fc-event','fc-event-hori'];if(isEventDraggable(event)){classNames.push('fc-event-draggable');}
if(segment.isStart){classNames.push('fc-event-start');}
if(segment.isEnd){classNames.push('fc-event-end');}
classNames=classNames.concat(event.className);if(event.source){classNames=classNames.concat(event.source.className||[]);}
var skinCss=getSkinCss(event,opt);if(url){html+="<a href='"+htmlEscape(url)+"'";}else{html+="<div";}
html+=" class='"+classNames.join(' ')+"'"+" style="+"'"+"position:absolute;"+"left:"+segment.left+"px;"+
skinCss+"'"+">"+"<div class='fc-event-inner'>";if(!event.allDay&&segment.isStart){html+="<span class='fc-event-time'>"+
htmlEscape(formatDates(event.start,event.end,opt('timeFormat')))+"</span>";}
html+="<span class='fc-event-title'>"+
htmlEscape(event.title||'')+"</span>"+"</div>";if(segment.isEnd&&isEventResizable(event)){html+="<div class='ui-resizable-handle ui-resizable-"+(isRTL?'w':'e')+"'>"+"&nbsp;&nbsp;&nbsp;"+"</div>";}
html+="</"+(url?"a":"div")+">";return html;}
function resolveElements(segments,elements){for(var i=0;i<segments.length;i++){var segment=segments[i];var event=segment.event;var element=elements.eq(i);var triggerRes=trigger('eventRender',event,event,element);if(triggerRes===false){element.remove();}
else{if(triggerRes&&triggerRes!==true){triggerRes=$(triggerRes).css({position:'absolute',left:segment.left});element.replaceWith(triggerRes);element=triggerRes;}
segment.element=element;}}}
function setVerticals(segments,doRowHeights){var rowContentHeights=calculateVerticals(segments);var rowContentElements=getRowContentElements();var rowContentTops=[];if(doRowHeights){for(var i=0;i<rowContentElements.length;i++){rowContentElements[i].height(rowContentHeights[i]);}}
for(var i=0;i<rowContentElements.length;i++){rowContentTops.push(rowContentElements[i].position().top);}
segmentElementEach(segments,function(segment,element){element.css('top',rowContentTops[segment.row]+segment.top);});}
function calculateVerticals(segments){var rowCnt=getRowCnt();var colCnt=getColCnt();var rowContentHeights=[];var segmentRows=buildSegmentRows(segments);for(var rowI=0;rowI<rowCnt;rowI++){var segmentRow=segmentRows[rowI];var colHeights=[];for(var colI=0;colI<colCnt;colI++){colHeights.push(0);}
for(var segmentI=0;segmentI<segmentRow.length;segmentI++){var segment=segmentRow[segmentI];segment.top=arrayMax(colHeights.slice(segment.leftCol,segment.rightCol+1));for(var colI=segment.leftCol;colI<=segment.rightCol;colI++){colHeights[colI]=segment.top+segment.outerHeight;}}
rowContentHeights.push(arrayMax(colHeights));}
return rowContentHeights;}
function buildSegmentRows(segments){var rowCnt=getRowCnt();var segmentRows=[];var segmentI;var segment;var rowI;for(segmentI=0;segmentI<segments.length;segmentI++){segment=segments[segmentI];rowI=segment.row;if(segment.element){if(segmentRows[rowI]){segmentRows[rowI].push(segment);}
else{segmentRows[rowI]=[segment];}}}
for(rowI=0;rowI<rowCnt;rowI++){segmentRows[rowI]=sortSegmentRow(segmentRows[rowI]||[]);}
return segmentRows;}
function sortSegmentRow(segments){var sortedSegments=[];var subrows=buildSegmentSubrows(segments);for(var i=0;i<subrows.length;i++){sortedSegments.push.apply(sortedSegments,subrows[i]);}
return sortedSegments;}
function buildSegmentSubrows(segments){segments.sort(compareDaySegments);var subrows=[];for(var i=0;i<segments.length;i++){var segment=segments[i];for(var j=0;j<subrows.length;j++){if(!isDaySegmentCollision(segment,subrows[j])){break;}}
if(subrows[j]){subrows[j].push(segment);}
else{subrows[j]=[segment];}}
return subrows;}
function getRowContentElements(){var i;var rowCnt=getRowCnt();var rowDivs=[];for(i=0;i<rowCnt;i++){rowDivs[i]=allDayRow(i).find('div.fc-day-content > div');}
return rowDivs;}
function attachHandlers(segments,modifiedEventId){var segmentContainer=getDaySegmentContainer();segmentElementEach(segments,function(segment,element,i){var event=segment.event;if(event._id===modifiedEventId){bindDaySeg(event,element,segment);}else{element[0]._fci=i;}});lazySegBind(segmentContainer,segments,bindDaySeg);}
function bindDaySeg(event,eventElement,segment){if(isEventDraggable(event)){t.draggableDayEvent(event,eventElement,segment);}
if(segment.isEnd&&isEventResizable(event)){t.resizableDayEvent(event,eventElement,segment);}
eventElementHandlers(event,eventElement);}
function draggableDayEvent(event,eventElement){var hoverListener=getHoverListener();var dayDelta;eventElement.draggable({delay:50,opacity:opt('dragOpacity'),revertDuration:opt('dragRevertDuration'),start:function(ev,ui){trigger('eventDragStart',eventElement,event,ev,ui);hideEvents(event,eventElement);hoverListener.start(function(cell,origCell,rowDelta,colDelta){eventElement.draggable('option','revert',!cell||!rowDelta&&!colDelta);clearOverlays();if(cell){var origDate=cellToDate(origCell);var date=cellToDate(cell);dayDelta=dayDiff(date,origDate);renderDayOverlay(addDays(cloneDate(event.start),dayDelta),addDays(exclEndDay(event),dayDelta));}else{dayDelta=0;}},ev,'drag');},stop:function(ev,ui){hoverListener.stop();clearOverlays();trigger('eventDragStop',eventElement,event,ev,ui);if(dayDelta){eventDrop(this,event,dayDelta,0,event.allDay,ev,ui);}else{eventElement.css('filter','');showEvents(event,eventElement);}}});}
function resizableDayEvent(event,element,segment){var isRTL=opt('isRTL');var direction=isRTL?'w':'e';var handle=element.find('.ui-resizable-'+direction);var isResizing=false;disableTextSelection(element);element.mousedown(function(ev){ev.preventDefault();}).click(function(ev){if(isResizing){ev.preventDefault();ev.stopImmediatePropagation();}});handle.mousedown(function(ev){if(ev.which!=1){return;}
isResizing=true;var hoverListener=getHoverListener();var rowCnt=getRowCnt();var colCnt=getColCnt();var elementTop=element.css('top');var dayDelta;var helpers;var eventCopy=$.extend({},event);var minCellOffset=dayOffsetToCellOffset(dateToDayOffset(event.start));clearSelection();$('body').css('cursor',direction+'-resize').one('mouseup',mouseup);trigger('eventResizeStart',this,event,ev);hoverListener.start(function(cell,origCell){if(cell){var origCellOffset=cellToCellOffset(origCell);var cellOffset=cellToCellOffset(cell);cellOffset=Math.max(cellOffset,minCellOffset);dayDelta=cellOffsetToDayOffset(cellOffset)-
cellOffsetToDayOffset(origCellOffset);if(dayDelta){eventCopy.end=addDays(eventEnd(event),dayDelta,true);var oldHelpers=helpers;helpers=renderTempDayEvent(eventCopy,segment.row,elementTop);helpers=$(helpers);helpers.find('*').css('cursor',direction+'-resize');if(oldHelpers){oldHelpers.remove();}
hideEvents(event);}
else{if(helpers){showEvents(event);helpers.remove();helpers=null;}}
clearOverlays();renderDayOverlay(event.start,addDays(exclEndDay(event),dayDelta));}},ev);function mouseup(ev){trigger('eventResizeStop',this,event,ev);$('body').css('cursor','');hoverListener.stop();clearOverlays();if(dayDelta){eventResize(this,event,dayDelta,0,ev);}
setTimeout(function(){isResizing=false;},0);}});}}
function isDaySegmentCollision(segment,otherSegments){for(var i=0;i<otherSegments.length;i++){var otherSegment=otherSegments[i];if(otherSegment.leftCol<=segment.rightCol&&otherSegment.rightCol>=segment.leftCol){return true;}}
return false;}
function segmentElementEach(segments,callback){for(var i=0;i<segments.length;i++){var segment=segments[i];var element=segment.element;if(element){callback(segment,element,i);}}}
function compareDaySegments(a,b){return(b.rightCol-b.leftCol)-(a.rightCol-a.leftCol)||b.event.allDay-a.event.allDay||a.event.start-b.event.start||(a.event.title||'').localeCompare(b.event.title)};;function SelectionManager(){var t=this;t.select=select;t.unselect=unselect;t.reportSelection=reportSelection;t.daySelectionMousedown=daySelectionMousedown;var opt=t.opt;var trigger=t.trigger;var defaultSelectionEnd=t.defaultSelectionEnd;var renderSelection=t.renderSelection;var clearSelection=t.clearSelection;var selected=false;if(opt('selectable')&&opt('unselectAuto')){$(document).mousedown(function(ev){var ignore=opt('unselectCancel');if(ignore){if($(ev.target).parents(ignore).length){return;}}
unselect(ev);});}
function select(startDate,endDate,allDay){unselect();if(!endDate){endDate=defaultSelectionEnd(startDate,allDay);}
renderSelection(startDate,endDate,allDay);reportSelection(startDate,endDate,allDay);}
function unselect(ev){if(selected){selected=false;clearSelection();trigger('unselect',null,ev);}}
function reportSelection(startDate,endDate,allDay,ev){selected=true;trigger('select',null,startDate,endDate,allDay,ev);}
function daySelectionMousedown(ev){var cellToDate=t.cellToDate;var getIsCellAllDay=t.getIsCellAllDay;var hoverListener=t.getHoverListener();var reportDayClick=t.reportDayClick;if(ev.which==1&&opt('selectable')){unselect(ev);var _mousedownElement=this;var dates;hoverListener.start(function(cell,origCell){clearSelection();if(cell&&getIsCellAllDay(cell)){dates=[cellToDate(origCell),cellToDate(cell)].sort(dateCompare);renderSelection(dates[0],dates[1],true);}else{dates=null;}},ev);$(document).one('mouseup',function(ev){hoverListener.stop();if(dates){if(+dates[0]==+dates[1]){reportDayClick(dates[0],true,ev);}
reportSelection(dates[0],dates[1],true,ev);}});}}};;function OverlayManager(){var t=this;t.renderOverlay=renderOverlay;t.clearOverlays=clearOverlays;var usedOverlays=[];var unusedOverlays=[];function renderOverlay(rect,parent){var e=unusedOverlays.shift();if(!e){e=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>");}
if(e[0].parentNode!=parent[0]){e.appendTo(parent);}
usedOverlays.push(e.css(rect).show());return e;}
function clearOverlays(){var e;while(e=usedOverlays.shift()){unusedOverlays.push(e.hide().unbind());}}};;function CoordinateGrid(buildFunc){var t=this;var rows;var cols;t.build=function(){rows=[];cols=[];buildFunc(rows,cols);};t.cell=function(x,y){var rowCnt=rows.length;var colCnt=cols.length;var i,r=-1,c=-1;for(i=0;i<rowCnt;i++){if(y>=rows[i][0]&&y<rows[i][1]){r=i;break;}}
for(i=0;i<colCnt;i++){if(x>=cols[i][0]&&x<cols[i][1]){c=i;break;}}
return(r>=0&&c>=0)?{row:r,col:c}:null;};t.rect=function(row0,col0,row1,col1,originElement){var origin=originElement.offset();return{top:rows[row0][0]-origin.top,left:cols[col0][0]-origin.left,width:cols[col1][1]-cols[col0][0],height:rows[row1][1]-rows[row0][0]};};};;function HoverListener(coordinateGrid){var t=this;var bindType;var change;var firstCell;var cell;t.start=function(_change,ev,_bindType){change=_change;firstCell=cell=null;coordinateGrid.build();mouse(ev);bindType=_bindType||'mousemove';$(document).bind(bindType,mouse);};function mouse(ev){_fixUIEvent(ev);var newCell=coordinateGrid.cell(ev.pageX,ev.pageY);if(!newCell!=!cell||newCell&&(newCell.row!=cell.row||newCell.col!=cell.col)){if(newCell){if(!firstCell){firstCell=newCell;}
change(newCell,firstCell,newCell.row-firstCell.row,newCell.col-firstCell.col);}else{change(newCell,firstCell);}
cell=newCell;}}
t.stop=function(){$(document).unbind(bindType,mouse);return cell;};}
function _fixUIEvent(event){if(event.pageX===undefined){event.pageX=event.originalEvent.pageX;event.pageY=event.originalEvent.pageY;}};;function HorizontalPositionCache(getElement){var t=this,elements={},lefts={},rights={};function e(i){return elements[i]=elements[i]||getElement(i);}
t.left=function(i){return lefts[i]=lefts[i]===undefined?e(i).position().left:lefts[i];};t.right=function(i){return rights[i]=rights[i]===undefined?t.left(i)+e(i).width():rights[i];};t.clear=function(){elements={};lefts={};rights={};};};;})(jQuery);;

/* /web_calendar/static/src/js/widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_calendar.widgets',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({init:function(parent,dataset,buttons,options,data_template){this.dataset=dataset;this._buttons=buttons||false;this.options=options;this.data_template=data_template||{};this.$input=$();var self=this;this._super(parent,{title:this.get_title(),size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self.quick_add()){self.focus();}}},{text:_t("Edit"),click:function(){self.slow_add();}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widged:this})});},get_title:function(){var parent=this.getParent();if(_.isUndefined(parent)){return _t("Create");}
var title=(_.isUndefined(parent.field_widget))?(parent.title||parent.string||parent.name):(parent.field_widget.string||parent.field_widget.name||'');return _t("Create: ")+title;},start:function(){var self=this;if(this.options.disable_quick_create){this.slow_create();return;}
this.on('added',this,function(){self.close();});this.$input=this.$('input').keyup(function enterHandler(e){if(e.keyCode===$.ui.keyCode.ENTER){self.$input.off('keyup',enterHandler);if(!self.quick_add()){self.$input.on('keyup',enterHandler);}}else if(e.keyCode===$.ui.keyCode.ESCAPE&&self._buttons){self.close();}});return this._super();},focus:function(){this.$input.focus();},quick_add:function(){var val=this.$input.val().trim();return(val)?this.quick_create({'name':val}):false;},slow_add:function(){var val=this.$input.val().trim();this.slow_create(_.isEmpty(val)?{}:{'name':val});},quick_create:function(data,options){var self=this;return this.dataset.create($.extend({},this.data_template,data),options).then(function(id){self.trigger('added',id);self.$input.val("");},function(r,event){event.preventDefault();self.slow_create(data);});},slow_create:function(_data){var self=this;var def=$.Deferred();var defaults={};var created=false;_.each($.extend({},this.data_template,_data),function(val,field_name){defaults['default_'+field_name]=val;});var pop=new form_common.FormViewDialog(this,{res_model:this.dataset.model,context:this.dataset.get_context(defaults),title:this.get_title(),disable_multiple_selection:true,create_function:function(data,options){return self.dataset.create(data,options).fail(function(r){if(!r.data.message){throw new Error(r);}});},read_function:function(){return self.dataset.read_ids.apply(self.dataset,arguments).fail(function(r){if(!r.data.message){throw new Error(r);}});}}).open();pop.on('closed',self,function(){if(def.state()==="pending"){def.resolve();}});pop.on('create_completed',self,function(){created=true;self.trigger('slowadded');});def.then(function(){if(created){var parent=self.getParent();parent.$calendar.fullCalendar('refetchEvents');}
self.close();self.trigger("closed");});return def;},});var Sidebar=Widget.extend({template:'CalendarView.sidebar',start:function(){this.filter=new SidebarFilter(this,this.getParent());return $.when(this._super(),this.filter.appendTo(this.$el));}});var SidebarFilter=Widget.extend({events:{'click .o_calendar_contact':'on_click',},template:'CalendarView.sidebar.filters',init:function(parent,view){this._super(parent);this.view=view;},render:function(){var self=this;var filters=_.filter(this.view.get_all_filters_ordered(),function(filter){return _.contains(self.view.now_filter_ids,filter.value);});this.$('.o_calendar_contacts').html(QWeb.render('CalendarView.sidebar.contacts',{filters:filters}));},on_click:function(e){if(e.target.tagName!=='INPUT'){$(e.currentTarget).find('input').click();return;}
this.view.all_filters[e.target.value].is_checked=e.target.checked;this.trigger_up('reload_events');},});return{QuickCreate:QuickCreate,Sidebar:Sidebar,SidebarFilter:SidebarFilter};});;

/* /web_calendar/static/src/js/web_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('web_calendar.CalendarView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var formats=require('web.formats');var Model=require('web.DataModel');var time=require('web.time');var utils=require('web.utils');var View=require('web.View');var widgets=require('web_calendar.widgets');var local_storage=require('web.local_storage');var CompoundDomain=data.CompoundDomain;var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;function get_fc_defaultOptions(){var dateFormat=time.strftime_to_moment_format(_t.database.parameters.date_format);var timeFormat=time.strftime_to_moment_format(_t.database.parameters.time_format).replace('A','TT');var conversions=[['YYYY','yyyy'],['YY','y'],['DDDD','dddd'],['DD','dd']];_.each(conversions,function(conv){dateFormat=dateFormat.replace(conv[0],conv[1]);});var hourFormat=function(timeFormat){if(/H/.test(timeFormat))
return'HH:mm';return'hh TT';};return{weekNumberTitle:_t("W"),allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:moment()._locale._week.dow,weekNumberCalculation:function(date){return moment(date).week();},axisFormat:hourFormat(timeFormat),timeFormat:timeFormat+' {- '+timeFormat+'}',weekNumbers:true,titleFormat:{month:'MMMM yyyy',week:"w",day:dateFormat,},columnFormat:{month:'ddd',week:'ddd '+dateFormat,day:'dddd '+dateFormat,},weekMode:'liquid',snapMinutes:15,};}
function is_virtual_id(id){return typeof id==="string"&&id.indexOf('-')>=0;}
function isNullOrUndef(value){return _.isUndefined(value)||_.isNull(value);}
var CalendarView=View.extend({custom_events:{reload_events:function(){this.$calendar.fullCalendar('refetchEvents');},},defaults:_.extend({},View.prototype.defaults,{confirm_on_delete:true,}),display_name:_lt('Calendar'),events:{'click .o_calendar_sidebar_toggler':'toggle_full_width',},icon:'fa-calendar',quick_create_instance:widgets.QuickCreate,template:"CalendarView",init:function(){this._super.apply(this,arguments);this.color_map={};this.range_start=null;this.range_stop=null;this.selected_filters=[];this.info_fields=[];this.title=(this.options.action)?this.options.action.name:'';this.shown=$.Deferred();this.current_start=null;this.current_end=null;this.previous_ids=[];var attrs=this.fields_view.arch.attrs;if(!attrs.date_start){throw new Error(_t("Calendar view has not defined 'date_start' attribute."));}
this.fields=this.fields_view.fields;this.name=this.fields_view.name||attrs.string;this.mode=attrs.mode;this.date_start=attrs.date_start;this.date_delay=attrs.date_delay;this.date_stop=attrs.date_stop;this.all_day=attrs.all_day;this.how_display_event='';this.attendee_people=attrs.attendee;this.editable=!this.options.read_only_mode&&!this.fields[this.date_start].readonly;this.quick_add_pop=(isNullOrUndef(attrs.quick_add)||utils.toBoolElse(attrs.quick_add,true));if(!isNullOrUndef(attrs.display)){this.how_display_event=attrs.display;}
if(isNullOrUndef(attrs.event_open_popup)||!utils.toBoolElse(attrs.event_open_popup,true)){this.open_popup_action=false;}else{this.open_popup_action=attrs.event_open_popup;}
this.useContacts=!isNullOrUndef(attrs.use_contacts)&&_.str.toBool(attrs.use_contacts);this.colorIsAttendee=!(isNullOrUndef(attrs.color_is_attendee)||!utils.toBoolElse(attrs.color_is_attendee,true));if(isNullOrUndef(this.options.sidebar)){this.useContacts=false;this.colorIsAttendee=false;this.attendee_people=undefined;}
if(isNullOrUndef(attrs.avatar_model)){this.avatar_model=null;}else{this.avatar_model=attrs.avatar_model;}
if(isNullOrUndef(attrs.avatar_title)){this.avatar_title=this.avatar_model;}else{this.avatar_title=attrs.avatar_title;}
if(isNullOrUndef(attrs.avatar_filter)){this.avatar_filter=this.avatar_model;}else{this.avatar_filter=attrs.avatar_filter;}
this.color_field=attrs.color;if(this.color_field&&this.selected_filters.length===0){var default_filter;if((default_filter=this.dataset.context['calendar_default_'+this.color_field])){this.selected_filters.push(default_filter+'');}}
for(var fld=0;fld<this.fields_view.arch.children.length;fld++){this.info_fields.push(this.fields_view.arch.children[fld].attrs.name);}},willStart:function(){var self=this;var write_def=this.dataset.call("check_access_rights",["write",false]);var create_def=this.dataset.call("check_access_rights",["create",false]);return $.when(write_def,create_def,this._super()).then(function(write,create){self.write_right=write;self.create_right=create;});},start:function(){this.$calendar=this.$(".o_calendar_widget");this.$sidebar_container=this.$(".o_calendar_sidebar_container");this.$el.addClass(this.fields_view.arch.attrs.class);this.shown.done(this._do_show_init.bind(this));return this._super();},destroy:function(){if(this.$calendar){this.$calendar.fullCalendar('destroy');}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');}
this._super.apply(this,arguments);},_do_show_init:function(){this.init_calendar().then(function(){$(window).trigger('resize');});},render_buttons:function($node){var self=this;this.$buttons=$(QWeb.render("CalendarView.buttons",{'widget':this}));this.$buttons.on('click','button.o_calendar_button_new',function(){self.dataset.index=null;self.do_switch_view('form');});var bindCalendarButton=function(selector,arg1,arg2){self.$buttons.on('click',selector,_.bind(self.$calendar.fullCalendar,self.$calendar,arg1,arg2));};bindCalendarButton('.o_calendar_button_prev','prev');bindCalendarButton('.o_calendar_button_today','today');bindCalendarButton('.o_calendar_button_next','next');bindCalendarButton('.o_calendar_button_day','changeView','agendaDay');bindCalendarButton('.o_calendar_button_week','changeView','agendaWeek');bindCalendarButton('.o_calendar_button_month','changeView','month');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},toggle_full_width:function(){var full_width=(local_storage.getItem('web_calendar_full_width')!=='true');local_storage.setItem('web_calendar_full_width',full_width);this.toggle_sidebar(!full_width);this.$calendar.fullCalendar('render');},toggle_sidebar:function(display){this.sidebar.do_toggle(display);this.$('.o_calendar_sidebar_toggler').toggleClass('fa-close',display).toggleClass('fa-chevron-left',!display).attr('title',display?_('Close Sidebar'):_('Open Sidebar'));this.$sidebar_container.toggleClass('o_sidebar_hidden',!display);},get_fc_init_options:function(){var self=this;return $.extend({},get_fc_defaultOptions(),{defaultView:(this.mode=="month")?"month":((this.mode=="week")?"agendaWeek":((this.mode=="day")?"agendaDay":"agendaWeek")),header:false,selectable:!this.options.read_only_mode&&this.create_right,selectHelper:true,editable:this.editable,droppable:true,viewRender:function(view){var mode=(view.name=="month")?"month":((view.name=="agendaWeek")?"week":"day");if(self.$buttons!==undefined){self.$buttons.find('.active').removeClass('active');self.$buttons.find('.o_calendar_button_'+mode).addClass('active');}
var title=self.title+' ('+((mode==="week")?_t("Week "):"")+view.title+")";self.set({'title':title});self.$calendar.fullCalendar('option','height',Math.max(290,parseInt(self.$('.o_calendar_view').height())));setTimeout(function(){var $fc_view=self.$calendar.find('.fc-view');var width=$fc_view.find('> table').width();$fc_view.find('> div').css('width',(width>$fc_view.width())?width:'100%');},0);},windowResize:function(){self.$calendar.fullCalendar('render');},eventDrop:function(event,_day_delta,_minute_delta,_all_day,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventResize:function(event,_day_delta,_minute_delta,_revertFunc){var data=self.get_event_data(event);self.proxy('update_record')(event._id,data);},eventRender:function(event,element,view){element.find('.fc-event-title').html(event.title+event.attendee_avatars);},eventAfterRender:function(event,element,view){if((view.name!=='month')&&(((event.end-event.start)/60000)<=30)){var current_title=$(element.find('.fc-event-time')).text();var new_title=current_title.substr(0,current_title.indexOf("<img")>0?current_title.indexOf("<img"):current_title.length);element.find('.fc-event-time').html(new_title);}},eventClick:function(event){self.open_event(event._id,event.title);},select:function(start_date,end_date,all_day,_js_event,_view){var data_template=self.get_event_data({start:start_date,end:end_date,allDay:all_day,});self.open_quick_create(data_template);},unselectAuto:false,});},calendarMiniChanged:function(context){return function(datum,obj){var curView=context.$calendar.fullCalendar('getView');var curDate=new Date(obj.currentYear,obj.currentMonth,obj.currentDay);if(curView.name=="agendaWeek"){if(curDate<=curView.end&&curDate>=curView.start){context.$calendar.fullCalendar('changeView','agendaDay');}}
else if(curView.name!="agendaDay"||(curView.name=="agendaDay"&&moment(curDate).diff(moment(curView.start))===0)){context.$calendar.fullCalendar('changeView','agendaWeek');}
context.$calendar.fullCalendar('gotoDate',obj.currentYear,obj.currentMonth,obj.currentDay);};},init_calendar:function(){var defs=[];if(!this.sidebar){var translate=get_fc_defaultOptions();this.sidebar=new widgets.Sidebar(this);defs.push(this.sidebar.appendTo(this.$sidebar_container));this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({onSelect:this.calendarMiniChanged(this),dayNamesMin:translate.dayNamesShort,monthNames:translate.monthNamesShort,firstDay:translate.firstDay,});defs.push(this.extraSideBar());this.$sidebar_container.append($('<i>').addClass('o_calendar_sidebar_toggler fa'));this.toggle_sidebar((local_storage.getItem('web_calendar_full_width')!=='true'));}
this.$calendar.fullCalendar(this.get_fc_init_options());return $.when.apply($,defs);},extraSideBar:function(){return $.when();},get_quick_create_class:function(){return widgets.QuickCreate;},open_quick_create:function(data_template){if(!isNullOrUndef(this.quick)){return this.quick.close();}
var QuickCreate=this.get_quick_create_class();this.options.disable_quick_create=this.options.disable_quick_create||!this.quick_add_pop;this.quick=new QuickCreate(this,this.dataset,true,this.options,data_template);this.quick.on('added',this,this.quick_created).on('slowadded',this,this.slow_created).on('closed',this,function(){delete this.quick;this.$calendar.fullCalendar('unselect');});if(!this.options.disable_quick_create){this.quick.open();this.quick.focus();}else{this.quick.start();}},refresh_event:function(id){var self=this;if(is_virtual_id(id)){console.warn("Unwise use of refresh_event on a virtual ID.");}
this.dataset.read_ids([id],_.keys(this.fields)).done(function(incomplete_records){self.perform_necessary_name_gets(incomplete_records).then(function(records){var new_event=self.event_data_transform(records[0]);var event_objs=self.$calendar.fullCalendar('clientEvents',id);if(event_objs.length==1){var event_obj=event_objs[0];_(new_event).each(function(value,key){event_obj[key]=value;});self.$calendar.fullCalendar('updateEvent',event_obj);}else{var $fc_view=self.$calendar.find('.fc-view');var scrollPosition=$fc_view.scrollLeft();$fc_view.scrollLeft(0);self.$calendar.fullCalendar('renderEvent',new_event);$fc_view.scrollLeft(scrollPosition);self.$calendar.fullCalendar('clientEvents',id)[0].source=self.event_source;}});});},get_color:function(key){if(this.color_map[key]){return this.color_map[key];}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},perform_necessary_name_gets:function(evts){var def=$.Deferred();var self=this;var to_get={};_(this.info_fields).each(function(fieldname){if(!_(["many2one"]).contains(self.fields[fieldname].type))
return;to_get[fieldname]=[];_(evts).each(function(evt){var value=evt[fieldname];if(value===false||(value instanceof Array)){return;}
to_get[fieldname].push(value);});if(to_get[fieldname].length===0){delete to_get[fieldname];}});var defs=_(to_get).map(function(ids,fieldname){return(new Model(self.fields[fieldname].relation)).call('name_get',ids).then(function(vals){return[fieldname,vals];});});$.when.apply(this,defs).then(function(){var values=arguments;_(values).each(function(value){var fieldname=value[0];var name_gets=value[1];_(name_gets).each(function(name_get){_(evts).chain().filter(function(e){return e[fieldname]==name_get[0];}).each(function(evt){evt[fieldname]=name_get;});});});def.resolve(evts);});return def;},event_data_transform:function(evt){var self=this;var date_start;var date_stop;var date_delay=evt[this.date_delay]||1.0,all_day=this.all_day?evt[this.all_day]:false,res_computed_text='',the_title='',attendees=[];if(!all_day){date_start=time.auto_str_to_date(evt[this.date_start]);date_stop=this.date_stop?time.auto_str_to_date(evt[this.date_stop]):null;}else{date_start=time.auto_str_to_date(evt[this.date_start].split(' ')[0],'start');date_stop=this.date_stop?time.auto_str_to_date(evt[this.date_stop].split(' ')[0],'start'):null;}
if(this.info_fields){var temp_ret={};res_computed_text=this.how_display_event;_.each(this.info_fields,function(fieldname){var value=evt[fieldname];if(_.contains(["many2one"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value[1];}
else if(_.contains(["date","datetime"],self.fields[fieldname].type)){temp_ret[fieldname]=formats.format_value(value,self.fields[fieldname]);}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else if(_.contains(["one2many","many2many"],self.fields[fieldname].type)){if(value===false){temp_ret[fieldname]=null;}
else if(value instanceof Array){temp_ret[fieldname]=value;}
else{throw new Error("Incomplete data received from dataset for record "+evt.id);}}
else{temp_ret[fieldname]=value;}
res_computed_text=res_computed_text.replace("["+fieldname+"]",temp_ret[fieldname]);});if(res_computed_text.length){the_title=res_computed_text;}
else{var res_text=[];_.each(temp_ret,function(val,key){if(typeof(val)==='boolean'&&val===false){}
else{res_text.push(val);}});the_title=res_text.join(', ');}
the_title=_.escape(the_title);var the_title_avatar='';if(!_.isUndefined(this.attendee_people)){var MAX_ATTENDEES=3;var attendee_showed=0;var attendee_other='';_.each(temp_ret[this.attendee_people],function(the_attendee_people){attendees.push(the_attendee_people);attendee_showed+=1;if(attendee_showed<=MAX_ATTENDEES){if(self.avatar_model!==null){the_title_avatar+='<img title="'+_.escape(self.all_attendees[the_attendee_people])+'" class="o_attendee_head"  \
                                                        src="/web/image/'+self.avatar_model+'/'+the_attendee_people+'/image_small"></img>';}
else{if(!self.colorIsAttendee||the_attendee_people!=temp_ret[self.color_field]){var tempColor=(self.all_filters[the_attendee_people]!==undefined)?self.all_filters[the_attendee_people].color:(self.all_filters[-1]?self.all_filters[-1].color:1);the_title_avatar+='<i class="fa fa-user o_attendee_head o_underline_color_'+tempColor+'" title="'+_.escape(self.all_attendees[the_attendee_people])+'" ></i>';}}}
else{attendee_other+=_.escape(self.all_attendees[the_attendee_people])+", ";}});if(attendee_other.length>2){the_title_avatar+='<span class="o_attendee_head" title="'+attendee_other.slice(0,-2)+'">+</span>';}}}
if(!date_stop&&date_delay){var m_start=moment(date_start).add(date_delay,'hours');date_stop=m_start.toDate();}
var r={'start':moment(date_start).toString(),'end':moment(date_stop).toString(),'title':the_title,'attendee_avatars':the_title_avatar,'allDay':(this.fields[this.date_start].type=='date'||(this.all_day&&evt[this.all_day])||false),'id':evt.id,'attendees':attendees};var color_key=evt[this.color_field];if(!self.useContacts||self.all_filters[color_key]!==undefined){if(color_key){if(typeof color_key==="object"){color_key=color_key[0];}
r.className='o_calendar_color_'+this.get_color(color_key);}}else{r.className='o_calendar_color_'+(self.all_filters[-1]?self.all_filters[-1].color:1);}
return r;},get_event_data:function(event){var date_start_day;var date_stop_day;var diff_seconds;var data={name:event.title};var event_end=event.end;if(event_end===null){var m_date=moment(event.start).add(2,'hours');event_end=m_date.toDate();}
if(event.allDay){if(event_end===null||_.isUndefined(event_end)){event_end=new Date(event.start);}
if(this.all_day){date_start_day=new Date(Date.UTC(event.start.getFullYear(),event.start.getMonth(),event.start.getDate()));date_stop_day=new Date(Date.UTC(event_end.getFullYear(),event_end.getMonth(),event_end.getDate()));}
else{date_start_day=new Date(event.start.getFullYear(),event.start.getMonth(),event.start.getDate(),7);date_stop_day=new Date(event_end.getFullYear(),event_end.getMonth(),event_end.getDate(),19);}
data[this.date_start]=time.auto_date_to_str(date_start_day,this.fields[this.date_start].type);if(this.date_stop){data[this.date_stop]=time.auto_date_to_str(date_stop_day,this.fields[this.date_stop].type);}
diff_seconds=Math.round((date_stop_day.getTime()-date_start_day.getTime())/1000);}
else{data[this.date_start]=time.auto_date_to_str(event.start,this.fields[this.date_start].type);if(this.date_stop){data[this.date_stop]=time.auto_date_to_str(event_end,this.fields[this.date_stop].type);}
diff_seconds=Math.round((event_end.getTime()-event.start.getTime())/1000);}
if(this.all_day){data[this.all_day]=event.allDay;}
if(this.date_delay){data[this.date_delay]=diff_seconds/3600;}
return data;},do_search:function(domain,context,_group_by){var self=this;this.shown.done(function(){self._do_search(domain,context,_group_by);});},_do_search:function(domain,context,_group_by){var self=this;if(!self.all_filters){self.all_filters={};}
if(!_.isUndefined(this.event_source)){this.$calendar.fullCalendar('removeEventSource',this.event_source);}
this.event_source={events:function(start,end,callback){if(isNaN(start)||isNaN(end)){return;}
var current_event_source=self.event_source;var event_domain=self.get_range_domain(domain,start,end);if(self.useContacts&&(!self.all_filters[-1]||!self.all_filters[-1].is_checked)){var partner_ids=$.map(self.all_filters,function(o){if(o.is_checked){return o.value;}});if(!_.isEmpty(partner_ids)){event_domain=new data.CompoundDomain(event_domain,[[self.attendee_people,'in',partner_ids]]);}}
self.current_start=start;self.current_end=end;self.dataset.read_slice(_.keys(self.fields),{offset:0,domain:event_domain,context:context,}).done(function(events){if(self.current_start.getTime()!=start.getTime()||self.current_end.getTime()!=end.getTime()){self.dataset.ids=self.previous_ids;return;}
self.previous_ids=self.dataset.ids.slice();if(self.dataset.index===null){if(events.length){self.dataset.index=0;}}else if(self.dataset.index>=events.length){self.dataset.index=events.length?0:null;}
if(self.event_source!==current_event_source){console.log("Consecutive ``do_search`` called. Cancelling.");return;}
if(!self.useContacts&&self.fields[self.color_field]){var filter_item;self.now_filter_ids=[];var color_field=self.fields[self.color_field];_.each(events,function(e){var key,val=null;if(color_field.type=="selection"){key=e[self.color_field];val=_.find(color_field.selection,function(name){return name[0]===key;});}else{key=e[self.color_field][0];val=e[self.color_field];}
if(!self.all_filters[key]){filter_item={value:key,label:val[1],color:self.get_color(key),avatar_model:(utils.toBoolElse(self.avatar_filter,true)?self.avatar_filter:false),is_checked:true};self.all_filters[key]=filter_item;}
if(!_.contains(self.now_filter_ids,key)){self.now_filter_ids.push(key);}});if(self.sidebar){self.sidebar.filter.render();events=$.map(events,function(e){var key=color_field.type=="selection"?e[self.color_field]:e[self.color_field][0];if(_.contains(self.now_filter_ids,key)&&self.all_filters[key].is_checked){return e;}
return null;});}}
var all_attendees=$.map(events,function(e){return e[self.attendee_people];});all_attendees=_.chain(all_attendees).flatten().uniq().value();self.all_attendees={};if(self.avatar_title!==null){new Model(self.avatar_title).query(["name"]).filter([["id","in",all_attendees]]).all().then(function(result){_.each(result,function(item){self.all_attendees[item.id]=item.name;});}).done(function(){return self.perform_necessary_name_gets(events).then(callback);});}
else{_.each(all_attendees,function(item){self.all_attendees[item]='';});return self.perform_necessary_name_gets(events).then(callback);}});},eventDataTransform:function(event){return self.event_data_transform(event);},};this.$calendar.fullCalendar('addEventSource',this.event_source);},get_range_domain:function(domain,start,end){var format=time.datetime_to_str;var extend_domain=[[this.date_start,'<=',format(end)]];if(this.date_stop){extend_domain.push([this.date_stop,'>=',format(start)]);}else if(!this.date_delay){extend_domain.push([this.date_start,'>=',format(start)]);}
return new CompoundDomain(domain,extend_domain);},get_all_filters_ordered:function(){return _.values(this.all_filters).sort(function(f1,f2){return _.string.naturalCmp(f1.label,f2.label);});},update_record:function(id,data){var self=this;var event_id;delete(data.name);var index=this.dataset.get_id_index(id);if(index!==null){event_id=this.dataset.ids[index];this.dataset.write(event_id,data,{context:{from_ui:true}}).always(function(){if(is_virtual_id(event_id)){self.$calendar.fullCalendar('refetchEvents');}else{self.refresh_event(event_id);}});}
return false;},open_event:function(id,title){var self=this;if(!this.open_popup_action){var index=this.dataset.get_id_index(id);this.dataset.index=index;if(this.write_right){this.do_switch_view('form',{mode:"edit"});}else{this.do_switch_view('form',{mode:"view"});}}
else{new form_common.FormViewDialog(this,{res_model:this.model,res_id:parseInt(id).toString()===id?parseInt(id):id,context:this.dataset.get_context(),title:title,view_id:+this.open_popup_action,readonly:true,buttons:[{text:_t("Edit"),classes:'btn-primary',close:true,click:function(){self.dataset.index=self.dataset.get_id_index(id);self.do_switch_view('form',{mode:"edit"});}},{text:_t("Delete"),close:true,click:function(){self.remove_event(id);}},{text:_t("Close"),close:true}]}).open();}
return false;},do_show:function(){this.do_push_state({});this.shown.resolve();return this._super();},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},quick_created:function(id){this.dataset.ids=this.dataset.ids.concat([id]);this.dataset.trigger("dataset_changed",id);this.refresh_event(id);},slow_created:function(){var self=this;if(self.sidebar){self.sidebar.filter.is_loaded=false;}
self.$calendar.fullCalendar('refetchEvents');},remove_event:function(id){var self=this;function do_it(){return $.when(self.dataset.unlink([id])).then(function(){self.$calendar.fullCalendar('removeEvents',id);});}
if(this.options.confirm_on_delete){if(confirm(_t("Are you sure you want to delete this record ?"))){return do_it();}}else
return do_it();},});core.view_registry.add('calendar',CalendarView);return CalendarView;});;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var form_common=require('web.form_common');var Pager=require('web.Pager');var View=require('web.View');var ajax=require('web.ajax');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var DiagramView=View.extend({display_name:_lt('Diagram'),icon:'fa-code-fork',multi_record:false,searchable:false,init:function(){this._super.apply(this,arguments);this.domain=this.dataset._domain||[];this.context={};this.ids=this.dataset.ids;if(this.ids&&this.ids.length){this.id=this.ids[this.dataset.index||0];}
this.fields=this.fields_view.fields;this.nodes=this.fields_view.arch.children[0];this.connectors=this.fields_view.arch.children[1];this.node=this.nodes.attrs.object;this.connector=this.connectors.attrs.object;this.labels=_.filter(this.fields_view.arch.children,function(label){return label.tag==="label";});},willStart:function(){if(window.Raphael){return $.when();}
return $.when(ajax.loadJS('/web_diagram/static/lib/js/jquery.mousewheel.js'),ajax.loadJS('/web_diagram/static/lib/js/raphael.js'));},start:function(){var self=this;this.$el.html(QWeb.render("DiagramView",{'widget':this}));this.$el.addClass('o_diagram_view').addClass(this.fields_view.arch.attrs.class);_.each(this.labels,function(label){self.$('.o_diagram_header').append($('<span>').html(label.attrs.string));});var diagram_info;if(this.id){diagram_info=this.get_diagram_info();}
return $.when(this._super(),diagram_info);},toTitleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});},get_diagram_info:function(){var self=this;var params={'id':this.id,'model':this.model,'node':this.node,'connector':this.connector,'bgcolor':this.nodes.attrs.bgcolor,'shape':this.nodes.attrs.shape,'src_node':this.connectors.attrs.source,'des_node':this.connectors.attrs.destination,'label':this.connectors.attrs.label||false,'visible_nodes':[],'invisible_nodes':[],'node_fields':[],'connectors':[],'connectors_fields':[]};_.each(this.nodes.children,function(child){if(child.attrs.invisible==='1')
params.invisible_nodes.push(child.attrs.name);else{params.visible_nodes.push(child.attrs.name);params.node_fields.push(self.fields[child.attrs.name]['string']||this.toTitleCase(child.attrs.name));}});_.each(this.connectors.children,function(conn){params.connectors_fields.push(self.fields[conn.attrs.name]['string']||this.toTitleCase(conn.attrs.name));params.connectors.push(conn.attrs.name);});return this.rpc('/web_diagram/diagram/get_diagram_info',params).done(function(result){self.draw_diagram(result);});},on_diagram_loaded:function(record){this.set({'title':record.id?record.name:_t("New")});var id_record=record['id'];if(id_record){this.id=id_record;this.get_diagram_info();this.do_push_state({id:id_record});}else{this.do_push_state({});}},do_load_state:function(state,warm){if(state&&state.id){if(!this.dataset.get_id_index(state.id)){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);if(warm){this.do_show();}}},draw_diagram:function(result){var self=this;var res_nodes=result['nodes'];var res_edges=result['conn'];this.parent_field=result.parent_field;var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};var canvas=self.$('.o_diagram').empty().get(0);var r=new Raphael(canvas,'100%','100%');var graph=new CuteGraph(r,style,canvas.parentNode);_.each(res_nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(res_edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});CuteNode.double_click_callback=function(cutenode){self.edit_node(cutenode.id);};CuteNode.destruction_callback=function(cutenode){if(!confirm(_t("Deleting this node cannot be undone.\nIt will also delete all connected transitions.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new data.DataSet(self,self.node).unlink([cutenode.id]);};CuteEdge.double_click_callback=function(cuteedge){self.edit_connector(cuteedge.id);};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.add_connector(cuteedge.get_start().id,cuteedge.get_end().id,cuteedge);};CuteEdge.destruction_callback=function(cuteedge){if(!confirm(_t("Deleting this transition cannot be undone.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new data.DataSet(self,self.connector).unlink([cuteedge.id]);};},edit_node:function(node_id){var self=this;var title=_t('Activity');var pop=new form_common.FormViewDialog(self,{res_model:self.node,res_id:node_id,context:self.context||self.dataset.context,title:_t("Open: ")+title}).open();pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});pop.opened().then(function(){var form_controller=pop.view_form;var field=form_controller.fields[self.parent_field];if(field){field.$input.prop('disabled',true);field.$dropdown.unbind();}});},add_node:function(){var self=this;var title=_t('Activity');var pop=new form_common.FormViewDialog(self,{res_model:self.node,domain:self.domain,context:self.context||self.dataset.context,title:_t("Create:")+title,disable_multiple_selection:true,on_selected:function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);}}).open();pop.opened().then(function(){var form_controller=pop.view_form;var field=form_controller.fields[self.parent_field];if(field){field.set_value(self.id);field.dirty=true;}});},edit_connector:function(connector_id){var self=this;var title=_t('Transition');var pop=new form_common.FormViewDialog(self,{res_model:self.connector,res_id:parseInt(connector_id,10),context:self.context||self.dataset.context,title:_t("Open: ")+title}).open();pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});},add_connector:function(node_source_id,node_dest_id,dummy_cuteedge){var self=this;var title=_t('Transition');var pop=new form_common.FormViewDialog(self,{res_model:self.connector,domain:this.domain,context:this.context||this.dataset.context,title:_t("Create:")+title,disable_multiple_selection:true,on_selected:function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);}}).open();pop.$el.parents('.modal').on('hidden.bs.modal',function(e){if(dummy_cuteedge){dummy_cuteedge.remove();}});pop.opened().then(function(){var form_controller=pop.view_form;var source_field=form_controller.fields[self.connectors.attrs.source];var destination_field=form_controller.fields[self.connectors.attrs.destination];source_field.set_value(node_source_id);source_field.dirty=true;destination_field.set_value(node_dest_id);destination_field.dirty=true;});},render_buttons:function($node){var self=this;this.$buttons=$(QWeb.render("DiagramView.buttons",{'widget':this}));this.$buttons.on('click','.o_diagram_new_button',function(){self.add_node();});this.$buttons.appendTo($node);},render_pager:function($node){var self=this;this.pager=new Pager(this,this.dataset.ids.length,this.dataset.index+1,1);this.pager.appendTo($node||this.options.$pager);this.pager.on('pager_changed',this,function(new_state){this.pager.disable();this.dataset.index=new_state.current_min-1;$.when(this.reload()).then(function(){self.pager.enable();});});},update_pager:function(){if(this.pager){this.pager.update_state({size:this.dataset.ids.length,current_min:this.dataset.index+1,});}},reload:function(){return this.dataset.read_index(_.keys(this.fields_view.fields)).then(this.on_diagram_loaded).then(this.proxy('update_pager'));},do_show:function(){this.do_push_state({});return $.when(this._super(),this.reload());}});core.view_registry.add('diagram',DiagramView);return DiagramView;});;

/* /web_editor/static/src/js/backend.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.backend',function(require){'use strict';var core=require('web.core');var session=require('web.session');var Model=require('web.DataModel');var common=require('web.form_common');var base=require('web_editor.base');var editor=require('web_editor.editor');var summernote=require('web_editor.summernote');var transcoder=require('web_editor.transcoder');var QWeb=core.qweb;var _t=core._t;var widget=common.AbstractField.extend(common.ReinitializeFieldMixin);var FieldTextHtmlSimple=widget.extend({template:'web_editor.FieldTextHtmlSimple',_config:function(){var self=this;var config={'focus':false,'height':180,'toolbar':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']]],'prettifyHtml':false,'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(value){self.internal_set_value(value);self.trigger('changed_value');}};if(session.debug){config.toolbar.splice(7,0,['view',['codeview']]);}
return config;},start:function(){var def=this._super.apply(this,arguments);this.$translate.remove();this.$translate=$();this.$content.trigger('mouseup');return def;},initialize_content:function(){var self=this;this.$textarea=this.$("textarea").val(this.get('value')||"<p><br/></p>");this.$content=$();if(this.get("effective_readonly")){if(this.options['style-inline']){var $iframe=$('<iframe class="o_readonly"/>');this.$textarea.hide().after($iframe);var load=function(){self.$content=$($iframe.contents()[0]).find("body");self.$content.html(self.text_to_html(self.get('value')));self.resize();};setTimeout(load);$iframe.on('load',load);}else{this.$content=$('<div class="o_readonly"/>');this.$textarea.hide().after(this.$content);}}else{this.$textarea.summernote(this._config());if(this.field.translate&&this.view){$(QWeb.render('web_editor.FieldTextHtml.button.translate',{'widget':this})).appendTo(this.$('.note-toolbar')).on('click',this.on_translate);}
var reset=_.bind(this.reset_history,this);this.view.on('load_record',this,reset);setTimeout(reset,0);this.$content=this.$('.note-editable:first');if(this.options['style-inline']){transcoder.style_to_class(this.$content);}}
$(".oe-view-manager-content").on("scroll",function(){$('.o_table_handler').remove();});this._super();},reset_history:function(){var history=this.$content.data('NoteHistory');if(history){history.reset();self.$('.note-toolbar').find('button[data-event="undo"]').attr('disabled',true);}},text_to_html:function(text){var value=text||"";try{$(text)[0].innerHTML;return text;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},focus:function(){if(!(!this.get("effective_readonly")&&this.$textarea)){return false;}
try{return this.$textarea.focusInEnd();}catch(e){return this.$textarea.focus();}},resize:function(){this.$('> iframe.o_readonly').css('height','0px').css('height',Math.max(30,Math.min(this.$content[0]?this.$content[0].scrollHeight:0,500))+'px');},render_value:function(){var value=this.get('value');this.$textarea.val(value||'');this.$content.html(this.text_to_html(value));if(this.get("effective_readonly")){this.resize();}else{transcoder.style_to_class(this.$content);}
if(this.$content.is(document.activeElement)){this.focus();}
var history=this.$content.data('NoteHistory');if(history&&history.recordUndo()){this.$('.note-toolbar').find('button[data-event="undo"]').attr('disabled',false);}},is_false:function(){return!this.get('value')||this.get('value')==="<p><br/></p>"||!this.get('value').match(/\S/);},commit_value:function(){if(session.debug){var layoutInfo=this.$textarea.data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this.options['style-inline']){transcoder.class_to_style(this.$content);transcoder.font_to_img(this.$content);}
this.internal_set_value(this.$content.html());},destroy_content:function(){$(".oe-view-manager-content").off("scroll");this.$textarea.destroy();this._super();}});var FieldTextHtml=widget.extend({template:'web_editor.FieldTextHtml',willStart:function(){var self=this;if(this.field.translate===false){this.languages=[];return $.when();}
return new Model('res.lang').call("search_read",[[['code','!=','en_US']],["name","code"]]).then(function(res){self.languages=res;});},start:function(){var self=this;this.callback=_.uniqueId('FieldTextHtml_');window.odoo[this.callback+"_editor"]=function(EditorBar){setTimeout(function(){self.on_editor_loaded(EditorBar);},0);};window.odoo[this.callback+"_content"]=function(EditorBar){self.on_content_loaded();};window.odoo[this.callback+"_updown"]=null;window.odoo[this.callback+"_downup"]=function(value){self.internal_set_value(value);self.trigger('changed_value');self.resize();};window.odoo[this.callback+"_do_action"]=function(){self.do_action.apply(self,arguments);};this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.$iframe.css('min-height','calc(100vh - 360px)');this.resize=function resize(){if(self.get('effective_readonly')){return;}
if($("body").hasClass("o_form_FieldTextHtml_fullscreen")){self.$iframe.css('height',(document.body.clientHeight-self.$iframe.offset().top)+'px');}else{self.$iframe.css("height",(self.$body.find("#oe_snippets").length?500:300)+"px");}};$(window).on('resize',this.resize);var def=this._super.apply(this,arguments);this.$translate.remove();this.$translate=$();return def;},get_datarecord:function(){return this.view.get_fields_values();},get_url:function(_attr){var src=this.options.editor_url||"/web_editor/field/html";var datarecord=this.get_datarecord();var attr={'model':this.view.model,'field':this.name,'res_id':datarecord.id||'','callback':this.callback};_attr=_attr||{};if(this.options['style-inline']){attr.inline_mode=1;}
if(this.options.snippets){attr.snippets=this.options.snippets;}
if(this.options.template){attr.template=this.options.template;}
if(!this.get("effective_readonly")){attr.enable_editor=1;}
if(this.field.translate){attr.translatable=1;}
if(session.debug){attr.debug=session.debug;}
attr.lang=attr.enable_editor?'en_US':this.session.user_context.lang;for(var k in _attr){attr[k]=_attr[k];}
if(src.indexOf('?')===-1){src+="?";}
for(var k in attr){if(attr[k]!==null){src+="&"+k+"="+(_.isBoolean(attr[k])?+attr[k]:attr[k]);}}
delete datarecord[this.name];src+="&datarecord="+encodeURIComponent(JSON.stringify(datarecord));return src;},initialize_content:function(){var self=this;this.$el.closest('.modal-body').css('max-height','none');this.$iframe=this.$el.find('iframe');$('.o_cp_buttons, .o_statusbar_buttons').find('button').addClass('o_disabled').attr('disabled',true);this.document=null;this.$body=$();this.$content=$();this.editor=false;window.odoo[this.callback+"_updown"]=null;this.$iframe.attr("src",this.get_url());this.view.on("load_record",this,function(r){if(!self.$body.find('.o_dirty').length){var url=self.get_url();if(url!==self.$iframe.attr("src")){self.$iframe.attr("src",url);}}});},on_content_loaded:function(){var self=this;this.document=this.$iframe.contents()[0];this.$body=$("body",this.document);this.$content=this.$body.find("#editable_area");this._toggle_label();this.lang=this.$iframe.attr('src').match(/[?&]lang=([^&]+)/);this.lang=this.lang?this.lang[1]:this.view.dataset.context.lang;this._dirty_flag=false;this.render_value();$('.o_cp_buttons, .o_statusbar_buttons').find('button').removeClass('o_disabled').attr('disabled',false);setTimeout(function(){self.add_button();setTimeout(self.resize,0);},0);},on_editor_loaded:function(EditorBar){var self=this;this.editor=EditorBar;if(this.get('value')&&window.odoo[self.callback+"_updown"]&&!(this.$content.html()||"").length){this.render_value();}
setTimeout(function(){setTimeout(self.resize,0);},0);},add_button:function(){var self=this;var $to=this.$body.find("#web_editor-top-edit, #wrapwrap").first();$(QWeb.render('web_editor.FieldTextHtml.translate',{'widget':this})).appendTo($to).on('change','select',function(){var lang=$(this).val();var edit=!self.get("effective_readonly");var trans=lang!=='en_US';self.$iframe.attr("src",self.get_url({'edit_translations':edit&&trans,'enable_editor':edit&&!trans,'lang':lang}));});$(QWeb.render('web_editor.FieldTextHtml.fullscreen')).appendTo($to).on('click','.o_fullscreen',function(){$("body").toggleClass("o_form_FieldTextHtml_fullscreen");var full=$("body").hasClass("o_form_FieldTextHtml_fullscreen");self.$iframe.parents().toggleClass('o_form_fullscreen_ancestor',full);$(window).trigger("resize");});this.$body.on('click','[data-action="cancel"]',function(event){event.preventDefault();self.initialize_content();});},render_value:function(){if(this.lang!==this.view.dataset.context.lang||this.$iframe.attr('src').match(/[?&]edit_translations=1/)){return;}
var value=(this.get('value')||"").replace(/^<p[^>]*>(\s*|<br\/?>)<\/p>$/,'');if(!this.$content){return;}
if(!this.get("effective_readonly")){if(window.odoo[this.callback+"_updown"]){window.odoo[this.callback+"_updown"](value,this.view.get_fields_values(),this.name);this.resize();}}else{this.$content.html(value);if(this.$iframe[0].contentWindow){this.$iframe.css("height",(this.$body.height()+20)+"px");}}},is_false:function(){return this.get('value')===false||!this.$content.html()||!this.$content.html().match(/\S/);},commit_value:function(){if(this.lang!=='en_US'&&this.$body.find('.o_dirty').length){this.internal_set_value(this.view.datarecord[this.name]);this._dirty_flag=false;return this.editor.save();}else if(this._dirty_flag&&this.editor&&this.editor.buildingBlock){if(session.debug){var layoutInfo=this.editor.rte.editable().data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
var $ancestors=this.$iframe.filter(':not(:visible)').parentsUntil(':visible').addBack();var ancestorsStyle=[];_.each($ancestors,function(el){var $el=$(el);ancestorsStyle.unshift($el.attr('style')||null);$el.css({display:'initial',visibility:'hidden',height:1});});this.editor.buildingBlock.clean_for_save();_.each($ancestors,function(el){var $el=$(el);$el.attr('style',ancestorsStyle.pop());});this.internal_set_value(this.$content.html());}},destroy:function(){$(window).off('resize',this.resize);delete window.odoo[this.callback+"_editor"];delete window.odoo[this.callback+"_content"];delete window.odoo[this.callback+"_updown"];delete window.odoo[this.callback+"_downup"];delete window.odoo[this.callback+"_do_action"];}});core.form_widget_registry.add('html',FieldTextHtmlSimple).add('html_frame',FieldTextHtml);return{FieldTextHtmlSimple:FieldTextHtmlSimple,FieldTextHtml:FieldTextHtml,};});;

/* /web_kanban/static/src/js/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Record',function(require){"use strict";var core=require('web.core');var data=require('web.data');var formats=require('web.formats');var framework=require('web.framework');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var kanban_widgets=require('web_kanban.widgets');var QWeb=core.qweb;var fields_registry=kanban_widgets.registry;var KanbanRecord=Widget.extend({template:'KanbanView.record',events:{'click .oe_kanban_action':'on_kanban_action_clicked','click .o_kanban_manage_toggle_button':'toggle_manage_pane',},custom_events:{'kanban_update_record':'update_record',},init:function(parent,record,options){this._super(parent);this.fields=options.fields;this.editable=options.editable;this.deletable=options.deletable;this.draggable=options.draggable;this.read_only_mode=options.read_only_mode;this.model=options.model;this.group_info=options.group_info;this.qweb=options.qweb;this.sub_widgets=[];this.init_content(record);this.on_kanban_action_clicked=_.debounce(this.on_kanban_action_clicked,300,true);},init_content:function(record){var self=this;this.id=record.id;this.values={};_.each(record,function(v,k){self.values[k]={value:v};});this.record=this.transform_record(record);var qweb_context={record:this.record,widget:this,read_only_mode:this.read_only_mode,user_context:session.user_context,formats:formats,};for(var p in this){if(_.str.startsWith(p,'kanban_')){qweb_context[p]=_.bind(this[p],this);}}
this.qweb_context=qweb_context;this.content=this.qweb.render('kanban-box',qweb_context);},add_widgets:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field=self.record[$field.attr("name")];var type=$field.attr("widget")||field.type;var Widget=fields_registry.get(type);var widget=new Widget(self,field,$field);widget.replace($field);self.sub_widgets.push(widget);});},start:function(){var self=this;this.add_widgets();this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({'html':true,'title':self.qweb.render(tooltip,self.qweb_context)});}});},renderElement:function(){this._super();this.setup_color_picker();this.$el.addClass('o_kanban_record');this.$el.data('record',this);if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this.proxy('on_global_click'));}},transform_record:function(record){var self=this;var new_record={};_.each(_.extend(_.object(_.keys(this.fields),[]),record),function(value,name){var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=time.auto_str_to_date(value);}else{r.raw_value=value;}
r.value=formats.format_value(value,r);new_record[name]=r;});return new_record;},update:function(record){_.invoke(this.sub_widgets,'destroy');this.sub_widgets=[];this.init_content(record);this.renderElement();this.add_widgets();},kanban_image:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!utils.is_bin_size(this.record[field].value)){url='data:image/png;base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{if(_.isArray(id)){id=id[0];}
if(!id){id=undefined;}
if(options.preview_image)
field=options.preview_image;var unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');url=session.url('/web/image',{model:model,field:field,id:id,unique:unique});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},kanban_getcolor:function(variable){if(typeof(variable)==='number'){return Math.round(variable)%10;}
if(typeof(variable)==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%10;}
return 0;},kanban_color:function(variable){var color=this.kanban_getcolor(variable);return'oe_kanban_color_'+color;},on_global_click:function(ev){if($(ev.target).parents('.o_dropdown_kanban').length){return;}
if(!ev.isTrigger){var trigger=true;var elem=ev.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem==ev.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=="tooltip");if(ischild){children.push(elem);if(test_event){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this.on_card_clicked(ev);}}},on_card_clicked:function(){if(this.$el.hasClass('oe_kanban_global_click_edit')&&this.$el.data('routing')){framework.redirect(this.$el.data('routing')+"/"+this.id);}else if(this.$el.hasClass('oe_kanban_global_click_edit')){this.trigger_up('kanban_record_edit',{id:this.id});}else{this.trigger_up('kanban_record_open',{id:this.id});}},toggle_manage_pane:function(event){event.preventDefault();this.$('.o_kanban_card_content').toggleClass('o_visible o_invisible');this.$('.o_kanban_card_manage_pane').toggleClass('o_visible o_invisible');this.$('.o_kanban_manage_button_section').toggleClass(this.kanban_color((this.values['color']&&this.values['color'].value)||0));},on_kanban_action_clicked:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('kanban_record_edit',{id:this.id});break;case'open':this.trigger_up('kanban_record_open',{id:this.id});break;case'delete':this.trigger_up('kanban_record_delete',{record:this});break;case'action':case'object':this.trigger_up('kanban_do_action',$action.data());break;default:this.do_warn("Kanban: no action for type : "+type);}},kanban_compute_domain:function(domain){return data.compute_domain(domain,this.values);},update_record:function(event){this.trigger_up('kanban_record_update',event.data);},setup_color_picker:function(){var self=this;var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker',{widget:this}));$colorpicker.on('click','a',function(ev){ev.preventDefault();var color_field=$colorpicker.data('field')||'color';var data={};data[color_field]=$(this).data('color');self.trigger_up('kanban_record_update',data);});},});return KanbanRecord;});;

/* /web_kanban/static/src/js/kanban_relational.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Many2ManyKanbanView',function(require){"use strict";var common=require('web.form_common');var core=require('web.core');var data=require('web.data');var KanbanView=require('web_kanban.KanbanView');var _t=core._t;var X2ManyKanbanView=KanbanView.extend({render_pager:function($node,options){options=_.extend(options||{},{single_page_hidden:true,});this._super($node,options);},});var One2ManyKanbanView=X2ManyKanbanView.extend({add_record:function(){var self=this;new common.FormViewDialog(this,{res_model:self.x2m.field.relation,domain:self.x2m.build_domain(),context:self.x2m.build_context(),title:_t("Create: ")+self.x2m.string,initial_view:"form",alternative_form_view:self.x2m.field.views?self.x2m.field.views.form:undefined,create_function:function(data,options){return self.x2m.data_create(data,options);},read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},parent_view:self.x2m.view,child_name:self.x2m.name,form_view_options:{'not_interactible_on_create':true},on_selected:function(){self.x2m.reload_current_view();}}).open();},});var Many2ManyKanbanView=X2ManyKanbanView.extend({add_record:function(){var self=this;new common.SelectCreateDialog(this,{res_model:this.x2m.field.relation,domain:new data.CompoundDomain(this.x2m.build_domain(),["!",["id","in",this.dataset.ids]]),context:this.x2m.build_context(),title:_t("Add: ")+this.x2m.string,on_selected:function(element_ids){return self.x2m.data_link_multi(element_ids).then(function(){self.x2m.reload_current_view();});}}).open();},open_record:function(event){var self=this;new common.FormViewDialog(this,{res_model:this.x2m.field.relation,res_id:event.data.id,context:this.x2m.build_context(),title:_t("Open: ")+this.x2m.string,write_function:function(id,data,options){return self.x2m.data_update(id,data,options).done(function(){self.x2m.reload_current_view();});},alternative_form_view:this.x2m.field.views?this.x2m.field.views.form:undefined,parent_view:this.x2m.view,child_name:this.x2m.name,read_function:function(ids,fields,options){return self.x2m.data_read(ids,fields,options);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||this.x2m.get("effective_readonly")}).open();},});core.view_registry.add('one2many_kanban',One2ManyKanbanView);core.view_registry.add('many2many_kanban',Many2ManyKanbanView);});;

/* /web_kanban/static/src/js/kanban_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.quick_create',function(require){"use strict";var Widget=require('web.Widget');var RecordQuickCreate=Widget.extend({template:"KanbanView.QuickCreate",events:{'click .o_kanban_cancel':function(event){this.cancel();},'click .o_kanban_add':function(event){this.add_record();},'keypress input':function(event){if(event.keyCode===13){this.add_record();}},'keydown':function(event){if(event.keyCode===27){this.cancel();}},'mousedown .o_kanban_add':'suppress','mousedown .o_kanban_cancel':'suppress',},init:function(parent,width){this._super(parent);this.width=width;},start:function(){this.$el.css({width:this.width});this.$input=this.$('input');this.$input.focus();},cancel:function(){this.trigger_up('cancel_quick_create');},add_record:function(){var value=this.$input.val();this.$input.val('');if(/^\s*$/.test(value)){return;}
this.trigger_up('quick_create_add_record',{value:value});this.$input.focus();},suppress:function(e){e.preventDefault();},});var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click':'toggle','click .o_kanban_add':function(event){event.stopPropagation();this.add_column();},'click .o_kanban_cancel':function(event){this.folded=true;this.update();},'click .o_kanban_quick_create':function(event){event.stopPropagation();},'keypress input':function(event){if(event.keyCode===13){this.add_column();}},'keydown':function(event){if(event.keyCode===27){this.folded=true;this.update();}},'focusout':function(){var hasFocus=this.$(':focus').length>0;if(hasFocus){return;}
this.folded=true;this.$input.val('');this.update();},'mousedown .o_kanban_add':'suppress','mousedown .o_kanban_cancel':'suppress',},init:function(parent){this._super(parent);this.folded=true;},start:function(){this.$header=this.$('.o_column_header');this.$quick_create=this.$('.o_kanban_quick_create');this.$input=this.$('input');},toggle:function(){this.folded=!this.folded;this.update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},update:function(){this.$header.toggle(this.folded);this.$quick_create.toggle(!this.folded);},add_column:function(){var name=this.$input.val();this.$input.val('');if(/^\s*$/.test(name)){return;}
this.trigger_up('quick_create_add_column',{value:name});this.$input.focus();},suppress:function(e){e.preventDefault();},});return{RecordQuickCreate:RecordQuickCreate,ColumnQuickCreate:ColumnQuickCreate,};});;

/* /web_kanban/static/src/js/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.Column',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Widget=require('web.Widget');var quick_create=require('web_kanban.quick_create');var KanbanRecord=require('web_kanban.Record');var _t=core._t;var QWeb=core.qweb;var RecordQuickCreate=quick_create.RecordQuickCreate;var KanbanColumn=Widget.extend({template:"KanbanView.Group",events:{'click .o_kanban_toggle_fold':function(e){e.preventDefault();e.stopPropagation();this.folded=true;this.update_column();},'click .o_column_edit':'edit_column','click .o_column_delete':'delete_column','click .o_column_archive':'archive_records','click .o_column_unarchive':'unarchive_records','click .o_kanban_quick_add':'add_quick_create','click .o_kanban_load_more':'load_more',},custom_events:{'kanban_record_delete':'delete_record','cancel_quick_create':'cancel_quick_create','quick_create_add_record':'quick_create_add_record',},init:function(parent,group_data,options,record_options){this._super(parent);this.data_records=group_data.records;this.dataset=group_data.dataset;this.records=[];this.title=group_data.title;this.id=group_data.id;this.folded=group_data.attributes.folded;this.fields=options.fields;this.values=group_data.values;this.quick_create=options.quick_create;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.draggable=record_options.draggable;this.has_active_field=options.has_active_field;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.relation=options.relation;this.offset=0;this.remaining=this.dataset.size()-this.data_records.length;this.record_options=_.extend(_.clone(record_options),{group_info:this.values,});var self=this;if(group_data.options&&group_data.options.group_by_tooltip&&this.values){this.tooltip_info=_.map(group_data.options.group_by_tooltip,function(key,value){if(!self.values[value]){return'';}
return $('<div>').text(key+'<br>'+self.values[value]).text();}).join('');}else{this.tooltip_info="";}},start:function(){var self=this;this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){this.add_record(this.data_records[i],{no_update:true});}
this.$header.tooltip();if(config.device.size_class>config.device.SIZES.XS&&this.draggable!==false){this.$el.sortable({connectWith:'.o_kanban_group',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',helper:'clone',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');self.update_column();},out:function(){self.$el.removeClass('o_kanban_hover');},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);var test2=$.contains(self.$el[0],record.$el[0]);record.$el.removeAttr('style');if(index>=0&&test2){self.trigger_up('kanban_column_resequence');}else if(index>=0&&!test2){self.records.splice(self.records.indexOf(record),1);self.dataset.remove_ids([record.id]);}else{self.records.push(record);self.dataset.add_ids([record.id]);record.setParent(self);ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record});}
self.update_column();}});}
this.update_column();this.$el.click(function(event){if(self.$el.hasClass('o_column_folded')){event.preventDefault();self.folded=false;self.update_column();}});},is_empty:function(){return!this.records.length;},add_record:function(data,options){var record=new KanbanRecord(this,data,this.record_options);this.records.push(record);this.dataset.ids=_.uniq(this.dataset.ids.concat(record.id));if(options.position==='before'){record.insertAfter(this.quick_create_widget?this.quick_create_widget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){record.insertBefore($load_more);}else{record.appendTo(this.$el);}}
if(!options.no_update){this.update_column();}},get_ids:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){var record=$(r).data('record');if(record){ids.push(record.id);}});return ids;},update_column:function(){var title=this.folded?this.title+' ('+this.dataset.size()+')':this.title;this.$header.find('.o_column_title').text(title);this.$header.find('.o-kanban-count').text(this.records.length);this.$el.toggleClass('o_column_folded',this.folded);var tooltip;if(this.remaining){tooltip=this.records.length+'/'+this.dataset.size()+_t(' records');}else{tooltip=this.records.length+_t(' records');}
tooltip='<p>'+tooltip+'</p>'+this.tooltip_info;this.$header.tooltip({html:true}).attr('data-original-title',tooltip);if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}))}},archive_records:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:true});},unarchive_records:function(event){event.preventDefault();this.trigger_up('kanban_column_archive_records',{archive:false});},delete_column:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete')},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},edit_column:function(event){event.preventDefault();var dialog=new form_common.FormViewDialog(this,{res_model:this.relation,res_id:this.id,title:_t("Edit Column"),}).open();dialog.on('record_saved',this,function(){this.trigger_up('kanban_reload');});},delete_record:function(event){event.stopped=false;var self=this;event.data.after=function cleanup(){var index=self.records.indexOf(event.data.record);self.records.splice(index,1);self.update_column();};},add_quick_create:function(){if(this.quick_create_widget){return;}
var self=this;var width=this.records.length?this.records[0].$el.innerWidth():this.$el.width()-8;this.quick_create_widget=new RecordQuickCreate(this,width);this.quick_create_widget.insertAfter(this.$header);this.quick_create_widget.$el.focusout(function(){var hasFocus=(self.quick_create_widget.$(':focus').length>0);if(!hasFocus&&self.quick_create_widget){self.cancel_quick_create();}});},cancel_quick_create:function(){this.quick_create_widget.destroy();this.quick_create_widget=undefined;},quick_create_add_record:function(event){this.trigger_up('column_add_record',event.data);},load_more:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},});return KanbanColumn;});;

/* /web_kanban/static/src/js/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.KanbanView',function(require){"use strict";var core=require('web.core');var data=require('web.data');var data_manager=require('web.data_manager');var Model=require('web.DataModel');var Dialog=require('web.Dialog');var form_common=require('web.form_common');var Pager=require('web.Pager');var pyeval=require('web.pyeval');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var View=require('web.View');var KanbanColumn=require('web_kanban.Column');var quick_create=require('web_kanban.quick_create');var KanbanRecord=require('web_kanban.Record');var kanban_widgets=require('web_kanban.widgets');var qweb=core.qweb;var _lt=core._lt;var _t=core._t;var ColumnQuickCreate=quick_create.ColumnQuickCreate;var fields_registry=kanban_widgets.registry;var KanbanView=View.extend({accesskey:"k",className:"o_kanban_view",custom_events:{'kanban_record_open':'open_record','kanban_record_edit':'edit_record','kanban_record_delete':'delete_record','kanban_do_action':'open_action','kanban_reload':'do_reload','kanban_column_resequence':function(event){this.resequence_column(event.target);},'kanban_record_update':'update_record','kanban_column_add_record':'add_record_to_column','kanban_column_delete':'delete_column','kanban_column_archive_records':'archive_records','column_add_record':'column_add_record','quick_create_add_column':'add_new_column','kanban_load_more':'load_more','kanban_call_method':'call_method',},defaults:_.extend(View.prototype.defaults,{quick_creatable:true,creatable:true,create_text:undefined,read_only_mode:false,confirm_on_delete:true,}),display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,init:function(){this._super.apply(this,arguments);this.qweb=new QWeb(session.debug,{_s:session.origin},false);this.limit=this.options.limit||parseInt(this.fields_view.arch.attrs.limit,10)||40;this.fields=this.fields_view.fields;this.fields_keys=_.keys(this.fields_view.fields);this.grouped=undefined;this.group_by_field=undefined;this.default_group_by=this.fields_view.arch.attrs.default_group_by;this.on_create=this.fields_view.arch.attrs.on_create;this.grouped_by_m2o=undefined;this.relation=undefined;this.is_empty=undefined;this.many2manys=this.fields_view.many2manys||[];this.m2m_context={};this.widgets=[];this.data=undefined;this.quick_creatable=this.options.quick_creatable;this.no_content_msg=this.options.action&&(this.options.action.get_empty_list_help||this.options.action.help);this.search_orderer=new utils.DropMisordered();var default_order=this.fields_view.arch.attrs.default_order;if(!this.dataset._sort.length&&default_order){this.dataset.set_sort(default_order.split(','));}},willStart:function(){for(var i=0,ii=this.fields_view.arch.children.length;i<ii;i++){var child=this.fields_view.arch.children[i];if(child.tag==="templates"){transform_qweb_template(child,this.fields_view,this.many2manys);this.fields_view.many2manys=this.many2manys;this.qweb.add_template(utils.json_node_to_xml(child));break;}else if(child.tag==='field'){var ftype=child.attrs.widget||this.fields[child.attrs.name].type;if(ftype==="many2many"&&"context"in child.attrs){this.m2m_context[child.attrs.name]=child.attrs.context;}}}
return this._super();},start:function(){this.$el.addClass(this.fields_view.arch.attrs.class);return this._super();},do_search:function(domain,context,group_by){var self=this;var group_by_field=group_by[0]||this.default_group_by;var field=this.fields[group_by_field];var options={};var fields_def;if(field===undefined){fields_def=data_manager.load_fields(this.dataset).then(function(fields){self.fields=fields;field=self.fields[group_by_field];});}
var load_def=$.when(fields_def).then(function(){var grouped_by_m2o=field&&(field.type==='many2one');options=_.extend(options,{search_domain:domain,search_context:context,group_by_field:group_by_field,grouped:group_by.length||self.default_group_by,grouped_by_m2o:grouped_by_m2o,relation:(grouped_by_m2o?field.relation:undefined),});return options.grouped?self.load_groups(options):self.load_records();});return this.search_orderer.add(load_def).then(function(data){_.extend(self,options);if(options.grouped){var new_ids=_.union.apply(null,_.map(data.groups,function(group){return group.dataset.ids;}));self.dataset.alter_ids(new_ids);}
self.data=data;}).then(this.proxy('render')).then(this.proxy('update_buttons')).then(this.proxy('update_pager'));},do_show:function(){this.do_push_state({});return this._super();},do_reload:function(){var group_by=this.group_by_field?[this.group_by_field]:[];this.do_search(this.search_domain,this.search_context,group_by);},load_records:function(offset,dataset){var options={'limit':this.limit,'offset':offset,};dataset=dataset||this.dataset;return dataset.read_slice(this.fields_keys.concat(['__last_update']),options).then(function(records){return{records:records,is_empty:!records.length,grouped:false,};});},load_groups:function(options){var self=this;var group_by_field=options.group_by_field;var fields_keys=_.uniq(this.fields_keys.concat(group_by_field));return new Model(this.model,options.search_context,options.search_domain).query(fields_keys).group_by([group_by_field]).then(function(groups){var group_by_fields_to_read=[];var group_options={};var recurse=function(node){if(node.tag==="field"&&node.attrs&&node.attrs.options&&node.attrs.name===group_by_field){var options=pyeval.py_eval(node.attrs.options);group_options=options;var states_fields_to_read=_.map(options&&options.states_legend||{},function(value,key,list){return value;});var tooltip_fields_to_read=_.map(options&&options.group_by_tooltip||{},function(value,key,list){return key;});group_by_fields_to_read=_.union(group_by_fields_to_read,states_fields_to_read,tooltip_fields_to_read);return;}
_.each(node.children,function(child){recurse(child);});};recurse(self.fields_view.arch);var group_ids=_.without(_.map(groups,function(elem){return elem.attributes.value[0];}),undefined);if(options.grouped_by_m2o&&group_ids.length&&group_by_fields_to_read.length){return new data.DataSet(self,options.relation).read_ids(group_ids,_.union(['display_name'],group_by_fields_to_read)).then(function(results){_.each(groups,function(group){var group_id=group.attributes.value[0];var result=_.find(results,function(data){return group_id===data.id;});group.title=result?result.display_name:_t("Undefined");group.values=result;group.id=group_id;group.options=group_options;});return groups;});}else{_.each(groups,function(group){var value=group.attributes.value;group.id=value instanceof Array?value[0]:value;var field=self.fields[options.group_by_field];if(field&&field.type==="selection"){value=_.find(field.selection,function(s){return s[0]===group.id;});}
group.title=(value instanceof Array?value[1]:value)||_t("Undefined");group.values={};});return $.when(groups);}}).then(function(groups){var undef_index=_.findIndex(groups,function(g){return g.title===_t("Undefined");});if(undef_index>=1){var undef_group=groups[undef_index];groups.splice(undef_index,1);groups.unshift(undef_group);}
return groups;}).then(function(groups){var is_empty=true;return $.when.apply(null,_.map(groups,function(group){var def=$.when([]);var dataset=new data.DataSetSearch(self,self.model,new data.CompoundContext(self.dataset.get_context(),group.model.context()),group.model.domain());if(self.dataset._sort){dataset.set_sort(self.dataset._sort);}
if(group.attributes.length>=1){def=dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit});}
return def.then(function(records){self.dataset.ids.push.apply(self.dataset.ids,_.difference(dataset.ids,self.dataset.ids));group.records=records;group.dataset=dataset;is_empty=is_empty&&!records.length;return group;});})).then(function(){return{groups:Array.prototype.slice.call(arguments,0),is_empty:is_empty,grouped:true,};});});},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable){return false;}
return this._super(action);},has_active_field:function(){return this.fields_view.fields.active;},_is_quick_create_enabled:function(){var group_by_field=this.group_by_field.split(':')[0]
if(!_.contains(['char','boolean','many2one'],this.fields[group_by_field].type)){return false;}
if(!this.quick_creatable||!this.is_action_enabled('create'))
return false;if(this.fields_view.arch.attrs.quick_create!==undefined)
return JSON.parse(this.fields_view.arch.attrs.quick_create);return!!this.grouped;},render_buttons:function($node){var self=this;if(this.options.action_buttons!==false&&this.is_action_enabled('create')){this.$buttons=$(qweb.render("KanbanView.buttons",{'widget':this}));this.$buttons.on('click','button.o-kanban-button-new',function(){if(self.grouped&&self.widgets.length&&self.on_create==='quick_create'){self.widgets[0].add_quick_create();}else if(self.on_create&&self.on_create!=='quick_create'){self.do_action(self.on_create,{on_close:self.do_reload.bind(self),additional_context:self.search_context,});}else{self.add_record();}});this.update_buttons();this.$buttons.appendTo($node);}},update_buttons:function(){if(this.$buttons){var create_muted=!!this.grouped&&this.widgets.length===0&&this.is_action_enabled('group_create')&&this.grouped_by_m2o;this.$buttons.find('.o-kanban-button-new').toggleClass('btn-primary',!create_muted).toggleClass('btn-default',create_muted);}},render_pager:function($node,options){var self=this;this.pager=new Pager(this,this.dataset.size(),1,this.limit,options);this.pager.appendTo($node);this.pager.on('pager_changed',this,function(state){var limit_changed=(self.limit!==state.limit);self.limit=state.limit;self.load_records(state.current_min-1).then(function(data){self.data=data;if(!limit_changed){self.scrollTop=0;self.trigger_up('scrollTo',{offset:0});}}).done(this.proxy('render'));});this.update_pager();},update_pager:function(){if(this.pager){if(this.grouped){this.pager.do_hide();}else{this.pager.update_state({size:this.dataset.size(),current_min:1});}}},render:function(){this.$el.css({display:'-webkit-flex'});this.$el.css({display:'flex'});this.$el.removeClass('o_kanban_ungrouped o_kanban_grouped o_kanban_nocontent');_.invoke(this.widgets,'destroy');this.$el.empty();this.widgets=[];if(this.column_quick_create){this.column_quick_create.destroy();this.column_quick_create=undefined;}
this.record_options={editable:this.is_action_enabled('edit'),deletable:this.is_action_enabled('delete'),fields:this.fields_view.fields,qweb:this.qweb,model:this.model,read_only_mode:this.options.read_only_mode,};var fragment=document.createDocumentFragment();if(this.data.grouped){this.$el.addClass('o_kanban_grouped');this.render_grouped(fragment);}else{this.$el.addClass('o_kanban_ungrouped');this.render_ungrouped(fragment);}
if(this.data.is_empty&&this.widgets.length===0&&(!this.data.grouped||!this.is_action_enabled('group_create')||!this.grouped_by_m2o)){this.$el.css("display","block");this.$el.addClass("o_kanban_nocontent");this.render_no_content(fragment);}
this.$el.append(fragment);},render_no_content:function(fragment){var content=qweb.render('KanbanView.nocontent',{content:this.no_content_msg});$(content).appendTo(fragment);},render_ungrouped:function(fragment){var self=this;var options=_.clone(this.record_options);_.each(this.data.records,function(record){var kanban_record=new KanbanRecord(self,record,options);self.widgets.push(kanban_record);kanban_record.appendTo(fragment);});for(var i=0,ghost_div;i<6;i++){ghost_div=$("<div>").addClass("o_kanban_record o_kanban_ghost");ghost_div.appendTo(fragment);}
this.postprocess_m2m_tags();},get_column_options:function(){return{editable:this.is_action_enabled('group_edit'),deletable:this.is_action_enabled('group_delete'),has_active_field:this.has_active_field(),grouped_by_m2o:this.grouped_by_m2o,relation:this.relation,qweb:this.qweb,fields:this.fields_view.fields,quick_create:this._is_quick_create_enabled(),};},render_grouped:function(fragment){var self=this;var group_by_field_attrs=this.fields[this.group_by_field];var draggable=true;if(group_by_field_attrs){if(group_by_field_attrs.type==="date"||group_by_field_attrs.type==="datetime"){var draggable=false;}
else if(group_by_field_attrs.readonly!==undefined){var draggable=!(group_by_field_attrs.readonly);}}
var record_options=_.extend(this.record_options,{draggable:draggable,});var column_options=this.get_column_options();_.each(this.data.groups,function(group){var column=new KanbanColumn(self,group,column_options,record_options);column.appendTo(fragment);self.widgets.push(column);});this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_kanban_header',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){ids.push($(u).data('id'));});self.resequence(ids);},});if(this.is_action_enabled('group_create')&&this.grouped_by_m2o){this.column_quick_create=new ColumnQuickCreate(this);this.column_quick_create.appendTo(fragment);}
this.postprocess_m2m_tags();},add_record:function(){this.dataset.index=null;this.do_switch_view('form');},open_record:function(event,options){if(this.dataset.select_id(event.data.id)){this.do_switch_view('form',options);}else{this.do_warn("Kanban: could not find id#"+event.data.id);}},edit_record:function(event){this.open_record(event,{mode:'edit'});},delete_record:function(event){var self=this;var record=event.data.record;function do_it(){return $.when(self.dataset.unlink([record.id])).done(function(){record.destroy();if(event.data.after){event.data.after();}});}
if(this.options.confirm_on_delete){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:do_it});}else{do_it();}},open_action:function(event){var self=this;if(event.data.context){event.data.context=new data.CompoundContext(event.data.context).set_eval_context({active_id:event.target.id,active_ids:[event.target.id],active_model:this.model,});}
this.do_execute_action(event.data,this.dataset,event.target.id,_.bind(self.reload_record,this,event.target));},postprocess_m2m_tags:function(records){var self=this;if(!this.many2manys.length){return;}
var relations={};records=records?(records instanceof Array?records:[records]):this.grouped?Array.prototype.concat.apply([],_.pluck(this.widgets,'records')):this.widgets;records.forEach(function(record){self.many2manys.forEach(function(name){var field=record.record[name];var $el=record.$('.oe_form_field.o_form_field_many2manytags[name='+name+']');if(!$el[0]){return;}
if(!relations[field.relation]){relations[field.relation]={ids:[],elements:{},context:self.m2m_context[name]};}
var rel=relations[field.relation];field.raw_value.forEach(function(id){rel.ids.push(id);if(!rel.elements[id]){rel.elements[id]=[];}
rel.elements[id].push($el[0]);});});});_.each(relations,function(rel,rel_name){var dataset=new data.DataSetSearch(self,rel_name,self.dataset.get_context(rel.context));dataset.read_ids(_.uniq(rel.ids),['name','color']).done(function(result){result.forEach(function(record){if(typeof record.color!=='undefined'&&record.color!=10){var $tag=$('<span>').addClass('o_tag o_tag_color_'+record.color).attr('title',_.str.escapeHTML(record.name));$(rel.elements[record.id]).append($tag);}});self.$('span.o_tag').tooltip({delay:{'show':50}});});});},resequence:function(ids){if((ids.length<=1)||!this.relation){return;}
new data.DataSet(this,this.relation).resequence(ids).done(function(r){if(!r){console.warn('Resequence could not be complete. '+'Maybe the model does not have a "sequence" field?');}});},resequence_column:function(col){if(_.indexOf(this.fields_keys,'sequence')>-1){this.dataset.resequence(col.get_ids());}},delete_column:function(event){var self=this;var column=event.target;(new data.DataSet(this,this.relation)).unlink([column.id]).done(function(){if(column.is_empty()){var index=self.widgets.indexOf(column);self.widgets.splice(index,1);column.destroy();self.update_buttons();}else{self.do_reload();}});},archive_records:function(event){if(!this.has_active_field()){return;}
var active_value=!event.data.archive;var record_ids=[];_.each(event.target.records,function(kanban_record){if(kanban_record.record.active.value!=active_value){record_ids.push(kanban_record.id);}});if(record_ids.length){this.dataset.call('write',[record_ids,{active:active_value}]).done(this.do_reload);}},reload_record:function(record){var self=this;this.dataset.read_ids([record.id],this.fields_keys.concat(['__last_update'])).done(function(records){if(records.length){record.update(records[0]);self.postprocess_m2m_tags(record);}else{record.destroy();}});},add_record_to_column:function(event){var self=this;var column=event.target;var record=event.data.record;var data={};data[this.group_by_field]=event.target.id;this.dataset.write(record.id,data,{}).done(function(){if(!self.isDestroyed()){self.reload_record(record);self.resequence_column(column);}}).fail(this.do_reload);},update_record:function(event){var self=this;var record=event.target;return this.dataset.write(record.id,event.data).done(function(){if(!self.isDestroyed()){self.reload_record(record);}});},column_add_record:function(event){var self=this;var column=event.target;var context={};context['default_'+this.group_by_field]=column.id;var name=event.data.value;this.dataset.name_create(name,context).done(function(data){add_record(data[0]);}).fail(function(error,event){event.preventDefault();var dialog=new form_common.FormViewDialog(self,{res_model:self.model,context:_.extend({"default_name":name},context),title:_t("Create"),disable_multiple_selection:true,on_selected:function(element_ids){add_record(element_ids[0]);}}).open();});function add_record(id){self.dataset.add_ids([id],-1);self.dataset.read_ids([id],self.fields_keys.concat(['__last_update'])).done(function(record){column.add_record(record[0],{position:'before'});});}},add_new_column:function(event){var self=this;var model=new Model(this.relation,this.search_context);var name=event.data.value;model.call('name_create',[name],{context:this.search_context,}).then(function(result){var dataset=new data.DataSetSearch(self,self.model,self.dataset.get_context(),[]);var group_data={records:[],title:event.data.value,id:result[0],attributes:{folded:false},dataset:dataset,values:{},};var options=self.get_column_options();var record_options=_.clone(self.record_options);var column=new KanbanColumn(self,group_data,options,record_options);column.insertBefore(self.$('.o_column_quick_create'));self.widgets.push(column);self.update_buttons();self.trigger_up('scrollTo',{selector:'.o_column_quick_create'});});},load_more:function(event){var self=this;var column=event.target;var offset=column.offset+this.limit;return this.load_records(offset,column.dataset).then(function(result){_.each(result.records,function(r){column.add_record(r,{no_update:true});self.dataset.add_ids([r.id]);});column.offset+=self.limit;column.remaining=Math.max(column.remaining-self.limit,0);column.update_column();self.postprocess_m2m_tags(column.records.slice(column.offset));});},call_method:function(event){var data=event.data;this.dataset.call(data.method,data.params).then(function(){if(data.callback){data.callback();}});}});function qweb_add_if(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transform_qweb_template(node,fvg,many2manys){if(node.tag&&node.attrs.modifiers){var modifiers=JSON.parse(node.attrs.modifiers||'{}');if(modifiers.invisible){qweb_add_if(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'field':var ftype=fvg.fields[node.attrs.name].type;ftype=node.attrs.widget?node.attrs.widget:ftype;if(ftype==='many2many'){if(_.indexOf(many2manys,node.attrs.name)<0){many2manys.push(node.attrs.name);}
node.tag='div';node.attrs['class']=(node.attrs['class']||'')+' oe_form_field o_form_field_many2manytags o_kanban_tags';}else if(fields_registry.contains(ftype)){}else{node.tag=qweb.prefix;node.attrs[qweb.prefix+'-esc']='record.'+node.attrs.name+'.value';}
break;case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!=-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag=='a'&&node.attrs['data-type']!="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transform_qweb_template(node.children[i],fvg,many2manys);}}}
core.view_registry.add('kanban',KanbanView);return KanbanView;});;

/* /web_kanban/static/src/js/kanban_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.widgets',function(require){"use strict";var core=require('web.core');var formats=require('web.formats');var Priority=require('web.Priority');var ProgressBar=require('web.ProgressBar');var pyeval=require('web.pyeval');var Registry=require('web.Registry');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var FieldInterface={init:function(parent,field,$node){},};var AbstractField=Widget.extend(FieldInterface,{init:function(parent,field,$node){this._super(parent);this.field=field;this.$node=$node;this.options=pyeval.py_eval(this.$node.attr("options")||'{}');this.set("value",field.raw_value);},});var FormatChar=AbstractField.extend({tagName:'span',init:function(parent,field,$node){this._super.apply(this,arguments);this.format_descriptor=_.extend({},this.field,{'widget':this.$node.attr('widget')});},renderElement:function(){this.$el.text(formats.format_value(this.field.raw_value,this.format_descriptor));}});var KanbanPriority=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name');},renderElement:function(){this._super();this.set('readonly',!!(this.field&&this.field.readonly));},start:function(){this.priority=new Priority(this,{readonly:this.get('readonly'),value:this.get('value'),values:this.field.selection||[],});this.priority.on('update',this,function(update){var data={};data[this.name]=update.value;this.trigger_up('kanban_update_record',data);});this.on('change:readonly',this,function(){this.priority.readonly=this.get('readonly');var $div=$('<div/>').insertAfter(this.$el);this.priority.replace($div);this.setElement(this.priority.$el);});var self=this;return $.when(this._super(),this.priority.appendTo('<div>').done(function(){self.priority.$el.addClass(self.$el.attr('class'));self.replaceElement(self.priority.$el);}));},});var KanbanSelection=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.name=$node.attr('name');this.parent=parent;},prepare_dropdown_selection:function(){var self=this;var _data=[];var stage_id=self.parent.values.stage_id.value[0];var stage_data={id:stage_id,legend_normal:self.parent.values.legend_normal?self.parent.values.legend_normal.value:undefined,legend_blocked:self.parent.values.legend_blocked?self.parent.values.legend_blocked.value:undefined,legend_done:self.parent.values.legend_done?self.parent.values.legend_done.value:undefined,};_.map(self.field.selection||[],function(res){var value={'name':res[0],'tooltip':res[1],};if(res[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:res[1];}else if(res[0]==='done'){value.state_class='oe_kanban_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:res[1];}else{value.state_class='oe_kanban_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:res[1];}
_data.push(value);});return _data;},renderElement:function(){var self=this;var state;self.states=this.prepare_dropdown_selection();var current_state=_.find(this.states,function(state){return state.name===self.get('value');})||{state_class:''};self.$el=$(QWeb.render("KanbanSelection",{current_state_class:current_state.state_class,states:_.without(this.states,current_state)}));self.$('a').click(function(ev){ev.preventDefault();});self.$('a').click(self.set_kanban_selection.bind(self));},set_kanban_selection:function(e){e.preventDefault();var self=this;var $li=$(e.target).closest("li");if($li.length){var value={};value[self.name]=String($li.data('value'));this.trigger_up('kanban_update_record',value,this);}},});var KanbanLabelSelection=AbstractField.extend({init:function(parent,field,$node){this._super.apply(this,arguments);this.classes=this.options&&this.options.classes||{};},renderElement:function(){this._super.apply(this,arguments);var lbl_class=this.classes[this.field.raw_value]||'primary';this.$el.addClass('label label-'+lbl_class).text(this.field.value);},});var KanbanAttachmentImage=AbstractField.extend({template:'KanbanAttachmentImage',});var KanbanProgressBar=AbstractField.extend({events:{'click':function(){if(!this.readonly&&this.progressbar.readonly){this.toggle_progressbar();}}},init:function(parent,field,node){this._super(parent,field,node);var record=this.getParent().record;this.progressbar=new ProgressBar(this,{readonly:true,value:record[this.options.current_value].raw_value,max_value:record[this.options.max_value].raw_value,title:_t(node&&node[0].title||this.options.title),edit_max_value:this.options.edit_max_value,});this.readonly=!this.options.editable;this.on_change=this.options.on_change;},start:function(){var self=this;var def=this.progressbar.appendTo('<div>').done(function(){self.progressbar.$el.addClass(self.$el.attr('class'));self.replaceElement(self.progressbar.$el);});return $.when(this._super(),def).then(function(){if(!self.readonly){var parent=self.getParent();self.progressbar.on('update',self,function(update){var value=update.changed_value;if(!isNaN(value)){var data={method:this.on_change,params:[parent.id,value],callback:self.proxy('toggle_progressbar'),};self.trigger_up('kanban_call_method',data);}});}});},toggle_progressbar:function(){this.progressbar.readonly=!this.progressbar.readonly;var $div=$('<div/>').insertAfter(this.$el);this.progressbar.replace($div);this.setElement(this.progressbar.$el);},});var KanbanMonetary=AbstractField.extend({tagName:'span',renderElement:function(){var kanban_view=this.getParent();var currency_field=(this.options&&this.options.currency_field)||'currency_id';var currency_id=kanban_view.values[currency_field].value[0];var currency=session.get_currency(currency_id);var digits_precision=this.options.digits||(currency&&currency.digits);var value=formats.format_value(this.field.raw_value||0,{type:this.field.type,digits:digits_precision});if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
this.$el.text(value);}});var fields_registry=new Registry();fields_registry.add('priority',KanbanPriority).add('kanban_state_selection',KanbanSelection).add("attachment_image",KanbanAttachmentImage).add('progress',KanbanProgressBar).add('float_time',FormatChar).add('monetary',KanbanMonetary).add('kanban_label_selection',KanbanLabelSelection);return{AbstractField:AbstractField,registry:fields_registry,};});;

/* /web_kanban/static/src/js/compatibility.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban.compatibility',function(require){"use strict";var kanban_widgets=require('web_kanban.widgets');var KanbanRecord=require('web_kanban.Record');var KanbanColumn=require('web_kanban.Column');var KanbanView=require('web_kanban.KanbanView');return;openerp=window.openerp||{};openerp.web_kanban=openerp.web_kanban||{};openerp.web_kanban.AbstractField=kanban_widgets.AbstractField;openerp.web_kanban.KanbanGroup=KanbanColumn;openerp.web_kanban.KanbanRecord=KanbanRecord;openerp.web_kanban.KanbanView=KanbanView;});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var core=require('web.core');var kanban_widgets=require('web_kanban.widgets');var utils=require('web.utils');var AbstractField=kanban_widgets.AbstractField;var fields_registry=kanban_widgets.registry;var _t=core._t;var GaugeWidget=AbstractField.extend({className:"oe_gauge",start:function(){var self=this;var parent=this.getParent();var max_value=this.options.max_value||100;if(this.options.max_field){max_value=this.getParent().record[this.options.max_field].raw_value;}
var label=this.options.label||"";if(this.options.label_field){label=this.getParent().record[this.options.label_field].raw_value;}
var title=this.$node.html()||this.field.string;var val=this.field.raw_value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var value=_.isArray(val)&&val.length?val[val.length-1]['value']:val;var gauge_value=value;if(this.options.gauge_value_field){gauge_value=this.getParent().record[this.options.gauge_value_field].raw_value;}
var degree=Math.PI/180,width=200,height=150,outerRadius=Math.min(width,height)*0.5,innerRadius=outerRadius*0.7,fontSize=height/7;this.$el.empty().attr('style',this.$node.attr('style')+';position:relative; display:inline-block;');var arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius).startAngle(-90*degree);var svg=d3.select(this.$el[0]).append("svg").attr("width",'100%').attr("height",'100%').attr('viewBox','0 0 '+width+' '+height).attr('preserveAspectRatio','xMinYMin').append("g").attr("transform","translate("+(width/2)+","+(height-(width-height)/2-12)+")");function addText(text,fontSize,dx,dy){return svg.append("text").attr("text-anchor","middle").style("font-size",fontSize+'px').attr("dy",dy).attr("dx",dx).text(text);}
addText(title,16,0,-outerRadius-16).style("font-weight",'bold');var text=addText(utils.human_number(value,1),fontSize,0,-2).style("font-weight",'bold');addText(0,8,-(outerRadius+innerRadius)/2,12);addText(label,8,0,12);addText(utils.human_number(max_value,1),8,(outerRadius+innerRadius)/2,12);svg.append("path").datum({endAngle:Math.PI/2}).style("fill","#ddd").attr("d",arc);var foreground=svg.append("path").datum({endAngle:0}).style("fill","hsl(0,80%,50%)").attr("d",arc);var ratio=max_value?value/max_value:0;var hue=Math.round(ratio*120);foreground.transition().style("fill","hsl("+hue+",80%,50%)").duration(1500).call(arcTween,(ratio-0.5)*Math.PI);function arcTween(transition,newAngle){transition.attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,newAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}
var flag_open=false;if(this.options.on_change){var $svg=this.$el.find('svg');this.$el.click(function(event){event.stopPropagation();flag_open=false;if(!parent.view.is_action_enabled('edit')){return;}
$svg.fadeTo(0,0.2);if(!self.$el.find(".o_gauge_edit").size()){var $div=$('<div class="o_gauge_edit" style="z-index:1"/>');$div.css({'text-align':'center','position':'absolute','width':self.$el.outerWidth()+'px','top':(self.$el.outerHeight()/2-5)+'px'});var $input=$('<input/>').val(gauge_value);$input.css({'text-align':'center','margin':'auto','width':($svg.outerWidth()-40)+'px'});$div.append($input);if(self.options.on_click_label){var $post_input=$('<span style="color: #000000;">'+self.options.on_click_label+'</span>');$div.append($post_input);}
self.$el.prepend($div);$input.focus().keydown(function(event){event.stopPropagation();if(isNaN($input.val())){self.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));$div.remove();$svg.fadeTo(0,1);}else{if(event.keyCode==13||event.keyCode==9){if($input.val()!=value){$svg.fadeTo(0,1);parent.view.dataset.call(self.options.on_change,[parent.id,$input.val()]).then(function(){parent.do_reload();});}else{$svg.fadeTo(0,1);$div.remove();}}}}).click(function(event){event.stopPropagation();flag_open=false;}).blur(function(){if(!flag_open){self.$el.find(".o_gauge_edit").remove();$svg.fadeTo(0,1);}else{$svg.fadeTo(0,1);flag_open=false;setTimeout(function(){$input.focus();},0);}});}}).mousedown(function(){flag_open=true;});if(this.options.force_set&&!+input_value){$svg.fadeTo(0,0.3);var $div=$('<div/>').text(_t("Click to change value"));$div.css(css);this.$el.append($div);}}},});fields_registry.add("gauge",GaugeWidget);});;

/* /web_readonly_bypass/static/src/js/readonly_bypass.js defined in bundle 'web.assets_backend' */
odoo.define('web_readonly_bypass',function(require){'use strict';var data=require('web.data'),pyeval=require('web.pyeval');var readonly_bypass={ignore_readonly:function(data,options,mode,context){var readonly_by_pass_fields=this.retrieve_readonly_by_pass_fields(options,context);if(mode){$.each(readonly_by_pass_fields,function(key,value){if(value==false){delete(readonly_by_pass_fields[key]);}});}
data=$.extend(data,readonly_by_pass_fields);},retrieve_readonly_by_pass_fields:function(options,context){var readonly_by_pass_fields={};if(options&&'readonly_fields'in options&&options['readonly_fields']&&context&&'readonly_by_pass'in context&&context['readonly_by_pass']){if(_.isArray(context['readonly_by_pass'])){$.each(options.readonly_fields,function(key,value){if(_.contains(context['readonly_by_pass'],key)){readonly_by_pass_fields[key]=value;}});}else{readonly_by_pass_fields=options.readonly_fields;}}
return readonly_by_pass_fields;},};data.BufferedDataSet.include({init:function(){this._super.apply(this,arguments);},create:function(data,options){var self=this;var context=pyeval.eval('contexts',self.context.get_eval_context());readonly_bypass.ignore_readonly(data,options,true,context);return self._super(data,options);},write:function(id,data,options){var self=this;var context=pyeval.eval('contexts',self.context.get_eval_context());readonly_bypass.ignore_readonly(data,options,false,context);return self._super(id,data,options);},});data.DataSet.include({init:function(){this._super.apply(this,arguments);},create:function(data,options){var self=this;readonly_bypass.ignore_readonly(data,options,true,self.context);return self._super(data,options);},write:function(id,data,options){var self=this;readonly_bypass.ignore_readonly(data,options,false,self.context);return self._super(id,data,options);},});data.ProxyDataSet.include({init:function(){this._super.apply(this,arguments);},create:function(data,options){var self=this;var context=pyeval.eval('contexts',self.context.get_eval_context());readonly_bypass.ignore_readonly(data,options,true,context);return self._super(data,options);},write:function(id,data,options){var self=this;var context=pyeval.eval('contexts',self.context.get_eval_context());readonly_bypass.ignore_readonly(data,options,false,context);return self._super(id,data,options);},});return readonly_bypass;});;

/* /web_widget_float_formula/static/src/js/web_widget_float_formula.js defined in bundle 'web.assets_backend' */
odoo.define('web_widget_float_formula',function(require){"use strict";var form_view=require('web.FormView');form_view.include({_process_save:function(save_obj){for(var f in this.fields){if(!this.fields.hasOwnProperty(f)){continue;}
f=this.fields[f];if(f.hasOwnProperty('_formula_text')&&f.$el.find('input').length>0){f._compute_result();f._clean_formula_text();}}
return this._super(save_obj);},});var core=require('web.core');core.bus.on('web_client_ready',null,function(){var translation_params=core._t.database.parameters;var decimal_point=translation_params.decimal_point;var thousands_sep=translation_params.thousands_sep;var field_float=require('web.form_widgets').FieldFloat;field_float.include({start:function(){this._super();this.on('blurred',this,this._compute_result);this.on('focused',this,this._display_formula);return this;},initialize_content:function(){this._clean_formula_text();return this._super();},_formula_text:'',_clean_formula_text:function(){this._formula_text='';},_process_formula:function(formula){try{formula=formula.toString();}catch(ex){return false;}
var clean_formula=formula.toString().replace(/^\s+|\s+$/g,'');if(clean_formula[0]=='='){clean_formula=clean_formula.substring(1);var myreg=new RegExp('[0-9]|\\s|\\.|,|\\(|\\)|\\+|\\-|\\*|\\/','g');if(clean_formula.replace(myreg,'')===''){return clean_formula;}}
return false;},_eval_formula:function(formula){var value;formula=formula.replace(thousands_sep,'').replace(decimal_point,'.');try{value=eval(formula);}
catch(e){}
if(typeof value!='undefined'){return value;}
return false;},_compute_result:function(){this._clean_formula_text();var input=this.$input.val();var formula=this._process_formula(input);if(formula!==false){var value=this._eval_formula(formula);if(value!==false){this._formula_text="="+formula;this.set_value(value);this.render_value();}}},_display_formula:function(){if(this._formula_text!==''){this.$input.val(this._formula_text);}},});});});;

/* /web_settings_dashboard/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('web_settings_dashboard',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var Model=require('web.Model');var session=require('web.session');var PlannerCommon=require('web.planner.common');var framework=require('web.framework');var webclient=require('web.web_client');var PlannerDialog=PlannerCommon.PlannerDialog;var QWeb=core.qweb;var _t=core._t;var Dashboard=Widget.extend({template:'DashboardMain',init:function(parent,data){this.all_dashboards=['apps','invitations','planner','share'];return this._super.apply(this,arguments);},start:function(){return this.load(this.all_dashboards);},load:function(dashboards){var self=this;var loading_done=new $.Deferred();session.rpc("/web_settings_dashboard/data",{}).then(function(data){var all_dashboards_defs=[];_.each(dashboards,function(dashboard){var dashboard_def=self['load_'+dashboard](data);if(dashboard_def){all_dashboards_defs.push(dashboard_def);}});$.when.apply($,all_dashboards_defs).then(function(){loading_done.resolve();});});return loading_done;},load_apps:function(data){return new DashboardApps(this,data.apps).replace(this.$('.o_web_settings_dashboard_apps'));},load_share:function(data){return new DashboardShare(this,data.share).replace(this.$('.o_web_settings_dashboard_share'));},load_invitations:function(data){return new DashboardInvitations(this,data.users_info).replace(this.$('.o_web_settings_dashboard_invitations'));},load_planner:function(data){return new DashboardPlanner(this,data.planner).replace(this.$('.o_web_settings_dashboard_planner'));},});var DashboardInvitations=Widget.extend({template:'DashboardInvitations',events:{'click .o_web_settings_dashboard_invitations':'send_invitations','click .o_web_settings_dashboard_access_rights':'on_access_rights_clicked','click .o_web_settings_dashboard_user':'on_user_clicked','click .o_web_settings_dashboard_more':'on_more',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},send_invitations:function(e){var self=this;var $target=$(e.currentTarget);var user_emails=_.filter($(e.delegateTarget).find('#user_emails').val().split(/[\n, ]/),function(email){return email!=="";});var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;var is_valid_emails=_.every(user_emails,function(email){return re.test(email);});if(is_valid_emails){$target.prop('disabled',true);$target.find('i.fa-cog').removeClass('hidden');new Model("res.users").call("web_dashboard_create_users",[user_emails]).then(function(){self.reload();}).always(function(){$(e.delegateTarget).find('.o_web_settings_dashboard_invitations').prop('disabled',false);$(e.delegateTarget).find('i.fa-cog').addClass('hidden');});}
else{this.do_warn(_t("Please provide valid email addresses"),"");}},on_access_rights_clicked:function(e){var self=this;e.preventDefault();this.do_action('base.action_res_users',{on_reverse_breadcrumb:function(){return self.reload();}});},on_user_clicked:function(e){var self=this;e.preventDefault();var user_id=$(e.currentTarget).data('user-id');var action={type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:'res.users',views:[[this.data.user_form_view_id,'form']],res_id:user_id,};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},on_more:function(e){var self=this;e.preventDefault();var action={type:'ir.actions.act_window',view_type:'form',view_mode:'tree,form',res_model:'res.users',domain:[['log_ids','=',false]],views:[[false,'list'],[false,'form']],};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},reload:function(){return this.parent.load(['invitations']);},});var DashboardPlanner=Widget.extend({template:'DashboardPlanner',events:{'click .o_web_settings_dashboard_progress_title,.progress':'on_planner_clicked',},init:function(parent,data){this.data=data;this.parent=parent;this.planner_by_menu={};this._super.apply(this,arguments);},willStart:function(){var self=this;return new Model('web.planner').query().all().then(function(res){self.planners=res;_.each(self.planners,function(planner){self.planner_by_menu[planner.menu_id[0]]=planner;self.planner_by_menu[planner.menu_id[0]].data=$.parseJSON(planner.data)||{};});self.set_overall_progress();});},update_planner_progress:function(){this.set_overall_progress();this.$('.o_web_settings_dashboard_planners_list').replaceWith(QWeb.render("DashboardPlanner.PlannersList",{'planners':this.planners}));},set_overall_progress:function(){var self=this;this.sort_planners_list();var average=_.reduce(self.planners,function(memo,planner){return planner.progress+memo;},0)/(self.planners.length||1);self.overall_progress=Math.floor(average);self.$('.o_web_settings_dashboard_planner_overall_progress').text(self.overall_progress);},sort_planners_list:function(){this.planners=_.sortBy(this.planners,function(planner){return(planner.progress==100)+planner.name;});},on_planner_clicked:function(e){var menu_id=$(e.currentTarget).attr('data-menu-id');if(this.planner&&this.planner.menu_id[0]==menu_id){this.dialog.$el.modal('show');}
else{this.setup_planner(menu_id);}},setup_planner:function(menu_id){var self=this;this.planner=self.planner_by_menu[menu_id];if(this.dialog){this.dialog.destroy();}
this.dialog=new PlannerDialog(this,this.planner);this.dialog.on("planner_progress_changed",this,function(percent){self.planner.progress=percent;self.update_planner_progress();});this.dialog.appendTo(webclient.$el).then(function(){self.dialog.$el.modal('show');});}});var DashboardApps=Widget.extend({template:'DashboardApps',events:{'click .o_browse_apps':'on_new_apps','click .o_confirm_upgrade':'confirm_upgrade',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},start:function(){this._super.apply(this,arguments);if(odoo.db_info&&_.last(odoo.db_info.server_version_info)!=='e'){$(QWeb.render("DashboardEnterprise")).appendTo(this.$el);}},on_new_apps:function(){this.do_action('base.open_module_tree');},confirm_upgrade:function(){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+(this.data.enterprise_users||1));},});var DashboardShare=Widget.extend({template:'DashboardShare',events:{'click .tw_share':'share_twitter','click .fb_share':'share_facebook','click .li_share':'share_linkedin',},init:function(parent,data){this.data=data;this.parent=parent;this.share_url='https://www.odoo.com';this.share_text=encodeURIComponent("I am using #Odoo - Awesome open source business apps.");},share_twitter:function(){var popup_url=_.str.sprintf('https://twitter.com/intent/tweet?tw_p=tweetbutton&text=%s %s',this.share_text,this.share_url);this.sharer(popup_url);},share_facebook:function(){var popup_url=_.str.sprintf('https://www.facebook.com/sharer/sharer.php?u=%s',encodeURIComponent(this.share_url));this.sharer(popup_url);},share_linkedin:function(){var popup_url=_.str.sprintf('http://www.linkedin.com/shareArticle?mini=true&url=%s&title=I am using odoo&summary=%s&source=www.odoo.com',encodeURIComponent(this.share_url),this.share_text);this.sharer(popup_url);},sharer:function(popup_url){window.open(popup_url,'Share Dialog','width=600,height=400');}});core.action_registry.add('web_settings_dashboard.main',Dashboard);return{Dashboard:Dashboard,DashboardInvitations:DashboardInvitations,DashboardPlanner:DashboardPlanner,DashboardShare:DashboardShare,};});